(function(){"use strict";var ds=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function kg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var lf={exports:{}},yc={},uf={exports:{}},rt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Cg;function sw(){if(Cg)return rt;Cg=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),h=Symbol.for("react.context"),y=Symbol.for("react.forward_ref"),v=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),C=Symbol.for("react.lazy"),T=Symbol.iterator;function L(Q){return Q===null||typeof Q!="object"?null:(Q=T&&Q[T]||Q["@@iterator"],typeof Q=="function"?Q:null)}var A={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},P=Object.assign,R={};function N(Q,ue,g){this.props=Q,this.context=ue,this.refs=R,this.updater=g||A}N.prototype.isReactComponent={},N.prototype.setState=function(Q,ue){if(typeof Q!="object"&&typeof Q!="function"&&Q!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,Q,ue,"setState")},N.prototype.forceUpdate=function(Q){this.updater.enqueueForceUpdate(this,Q,"forceUpdate")};function V(){}V.prototype=N.prototype;function G(Q,ue,g){this.props=Q,this.context=ue,this.refs=R,this.updater=g||A}var X=G.prototype=new V;X.constructor=G,P(X,N.prototype),X.isPureReactComponent=!0;var x=Array.isArray,$=Object.prototype.hasOwnProperty,q={current:null},re={key:!0,ref:!0,__self:!0,__source:!0};function me(Q,ue,g){var M,E={},D=null,z=null;if(ue!=null)for(M in ue.ref!==void 0&&(z=ue.ref),ue.key!==void 0&&(D=""+ue.key),ue)$.call(ue,M)&&!re.hasOwnProperty(M)&&(E[M]=ue[M]);var K=arguments.length-2;if(K===1)E.children=g;else if(1<K){for(var se=Array(K),pe=0;pe<K;pe++)se[pe]=arguments[pe+2];E.children=se}if(Q&&Q.defaultProps)for(M in K=Q.defaultProps,K)E[M]===void 0&&(E[M]=K[M]);return{$$typeof:n,type:Q,key:D,ref:z,props:E,_owner:q.current}}function ae(Q,ue){return{$$typeof:n,type:Q.type,key:ue,ref:Q.ref,props:Q.props,_owner:Q._owner}}function we(Q){return typeof Q=="object"&&Q!==null&&Q.$$typeof===n}function S(Q){var ue={"=":"=0",":":"=2"};return"$"+Q.replace(/[=:]/g,function(g){return ue[g]})}var Te=/\/+/g;function ke(Q,ue){return typeof Q=="object"&&Q!==null&&Q.key!=null?S(""+Q.key):ue.toString(36)}function J(Q,ue,g,M,E){var D=typeof Q;(D==="undefined"||D==="boolean")&&(Q=null);var z=!1;if(Q===null)z=!0;else switch(D){case"string":case"number":z=!0;break;case"object":switch(Q.$$typeof){case n:case e:z=!0}}if(z)return z=Q,E=E(z),Q=M===""?"."+ke(z,0):M,x(E)?(g="",Q!=null&&(g=Q.replace(Te,"$&/")+"/"),J(E,ue,g,"",function(pe){return pe})):E!=null&&(we(E)&&(E=ae(E,g+(!E.key||z&&z.key===E.key?"":(""+E.key).replace(Te,"$&/")+"/")+Q)),ue.push(E)),1;if(z=0,M=M===""?".":M+":",x(Q))for(var K=0;K<Q.length;K++){D=Q[K];var se=M+ke(D,K);z+=J(D,ue,g,se,E)}else if(se=L(Q),typeof se=="function")for(Q=se.call(Q),K=0;!(D=Q.next()).done;)D=D.value,se=M+ke(D,K++),z+=J(D,ue,g,se,E);else if(D==="object")throw ue=String(Q),Error("Objects are not valid as a React child (found: "+(ue==="[object Object]"?"object with keys {"+Object.keys(Q).join(", ")+"}":ue)+"). If you meant to render a collection of children, use an array instead.");return z}function De(Q,ue,g){if(Q==null)return Q;var M=[],E=0;return J(Q,M,"","",function(D){return ue.call(g,D,E++)}),M}function et(Q){if(Q._status===-1){var ue=Q._result;ue=ue(),ue.then(function(g){(Q._status===0||Q._status===-1)&&(Q._status=1,Q._result=g)},function(g){(Q._status===0||Q._status===-1)&&(Q._status=2,Q._result=g)}),Q._status===-1&&(Q._status=0,Q._result=ue)}if(Q._status===1)return Q._result.default;throw Q._result}var ve={current:null},ge={transition:null},Oe={ReactCurrentDispatcher:ve,ReactCurrentBatchConfig:ge,ReactCurrentOwner:q};function oe(){throw Error("act(...) is not supported in production builds of React.")}return rt.Children={map:De,forEach:function(Q,ue,g){De(Q,function(){ue.apply(this,arguments)},g)},count:function(Q){var ue=0;return De(Q,function(){ue++}),ue},toArray:function(Q){return De(Q,function(ue){return ue})||[]},only:function(Q){if(!we(Q))throw Error("React.Children.only expected to receive a single React element child.");return Q}},rt.Component=N,rt.Fragment=r,rt.Profiler=l,rt.PureComponent=G,rt.StrictMode=a,rt.Suspense=v,rt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Oe,rt.act=oe,rt.cloneElement=function(Q,ue,g){if(Q==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+Q+".");var M=P({},Q.props),E=Q.key,D=Q.ref,z=Q._owner;if(ue!=null){if(ue.ref!==void 0&&(D=ue.ref,z=q.current),ue.key!==void 0&&(E=""+ue.key),Q.type&&Q.type.defaultProps)var K=Q.type.defaultProps;for(se in ue)$.call(ue,se)&&!re.hasOwnProperty(se)&&(M[se]=ue[se]===void 0&&K!==void 0?K[se]:ue[se])}var se=arguments.length-2;if(se===1)M.children=g;else if(1<se){K=Array(se);for(var pe=0;pe<se;pe++)K[pe]=arguments[pe+2];M.children=K}return{$$typeof:n,type:Q.type,key:E,ref:D,props:M,_owner:z}},rt.createContext=function(Q){return Q={$$typeof:h,_currentValue:Q,_currentValue2:Q,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},Q.Provider={$$typeof:f,_context:Q},Q.Consumer=Q},rt.createElement=me,rt.createFactory=function(Q){var ue=me.bind(null,Q);return ue.type=Q,ue},rt.createRef=function(){return{current:null}},rt.forwardRef=function(Q){return{$$typeof:y,render:Q}},rt.isValidElement=we,rt.lazy=function(Q){return{$$typeof:C,_payload:{_status:-1,_result:Q},_init:et}},rt.memo=function(Q,ue){return{$$typeof:b,type:Q,compare:ue===void 0?null:ue}},rt.startTransition=function(Q){var ue=ge.transition;ge.transition={};try{Q()}finally{ge.transition=ue}},rt.unstable_act=oe,rt.useCallback=function(Q,ue){return ve.current.useCallback(Q,ue)},rt.useContext=function(Q){return ve.current.useContext(Q)},rt.useDebugValue=function(){},rt.useDeferredValue=function(Q){return ve.current.useDeferredValue(Q)},rt.useEffect=function(Q,ue){return ve.current.useEffect(Q,ue)},rt.useId=function(){return ve.current.useId()},rt.useImperativeHandle=function(Q,ue,g){return ve.current.useImperativeHandle(Q,ue,g)},rt.useInsertionEffect=function(Q,ue){return ve.current.useInsertionEffect(Q,ue)},rt.useLayoutEffect=function(Q,ue){return ve.current.useLayoutEffect(Q,ue)},rt.useMemo=function(Q,ue){return ve.current.useMemo(Q,ue)},rt.useReducer=function(Q,ue,g){return ve.current.useReducer(Q,ue,g)},rt.useRef=function(Q){return ve.current.useRef(Q)},rt.useState=function(Q){return ve.current.useState(Q)},rt.useSyncExternalStore=function(Q,ue,g){return ve.current.useSyncExternalStore(Q,ue,g)},rt.useTransition=function(){return ve.current.useTransition()},rt.version="18.3.1",rt}var Eg;function df(){return Eg||(Eg=1,uf.exports=sw()),uf.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Mg;function ow(){if(Mg)return yc;Mg=1;var n=df(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,f={key:!0,ref:!0,__self:!0,__source:!0};function h(y,v,b){var C,T={},L=null,A=null;b!==void 0&&(L=""+b),v.key!==void 0&&(L=""+v.key),v.ref!==void 0&&(A=v.ref);for(C in v)a.call(v,C)&&!f.hasOwnProperty(C)&&(T[C]=v[C]);if(y&&y.defaultProps)for(C in v=y.defaultProps,v)T[C]===void 0&&(T[C]=v[C]);return{$$typeof:e,type:y,key:L,ref:A,props:T,_owner:l.current}}return yc.Fragment=r,yc.jsx=h,yc.jsxs=h,yc}var Tg;function aw(){return Tg||(Tg=1,lf.exports=ow()),lf.exports}var le=aw(),U=df();const tt=kg(U);var Hl={},ff={exports:{}},Qn={},hf={exports:{}},pf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Og;function cw(){return Og||(Og=1,(function(n){function e(ge,Oe){var oe=ge.length;ge.push(Oe);e:for(;0<oe;){var Q=oe-1>>>1,ue=ge[Q];if(0<l(ue,Oe))ge[Q]=Oe,ge[oe]=ue,oe=Q;else break e}}function r(ge){return ge.length===0?null:ge[0]}function a(ge){if(ge.length===0)return null;var Oe=ge[0],oe=ge.pop();if(oe!==Oe){ge[0]=oe;e:for(var Q=0,ue=ge.length,g=ue>>>1;Q<g;){var M=2*(Q+1)-1,E=ge[M],D=M+1,z=ge[D];if(0>l(E,oe))D<ue&&0>l(z,E)?(ge[Q]=z,ge[D]=oe,Q=D):(ge[Q]=E,ge[M]=oe,Q=M);else if(D<ue&&0>l(z,oe))ge[Q]=z,ge[D]=oe,Q=D;else break e}}return Oe}function l(ge,Oe){var oe=ge.sortIndex-Oe.sortIndex;return oe!==0?oe:ge.id-Oe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;n.unstable_now=function(){return f.now()}}else{var h=Date,y=h.now();n.unstable_now=function(){return h.now()-y}}var v=[],b=[],C=1,T=null,L=3,A=!1,P=!1,R=!1,N=typeof setTimeout=="function"?setTimeout:null,V=typeof clearTimeout=="function"?clearTimeout:null,G=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function X(ge){for(var Oe=r(b);Oe!==null;){if(Oe.callback===null)a(b);else if(Oe.startTime<=ge)a(b),Oe.sortIndex=Oe.expirationTime,e(v,Oe);else break;Oe=r(b)}}function x(ge){if(R=!1,X(ge),!P)if(r(v)!==null)P=!0,et($);else{var Oe=r(b);Oe!==null&&ve(x,Oe.startTime-ge)}}function $(ge,Oe){P=!1,R&&(R=!1,V(me),me=-1),A=!0;var oe=L;try{for(X(Oe),T=r(v);T!==null&&(!(T.expirationTime>Oe)||ge&&!S());){var Q=T.callback;if(typeof Q=="function"){T.callback=null,L=T.priorityLevel;var ue=Q(T.expirationTime<=Oe);Oe=n.unstable_now(),typeof ue=="function"?T.callback=ue:T===r(v)&&a(v),X(Oe)}else a(v);T=r(v)}if(T!==null)var g=!0;else{var M=r(b);M!==null&&ve(x,M.startTime-Oe),g=!1}return g}finally{T=null,L=oe,A=!1}}var q=!1,re=null,me=-1,ae=5,we=-1;function S(){return!(n.unstable_now()-we<ae)}function Te(){if(re!==null){var ge=n.unstable_now();we=ge;var Oe=!0;try{Oe=re(!0,ge)}finally{Oe?ke():(q=!1,re=null)}}else q=!1}var ke;if(typeof G=="function")ke=function(){G(Te)};else if(typeof MessageChannel<"u"){var J=new MessageChannel,De=J.port2;J.port1.onmessage=Te,ke=function(){De.postMessage(null)}}else ke=function(){N(Te,0)};function et(ge){re=ge,q||(q=!0,ke())}function ve(ge,Oe){me=N(function(){ge(n.unstable_now())},Oe)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(ge){ge.callback=null},n.unstable_continueExecution=function(){P||A||(P=!0,et($))},n.unstable_forceFrameRate=function(ge){0>ge||125<ge?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ae=0<ge?Math.floor(1e3/ge):5},n.unstable_getCurrentPriorityLevel=function(){return L},n.unstable_getFirstCallbackNode=function(){return r(v)},n.unstable_next=function(ge){switch(L){case 1:case 2:case 3:var Oe=3;break;default:Oe=L}var oe=L;L=Oe;try{return ge()}finally{L=oe}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(ge,Oe){switch(ge){case 1:case 2:case 3:case 4:case 5:break;default:ge=3}var oe=L;L=ge;try{return Oe()}finally{L=oe}},n.unstable_scheduleCallback=function(ge,Oe,oe){var Q=n.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?Q+oe:Q):oe=Q,ge){case 1:var ue=-1;break;case 2:ue=250;break;case 5:ue=1073741823;break;case 4:ue=1e4;break;default:ue=5e3}return ue=oe+ue,ge={id:C++,callback:Oe,priorityLevel:ge,startTime:oe,expirationTime:ue,sortIndex:-1},oe>Q?(ge.sortIndex=oe,e(b,ge),r(v)===null&&ge===r(b)&&(R?(V(me),me=-1):R=!0,ve(x,oe-Q))):(ge.sortIndex=ue,e(v,ge),P||A||(P=!0,et($))),ge},n.unstable_shouldYield=S,n.unstable_wrapCallback=function(ge){var Oe=L;return function(){var oe=L;L=Oe;try{return ge.apply(this,arguments)}finally{L=oe}}}})(pf)),pf}var Rg;function lw(){return Rg||(Rg=1,hf.exports=cw()),hf.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ag;function uw(){if(Ag)return Qn;Ag=1;var n=df(),e=lw();function r(t){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+t,c=1;c<arguments.length;c++)i+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+t+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function f(t,i){h(t,i),h(t+"Capture",i)}function h(t,i){for(l[t]=i,t=0;t<i.length;t++)a.add(i[t])}var y=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),v=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,C={},T={};function L(t){return v.call(T,t)?!0:v.call(C,t)?!1:b.test(t)?T[t]=!0:(C[t]=!0,!1)}function A(t,i,c,d){if(c!==null&&c.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return d?!1:c!==null?!c.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function P(t,i,c,d){if(i===null||typeof i>"u"||A(t,i,c,d))return!0;if(d)return!1;if(c!==null)switch(c.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function R(t,i,c,d,m,w,O){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=d,this.attributeNamespace=m,this.mustUseProperty=c,this.propertyName=t,this.type=i,this.sanitizeURL=w,this.removeEmptyString=O}var N={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){N[t]=new R(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var i=t[0];N[i]=new R(i,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){N[t]=new R(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){N[t]=new R(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){N[t]=new R(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){N[t]=new R(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){N[t]=new R(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){N[t]=new R(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){N[t]=new R(t,5,!1,t.toLowerCase(),null,!1,!1)});var V=/[\-:]([a-z])/g;function G(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var i=t.replace(V,G);N[i]=new R(i,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var i=t.replace(V,G);N[i]=new R(i,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var i=t.replace(V,G);N[i]=new R(i,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){N[t]=new R(t,1,!1,t.toLowerCase(),null,!1,!1)}),N.xlinkHref=new R("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){N[t]=new R(t,1,!1,t.toLowerCase(),null,!0,!0)});function X(t,i,c,d){var m=N.hasOwnProperty(i)?N[i]:null;(m!==null?m.type!==0:d||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(P(i,c,m,d)&&(c=null),d||m===null?L(i)&&(c===null?t.removeAttribute(i):t.setAttribute(i,""+c)):m.mustUseProperty?t[m.propertyName]=c===null?m.type===3?!1:"":c:(i=m.attributeName,d=m.attributeNamespace,c===null?t.removeAttribute(i):(m=m.type,c=m===3||m===4&&c===!0?"":""+c,d?t.setAttributeNS(d,i,c):t.setAttribute(i,c))))}var x=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$=Symbol.for("react.element"),q=Symbol.for("react.portal"),re=Symbol.for("react.fragment"),me=Symbol.for("react.strict_mode"),ae=Symbol.for("react.profiler"),we=Symbol.for("react.provider"),S=Symbol.for("react.context"),Te=Symbol.for("react.forward_ref"),ke=Symbol.for("react.suspense"),J=Symbol.for("react.suspense_list"),De=Symbol.for("react.memo"),et=Symbol.for("react.lazy"),ve=Symbol.for("react.offscreen"),ge=Symbol.iterator;function Oe(t){return t===null||typeof t!="object"?null:(t=ge&&t[ge]||t["@@iterator"],typeof t=="function"?t:null)}var oe=Object.assign,Q;function ue(t){if(Q===void 0)try{throw Error()}catch(c){var i=c.stack.trim().match(/\n( *(at )?)/);Q=i&&i[1]||""}return`
`+Q+t}var g=!1;function M(t,i){if(!t||g)return"";g=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(ie){var d=ie}Reflect.construct(t,[],i)}else{try{i.call()}catch(ie){d=ie}t.call(i.prototype)}else{try{throw Error()}catch(ie){d=ie}t()}}catch(ie){if(ie&&d&&typeof ie.stack=="string"){for(var m=ie.stack.split(`
`),w=d.stack.split(`
`),O=m.length-1,F=w.length-1;1<=O&&0<=F&&m[O]!==w[F];)F--;for(;1<=O&&0<=F;O--,F--)if(m[O]!==w[F]){if(O!==1||F!==1)do if(O--,F--,0>F||m[O]!==w[F]){var W=`
`+m[O].replace(" at new "," at ");return t.displayName&&W.includes("<anonymous>")&&(W=W.replace("<anonymous>",t.displayName)),W}while(1<=O&&0<=F);break}}}finally{g=!1,Error.prepareStackTrace=c}return(t=t?t.displayName||t.name:"")?ue(t):""}function E(t){switch(t.tag){case 5:return ue(t.type);case 16:return ue("Lazy");case 13:return ue("Suspense");case 19:return ue("SuspenseList");case 0:case 2:case 15:return t=M(t.type,!1),t;case 11:return t=M(t.type.render,!1),t;case 1:return t=M(t.type,!0),t;default:return""}}function D(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case re:return"Fragment";case q:return"Portal";case ae:return"Profiler";case me:return"StrictMode";case ke:return"Suspense";case J:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case S:return(t.displayName||"Context")+".Consumer";case we:return(t._context.displayName||"Context")+".Provider";case Te:var i=t.render;return t=t.displayName,t||(t=i.displayName||i.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case De:return i=t.displayName||null,i!==null?i:D(t.type)||"Memo";case et:i=t._payload,t=t._init;try{return D(t(i))}catch{}}return null}function z(t){var i=t.type;switch(t.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=i.render,t=t.displayName||t.name||"",i.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return D(i);case 8:return i===me?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function K(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function se(t){var i=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function pe(t){var i=se(t)?"checked":"value",c=Object.getOwnPropertyDescriptor(t.constructor.prototype,i),d=""+t[i];if(!t.hasOwnProperty(i)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var m=c.get,w=c.set;return Object.defineProperty(t,i,{configurable:!0,get:function(){return m.call(this)},set:function(O){d=""+O,w.call(this,O)}}),Object.defineProperty(t,i,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(O){d=""+O},stopTracking:function(){t._valueTracker=null,delete t[i]}}}}function Re(t){t._valueTracker||(t._valueTracker=pe(t))}function $e(t){if(!t)return!1;var i=t._valueTracker;if(!i)return!0;var c=i.getValue(),d="";return t&&(d=se(t)?t.checked?"true":"false":t.value),t=d,t!==c?(i.setValue(t),!0):!1}function Xe(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function zt(t,i){var c=i.checked;return oe({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??t._wrapperState.initialChecked})}function Sn(t,i){var c=i.defaultValue==null?"":i.defaultValue,d=i.checked!=null?i.checked:i.defaultChecked;c=K(i.value!=null?i.value:c),t._wrapperState={initialChecked:d,initialValue:c,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function jn(t,i){i=i.checked,i!=null&&X(t,"checked",i,!1)}function mt(t,i){jn(t,i);var c=K(i.value),d=i.type;if(c!=null)d==="number"?(c===0&&t.value===""||t.value!=c)&&(t.value=""+c):t.value!==""+c&&(t.value=""+c);else if(d==="submit"||d==="reset"){t.removeAttribute("value");return}i.hasOwnProperty("value")?en(t,i.type,c):i.hasOwnProperty("defaultValue")&&en(t,i.type,K(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(t.defaultChecked=!!i.defaultChecked)}function At(t,i,c){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var d=i.type;if(!(d!=="submit"&&d!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+t._wrapperState.initialValue,c||i===t.value||(t.value=i),t.defaultValue=i}c=t.name,c!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,c!==""&&(t.name=c)}function en(t,i,c){(i!=="number"||Xe(t.ownerDocument)!==t)&&(c==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+c&&(t.defaultValue=""+c))}var Vt=Array.isArray;function Ze(t,i,c,d){if(t=t.options,i){i={};for(var m=0;m<c.length;m++)i["$"+c[m]]=!0;for(c=0;c<t.length;c++)m=i.hasOwnProperty("$"+t[c].value),t[c].selected!==m&&(t[c].selected=m),m&&d&&(t[c].defaultSelected=!0)}else{for(c=""+K(c),i=null,m=0;m<t.length;m++){if(t[m].value===c){t[m].selected=!0,d&&(t[m].defaultSelected=!0);return}i!==null||t[m].disabled||(i=t[m])}i!==null&&(i.selected=!0)}}function Nn(t,i){if(i.dangerouslySetInnerHTML!=null)throw Error(r(91));return oe({},i,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Kn(t,i){var c=i.value;if(c==null){if(c=i.children,i=i.defaultValue,c!=null){if(i!=null)throw Error(r(92));if(Vt(c)){if(1<c.length)throw Error(r(93));c=c[0]}i=c}i==null&&(i=""),c=i}t._wrapperState={initialValue:K(c)}}function Jt(t,i){var c=K(i.value),d=K(i.defaultValue);c!=null&&(c=""+c,c!==t.value&&(t.value=c),i.defaultValue==null&&t.defaultValue!==c&&(t.defaultValue=c)),d!=null&&(t.defaultValue=""+d)}function Tr(t){var i=t.textContent;i===t._wrapperState.initialValue&&i!==""&&i!==null&&(t.value=i)}function Hi(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Nt(t,i){return t==null||t==="http://www.w3.org/1999/xhtml"?Hi(i):t==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Dt,ln=(function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,c,d,m){MSApp.execUnsafeLocalFunction(function(){return t(i,c,d,m)})}:t})(function(t,i){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=i;else{for(Dt=Dt||document.createElement("div"),Dt.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Dt.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;i.firstChild;)t.appendChild(i.firstChild)}});function Qr(t,i){if(i){var c=t.firstChild;if(c&&c===t.lastChild&&c.nodeType===3){c.nodeValue=i;return}}t.textContent=i}var yi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ia=["Webkit","ms","Moz","O"];Object.keys(yi).forEach(function(t){Ia.forEach(function(i){i=i+t.charAt(0).toUpperCase()+t.substring(1),yi[i]=yi[t]})});function Lo(t,i,c){return i==null||typeof i=="boolean"||i===""?"":c||typeof i!="number"||i===0||yi.hasOwnProperty(t)&&yi[t]?(""+i).trim():i+"px"}function Gi(t,i){t=t.style;for(var c in i)if(i.hasOwnProperty(c)){var d=c.indexOf("--")===0,m=Lo(c,i[c],d);c==="float"&&(c="cssFloat"),d?t.setProperty(c,m):t[c]=m}}var jo=oe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ks(t,i){if(i){if(jo[t]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(r(137,t));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(r(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(r(61))}if(i.style!=null&&typeof i.style!="object")throw Error(r(62))}}function _i(t,i){if(t.indexOf("-")===-1)return typeof i.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Yn=null;function wi(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Or=null,bt=null,Dn=null;function No(t){if(t=xi(t)){if(typeof Or!="function")throw Error(r(280));var i=t.stateNode;i&&(i=ec(i),Or(t.stateNode,t.type,i))}}function xa(t){bt?Dn?Dn.push(t):Dn=[t]:bt=t}function kn(){if(bt){var t=bt,i=Dn;if(Dn=bt=null,No(t),i)for(t=0;t<i.length;t++)No(i[t])}}function La(t,i){return t(i)}function ja(){}var Ji=!1;function Cs(t,i,c){if(Ji)return t(i,c);Ji=!0;try{return La(t,i,c)}finally{Ji=!1,(bt!==null||Dn!==null)&&(ja(),kn())}}function Cn(t,i){var c=t.stateNode;if(c===null)return null;var d=ec(c);if(d===null)return null;c=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(t=t.type,d=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!d;break e;default:t=!1}if(t)return null;if(c&&typeof c!="function")throw Error(r(231,i,typeof c));return c}var Es=!1;if(y)try{var bi={};Object.defineProperty(bi,"passive",{get:function(){Es=!0}}),window.addEventListener("test",bi,bi),window.removeEventListener("test",bi,bi)}catch{Es=!1}function zc(t,i,c,d,m,w,O,F,W){var ie=Array.prototype.slice.call(arguments,3);try{i.apply(c,ie)}catch(be){this.onError(be)}}var Si=!1,Ms=null,tn=!1,Do=null,Vc={onError:function(t){Si=!0,Ms=t}};function $c(t,i,c,d,m,w,O,F,W){Si=!1,Ms=null,zc.apply(Vc,arguments)}function Ts(t,i,c,d,m,w,O,F,W){if($c.apply(this,arguments),Si){if(Si){var ie=Ms;Si=!1,Ms=null}else throw Error(r(198));tn||(tn=!0,Do=ie)}}function Rr(t){var i=t,c=t;if(t.alternate)for(;i.return;)i=i.return;else{t=i;do i=t,(i.flags&4098)!==0&&(c=i.return),t=i.return;while(t)}return i.tag===3?c:null}function Xn(t){if(t.tag===13){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function Na(t){if(Rr(t)!==t)throw Error(r(188))}function qc(t){var i=t.alternate;if(!i){if(i=Rr(t),i===null)throw Error(r(188));return i!==t?null:t}for(var c=t,d=i;;){var m=c.return;if(m===null)break;var w=m.alternate;if(w===null){if(d=m.return,d!==null){c=d;continue}break}if(m.child===w.child){for(w=m.child;w;){if(w===c)return Na(m),t;if(w===d)return Na(m),i;w=w.sibling}throw Error(r(188))}if(c.return!==d.return)c=m,d=w;else{for(var O=!1,F=m.child;F;){if(F===c){O=!0,c=m,d=w;break}if(F===d){O=!0,d=m,c=w;break}F=F.sibling}if(!O){for(F=w.child;F;){if(F===c){O=!0,c=w,d=m;break}if(F===d){O=!0,d=w,c=m;break}F=F.sibling}if(!O)throw Error(r(189))}}if(c.alternate!==d)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?t:i}function qe(t){return t=qc(t),t!==null?Da(t):null}function Da(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var i=Da(t);if(i!==null)return i;t=t.sibling}return null}var Ua=e.unstable_scheduleCallback,pr=e.unstable_cancelCallback,Ba=e.unstable_shouldYield,Tt=e.unstable_requestPaint,Et=e.unstable_now,Wc=e.unstable_getCurrentPriorityLevel,ki=e.unstable_ImmediatePriority,Os=e.unstable_UserBlockingPriority,Qi=e.unstable_NormalPriority,Rs=e.unstable_LowPriority,Uo=e.unstable_IdlePriority,Ci=null,Un=null;function Fa(t){if(Un&&typeof Un.onCommitFiberRoot=="function")try{Un.onCommitFiberRoot(Ci,t,void 0,(t.current.flags&128)===128)}catch{}}var Bn=Math.clz32?Math.clz32:Gc,za=Math.log,Hc=Math.LN2;function Gc(t){return t>>>=0,t===0?32:31-(za(t)/Hc|0)|0}var Ei=64,As=4194304;function un(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function Mi(t,i){var c=t.pendingLanes;if(c===0)return 0;var d=0,m=t.suspendedLanes,w=t.pingedLanes,O=c&268435455;if(O!==0){var F=O&~m;F!==0?d=un(F):(w&=O,w!==0&&(d=un(w)))}else O=c&~m,O!==0?d=un(O):w!==0&&(d=un(w));if(d===0)return 0;if(i!==0&&i!==d&&(i&m)===0&&(m=d&-d,w=i&-i,m>=w||m===16&&(w&4194240)!==0))return i;if((d&4)!==0&&(d|=c&16),i=t.entangledLanes,i!==0)for(t=t.entanglements,i&=d;0<i;)c=31-Bn(i),m=1<<c,d|=t[c],i&=~m;return d}function Ti(t,i){switch(t){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Jc(t,i){for(var c=t.suspendedLanes,d=t.pingedLanes,m=t.expirationTimes,w=t.pendingLanes;0<w;){var O=31-Bn(w),F=1<<O,W=m[O];W===-1?((F&c)===0||(F&d)!==0)&&(m[O]=Ti(F,i)):W<=i&&(t.expiredLanes|=F),w&=~F}}function Bo(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Ps(){var t=Ei;return Ei<<=1,(Ei&4194240)===0&&(Ei=64),t}function Is(t){for(var i=[],c=0;31>c;c++)i.push(t);return i}function Kr(t,i,c){t.pendingLanes|=i,i!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,i=31-Bn(i),t[i]=c}function Qc(t,i){var c=t.pendingLanes&~i;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=i,t.mutableReadLanes&=i,t.entangledLanes&=i,i=t.entanglements;var d=t.eventTimes;for(t=t.expirationTimes;0<c;){var m=31-Bn(c),w=1<<m;i[m]=0,d[m]=-1,t[m]=-1,c&=~w}}function St(t,i){var c=t.entangledLanes|=i;for(t=t.entanglements;c;){var d=31-Bn(c),m=1<<d;m&i|t[d]&i&&(t[d]|=i),c&=~m}}var Ce=0;function xs(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var Ot,Fo,zo,Va,Vo,$o=!1,Ki=[],Fn=null,Qt=null,Zn=null,Yr=new Map,Xr=new Map,zn=[],Yi="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Xi(t,i){switch(t){case"focusin":case"focusout":Fn=null;break;case"dragenter":case"dragleave":Qt=null;break;case"mouseover":case"mouseout":Zn=null;break;case"pointerover":case"pointerout":Yr.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Xr.delete(i.pointerId)}}function er(t,i,c,d,m,w){return t===null||t.nativeEvent!==w?(t={blockedOn:i,domEventName:c,eventSystemFlags:d,nativeEvent:w,targetContainers:[m]},i!==null&&(i=xi(i),i!==null&&Fo(i)),t):(t.eventSystemFlags|=d,i=t.targetContainers,m!==null&&i.indexOf(m)===-1&&i.push(m),t)}function Zr(t,i,c,d,m){switch(i){case"focusin":return Fn=er(Fn,t,i,c,d,m),!0;case"dragenter":return Qt=er(Qt,t,i,c,d,m),!0;case"mouseover":return Zn=er(Zn,t,i,c,d,m),!0;case"pointerover":var w=m.pointerId;return Yr.set(w,er(Yr.get(w)||null,t,i,c,d,m)),!0;case"gotpointercapture":return w=m.pointerId,Xr.set(w,er(Xr.get(w)||null,t,i,c,d,m)),!0}return!1}function qo(t){var i=nn(t.target);if(i!==null){var c=Rr(i);if(c!==null){if(i=c.tag,i===13){if(i=Xn(c),i!==null){t.blockedOn=i,Vo(t.priority,function(){zo(c)});return}}else if(i===3&&c.stateNode.current.memoizedState.isDehydrated){t.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Ar(t){if(t.blockedOn!==null)return!1;for(var i=t.targetContainers;0<i.length;){var c=Vn(t.domEventName,t.eventSystemFlags,i[0],t.nativeEvent);if(c===null){c=t.nativeEvent;var d=new c.constructor(c.type,c);Yn=d,c.target.dispatchEvent(d),Yn=null}else return i=xi(c),i!==null&&Fo(i),t.blockedOn=c,!1;i.shift()}return!0}function $a(t,i,c){Ar(t)&&c.delete(i)}function Pr(){$o=!1,Fn!==null&&Ar(Fn)&&(Fn=null),Qt!==null&&Ar(Qt)&&(Qt=null),Zn!==null&&Ar(Zn)&&(Zn=null),Yr.forEach($a),Xr.forEach($a)}function Oi(t,i){t.blockedOn===i&&(t.blockedOn=null,$o||($o=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Pr)))}function Zi(t){function i(m){return Oi(m,t)}if(0<Ki.length){Oi(Ki[0],t);for(var c=1;c<Ki.length;c++){var d=Ki[c];d.blockedOn===t&&(d.blockedOn=null)}}for(Fn!==null&&Oi(Fn,t),Qt!==null&&Oi(Qt,t),Zn!==null&&Oi(Zn,t),Yr.forEach(i),Xr.forEach(i),c=0;c<zn.length;c++)d=zn[c],d.blockedOn===t&&(d.blockedOn=null);for(;0<zn.length&&(c=zn[0],c.blockedOn===null);)qo(c),c.blockedOn===null&&zn.shift()}var j=x.ReactCurrentBatchConfig,ne=!0;function ce(t,i,c,d){var m=Ce,w=j.transition;j.transition=null;try{Ce=1,Pt(t,i,c,d)}finally{Ce=m,j.transition=w}}function je(t,i,c,d){var m=Ce,w=j.transition;j.transition=null;try{Ce=4,Pt(t,i,c,d)}finally{Ce=m,j.transition=w}}function Pt(t,i,c,d){if(ne){var m=Vn(t,i,c,d);if(m===null)yl(t,i,d,Ut,c),Xi(t,d);else if(Zr(m,t,i,c,d))d.stopPropagation();else if(Xi(t,d),i&4&&-1<Yi.indexOf(t)){for(;m!==null;){var w=xi(m);if(w!==null&&Ot(w),w=Vn(t,i,c,d),w===null&&yl(t,i,d,Ut,c),w===m)break;m=w}m!==null&&d.stopPropagation()}else yl(t,i,d,null,c)}}var Ut=null;function Vn(t,i,c,d){if(Ut=null,t=wi(d),t=nn(t),t!==null)if(i=Rr(t),i===null)t=null;else if(c=i.tag,c===13){if(t=Xn(i),t!==null)return t;t=null}else if(c===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;t=null}else i!==t&&(t=null);return Ut=t,null}function $t(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Wc()){case ki:return 1;case Os:return 4;case Qi:case Rs:return 16;case Uo:return 536870912;default:return 16}default:return 16}}var gr=null,Bt=null,Ri=null;function Wo(){if(Ri)return Ri;var t,i=Bt,c=i.length,d,m="value"in gr?gr.value:gr.textContent,w=m.length;for(t=0;t<c&&i[t]===m[t];t++);var O=c-t;for(d=1;d<=O&&i[c-d]===m[w-d];d++);return Ri=m.slice(t,1<d?1-d:void 0)}function Ir(t){var i=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&i===13&&(t=13)):t=i,t===10&&(t=13),32<=t||t===13?t:0}function Ai(){return!0}function es(){return!1}function $n(t){function i(c,d,m,w,O){this._reactName=c,this._targetInst=m,this.type=d,this.nativeEvent=w,this.target=O,this.currentTarget=null;for(var F in t)t.hasOwnProperty(F)&&(c=t[F],this[F]=c?c(w):w[F]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Ai:es,this.isPropagationStopped=es,this}return oe(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Ai)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Ai)},persist:function(){},isPersistent:Ai}),i}var Ls={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Kc=$n(Ls),js=oe({},Ls,{view:0,detail:0}),rd=$n(js),Yc,Xc,Ns,Ho=oe({},js,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ts,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==Ns&&(Ns&&t.type==="mousemove"?(Yc=t.screenX-Ns.screenX,Xc=t.screenY-Ns.screenY):Xc=Yc=0,Ns=t),Yc)},movementY:function(t){return"movementY"in t?t.movementY:Xc}}),Ds=$n(Ho),Pi=oe({},Ho,{dataTransfer:0}),ip=$n(Pi),sp=oe({},js,{relatedTarget:0}),qa=$n(sp),op=oe({},Ls,{animationName:0,elapsedTime:0,pseudoElement:0}),ap=$n(op),id=oe({},Ls,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),cp=$n(id),lp=oe({},Ls,{data:0}),sd=$n(lp),od={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},up={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ad(t){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(t):(t=Zc[t])?!!i[t]:!1}function ts(){return ad}var Ii=oe({},js,{key:function(t){if(t.key){var i=od[t.key]||t.key;if(i!=="Unidentified")return i}return t.type==="keypress"?(t=Ir(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?up[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ts,charCode:function(t){return t.type==="keypress"?Ir(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Ir(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),dp=$n(Ii),fp=oe({},Ho,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),cd=$n(fp),hp=oe({},js,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ts}),pp=$n(hp),gp=oe({},Ls,{propertyName:0,elapsedTime:0,pseudoElement:0}),ld=$n(gp),mp=oe({},Ho,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),ud=$n(mp),vp=[9,13,27,32],el=y&&"CompositionEvent"in window,Us=null;y&&"documentMode"in document&&(Us=document.documentMode);var dd=y&&"TextEvent"in window&&!Us,tl=y&&(!el||Us&&8<Us&&11>=Us),nl=" ",rl=!1;function fd(t,i){switch(t){case"keyup":return vp.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function hd(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Bs=!1;function pd(t,i){switch(t){case"compositionend":return hd(i);case"keypress":return i.which!==32?null:(rl=!0,nl);case"textInput":return t=i.data,t===nl&&rl?null:t;default:return null}}function Fs(t,i){if(Bs)return t==="compositionend"||!el&&fd(t,i)?(t=Wo(),Ri=Bt=gr=null,Bs=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return tl&&i.locale!=="ko"?null:i.data;default:return null}}var Go={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function il(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i==="input"?!!Go[t.type]:i==="textarea"}function sl(t,i,c,d){xa(d),i=Ws(i,"onChange"),0<i.length&&(c=new Kc("onChange","change",null,c,d),t.push({event:c,listeners:i}))}var zs=null,Vs=null;function yp(t){ml(t,0)}function $s(t){var i=Qs(t);if($e(i))return t}function _p(t,i){if(t==="change")return i}var Jo=!1;if(y){var ol;if(y){var Qo="oninput"in document;if(!Qo){var al=document.createElement("div");al.setAttribute("oninput","return;"),Qo=typeof al.oninput=="function"}ol=Qo}else ol=!1;Jo=ol&&(!document.documentMode||9<document.documentMode)}function En(){zs&&(zs.detachEvent("onpropertychange",Wa),Vs=zs=null)}function Wa(t){if(t.propertyName==="value"&&$s(Vs)){var i=[];sl(i,Vs,t,wi(t)),Cs(yp,i)}}function cl(t,i,c){t==="focusin"?(En(),zs=i,Vs=c,zs.attachEvent("onpropertychange",Wa)):t==="focusout"&&En()}function wp(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return $s(Vs)}function bp(t,i){if(t==="click")return $s(i)}function ll(t,i){if(t==="input"||t==="change")return $s(i)}function gd(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var mr=typeof Object.is=="function"?Object.is:gd;function Ko(t,i){if(mr(t,i))return!0;if(typeof t!="object"||t===null||typeof i!="object"||i===null)return!1;var c=Object.keys(t),d=Object.keys(i);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var m=c[d];if(!v.call(i,m)||!mr(t[m],i[m]))return!1}return!0}function ul(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function qs(t,i){var c=ul(t);t=0;for(var d;c;){if(c.nodeType===3){if(d=t+c.textContent.length,t<=i&&d>=i)return{node:c,offset:i-t};t=d}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=ul(c)}}function md(t,i){return t&&i?t===i?!0:t&&t.nodeType===3?!1:i&&i.nodeType===3?md(t,i.parentNode):"contains"in t?t.contains(i):t.compareDocumentPosition?!!(t.compareDocumentPosition(i)&16):!1:!1}function dl(){for(var t=window,i=Xe();i instanceof t.HTMLIFrameElement;){try{var c=typeof i.contentWindow.location.href=="string"}catch{c=!1}if(c)t=i.contentWindow;else break;i=Xe(t.document)}return i}function ei(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i&&(i==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||i==="textarea"||t.contentEditable==="true")}function fl(t){var i=dl(),c=t.focusedElem,d=t.selectionRange;if(i!==c&&c&&c.ownerDocument&&md(c.ownerDocument.documentElement,c)){if(d!==null&&ei(c)){if(i=d.start,t=d.end,t===void 0&&(t=i),"selectionStart"in c)c.selectionStart=i,c.selectionEnd=Math.min(t,c.value.length);else if(t=(i=c.ownerDocument||document)&&i.defaultView||window,t.getSelection){t=t.getSelection();var m=c.textContent.length,w=Math.min(d.start,m);d=d.end===void 0?w:Math.min(d.end,m),!t.extend&&w>d&&(m=d,d=w,w=m),m=qs(c,w);var O=qs(c,d);m&&O&&(t.rangeCount!==1||t.anchorNode!==m.node||t.anchorOffset!==m.offset||t.focusNode!==O.node||t.focusOffset!==O.offset)&&(i=i.createRange(),i.setStart(m.node,m.offset),t.removeAllRanges(),w>d?(t.addRange(i),t.extend(O.node,O.offset)):(i.setEnd(O.node,O.offset),t.addRange(i)))}}for(i=[],t=c;t=t.parentNode;)t.nodeType===1&&i.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<i.length;c++)t=i[c],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var Sp=y&&"documentMode"in document&&11>=document.documentMode,ns=null,Ha=null,Yo=null,hl=!1;function vd(t,i,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;hl||ns==null||ns!==Xe(d)||(d=ns,"selectionStart"in d&&ei(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Yo&&Ko(Yo,d)||(Yo=d,d=Ws(Ha,"onSelect"),0<d.length&&(i=new Kc("onSelect","select",null,i,c),t.push({event:i,listeners:d}),i.target=ns)))}function rs(t,i){var c={};return c[t.toLowerCase()]=i.toLowerCase(),c["Webkit"+t]="webkit"+i,c["Moz"+t]="moz"+i,c}var qn={animationend:rs("Animation","AnimationEnd"),animationiteration:rs("Animation","AnimationIteration"),animationstart:rs("Animation","AnimationStart"),transitionend:rs("Transition","TransitionEnd")},pl={},yd={};y&&(yd=document.createElement("div").style,"AnimationEvent"in window||(delete qn.animationend.animation,delete qn.animationiteration.animation,delete qn.animationstart.animation),"TransitionEvent"in window||delete qn.transitionend.transition);function xr(t){if(pl[t])return pl[t];if(!qn[t])return t;var i=qn[t],c;for(c in i)if(i.hasOwnProperty(c)&&c in yd)return pl[t]=i[c];return t}var _d=xr("animationend"),wd=xr("animationiteration"),bd=xr("animationstart"),is=xr("transitionend"),dn=new Map,Sd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Lr(t,i){dn.set(t,i),f(i,[t])}for(var ss=0;ss<Sd.length;ss++){var Ga=Sd[ss],gl=Ga.toLowerCase(),kp=Ga[0].toUpperCase()+Ga.slice(1);Lr(gl,"on"+kp)}Lr(_d,"onAnimationEnd"),Lr(wd,"onAnimationIteration"),Lr(bd,"onAnimationStart"),Lr("dblclick","onDoubleClick"),Lr("focusin","onFocus"),Lr("focusout","onBlur"),Lr(is,"onTransitionEnd"),h("onMouseEnter",["mouseout","mouseover"]),h("onMouseLeave",["mouseout","mouseover"]),h("onPointerEnter",["pointerout","pointerover"]),h("onPointerLeave",["pointerout","pointerover"]),f("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),f("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),f("onBeforeInput",["compositionend","keypress","textInput","paste"]),f("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),f("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),f("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var os="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Cp=new Set("cancel close invalid load scroll toggle".split(" ").concat(os));function kd(t,i,c){var d=t.type||"unknown-event";t.currentTarget=c,Ts(d,i,void 0,t),t.currentTarget=null}function ml(t,i){i=(i&4)!==0;for(var c=0;c<t.length;c++){var d=t[c],m=d.event;d=d.listeners;e:{var w=void 0;if(i)for(var O=d.length-1;0<=O;O--){var F=d[O],W=F.instance,ie=F.currentTarget;if(F=F.listener,W!==w&&m.isPropagationStopped())break e;kd(m,F,ie),w=W}else for(O=0;O<d.length;O++){if(F=d[O],W=F.instance,ie=F.currentTarget,F=F.listener,W!==w&&m.isPropagationStopped())break e;kd(m,F,ie),w=W}}}if(tn)throw t=Do,tn=!1,Do=null,t}function kt(t,i){var c=i[Js];c===void 0&&(c=i[Js]=new Set);var d=t+"__bubble";c.has(d)||(Cd(i,t,2,!1),c.add(d))}function vl(t,i,c){var d=0;i&&(d|=4),Cd(c,t,d,i)}var Xo="_reactListening"+Math.random().toString(36).slice(2);function Zo(t){if(!t[Xo]){t[Xo]=!0,a.forEach(function(c){c!=="selectionchange"&&(Cp.has(c)||vl(c,!1,t),vl(c,!0,t))});var i=t.nodeType===9?t:t.ownerDocument;i===null||i[Xo]||(i[Xo]=!0,vl("selectionchange",!1,i))}}function Cd(t,i,c,d){switch($t(i)){case 1:var m=ce;break;case 4:m=je;break;default:m=Pt}c=m.bind(null,i,c,t),m=void 0,!Es||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(m=!0),d?m!==void 0?t.addEventListener(i,c,{capture:!0,passive:m}):t.addEventListener(i,c,!0):m!==void 0?t.addEventListener(i,c,{passive:m}):t.addEventListener(i,c,!1)}function yl(t,i,c,d,m){var w=d;if((i&1)===0&&(i&2)===0&&d!==null)e:for(;;){if(d===null)return;var O=d.tag;if(O===3||O===4){var F=d.stateNode.containerInfo;if(F===m||F.nodeType===8&&F.parentNode===m)break;if(O===4)for(O=d.return;O!==null;){var W=O.tag;if((W===3||W===4)&&(W=O.stateNode.containerInfo,W===m||W.nodeType===8&&W.parentNode===m))return;O=O.return}for(;F!==null;){if(O=nn(F),O===null)return;if(W=O.tag,W===5||W===6){d=w=O;continue e}F=F.parentNode}}d=d.return}Cs(function(){var ie=w,be=wi(c),Se=[];e:{var ye=dn.get(t);if(ye!==void 0){var Ie=Kc,Le=t;switch(t){case"keypress":if(Ir(c)===0)break e;case"keydown":case"keyup":Ie=dp;break;case"focusin":Le="focus",Ie=qa;break;case"focusout":Le="blur",Ie=qa;break;case"beforeblur":case"afterblur":Ie=qa;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ie=Ds;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ie=ip;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ie=pp;break;case _d:case wd:case bd:Ie=ap;break;case is:Ie=ld;break;case"scroll":Ie=rd;break;case"wheel":Ie=ud;break;case"copy":case"cut":case"paste":Ie=cp;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ie=cd}var Ne=(i&4)!==0,Ft=!Ne&&t==="scroll",ee=Ne?ye!==null?ye+"Capture":null:ye;Ne=[];for(var H=ie,te;H!==null;){te=H;var Me=te.stateNode;if(te.tag===5&&Me!==null&&(te=Me,ee!==null&&(Me=Cn(H,ee),Me!=null&&Ne.push(ea(H,Me,te)))),Ft)break;H=H.return}0<Ne.length&&(ye=new Ie(ye,Le,null,c,be),Se.push({event:ye,listeners:Ne}))}}if((i&7)===0){e:{if(ye=t==="mouseover"||t==="pointerover",Ie=t==="mouseout"||t==="pointerout",ye&&c!==Yn&&(Le=c.relatedTarget||c.fromElement)&&(nn(Le)||Le[vr]))break e;if((Ie||ye)&&(ye=be.window===be?be:(ye=be.ownerDocument)?ye.defaultView||ye.parentWindow:window,Ie?(Le=c.relatedTarget||c.toElement,Ie=ie,Le=Le?nn(Le):null,Le!==null&&(Ft=Rr(Le),Le!==Ft||Le.tag!==5&&Le.tag!==6)&&(Le=null)):(Ie=null,Le=ie),Ie!==Le)){if(Ne=Ds,Me="onMouseLeave",ee="onMouseEnter",H="mouse",(t==="pointerout"||t==="pointerover")&&(Ne=cd,Me="onPointerLeave",ee="onPointerEnter",H="pointer"),Ft=Ie==null?ye:Qs(Ie),te=Le==null?ye:Qs(Le),ye=new Ne(Me,H+"leave",Ie,c,be),ye.target=Ft,ye.relatedTarget=te,Me=null,nn(be)===ie&&(Ne=new Ne(ee,H+"enter",Le,c,be),Ne.target=te,Ne.relatedTarget=Ft,Me=Ne),Ft=Me,Ie&&Le)t:{for(Ne=Ie,ee=Le,H=0,te=Ne;te;te=Hs(te))H++;for(te=0,Me=ee;Me;Me=Hs(Me))te++;for(;0<H-te;)Ne=Hs(Ne),H--;for(;0<te-H;)ee=Hs(ee),te--;for(;H--;){if(Ne===ee||ee!==null&&Ne===ee.alternate)break t;Ne=Hs(Ne),ee=Hs(ee)}Ne=null}else Ne=null;Ie!==null&&Ja(Se,ye,Ie,Ne,!1),Le!==null&&Ft!==null&&Ja(Se,Ft,Le,Ne,!0)}}e:{if(ye=ie?Qs(ie):window,Ie=ye.nodeName&&ye.nodeName.toLowerCase(),Ie==="select"||Ie==="input"&&ye.type==="file")var Ue=_p;else if(il(ye))if(Jo)Ue=ll;else{Ue=wp;var ze=cl}else(Ie=ye.nodeName)&&Ie.toLowerCase()==="input"&&(ye.type==="checkbox"||ye.type==="radio")&&(Ue=bp);if(Ue&&(Ue=Ue(t,ie))){sl(Se,Ue,c,be);break e}ze&&ze(t,ye,ie),t==="focusout"&&(ze=ye._wrapperState)&&ze.controlled&&ye.type==="number"&&en(ye,"number",ye.value)}switch(ze=ie?Qs(ie):window,t){case"focusin":(il(ze)||ze.contentEditable==="true")&&(ns=ze,Ha=ie,Yo=null);break;case"focusout":Yo=Ha=ns=null;break;case"mousedown":hl=!0;break;case"contextmenu":case"mouseup":case"dragend":hl=!1,vd(Se,c,be);break;case"selectionchange":if(Sp)break;case"keydown":case"keyup":vd(Se,c,be)}var Ve;if(el)e:{switch(t){case"compositionstart":var Je="onCompositionStart";break e;case"compositionend":Je="onCompositionEnd";break e;case"compositionupdate":Je="onCompositionUpdate";break e}Je=void 0}else Bs?fd(t,c)&&(Je="onCompositionEnd"):t==="keydown"&&c.keyCode===229&&(Je="onCompositionStart");Je&&(tl&&c.locale!=="ko"&&(Bs||Je!=="onCompositionStart"?Je==="onCompositionEnd"&&Bs&&(Ve=Wo()):(gr=be,Bt="value"in gr?gr.value:gr.textContent,Bs=!0)),ze=Ws(ie,Je),0<ze.length&&(Je=new sd(Je,t,null,c,be),Se.push({event:Je,listeners:ze}),Ve?Je.data=Ve:(Ve=hd(c),Ve!==null&&(Je.data=Ve)))),(Ve=dd?pd(t,c):Fs(t,c))&&(ie=Ws(ie,"onBeforeInput"),0<ie.length&&(be=new sd("onBeforeInput","beforeinput",null,c,be),Se.push({event:be,listeners:ie}),be.data=Ve))}ml(Se,i)})}function ea(t,i,c){return{instance:t,listener:i,currentTarget:c}}function Ws(t,i){for(var c=i+"Capture",d=[];t!==null;){var m=t,w=m.stateNode;m.tag===5&&w!==null&&(m=w,w=Cn(t,c),w!=null&&d.unshift(ea(t,w,m)),w=Cn(t,i),w!=null&&d.push(ea(t,w,m))),t=t.return}return d}function Hs(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ja(t,i,c,d,m){for(var w=i._reactName,O=[];c!==null&&c!==d;){var F=c,W=F.alternate,ie=F.stateNode;if(W!==null&&W===d)break;F.tag===5&&ie!==null&&(F=ie,m?(W=Cn(c,w),W!=null&&O.unshift(ea(c,W,F))):m||(W=Cn(c,w),W!=null&&O.push(ea(c,W,F)))),c=c.return}O.length!==0&&t.push({event:i,listeners:O})}var Ep=/\r\n?/g,Mp=/\u0000|\uFFFD/g;function Ed(t){return(typeof t=="string"?t:""+t).replace(Ep,`
`).replace(Mp,"")}function Qa(t,i,c){if(i=Ed(i),Ed(t)!==i&&c)throw Error(r(425))}function Ka(){}var _l=null,Ya=null;function wl(t,i){return t==="textarea"||t==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Mn=typeof setTimeout=="function"?setTimeout:void 0,bl=typeof clearTimeout=="function"?clearTimeout:void 0,Xa=typeof Promise=="function"?Promise:void 0,ta=typeof queueMicrotask=="function"?queueMicrotask:typeof Xa<"u"?function(t){return Xa.resolve(null).then(t).catch(Sl)}:Mn;function Sl(t){setTimeout(function(){throw t})}function Za(t,i){var c=i,d=0;do{var m=c.nextSibling;if(t.removeChild(c),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(d===0){t.removeChild(m),Zi(i);return}d--}else c!=="$"&&c!=="$?"&&c!=="$!"||d++;c=m}while(c);Zi(i)}function ti(t){for(;t!=null;t=t.nextSibling){var i=t.nodeType;if(i===1||i===3)break;if(i===8){if(i=t.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return t}function Gs(t){t=t.previousSibling;for(var i=0;t;){if(t.nodeType===8){var c=t.data;if(c==="$"||c==="$!"||c==="$?"){if(i===0)return t;i--}else c==="/$"&&i++}t=t.previousSibling}return null}var as=Math.random().toString(36).slice(2),Tn="__reactFiber$"+as,ni="__reactProps$"+as,vr="__reactContainer$"+as,Js="__reactEvents$"+as,Tp="__reactListeners$"+as,kl="__reactHandles$"+as;function nn(t){var i=t[Tn];if(i)return i;for(var c=t.parentNode;c;){if(i=c[vr]||c[Tn]){if(c=i.alternate,i.child!==null||c!==null&&c.child!==null)for(t=Gs(t);t!==null;){if(c=t[Tn])return c;t=Gs(t)}return i}t=c,c=t.parentNode}return null}function xi(t){return t=t[Tn]||t[vr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Qs(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(r(33))}function ec(t){return t[ni]||null}var tc=[],Ks=-1;function ri(t){return{current:t}}function ct(t){0>Ks||(t.current=tc[Ks],tc[Ks]=null,Ks--)}function vt(t,i){Ks++,tc[Ks]=t.current,t.current=i}var tr={},Kt=ri(tr),fn=ri(!1),nr=tr;function yr(t,i){var c=t.type.contextTypes;if(!c)return tr;var d=t.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===i)return d.__reactInternalMemoizedMaskedChildContext;var m={},w;for(w in c)m[w]=i[w];return d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=m),m}function On(t){return t=t.childContextTypes,t!=null}function na(){ct(fn),ct(Kt)}function It(t,i,c){if(Kt.current!==tr)throw Error(r(168));vt(Kt,i),vt(fn,c)}function Md(t,i,c){var d=t.stateNode;if(i=i.childContextTypes,typeof d.getChildContext!="function")return c;d=d.getChildContext();for(var m in d)if(!(m in i))throw Error(r(108,z(t)||"Unknown",m));return oe({},c,d)}function nc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||tr,nr=Kt.current,vt(Kt,t),vt(fn,fn.current),!0}function Td(t,i,c){var d=t.stateNode;if(!d)throw Error(r(169));c?(t=Md(t,i,nr),d.__reactInternalMemoizedMergedChildContext=t,ct(fn),ct(Kt),vt(Kt,t)):ct(fn),vt(fn,c)}var ii=null,rc=!1,Cl=!1;function El(t){ii===null?ii=[t]:ii.push(t)}function Op(t){rc=!0,El(t)}function jr(){if(!Cl&&ii!==null){Cl=!0;var t=0,i=Ce;try{var c=ii;for(Ce=1;t<c.length;t++){var d=c[t];do d=d(!0);while(d!==null)}ii=null,rc=!1}catch(m){throw ii!==null&&(ii=ii.slice(t+1)),Ua(ki,jr),m}finally{Ce=i,Cl=!1}}return null}var Ys=[],Xs=0,ic=null,sc=0,rr=[],ir=0,Li=null,si=1,oi="";function cs(t,i){Ys[Xs++]=sc,Ys[Xs++]=ic,ic=t,sc=i}function Od(t,i,c){rr[ir++]=si,rr[ir++]=oi,rr[ir++]=Li,Li=t;var d=si;t=oi;var m=32-Bn(d)-1;d&=~(1<<m),c+=1;var w=32-Bn(i)+m;if(30<w){var O=m-m%5;w=(d&(1<<O)-1).toString(32),d>>=O,m-=O,si=1<<32-Bn(i)+m|c<<m|d,oi=w+t}else si=1<<w|c<<m|d,oi=t}function oc(t){t.return!==null&&(cs(t,1),Od(t,1,0))}function ac(t){for(;t===ic;)ic=Ys[--Xs],Ys[Xs]=null,sc=Ys[--Xs],Ys[Xs]=null;for(;t===Li;)Li=rr[--ir],rr[ir]=null,oi=rr[--ir],rr[ir]=null,si=rr[--ir],rr[ir]=null}var Wn=null,Hn=null,Mt=!1,_r=null;function Rd(t,i){var c=Br(5,null,null,0);c.elementType="DELETED",c.stateNode=i,c.return=t,i=t.deletions,i===null?(t.deletions=[c],t.flags|=16):i.push(c)}function Ad(t,i){switch(t.tag){case 5:var c=t.type;return i=i.nodeType!==1||c.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(t.stateNode=i,Wn=t,Hn=ti(i.firstChild),!0):!1;case 6:return i=t.pendingProps===""||i.nodeType!==3?null:i,i!==null?(t.stateNode=i,Wn=t,Hn=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(c=Li!==null?{id:si,overflow:oi}:null,t.memoizedState={dehydrated:i,treeContext:c,retryLane:1073741824},c=Br(18,null,null,0),c.stateNode=i,c.return=t,t.child=c,Wn=t,Hn=null,!0):!1;default:return!1}}function Ml(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Tl(t){if(Mt){var i=Hn;if(i){var c=i;if(!Ad(t,i)){if(Ml(t))throw Error(r(418));i=ti(c.nextSibling);var d=Wn;i&&Ad(t,i)?Rd(d,c):(t.flags=t.flags&-4097|2,Mt=!1,Wn=t)}}else{if(Ml(t))throw Error(r(418));t.flags=t.flags&-4097|2,Mt=!1,Wn=t}}}function Zs(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;Wn=t}function ra(t){if(t!==Wn)return!1;if(!Mt)return Zs(t),Mt=!0,!1;var i;if((i=t.tag!==3)&&!(i=t.tag!==5)&&(i=t.type,i=i!=="head"&&i!=="body"&&!wl(t.type,t.memoizedProps)),i&&(i=Hn)){if(Ml(t))throw cc(),Error(r(418));for(;i;)Rd(t,i),i=ti(i.nextSibling)}if(Zs(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(r(317));e:{for(t=t.nextSibling,i=0;t;){if(t.nodeType===8){var c=t.data;if(c==="/$"){if(i===0){Hn=ti(t.nextSibling);break e}i--}else c!=="$"&&c!=="$!"&&c!=="$?"||i++}t=t.nextSibling}Hn=null}}else Hn=Wn?ti(t.stateNode.nextSibling):null;return!0}function cc(){for(var t=Hn;t;)t=ti(t.nextSibling)}function eo(){Hn=Wn=null,Mt=!1}function ia(t){_r===null?_r=[t]:_r.push(t)}var Pd=x.ReactCurrentBatchConfig;function sa(t,i,c){if(t=c.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(r(309));var d=c.stateNode}if(!d)throw Error(r(147,t));var m=d,w=""+t;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===w?i.ref:(i=function(O){var F=m.refs;O===null?delete F[w]:F[w]=O},i._stringRef=w,i)}if(typeof t!="string")throw Error(r(284));if(!c._owner)throw Error(r(290,t))}return t}function lc(t,i){throw t=Object.prototype.toString.call(i),Error(r(31,t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t))}function Id(t){var i=t._init;return i(t._payload)}function xd(t){function i(ee,H){if(t){var te=ee.deletions;te===null?(ee.deletions=[H],ee.flags|=16):te.push(H)}}function c(ee,H){if(!t)return null;for(;H!==null;)i(ee,H),H=H.sibling;return null}function d(ee,H){for(ee=new Map;H!==null;)H.key!==null?ee.set(H.key,H):ee.set(H.index,H),H=H.sibling;return ee}function m(ee,H){return ee=co(ee,H),ee.index=0,ee.sibling=null,ee}function w(ee,H,te){return ee.index=te,t?(te=ee.alternate,te!==null?(te=te.index,te<H?(ee.flags|=2,H):te):(ee.flags|=2,H)):(ee.flags|=1048576,H)}function O(ee){return t&&ee.alternate===null&&(ee.flags|=2),ee}function F(ee,H,te,Me){return H===null||H.tag!==6?(H=cg(te,ee.mode,Me),H.return=ee,H):(H=m(H,te),H.return=ee,H)}function W(ee,H,te,Me){var Ue=te.type;return Ue===re?be(ee,H,te.props.children,Me,te.key):H!==null&&(H.elementType===Ue||typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===et&&Id(Ue)===H.type)?(Me=m(H,te.props),Me.ref=sa(ee,H,te),Me.return=ee,Me):(Me=Zd(te.type,te.key,te.props,null,ee.mode,Me),Me.ref=sa(ee,H,te),Me.return=ee,Me)}function ie(ee,H,te,Me){return H===null||H.tag!==4||H.stateNode.containerInfo!==te.containerInfo||H.stateNode.implementation!==te.implementation?(H=lg(te,ee.mode,Me),H.return=ee,H):(H=m(H,te.children||[]),H.return=ee,H)}function be(ee,H,te,Me,Ue){return H===null||H.tag!==7?(H=fa(te,ee.mode,Me,Ue),H.return=ee,H):(H=m(H,te),H.return=ee,H)}function Se(ee,H,te){if(typeof H=="string"&&H!==""||typeof H=="number")return H=cg(""+H,ee.mode,te),H.return=ee,H;if(typeof H=="object"&&H!==null){switch(H.$$typeof){case $:return te=Zd(H.type,H.key,H.props,null,ee.mode,te),te.ref=sa(ee,null,H),te.return=ee,te;case q:return H=lg(H,ee.mode,te),H.return=ee,H;case et:var Me=H._init;return Se(ee,Me(H._payload),te)}if(Vt(H)||Oe(H))return H=fa(H,ee.mode,te,null),H.return=ee,H;lc(ee,H)}return null}function ye(ee,H,te,Me){var Ue=H!==null?H.key:null;if(typeof te=="string"&&te!==""||typeof te=="number")return Ue!==null?null:F(ee,H,""+te,Me);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case $:return te.key===Ue?W(ee,H,te,Me):null;case q:return te.key===Ue?ie(ee,H,te,Me):null;case et:return Ue=te._init,ye(ee,H,Ue(te._payload),Me)}if(Vt(te)||Oe(te))return Ue!==null?null:be(ee,H,te,Me,null);lc(ee,te)}return null}function Ie(ee,H,te,Me,Ue){if(typeof Me=="string"&&Me!==""||typeof Me=="number")return ee=ee.get(te)||null,F(H,ee,""+Me,Ue);if(typeof Me=="object"&&Me!==null){switch(Me.$$typeof){case $:return ee=ee.get(Me.key===null?te:Me.key)||null,W(H,ee,Me,Ue);case q:return ee=ee.get(Me.key===null?te:Me.key)||null,ie(H,ee,Me,Ue);case et:var ze=Me._init;return Ie(ee,H,te,ze(Me._payload),Ue)}if(Vt(Me)||Oe(Me))return ee=ee.get(te)||null,be(H,ee,Me,Ue,null);lc(H,Me)}return null}function Le(ee,H,te,Me){for(var Ue=null,ze=null,Ve=H,Je=H=0,on=null;Ve!==null&&Je<te.length;Je++){Ve.index>Je?(on=Ve,Ve=null):on=Ve.sibling;var ht=ye(ee,Ve,te[Je],Me);if(ht===null){Ve===null&&(Ve=on);break}t&&Ve&&ht.alternate===null&&i(ee,Ve),H=w(ht,H,Je),ze===null?Ue=ht:ze.sibling=ht,ze=ht,Ve=on}if(Je===te.length)return c(ee,Ve),Mt&&cs(ee,Je),Ue;if(Ve===null){for(;Je<te.length;Je++)Ve=Se(ee,te[Je],Me),Ve!==null&&(H=w(Ve,H,Je),ze===null?Ue=Ve:ze.sibling=Ve,ze=Ve);return Mt&&cs(ee,Je),Ue}for(Ve=d(ee,Ve);Je<te.length;Je++)on=Ie(Ve,ee,Je,te[Je],Me),on!==null&&(t&&on.alternate!==null&&Ve.delete(on.key===null?Je:on.key),H=w(on,H,Je),ze===null?Ue=on:ze.sibling=on,ze=on);return t&&Ve.forEach(function(lo){return i(ee,lo)}),Mt&&cs(ee,Je),Ue}function Ne(ee,H,te,Me){var Ue=Oe(te);if(typeof Ue!="function")throw Error(r(150));if(te=Ue.call(te),te==null)throw Error(r(151));for(var ze=Ue=null,Ve=H,Je=H=0,on=null,ht=te.next();Ve!==null&&!ht.done;Je++,ht=te.next()){Ve.index>Je?(on=Ve,Ve=null):on=Ve.sibling;var lo=ye(ee,Ve,ht.value,Me);if(lo===null){Ve===null&&(Ve=on);break}t&&Ve&&lo.alternate===null&&i(ee,Ve),H=w(lo,H,Je),ze===null?Ue=lo:ze.sibling=lo,ze=lo,Ve=on}if(ht.done)return c(ee,Ve),Mt&&cs(ee,Je),Ue;if(Ve===null){for(;!ht.done;Je++,ht=te.next())ht=Se(ee,ht.value,Me),ht!==null&&(H=w(ht,H,Je),ze===null?Ue=ht:ze.sibling=ht,ze=ht);return Mt&&cs(ee,Je),Ue}for(Ve=d(ee,Ve);!ht.done;Je++,ht=te.next())ht=Ie(Ve,ee,Je,ht.value,Me),ht!==null&&(t&&ht.alternate!==null&&Ve.delete(ht.key===null?Je:ht.key),H=w(ht,H,Je),ze===null?Ue=ht:ze.sibling=ht,ze=ht);return t&&Ve.forEach(function(TE){return i(ee,TE)}),Mt&&cs(ee,Je),Ue}function Ft(ee,H,te,Me){if(typeof te=="object"&&te!==null&&te.type===re&&te.key===null&&(te=te.props.children),typeof te=="object"&&te!==null){switch(te.$$typeof){case $:e:{for(var Ue=te.key,ze=H;ze!==null;){if(ze.key===Ue){if(Ue=te.type,Ue===re){if(ze.tag===7){c(ee,ze.sibling),H=m(ze,te.props.children),H.return=ee,ee=H;break e}}else if(ze.elementType===Ue||typeof Ue=="object"&&Ue!==null&&Ue.$$typeof===et&&Id(Ue)===ze.type){c(ee,ze.sibling),H=m(ze,te.props),H.ref=sa(ee,ze,te),H.return=ee,ee=H;break e}c(ee,ze);break}else i(ee,ze);ze=ze.sibling}te.type===re?(H=fa(te.props.children,ee.mode,Me,te.key),H.return=ee,ee=H):(Me=Zd(te.type,te.key,te.props,null,ee.mode,Me),Me.ref=sa(ee,H,te),Me.return=ee,ee=Me)}return O(ee);case q:e:{for(ze=te.key;H!==null;){if(H.key===ze)if(H.tag===4&&H.stateNode.containerInfo===te.containerInfo&&H.stateNode.implementation===te.implementation){c(ee,H.sibling),H=m(H,te.children||[]),H.return=ee,ee=H;break e}else{c(ee,H);break}else i(ee,H);H=H.sibling}H=lg(te,ee.mode,Me),H.return=ee,ee=H}return O(ee);case et:return ze=te._init,Ft(ee,H,ze(te._payload),Me)}if(Vt(te))return Le(ee,H,te,Me);if(Oe(te))return Ne(ee,H,te,Me);lc(ee,te)}return typeof te=="string"&&te!==""||typeof te=="number"?(te=""+te,H!==null&&H.tag===6?(c(ee,H.sibling),H=m(H,te),H.return=ee,ee=H):(c(ee,H),H=cg(te,ee.mode,Me),H.return=ee,ee=H),O(ee)):c(ee,H)}return Ft}var to=xd(!0),Ld=xd(!1),oa=ri(null),ji=null,Nr=null,aa=null;function Ol(){aa=Nr=ji=null}function Rl(t){var i=oa.current;ct(oa),t._currentValue=i}function Al(t,i,c){for(;t!==null;){var d=t.alternate;if((t.childLanes&i)!==i?(t.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),t===c)break;t=t.return}}function no(t,i){ji=t,aa=Nr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&i)!==0&&(or=!0),t.firstContext=null)}function sr(t){var i=t._currentValue;if(aa!==t)if(t={context:t,memoizedValue:i,next:null},Nr===null){if(ji===null)throw Error(r(308));Nr=t,ji.dependencies={lanes:0,firstContext:t}}else Nr=Nr.next=t;return i}var Ni=null;function Pl(t){Ni===null?Ni=[t]:Ni.push(t)}function jd(t,i,c,d){var m=i.interleaved;return m===null?(c.next=c,Pl(i)):(c.next=m.next,m.next=c),i.interleaved=c,s(t,d)}function s(t,i){t.lanes|=i;var c=t.alternate;for(c!==null&&(c.lanes|=i),c=t,t=t.return;t!==null;)t.childLanes|=i,c=t.alternate,c!==null&&(c.childLanes|=i),c=t,t=t.return;return c.tag===3?c.stateNode:null}var o=!1;function u(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function p(t,i){t=t.updateQueue,i.updateQueue===t&&(i.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function _(t,i){return{eventTime:t,lane:i,tag:0,payload:null,callback:null,next:null}}function k(t,i,c){var d=t.updateQueue;if(d===null)return null;if(d=d.shared,(dt&2)!==0){var m=d.pending;return m===null?i.next=i:(i.next=m.next,m.next=i),d.pending=i,s(t,c)}return m=d.interleaved,m===null?(i.next=i,Pl(d)):(i.next=m.next,m.next=i),d.interleaved=i,s(t,c)}function I(t,i,c){if(i=i.updateQueue,i!==null&&(i=i.shared,(c&4194240)!==0)){var d=i.lanes;d&=t.pendingLanes,c|=d,i.lanes=c,St(t,c)}}function B(t,i){var c=t.updateQueue,d=t.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var m=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var O={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};w===null?m=w=O:w=w.next=O,c=c.next}while(c!==null);w===null?m=w=i:w=w.next=i}else m=w=i;c={baseState:d.baseState,firstBaseUpdate:m,lastBaseUpdate:w,shared:d.shared,effects:d.effects},t.updateQueue=c;return}t=c.lastBaseUpdate,t===null?c.firstBaseUpdate=i:t.next=i,c.lastBaseUpdate=i}function Z(t,i,c,d){var m=t.updateQueue;o=!1;var w=m.firstBaseUpdate,O=m.lastBaseUpdate,F=m.shared.pending;if(F!==null){m.shared.pending=null;var W=F,ie=W.next;W.next=null,O===null?w=ie:O.next=ie,O=W;var be=t.alternate;be!==null&&(be=be.updateQueue,F=be.lastBaseUpdate,F!==O&&(F===null?be.firstBaseUpdate=ie:F.next=ie,be.lastBaseUpdate=W))}if(w!==null){var Se=m.baseState;O=0,be=ie=W=null,F=w;do{var ye=F.lane,Ie=F.eventTime;if((d&ye)===ye){be!==null&&(be=be.next={eventTime:Ie,lane:0,tag:F.tag,payload:F.payload,callback:F.callback,next:null});e:{var Le=t,Ne=F;switch(ye=i,Ie=c,Ne.tag){case 1:if(Le=Ne.payload,typeof Le=="function"){Se=Le.call(Ie,Se,ye);break e}Se=Le;break e;case 3:Le.flags=Le.flags&-65537|128;case 0:if(Le=Ne.payload,ye=typeof Le=="function"?Le.call(Ie,Se,ye):Le,ye==null)break e;Se=oe({},Se,ye);break e;case 2:o=!0}}F.callback!==null&&F.lane!==0&&(t.flags|=64,ye=m.effects,ye===null?m.effects=[F]:ye.push(F))}else Ie={eventTime:Ie,lane:ye,tag:F.tag,payload:F.payload,callback:F.callback,next:null},be===null?(ie=be=Ie,W=Se):be=be.next=Ie,O|=ye;if(F=F.next,F===null){if(F=m.shared.pending,F===null)break;ye=F,F=ye.next,ye.next=null,m.lastBaseUpdate=ye,m.shared.pending=null}}while(!0);if(be===null&&(W=Se),m.baseState=W,m.firstBaseUpdate=ie,m.lastBaseUpdate=be,i=m.shared.interleaved,i!==null){m=i;do O|=m.lane,m=m.next;while(m!==i)}else w===null&&(m.shared.lanes=0);ca|=O,t.lanes=O,t.memoizedState=Se}}function Y(t,i,c){if(t=i.effects,i.effects=null,t!==null)for(i=0;i<t.length;i++){var d=t[i],m=d.callback;if(m!==null){if(d.callback=null,d=c,typeof m!="function")throw Error(r(191,m));m.call(d)}}}var he={},de=ri(he),Ee=ri(he),fe=ri(he);function Ae(t){if(t===he)throw Error(r(174));return t}function Pe(t,i){switch(vt(fe,i),vt(Ee,t),vt(de,he),t=i.nodeType,t){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Nt(null,"");break;default:t=t===8?i.parentNode:i,i=t.namespaceURI||null,t=t.tagName,i=Nt(i,t)}ct(de),vt(de,i)}function Fe(){ct(de),ct(Ee),ct(fe)}function lt(t){Ae(fe.current);var i=Ae(de.current),c=Nt(i,t.type);i!==c&&(vt(Ee,t),vt(de,c))}function ft(t){Ee.current===t&&(ct(de),ct(Ee))}var We=ri(0);function He(t){for(var i=t;i!==null;){if(i.tag===13){var c=i.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var hn=[];function qt(){for(var t=0;t<hn.length;t++)hn[t]._workInProgressVersionPrimary=null;hn.length=0}var Di=x.ReactCurrentDispatcher,Ui=x.ReactCurrentBatchConfig,ai=0,xt=null,Yt=null,rn=null,Nd=!1,Il=!1,xl=0,Q1=0;function Rn(){throw Error(r(321))}function Rp(t,i){if(i===null)return!1;for(var c=0;c<i.length&&c<t.length;c++)if(!mr(t[c],i[c]))return!1;return!0}function Ap(t,i,c,d,m,w){if(ai=w,xt=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Di.current=t===null||t.memoizedState===null?Z1:eE,t=c(d,m),Il){w=0;do{if(Il=!1,xl=0,25<=w)throw Error(r(301));w+=1,rn=Yt=null,i.updateQueue=null,Di.current=tE,t=c(d,m)}while(Il)}if(Di.current=Bd,i=Yt!==null&&Yt.next!==null,ai=0,rn=Yt=xt=null,Nd=!1,i)throw Error(r(300));return t}function Pp(){var t=xl!==0;return xl=0,t}function Bi(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rn===null?xt.memoizedState=rn=t:rn=rn.next=t,rn}function Dr(){if(Yt===null){var t=xt.alternate;t=t!==null?t.memoizedState:null}else t=Yt.next;var i=rn===null?xt.memoizedState:rn.next;if(i!==null)rn=i,Yt=t;else{if(t===null)throw Error(r(310));Yt=t,t={memoizedState:Yt.memoizedState,baseState:Yt.baseState,baseQueue:Yt.baseQueue,queue:Yt.queue,next:null},rn===null?xt.memoizedState=rn=t:rn=rn.next=t}return rn}function Ll(t,i){return typeof i=="function"?i(t):i}function Ip(t){var i=Dr(),c=i.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=t;var d=Yt,m=d.baseQueue,w=c.pending;if(w!==null){if(m!==null){var O=m.next;m.next=w.next,w.next=O}d.baseQueue=m=w,c.pending=null}if(m!==null){w=m.next,d=d.baseState;var F=O=null,W=null,ie=w;do{var be=ie.lane;if((ai&be)===be)W!==null&&(W=W.next={lane:0,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null}),d=ie.hasEagerState?ie.eagerState:t(d,ie.action);else{var Se={lane:be,action:ie.action,hasEagerState:ie.hasEagerState,eagerState:ie.eagerState,next:null};W===null?(F=W=Se,O=d):W=W.next=Se,xt.lanes|=be,ca|=be}ie=ie.next}while(ie!==null&&ie!==w);W===null?O=d:W.next=F,mr(d,i.memoizedState)||(or=!0),i.memoizedState=d,i.baseState=O,i.baseQueue=W,c.lastRenderedState=d}if(t=c.interleaved,t!==null){m=t;do w=m.lane,xt.lanes|=w,ca|=w,m=m.next;while(m!==t)}else m===null&&(c.lanes=0);return[i.memoizedState,c.dispatch]}function xp(t){var i=Dr(),c=i.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=t;var d=c.dispatch,m=c.pending,w=i.memoizedState;if(m!==null){c.pending=null;var O=m=m.next;do w=t(w,O.action),O=O.next;while(O!==m);mr(w,i.memoizedState)||(or=!0),i.memoizedState=w,i.baseQueue===null&&(i.baseState=w),c.lastRenderedState=w}return[w,d]}function U_(){}function B_(t,i){var c=xt,d=Dr(),m=i(),w=!mr(d.memoizedState,m);if(w&&(d.memoizedState=m,or=!0),d=d.queue,Lp(V_.bind(null,c,d,t),[t]),d.getSnapshot!==i||w||rn!==null&&rn.memoizedState.tag&1){if(c.flags|=2048,jl(9,z_.bind(null,c,d,m,i),void 0,null),sn===null)throw Error(r(349));(ai&30)!==0||F_(c,i,m)}return m}function F_(t,i,c){t.flags|=16384,t={getSnapshot:i,value:c},i=xt.updateQueue,i===null?(i={lastEffect:null,stores:null},xt.updateQueue=i,i.stores=[t]):(c=i.stores,c===null?i.stores=[t]:c.push(t))}function z_(t,i,c,d){i.value=c,i.getSnapshot=d,$_(i)&&q_(t)}function V_(t,i,c){return c(function(){$_(i)&&q_(t)})}function $_(t){var i=t.getSnapshot;t=t.value;try{var c=i();return!mr(t,c)}catch{return!0}}function q_(t){var i=s(t,1);i!==null&&di(i,t,1,-1)}function W_(t){var i=Bi();return typeof t=="function"&&(t=t()),i.memoizedState=i.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Ll,lastRenderedState:t},i.queue=t,t=t.dispatch=X1.bind(null,xt,t),[i.memoizedState,t]}function jl(t,i,c,d){return t={tag:t,create:i,destroy:c,deps:d,next:null},i=xt.updateQueue,i===null?(i={lastEffect:null,stores:null},xt.updateQueue=i,i.lastEffect=t.next=t):(c=i.lastEffect,c===null?i.lastEffect=t.next=t:(d=c.next,c.next=t,t.next=d,i.lastEffect=t)),t}function H_(){return Dr().memoizedState}function Dd(t,i,c,d){var m=Bi();xt.flags|=t,m.memoizedState=jl(1|i,c,void 0,d===void 0?null:d)}function Ud(t,i,c,d){var m=Dr();d=d===void 0?null:d;var w=void 0;if(Yt!==null){var O=Yt.memoizedState;if(w=O.destroy,d!==null&&Rp(d,O.deps)){m.memoizedState=jl(i,c,w,d);return}}xt.flags|=t,m.memoizedState=jl(1|i,c,w,d)}function G_(t,i){return Dd(8390656,8,t,i)}function Lp(t,i){return Ud(2048,8,t,i)}function J_(t,i){return Ud(4,2,t,i)}function Q_(t,i){return Ud(4,4,t,i)}function K_(t,i){if(typeof i=="function")return t=t(),i(t),function(){i(null)};if(i!=null)return t=t(),i.current=t,function(){i.current=null}}function Y_(t,i,c){return c=c!=null?c.concat([t]):null,Ud(4,4,K_.bind(null,i,t),c)}function jp(){}function X_(t,i){var c=Dr();i=i===void 0?null:i;var d=c.memoizedState;return d!==null&&i!==null&&Rp(i,d[1])?d[0]:(c.memoizedState=[t,i],t)}function Z_(t,i){var c=Dr();i=i===void 0?null:i;var d=c.memoizedState;return d!==null&&i!==null&&Rp(i,d[1])?d[0]:(t=t(),c.memoizedState=[t,i],t)}function e0(t,i,c){return(ai&21)===0?(t.baseState&&(t.baseState=!1,or=!0),t.memoizedState=c):(mr(c,i)||(c=Ps(),xt.lanes|=c,ca|=c,t.baseState=!0),i)}function K1(t,i){var c=Ce;Ce=c!==0&&4>c?c:4,t(!0);var d=Ui.transition;Ui.transition={};try{t(!1),i()}finally{Ce=c,Ui.transition=d}}function t0(){return Dr().memoizedState}function Y1(t,i,c){var d=oo(t);if(c={lane:d,action:c,hasEagerState:!1,eagerState:null,next:null},n0(t))r0(i,c);else if(c=jd(t,i,c,d),c!==null){var m=Jn();di(c,t,d,m),i0(c,i,d)}}function X1(t,i,c){var d=oo(t),m={lane:d,action:c,hasEagerState:!1,eagerState:null,next:null};if(n0(t))r0(i,m);else{var w=t.alternate;if(t.lanes===0&&(w===null||w.lanes===0)&&(w=i.lastRenderedReducer,w!==null))try{var O=i.lastRenderedState,F=w(O,c);if(m.hasEagerState=!0,m.eagerState=F,mr(F,O)){var W=i.interleaved;W===null?(m.next=m,Pl(i)):(m.next=W.next,W.next=m),i.interleaved=m;return}}catch{}finally{}c=jd(t,i,m,d),c!==null&&(m=Jn(),di(c,t,d,m),i0(c,i,d))}}function n0(t){var i=t.alternate;return t===xt||i!==null&&i===xt}function r0(t,i){Il=Nd=!0;var c=t.pending;c===null?i.next=i:(i.next=c.next,c.next=i),t.pending=i}function i0(t,i,c){if((c&4194240)!==0){var d=i.lanes;d&=t.pendingLanes,c|=d,i.lanes=c,St(t,c)}}var Bd={readContext:sr,useCallback:Rn,useContext:Rn,useEffect:Rn,useImperativeHandle:Rn,useInsertionEffect:Rn,useLayoutEffect:Rn,useMemo:Rn,useReducer:Rn,useRef:Rn,useState:Rn,useDebugValue:Rn,useDeferredValue:Rn,useTransition:Rn,useMutableSource:Rn,useSyncExternalStore:Rn,useId:Rn,unstable_isNewReconciler:!1},Z1={readContext:sr,useCallback:function(t,i){return Bi().memoizedState=[t,i===void 0?null:i],t},useContext:sr,useEffect:G_,useImperativeHandle:function(t,i,c){return c=c!=null?c.concat([t]):null,Dd(4194308,4,K_.bind(null,i,t),c)},useLayoutEffect:function(t,i){return Dd(4194308,4,t,i)},useInsertionEffect:function(t,i){return Dd(4,2,t,i)},useMemo:function(t,i){var c=Bi();return i=i===void 0?null:i,t=t(),c.memoizedState=[t,i],t},useReducer:function(t,i,c){var d=Bi();return i=c!==void 0?c(i):i,d.memoizedState=d.baseState=i,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},d.queue=t,t=t.dispatch=Y1.bind(null,xt,t),[d.memoizedState,t]},useRef:function(t){var i=Bi();return t={current:t},i.memoizedState=t},useState:W_,useDebugValue:jp,useDeferredValue:function(t){return Bi().memoizedState=t},useTransition:function(){var t=W_(!1),i=t[0];return t=K1.bind(null,t[1]),Bi().memoizedState=t,[i,t]},useMutableSource:function(){},useSyncExternalStore:function(t,i,c){var d=xt,m=Bi();if(Mt){if(c===void 0)throw Error(r(407));c=c()}else{if(c=i(),sn===null)throw Error(r(349));(ai&30)!==0||F_(d,i,c)}m.memoizedState=c;var w={value:c,getSnapshot:i};return m.queue=w,G_(V_.bind(null,d,w,t),[t]),d.flags|=2048,jl(9,z_.bind(null,d,w,c,i),void 0,null),c},useId:function(){var t=Bi(),i=sn.identifierPrefix;if(Mt){var c=oi,d=si;c=(d&~(1<<32-Bn(d)-1)).toString(32)+c,i=":"+i+"R"+c,c=xl++,0<c&&(i+="H"+c.toString(32)),i+=":"}else c=Q1++,i=":"+i+"r"+c.toString(32)+":";return t.memoizedState=i},unstable_isNewReconciler:!1},eE={readContext:sr,useCallback:X_,useContext:sr,useEffect:Lp,useImperativeHandle:Y_,useInsertionEffect:J_,useLayoutEffect:Q_,useMemo:Z_,useReducer:Ip,useRef:H_,useState:function(){return Ip(Ll)},useDebugValue:jp,useDeferredValue:function(t){var i=Dr();return e0(i,Yt.memoizedState,t)},useTransition:function(){var t=Ip(Ll)[0],i=Dr().memoizedState;return[t,i]},useMutableSource:U_,useSyncExternalStore:B_,useId:t0,unstable_isNewReconciler:!1},tE={readContext:sr,useCallback:X_,useContext:sr,useEffect:Lp,useImperativeHandle:Y_,useInsertionEffect:J_,useLayoutEffect:Q_,useMemo:Z_,useReducer:xp,useRef:H_,useState:function(){return xp(Ll)},useDebugValue:jp,useDeferredValue:function(t){var i=Dr();return Yt===null?i.memoizedState=t:e0(i,Yt.memoizedState,t)},useTransition:function(){var t=xp(Ll)[0],i=Dr().memoizedState;return[t,i]},useMutableSource:U_,useSyncExternalStore:B_,useId:t0,unstable_isNewReconciler:!1};function ci(t,i){if(t&&t.defaultProps){i=oe({},i),t=t.defaultProps;for(var c in t)i[c]===void 0&&(i[c]=t[c]);return i}return i}function Np(t,i,c,d){i=t.memoizedState,c=c(d,i),c=c==null?i:oe({},i,c),t.memoizedState=c,t.lanes===0&&(t.updateQueue.baseState=c)}var Fd={isMounted:function(t){return(t=t._reactInternals)?Rr(t)===t:!1},enqueueSetState:function(t,i,c){t=t._reactInternals;var d=Jn(),m=oo(t),w=_(d,m);w.payload=i,c!=null&&(w.callback=c),i=k(t,w,m),i!==null&&(di(i,t,m,d),I(i,t,m))},enqueueReplaceState:function(t,i,c){t=t._reactInternals;var d=Jn(),m=oo(t),w=_(d,m);w.tag=1,w.payload=i,c!=null&&(w.callback=c),i=k(t,w,m),i!==null&&(di(i,t,m,d),I(i,t,m))},enqueueForceUpdate:function(t,i){t=t._reactInternals;var c=Jn(),d=oo(t),m=_(c,d);m.tag=2,i!=null&&(m.callback=i),i=k(t,m,d),i!==null&&(di(i,t,d,c),I(i,t,d))}};function s0(t,i,c,d,m,w,O){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(d,w,O):i.prototype&&i.prototype.isPureReactComponent?!Ko(c,d)||!Ko(m,w):!0}function o0(t,i,c){var d=!1,m=tr,w=i.contextType;return typeof w=="object"&&w!==null?w=sr(w):(m=On(i)?nr:Kt.current,d=i.contextTypes,w=(d=d!=null)?yr(t,m):tr),i=new i(c,w),t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Fd,t.stateNode=i,i._reactInternals=t,d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=m,t.__reactInternalMemoizedMaskedChildContext=w),i}function a0(t,i,c,d){t=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(c,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(c,d),i.state!==t&&Fd.enqueueReplaceState(i,i.state,null)}function Dp(t,i,c,d){var m=t.stateNode;m.props=c,m.state=t.memoizedState,m.refs={},u(t);var w=i.contextType;typeof w=="object"&&w!==null?m.context=sr(w):(w=On(i)?nr:Kt.current,m.context=yr(t,w)),m.state=t.memoizedState,w=i.getDerivedStateFromProps,typeof w=="function"&&(Np(t,i,w,c),m.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(i=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),i!==m.state&&Fd.enqueueReplaceState(m,m.state,null),Z(t,c,m,d),m.state=t.memoizedState),typeof m.componentDidMount=="function"&&(t.flags|=4194308)}function uc(t,i){try{var c="",d=i;do c+=E(d),d=d.return;while(d);var m=c}catch(w){m=`
Error generating stack: `+w.message+`
`+w.stack}return{value:t,source:i,stack:m,digest:null}}function Up(t,i,c){return{value:t,source:null,stack:c??null,digest:i??null}}function Bp(t,i){try{console.error(i.value)}catch(c){setTimeout(function(){throw c})}}var nE=typeof WeakMap=="function"?WeakMap:Map;function c0(t,i,c){c=_(-1,c),c.tag=3,c.payload={element:null};var d=i.value;return c.callback=function(){Gd||(Gd=!0,eg=d),Bp(t,i)},c}function l0(t,i,c){c=_(-1,c),c.tag=3;var d=t.type.getDerivedStateFromError;if(typeof d=="function"){var m=i.value;c.payload=function(){return d(m)},c.callback=function(){Bp(t,i)}}var w=t.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(c.callback=function(){Bp(t,i),typeof d!="function"&&(io===null?io=new Set([this]):io.add(this));var O=i.stack;this.componentDidCatch(i.value,{componentStack:O!==null?O:""})}),c}function u0(t,i,c){var d=t.pingCache;if(d===null){d=t.pingCache=new nE;var m=new Set;d.set(i,m)}else m=d.get(i),m===void 0&&(m=new Set,d.set(i,m));m.has(c)||(m.add(c),t=mE.bind(null,t,i,c),i.then(t,t))}function d0(t){do{var i;if((i=t.tag===13)&&(i=t.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return t;t=t.return}while(t!==null);return null}function f0(t,i,c,d,m){return(t.mode&1)===0?(t===i?t.flags|=65536:(t.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(i=_(-1,1),i.tag=2,k(c,i,1))),c.lanes|=1),t):(t.flags|=65536,t.lanes=m,t)}var rE=x.ReactCurrentOwner,or=!1;function Gn(t,i,c,d){i.child=t===null?Ld(i,null,c,d):to(i,t.child,c,d)}function h0(t,i,c,d,m){c=c.render;var w=i.ref;return no(i,m),d=Ap(t,i,c,d,w,m),c=Pp(),t!==null&&!or?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~m,ls(t,i,m)):(Mt&&c&&oc(i),i.flags|=1,Gn(t,i,d,m),i.child)}function p0(t,i,c,d,m){if(t===null){var w=c.type;return typeof w=="function"&&!ag(w)&&w.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(i.tag=15,i.type=w,g0(t,i,w,d,m)):(t=Zd(c.type,null,d,i,i.mode,m),t.ref=i.ref,t.return=i,i.child=t)}if(w=t.child,(t.lanes&m)===0){var O=w.memoizedProps;if(c=c.compare,c=c!==null?c:Ko,c(O,d)&&t.ref===i.ref)return ls(t,i,m)}return i.flags|=1,t=co(w,d),t.ref=i.ref,t.return=i,i.child=t}function g0(t,i,c,d,m){if(t!==null){var w=t.memoizedProps;if(Ko(w,d)&&t.ref===i.ref)if(or=!1,i.pendingProps=d=w,(t.lanes&m)!==0)(t.flags&131072)!==0&&(or=!0);else return i.lanes=t.lanes,ls(t,i,m)}return Fp(t,i,c,d,m)}function m0(t,i,c){var d=i.pendingProps,m=d.children,w=t!==null?t.memoizedState:null;if(d.mode==="hidden")if((i.mode&1)===0)i.memoizedState={baseLanes:0,cachePool:null,transitions:null},vt(fc,wr),wr|=c;else{if((c&1073741824)===0)return t=w!==null?w.baseLanes|c:c,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:t,cachePool:null,transitions:null},i.updateQueue=null,vt(fc,wr),wr|=t,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=w!==null?w.baseLanes:c,vt(fc,wr),wr|=d}else w!==null?(d=w.baseLanes|c,i.memoizedState=null):d=c,vt(fc,wr),wr|=d;return Gn(t,i,m,c),i.child}function v0(t,i){var c=i.ref;(t===null&&c!==null||t!==null&&t.ref!==c)&&(i.flags|=512,i.flags|=2097152)}function Fp(t,i,c,d,m){var w=On(c)?nr:Kt.current;return w=yr(i,w),no(i,m),c=Ap(t,i,c,d,w,m),d=Pp(),t!==null&&!or?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~m,ls(t,i,m)):(Mt&&d&&oc(i),i.flags|=1,Gn(t,i,c,m),i.child)}function y0(t,i,c,d,m){if(On(c)){var w=!0;nc(i)}else w=!1;if(no(i,m),i.stateNode===null)Vd(t,i),o0(i,c,d),Dp(i,c,d,m),d=!0;else if(t===null){var O=i.stateNode,F=i.memoizedProps;O.props=F;var W=O.context,ie=c.contextType;typeof ie=="object"&&ie!==null?ie=sr(ie):(ie=On(c)?nr:Kt.current,ie=yr(i,ie));var be=c.getDerivedStateFromProps,Se=typeof be=="function"||typeof O.getSnapshotBeforeUpdate=="function";Se||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(F!==d||W!==ie)&&a0(i,O,d,ie),o=!1;var ye=i.memoizedState;O.state=ye,Z(i,d,O,m),W=i.memoizedState,F!==d||ye!==W||fn.current||o?(typeof be=="function"&&(Np(i,c,be,d),W=i.memoizedState),(F=o||s0(i,c,F,d,ye,W,ie))?(Se||typeof O.UNSAFE_componentWillMount!="function"&&typeof O.componentWillMount!="function"||(typeof O.componentWillMount=="function"&&O.componentWillMount(),typeof O.UNSAFE_componentWillMount=="function"&&O.UNSAFE_componentWillMount()),typeof O.componentDidMount=="function"&&(i.flags|=4194308)):(typeof O.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=W),O.props=d,O.state=W,O.context=ie,d=F):(typeof O.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{O=i.stateNode,p(t,i),F=i.memoizedProps,ie=i.type===i.elementType?F:ci(i.type,F),O.props=ie,Se=i.pendingProps,ye=O.context,W=c.contextType,typeof W=="object"&&W!==null?W=sr(W):(W=On(c)?nr:Kt.current,W=yr(i,W));var Ie=c.getDerivedStateFromProps;(be=typeof Ie=="function"||typeof O.getSnapshotBeforeUpdate=="function")||typeof O.UNSAFE_componentWillReceiveProps!="function"&&typeof O.componentWillReceiveProps!="function"||(F!==Se||ye!==W)&&a0(i,O,d,W),o=!1,ye=i.memoizedState,O.state=ye,Z(i,d,O,m);var Le=i.memoizedState;F!==Se||ye!==Le||fn.current||o?(typeof Ie=="function"&&(Np(i,c,Ie,d),Le=i.memoizedState),(ie=o||s0(i,c,ie,d,ye,Le,W)||!1)?(be||typeof O.UNSAFE_componentWillUpdate!="function"&&typeof O.componentWillUpdate!="function"||(typeof O.componentWillUpdate=="function"&&O.componentWillUpdate(d,Le,W),typeof O.UNSAFE_componentWillUpdate=="function"&&O.UNSAFE_componentWillUpdate(d,Le,W)),typeof O.componentDidUpdate=="function"&&(i.flags|=4),typeof O.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof O.componentDidUpdate!="function"||F===t.memoizedProps&&ye===t.memoizedState||(i.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||F===t.memoizedProps&&ye===t.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=Le),O.props=d,O.state=Le,O.context=W,d=ie):(typeof O.componentDidUpdate!="function"||F===t.memoizedProps&&ye===t.memoizedState||(i.flags|=4),typeof O.getSnapshotBeforeUpdate!="function"||F===t.memoizedProps&&ye===t.memoizedState||(i.flags|=1024),d=!1)}return zp(t,i,c,d,w,m)}function zp(t,i,c,d,m,w){v0(t,i);var O=(i.flags&128)!==0;if(!d&&!O)return m&&Td(i,c,!1),ls(t,i,w);d=i.stateNode,rE.current=i;var F=O&&typeof c.getDerivedStateFromError!="function"?null:d.render();return i.flags|=1,t!==null&&O?(i.child=to(i,t.child,null,w),i.child=to(i,null,F,w)):Gn(t,i,F,w),i.memoizedState=d.state,m&&Td(i,c,!0),i.child}function _0(t){var i=t.stateNode;i.pendingContext?It(t,i.pendingContext,i.pendingContext!==i.context):i.context&&It(t,i.context,!1),Pe(t,i.containerInfo)}function w0(t,i,c,d,m){return eo(),ia(m),i.flags|=256,Gn(t,i,c,d),i.child}var Vp={dehydrated:null,treeContext:null,retryLane:0};function $p(t){return{baseLanes:t,cachePool:null,transitions:null}}function b0(t,i,c){var d=i.pendingProps,m=We.current,w=!1,O=(i.flags&128)!==0,F;if((F=O)||(F=t!==null&&t.memoizedState===null?!1:(m&2)!==0),F?(w=!0,i.flags&=-129):(t===null||t.memoizedState!==null)&&(m|=1),vt(We,m&1),t===null)return Tl(i),t=i.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((i.mode&1)===0?i.lanes=1:t.data==="$!"?i.lanes=8:i.lanes=1073741824,null):(O=d.children,t=d.fallback,w?(d=i.mode,w=i.child,O={mode:"hidden",children:O},(d&1)===0&&w!==null?(w.childLanes=0,w.pendingProps=O):w=ef(O,d,0,null),t=fa(t,d,c,null),w.return=i,t.return=i,w.sibling=t,i.child=w,i.child.memoizedState=$p(c),i.memoizedState=Vp,t):qp(i,O));if(m=t.memoizedState,m!==null&&(F=m.dehydrated,F!==null))return iE(t,i,O,d,F,m,c);if(w){w=d.fallback,O=i.mode,m=t.child,F=m.sibling;var W={mode:"hidden",children:d.children};return(O&1)===0&&i.child!==m?(d=i.child,d.childLanes=0,d.pendingProps=W,i.deletions=null):(d=co(m,W),d.subtreeFlags=m.subtreeFlags&14680064),F!==null?w=co(F,w):(w=fa(w,O,c,null),w.flags|=2),w.return=i,d.return=i,d.sibling=w,i.child=d,d=w,w=i.child,O=t.child.memoizedState,O=O===null?$p(c):{baseLanes:O.baseLanes|c,cachePool:null,transitions:O.transitions},w.memoizedState=O,w.childLanes=t.childLanes&~c,i.memoizedState=Vp,d}return w=t.child,t=w.sibling,d=co(w,{mode:"visible",children:d.children}),(i.mode&1)===0&&(d.lanes=c),d.return=i,d.sibling=null,t!==null&&(c=i.deletions,c===null?(i.deletions=[t],i.flags|=16):c.push(t)),i.child=d,i.memoizedState=null,d}function qp(t,i){return i=ef({mode:"visible",children:i},t.mode,0,null),i.return=t,t.child=i}function zd(t,i,c,d){return d!==null&&ia(d),to(i,t.child,null,c),t=qp(i,i.pendingProps.children),t.flags|=2,i.memoizedState=null,t}function iE(t,i,c,d,m,w,O){if(c)return i.flags&256?(i.flags&=-257,d=Up(Error(r(422))),zd(t,i,O,d)):i.memoizedState!==null?(i.child=t.child,i.flags|=128,null):(w=d.fallback,m=i.mode,d=ef({mode:"visible",children:d.children},m,0,null),w=fa(w,m,O,null),w.flags|=2,d.return=i,w.return=i,d.sibling=w,i.child=d,(i.mode&1)!==0&&to(i,t.child,null,O),i.child.memoizedState=$p(O),i.memoizedState=Vp,w);if((i.mode&1)===0)return zd(t,i,O,null);if(m.data==="$!"){if(d=m.nextSibling&&m.nextSibling.dataset,d)var F=d.dgst;return d=F,w=Error(r(419)),d=Up(w,d,void 0),zd(t,i,O,d)}if(F=(O&t.childLanes)!==0,or||F){if(d=sn,d!==null){switch(O&-O){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=(m&(d.suspendedLanes|O))!==0?0:m,m!==0&&m!==w.retryLane&&(w.retryLane=m,s(t,m),di(d,t,m,-1))}return og(),d=Up(Error(r(421))),zd(t,i,O,d)}return m.data==="$?"?(i.flags|=128,i.child=t.child,i=vE.bind(null,t),m._reactRetry=i,null):(t=w.treeContext,Hn=ti(m.nextSibling),Wn=i,Mt=!0,_r=null,t!==null&&(rr[ir++]=si,rr[ir++]=oi,rr[ir++]=Li,si=t.id,oi=t.overflow,Li=i),i=qp(i,d.children),i.flags|=4096,i)}function S0(t,i,c){t.lanes|=i;var d=t.alternate;d!==null&&(d.lanes|=i),Al(t.return,i,c)}function Wp(t,i,c,d,m){var w=t.memoizedState;w===null?t.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:m}:(w.isBackwards=i,w.rendering=null,w.renderingStartTime=0,w.last=d,w.tail=c,w.tailMode=m)}function k0(t,i,c){var d=i.pendingProps,m=d.revealOrder,w=d.tail;if(Gn(t,i,d.children,c),d=We.current,(d&2)!==0)d=d&1|2,i.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=i.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&S0(t,c,i);else if(t.tag===19)S0(t,c,i);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break e;for(;t.sibling===null;){if(t.return===null||t.return===i)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}d&=1}if(vt(We,d),(i.mode&1)===0)i.memoizedState=null;else switch(m){case"forwards":for(c=i.child,m=null;c!==null;)t=c.alternate,t!==null&&He(t)===null&&(m=c),c=c.sibling;c=m,c===null?(m=i.child,i.child=null):(m=c.sibling,c.sibling=null),Wp(i,!1,m,c,w);break;case"backwards":for(c=null,m=i.child,i.child=null;m!==null;){if(t=m.alternate,t!==null&&He(t)===null){i.child=m;break}t=m.sibling,m.sibling=c,c=m,m=t}Wp(i,!0,c,null,w);break;case"together":Wp(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function Vd(t,i){(i.mode&1)===0&&t!==null&&(t.alternate=null,i.alternate=null,i.flags|=2)}function ls(t,i,c){if(t!==null&&(i.dependencies=t.dependencies),ca|=i.lanes,(c&i.childLanes)===0)return null;if(t!==null&&i.child!==t.child)throw Error(r(153));if(i.child!==null){for(t=i.child,c=co(t,t.pendingProps),i.child=c,c.return=i;t.sibling!==null;)t=t.sibling,c=c.sibling=co(t,t.pendingProps),c.return=i;c.sibling=null}return i.child}function sE(t,i,c){switch(i.tag){case 3:_0(i),eo();break;case 5:lt(i);break;case 1:On(i.type)&&nc(i);break;case 4:Pe(i,i.stateNode.containerInfo);break;case 10:var d=i.type._context,m=i.memoizedProps.value;vt(oa,d._currentValue),d._currentValue=m;break;case 13:if(d=i.memoizedState,d!==null)return d.dehydrated!==null?(vt(We,We.current&1),i.flags|=128,null):(c&i.child.childLanes)!==0?b0(t,i,c):(vt(We,We.current&1),t=ls(t,i,c),t!==null?t.sibling:null);vt(We,We.current&1);break;case 19:if(d=(c&i.childLanes)!==0,(t.flags&128)!==0){if(d)return k0(t,i,c);i.flags|=128}if(m=i.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),vt(We,We.current),d)break;return null;case 22:case 23:return i.lanes=0,m0(t,i,c)}return ls(t,i,c)}var C0,Hp,E0,M0;C0=function(t,i){for(var c=i.child;c!==null;){if(c.tag===5||c.tag===6)t.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===i)break;for(;c.sibling===null;){if(c.return===null||c.return===i)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},Hp=function(){},E0=function(t,i,c,d){var m=t.memoizedProps;if(m!==d){t=i.stateNode,Ae(de.current);var w=null;switch(c){case"input":m=zt(t,m),d=zt(t,d),w=[];break;case"select":m=oe({},m,{value:void 0}),d=oe({},d,{value:void 0}),w=[];break;case"textarea":m=Nn(t,m),d=Nn(t,d),w=[];break;default:typeof m.onClick!="function"&&typeof d.onClick=="function"&&(t.onclick=Ka)}ks(c,d);var O;c=null;for(ie in m)if(!d.hasOwnProperty(ie)&&m.hasOwnProperty(ie)&&m[ie]!=null)if(ie==="style"){var F=m[ie];for(O in F)F.hasOwnProperty(O)&&(c||(c={}),c[O]="")}else ie!=="dangerouslySetInnerHTML"&&ie!=="children"&&ie!=="suppressContentEditableWarning"&&ie!=="suppressHydrationWarning"&&ie!=="autoFocus"&&(l.hasOwnProperty(ie)?w||(w=[]):(w=w||[]).push(ie,null));for(ie in d){var W=d[ie];if(F=m?.[ie],d.hasOwnProperty(ie)&&W!==F&&(W!=null||F!=null))if(ie==="style")if(F){for(O in F)!F.hasOwnProperty(O)||W&&W.hasOwnProperty(O)||(c||(c={}),c[O]="");for(O in W)W.hasOwnProperty(O)&&F[O]!==W[O]&&(c||(c={}),c[O]=W[O])}else c||(w||(w=[]),w.push(ie,c)),c=W;else ie==="dangerouslySetInnerHTML"?(W=W?W.__html:void 0,F=F?F.__html:void 0,W!=null&&F!==W&&(w=w||[]).push(ie,W)):ie==="children"?typeof W!="string"&&typeof W!="number"||(w=w||[]).push(ie,""+W):ie!=="suppressContentEditableWarning"&&ie!=="suppressHydrationWarning"&&(l.hasOwnProperty(ie)?(W!=null&&ie==="onScroll"&&kt("scroll",t),w||F===W||(w=[])):(w=w||[]).push(ie,W))}c&&(w=w||[]).push("style",c);var ie=w;(i.updateQueue=ie)&&(i.flags|=4)}},M0=function(t,i,c,d){c!==d&&(i.flags|=4)};function Nl(t,i){if(!Mt)switch(t.tailMode){case"hidden":i=t.tail;for(var c=null;i!==null;)i.alternate!==null&&(c=i),i=i.sibling;c===null?t.tail=null:c.sibling=null;break;case"collapsed":c=t.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?i||t.tail===null?t.tail=null:t.tail.sibling=null:d.sibling=null}}function An(t){var i=t.alternate!==null&&t.alternate.child===t.child,c=0,d=0;if(i)for(var m=t.child;m!==null;)c|=m.lanes|m.childLanes,d|=m.subtreeFlags&14680064,d|=m.flags&14680064,m.return=t,m=m.sibling;else for(m=t.child;m!==null;)c|=m.lanes|m.childLanes,d|=m.subtreeFlags,d|=m.flags,m.return=t,m=m.sibling;return t.subtreeFlags|=d,t.childLanes=c,i}function oE(t,i,c){var d=i.pendingProps;switch(ac(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return An(i),null;case 1:return On(i.type)&&na(),An(i),null;case 3:return d=i.stateNode,Fe(),ct(fn),ct(Kt),qt(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(t===null||t.child===null)&&(ra(i)?i.flags|=4:t===null||t.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,_r!==null&&(rg(_r),_r=null))),Hp(t,i),An(i),null;case 5:ft(i);var m=Ae(fe.current);if(c=i.type,t!==null&&i.stateNode!=null)E0(t,i,c,d,m),t.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!d){if(i.stateNode===null)throw Error(r(166));return An(i),null}if(t=Ae(de.current),ra(i)){d=i.stateNode,c=i.type;var w=i.memoizedProps;switch(d[Tn]=i,d[ni]=w,t=(i.mode&1)!==0,c){case"dialog":kt("cancel",d),kt("close",d);break;case"iframe":case"object":case"embed":kt("load",d);break;case"video":case"audio":for(m=0;m<os.length;m++)kt(os[m],d);break;case"source":kt("error",d);break;case"img":case"image":case"link":kt("error",d),kt("load",d);break;case"details":kt("toggle",d);break;case"input":Sn(d,w),kt("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!w.multiple},kt("invalid",d);break;case"textarea":Kn(d,w),kt("invalid",d)}ks(c,w),m=null;for(var O in w)if(w.hasOwnProperty(O)){var F=w[O];O==="children"?typeof F=="string"?d.textContent!==F&&(w.suppressHydrationWarning!==!0&&Qa(d.textContent,F,t),m=["children",F]):typeof F=="number"&&d.textContent!==""+F&&(w.suppressHydrationWarning!==!0&&Qa(d.textContent,F,t),m=["children",""+F]):l.hasOwnProperty(O)&&F!=null&&O==="onScroll"&&kt("scroll",d)}switch(c){case"input":Re(d),At(d,w,!0);break;case"textarea":Re(d),Tr(d);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(d.onclick=Ka)}d=m,i.updateQueue=d,d!==null&&(i.flags|=4)}else{O=m.nodeType===9?m:m.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=Hi(c)),t==="http://www.w3.org/1999/xhtml"?c==="script"?(t=O.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof d.is=="string"?t=O.createElement(c,{is:d.is}):(t=O.createElement(c),c==="select"&&(O=t,d.multiple?O.multiple=!0:d.size&&(O.size=d.size))):t=O.createElementNS(t,c),t[Tn]=i,t[ni]=d,C0(t,i,!1,!1),i.stateNode=t;e:{switch(O=_i(c,d),c){case"dialog":kt("cancel",t),kt("close",t),m=d;break;case"iframe":case"object":case"embed":kt("load",t),m=d;break;case"video":case"audio":for(m=0;m<os.length;m++)kt(os[m],t);m=d;break;case"source":kt("error",t),m=d;break;case"img":case"image":case"link":kt("error",t),kt("load",t),m=d;break;case"details":kt("toggle",t),m=d;break;case"input":Sn(t,d),m=zt(t,d),kt("invalid",t);break;case"option":m=d;break;case"select":t._wrapperState={wasMultiple:!!d.multiple},m=oe({},d,{value:void 0}),kt("invalid",t);break;case"textarea":Kn(t,d),m=Nn(t,d),kt("invalid",t);break;default:m=d}ks(c,m),F=m;for(w in F)if(F.hasOwnProperty(w)){var W=F[w];w==="style"?Gi(t,W):w==="dangerouslySetInnerHTML"?(W=W?W.__html:void 0,W!=null&&ln(t,W)):w==="children"?typeof W=="string"?(c!=="textarea"||W!=="")&&Qr(t,W):typeof W=="number"&&Qr(t,""+W):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(l.hasOwnProperty(w)?W!=null&&w==="onScroll"&&kt("scroll",t):W!=null&&X(t,w,W,O))}switch(c){case"input":Re(t),At(t,d,!1);break;case"textarea":Re(t),Tr(t);break;case"option":d.value!=null&&t.setAttribute("value",""+K(d.value));break;case"select":t.multiple=!!d.multiple,w=d.value,w!=null?Ze(t,!!d.multiple,w,!1):d.defaultValue!=null&&Ze(t,!!d.multiple,d.defaultValue,!0);break;default:typeof m.onClick=="function"&&(t.onclick=Ka)}switch(c){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return An(i),null;case 6:if(t&&i.stateNode!=null)M0(t,i,t.memoizedProps,d);else{if(typeof d!="string"&&i.stateNode===null)throw Error(r(166));if(c=Ae(fe.current),Ae(de.current),ra(i)){if(d=i.stateNode,c=i.memoizedProps,d[Tn]=i,(w=d.nodeValue!==c)&&(t=Wn,t!==null))switch(t.tag){case 3:Qa(d.nodeValue,c,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Qa(d.nodeValue,c,(t.mode&1)!==0)}w&&(i.flags|=4)}else d=(c.nodeType===9?c:c.ownerDocument).createTextNode(d),d[Tn]=i,i.stateNode=d}return An(i),null;case 13:if(ct(We),d=i.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Mt&&Hn!==null&&(i.mode&1)!==0&&(i.flags&128)===0)cc(),eo(),i.flags|=98560,w=!1;else if(w=ra(i),d!==null&&d.dehydrated!==null){if(t===null){if(!w)throw Error(r(318));if(w=i.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(r(317));w[Tn]=i}else eo(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;An(i),w=!1}else _r!==null&&(rg(_r),_r=null),w=!0;if(!w)return i.flags&65536?i:null}return(i.flags&128)!==0?(i.lanes=c,i):(d=d!==null,d!==(t!==null&&t.memoizedState!==null)&&d&&(i.child.flags|=8192,(i.mode&1)!==0&&(t===null||(We.current&1)!==0?Xt===0&&(Xt=3):og())),i.updateQueue!==null&&(i.flags|=4),An(i),null);case 4:return Fe(),Hp(t,i),t===null&&Zo(i.stateNode.containerInfo),An(i),null;case 10:return Rl(i.type._context),An(i),null;case 17:return On(i.type)&&na(),An(i),null;case 19:if(ct(We),w=i.memoizedState,w===null)return An(i),null;if(d=(i.flags&128)!==0,O=w.rendering,O===null)if(d)Nl(w,!1);else{if(Xt!==0||t!==null&&(t.flags&128)!==0)for(t=i.child;t!==null;){if(O=He(t),O!==null){for(i.flags|=128,Nl(w,!1),d=O.updateQueue,d!==null&&(i.updateQueue=d,i.flags|=4),i.subtreeFlags=0,d=c,c=i.child;c!==null;)w=c,t=d,w.flags&=14680066,O=w.alternate,O===null?(w.childLanes=0,w.lanes=t,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=O.childLanes,w.lanes=O.lanes,w.child=O.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=O.memoizedProps,w.memoizedState=O.memoizedState,w.updateQueue=O.updateQueue,w.type=O.type,t=O.dependencies,w.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),c=c.sibling;return vt(We,We.current&1|2),i.child}t=t.sibling}w.tail!==null&&Et()>hc&&(i.flags|=128,d=!0,Nl(w,!1),i.lanes=4194304)}else{if(!d)if(t=He(O),t!==null){if(i.flags|=128,d=!0,c=t.updateQueue,c!==null&&(i.updateQueue=c,i.flags|=4),Nl(w,!0),w.tail===null&&w.tailMode==="hidden"&&!O.alternate&&!Mt)return An(i),null}else 2*Et()-w.renderingStartTime>hc&&c!==1073741824&&(i.flags|=128,d=!0,Nl(w,!1),i.lanes=4194304);w.isBackwards?(O.sibling=i.child,i.child=O):(c=w.last,c!==null?c.sibling=O:i.child=O,w.last=O)}return w.tail!==null?(i=w.tail,w.rendering=i,w.tail=i.sibling,w.renderingStartTime=Et(),i.sibling=null,c=We.current,vt(We,d?c&1|2:c&1),i):(An(i),null);case 22:case 23:return sg(),d=i.memoizedState!==null,t!==null&&t.memoizedState!==null!==d&&(i.flags|=8192),d&&(i.mode&1)!==0?(wr&1073741824)!==0&&(An(i),i.subtreeFlags&6&&(i.flags|=8192)):An(i),null;case 24:return null;case 25:return null}throw Error(r(156,i.tag))}function aE(t,i){switch(ac(i),i.tag){case 1:return On(i.type)&&na(),t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 3:return Fe(),ct(fn),ct(Kt),qt(),t=i.flags,(t&65536)!==0&&(t&128)===0?(i.flags=t&-65537|128,i):null;case 5:return ft(i),null;case 13:if(ct(We),t=i.memoizedState,t!==null&&t.dehydrated!==null){if(i.alternate===null)throw Error(r(340));eo()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 19:return ct(We),null;case 4:return Fe(),null;case 10:return Rl(i.type._context),null;case 22:case 23:return sg(),null;case 24:return null;default:return null}}var $d=!1,Pn=!1,cE=typeof WeakSet=="function"?WeakSet:Set,xe=null;function dc(t,i){var c=t.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(d){Lt(t,i,d)}else c.current=null}function Gp(t,i,c){try{c()}catch(d){Lt(t,i,d)}}var T0=!1;function lE(t,i){if(_l=ne,t=dl(),ei(t)){if("selectionStart"in t)var c={start:t.selectionStart,end:t.selectionEnd};else e:{c=(c=t.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var m=d.anchorOffset,w=d.focusNode;d=d.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var O=0,F=-1,W=-1,ie=0,be=0,Se=t,ye=null;t:for(;;){for(var Ie;Se!==c||m!==0&&Se.nodeType!==3||(F=O+m),Se!==w||d!==0&&Se.nodeType!==3||(W=O+d),Se.nodeType===3&&(O+=Se.nodeValue.length),(Ie=Se.firstChild)!==null;)ye=Se,Se=Ie;for(;;){if(Se===t)break t;if(ye===c&&++ie===m&&(F=O),ye===w&&++be===d&&(W=O),(Ie=Se.nextSibling)!==null)break;Se=ye,ye=Se.parentNode}Se=Ie}c=F===-1||W===-1?null:{start:F,end:W}}else c=null}c=c||{start:0,end:0}}else c=null;for(Ya={focusedElem:t,selectionRange:c},ne=!1,xe=i;xe!==null;)if(i=xe,t=i.child,(i.subtreeFlags&1028)!==0&&t!==null)t.return=i,xe=t;else for(;xe!==null;){i=xe;try{var Le=i.alternate;if((i.flags&1024)!==0)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Le!==null){var Ne=Le.memoizedProps,Ft=Le.memoizedState,ee=i.stateNode,H=ee.getSnapshotBeforeUpdate(i.elementType===i.type?Ne:ci(i.type,Ne),Ft);ee.__reactInternalSnapshotBeforeUpdate=H}break;case 3:var te=i.stateNode.containerInfo;te.nodeType===1?te.textContent="":te.nodeType===9&&te.documentElement&&te.removeChild(te.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(Me){Lt(i,i.return,Me)}if(t=i.sibling,t!==null){t.return=i.return,xe=t;break}xe=i.return}return Le=T0,T0=!1,Le}function Dl(t,i,c){var d=i.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var m=d=d.next;do{if((m.tag&t)===t){var w=m.destroy;m.destroy=void 0,w!==void 0&&Gp(i,c,w)}m=m.next}while(m!==d)}}function qd(t,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var c=i=i.next;do{if((c.tag&t)===t){var d=c.create;c.destroy=d()}c=c.next}while(c!==i)}}function Jp(t){var i=t.ref;if(i!==null){var c=t.stateNode;switch(t.tag){case 5:t=c;break;default:t=c}typeof i=="function"?i(t):i.current=t}}function O0(t){var i=t.alternate;i!==null&&(t.alternate=null,O0(i)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(i=t.stateNode,i!==null&&(delete i[Tn],delete i[ni],delete i[Js],delete i[Tp],delete i[kl])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function R0(t){return t.tag===5||t.tag===3||t.tag===4}function A0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||R0(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Qp(t,i,c){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?c.nodeType===8?c.parentNode.insertBefore(t,i):c.insertBefore(t,i):(c.nodeType===8?(i=c.parentNode,i.insertBefore(t,c)):(i=c,i.appendChild(t)),c=c._reactRootContainer,c!=null||i.onclick!==null||(i.onclick=Ka));else if(d!==4&&(t=t.child,t!==null))for(Qp(t,i,c),t=t.sibling;t!==null;)Qp(t,i,c),t=t.sibling}function Kp(t,i,c){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?c.insertBefore(t,i):c.appendChild(t);else if(d!==4&&(t=t.child,t!==null))for(Kp(t,i,c),t=t.sibling;t!==null;)Kp(t,i,c),t=t.sibling}var pn=null,li=!1;function ro(t,i,c){for(c=c.child;c!==null;)P0(t,i,c),c=c.sibling}function P0(t,i,c){if(Un&&typeof Un.onCommitFiberUnmount=="function")try{Un.onCommitFiberUnmount(Ci,c)}catch{}switch(c.tag){case 5:Pn||dc(c,i);case 6:var d=pn,m=li;pn=null,ro(t,i,c),pn=d,li=m,pn!==null&&(li?(t=pn,c=c.stateNode,t.nodeType===8?t.parentNode.removeChild(c):t.removeChild(c)):pn.removeChild(c.stateNode));break;case 18:pn!==null&&(li?(t=pn,c=c.stateNode,t.nodeType===8?Za(t.parentNode,c):t.nodeType===1&&Za(t,c),Zi(t)):Za(pn,c.stateNode));break;case 4:d=pn,m=li,pn=c.stateNode.containerInfo,li=!0,ro(t,i,c),pn=d,li=m;break;case 0:case 11:case 14:case 15:if(!Pn&&(d=c.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){m=d=d.next;do{var w=m,O=w.destroy;w=w.tag,O!==void 0&&((w&2)!==0||(w&4)!==0)&&Gp(c,i,O),m=m.next}while(m!==d)}ro(t,i,c);break;case 1:if(!Pn&&(dc(c,i),d=c.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=c.memoizedProps,d.state=c.memoizedState,d.componentWillUnmount()}catch(F){Lt(c,i,F)}ro(t,i,c);break;case 21:ro(t,i,c);break;case 22:c.mode&1?(Pn=(d=Pn)||c.memoizedState!==null,ro(t,i,c),Pn=d):ro(t,i,c);break;default:ro(t,i,c)}}function I0(t){var i=t.updateQueue;if(i!==null){t.updateQueue=null;var c=t.stateNode;c===null&&(c=t.stateNode=new cE),i.forEach(function(d){var m=yE.bind(null,t,d);c.has(d)||(c.add(d),d.then(m,m))})}}function ui(t,i){var c=i.deletions;if(c!==null)for(var d=0;d<c.length;d++){var m=c[d];try{var w=t,O=i,F=O;e:for(;F!==null;){switch(F.tag){case 5:pn=F.stateNode,li=!1;break e;case 3:pn=F.stateNode.containerInfo,li=!0;break e;case 4:pn=F.stateNode.containerInfo,li=!0;break e}F=F.return}if(pn===null)throw Error(r(160));P0(w,O,m),pn=null,li=!1;var W=m.alternate;W!==null&&(W.return=null),m.return=null}catch(ie){Lt(m,i,ie)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)x0(i,t),i=i.sibling}function x0(t,i){var c=t.alternate,d=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ui(i,t),Fi(t),d&4){try{Dl(3,t,t.return),qd(3,t)}catch(Ne){Lt(t,t.return,Ne)}try{Dl(5,t,t.return)}catch(Ne){Lt(t,t.return,Ne)}}break;case 1:ui(i,t),Fi(t),d&512&&c!==null&&dc(c,c.return);break;case 5:if(ui(i,t),Fi(t),d&512&&c!==null&&dc(c,c.return),t.flags&32){var m=t.stateNode;try{Qr(m,"")}catch(Ne){Lt(t,t.return,Ne)}}if(d&4&&(m=t.stateNode,m!=null)){var w=t.memoizedProps,O=c!==null?c.memoizedProps:w,F=t.type,W=t.updateQueue;if(t.updateQueue=null,W!==null)try{F==="input"&&w.type==="radio"&&w.name!=null&&jn(m,w),_i(F,O);var ie=_i(F,w);for(O=0;O<W.length;O+=2){var be=W[O],Se=W[O+1];be==="style"?Gi(m,Se):be==="dangerouslySetInnerHTML"?ln(m,Se):be==="children"?Qr(m,Se):X(m,be,Se,ie)}switch(F){case"input":mt(m,w);break;case"textarea":Jt(m,w);break;case"select":var ye=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!w.multiple;var Ie=w.value;Ie!=null?Ze(m,!!w.multiple,Ie,!1):ye!==!!w.multiple&&(w.defaultValue!=null?Ze(m,!!w.multiple,w.defaultValue,!0):Ze(m,!!w.multiple,w.multiple?[]:"",!1))}m[ni]=w}catch(Ne){Lt(t,t.return,Ne)}}break;case 6:if(ui(i,t),Fi(t),d&4){if(t.stateNode===null)throw Error(r(162));m=t.stateNode,w=t.memoizedProps;try{m.nodeValue=w}catch(Ne){Lt(t,t.return,Ne)}}break;case 3:if(ui(i,t),Fi(t),d&4&&c!==null&&c.memoizedState.isDehydrated)try{Zi(i.containerInfo)}catch(Ne){Lt(t,t.return,Ne)}break;case 4:ui(i,t),Fi(t);break;case 13:ui(i,t),Fi(t),m=t.child,m.flags&8192&&(w=m.memoizedState!==null,m.stateNode.isHidden=w,!w||m.alternate!==null&&m.alternate.memoizedState!==null||(Zp=Et())),d&4&&I0(t);break;case 22:if(be=c!==null&&c.memoizedState!==null,t.mode&1?(Pn=(ie=Pn)||be,ui(i,t),Pn=ie):ui(i,t),Fi(t),d&8192){if(ie=t.memoizedState!==null,(t.stateNode.isHidden=ie)&&!be&&(t.mode&1)!==0)for(xe=t,be=t.child;be!==null;){for(Se=xe=be;xe!==null;){switch(ye=xe,Ie=ye.child,ye.tag){case 0:case 11:case 14:case 15:Dl(4,ye,ye.return);break;case 1:dc(ye,ye.return);var Le=ye.stateNode;if(typeof Le.componentWillUnmount=="function"){d=ye,c=ye.return;try{i=d,Le.props=i.memoizedProps,Le.state=i.memoizedState,Le.componentWillUnmount()}catch(Ne){Lt(d,c,Ne)}}break;case 5:dc(ye,ye.return);break;case 22:if(ye.memoizedState!==null){N0(Se);continue}}Ie!==null?(Ie.return=ye,xe=Ie):N0(Se)}be=be.sibling}e:for(be=null,Se=t;;){if(Se.tag===5){if(be===null){be=Se;try{m=Se.stateNode,ie?(w=m.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(F=Se.stateNode,W=Se.memoizedProps.style,O=W!=null&&W.hasOwnProperty("display")?W.display:null,F.style.display=Lo("display",O))}catch(Ne){Lt(t,t.return,Ne)}}}else if(Se.tag===6){if(be===null)try{Se.stateNode.nodeValue=ie?"":Se.memoizedProps}catch(Ne){Lt(t,t.return,Ne)}}else if((Se.tag!==22&&Se.tag!==23||Se.memoizedState===null||Se===t)&&Se.child!==null){Se.child.return=Se,Se=Se.child;continue}if(Se===t)break e;for(;Se.sibling===null;){if(Se.return===null||Se.return===t)break e;be===Se&&(be=null),Se=Se.return}be===Se&&(be=null),Se.sibling.return=Se.return,Se=Se.sibling}}break;case 19:ui(i,t),Fi(t),d&4&&I0(t);break;case 21:break;default:ui(i,t),Fi(t)}}function Fi(t){var i=t.flags;if(i&2){try{e:{for(var c=t.return;c!==null;){if(R0(c)){var d=c;break e}c=c.return}throw Error(r(160))}switch(d.tag){case 5:var m=d.stateNode;d.flags&32&&(Qr(m,""),d.flags&=-33);var w=A0(t);Kp(t,w,m);break;case 3:case 4:var O=d.stateNode.containerInfo,F=A0(t);Qp(t,F,O);break;default:throw Error(r(161))}}catch(W){Lt(t,t.return,W)}t.flags&=-3}i&4096&&(t.flags&=-4097)}function uE(t,i,c){xe=t,L0(t)}function L0(t,i,c){for(var d=(t.mode&1)!==0;xe!==null;){var m=xe,w=m.child;if(m.tag===22&&d){var O=m.memoizedState!==null||$d;if(!O){var F=m.alternate,W=F!==null&&F.memoizedState!==null||Pn;F=$d;var ie=Pn;if($d=O,(Pn=W)&&!ie)for(xe=m;xe!==null;)O=xe,W=O.child,O.tag===22&&O.memoizedState!==null?D0(m):W!==null?(W.return=O,xe=W):D0(m);for(;w!==null;)xe=w,L0(w),w=w.sibling;xe=m,$d=F,Pn=ie}j0(t)}else(m.subtreeFlags&8772)!==0&&w!==null?(w.return=m,xe=w):j0(t)}}function j0(t){for(;xe!==null;){var i=xe;if((i.flags&8772)!==0){var c=i.alternate;try{if((i.flags&8772)!==0)switch(i.tag){case 0:case 11:case 15:Pn||qd(5,i);break;case 1:var d=i.stateNode;if(i.flags&4&&!Pn)if(c===null)d.componentDidMount();else{var m=i.elementType===i.type?c.memoizedProps:ci(i.type,c.memoizedProps);d.componentDidUpdate(m,c.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var w=i.updateQueue;w!==null&&Y(i,w,d);break;case 3:var O=i.updateQueue;if(O!==null){if(c=null,i.child!==null)switch(i.child.tag){case 5:c=i.child.stateNode;break;case 1:c=i.child.stateNode}Y(i,O,c)}break;case 5:var F=i.stateNode;if(c===null&&i.flags&4){c=F;var W=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":W.autoFocus&&c.focus();break;case"img":W.src&&(c.src=W.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var ie=i.alternate;if(ie!==null){var be=ie.memoizedState;if(be!==null){var Se=be.dehydrated;Se!==null&&Zi(Se)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}Pn||i.flags&512&&Jp(i)}catch(ye){Lt(i,i.return,ye)}}if(i===t){xe=null;break}if(c=i.sibling,c!==null){c.return=i.return,xe=c;break}xe=i.return}}function N0(t){for(;xe!==null;){var i=xe;if(i===t){xe=null;break}var c=i.sibling;if(c!==null){c.return=i.return,xe=c;break}xe=i.return}}function D0(t){for(;xe!==null;){var i=xe;try{switch(i.tag){case 0:case 11:case 15:var c=i.return;try{qd(4,i)}catch(W){Lt(i,c,W)}break;case 1:var d=i.stateNode;if(typeof d.componentDidMount=="function"){var m=i.return;try{d.componentDidMount()}catch(W){Lt(i,m,W)}}var w=i.return;try{Jp(i)}catch(W){Lt(i,w,W)}break;case 5:var O=i.return;try{Jp(i)}catch(W){Lt(i,O,W)}}}catch(W){Lt(i,i.return,W)}if(i===t){xe=null;break}var F=i.sibling;if(F!==null){F.return=i.return,xe=F;break}xe=i.return}}var dE=Math.ceil,Wd=x.ReactCurrentDispatcher,Yp=x.ReactCurrentOwner,Ur=x.ReactCurrentBatchConfig,dt=0,sn=null,Wt=null,gn=0,wr=0,fc=ri(0),Xt=0,Ul=null,ca=0,Hd=0,Xp=0,Bl=null,ar=null,Zp=0,hc=1/0,us=null,Gd=!1,eg=null,io=null,Jd=!1,so=null,Qd=0,Fl=0,tg=null,Kd=-1,Yd=0;function Jn(){return(dt&6)!==0?Et():Kd!==-1?Kd:Kd=Et()}function oo(t){return(t.mode&1)===0?1:(dt&2)!==0&&gn!==0?gn&-gn:Pd.transition!==null?(Yd===0&&(Yd=Ps()),Yd):(t=Ce,t!==0||(t=window.event,t=t===void 0?16:$t(t.type)),t)}function di(t,i,c,d){if(50<Fl)throw Fl=0,tg=null,Error(r(185));Kr(t,c,d),((dt&2)===0||t!==sn)&&(t===sn&&((dt&2)===0&&(Hd|=c),Xt===4&&ao(t,gn)),cr(t,d),c===1&&dt===0&&(i.mode&1)===0&&(hc=Et()+500,rc&&jr()))}function cr(t,i){var c=t.callbackNode;Jc(t,i);var d=Mi(t,t===sn?gn:0);if(d===0)c!==null&&pr(c),t.callbackNode=null,t.callbackPriority=0;else if(i=d&-d,t.callbackPriority!==i){if(c!=null&&pr(c),i===1)t.tag===0?Op(B0.bind(null,t)):El(B0.bind(null,t)),ta(function(){(dt&6)===0&&jr()}),c=null;else{switch(xs(d)){case 1:c=ki;break;case 4:c=Os;break;case 16:c=Qi;break;case 536870912:c=Uo;break;default:c=Qi}c=G0(c,U0.bind(null,t))}t.callbackPriority=i,t.callbackNode=c}}function U0(t,i){if(Kd=-1,Yd=0,(dt&6)!==0)throw Error(r(327));var c=t.callbackNode;if(pc()&&t.callbackNode!==c)return null;var d=Mi(t,t===sn?gn:0);if(d===0)return null;if((d&30)!==0||(d&t.expiredLanes)!==0||i)i=Xd(t,d);else{i=d;var m=dt;dt|=2;var w=z0();(sn!==t||gn!==i)&&(us=null,hc=Et()+500,ua(t,i));do try{pE();break}catch(F){F0(t,F)}while(!0);Ol(),Wd.current=w,dt=m,Wt!==null?i=0:(sn=null,gn=0,i=Xt)}if(i!==0){if(i===2&&(m=Bo(t),m!==0&&(d=m,i=ng(t,m))),i===1)throw c=Ul,ua(t,0),ao(t,d),cr(t,Et()),c;if(i===6)ao(t,d);else{if(m=t.current.alternate,(d&30)===0&&!fE(m)&&(i=Xd(t,d),i===2&&(w=Bo(t),w!==0&&(d=w,i=ng(t,w))),i===1))throw c=Ul,ua(t,0),ao(t,d),cr(t,Et()),c;switch(t.finishedWork=m,t.finishedLanes=d,i){case 0:case 1:throw Error(r(345));case 2:da(t,ar,us);break;case 3:if(ao(t,d),(d&130023424)===d&&(i=Zp+500-Et(),10<i)){if(Mi(t,0)!==0)break;if(m=t.suspendedLanes,(m&d)!==d){Jn(),t.pingedLanes|=t.suspendedLanes&m;break}t.timeoutHandle=Mn(da.bind(null,t,ar,us),i);break}da(t,ar,us);break;case 4:if(ao(t,d),(d&4194240)===d)break;for(i=t.eventTimes,m=-1;0<d;){var O=31-Bn(d);w=1<<O,O=i[O],O>m&&(m=O),d&=~w}if(d=m,d=Et()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*dE(d/1960))-d,10<d){t.timeoutHandle=Mn(da.bind(null,t,ar,us),d);break}da(t,ar,us);break;case 5:da(t,ar,us);break;default:throw Error(r(329))}}}return cr(t,Et()),t.callbackNode===c?U0.bind(null,t):null}function ng(t,i){var c=Bl;return t.current.memoizedState.isDehydrated&&(ua(t,i).flags|=256),t=Xd(t,i),t!==2&&(i=ar,ar=c,i!==null&&rg(i)),t}function rg(t){ar===null?ar=t:ar.push.apply(ar,t)}function fE(t){for(var i=t;;){if(i.flags&16384){var c=i.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var d=0;d<c.length;d++){var m=c[d],w=m.getSnapshot;m=m.value;try{if(!mr(w(),m))return!1}catch{return!1}}}if(c=i.child,i.subtreeFlags&16384&&c!==null)c.return=i,i=c;else{if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function ao(t,i){for(i&=~Xp,i&=~Hd,t.suspendedLanes|=i,t.pingedLanes&=~i,t=t.expirationTimes;0<i;){var c=31-Bn(i),d=1<<c;t[c]=-1,i&=~d}}function B0(t){if((dt&6)!==0)throw Error(r(327));pc();var i=Mi(t,0);if((i&1)===0)return cr(t,Et()),null;var c=Xd(t,i);if(t.tag!==0&&c===2){var d=Bo(t);d!==0&&(i=d,c=ng(t,d))}if(c===1)throw c=Ul,ua(t,0),ao(t,i),cr(t,Et()),c;if(c===6)throw Error(r(345));return t.finishedWork=t.current.alternate,t.finishedLanes=i,da(t,ar,us),cr(t,Et()),null}function ig(t,i){var c=dt;dt|=1;try{return t(i)}finally{dt=c,dt===0&&(hc=Et()+500,rc&&jr())}}function la(t){so!==null&&so.tag===0&&(dt&6)===0&&pc();var i=dt;dt|=1;var c=Ur.transition,d=Ce;try{if(Ur.transition=null,Ce=1,t)return t()}finally{Ce=d,Ur.transition=c,dt=i,(dt&6)===0&&jr()}}function sg(){wr=fc.current,ct(fc)}function ua(t,i){t.finishedWork=null,t.finishedLanes=0;var c=t.timeoutHandle;if(c!==-1&&(t.timeoutHandle=-1,bl(c)),Wt!==null)for(c=Wt.return;c!==null;){var d=c;switch(ac(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&na();break;case 3:Fe(),ct(fn),ct(Kt),qt();break;case 5:ft(d);break;case 4:Fe();break;case 13:ct(We);break;case 19:ct(We);break;case 10:Rl(d.type._context);break;case 22:case 23:sg()}c=c.return}if(sn=t,Wt=t=co(t.current,null),gn=wr=i,Xt=0,Ul=null,Xp=Hd=ca=0,ar=Bl=null,Ni!==null){for(i=0;i<Ni.length;i++)if(c=Ni[i],d=c.interleaved,d!==null){c.interleaved=null;var m=d.next,w=c.pending;if(w!==null){var O=w.next;w.next=m,d.next=O}c.pending=d}Ni=null}return t}function F0(t,i){do{var c=Wt;try{if(Ol(),Di.current=Bd,Nd){for(var d=xt.memoizedState;d!==null;){var m=d.queue;m!==null&&(m.pending=null),d=d.next}Nd=!1}if(ai=0,rn=Yt=xt=null,Il=!1,xl=0,Yp.current=null,c===null||c.return===null){Xt=1,Ul=i,Wt=null;break}e:{var w=t,O=c.return,F=c,W=i;if(i=gn,F.flags|=32768,W!==null&&typeof W=="object"&&typeof W.then=="function"){var ie=W,be=F,Se=be.tag;if((be.mode&1)===0&&(Se===0||Se===11||Se===15)){var ye=be.alternate;ye?(be.updateQueue=ye.updateQueue,be.memoizedState=ye.memoizedState,be.lanes=ye.lanes):(be.updateQueue=null,be.memoizedState=null)}var Ie=d0(O);if(Ie!==null){Ie.flags&=-257,f0(Ie,O,F,w,i),Ie.mode&1&&u0(w,ie,i),i=Ie,W=ie;var Le=i.updateQueue;if(Le===null){var Ne=new Set;Ne.add(W),i.updateQueue=Ne}else Le.add(W);break e}else{if((i&1)===0){u0(w,ie,i),og();break e}W=Error(r(426))}}else if(Mt&&F.mode&1){var Ft=d0(O);if(Ft!==null){(Ft.flags&65536)===0&&(Ft.flags|=256),f0(Ft,O,F,w,i),ia(uc(W,F));break e}}w=W=uc(W,F),Xt!==4&&(Xt=2),Bl===null?Bl=[w]:Bl.push(w),w=O;do{switch(w.tag){case 3:w.flags|=65536,i&=-i,w.lanes|=i;var ee=c0(w,W,i);B(w,ee);break e;case 1:F=W;var H=w.type,te=w.stateNode;if((w.flags&128)===0&&(typeof H.getDerivedStateFromError=="function"||te!==null&&typeof te.componentDidCatch=="function"&&(io===null||!io.has(te)))){w.flags|=65536,i&=-i,w.lanes|=i;var Me=l0(w,F,i);B(w,Me);break e}}w=w.return}while(w!==null)}$0(c)}catch(Ue){i=Ue,Wt===c&&c!==null&&(Wt=c=c.return);continue}break}while(!0)}function z0(){var t=Wd.current;return Wd.current=Bd,t===null?Bd:t}function og(){(Xt===0||Xt===3||Xt===2)&&(Xt=4),sn===null||(ca&268435455)===0&&(Hd&268435455)===0||ao(sn,gn)}function Xd(t,i){var c=dt;dt|=2;var d=z0();(sn!==t||gn!==i)&&(us=null,ua(t,i));do try{hE();break}catch(m){F0(t,m)}while(!0);if(Ol(),dt=c,Wd.current=d,Wt!==null)throw Error(r(261));return sn=null,gn=0,Xt}function hE(){for(;Wt!==null;)V0(Wt)}function pE(){for(;Wt!==null&&!Ba();)V0(Wt)}function V0(t){var i=H0(t.alternate,t,wr);t.memoizedProps=t.pendingProps,i===null?$0(t):Wt=i,Yp.current=null}function $0(t){var i=t;do{var c=i.alternate;if(t=i.return,(i.flags&32768)===0){if(c=oE(c,i,wr),c!==null){Wt=c;return}}else{if(c=aE(c,i),c!==null){c.flags&=32767,Wt=c;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Xt=6,Wt=null;return}}if(i=i.sibling,i!==null){Wt=i;return}Wt=i=t}while(i!==null);Xt===0&&(Xt=5)}function da(t,i,c){var d=Ce,m=Ur.transition;try{Ur.transition=null,Ce=1,gE(t,i,c,d)}finally{Ur.transition=m,Ce=d}return null}function gE(t,i,c,d){do pc();while(so!==null);if((dt&6)!==0)throw Error(r(327));c=t.finishedWork;var m=t.finishedLanes;if(c===null)return null;if(t.finishedWork=null,t.finishedLanes=0,c===t.current)throw Error(r(177));t.callbackNode=null,t.callbackPriority=0;var w=c.lanes|c.childLanes;if(Qc(t,w),t===sn&&(Wt=sn=null,gn=0),(c.subtreeFlags&2064)===0&&(c.flags&2064)===0||Jd||(Jd=!0,G0(Qi,function(){return pc(),null})),w=(c.flags&15990)!==0,(c.subtreeFlags&15990)!==0||w){w=Ur.transition,Ur.transition=null;var O=Ce;Ce=1;var F=dt;dt|=4,Yp.current=null,lE(t,c),x0(c,t),fl(Ya),ne=!!_l,Ya=_l=null,t.current=c,uE(c),Tt(),dt=F,Ce=O,Ur.transition=w}else t.current=c;if(Jd&&(Jd=!1,so=t,Qd=m),w=t.pendingLanes,w===0&&(io=null),Fa(c.stateNode),cr(t,Et()),i!==null)for(d=t.onRecoverableError,c=0;c<i.length;c++)m=i[c],d(m.value,{componentStack:m.stack,digest:m.digest});if(Gd)throw Gd=!1,t=eg,eg=null,t;return(Qd&1)!==0&&t.tag!==0&&pc(),w=t.pendingLanes,(w&1)!==0?t===tg?Fl++:(Fl=0,tg=t):Fl=0,jr(),null}function pc(){if(so!==null){var t=xs(Qd),i=Ur.transition,c=Ce;try{if(Ur.transition=null,Ce=16>t?16:t,so===null)var d=!1;else{if(t=so,so=null,Qd=0,(dt&6)!==0)throw Error(r(331));var m=dt;for(dt|=4,xe=t.current;xe!==null;){var w=xe,O=w.child;if((xe.flags&16)!==0){var F=w.deletions;if(F!==null){for(var W=0;W<F.length;W++){var ie=F[W];for(xe=ie;xe!==null;){var be=xe;switch(be.tag){case 0:case 11:case 15:Dl(8,be,w)}var Se=be.child;if(Se!==null)Se.return=be,xe=Se;else for(;xe!==null;){be=xe;var ye=be.sibling,Ie=be.return;if(O0(be),be===ie){xe=null;break}if(ye!==null){ye.return=Ie,xe=ye;break}xe=Ie}}}var Le=w.alternate;if(Le!==null){var Ne=Le.child;if(Ne!==null){Le.child=null;do{var Ft=Ne.sibling;Ne.sibling=null,Ne=Ft}while(Ne!==null)}}xe=w}}if((w.subtreeFlags&2064)!==0&&O!==null)O.return=w,xe=O;else e:for(;xe!==null;){if(w=xe,(w.flags&2048)!==0)switch(w.tag){case 0:case 11:case 15:Dl(9,w,w.return)}var ee=w.sibling;if(ee!==null){ee.return=w.return,xe=ee;break e}xe=w.return}}var H=t.current;for(xe=H;xe!==null;){O=xe;var te=O.child;if((O.subtreeFlags&2064)!==0&&te!==null)te.return=O,xe=te;else e:for(O=H;xe!==null;){if(F=xe,(F.flags&2048)!==0)try{switch(F.tag){case 0:case 11:case 15:qd(9,F)}}catch(Ue){Lt(F,F.return,Ue)}if(F===O){xe=null;break e}var Me=F.sibling;if(Me!==null){Me.return=F.return,xe=Me;break e}xe=F.return}}if(dt=m,jr(),Un&&typeof Un.onPostCommitFiberRoot=="function")try{Un.onPostCommitFiberRoot(Ci,t)}catch{}d=!0}return d}finally{Ce=c,Ur.transition=i}}return!1}function q0(t,i,c){i=uc(c,i),i=c0(t,i,1),t=k(t,i,1),i=Jn(),t!==null&&(Kr(t,1,i),cr(t,i))}function Lt(t,i,c){if(t.tag===3)q0(t,t,c);else for(;i!==null;){if(i.tag===3){q0(i,t,c);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(io===null||!io.has(d))){t=uc(c,t),t=l0(i,t,1),i=k(i,t,1),t=Jn(),i!==null&&(Kr(i,1,t),cr(i,t));break}}i=i.return}}function mE(t,i,c){var d=t.pingCache;d!==null&&d.delete(i),i=Jn(),t.pingedLanes|=t.suspendedLanes&c,sn===t&&(gn&c)===c&&(Xt===4||Xt===3&&(gn&130023424)===gn&&500>Et()-Zp?ua(t,0):Xp|=c),cr(t,i)}function W0(t,i){i===0&&((t.mode&1)===0?i=1:(i=As,As<<=1,(As&130023424)===0&&(As=4194304)));var c=Jn();t=s(t,i),t!==null&&(Kr(t,i,c),cr(t,c))}function vE(t){var i=t.memoizedState,c=0;i!==null&&(c=i.retryLane),W0(t,c)}function yE(t,i){var c=0;switch(t.tag){case 13:var d=t.stateNode,m=t.memoizedState;m!==null&&(c=m.retryLane);break;case 19:d=t.stateNode;break;default:throw Error(r(314))}d!==null&&d.delete(i),W0(t,c)}var H0;H0=function(t,i,c){if(t!==null)if(t.memoizedProps!==i.pendingProps||fn.current)or=!0;else{if((t.lanes&c)===0&&(i.flags&128)===0)return or=!1,sE(t,i,c);or=(t.flags&131072)!==0}else or=!1,Mt&&(i.flags&1048576)!==0&&Od(i,sc,i.index);switch(i.lanes=0,i.tag){case 2:var d=i.type;Vd(t,i),t=i.pendingProps;var m=yr(i,Kt.current);no(i,c),m=Ap(null,i,d,t,m,c);var w=Pp();return i.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,On(d)?(w=!0,nc(i)):w=!1,i.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,u(i),m.updater=Fd,i.stateNode=m,m._reactInternals=i,Dp(i,d,t,c),i=zp(null,i,d,!0,w,c)):(i.tag=0,Mt&&w&&oc(i),Gn(null,i,m,c),i=i.child),i;case 16:d=i.elementType;e:{switch(Vd(t,i),t=i.pendingProps,m=d._init,d=m(d._payload),i.type=d,m=i.tag=wE(d),t=ci(d,t),m){case 0:i=Fp(null,i,d,t,c);break e;case 1:i=y0(null,i,d,t,c);break e;case 11:i=h0(null,i,d,t,c);break e;case 14:i=p0(null,i,d,ci(d.type,t),c);break e}throw Error(r(306,d,""))}return i;case 0:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:ci(d,m),Fp(t,i,d,m,c);case 1:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:ci(d,m),y0(t,i,d,m,c);case 3:e:{if(_0(i),t===null)throw Error(r(387));d=i.pendingProps,w=i.memoizedState,m=w.element,p(t,i),Z(i,d,null,c);var O=i.memoizedState;if(d=O.element,w.isDehydrated)if(w={element:d,isDehydrated:!1,cache:O.cache,pendingSuspenseBoundaries:O.pendingSuspenseBoundaries,transitions:O.transitions},i.updateQueue.baseState=w,i.memoizedState=w,i.flags&256){m=uc(Error(r(423)),i),i=w0(t,i,d,c,m);break e}else if(d!==m){m=uc(Error(r(424)),i),i=w0(t,i,d,c,m);break e}else for(Hn=ti(i.stateNode.containerInfo.firstChild),Wn=i,Mt=!0,_r=null,c=Ld(i,null,d,c),i.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(eo(),d===m){i=ls(t,i,c);break e}Gn(t,i,d,c)}i=i.child}return i;case 5:return lt(i),t===null&&Tl(i),d=i.type,m=i.pendingProps,w=t!==null?t.memoizedProps:null,O=m.children,wl(d,m)?O=null:w!==null&&wl(d,w)&&(i.flags|=32),v0(t,i),Gn(t,i,O,c),i.child;case 6:return t===null&&Tl(i),null;case 13:return b0(t,i,c);case 4:return Pe(i,i.stateNode.containerInfo),d=i.pendingProps,t===null?i.child=to(i,null,d,c):Gn(t,i,d,c),i.child;case 11:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:ci(d,m),h0(t,i,d,m,c);case 7:return Gn(t,i,i.pendingProps,c),i.child;case 8:return Gn(t,i,i.pendingProps.children,c),i.child;case 12:return Gn(t,i,i.pendingProps.children,c),i.child;case 10:e:{if(d=i.type._context,m=i.pendingProps,w=i.memoizedProps,O=m.value,vt(oa,d._currentValue),d._currentValue=O,w!==null)if(mr(w.value,O)){if(w.children===m.children&&!fn.current){i=ls(t,i,c);break e}}else for(w=i.child,w!==null&&(w.return=i);w!==null;){var F=w.dependencies;if(F!==null){O=w.child;for(var W=F.firstContext;W!==null;){if(W.context===d){if(w.tag===1){W=_(-1,c&-c),W.tag=2;var ie=w.updateQueue;if(ie!==null){ie=ie.shared;var be=ie.pending;be===null?W.next=W:(W.next=be.next,be.next=W),ie.pending=W}}w.lanes|=c,W=w.alternate,W!==null&&(W.lanes|=c),Al(w.return,c,i),F.lanes|=c;break}W=W.next}}else if(w.tag===10)O=w.type===i.type?null:w.child;else if(w.tag===18){if(O=w.return,O===null)throw Error(r(341));O.lanes|=c,F=O.alternate,F!==null&&(F.lanes|=c),Al(O,c,i),O=w.sibling}else O=w.child;if(O!==null)O.return=w;else for(O=w;O!==null;){if(O===i){O=null;break}if(w=O.sibling,w!==null){w.return=O.return,O=w;break}O=O.return}w=O}Gn(t,i,m.children,c),i=i.child}return i;case 9:return m=i.type,d=i.pendingProps.children,no(i,c),m=sr(m),d=d(m),i.flags|=1,Gn(t,i,d,c),i.child;case 14:return d=i.type,m=ci(d,i.pendingProps),m=ci(d.type,m),p0(t,i,d,m,c);case 15:return g0(t,i,i.type,i.pendingProps,c);case 17:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:ci(d,m),Vd(t,i),i.tag=1,On(d)?(t=!0,nc(i)):t=!1,no(i,c),o0(i,d,m),Dp(i,d,m,c),zp(null,i,d,!0,t,c);case 19:return k0(t,i,c);case 22:return m0(t,i,c)}throw Error(r(156,i.tag))};function G0(t,i){return Ua(t,i)}function _E(t,i,c,d){this.tag=t,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Br(t,i,c,d){return new _E(t,i,c,d)}function ag(t){return t=t.prototype,!(!t||!t.isReactComponent)}function wE(t){if(typeof t=="function")return ag(t)?1:0;if(t!=null){if(t=t.$$typeof,t===Te)return 11;if(t===De)return 14}return 2}function co(t,i){var c=t.alternate;return c===null?(c=Br(t.tag,i,t.key,t.mode),c.elementType=t.elementType,c.type=t.type,c.stateNode=t.stateNode,c.alternate=t,t.alternate=c):(c.pendingProps=i,c.type=t.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=t.flags&14680064,c.childLanes=t.childLanes,c.lanes=t.lanes,c.child=t.child,c.memoizedProps=t.memoizedProps,c.memoizedState=t.memoizedState,c.updateQueue=t.updateQueue,i=t.dependencies,c.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},c.sibling=t.sibling,c.index=t.index,c.ref=t.ref,c}function Zd(t,i,c,d,m,w){var O=2;if(d=t,typeof t=="function")ag(t)&&(O=1);else if(typeof t=="string")O=5;else e:switch(t){case re:return fa(c.children,m,w,i);case me:O=8,m|=8;break;case ae:return t=Br(12,c,i,m|2),t.elementType=ae,t.lanes=w,t;case ke:return t=Br(13,c,i,m),t.elementType=ke,t.lanes=w,t;case J:return t=Br(19,c,i,m),t.elementType=J,t.lanes=w,t;case ve:return ef(c,m,w,i);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case we:O=10;break e;case S:O=9;break e;case Te:O=11;break e;case De:O=14;break e;case et:O=16,d=null;break e}throw Error(r(130,t==null?t:typeof t,""))}return i=Br(O,c,i,m),i.elementType=t,i.type=d,i.lanes=w,i}function fa(t,i,c,d){return t=Br(7,t,d,i),t.lanes=c,t}function ef(t,i,c,d){return t=Br(22,t,d,i),t.elementType=ve,t.lanes=c,t.stateNode={isHidden:!1},t}function cg(t,i,c){return t=Br(6,t,null,i),t.lanes=c,t}function lg(t,i,c){return i=Br(4,t.children!==null?t.children:[],t.key,i),i.lanes=c,i.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},i}function bE(t,i,c,d,m){this.tag=i,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Is(0),this.expirationTimes=Is(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Is(0),this.identifierPrefix=d,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function ug(t,i,c,d,m,w,O,F,W){return t=new bE(t,i,c,F,W),i===1?(i=1,w===!0&&(i|=8)):i=0,w=Br(3,null,null,i),t.current=w,w.stateNode=t,w.memoizedState={element:d,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},u(w),t}function SE(t,i,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:q,key:d==null?null:""+d,children:t,containerInfo:i,implementation:c}}function J0(t){if(!t)return tr;t=t._reactInternals;e:{if(Rr(t)!==t||t.tag!==1)throw Error(r(170));var i=t;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(On(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(r(171))}if(t.tag===1){var c=t.type;if(On(c))return Md(t,c,i)}return i}function Q0(t,i,c,d,m,w,O,F,W){return t=ug(c,d,!0,t,m,w,O,F,W),t.context=J0(null),c=t.current,d=Jn(),m=oo(c),w=_(d,m),w.callback=i??null,k(c,w,m),t.current.lanes=m,Kr(t,m,d),cr(t,d),t}function tf(t,i,c,d){var m=i.current,w=Jn(),O=oo(m);return c=J0(c),i.context===null?i.context=c:i.pendingContext=c,i=_(w,O),i.payload={element:t},d=d===void 0?null:d,d!==null&&(i.callback=d),t=k(m,i,O),t!==null&&(di(t,m,O,w),I(t,m,O)),O}function nf(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function K0(t,i){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var c=t.retryLane;t.retryLane=c!==0&&c<i?c:i}}function dg(t,i){K0(t,i),(t=t.alternate)&&K0(t,i)}function kE(){return null}var Y0=typeof reportError=="function"?reportError:function(t){console.error(t)};function fg(t){this._internalRoot=t}rf.prototype.render=fg.prototype.render=function(t){var i=this._internalRoot;if(i===null)throw Error(r(409));tf(t,i,null,null)},rf.prototype.unmount=fg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var i=t.containerInfo;la(function(){tf(null,t,null,null)}),i[vr]=null}};function rf(t){this._internalRoot=t}rf.prototype.unstable_scheduleHydration=function(t){if(t){var i=Va();t={blockedOn:null,target:t,priority:i};for(var c=0;c<zn.length&&i!==0&&i<zn[c].priority;c++);zn.splice(c,0,t),c===0&&qo(t)}};function hg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function sf(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function X0(){}function CE(t,i,c,d,m){if(m){if(typeof d=="function"){var w=d;d=function(){var ie=nf(O);w.call(ie)}}var O=Q0(i,d,t,0,null,!1,!1,"",X0);return t._reactRootContainer=O,t[vr]=O.current,Zo(t.nodeType===8?t.parentNode:t),la(),O}for(;m=t.lastChild;)t.removeChild(m);if(typeof d=="function"){var F=d;d=function(){var ie=nf(W);F.call(ie)}}var W=ug(t,0,!1,null,null,!1,!1,"",X0);return t._reactRootContainer=W,t[vr]=W.current,Zo(t.nodeType===8?t.parentNode:t),la(function(){tf(i,W,c,d)}),W}function of(t,i,c,d,m){var w=c._reactRootContainer;if(w){var O=w;if(typeof m=="function"){var F=m;m=function(){var W=nf(O);F.call(W)}}tf(i,O,t,m)}else O=CE(c,i,t,m,d);return nf(O)}Ot=function(t){switch(t.tag){case 3:var i=t.stateNode;if(i.current.memoizedState.isDehydrated){var c=un(i.pendingLanes);c!==0&&(St(i,c|1),cr(i,Et()),(dt&6)===0&&(hc=Et()+500,jr()))}break;case 13:la(function(){var d=s(t,1);if(d!==null){var m=Jn();di(d,t,1,m)}}),dg(t,1)}},Fo=function(t){if(t.tag===13){var i=s(t,134217728);if(i!==null){var c=Jn();di(i,t,134217728,c)}dg(t,134217728)}},zo=function(t){if(t.tag===13){var i=oo(t),c=s(t,i);if(c!==null){var d=Jn();di(c,t,i,d)}dg(t,i)}},Va=function(){return Ce},Vo=function(t,i){var c=Ce;try{return Ce=t,i()}finally{Ce=c}},Or=function(t,i,c){switch(i){case"input":if(mt(t,c),i=c.name,c.type==="radio"&&i!=null){for(c=t;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<c.length;i++){var d=c[i];if(d!==t&&d.form===t.form){var m=ec(d);if(!m)throw Error(r(90));$e(d),mt(d,m)}}}break;case"textarea":Jt(t,c);break;case"select":i=c.value,i!=null&&Ze(t,!!c.multiple,i,!1)}},La=ig,ja=la;var EE={usingClientEntryPoint:!1,Events:[xi,Qs,ec,xa,kn,ig]},zl={findFiberByHostInstance:nn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},ME={bundleType:zl.bundleType,version:zl.version,rendererPackageName:zl.rendererPackageName,rendererConfig:zl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=qe(t),t===null?null:t.stateNode},findFiberByHostInstance:zl.findFiberByHostInstance||kE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var af=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!af.isDisabled&&af.supportsFiber)try{Ci=af.inject(ME),Un=af}catch{}}return Qn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=EE,Qn.createPortal=function(t,i){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!hg(i))throw Error(r(200));return SE(t,i,null,c)},Qn.createRoot=function(t,i){if(!hg(t))throw Error(r(299));var c=!1,d="",m=Y0;return i!=null&&(i.unstable_strictMode===!0&&(c=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onRecoverableError!==void 0&&(m=i.onRecoverableError)),i=ug(t,1,!1,null,null,c,!1,d,m),t[vr]=i.current,Zo(t.nodeType===8?t.parentNode:t),new fg(i)},Qn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var i=t._reactInternals;if(i===void 0)throw typeof t.render=="function"?Error(r(188)):(t=Object.keys(t).join(","),Error(r(268,t)));return t=qe(i),t=t===null?null:t.stateNode,t},Qn.flushSync=function(t){return la(t)},Qn.hydrate=function(t,i,c){if(!sf(i))throw Error(r(200));return of(null,t,i,!0,c)},Qn.hydrateRoot=function(t,i,c){if(!hg(t))throw Error(r(405));var d=c!=null&&c.hydratedSources||null,m=!1,w="",O=Y0;if(c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(w=c.identifierPrefix),c.onRecoverableError!==void 0&&(O=c.onRecoverableError)),i=Q0(i,null,t,1,c??null,m,!1,w,O),t[vr]=i.current,Zo(t),d)for(t=0;t<d.length;t++)c=d[t],m=c._getVersion,m=m(c._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[c,m]:i.mutableSourceEagerHydrationData.push(c,m);return new rf(i)},Qn.render=function(t,i,c){if(!sf(i))throw Error(r(200));return of(null,t,i,!1,c)},Qn.unmountComponentAtNode=function(t){if(!sf(t))throw Error(r(40));return t._reactRootContainer?(la(function(){of(null,null,t,!1,function(){t._reactRootContainer=null,t[vr]=null})}),!0):!1},Qn.unstable_batchedUpdates=ig,Qn.unstable_renderSubtreeIntoContainer=function(t,i,c,d){if(!sf(c))throw Error(r(200));if(t==null||t._reactInternals===void 0)throw Error(r(38));return of(t,i,c,!1,d)},Qn.version="18.3.1-next-f1338f8080-20240426",Qn}var Pg;function dw(){if(Pg)return ff.exports;Pg=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),ff.exports=uw(),ff.exports}var Ig;function fw(){if(Ig)return Hl;Ig=1;var n=dw();return Hl.createRoot=n.createRoot,Hl.hydrateRoot=n.hydrateRoot,Hl}var hw=fw();const pw=kg(hw),gw="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let gf=(n=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=gw[r[n]&63];return e};const ha={};function xg(n){return"init"in n}function mf(n){return!!n.write}function Lg(n){return"v"in n||"e"in n}function Gl(n){if("e"in n)throw n.e;if((ha?"production":void 0)!=="production"&&!("v"in n))throw new Error("[Bug] atom state is not initialized");return n.v}const Jl=new WeakMap;function jg(n){var e;return Ql(n)&&!!((e=Jl.get(n))!=null&&e[0])}function mw(n){const e=Jl.get(n);e?.[0]&&(e[0]=!1,e[1].forEach(r=>r()))}function vf(n,e){let r=Jl.get(n);if(!r){r=[!0,new Set],Jl.set(n,r);const a=()=>{r[0]=!1};n.then(a,a)}r[1].add(e)}function Ql(n){return typeof n?.then=="function"}function Ng(n,e,r){if(!r.p.has(n)){r.p.add(n);const a=()=>r.p.delete(n);e.then(a,a)}}function Dg(n,e,r){var a;const l=new Set;for(const f of((a=r.get(n))==null?void 0:a.t)||[])r.has(f)&&l.add(f);for(const f of e.p)l.add(f);return l}const vw=(n,e,...r)=>e.read(...r),yw=(n,e,...r)=>e.write(...r),_w=(n,e)=>{var r;return(r=e.unstable_onInit)==null?void 0:r.call(e,n)},ww=(n,e,r)=>{var a;return(a=e.onMount)==null?void 0:a.call(e,r)},bw=(n,e)=>{const r=mn(n),a=r[0],l=r[9];if((ha?"production":void 0)!=="production"&&!e)throw new Error("Atom is undefined or null");let f=a.get(e);return f||(f={d:new Map,p:new Set,n:0},a.set(e,f),l?.(n,e)),f},Sw=n=>{const e=mn(n),r=e[1],a=e[3],l=e[4],f=e[5],h=e[6],y=e[13],v=[],b=C=>{try{C()}catch(T){v.push(T)}};do{h.f&&b(h.f);const C=new Set,T=C.add.bind(C);a.forEach(L=>{var A;return(A=r.get(L))==null?void 0:A.l.forEach(T)}),a.clear(),f.forEach(T),f.clear(),l.forEach(T),l.clear(),C.forEach(b),a.size&&y(n)}while(a.size||f.size||l.size);if(v.length)throw new AggregateError(v)},kw=n=>{const e=mn(n),r=e[1],a=e[2],l=e[3],f=e[11],h=e[14],y=e[17],v=[],b=new WeakSet,C=new WeakSet,T=Array.from(l);for(;T.length;){const L=T[T.length-1],A=f(n,L);if(C.has(L)){T.pop();continue}if(b.has(L)){if(a.get(L)===A.n)v.push([L,A]);else if((ha?"production":void 0)!=="production"&&a.has(L))throw new Error("[Bug] invalidated atom exists");C.add(L),T.pop();continue}b.add(L);for(const P of Dg(L,A,r))b.has(P)||T.push(P)}for(let L=v.length-1;L>=0;--L){const[A,P]=v[L];let R=!1;for(const N of P.d.keys())if(N!==A&&l.has(N)){R=!0;break}R&&(h(n,A),y(n,A)),a.delete(A)}},Cw=(n,e)=>{var r,a;const l=mn(n),f=l[1],h=l[2],y=l[3],v=l[6],b=l[7],C=l[11],T=l[12],L=l[13],A=l[14],P=l[16],R=l[17],N=C(n,e);if(Lg(N)&&(f.has(e)&&h.get(e)!==N.n||Array.from(N.d).every(([me,ae])=>A(n,me).n===ae)))return N;N.d.clear();let V=!0;function G(){f.has(e)&&(R(n,e),L(n),T(n))}function X(me){var ae;if(me===e){const S=C(n,me);if(!Lg(S))if(xg(me))Kl(n,me,me.init);else throw new Error("no atom init");return Gl(S)}const we=A(n,me);try{return Gl(we)}finally{N.d.set(me,we.n),jg(N.v)&&Ng(e,N.v,we),(ae=f.get(me))==null||ae.t.add(e),V||G()}}let x,$;const q={get signal(){return x||(x=new AbortController),x.signal},get setSelf(){return(ha?"production":void 0)!=="production"&&!mf(e)&&console.warn("setSelf function cannot be used with read-only atom"),!$&&mf(e)&&($=(...me)=>{if((ha?"production":void 0)!=="production"&&V&&console.warn("setSelf function cannot be called in sync"),!V)try{return P(n,e,...me)}finally{L(n),T(n)}}),$}},re=N.n;try{const me=b(n,e,X,q);return Kl(n,e,me),Ql(me)&&(vf(me,()=>x?.abort()),me.then(G,G)),(r=v.r)==null||r.call(v,e),N}catch(me){return delete N.v,N.e=me,++N.n,N}finally{V=!1,re!==N.n&&h.get(e)===re&&(h.set(e,N.n),y.add(e),(a=v.c)==null||a.call(v,e))}},Ew=(n,e)=>{const r=mn(n),a=r[1],l=r[2],f=r[11],h=[e];for(;h.length;){const y=h.pop(),v=f(n,y);for(const b of Dg(y,v,a)){const C=f(n,b);l.set(b,C.n),h.push(b)}}},Ug=(n,e,...r)=>{const a=mn(n),l=a[3],f=a[6],h=a[8],y=a[11],v=a[12],b=a[13],C=a[14],T=a[15],L=a[17];let A=!0;const P=N=>Gl(C(n,N)),R=(N,...V)=>{var G;const X=y(n,N);try{if(N===e){if(!xg(N))throw new Error("atom not writable");const x=X.n,$=V[0];Kl(n,N,$),L(n,N),x!==X.n&&(l.add(N),(G=f.c)==null||G.call(f,N),T(n,N));return}else return Ug(n,N,...V)}finally{A||(b(n),v(n))}};try{return h(n,e,P,R,...r)}finally{A=!1}},Mw=(n,e)=>{var r;const a=mn(n),l=a[1],f=a[3],h=a[6],y=a[11],v=a[15],b=a[18],C=a[19],T=y(n,e),L=l.get(e);if(L&&!jg(T.v)){for(const[A,P]of T.d)if(!L.d.has(A)){const R=y(n,A);b(n,A).t.add(e),L.d.add(A),P!==R.n&&(f.add(A),(r=h.c)==null||r.call(h,A),v(n,A))}for(const A of L.d||[])if(!T.d.has(A)){L.d.delete(A);const P=C(n,A);P?.t.delete(e)}}},Bg=(n,e)=>{var r;const a=mn(n),l=a[1],f=a[4],h=a[6],y=a[10],v=a[11],b=a[12],C=a[13],T=a[14],L=a[16],A=v(n,e);let P=l.get(e);if(!P){T(n,e);for(const R of A.d.keys())Bg(n,R).t.add(e);if(P={l:new Set,d:new Set(A.d.keys()),t:new Set},l.set(e,P),(r=h.m)==null||r.call(h,e),mf(e)){const R=()=>{let N=!0;const V=(...G)=>{try{return L(n,e,...G)}finally{N||(C(n),b(n))}};try{const G=y(n,e,V);G&&(P.u=()=>{N=!0;try{G()}finally{N=!1}})}finally{N=!1}};f.add(R)}}return P},Tw=(n,e)=>{var r;const a=mn(n),l=a[1],f=a[5],h=a[6],y=a[11],v=a[19],b=y(n,e);let C=l.get(e);if(C&&!C.l.size&&!Array.from(C.t).some(T=>{var L;return(L=l.get(T))==null?void 0:L.d.has(e)})){C.u&&f.add(C.u),C=void 0,l.delete(e),(r=h.u)==null||r.call(h,e);for(const T of b.d.keys()){const L=v(n,T);L?.t.delete(e)}return}return C},Kl=(n,e,r)=>{const a=mn(n)[11],l=a(n,e),f="v"in l,h=l.v;if(Ql(r))for(const y of l.d.keys())Ng(e,r,a(n,y));l.v=r,delete l.e,(!f||!Object.is(h,l.v))&&(++l.n,Ql(h)&&mw(h))},Ow=(n,e)=>{const r=mn(n)[14];return Gl(r(n,e))},Rw=(n,e,...r)=>{const a=mn(n),l=a[12],f=a[13],h=a[16];try{return h(n,e,...r)}finally{f(n),l(n)}},Aw=(n,e,r)=>{const a=mn(n),l=a[12],f=a[18],h=a[19],v=f(n,e).l;return v.add(r),l(n),()=>{v.delete(r),h(n,e),l(n)}},Fg=new WeakMap,mn=n=>{const e=Fg.get(n);if((ha?"production":void 0)!=="production"&&!e)throw new Error("Store must be created by buildStore to read its building blocks");return e};function Pw(...n){const e={get(a){const l=mn(e)[21];return l(e,a)},set(a,...l){const f=mn(e)[22];return f(e,a,...l)},sub(a,l){const f=mn(e)[23];return f(e,a,l)}},r=[new WeakMap,new WeakMap,new WeakMap,new Set,new Set,new Set,{},vw,yw,_w,ww,bw,Sw,kw,Cw,Ew,Ug,Mw,Bg,Tw,Kl,Ow,Rw,Aw,void 0].map((a,l)=>n[l]||a);return Fg.set(e,Object.freeze(r)),e}const zg={};let Iw=0;function st(n,e){const r=`atom${++Iw}`,a={toString(){return(zg?"production":void 0)!=="production"&&this.debugLabel?r+":"+this.debugLabel:r}};return typeof n=="function"?a.read=n:(a.init=n,a.read=xw,a.write=Lw),e&&(a.write=e),a}function xw(n){return n(this)}function Lw(n,e,r){return e(this,typeof r=="function"?r(n(this)):r)}function Vg(){return Pw()}let _c;function jw(){return _c||(_c=Vg(),(zg?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=_c),globalThis.__JOTAI_DEFAULT_STORE__!==_c&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),_c}const Nw={};function wc(n,e){let r=null;const a=new Map,l=new Set,f=y=>{let v;if(v=a.get(y),v!==void 0)if(r?.(v[1],y))f.remove(y);else return v[0];const b=n(y);return a.set(y,[b,Date.now()]),h("CREATE",y,b),b},h=(y,v,b)=>{for(const C of l)C({type:y,param:v,atom:b})};return f.unstable_listen=y=>(l.add(y),()=>{l.delete(y)}),f.getParams=()=>a.keys(),f.remove=y=>{{if(!a.has(y))return;const[v]=a.get(y);a.delete(y),h("REMOVE",y,v)}},f.setShouldRemove=y=>{if(r=y,!!r)for(const[v,[b,C]]of a)r(C,v)&&(a.delete(v),h("REMOVE",v,b))},f}const Dw=n=>typeof n?.then=="function";function Uw(n=()=>{try{return window.localStorage}catch(r){(Nw?"production":void 0)!=="production"&&typeof window<"u"&&console.warn(r);return}},e){var r;let a,l;const f={getItem:(v,b)=>{var C,T;const L=P=>{if(P=P||"",a!==P){try{l=JSON.parse(P,e?.reviver)}catch{return b}a=P}return l},A=(T=(C=n())==null?void 0:C.getItem(v))!=null?T:null;return Dw(A)?A.then(L):L(A)},setItem:(v,b)=>{var C;return(C=n())==null?void 0:C.setItem(v,JSON.stringify(b,void 0))},removeItem:v=>{var b;return(b=n())==null?void 0:b.removeItem(v)}},h=v=>(b,C,T)=>v(b,L=>{let A;try{A=JSON.parse(L||"")}catch{A=T}C(A)});let y;try{y=(r=n())==null?void 0:r.subscribe}catch{}return!y&&typeof window<"u"&&typeof window.addEventListener=="function"&&window.Storage&&(y=(v,b)=>{if(!(n()instanceof window.Storage))return()=>{};const C=T=>{T.storageArea===n()&&T.key===v&&b(T.newValue)};return window.addEventListener("storage",C),()=>{window.removeEventListener("storage",C)}}),y&&(f.subscribe=h(y)),f}Uw();const Bw={},$g=U.createContext(void 0);function qg(n){return U.useContext($g)||jw()}function Fw({children:n,store:e}){const r=U.useRef(void 0);return!e&&!r.current&&(r.current=Vg()),U.createElement($g.Provider,{value:e||r.current},n)}const yf=n=>typeof n?.then=="function",_f=n=>{n.status||(n.status="pending",n.then(e=>{n.status="fulfilled",n.value=e},e=>{n.status="rejected",n.reason=e}))},zw=tt.use||(n=>{if(n.status==="pending")throw n;if(n.status==="fulfilled")return n.value;throw n.status==="rejected"?n.reason:(_f(n),n)}),wf=new WeakMap,Wg=(n,e)=>{let r=wf.get(n);return r||(r=new Promise((a,l)=>{let f=n;const h=b=>C=>{f===b&&a(C)},y=b=>C=>{f===b&&l(C)},v=()=>{try{const b=e();yf(b)?(wf.set(b,r),f=b,b.then(h(b),y(b)),vf(b,v)):a(b)}catch(b){l(b)}};n.then(h(n),y(n)),vf(n,v)}),wf.set(n,r)),r};function uo(n,e){const{delay:r,unstable_promiseStatus:a=!tt.use}={},l=qg(),[[f,h,y],v]=U.useReducer(C=>{const T=l.get(n);return Object.is(C[0],T)&&C[1]===l&&C[2]===n?C:[T,l,n]},void 0,()=>[l.get(n),l,n]);let b=f;if((h!==l||y!==n)&&(v(),b=l.get(n)),U.useEffect(()=>{const C=l.sub(n,()=>{if(a)try{const T=l.get(n);yf(T)&&_f(Wg(T,()=>l.get(n)))}catch{}if(typeof r=="number"){setTimeout(v,r);return}v()});return v(),C},[l,n,r,a]),U.useDebugValue(b),yf(b)){const C=Wg(b,()=>l.get(n));return a&&_f(C),zw(C)}return b}function Vw(n,e){const r=qg();return U.useCallback((...l)=>{if((Bw?"production":void 0)!=="production"&&!("write"in n))throw new Error("not writable atom");return r.set(n,...l)},[r,n])}function it(n,e){const r=U.useMemo(()=>st(null,(a,l,...f)=>n(a,l,...f)),[n]);return Vw(r)}function Hg(n,e){if(n==null)return{};var r,a,l=(function(h,y){if(h==null)return{};var v={};for(var b in h)if({}.hasOwnProperty.call(h,b)){if(y.indexOf(b)!==-1)continue;v[b]=h[b]}return v})(n,e);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(n);for(a=0;a<f.length;a++)r=f[a],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(n,r)&&(l[r]=n[r])}return l}function lr(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function ut(n){return ut=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(n)}function Gg(n){var e=(function(r,a){if(ut(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var f=l.call(r,a);if(ut(f)!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)})(n,"string");return ut(e)=="symbol"?e:e+""}function Jg(n,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,Gg(a.key),a)}}function ur(n,e,r){return e&&Jg(n.prototype,e),r&&Jg(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}function Yl(n,e){if(e&&(ut(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r})(n)}function Fr(n){return Fr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Fr(n)}function bc(n,e){return bc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,a){return r.__proto__=a,r},bc(n,e)}function Xl(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&bc(n,e)}function fi(n,e,r){return(e=Gg(e))in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function Qg(n,e,r,a,l,f,h){try{var y=n[f](h),v=y.value}catch(b){return void r(b)}y.done?e(v):Promise.resolve(v).then(a,l)}function Ge(n){return function(){var e=this,r=arguments;return new Promise((function(a,l){var f=n.apply(e,r);function h(v){Qg(f,a,l,h,y,"next",v)}function y(v){Qg(f,a,l,h,y,"throw",v)}h(void 0)}))}}function Kg(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,a=Array(e);r<e;r++)a[r]=n[r];return a}function vn(n,e){return(function(r){if(Array.isArray(r))return r})(n)||(function(r,a){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var f,h,y,v,b=[],C=!0,T=!1;try{if(y=(l=l.call(r)).next,a===0){if(Object(l)!==l)return;C=!1}else for(;!(C=(f=y.call(l)).done)&&(b.push(f.value),b.length!==a);C=!0);}catch(L){T=!0,h=L}finally{try{if(!C&&l.return!=null&&(v=l.return(),Object(v)!==v))return}finally{if(T)throw h}}return b}})(n,e)||(function(r,a){if(r){if(typeof r=="string")return Kg(r,a);var l={}.toString.call(r).slice(8,-1);return l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set"?Array.from(r):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?Kg(r,a):void 0}})(n,e)||(function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function $w(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Yg,Zl={exports:{}},bf=(function(){if(Yg)return Zl.exports;Yg=1;var n,e=typeof Reflect=="object"?Reflect:null,r=e&&typeof e.apply=="function"?e.apply:function(R,N,V){return Function.prototype.apply.call(R,N,V)};n=e&&typeof e.ownKeys=="function"?e.ownKeys:Object.getOwnPropertySymbols?function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:function(R){return Object.getOwnPropertyNames(R)};var a=Number.isNaN||function(R){return R!=R};function l(){l.init.call(this)}Zl.exports=l,Zl.exports.once=function(R,N){return new Promise((function(V,G){function X($){R.removeListener(N,x),G($)}function x(){typeof R.removeListener=="function"&&R.removeListener("error",X),V([].slice.call(arguments))}P(R,N,x,{once:!0}),N!=="error"&&(function($,q,re){typeof $.on=="function"&&P($,"error",q,re)})(R,X,{once:!0})}))},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var f=10;function h(R){if(typeof R!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof R)}function y(R){return R._maxListeners===void 0?l.defaultMaxListeners:R._maxListeners}function v(R,N,V,G){var X,x,$,q;if(h(V),(x=R._events)===void 0?(x=R._events=Object.create(null),R._eventsCount=0):(x.newListener!==void 0&&(R.emit("newListener",N,V.listener?V.listener:V),x=R._events),$=x[N]),$===void 0)$=x[N]=V,++R._eventsCount;else if(typeof $=="function"?$=x[N]=G?[V,$]:[$,V]:G?$.unshift(V):$.push(V),(X=y(R))>0&&$.length>X&&!$.warned){$.warned=!0;var re=new Error("Possible EventEmitter memory leak detected. "+$.length+" "+String(N)+" listeners added. Use emitter.setMaxListeners() to increase limit");re.name="MaxListenersExceededWarning",re.emitter=R,re.type=N,re.count=$.length,q=re,console&&console.warn&&console.warn(q)}return R}function b(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function C(R,N,V){var G={fired:!1,wrapFn:void 0,target:R,type:N,listener:V},X=b.bind(G);return X.listener=V,G.wrapFn=X,X}function T(R,N,V){var G=R._events;if(G===void 0)return[];var X=G[N];return X===void 0?[]:typeof X=="function"?V?[X.listener||X]:[X]:V?(function(x){for(var $=new Array(x.length),q=0;q<$.length;++q)$[q]=x[q].listener||x[q];return $})(X):A(X,X.length)}function L(R){var N=this._events;if(N!==void 0){var V=N[R];if(typeof V=="function")return 1;if(V!==void 0)return V.length}return 0}function A(R,N){for(var V=new Array(N),G=0;G<N;++G)V[G]=R[G];return V}function P(R,N,V,G){if(typeof R.on=="function")G.once?R.once(N,V):R.on(N,V);else{if(typeof R.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof R);R.addEventListener(N,(function X(x){G.once&&R.removeEventListener(N,X),V(x)}))}}return Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(R){if(typeof R!="number"||R<0||a(R))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+R+".");f=R}}),l.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(R){if(typeof R!="number"||R<0||a(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this},l.prototype.getMaxListeners=function(){return y(this)},l.prototype.emit=function(R){for(var N=[],V=1;V<arguments.length;V++)N.push(arguments[V]);var G=R==="error",X=this._events;if(X!==void 0)G=G&&X.error===void 0;else if(!G)return!1;if(G){var x;if(N.length>0&&(x=N[0]),x instanceof Error)throw x;var $=new Error("Unhandled error."+(x?" ("+x.message+")":""));throw $.context=x,$}var q=X[R];if(q===void 0)return!1;if(typeof q=="function")r(q,this,N);else{var re=q.length,me=A(q,re);for(V=0;V<re;++V)r(me[V],this,N)}return!0},l.prototype.addListener=function(R,N){return v(this,R,N,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(R,N){return v(this,R,N,!0)},l.prototype.once=function(R,N){return h(N),this.on(R,C(this,R,N)),this},l.prototype.prependOnceListener=function(R,N){return h(N),this.prependListener(R,C(this,R,N)),this},l.prototype.removeListener=function(R,N){var V,G,X,x,$;if(h(N),(G=this._events)===void 0)return this;if((V=G[R])===void 0)return this;if(V===N||V.listener===N)--this._eventsCount==0?this._events=Object.create(null):(delete G[R],G.removeListener&&this.emit("removeListener",R,V.listener||N));else if(typeof V!="function"){for(X=-1,x=V.length-1;x>=0;x--)if(V[x]===N||V[x].listener===N){$=V[x].listener,X=x;break}if(X<0)return this;X===0?V.shift():(function(q,re){for(;re+1<q.length;re++)q[re]=q[re+1];q.pop()})(V,X),V.length===1&&(G[R]=V[0]),G.removeListener!==void 0&&this.emit("removeListener",R,$||N)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(R){var N,V,G;if((V=this._events)===void 0)return this;if(V.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):V[R]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete V[R]),this;if(arguments.length===0){var X,x=Object.keys(V);for(G=0;G<x.length;++G)(X=x[G])!=="removeListener"&&this.removeAllListeners(X);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(N=V[R])=="function")this.removeListener(R,N);else if(N!==void 0)for(G=N.length-1;G>=0;G--)this.removeListener(R,N[G]);return this},l.prototype.listeners=function(R){return T(this,R,!0)},l.prototype.rawListeners=function(R){return T(this,R,!1)},l.listenerCount=function(R,N){return typeof R.listenerCount=="function"?R.listenerCount(N):L.call(R,N)},l.prototype.listenerCount=L,l.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]},Zl.exports})(),eu=$w(bf),Xg=Object.prototype.hasOwnProperty;function Zg(n,e,r){for(r of n.keys())if(In(r,e))return r}function In(n,e){var r,a,l;if(n===e)return!0;if(n&&e&&(r=n.constructor)===e.constructor){if(r===Date)return n.getTime()===e.getTime();if(r===RegExp)return n.toString()===e.toString();if(r===Array){if((a=n.length)===e.length)for(;a--&&In(n[a],e[a]););return a===-1}if(r===Set){if(n.size!==e.size)return!1;for(a of n)if((l=a)&&typeof l=="object"&&!(l=Zg(e,l))||!e.has(l))return!1;return!0}if(r===Map){if(n.size!==e.size)return!1;for(a of n)if((l=a[0])&&typeof l=="object"&&!(l=Zg(e,l))||!In(a[1],e.get(l)))return!1;return!0}if(r===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(r===DataView){if((a=n.byteLength)===e.byteLength)for(;a--&&n.getInt8(a)===e.getInt8(a););return a===-1}if(ArrayBuffer.isView(n)){if((a=n.byteLength)===e.byteLength)for(;a--&&n[a]===e[a];);return a===-1}if(!r||typeof n=="object"){for(r in a=0,n)if(Xg.call(n,r)&&++a&&!Xg.call(e,r)||!(r in e)||!In(n[r],e[r]))return!1;return Object.keys(e).length===a}}return n!=n&&e!=e}const qw={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},em={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},jt={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},xn={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},fs={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};let _e=class gc{static getFirstMatch(e,r){const a=r.match(e);return a&&a.length>0&&a[1]||""}static getSecondMatch(e,r){const a=r.match(e);return a&&a.length>1&&a[2]||""}static matchAndReturnConst(e,r,a){if(e.test(r))return a}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const r=e.split(".").splice(0,2).map((a=>parseInt(a,10)||0));if(r.push(0),r[0]===10)switch(r[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const r=e.split(".").splice(0,2).map((a=>parseInt(a,10)||0));if(r.push(0),!(r[0]===1&&r[1]<5))return r[0]===1&&r[1]<6?"Cupcake":r[0]===1&&r[1]>=6?"Donut":r[0]===2&&r[1]<2?"Eclair":r[0]===2&&r[1]===2?"Froyo":r[0]===2&&r[1]>2?"Gingerbread":r[0]===3?"Honeycomb":r[0]===4&&r[1]<1?"Ice Cream Sandwich":r[0]===4&&r[1]<4?"Jelly Bean":r[0]===4&&r[1]>=4?"KitKat":r[0]===5?"Lollipop":r[0]===6?"Marshmallow":r[0]===7?"Nougat":r[0]===8?"Oreo":r[0]===9?"Pie":void 0}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,r,a=!1){const l=gc.getVersionPrecision(e),f=gc.getVersionPrecision(r);let h=Math.max(l,f),y=0;const v=gc.map([e,r],(b=>{const C=h-gc.getVersionPrecision(b),T=b+new Array(C+1).join(".0");return gc.map(T.split("."),(L=>new Array(20-L.length).join("0")+L)).reverse()}));for(a&&(y=h-Math.min(l,f)),h-=1;h>=y;){if(v[0][h]>v[1][h])return 1;if(v[0][h]===v[1][h]){if(h===y)return 0;h-=1}else if(v[0][h]<v[1][h])return-1}}static map(e,r){const a=[];let l;if(Array.prototype.map)return Array.prototype.map.call(e,r);for(l=0;l<e.length;l+=1)a.push(r(e[l]));return a}static find(e,r){let a,l;if(Array.prototype.find)return Array.prototype.find.call(e,r);for(a=0,l=e.length;a<l;a+=1){const f=e[a];if(r(f,a))return f}}static assign(e,...r){const a=e;let l,f;if(Object.assign)return Object.assign(e,...r);for(l=0,f=r.length;l<f;l+=1){const h=r[l];typeof h=="object"&&h!==null&&Object.keys(h).forEach((y=>{a[y]=h[y]}))}return e}static getBrowserAlias(e){return qw[e]}static getBrowserTypeByAlias(e){return em[e]||""}};const yt=/version\/(\d+(\.?_?\d+)+)/i,Ww=[{test:[/googlebot/i],describe(n){const e={name:"Googlebot"},r=_e.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,n)||_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/opera/i],describe(n){const e={name:"Opera"},r=_e.getFirstMatch(yt,n)||_e.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/opr\/|opios/i],describe(n){const e={name:"Opera"},r=_e.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,n)||_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/SamsungBrowser/i],describe(n){const e={name:"Samsung Internet for Android"},r=_e.getFirstMatch(yt,n)||_e.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/Whale/i],describe(n){const e={name:"NAVER Whale Browser"},r=_e.getFirstMatch(yt,n)||_e.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/MZBrowser/i],describe(n){const e={name:"MZ Browser"},r=_e.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,n)||_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/focus/i],describe(n){const e={name:"Focus"},r=_e.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,n)||_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/swing/i],describe(n){const e={name:"Swing"},r=_e.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,n)||_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/coast/i],describe(n){const e={name:"Opera Coast"},r=_e.getFirstMatch(yt,n)||_e.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(n){const e={name:"Opera Touch"},r=_e.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,n)||_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/yabrowser/i],describe(n){const e={name:"Yandex Browser"},r=_e.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,n)||_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/ucbrowser/i],describe(n){const e={name:"UC Browser"},r=_e.getFirstMatch(yt,n)||_e.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/Maxthon|mxios/i],describe(n){const e={name:"Maxthon"},r=_e.getFirstMatch(yt,n)||_e.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/epiphany/i],describe(n){const e={name:"Epiphany"},r=_e.getFirstMatch(yt,n)||_e.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/puffin/i],describe(n){const e={name:"Puffin"},r=_e.getFirstMatch(yt,n)||_e.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/sleipnir/i],describe(n){const e={name:"Sleipnir"},r=_e.getFirstMatch(yt,n)||_e.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/k-meleon/i],describe(n){const e={name:"K-Meleon"},r=_e.getFirstMatch(yt,n)||_e.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/micromessenger/i],describe(n){const e={name:"WeChat"},r=_e.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,n)||_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/qqbrowser/i],describe(n){const e={name:/qqbrowserlite/i.test(n)?"QQ Browser Lite":"QQ Browser"},r=_e.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,n)||_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/msie|trident/i],describe(n){const e={name:"Internet Explorer"},r=_e.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/\sedg\//i],describe(n){const e={name:"Microsoft Edge"},r=_e.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/edg([ea]|ios)/i],describe(n){const e={name:"Microsoft Edge"},r=_e.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/vivaldi/i],describe(n){const e={name:"Vivaldi"},r=_e.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/seamonkey/i],describe(n){const e={name:"SeaMonkey"},r=_e.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/sailfish/i],describe(n){const e={name:"Sailfish"},r=_e.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,n);return r&&(e.version=r),e}},{test:[/silk/i],describe(n){const e={name:"Amazon Silk"},r=_e.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/phantom/i],describe(n){const e={name:"PhantomJS"},r=_e.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/slimerjs/i],describe(n){const e={name:"SlimerJS"},r=_e.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const e={name:"BlackBerry"},r=_e.getFirstMatch(yt,n)||_e.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/(web|hpw)[o0]s/i],describe(n){const e={name:"WebOS Browser"},r=_e.getFirstMatch(yt,n)||_e.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/bada/i],describe(n){const e={name:"Bada"},r=_e.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/tizen/i],describe(n){const e={name:"Tizen"},r=_e.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,n)||_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/qupzilla/i],describe(n){const e={name:"QupZilla"},r=_e.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,n)||_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/firefox|iceweasel|fxios/i],describe(n){const e={name:"Firefox"},r=_e.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/electron/i],describe(n){const e={name:"Electron"},r=_e.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/MiuiBrowser/i],describe(n){const e={name:"Miui"},r=_e.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/chromium/i],describe(n){const e={name:"Chromium"},r=_e.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,n)||_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/chrome|crios|crmo/i],describe(n){const e={name:"Chrome"},r=_e.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/GSA/i],describe(n){const e={name:"Google Search"},r=_e.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test(n){const e=!n.test(/like android/i),r=n.test(/android/i);return e&&r},describe(n){const e={name:"Android Browser"},r=_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/playstation 4/i],describe(n){const e={name:"PlayStation 4"},r=_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/safari|applewebkit/i],describe(n){const e={name:"Safari"},r=_e.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/.*/i],describe(n){const e=n.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:_e.getFirstMatch(e,n),version:_e.getSecondMatch(e,n)}}}];var Hw=[{test:[/Roku\/DVP/],describe(n){const e=_e.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,n);return{name:xn.Roku,version:e}}},{test:[/windows phone/i],describe(n){const e=_e.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,n);return{name:xn.WindowsPhone,version:e}}},{test:[/windows /i],describe(n){const e=_e.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,n),r=_e.getWindowsVersionName(e);return{name:xn.Windows,version:e,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(n){const e={name:xn.iOS},r=_e.getSecondMatch(/(Version\/)(\d[\d.]+)/,n);return r&&(e.version=r),e}},{test:[/macintosh/i],describe(n){const e=_e.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,n).replace(/[_\s]/g,"."),r=_e.getMacOSVersionName(e),a={name:xn.MacOS,version:e};return r&&(a.versionName=r),a}},{test:[/(ipod|iphone|ipad)/i],describe(n){const e=_e.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,n).replace(/[_\s]/g,".");return{name:xn.iOS,version:e}}},{test(n){const e=!n.test(/like android/i),r=n.test(/android/i);return e&&r},describe(n){const e=_e.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,n),r=_e.getAndroidVersionName(e),a={name:xn.Android,version:e};return r&&(a.versionName=r),a}},{test:[/(web|hpw)[o0]s/i],describe(n){const e=_e.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,n),r={name:xn.WebOS};return e&&e.length&&(r.version=e),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const e=_e.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,n)||_e.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,n)||_e.getFirstMatch(/\bbb(\d+)/i,n);return{name:xn.BlackBerry,version:e}}},{test:[/bada/i],describe(n){const e=_e.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,n);return{name:xn.Bada,version:e}}},{test:[/tizen/i],describe(n){const e=_e.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,n);return{name:xn.Tizen,version:e}}},{test:[/linux/i],describe:()=>({name:xn.Linux})},{test:[/CrOS/],describe:()=>({name:xn.ChromeOS})},{test:[/PlayStation 4/],describe(n){const e=_e.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,n);return{name:xn.PlayStation4,version:e}}}],Gw=[{test:[/googlebot/i],describe:()=>({type:"bot",vendor:"Google"})},{test:[/huawei/i],describe(n){const e=_e.getFirstMatch(/(can-l01)/i,n)&&"Nova",r={type:jt.mobile,vendor:"Huawei"};return e&&(r.model=e),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:()=>({type:jt.tablet,vendor:"Nexus"})},{test:[/ipad/i],describe:()=>({type:jt.tablet,vendor:"Apple",model:"iPad"})},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:()=>({type:jt.tablet,vendor:"Apple",model:"iPad"})},{test:[/kftt build/i],describe:()=>({type:jt.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"})},{test:[/silk/i],describe:()=>({type:jt.tablet,vendor:"Amazon"})},{test:[/tablet(?! pc)/i],describe:()=>({type:jt.tablet})},{test(n){const e=n.test(/ipod|iphone/i),r=n.test(/like (ipod|iphone)/i);return e&&!r},describe(n){const e=_e.getFirstMatch(/(ipod|iphone)/i,n);return{type:jt.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:()=>({type:jt.mobile,vendor:"Nexus"})},{test:[/[^-]mobi/i],describe:()=>({type:jt.mobile})},{test:n=>n.getBrowserName(!0)==="blackberry",describe:()=>({type:jt.mobile,vendor:"BlackBerry"})},{test:n=>n.getBrowserName(!0)==="bada",describe:()=>({type:jt.mobile})},{test:n=>n.getBrowserName()==="windows phone",describe:()=>({type:jt.mobile,vendor:"Microsoft"})},{test(n){const e=Number(String(n.getOSVersion()).split(".")[0]);return n.getOSName(!0)==="android"&&e>=3},describe:()=>({type:jt.tablet})},{test:n=>n.getOSName(!0)==="android",describe:()=>({type:jt.mobile})},{test:n=>n.getOSName(!0)==="macos",describe:()=>({type:jt.desktop,vendor:"Apple"})},{test:n=>n.getOSName(!0)==="windows",describe:()=>({type:jt.desktop})},{test:n=>n.getOSName(!0)==="linux",describe:()=>({type:jt.desktop})},{test:n=>n.getOSName(!0)==="playstation 4",describe:()=>({type:jt.tv})},{test:n=>n.getOSName(!0)==="roku",describe:()=>({type:jt.tv})}],Jw=[{test:n=>n.getBrowserName(!0)==="microsoft edge",describe(n){if(/\sedg\//i.test(n))return{name:fs.Blink};const e=_e.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,n);return{name:fs.EdgeHTML,version:e}}},{test:[/trident/i],describe(n){const e={name:fs.Trident},r=_e.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:n=>n.test(/presto/i),describe(n){const e={name:fs.Presto},r=_e.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test(n){const e=n.test(/gecko/i),r=n.test(/like gecko/i);return e&&!r},describe(n){const e={name:fs.Gecko},r=_e.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/(apple)?webkit\/537\.36/i],describe:()=>({name:fs.Blink})},{test:[/(apple)?webkit/i],describe(n){const e={name:fs.WebKit},r=_e.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}}];let tm=class{constructor(e,r=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},r!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=_e.find(Ww,(r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some((a=>this.test(a)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=_e.find(Hw,(r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some((a=>this.test(a)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:r}=this.getOS();return e?String(r).toLowerCase()||"":r||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:r}=this.getPlatform();return e?String(r).toLowerCase()||"":r||""}parsePlatform(){this.parsedResult.platform={};const e=_e.find(Gw,(r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some((a=>this.test(a)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=_e.find(Jw,(r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some((a=>this.test(a)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return _e.assign({},this.parsedResult)}satisfies(e){const r={};let a=0;const l={};let f=0;if(Object.keys(e).forEach((h=>{const y=e[h];typeof y=="string"?(l[h]=y,f+=1):typeof y=="object"&&(r[h]=y,a+=1)})),a>0){const h=Object.keys(r),y=_e.find(h,(b=>this.isOS(b)));if(y){const b=this.satisfies(r[y]);if(b!==void 0)return b}const v=_e.find(h,(b=>this.isPlatform(b)));if(v){const b=this.satisfies(r[v]);if(b!==void 0)return b}}if(f>0){const h=Object.keys(l),y=_e.find(h,(v=>this.isBrowser(v,!0)));if(y!==void 0)return this.compareVersion(l[y])}}isBrowser(e,r=!1){const a=this.getBrowserName().toLowerCase();let l=e.toLowerCase();const f=_e.getBrowserTypeByAlias(l);return r&&f&&(l=f.toLowerCase()),l===a}compareVersion(e){let r=[0],a=e,l=!1;const f=this.getBrowserVersion();if(typeof f=="string")return e[0]===">"||e[0]==="<"?(a=e.substr(1),e[1]==="="?(l=!0,a=e.substr(2)):r=[],e[0]===">"?r.push(1):r.push(-1)):e[0]==="="?a=e.substr(1):e[0]==="~"&&(l=!0,a=e.substr(1)),r.indexOf(_e.compareVersions(f,a,l))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,r=!1){return this.isBrowser(e,r)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some((r=>this.is(r)))}};/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */let Qw=class{static getParser(e,r=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new tm(e,r)}static parse(e){return new tm(e).getResult()}static get BROWSER_MAP(){return em}static get ENGINE_MAP(){return fs}static get OS_MAP(){return xn}static get PLATFORMS_MAP(){return jt}};function tu(){return Date.now()+Math.random().toString()}function Sc(){throw new Error("Method must be implemented in subclass")}function nm(n,e){return e!=null&&e.proxyUrl?e.proxyUrl+(e.proxyUrl.slice(-1)==="/"?"":"/")+n.substring(8):n}function nu(n){return n!=null&&n.callObjectBundleUrlOverride?n.callObjectBundleUrlOverride:nm("https://c.daily.co/call-machine/versioned/".concat("0.84.0","/static/call-machine-object-bundle.js"),n)}function ru(n){try{new URL(n)}catch{return!1}return!0}const Ct=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,fo="8.55.0",pt=globalThis;function iu(n,e,r){const a=pt,l=a.__SENTRY__=a.__SENTRY__||{},f=l[fo]=l[fo]||{};return f[n]||(f[n]=e())}const ho=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Sf=["debug","info","warn","error","log","assert","trace"],su={};function kc(n){if(!("console"in pt))return n();const e=pt.console,r={},a=Object.keys(su);a.forEach((l=>{const f=su[l];r[l]=e[l],e[l]=f}));try{return n()}finally{a.forEach((l=>{e[l]=r[l]}))}}const Ye=iu("logger",(function(){let n=!1;const e={enable:()=>{n=!0},disable:()=>{n=!1},isEnabled:()=>n};return ho?Sf.forEach((r=>{e[r]=(...a)=>{n&&kc((()=>{pt.console[r](`Sentry Logger [${r}]:`,...a)}))}})):Sf.forEach((r=>{e[r]=()=>{}})),e})),po="?",rm=/\(error: (.*)\)/,im=/captureMessage|captureException/;function ou(n){return n[n.length-1]||{}}const sm="<anonymous>";function hs(n){try{return n&&typeof n=="function"&&n.name||sm}catch{return sm}}function om(n){const e=n.exception;if(e){const r=[];try{return e.values.forEach((a=>{a.stacktrace.frames&&r.push(...a.stacktrace.frames)})),r}catch{return}}}const au={},am={};function go(n,e){au[n]=au[n]||[],au[n].push(e)}function mo(n,e){if(!am[n]){am[n]=!0;try{e()}catch(r){ho&&Ye.error(`Error while instrumenting ${n}`,r)}}}function zr(n,e){const r=n&&au[n];if(r)for(const a of r)try{a(e)}catch(l){ho&&Ye.error(`Error while triggering instrumentation handler.
Type: ${n}
Name: ${hs(a)}
Error:`,l)}}let kf=null;function Kw(){kf=pt.onerror,pt.onerror=function(n,e,r,a,l){return zr("error",{column:a,error:l,line:r,msg:n,url:e}),!!kf&&kf.apply(this,arguments)},pt.onerror.__SENTRY_INSTRUMENTED__=!0}let Cf=null;function Yw(){Cf=pt.onunhandledrejection,pt.onunhandledrejection=function(n){return zr("unhandledrejection",n),!Cf||Cf.apply(this,arguments)},pt.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function cu(){return Ef(pt),pt}function Ef(n){const e=n.__SENTRY__=n.__SENTRY__||{};return e.version=e.version||fo,e[fo]=e[fo]||{}}const cm=Object.prototype.toString;function Mf(n){switch(cm.call(n)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return vo(n,Error)}}function pa(n,e){return cm.call(n)===`[object ${e}]`}function lm(n){return pa(n,"ErrorEvent")}function um(n){return pa(n,"DOMError")}function zi(n){return pa(n,"String")}function Tf(n){return typeof n=="object"&&n!==null&&"__sentry_template_string__"in n&&"__sentry_template_values__"in n}function Of(n){return n===null||Tf(n)||typeof n!="object"&&typeof n!="function"}function ga(n){return pa(n,"Object")}function lu(n){return typeof Event<"u"&&vo(n,Event)}function uu(n){return!!(n&&n.then&&typeof n.then=="function")}function vo(n,e){try{return n instanceof e}catch{return!1}}function dm(n){return!(typeof n!="object"||n===null||!n.__isVue&&!n._isVue)}const Rf=pt;function fm(n,e={}){if(!n)return"<unknown>";try{let r=n;const a=5,l=[];let f=0,h=0;const y=" > ",v=y.length;let b;const C=Array.isArray(e)?e:e.keyAttrs,T=!Array.isArray(e)&&e.maxStringLength||80;for(;r&&f++<a&&(b=Xw(r,C),!(b==="html"||f>1&&h+l.length*v+b.length>=T));)l.push(b),h+=b.length,r=r.parentNode;return l.reverse().join(y)}catch{return"<unknown>"}}function Xw(n,e){const r=n,a=[];if(!r||!r.tagName)return"";if(Rf.HTMLElement&&r instanceof HTMLElement&&r.dataset){if(r.dataset.sentryComponent)return r.dataset.sentryComponent;if(r.dataset.sentryElement)return r.dataset.sentryElement}a.push(r.tagName.toLowerCase());const l=e&&e.length?e.filter((h=>r.getAttribute(h))).map((h=>[h,r.getAttribute(h)])):null;if(l&&l.length)l.forEach((h=>{a.push(`[${h[0]}="${h[1]}"]`)}));else{r.id&&a.push(`#${r.id}`);const h=r.className;if(h&&zi(h)){const y=h.split(/\s+/);for(const v of y)a.push(`.${v}`)}}const f=["aria-label","type","name","title","alt"];for(const h of f){const y=r.getAttribute(h);y&&a.push(`[${h}="${y}"]`)}return a.join("")}function ma(n,e=0){return typeof n!="string"||e===0||n.length<=e?n:`${n.slice(0,e)}...`}function hm(n,e){if(!Array.isArray(n))return"";const r=[];for(let a=0;a<n.length;a++){const l=n[a];try{dm(l)?r.push("[VueViewModel]"):r.push(String(l))}catch{r.push("[value cannot be serialized]")}}return r.join(e)}function Zw(n,e,r=!1){return!!zi(n)&&(pa(e,"RegExp")?e.test(n):!!zi(e)&&(r?n===e:n.includes(e)))}function du(n,e=[],r=!1){return e.some((a=>Zw(n,a,r)))}function dr(n,e,r){if(!(e in n))return;const a=n[e],l=r(a);typeof l=="function"&&pm(l,a);try{n[e]=l}catch{ho&&Ye.log(`Failed to replace method "${e}" in object`,n)}}function yo(n,e,r){try{Object.defineProperty(n,e,{value:r,writable:!0,configurable:!0})}catch{ho&&Ye.log(`Failed to add non-enumerable property "${e}" to object`,n)}}function pm(n,e){try{const r=e.prototype||{};n.prototype=e.prototype=r,yo(n,"__sentry_original__",e)}catch{}}function Af(n){return n.__sentry_original__}function gm(n){if(Mf(n))return{message:n.message,name:n.name,stack:n.stack,...vm(n)};if(lu(n)){const e={type:n.type,target:mm(n.target),currentTarget:mm(n.currentTarget),...vm(n)};return typeof CustomEvent<"u"&&vo(n,CustomEvent)&&(e.detail=n.detail),e}return n}function mm(n){try{return e=n,typeof Element<"u"&&vo(e,Element)?fm(n):Object.prototype.toString.call(n)}catch{return"<unknown>"}var e}function vm(n){if(typeof n=="object"&&n!==null){const e={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}return{}}function br(n){return Pf(n,new Map)}function Pf(n,e){if((function(r){if(!ga(r))return!1;try{const a=Object.getPrototypeOf(r).constructor.name;return!a||a==="Object"}catch{return!0}})(n)){const r=e.get(n);if(r!==void 0)return r;const a={};e.set(n,a);for(const l of Object.getOwnPropertyNames(n))n[l]!==void 0&&(a[l]=Pf(n[l],e));return a}if(Array.isArray(n)){const r=e.get(n);if(r!==void 0)return r;const a=[];return e.set(n,a),n.forEach((l=>{a.push(Pf(l,e))})),a}return n}function Cc(){return Date.now()/1e3}const Vi=(function(){const{performance:n}=pt;if(!n||!n.now)return Cc;const e=Date.now()-n.now(),r=n.timeOrigin==null?e:n.timeOrigin;return()=>(r+n.now())/1e3})();function Sr(){const n=pt,e=n.crypto||n.msCrypto;let r=()=>16*Math.random();try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(r=()=>{const a=new Uint8Array(1);return e.getRandomValues(a),a[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,(a=>(a^(15&r())>>a/4).toString(16)))}function ym(n){return n.exception&&n.exception.values?n.exception.values[0]:void 0}function ps(n){const{message:e,event_id:r}=n;if(e)return e;const a=ym(n);return a?a.type&&a.value?`${a.type}: ${a.value}`:a.type||a.value||r||"<unknown>":r||"<unknown>"}function If(n,e,r){const a=n.exception=n.exception||{},l=a.values=a.values||[],f=l[0]=l[0]||{};f.value||(f.value=e||""),f.type||(f.type="Error")}function va(n,e){const r=ym(n);if(!r)return;const a=r.mechanism;if(r.mechanism={type:"generic",handled:!0,...a,...e},e&&"data"in e){const l={...a&&a.data,...e.data};r.mechanism.data=l}}function _m(n){if((function(e){try{return e.__sentry_captured__}catch{}})(n))return!0;try{yo(n,"__sentry_captured__",!0)}catch{}return!1}var $i;function _o(n){return new kr((e=>{e(n)}))}function fu(n){return new kr(((e,r)=>{r(n)}))}(()=>{const{performance:n}=pt;!n||!n.now||(n.now(),n.timing&&n.timing.navigationStart)})(),(function(n){n[n.PENDING=0]="PENDING",n[n.RESOLVED=1]="RESOLVED",n[n.REJECTED=2]="REJECTED"})($i||($i={}));class kr{constructor(e){kr.prototype.__init.call(this),kr.prototype.__init2.call(this),kr.prototype.__init3.call(this),kr.prototype.__init4.call(this),this._state=$i.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(r){this._reject(r)}}then(e,r){return new kr(((a,l)=>{this._handlers.push([!1,f=>{if(e)try{a(e(f))}catch(h){l(h)}else a(f)},f=>{if(r)try{a(r(f))}catch(h){l(h)}else l(f)}]),this._executeHandlers()}))}catch(e){return this.then((r=>r),e)}finally(e){return new kr(((r,a)=>{let l,f;return this.then((h=>{f=!1,l=h,e&&e()}),(h=>{f=!0,l=h,e&&e()})).then((()=>{f?a(l):r(l)}))}))}__init(){this._resolve=e=>{this._setResult($i.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult($i.REJECTED,e)}}__init3(){this._setResult=(e,r)=>{this._state===$i.PENDING&&(uu(r)?r.then(this._resolve,this._reject):(this._state=e,this._value=r,this._executeHandlers()))}}__init4(){this._executeHandlers=()=>{if(this._state===$i.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach((r=>{r[0]||(this._state===$i.RESOLVED&&r[1](this._value),this._state===$i.REJECTED&&r[2](this._value),r[0]=!0)}))}}}function eb(n){const e=Vi(),r={sid:Sr(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>(function(a){return br({sid:`${a.sid}`,init:a.init,started:new Date(1e3*a.started).toISOString(),timestamp:new Date(1e3*a.timestamp).toISOString(),status:a.status,errors:a.errors,did:typeof a.did=="number"||typeof a.did=="string"?`${a.did}`:void 0,duration:a.duration,abnormal_mechanism:a.abnormal_mechanism,attrs:{release:a.release,environment:a.environment,ip_address:a.ipAddress,user_agent:a.userAgent}})})(r)};return n&&ya(r,n),r}function ya(n,e={}){if(e.user&&(!n.ipAddress&&e.user.ip_address&&(n.ipAddress=e.user.ip_address),n.did||e.did||(n.did=e.user.id||e.user.email||e.user.username)),n.timestamp=e.timestamp||Vi(),e.abnormal_mechanism&&(n.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(n.ignoreDuration=e.ignoreDuration),e.sid&&(n.sid=e.sid.length===32?e.sid:Sr()),e.init!==void 0&&(n.init=e.init),!n.did&&e.did&&(n.did=`${e.did}`),typeof e.started=="number"&&(n.started=e.started),n.ignoreDuration)n.duration=void 0;else if(typeof e.duration=="number")n.duration=e.duration;else{const r=n.timestamp-n.started;n.duration=r>=0?r:0}e.release&&(n.release=e.release),e.environment&&(n.environment=e.environment),!n.ipAddress&&e.ipAddress&&(n.ipAddress=e.ipAddress),!n.userAgent&&e.userAgent&&(n.userAgent=e.userAgent),typeof e.errors=="number"&&(n.errors=e.errors),e.status&&(n.status=e.status)}function wm(){return Sr()}function xf(){return Sr().substring(16)}function hu(n,e,r=2){if(!e||typeof e!="object"||r<=0)return e;if(n&&e&&Object.keys(e).length===0)return n;const a={...n};for(const l in e)Object.prototype.hasOwnProperty.call(e,l)&&(a[l]=hu(a[l],e[l],r-1));return a}const Lf="_sentrySpan";function bm(n,e){e?yo(n,Lf,e):delete n[Lf]}function Sm(n){return n[Lf]}class jf{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:wm(),spanId:xf()}}clone(){const e=new jf;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,bm(e,Sm(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&ya(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,r){return this._tags={...this._tags,[e]:r},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,r){return this._extra={...this._extra,[e]:r},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,r){return r===null?delete this._contexts[e]:this._contexts[e]=r,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const r=typeof e=="function"?e(this):e,[a,l]=r instanceof gs?[r.getScopeData(),r.getRequestSession()]:ga(r)?[e,e.requestSession]:[],{tags:f,extra:h,user:y,contexts:v,level:b,fingerprint:C=[],propagationContext:T}=a||{};return this._tags={...this._tags,...f},this._extra={...this._extra,...h},this._contexts={...this._contexts,...v},y&&Object.keys(y).length&&(this._user=y),b&&(this._level=b),C.length&&(this._fingerprint=C),T&&(this._propagationContext=T),l&&(this._requestSession=l),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,bm(this,void 0),this._attachments=[],this.setPropagationContext({traceId:wm()}),this._notifyScopeListeners(),this}addBreadcrumb(e,r){const a=typeof r=="number"?r:100;if(a<=0)return this;const l={timestamp:Cc(),...e};return this._breadcrumbs.push(l),this._breadcrumbs.length>a&&(this._breadcrumbs=this._breadcrumbs.slice(-a),this._client&&this._client.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:Sm(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=hu(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext={spanId:xf(),...e},this}getPropagationContext(){return this._propagationContext}captureException(e,r){const a=r&&r.event_id?r.event_id:Sr();if(!this._client)return Ye.warn("No client configured on scope - will not capture exception!"),a;const l=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:l,...r,event_id:a},this),a}captureMessage(e,r,a){const l=a&&a.event_id?a.event_id:Sr();if(!this._client)return Ye.warn("No client configured on scope - will not capture message!"),l;const f=new Error(e);return this._client.captureMessage(e,r,{originalException:e,syntheticException:f,...a,event_id:l},this),l}captureEvent(e,r){const a=r&&r.event_id?r.event_id:Sr();return this._client?(this._client.captureEvent(e,{...r,event_id:a},this),a):(Ye.warn("No client configured on scope - will not capture event!"),a)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((e=>{e(this)})),this._notifyingListeners=!1)}}const gs=jf;class tb{constructor(e,r){let a,l;a=e||new gs,l=r||new gs,this._stack=[{scope:a}],this._isolationScope=l}withScope(e){const r=this._pushScope();let a;try{a=e(r)}catch(l){throw this._popScope(),l}return uu(a)?a.then((l=>(this._popScope(),l)),(l=>{throw this._popScope(),l})):(this._popScope(),a)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function _a(){const n=Ef(cu());return n.stack=n.stack||new tb(iu("defaultCurrentScope",(()=>new gs)),iu("defaultIsolationScope",(()=>new gs)))}function nb(n){return _a().withScope(n)}function rb(n,e){const r=_a();return r.withScope((()=>(r.getStackTop().scope=n,e(n))))}function km(n){return _a().withScope((()=>n(_a().getIsolationScope())))}function Nf(n){const e=Ef(n);return e.acs?e.acs:{withIsolationScope:km,withScope:nb,withSetScope:rb,withSetIsolationScope:(r,a)=>km(a),getCurrentScope:()=>_a().getScope(),getIsolationScope:()=>_a().getIsolationScope()}}function wo(){return Nf(cu()).getCurrentScope()}function Ec(){return Nf(cu()).getIsolationScope()}function yn(){return wo().getClient()}function ib(n){const e=n.getPropagationContext(),{traceId:r,spanId:a,parentSpanId:l}=e;return br({trace_id:r,span_id:a,parent_span_id:l})}function sb(n){const e=n._sentryMetrics;if(!e)return;const r={};for(const[,[a,l]]of e)(r[a]||(r[a]=[])).push(br(l));return r}const ob=/^sentry-/;function ab(n){const e=(function(a){if(!(!a||!zi(a)&&!Array.isArray(a)))return Array.isArray(a)?a.reduce(((l,f)=>{const h=Cm(f);return Object.entries(h).forEach((([y,v])=>{l[y]=v})),l}),{}):Cm(a)})(n);if(!e)return;const r=Object.entries(e).reduce(((a,[l,f])=>(l.match(ob)&&(a[l.slice(7)]=f),a)),{});return Object.keys(r).length>0?r:void 0}function Cm(n){return n.split(",").map((e=>e.split("=").map((r=>decodeURIComponent(r.trim()))))).reduce(((e,[r,a])=>(r&&a&&(e[r]=a),e)),{})}let Em=!1;function cb(n){const{spanId:e,traceId:r,isRemote:a}=n.spanContext();return br({parent_span_id:a?e:Df(n).parent_span_id,span_id:a?xf():e,trace_id:r})}function Mm(n){return typeof n=="number"?Tm(n):Array.isArray(n)?n[0]+n[1]/1e9:n instanceof Date?Tm(n.getTime()):Vi()}function Tm(n){return n>9999999999?n/1e3:n}function Df(n){if((function(e){return typeof e.getSpanJSON=="function"})(n))return n.getSpanJSON();try{const{spanId:e,traceId:r}=n.spanContext();if((function(a){const l=a;return!!(l.attributes&&l.startTime&&l.name&&l.endTime&&l.status)})(n)){const{attributes:a,startTime:l,name:f,endTime:h,parentSpanId:y,status:v}=n;return br({span_id:e,trace_id:r,data:a,description:f,parent_span_id:y,start_timestamp:Mm(l),timestamp:Mm(h)||void 0,status:lb(v),op:a["sentry.op"],origin:a["sentry.origin"],_metrics_summary:sb(n)})}return{span_id:e,trace_id:r}}catch{return{}}}function lb(n){if(n&&n.code!==0)return n.code===1?"ok":n.message||"unknown_error"}function Om(n){return n._sentryRootSpan||n}function ub(){Em||(kc((()=>{console.warn("[Sentry] Deprecation warning: Returning null from `beforeSendSpan` will be disallowed from SDK version 9.0.0 onwards. The callback will only support mutating spans. To drop certain spans, configure the respective integrations directly.")})),Em=!0)}const Uf="production";function Rm(n,e){const r=e.getOptions(),{publicKey:a}=e.getDsn()||{},l=br({environment:r.environment||Uf,release:r.release,public_key:a,trace_id:n});return e.emit("createDsc",l),l}function db(n){const e=yn();if(!e)return{};const r=Om(n),a=r._frozenDsc;if(a)return a;const l=r.spanContext().traceState,f=l&&l.get("sentry.dsc"),h=f&&ab(f);if(h)return h;const y=Rm(n.spanContext().traceId,e),v=Df(r),b=v.data||{},C=b["sentry.sample_rate"];C!=null&&(y.sample_rate=`${C}`);const T=b["sentry.source"],L=v.description;return T!=="url"&&L&&(y.transaction=L),(function(A){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const P=yn(),R=P&&P.getOptions();return!!R&&(R.enableTracing||"tracesSampleRate"in R||"tracesSampler"in R)})()&&(y.sampled=String((function(A){const{traceFlags:P}=A.spanContext();return P===1})(r))),e.emit("createDsc",y,r),y}const fb=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function pu(n,e=!1){const{host:r,path:a,pass:l,port:f,projectId:h,protocol:y,publicKey:v}=n;return`${y}://${v}${e&&l?`:${l}`:""}@${r}${f?`:${f}`:""}/${a&&`${a}/`}${h}`}function Am(n){return{protocol:n.protocol,publicKey:n.publicKey||"",pass:n.pass||"",host:n.host,port:n.port||"",path:n.path||"",projectId:n.projectId}}function hb(n){const e=typeof n=="string"?(function(r){const a=fb.exec(r);if(!a)return void kc((()=>{console.error(`Invalid Sentry Dsn: ${r}`)}));const[l,f,h="",y="",v="",b=""]=a.slice(1);let C="",T=b;const L=T.split("/");if(L.length>1&&(C=L.slice(0,-1).join("/"),T=L.pop()),T){const A=T.match(/^\d+/);A&&(T=A[0])}return Am({host:y,pass:h,path:C,projectId:T,port:v,protocol:l,publicKey:f})})(n):Am(n);if(e&&(function(r){if(!ho)return!0;const{port:a,projectId:l,protocol:f}=r;return!(["protocol","publicKey","host","projectId"].find((h=>!r[h]&&(Ye.error(`Invalid Sentry Dsn: ${h} missing`),!0)))||(l.match(/^\d+$/)?(function(h){return h==="http"||h==="https"})(f)?a&&isNaN(parseInt(a,10))&&(Ye.error(`Invalid Sentry Dsn: Invalid port ${a}`),1):(Ye.error(`Invalid Sentry Dsn: Invalid protocol ${f}`),1):(Ye.error(`Invalid Sentry Dsn: Invalid projectId ${l}`),1)))})(e))return e}function qi(n,e=100,r=1/0){try{return Bf("",n,e,r)}catch(a){return{ERROR:`**non-serializable** (${a})`}}}function Pm(n,e=3,r=102400){const a=qi(n,e);return l=a,(function(f){return~-encodeURI(f).split(/%..|./).length})(JSON.stringify(l))>r?Pm(n,e-1,r):a;var l}function Bf(n,e,r=1/0,a=1/0,l=(function(){const f=typeof WeakSet=="function",h=f?new WeakSet:[];return[function(y){if(f)return!!h.has(y)||(h.add(y),!1);for(let v=0;v<h.length;v++)if(h[v]===y)return!0;return h.push(y),!1},function(y){if(f)h.delete(y);else for(let v=0;v<h.length;v++)if(h[v]===y){h.splice(v,1);break}}]})()){const[f,h]=l;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const y=(function(A,P){try{if(A==="domain"&&P&&typeof P=="object"&&P._events)return"[Domain]";if(A==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&P===global)return"[Global]";if(typeof window<"u"&&P===window)return"[Window]";if(typeof document<"u"&&P===document)return"[Document]";if(dm(P))return"[VueViewModel]";if(ga(R=P)&&"nativeEvent"in R&&"preventDefault"in R&&"stopPropagation"in R)return"[SyntheticEvent]";if(typeof P=="number"&&!Number.isFinite(P))return`[${P}]`;if(typeof P=="function")return`[Function: ${hs(P)}]`;if(typeof P=="symbol")return`[${String(P)}]`;if(typeof P=="bigint")return`[BigInt: ${String(P)}]`;const N=(function(V){const G=Object.getPrototypeOf(V);return G?G.constructor.name:"null prototype"})(P);return/^HTML(\w*)Element$/.test(N)?`[HTMLElement: ${N}]`:`[object ${N}]`}catch(N){return`**non-serializable** (${N})`}var R})(n,e);if(!y.startsWith("[object "))return y;if(e.__sentry_skip_normalization__)return e;const v=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:r;if(v===0)return y.replace("object ","");if(f(e))return"[Circular ~]";const b=e;if(b&&typeof b.toJSON=="function")try{return Bf("",b.toJSON(),v-1,a,l)}catch{}const C=Array.isArray(e)?[]:{};let T=0;const L=gm(e);for(const A in L){if(!Object.prototype.hasOwnProperty.call(L,A))continue;if(T>=a){C[A]="[MaxProperties ~]";break}const P=L[A];C[A]=Bf(A,P,v-1,a,l),T++}return h(e),C}function Mc(n,e=[]){return[n,e]}function pb(n,e){const[r,a]=n;return[r,[...a,e]]}function Im(n,e){const r=n[1];for(const a of r)if(e(a,a[0].type))return!0;return!1}function Ff(n){return pt.__SENTRY__&&pt.__SENTRY__.encodePolyfill?pt.__SENTRY__.encodePolyfill(n):new TextEncoder().encode(n)}function gb(n){const[e,r]=n;let a=JSON.stringify(e);function l(f){typeof a=="string"?a=typeof f=="string"?a+f:[Ff(a),f]:a.push(typeof f=="string"?Ff(f):f)}for(const f of r){const[h,y]=f;if(l(`
${JSON.stringify(h)}
`),typeof y=="string"||y instanceof Uint8Array)l(y);else{let v;try{v=JSON.stringify(y)}catch{v=JSON.stringify(qi(y))}l(v)}}return typeof a=="string"?a:(function(f){const h=f.reduce(((b,C)=>b+C.length),0),y=new Uint8Array(h);let v=0;for(const b of f)y.set(b,v),v+=b.length;return y})(a)}function mb(n){const e=typeof n.data=="string"?Ff(n.data):n.data;return[br({type:"attachment",length:e.length,filename:n.filename,content_type:n.contentType,attachment_type:n.attachmentType}),e]}const vb={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket",raw_security:"security"};function xm(n){return vb[n]}function Lm(n){if(!n||!n.sdk)return;const{name:e,version:r}=n.sdk;return{name:e,version:r}}function yb(n,e,r,a){const l=Lm(r),f=n.type&&n.type!=="replay_event"?n.type:"event";(function(y,v){v&&(y.sdk=y.sdk||{},y.sdk.name=y.sdk.name||v.name,y.sdk.version=y.sdk.version||v.version,y.sdk.integrations=[...y.sdk.integrations||[],...v.integrations||[]],y.sdk.packages=[...y.sdk.packages||[],...v.packages||[]])})(n,r&&r.sdk);const h=(function(y,v,b,C){const T=y.sdkProcessingMetadata&&y.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:y.event_id,sent_at:new Date().toISOString(),...v&&{sdk:v},...!!b&&C&&{dsn:pu(C)},...T&&{trace:br({...T})}}})(n,l,a,e);return delete n.sdkProcessingMetadata,Mc(h,[[{type:f},n]])}function zf(n,e,r,a=0){return new kr(((l,f)=>{const h=n[a];if(e===null||typeof h!="function")l(e);else{const y=h({...e},r);Ct&&h.id&&y===null&&Ye.log(`Event processor "${h.id}" dropped event`),uu(y)?y.then((v=>zf(n,v,r,a+1).then(l))).then(null,f):zf(n,y,r,a+1).then(l).then(null,f)}}))}let gu,jm,Vf;function _b(n,e){const{fingerprint:r,span:a,breadcrumbs:l,sdkProcessingMetadata:f}=e;(function(h,y){const{extra:v,tags:b,user:C,contexts:T,level:L,transactionName:A}=y,P=br(v);P&&Object.keys(P).length&&(h.extra={...P,...h.extra});const R=br(b);R&&Object.keys(R).length&&(h.tags={...R,...h.tags});const N=br(C);N&&Object.keys(N).length&&(h.user={...N,...h.user});const V=br(T);V&&Object.keys(V).length&&(h.contexts={...V,...h.contexts}),L&&(h.level=L),A&&h.type!=="transaction"&&(h.transaction=A)})(n,e),a&&(function(h,y){h.contexts={trace:cb(y),...h.contexts},h.sdkProcessingMetadata={dynamicSamplingContext:db(y),...h.sdkProcessingMetadata};const v=Om(y),b=Df(v).description;b&&!h.transaction&&h.type==="transaction"&&(h.transaction=b)})(n,a),(function(h,y){h.fingerprint=h.fingerprint?Array.isArray(h.fingerprint)?h.fingerprint:[h.fingerprint]:[],y&&(h.fingerprint=h.fingerprint.concat(y)),h.fingerprint&&!h.fingerprint.length&&delete h.fingerprint})(n,r),(function(h,y){const v=[...h.breadcrumbs||[],...y];h.breadcrumbs=v.length?v:void 0})(n,l),(function(h,y){h.sdkProcessingMetadata={...h.sdkProcessingMetadata,...y}})(n,f)}function Nm(n,e){const{extra:r,tags:a,user:l,contexts:f,level:h,sdkProcessingMetadata:y,breadcrumbs:v,fingerprint:b,eventProcessors:C,attachments:T,propagationContext:L,transactionName:A,span:P}=e;mu(n,"extra",r),mu(n,"tags",a),mu(n,"user",l),mu(n,"contexts",f),n.sdkProcessingMetadata=hu(n.sdkProcessingMetadata,y,2),h&&(n.level=h),A&&(n.transactionName=A),P&&(n.span=P),v.length&&(n.breadcrumbs=[...n.breadcrumbs,...v]),b.length&&(n.fingerprint=[...n.fingerprint,...b]),C.length&&(n.eventProcessors=[...n.eventProcessors,...C]),T.length&&(n.attachments=[...n.attachments,...T]),n.propagationContext={...n.propagationContext,...L}}function mu(n,e,r){n[e]=hu(n[e],r,1)}function wb(n,e,r,a,l,f){const{normalizeDepth:h=3,normalizeMaxBreadth:y=1e3}=n,v={...e,event_id:e.event_id||r.event_id||Sr(),timestamp:e.timestamp||Cc()},b=r.integrations||n.integrations.map((P=>P.name));(function(P,R){const{environment:N,release:V,dist:G,maxValueLength:X=250}=R;P.environment=P.environment||N||Uf,!P.release&&V&&(P.release=V),!P.dist&&G&&(P.dist=G),P.message&&(P.message=ma(P.message,X));const x=P.exception&&P.exception.values&&P.exception.values[0];x&&x.value&&(x.value=ma(x.value,X));const $=P.request;$&&$.url&&($.url=ma($.url,X))})(v,n),(function(P,R){R.length>0&&(P.sdk=P.sdk||{},P.sdk.integrations=[...P.sdk.integrations||[],...R])})(v,b),l&&l.emit("applyFrameMetadata",e),e.type===void 0&&(function(P,R){const N=(function(V){const G=pt._sentryDebugIds;if(!G)return{};const X=Object.keys(G);return Vf&&X.length===jm||(jm=X.length,Vf=X.reduce(((x,$)=>{gu||(gu={});const q=gu[$];if(q)x[q[0]]=q[1];else{const re=V($);for(let me=re.length-1;me>=0;me--){const ae=re[me],we=ae&&ae.filename,S=G[$];if(we&&S){x[we]=S,gu[$]=[we,S];break}}}return x}),{})),Vf})(R);try{P.exception.values.forEach((V=>{V.stacktrace.frames.forEach((G=>{N&&G.filename&&(G.debug_id=N[G.filename])}))}))}catch{}})(v,n.stackParser);const C=(function(P,R){if(!R)return P;const N=P?P.clone():new gs;return N.update(R),N})(a,r.captureContext);r.mechanism&&va(v,r.mechanism);const T=l?l.getEventProcessors():[],L=iu("globalScope",(()=>new gs)).getScopeData();f&&Nm(L,f.getScopeData()),C&&Nm(L,C.getScopeData());const A=[...r.attachments||[],...L.attachments];return A.length&&(r.attachments=A),_b(v,L),zf([...T,...L.eventProcessors],v,r).then((P=>(P&&(function(R){const N={};try{R.exception.values.forEach((G=>{G.stacktrace.frames.forEach((X=>{X.debug_id&&(X.abs_path?N[X.abs_path]=X.debug_id:X.filename&&(N[X.filename]=X.debug_id),delete X.debug_id)}))}))}catch{}if(Object.keys(N).length===0)return;R.debug_meta=R.debug_meta||{},R.debug_meta.images=R.debug_meta.images||[];const V=R.debug_meta.images;Object.entries(N).forEach((([G,X])=>{V.push({type:"sourcemap",code_file:G,debug_id:X})}))})(P),typeof h=="number"&&h>0?(function(R,N,V){if(!R)return null;const G={...R,...R.breadcrumbs&&{breadcrumbs:R.breadcrumbs.map((X=>({...X,...X.data&&{data:qi(X.data,N,V)}})))},...R.user&&{user:qi(R.user,N,V)},...R.contexts&&{contexts:qi(R.contexts,N,V)},...R.extra&&{extra:qi(R.extra,N,V)}};return R.contexts&&R.contexts.trace&&G.contexts&&(G.contexts.trace=R.contexts.trace,R.contexts.trace.data&&(G.contexts.trace.data=qi(R.contexts.trace.data,N,V))),R.spans&&(G.spans=R.spans.map((X=>({...X,...X.data&&{data:qi(X.data,N,V)}})))),R.contexts&&R.contexts.flags&&G.contexts&&(G.contexts.flags=qi(R.contexts.flags,3,V)),G})(P,h,y):P)))}function OE(n){}function Dm(n,e){return wo().captureEvent(n,e)}function Um(n){const e=yn(),r=Ec(),a=wo(),{release:l,environment:f=Uf}=e&&e.getOptions()||{},{userAgent:h}=pt.navigator||{},y=eb({release:l,environment:f,user:a.getUser()||r.getUser(),...h&&{userAgent:h},...n}),v=r.getSession();return v&&v.status==="ok"&&ya(v,{status:"exited"}),Bm(),r.setSession(y),a.setSession(y),y}function Bm(){const n=Ec(),e=wo(),r=e.getSession()||n.getSession();r&&(function(a,l){let f={};a.status==="ok"&&(f={status:"exited"}),ya(a,f)})(r),Fm(),n.setSession(),e.setSession()}function Fm(){const n=Ec(),e=wo(),r=yn(),a=e.getSession()||n.getSession();a&&r&&r.captureSession(a)}function zm(n=!1){n?Bm():Fm()}function bb(n,e,r){return e||`${(function(a){return`${(function(l){const f=l.protocol?`${l.protocol}:`:"",h=l.port?`:${l.port}`:"";return`${f}//${l.host}${h}${l.path?`/${l.path}`:""}/api/`})(a)}${a.projectId}/envelope/`})(n)}?${(function(a,l){const f={sentry_version:"7"};return a.publicKey&&(f.sentry_key=a.publicKey),l&&(f.sentry_client=`${l.name}/${l.version}`),new URLSearchParams(f).toString()})(n,r)}`}const Vm=[];function $m(n,e){for(const r of e)r&&r.afterAllSetup&&r.afterAllSetup(n)}function qm(n,e,r){if(r[e.name])Ct&&Ye.log(`Integration skipped because it was already installed: ${e.name}`);else{if(r[e.name]=e,Vm.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),Vm.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(n),typeof e.preprocessEvent=="function"){const a=e.preprocessEvent.bind(e);n.on("preprocessEvent",((l,f)=>a(l,f,n)))}if(typeof e.processEvent=="function"){const a=e.processEvent.bind(e),l=Object.assign(((f,h)=>a(f,h,n)),{id:e.name});n.addEventProcessor(l)}Ct&&Ye.log(`Integration installed: ${e.name}`)}}class Vr extends Error{constructor(e,r="warn"){super(e),this.message=e,this.logLevel=r}}const Wm="Not capturing exception because it's already been captured.";class Sb{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=hb(e.dsn):Ct&&Ye.warn("No DSN provided, client will not send events."),this._dsn){const a=bb(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:a})}const r=["enableTracing","tracesSampleRate","tracesSampler"].find((a=>a in e&&e[a]==null));r&&kc((()=>{console.warn(`[Sentry] Deprecation warning: \`${r}\` is set to undefined, which leads to tracing being enabled. In v9, a value of \`undefined\` will result in tracing being disabled.`)}))}captureException(e,r,a){const l=Sr();if(_m(e))return Ct&&Ye.log(Wm),l;const f={event_id:l,...r};return this._process(this.eventFromException(e,f).then((h=>this._captureEvent(h,f,a)))),f.event_id}captureMessage(e,r,a,l){const f={event_id:Sr(),...a},h=Tf(e)?e:String(e),y=Of(e)?this.eventFromMessage(h,r,f):this.eventFromException(e,f);return this._process(y.then((v=>this._captureEvent(v,f,l)))),f.event_id}captureEvent(e,r,a){const l=Sr();if(r&&r.originalException&&_m(r.originalException))return Ct&&Ye.log(Wm),l;const f={event_id:l,...r},h=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,f,h||a)),f.event_id}captureSession(e){typeof e.release!="string"?Ct&&Ye.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),ya(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const r=this._transport;return r?(this.emit("flush"),this._isClientDoneProcessing(e).then((a=>r.flush(e).then((l=>a&&l))))):_o(!0)}close(e){return this.flush(e).then((r=>(this.getOptions().enabled=!1,this.emit("close"),r)))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some((({name:e})=>e.startsWith("Spotlight"))))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const r=this._integrations[e.name];qm(this,e,this._integrations),r||$m(this,[e])}sendEvent(e,r={}){this.emit("beforeSendEvent",e,r);let a=yb(e,this._dsn,this._options._metadata,this._options.tunnel);for(const f of r.attachments||[])a=pb(a,mb(f));const l=this.sendEnvelope(a);l&&l.then((f=>this.emit("afterSendEvent",e,f)),null)}sendSession(e){const r=(function(a,l,f,h){const y=Lm(f);return Mc({sent_at:new Date().toISOString(),...y&&{sdk:y},...!!h&&l&&{dsn:pu(l)}},["aggregates"in a?[{type:"sessions"},a]:[{type:"session"},a.toJSON()]])})(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(r)}recordDroppedEvent(e,r,a){if(this._options.sendClientReports){const l=typeof a=="number"?a:1,f=`${e}:${r}`;Ct&&Ye.log(`Recording outcome: "${f}"${l>1?` (${l} times)`:""}`),this._outcomes[f]=(this._outcomes[f]||0)+l}}on(e,r){const a=this._hooks[e]=this._hooks[e]||[];return a.push(r),()=>{const l=a.indexOf(r);l>-1&&a.splice(l,1)}}emit(e,...r){const a=this._hooks[e];a&&a.forEach((l=>l(...r)))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,(r=>(Ct&&Ye.error("Error while sending envelope:",r),r))):(Ct&&Ye.error("Transport disabled"),_o({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=(function(r,a){const l={};return a.forEach((f=>{f&&qm(r,f,l)})),l})(this,e),$m(this,e)}_updateSessionFromEvent(e,r){let a=r.level==="fatal",l=!1;const f=r.exception&&r.exception.values;if(f){l=!0;for(const y of f){const v=y.mechanism;if(v&&v.handled===!1){a=!0;break}}}const h=e.status==="ok";(h&&e.errors===0||h&&a)&&(ya(e,{...a&&{status:"crashed"},errors:e.errors||Number(l||a)}),this.captureSession(e))}_isClientDoneProcessing(e){return new kr((r=>{let a=0;const l=setInterval((()=>{this._numProcessing==0?(clearInterval(l),r(!0)):(a+=1,e&&a>=e&&(clearInterval(l),r(!1)))}),1)}))}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,r,a=wo(),l=Ec()){const f=this.getOptions(),h=Object.keys(this._integrations);return!r.integrations&&h.length>0&&(r.integrations=h),this.emit("preprocessEvent",e,r),e.type||l.setLastEventId(e.event_id||r.event_id),wb(f,e,r,a,this,l).then((y=>{if(y===null)return y;y.contexts={trace:ib(a),...y.contexts};const v=(function(b,C){const T=C.getPropagationContext();return T.dsc||Rm(T.traceId,b)})(this,a);return y.sdkProcessingMetadata={dynamicSamplingContext:v,...y.sdkProcessingMetadata},y}))}_captureEvent(e,r={},a){return this._processEvent(e,r,a).then((l=>l.event_id),(l=>{Ct&&(l instanceof Vr&&l.logLevel==="log"?Ye.log(l.message):Ye.warn(l))}))}_processEvent(e,r,a){const l=this.getOptions(),{sampleRate:f}=l,h=Gm(e),y=Hm(e),v=e.type||"error",b=`before send for type \`${v}\``,C=f===void 0?void 0:(function(A){if(typeof A=="boolean")return Number(A);const P=typeof A=="string"?parseFloat(A):A;if(!(typeof P!="number"||isNaN(P)||P<0||P>1))return P;Ct&&Ye.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(A)} of type ${JSON.stringify(typeof A)}.`)})(f);if(y&&typeof C=="number"&&Math.random()>C)return this.recordDroppedEvent("sample_rate","error",e),fu(new Vr(`Discarding event because it's not included in the random sample (sampling rate = ${f})`,"log"));const T=v==="replay_event"?"replay":v,L=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,r,a,L).then((A=>{if(A===null)throw this.recordDroppedEvent("event_processor",T,e),new Vr("An event processor returned `null`, will not send event.","log");if(r.data&&r.data.__sentry__===!0)return A;const P=(function(R,N,V,G){const{beforeSend:X,beforeSendTransaction:x,beforeSendSpan:$}=N;if(Hm(V)&&X)return X(V,G);if(Gm(V)){if(V.spans&&$){const q=[];for(const re of V.spans){const me=$(re);me?q.push(me):(ub(),R.recordDroppedEvent("before_send","span"))}V.spans=q}if(x){if(V.spans){const q=V.spans.length;V.sdkProcessingMetadata={...V.sdkProcessingMetadata,spanCountBeforeProcessing:q}}return x(V,G)}}return V})(this,l,A,r);return(function(R,N){const V=`${N} must return \`null\` or a valid event.`;if(uu(R))return R.then((G=>{if(!ga(G)&&G!==null)throw new Vr(V);return G}),(G=>{throw new Vr(`${N} rejected with ${G}`)}));if(!ga(R)&&R!==null)throw new Vr(V);return R})(P,b)})).then((A=>{if(A===null){if(this.recordDroppedEvent("before_send",T,e),h){const N=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",N)}throw new Vr(`${b} returned \`null\`, will not send event.`,"log")}const P=a&&a.getSession();if(!h&&P&&this._updateSessionFromEvent(P,A),h){const N=(A.sdkProcessingMetadata&&A.sdkProcessingMetadata.spanCountBeforeProcessing||0)-(A.spans?A.spans.length:0);N>0&&this.recordDroppedEvent("before_send","span",N)}const R=A.transaction_info;if(h&&R&&A.transaction!==e.transaction){const N="custom";A.transaction_info={...R,source:N}}return this.sendEvent(A,r),A})).then(null,(A=>{throw A instanceof Vr?A:(this.captureException(A,{data:{__sentry__:!0},originalException:A}),new Vr(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${A}`))}))}_process(e){this._numProcessing++,e.then((r=>(this._numProcessing--,r)),(r=>(this._numProcessing--,r)))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map((([r,a])=>{const[l,f]=r.split(":");return{reason:l,category:f,quantity:a}}))}_flushOutcomes(){Ct&&Ye.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0)return void(Ct&&Ye.log("No outcomes to send"));if(!this._dsn)return void(Ct&&Ye.log("No dsn provided, will not send outcomes"));Ct&&Ye.log("Sending outcomes:",e);const r=(a=e,Mc((l=this._options.tunnel&&pu(this._dsn))?{dsn:l}:{},[[{type:"client_report"},{timestamp:f||Cc(),discarded_events:a}]]));var a,l,f;this.sendEnvelope(r)}}function Hm(n){return n.type===void 0}function Gm(n){return n.type==="transaction"}function kb(n){const e=[];function r(a){return e.splice(e.indexOf(a),1)[0]||Promise.resolve(void 0)}return{$:e,add:function(a){if(!(n===void 0||e.length<n))return fu(new Vr("Not adding Promise because buffer limit was reached."));const l=a();return e.indexOf(l)===-1&&e.push(l),l.then((()=>r(l))).then(null,(()=>r(l).then(null,(()=>{})))),l},drain:function(a){return new kr(((l,f)=>{let h=e.length;if(!h)return l(!0);const y=setTimeout((()=>{a&&a>0&&l(!1)}),a);e.forEach((v=>{_o(v).then((()=>{--h||(clearTimeout(y),l(!0))}),f)}))}))}}}function Cb(n,{statusCode:e,headers:r},a=Date.now()){const l={...n},f=r&&r["x-sentry-rate-limits"],h=r&&r["retry-after"];if(f)for(const y of f.trim().split(",")){const[v,b,,,C]=y.split(":",5),T=parseInt(v,10),L=1e3*(isNaN(T)?60:T);if(b)for(const A of b.split(";"))A==="metric_bucket"&&C&&!C.split(";").includes("custom")||(l[A]=a+L);else l.all=a+L}else h?l.all=a+(function(y,v=Date.now()){const b=parseInt(`${y}`,10);if(!isNaN(b))return 1e3*b;const C=Date.parse(`${y}`);return isNaN(C)?6e4:C-v})(h,a):e===429&&(l.all=a+6e4);return l}function Eb(n,e,r=kb(n.bufferSize||64)){let a={};return{send:function(l){const f=[];if(Im(l,((v,b)=>{const C=xm(b);if((function(T,L,A=Date.now()){return(function(P,R){return P[R]||P.all||0})(T,L)>A})(a,C)){const T=Jm(v,b);n.recordDroppedEvent("ratelimit_backoff",C,T)}else f.push(v)})),f.length===0)return _o({});const h=Mc(l[0],f),y=v=>{Im(h,((b,C)=>{const T=Jm(b,C);n.recordDroppedEvent(v,xm(C),T)}))};return r.add((()=>e({body:gb(h)}).then((v=>(v.statusCode!==void 0&&(v.statusCode<200||v.statusCode>=300)&&Ct&&Ye.warn(`Sentry responded with status code ${v.statusCode} to sent event.`),a=Cb(a,v),v)),(v=>{throw y("network_error"),v})))).then((v=>v),(v=>{if(v instanceof Vr)return Ct&&Ye.error("Skipped sending event because buffer is full."),y("queue_overflow"),_o({});throw v}))},flush:l=>r.drain(l)}}function Jm(n,e){if(e==="event"||e==="transaction")return Array.isArray(n)?n[1]:void 0}const Mb=100;function bo(n,e){const r=yn(),a=Ec();if(!r)return;const{beforeBreadcrumb:l=null,maxBreadcrumbs:f=Mb}=r.getOptions();if(f<=0)return;const h={timestamp:Cc(),...n},y=l?kc((()=>l(h,e))):h;y!==null&&(r.emit&&r.emit("beforeAddBreadcrumb",y,e),a.addBreadcrumb(y,f))}let Qm;const Km=new WeakMap,Tb=()=>({name:"FunctionToString",setupOnce(){Qm=Function.prototype.toString;try{Function.prototype.toString=function(...n){const e=Af(this),r=Km.has(yn())&&e!==void 0?e:this;return Qm.apply(r,n)}}catch{}},setup(n){Km.set(n,!0)}}),Ob=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/],Rb=(n={})=>({name:"InboundFilters",processEvent(e,r,a){const l=a.getOptions(),f=(function(h={},y={}){return{allowUrls:[...h.allowUrls||[],...y.allowUrls||[]],denyUrls:[...h.denyUrls||[],...y.denyUrls||[]],ignoreErrors:[...h.ignoreErrors||[],...y.ignoreErrors||[],...h.disableErrorDefaults?[]:Ob],ignoreTransactions:[...h.ignoreTransactions||[],...y.ignoreTransactions||[]],ignoreInternal:h.ignoreInternal===void 0||h.ignoreInternal}})(n,l);return(function(h,y){return y.ignoreInternal&&(function(v){try{return v.exception.values[0].type==="SentryError"}catch{}return!1})(h)?(Ct&&Ye.warn(`Event dropped due to being internal Sentry Error.
Event: ${ps(h)}`),!0):(function(v,b){return v.type||!b||!b.length?!1:(function(C){const T=[];C.message&&T.push(C.message);let L;try{L=C.exception.values[C.exception.values.length-1]}catch{}return L&&L.value&&(T.push(L.value),L.type&&T.push(`${L.type}: ${L.value}`)),T})(v).some((C=>du(C,b)))})(h,y.ignoreErrors)?(Ct&&Ye.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${ps(h)}`),!0):(function(v){return v.type||!v.exception||!v.exception.values||v.exception.values.length===0?!1:!v.message&&!v.exception.values.some((b=>b.stacktrace||b.type&&b.type!=="Error"||b.value))})(h)?(Ct&&Ye.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${ps(h)}`),!0):(function(v,b){if(v.type!=="transaction"||!b||!b.length)return!1;const C=v.transaction;return!!C&&du(C,b)})(h,y.ignoreTransactions)?(Ct&&Ye.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${ps(h)}`),!0):(function(v,b){if(!b||!b.length)return!1;const C=vu(v);return!!C&&du(C,b)})(h,y.denyUrls)?(Ct&&Ye.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${ps(h)}.
Url: ${vu(h)}`),!0):(function(v,b){if(!b||!b.length)return!0;const C=vu(v);return!C||du(C,b)})(h,y.allowUrls)?!1:(Ct&&Ye.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${ps(h)}.
Url: ${vu(h)}`),!0)})(e,f)?null:e}});function vu(n){try{let e;try{e=n.exception.values[0].stacktrace.frames}catch{}return e?(function(r=[]){for(let a=r.length-1;a>=0;a--){const l=r[a];if(l&&l.filename!=="<anonymous>"&&l.filename!=="[native code]")return l.filename||null}return null})(e):null}catch{return Ct&&Ye.error(`Cannot extract url for event ${ps(n)}`),null}}function Ab(n,e,r=250,a,l,f,h){if(!(f.exception&&f.exception.values&&h&&vo(h.originalException,Error)))return;const y=f.exception.values.length>0?f.exception.values[f.exception.values.length-1]:void 0;var v,b;y&&(f.exception.values=(v=$f(n,e,l,h.originalException,a,f.exception.values,y,0),b=r,v.map((C=>(C.value&&(C.value=ma(C.value,b)),C)))))}function $f(n,e,r,a,l,f,h,y){if(f.length>=r+1)return f;let v=[...f];if(vo(a[l],Error)){Ym(h,y);const b=n(e,a[l]),C=v.length;Xm(b,l,C,y),v=$f(n,e,r,a[l],l,[b,...v],b,C)}return Array.isArray(a.errors)&&a.errors.forEach(((b,C)=>{if(vo(b,Error)){Ym(h,y);const T=n(e,b),L=v.length;Xm(T,`errors[${C}]`,L,y),v=$f(n,e,r,b,l,[T,...v],T,L)}})),v}function Ym(n,e){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,...n.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function Xm(n,e,r,a){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,type:"chained",source:e,exception_id:r,parent_id:a}}function qf(n){if(!n)return{};const e=n.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const r=e[6]||"",a=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:r,hash:a,relative:e[5]+r+a}}function Pb(){"console"in pt&&Sf.forEach((function(n){n in pt.console&&dr(pt.console,n,(function(e){return su[n]=e,function(...r){zr("console",{args:r,level:n});const a=su[n];a&&a.apply(pt.console,r)}}))}))}function Ib(n){return n==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(n)?n:"log"}const xb=()=>{let n;return{name:"Dedupe",processEvent(e){if(e.type)return e;try{if((function(r,a){return a?!!((function(l,f){const h=l.message,y=f.message;return!(!h&&!y||h&&!y||!h&&y||h!==y||!ev(l,f)||!Zm(l,f))})(r,a)||(function(l,f){const h=tv(f),y=tv(l);return!(!h||!y||h.type!==y.type||h.value!==y.value||!ev(l,f)||!Zm(l,f))})(r,a)):!1})(e,n))return Ct&&Ye.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return n=e}}};function Zm(n,e){let r=om(n),a=om(e);if(!r&&!a)return!0;if(r&&!a||!r&&a||a.length!==r.length)return!1;for(let l=0;l<a.length;l++){const f=a[l],h=r[l];if(f.filename!==h.filename||f.lineno!==h.lineno||f.colno!==h.colno||f.function!==h.function)return!1}return!0}function ev(n,e){let r=n.fingerprint,a=e.fingerprint;if(!r&&!a)return!0;if(r&&!a||!r&&a)return!1;try{return r.join("")===a.join("")}catch{return!1}}function tv(n){return n.exception&&n.exception.values&&n.exception.values[0]}function nv(n){return n===void 0?void 0:n>=400&&n<500?"warning":n>=500?"error":void 0}const Wf=pt;function Hf(n){return n&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(n.toString())}function Lb(){if(typeof EdgeRuntime=="string")return!0;if(!(function(){if(!("fetch"in Wf))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}})())return!1;if(Hf(Wf.fetch))return!0;let n=!1;const e=Wf.document;if(e&&typeof e.createElement=="function")try{const r=e.createElement("iframe");r.hidden=!0,e.head.appendChild(r),r.contentWindow&&r.contentWindow.fetch&&(n=Hf(r.contentWindow.fetch)),e.head.removeChild(r)}catch(r){ho&&Ye.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",r)}return n}function jb(n,e){const r="fetch";go(r,n),mo(r,(()=>(function(a,l=!1){l&&!Lb()||dr(pt,"fetch",(function(f){return function(...h){const y=new Error,{method:v,url:b}=(function(T){if(T.length===0)return{method:"GET",url:""};if(T.length===2){const[A,P]=T;return{url:rv(A),method:Gf(P,"method")?String(P.method).toUpperCase():"GET"}}const L=T[0];return{url:rv(L),method:Gf(L,"method")?String(L.method).toUpperCase():"GET"}})(h),C={args:h,fetchData:{method:v,url:b},startTimestamp:1e3*Vi(),virtualError:y};return a||zr("fetch",{...C}),f.apply(pt,h).then((async T=>(a?a(T):zr("fetch",{...C,endTimestamp:1e3*Vi(),response:T}),T)),(T=>{throw zr("fetch",{...C,endTimestamp:1e3*Vi(),error:T}),Mf(T)&&T.stack===void 0&&(T.stack=y.stack,yo(T,"framesToPop",1)),T}))}}))})(void 0,e)))}function Gf(n,e){return!!n&&typeof n=="object"&&!!n[e]}function rv(n){return typeof n=="string"?n:n?Gf(n,"url")?n.url:n.toString?n.toString():"":""}const yu=pt,Zt=pt;let Jf=0;function iv(){return Jf>0}function wa(n,e={}){if(!(function(a){return typeof a=="function"})(n))return n;try{const a=n.__sentry_wrapped__;if(a)return typeof a=="function"?a:n;if(Af(n))return n}catch{return n}const r=function(...a){try{const l=a.map((f=>wa(f,e)));return n.apply(this,l)}catch(l){throw Jf++,setTimeout((()=>{Jf--})),(function(...f){const h=Nf(cu());if(f.length===2){const[y,v]=f;return y?h.withSetScope(y,v):h.withScope(v)}h.withScope(f[0])})((f=>{var h;f.addEventProcessor((y=>(e.mechanism&&(If(y,void 0),va(y,e.mechanism)),y.extra={...y.extra,arguments:a},y))),h=l,wo().captureException(h,void 0)})),l}};try{for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])}catch{}pm(r,n),yo(n,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get:()=>n.name})}catch{}return r}const _u=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function Qf(n,e){const r=Yf(n,e),a={type:Ub(e),value:Bb(e)};return r.length&&(a.stacktrace={frames:r}),a.type===void 0&&a.value===""&&(a.value="Unrecoverable error caught"),a}function Nb(n,e,r,a){const l=yn(),f=l&&l.getOptions().normalizeDepth,h=(function(b){for(const C in b)if(Object.prototype.hasOwnProperty.call(b,C)){const T=b[C];if(T instanceof Error)return T}})(e),y={__serialized__:Pm(e,f)};if(h)return{exception:{values:[Qf(n,h)]},extra:y};const v={exception:{values:[{type:lu(e)?e.constructor.name:a?"UnhandledRejection":"Error",value:Fb(e,{isUnhandledRejection:a})}]},extra:y};if(r){const b=Yf(n,r);b.length&&(v.exception.values[0].stacktrace={frames:b})}return v}function Kf(n,e){return{exception:{values:[Qf(n,e)]}}}function Yf(n,e){const r=e.stacktrace||e.stack||"",a=(function(f){return f&&Db.test(f.message)?1:0})(e),l=(function(f){return typeof f.framesToPop=="number"?f.framesToPop:0})(e);try{return n(r,a,l)}catch{}return[]}const Db=/Minified React error #\d+;/i;function sv(n){return typeof WebAssembly<"u"&&WebAssembly.Exception!==void 0&&n instanceof WebAssembly.Exception}function Ub(n){const e=n&&n.name;return!e&&sv(n)?n.message&&Array.isArray(n.message)&&n.message.length==2?n.message[0]:"WebAssembly.Exception":e}function Bb(n){const e=n&&n.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:sv(n)&&Array.isArray(n.message)&&n.message.length==2?n.message[1]:e:"No error message"}function Xf(n,e,r,a,l){let f;if(lm(e)&&e.error)return Kf(n,e.error);if(um(e)||pa(e,"DOMException")){const h=e;if("stack"in e)f=Kf(n,e);else{const y=h.name||(um(h)?"DOMError":"DOMException"),v=h.message?`${y}: ${h.message}`:y;f=Zf(n,v,r,a),If(f,v)}return"code"in h&&(f.tags={...f.tags,"DOMException.code":`${h.code}`}),f}return Mf(e)?Kf(n,e):ga(e)||lu(e)?(f=Nb(n,e,r,l),va(f,{synthetic:!0}),f):(f=Zf(n,e,r,a),If(f,`${e}`),va(f,{synthetic:!0}),f)}function Zf(n,e,r,a){const l={};if(a&&r){const f=Yf(n,r);f.length&&(l.exception={values:[{value:e,stacktrace:{frames:f}}]}),va(l,{synthetic:!0})}if(Tf(e)){const{__sentry_template_string__:f,__sentry_template_values__:h}=e;return l.logentry={message:f,params:h},l}return l.message=e,l}function Fb(n,{isUnhandledRejection:e}){const r=(function(l,f=40){const h=Object.keys(gm(l));h.sort();const y=h[0];if(!y)return"[object has no keys]";if(y.length>=f)return ma(y,f);for(let v=h.length;v>0;v--){const b=h.slice(0,v).join(", ");if(!(b.length>f))return v===h.length?b:ma(b,f)}return""})(n),a=e?"promise rejection":"exception";return lm(n)?`Event \`ErrorEvent\` captured as ${a} with message \`${n.message}\``:lu(n)?`Event \`${(function(l){try{const f=Object.getPrototypeOf(l);return f?f.constructor.name:void 0}catch{}})(n)}\` (type=${n.type}) captured as ${a}`:`Object captured as ${a} with keys: ${r}`}let zb=class extends Sb{constructor(e){const r={parentSpanIsAlwaysRootSpan:!0,...e};(function(a,l,f=[l],h="npm"){const y=a._metadata||{};y.sdk||(y.sdk={name:`sentry.javascript.${l}`,packages:f.map((v=>({name:`${h}:@sentry/${v}`,version:fo}))),version:fo}),a._metadata=y})(r,"browser",["browser"],Zt.SENTRY_SDK_SOURCE||"npm"),super(r),r.sendClientReports&&Zt.document&&Zt.document.addEventListener("visibilitychange",(()=>{Zt.document.visibilityState==="hidden"&&this._flushOutcomes()}))}eventFromException(e,r){return(function(a,l,f,h){const y=Xf(a,l,f&&f.syntheticException||void 0,h);return va(y),y.level="error",f&&f.event_id&&(y.event_id=f.event_id),_o(y)})(this._options.stackParser,e,r,this._options.attachStacktrace)}eventFromMessage(e,r="info",a){return(function(l,f,h="info",y,v){const b=Zf(l,f,y&&y.syntheticException||void 0,v);return b.level=h,y&&y.event_id&&(b.event_id=y.event_id),_o(b)})(this._options.stackParser,e,r,a,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled())return void(_u&&Ye.warn("SDK not enabled, will not capture user feedback."));const r=(function(a,{metadata:l,tunnel:f,dsn:h}){const y={event_id:a.event_id,sent_at:new Date().toISOString(),...l&&l.sdk&&{sdk:{name:l.sdk.name,version:l.sdk.version}},...!!f&&!!h&&{dsn:pu(h)}};return Mc(y,[(function(b){return[{type:"user_report"},b]})(a)])})(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(r)}_prepareEvent(e,r,a){return e.platform=e.platform||"javascript",super._prepareEvent(e,r,a)}};const Vb=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,Ln=pt;let ov,eh,th,wu;function $b(){if(!Ln.document)return;const n=zr.bind(null,"dom"),e=av(n,!0);Ln.document.addEventListener("click",e,!1),Ln.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach((r=>{const a=Ln[r],l=a&&a.prototype;l&&l.hasOwnProperty&&l.hasOwnProperty("addEventListener")&&(dr(l,"addEventListener",(function(f){return function(h,y,v){if(h==="click"||h=="keypress")try{const b=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},C=b[h]=b[h]||{refCount:0};if(!C.handler){const T=av(n);C.handler=T,f.call(this,h,T,v)}C.refCount++}catch{}return f.call(this,h,y,v)}})),dr(l,"removeEventListener",(function(f){return function(h,y,v){if(h==="click"||h=="keypress")try{const b=this.__sentry_instrumentation_handlers__||{},C=b[h];C&&(C.refCount--,C.refCount<=0&&(f.call(this,h,C.handler,v),C.handler=void 0,delete b[h]),Object.keys(b).length===0&&delete this.__sentry_instrumentation_handlers__)}catch{}return f.call(this,h,y,v)}})))}))}function av(n,e=!1){return r=>{if(!r||r._sentryCaptured)return;const a=(function(f){try{return f.target}catch{return null}})(r);if((function(f,h){return f==="keypress"&&(!h||!h.tagName||h.tagName!=="INPUT"&&h.tagName!=="TEXTAREA"&&!h.isContentEditable)})(r.type,a))return;yo(r,"_sentryCaptured",!0),a&&!a._sentryId&&yo(a,"_sentryId",Sr());const l=r.type==="keypress"?"input":r.type;(function(f){if(f.type!==eh)return!1;try{if(!f.target||f.target._sentryId!==th)return!1}catch{}return!0})(r)||(n({event:r,name:l,global:e}),eh=r.type,th=a?a._sentryId:void 0),clearTimeout(ov),ov=Ln.setTimeout((()=>{th=void 0,eh=void 0}),1e3)}}function cv(n){const e="history";go(e,n),mo(e,qb)}function qb(){if(!(function(){const r=yu.chrome,a=r&&r.app&&r.app.runtime,l="history"in yu&&!!yu.history.pushState&&!!yu.history.replaceState;return!a&&l})())return;const n=Ln.onpopstate;function e(r){return function(...a){const l=a.length>2?a[2]:void 0;if(l){const f=wu,h=String(l);wu=h,zr("history",{from:f,to:h})}return r.apply(this,a)}}Ln.onpopstate=function(...r){const a=Ln.location.href,l=wu;if(wu=a,zr("history",{from:l,to:a}),n)try{return n.apply(this,r)}catch{}},dr(Ln.history,"pushState",e),dr(Ln.history,"replaceState",e)}const bu={};function lv(n){bu[n]=void 0}const Tc="__sentry_xhr_v3__";function Wb(){if(!Ln.XMLHttpRequest)return;const n=XMLHttpRequest.prototype;n.open=new Proxy(n.open,{apply(e,r,a){const l=new Error,f=1e3*Vi(),h=zi(a[0])?a[0].toUpperCase():void 0,y=(function(b){if(zi(b))return b;try{return b.toString()}catch{}})(a[1]);if(!h||!y)return e.apply(r,a);r[Tc]={method:h,url:y,request_headers:{}},h==="POST"&&y.match(/sentry_key/)&&(r.__sentry_own_request__=!0);const v=()=>{const b=r[Tc];if(b&&r.readyState===4){try{b.status_code=r.status}catch{}zr("xhr",{endTimestamp:1e3*Vi(),startTimestamp:f,xhr:r,virtualError:l})}};return"onreadystatechange"in r&&typeof r.onreadystatechange=="function"?r.onreadystatechange=new Proxy(r.onreadystatechange,{apply:(b,C,T)=>(v(),b.apply(C,T))}):r.addEventListener("readystatechange",v),r.setRequestHeader=new Proxy(r.setRequestHeader,{apply(b,C,T){const[L,A]=T,P=C[Tc];return P&&zi(L)&&zi(A)&&(P.request_headers[L.toLowerCase()]=A),b.apply(C,T)}}),e.apply(r,a)}}),n.send=new Proxy(n.send,{apply(e,r,a){const l=r[Tc];return l?(a[0]!==void 0&&(l.body=a[0]),zr("xhr",{startTimestamp:1e3*Vi(),xhr:r}),e.apply(r,a)):e.apply(r,a)}})}function Hb(n,e=(function(r){const a=bu[r];if(a)return a;let l=Ln[r];if(Hf(l))return bu[r]=l.bind(Ln);const f=Ln.document;if(f&&typeof f.createElement=="function")try{const h=f.createElement("iframe");h.hidden=!0,f.head.appendChild(h);const y=h.contentWindow;y&&y[r]&&(l=y[r]),f.head.removeChild(h)}catch(h){Vb&&Ye.warn(`Could not create sandbox iframe for ${r} check, bailing to window.${r}: `,h)}return l&&(bu[r]=l.bind(Ln))})("fetch")){let r=0,a=0;return Eb(n,(function(l){const f=l.body.length;r+=f,a++;const h={body:l.body,method:"POST",referrerPolicy:"origin",headers:n.headers,keepalive:r<=6e4&&a<15,...n.fetchOptions};if(!e)return lv("fetch"),fu("No fetch implementation available");try{return e(n.url,h).then((y=>(r-=f,a--,{statusCode:y.status,headers:{"x-sentry-rate-limits":y.headers.get("X-Sentry-Rate-Limits"),"retry-after":y.headers.get("Retry-After")}})))}catch(y){return lv("fetch"),r-=f,a--,fu(y)}}))}function nh(n,e,r,a){const l={filename:n,function:e==="<anonymous>"?po:e,in_app:!0};return r!==void 0&&(l.lineno=r),a!==void 0&&(l.colno=a),l}const Gb=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,Jb=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Qb=/\((\S*)(?::(\d+))(?::(\d+))\)/,Kb=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,Yb=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Xb=(function(...n){const e=n.sort(((r,a)=>r[0]-a[0])).map((r=>r[1]));return(r,a=0,l=0)=>{const f=[],h=r.split(`
`);for(let y=a;y<h.length;y++){const v=h[y];if(v.length>1024)continue;const b=rm.test(v)?v.replace(rm,"$1"):v;if(!b.match(/\S*Error: /)){for(const C of e){const T=C(b);if(T){f.push(T);break}}if(f.length>=50+l)break}}return(function(y){if(!y.length)return[];const v=Array.from(y);return/sentryWrapped/.test(ou(v).function||"")&&v.pop(),v.reverse(),im.test(ou(v).function||"")&&(v.pop(),im.test(ou(v).function||"")&&v.pop()),v.slice(0,50).map((b=>({...b,filename:b.filename||ou(v).filename,function:b.function||po})))})(f.slice(l))}})([30,n=>{const e=Gb.exec(n);if(e){const[,a,l,f]=e;return nh(a,po,+l,+f)}const r=Jb.exec(n);if(r){if(r[2]&&r[2].indexOf("eval")===0){const f=Qb.exec(r[2]);f&&(r[2]=f[1],r[3]=f[2],r[4]=f[3])}const[a,l]=uv(r[1]||po,r[2]);return nh(l,a,r[3]?+r[3]:void 0,r[4]?+r[4]:void 0)}}],[50,n=>{const e=Kb.exec(n);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const l=Yb.exec(e[3]);l&&(e[1]=e[1]||"eval",e[3]=l[1],e[4]=l[2],e[5]="")}let r=e[3],a=e[1]||po;return[a,r]=uv(a,r),nh(r,a,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}}]),uv=(n,e)=>{const r=n.indexOf("safari-extension")!==-1,a=n.indexOf("safari-web-extension")!==-1;return r||a?[n.indexOf("@")!==-1?n.split("@")[0]:po,r?`safari-extension:${e}`:`safari-web-extension:${e}`]:[n,e]},dv=1024,Zb=(n={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...n};return{name:"Breadcrumbs",setup(r){var a;e.console&&(function(l){const f="console";go(f,l),mo(f,Pb)})((function(l){return function(f){if(yn()!==l)return;const h={category:"console",data:{arguments:f.args,logger:"console"},level:Ib(f.level),message:hm(f.args," ")};if(f.level==="assert"){if(f.args[0]!==!1)return;h.message=`Assertion failed: ${hm(f.args.slice(1)," ")||"console.assert"}`,h.data.arguments=f.args.slice(1)}bo(h,{input:f.args,level:f.level})}})(r)),e.dom&&(a=(function(l,f){return function(h){if(yn()!==l)return;let y,v,b=typeof f=="object"?f.serializeAttribute:void 0,C=typeof f=="object"&&typeof f.maxStringLength=="number"?f.maxStringLength:void 0;C&&C>dv&&(_u&&Ye.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${C} was configured. Sentry will use 1024 instead.`),C=dv),typeof b=="string"&&(b=[b]);try{const L=h.event,A=(function(P){return!!P&&!!P.target})(L)?L.target:L;y=fm(A,{keyAttrs:b,maxStringLength:C}),v=(function(P){if(!Rf.HTMLElement)return null;let R=P;for(let N=0;N<5;N++){if(!R)return null;if(R instanceof HTMLElement){if(R.dataset.sentryComponent)return R.dataset.sentryComponent;if(R.dataset.sentryElement)return R.dataset.sentryElement}R=R.parentNode}return null})(A)}catch{y="<unknown>"}if(y.length===0)return;const T={category:`ui.${h.name}`,message:y};v&&(T.data={"ui.component_name":v}),bo(T,{event:h.event,name:h.name,global:h.global})}})(r,e.dom),go("dom",a),mo("dom",$b)),e.xhr&&(function(l){go("xhr",l),mo("xhr",Wb)})((function(l){return function(f){if(yn()!==l)return;const{startTimestamp:h,endTimestamp:y}=f,v=f.xhr[Tc];if(!h||!y||!v)return;const{method:b,url:C,status_code:T,body:L}=v,A={method:b,url:C,status_code:T},P={xhr:f.xhr,input:L,startTimestamp:h,endTimestamp:y};bo({category:"xhr",data:A,type:"http",level:nv(T)},P)}})(r)),e.fetch&&jb((function(l){return function(f){if(yn()!==l)return;const{startTimestamp:h,endTimestamp:y}=f;if(y&&(!f.fetchData.url.match(/sentry_key/)||f.fetchData.method!=="POST"))if(f.error)bo({category:"fetch",data:f.fetchData,level:"error",type:"http"},{data:f.error,input:f.args,startTimestamp:h,endTimestamp:y});else{const v=f.response,b={...f.fetchData,status_code:v&&v.status},C={input:f.args,response:v,startTimestamp:h,endTimestamp:y};bo({category:"fetch",data:b,type:"http",level:nv(b.status_code)},C)}}})(r)),e.history&&cv((function(l){return function(f){if(yn()!==l)return;let h=f.from,y=f.to;const v=qf(Zt.location.href);let b=h?qf(h):void 0;const C=qf(y);b&&b.path||(b=v),v.protocol===C.protocol&&v.host===C.host&&(y=C.relative),v.protocol===b.protocol&&v.host===b.host&&(h=b.relative),bo({category:"navigation",data:{from:h,to:y}})}})(r)),e.sentry&&r.on("beforeSendEvent",(function(l){return function(f){yn()===l&&bo({category:"sentry."+(f.type==="transaction"?"transaction":"event"),event_id:f.event_id,level:f.level,message:ps(f)},{event:f})}})(r))}}},eS=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],tS=(n={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...n};return{name:"BrowserApiErrors",setupOnce(){e.setTimeout&&dr(Zt,"setTimeout",fv),e.setInterval&&dr(Zt,"setInterval",fv),e.requestAnimationFrame&&dr(Zt,"requestAnimationFrame",nS),e.XMLHttpRequest&&"XMLHttpRequest"in Zt&&dr(XMLHttpRequest.prototype,"send",rS);const r=e.eventTarget;r&&(Array.isArray(r)?r:eS).forEach(iS)}}};function fv(n){return function(...e){const r=e[0];return e[0]=wa(r,{mechanism:{data:{function:hs(n)},handled:!1,type:"instrument"}}),n.apply(this,e)}}function nS(n){return function(e){return n.apply(this,[wa(e,{mechanism:{data:{function:"requestAnimationFrame",handler:hs(n)},handled:!1,type:"instrument"}})])}}function rS(n){return function(...e){const r=this;return["onload","onerror","onprogress","onreadystatechange"].forEach((a=>{a in r&&typeof r[a]=="function"&&dr(r,a,(function(l){const f={mechanism:{data:{function:a,handler:hs(l)},handled:!1,type:"instrument"}},h=Af(l);return h&&(f.mechanism.data.handler=hs(h)),wa(l,f)}))})),n.apply(this,e)}}function iS(n){const e=Zt[n],r=e&&e.prototype;r&&r.hasOwnProperty&&r.hasOwnProperty("addEventListener")&&(dr(r,"addEventListener",(function(a){return function(l,f,h){try{typeof f.handleEvent=="function"&&(f.handleEvent=wa(f.handleEvent,{mechanism:{data:{function:"handleEvent",handler:hs(f),target:n},handled:!1,type:"instrument"}}))}catch{}return a.apply(this,[l,wa(f,{mechanism:{data:{function:"addEventListener",handler:hs(f),target:n},handled:!1,type:"instrument"}}),h])}})),dr(r,"removeEventListener",(function(a){return function(l,f,h){try{const y=f.__sentry_wrapped__;y&&a.call(this,l,y,h)}catch{}return a.call(this,l,f,h)}})))}const sS=()=>({name:"BrowserSession",setupOnce(){Zt.document!==void 0?(Um({ignoreDuration:!0}),zm(),cv((({from:n,to:e})=>{n!==void 0&&n!==e&&(Um({ignoreDuration:!0}),zm())}))):_u&&Ye.warn("Using the `browserSessionIntegration` in non-browser environments is not supported.")}}),oS=(n={})=>{const e={onerror:!0,onunhandledrejection:!0,...n};return{name:"GlobalHandlers",setupOnce(){Error.stackTraceLimit=50},setup(r){e.onerror&&((function(a){(function(l){const f="error";go(f,l),mo(f,Kw)})((l=>{const{stackParser:f,attachStacktrace:h}=pv();if(yn()!==a||iv())return;const{msg:y,url:v,line:b,column:C,error:T}=l,L=(function(A,P,R,N){const V=A.exception=A.exception||{},G=V.values=V.values||[],X=G[0]=G[0]||{},x=X.stacktrace=X.stacktrace||{},$=x.frames=x.frames||[],q=N,re=R,me=zi(P)&&P.length>0?P:(function(){try{return Rf.document.location.href}catch{return""}})();return $.length===0&&$.push({colno:q,filename:me,function:po,in_app:!0,lineno:re}),A})(Xf(f,T||y,void 0,h,!1),v,b,C);L.level="error",Dm(L,{originalException:T,mechanism:{handled:!1,type:"onerror"}})}))})(r),hv("onerror")),e.onunhandledrejection&&((function(a){(function(l){const f="unhandledrejection";go(f,l),mo(f,Yw)})((l=>{const{stackParser:f,attachStacktrace:h}=pv();if(yn()!==a||iv())return;const y=(function(b){if(Of(b))return b;try{if("reason"in b)return b.reason;if("detail"in b&&"reason"in b.detail)return b.detail.reason}catch{}return b})(l),v=Of(y)?{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(y)}`}]}}:Xf(f,y,void 0,h,!0);v.level="error",Dm(v,{originalException:y,mechanism:{handled:!1,type:"onunhandledrejection"}})}))})(r),hv("onunhandledrejection"))}}};function hv(n){_u&&Ye.log(`Global Handler attached: ${n}`)}function pv(){const n=yn();return n&&n.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const aS=()=>({name:"HttpContext",preprocessEvent(n){if(!Zt.navigator&&!Zt.location&&!Zt.document)return;const e=n.request&&n.request.url||Zt.location&&Zt.location.href,{referrer:r}=Zt.document||{},{userAgent:a}=Zt.navigator||{},l={...n.request&&n.request.headers,...r&&{Referer:r},...a&&{"User-Agent":a}},f={...n.request,...e&&{url:e},headers:l};n.request=f}}),cS=(n={})=>{const e=n.limit||5,r=n.key||"cause";return{name:"LinkedErrors",preprocessEvent(a,l,f){const h=f.getOptions();Ab(Qf,h.stackParser,h.maxValueLength,r,e,a,l)}}};var gv="new",mv="loading",vv="loaded",rh="joining-meeting",So="joined-meeting",ko="left-meeting",ms="error",lS="playable",ih="unknown",uS="full",dS="base",yv="no-room",fS="end-of-life",hS="connection-error",pS="iframe-ready-for-launch-config",gS="iframe-launch-config",mS="theme-updated",vS="loading",yS="load-attempt-failed",_v="loaded",_S="started-camera",wS="camera-error",bS="joining-meeting",SS="joined-meeting",kS="left-meeting",CS="participant-joined",ES="participant-updated",MS="participant-left",TS="participant-counts-updated",OS="access-state-updated",RS="meeting-session-summary-updated",AS="meeting-session-state-updated",PS="waiting-participant-added",IS="waiting-participant-updated",xS="waiting-participant-removed",LS="track-started",jS="track-stopped",NS="transcription-started",DS="transcription-stopped",US="transcription-error",wv="recording-started",bv="recording-stopped",BS="recording-stats",FS="recording-error",zS="recording-upload-completed",VS="recording-data",$S="app-message",qS="transcription-message",WS="remote-media-player-started",HS="remote-media-player-updated",GS="remote-media-player-stopped",JS="local-screen-share-started",QS="local-screen-share-stopped",KS="local-screen-share-canceled",YS="active-speaker-change",XS="active-speaker-mode-change",ZS="network-quality-change",ek="network-connection",tk="cpu-load-change",nk="face-counts-updated",Su="fullscreen",ku="exited-fullscreen",rk="live-streaming-started",ik="live-streaming-updated",sk="live-streaming-stopped",ok="live-streaming-error",ak="lang-updated",ck="receive-settings-updated",Sv="input-settings-updated",kv="nonfatal-error",Cv="error",sh=4096,Ev=102400,oh="iframe-call-message",Mv="local-screen-start",Tv="daily-method-update-live-streaming-endpoints",Cu="transmit-log",Wi="daily-custom-track",Eu={NONE:"none",BGBLUR:"background-blur",BGIMAGE:"background-image",FACE_DETECTION:"face-detection"},Ov={NONE:"none",NOISE_CANCELLATION:"noise-cancellation"},ah={PLAY:"play",PAUSE:"pause"},ch=["jpg","png","jpeg"],lk="add-endpoints",uk="remove-endpoints",Rv="sip-call-transfer";function Cr(){return!ot()&&typeof window<"u"&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:""}function ot(){return typeof navigator<"u"&&navigator.product&&navigator.product==="ReactNative"}function Av(){return navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia}function dk(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)&&((function(n,e){if(!n||!e)return!0;switch(n){case"Chrome":return e.major>=75;case"Safari":return RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")&&!(e.major===13&&e.minor===0&&e.point===0);case"Firefox":return e.major>=67}return!0})(Co(),Mu())||ot())}function Pv(){if(ot()||!document)return!1;var n=document.createElement("iframe");return!!n.requestFullscreen||!!n.webkitRequestFullscreen}var lh="none",fk="software",hk="hardware",pk=(function(){try{var n,e=document.createElement("canvas"),r=!1;(n=e.getContext("webgl2",{failIfMajorPerformanceCaveat:!0}))||(r=!0,n=e.getContext("webgl2"));var a=n!=null;return e.remove(),a?r?fk:hk:lh}catch{return lh}})();function Iv(){var n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return!ot()&&pk!==lh&&(n?(function(){return jv()?!1:["Chrome","Firefox"].includes(Co())})():(function(){if(jv())return!1;var e=Co();if(e==="Safari"){var r=fh();if(r.major<15||r.major===15&&r.minor<4)return!1}return e==="Chrome"?dh().major>=77:e==="Firefox"?hh().major>=97:["Chrome","Firefox","Safari"].includes(e)})())}function xv(){if(ot()||Lv()||typeof AudioWorkletNode>"u")return!1;switch(Co()){case"Chrome":case"Firefox":return!0;case"Safari":var n=Mu();return n.major>17||n.major===17&&n.minor>=4}return!1}function uh(){return Av()&&typeof MediaStreamTrack<"u"&&!(function(){var n,e=Co();if(!Cr())return!0;switch(e){case"Chrome":return(n=dh()).major&&n.major>0&&n.major<75;case"Firefox":return(n=hh()).major<91;case"Safari":return(n=fh()).major<13||n.major===13&&n.minor<1;default:return!0}})()}function Lv(){return Cr().match(/Linux; Android/)}function jv(){var n,e=Cr(),r=e.match(/Mac/)&&(!ot()&&typeof window<"u"&&(n=window)!==null&&n!==void 0&&(n=n.navigator)!==null&&n!==void 0&&n.maxTouchPoints?window.navigator.maxTouchPoints:0)>=5;return!!(e.match(/Mobi/)||e.match(/Android/)||r)||!!Cr().match(/DailyAnd\//)||void 0}function Co(){if(typeof window<"u"){var n=Cr();return Nv()?"Safari":n.indexOf("Edge")>-1?"Edge":n.match(/Chrome\//)?"Chrome":n.indexOf("Safari")>-1||Dv()?"Safari":n.indexOf("Firefox")>-1?"Firefox":n.indexOf("MSIE")>-1||n.indexOf(".NET")>-1?"IE":"Unknown Browser"}}function Mu(){switch(Co()){case"Chrome":return dh();case"Safari":return fh();case"Firefox":return hh();case"Edge":return(function(){var n=0,e=0;if(typeof window<"u"){var r=Cr().match(/Edge\/(\d+).(\d+)/);if(r)try{n=parseInt(r[1]),e=parseInt(r[2])}catch{}}return{major:n,minor:e}})()}}function dh(){var n=0,e=0,r=0,a=0,l=!1;if(typeof window<"u"){var f=Cr(),h=f.match(/Chrome\/(\d+).(\d+).(\d+).(\d+)/);if(h)try{n=parseInt(h[1]),e=parseInt(h[2]),r=parseInt(h[3]),a=parseInt(h[4]),l=f.indexOf("OPR/")>-1}catch{}}return{major:n,minor:e,build:r,patch:a,opera:l}}function Nv(){return!!Cr().match(/iPad|iPhone|iPod/i)&&Av()}function Dv(){return Cr().indexOf("AppleWebKit/605.1.15")>-1}function fh(){var n=0,e=0,r=0;if(typeof window<"u"){var a=Cr().match(/Version\/(\d+).(\d+)(.(\d+))?/);if(a)try{n=parseInt(a[1]),e=parseInt(a[2]),r=parseInt(a[4])}catch{}else(Nv()||Dv())&&(n=14,e=0,r=3)}return{major:n,minor:e,point:r}}function hh(){var n=0,e=0;if(typeof window<"u"){var r=Cr().match(/Firefox\/(\d+).(\d+)/);if(r)try{n=parseInt(r[1]),e=parseInt(r[2])}catch{}}return{major:n,minor:e}}var Uv=(function(){return ur((function n(){lr(this,n)}),[{key:"addListenerForMessagesFromCallMachine",value:function(n,e,r){Sc()}},{key:"addListenerForMessagesFromDailyJs",value:function(n,e,r){Sc()}},{key:"sendMessageToCallMachine",value:function(n,e,r,a){Sc()}},{key:"sendMessageToDailyJs",value:function(n,e){Sc()}},{key:"removeListener",value:function(n){Sc()}}])})();function Bv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),r.push.apply(r,a)}return r}function ph(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Bv(Object(r),!0).forEach((function(a){fi(n,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Bv(Object(r)).forEach((function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))}))}return n}function Fv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(Fv=function(){return!!n})()}var gk=(function(){function n(){var e,r,a,l;return lr(this,n),r=this,a=Fr(a=n),(e=Yl(r,Fv()?Reflect.construct(a,[],Fr(r).constructor):a.apply(r,l)))._wrappedListeners={},e._messageCallbacks={},e}return Xl(n,Uv),ur(n,[{key:"addListenerForMessagesFromCallMachine",value:function(e,r,a){var l=this,f=function(h){if(h.data&&h.data.what==="iframe-call-message"&&(!h.data.callClientId||h.data.callClientId===r)&&(!h.data.from||h.data.from!=="module")){var y=ph({},h.data);if(delete y.from,y.callbackStamp&&l._messageCallbacks[y.callbackStamp]){var v=y.callbackStamp;l._messageCallbacks[v].call(a,y),delete l._messageCallbacks[v]}delete y.what,delete y.callbackStamp,e.call(a,y)}};this._wrappedListeners[e]=f,window.addEventListener("message",f)}},{key:"addListenerForMessagesFromDailyJs",value:function(e,r,a){var l=function(f){var h;if(!(!f.data||f.data.what!==oh||!f.data.action||f.data.from&&f.data.from!=="module"||f.data.callClientId&&r&&f.data.callClientId!==r||f!=null&&(h=f.data)!==null&&h!==void 0&&h.callFrameId)){var y=f.data;e.call(a,y)}};this._wrappedListeners[e]=l,window.addEventListener("message",l)}},{key:"sendMessageToCallMachine",value:function(e,r,a,l){if(!a)throw new Error("undefined callClientId. Are you trying to use a DailyCall instance previously destroyed?");var f=ph({},e);if(f.what=oh,f.from="module",f.callClientId=a,r){var h=tu();this._messageCallbacks[h]=r,f.callbackStamp=h}var y=l?l.contentWindow:window,v=this._callMachineTargetOrigin(l);v&&y.postMessage(f,v)}},{key:"sendMessageToDailyJs",value:function(e,r){e.what=oh,e.callClientId=r,e.from="embedded",window.postMessage(e,this._targetOriginFromWindowLocation())}},{key:"removeListener",value:function(e){var r=this._wrappedListeners[e];r&&(window.removeEventListener("message",r),delete this._wrappedListeners[e])}},{key:"forwardPackagedMessageToCallMachine",value:function(e,r,a){var l=ph({},e);l.callClientId=a;var f=r?r.contentWindow:window,h=this._callMachineTargetOrigin(r);h&&f.postMessage(l,h)}},{key:"addListenerForPackagedMessagesFromCallMachine",value:function(e,r){var a=function(l){if(l.data&&l.data.what==="iframe-call-message"&&(!l.data.callClientId||l.data.callClientId===r)&&(!l.data.from||l.data.from!=="module")){var f=l.data;e(f)}};return this._wrappedListeners[e]=a,window.addEventListener("message",a),e}},{key:"removeListenerForPackagedMessagesFromCallMachine",value:function(e){var r=this._wrappedListeners[e];r&&(window.removeEventListener("message",r),delete this._wrappedListeners[e])}},{key:"_callMachineTargetOrigin",value:function(e){return e?e.src?new URL(e.src).origin:void 0:this._targetOriginFromWindowLocation()}},{key:"_targetOriginFromWindowLocation",value:function(){return window.location.protocol==="file:"?"*":window.location.origin}}])})();function zv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),r.push.apply(r,a)}return r}function Vv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(Vv=function(){return!!n})()}var mk=(function(){function n(){var e,r,a,l;return lr(this,n),r=this,a=Fr(a=n),e=Yl(r,Vv()?Reflect.construct(a,[],Fr(r).constructor):a.apply(r,l)),global.callMachineToDailyJsEmitter=global.callMachineToDailyJsEmitter||new bf.EventEmitter,global.dailyJsToCallMachineEmitter=global.dailyJsToCallMachineEmitter||new bf.EventEmitter,e._wrappedListeners={},e._messageCallbacks={},e}return Xl(n,Uv),ur(n,[{key:"addListenerForMessagesFromCallMachine",value:function(e,r,a){this._addListener(e,global.callMachineToDailyJsEmitter,r,a,"received call machine message")}},{key:"addListenerForMessagesFromDailyJs",value:function(e,r,a){this._addListener(e,global.dailyJsToCallMachineEmitter,r,a,"received daily-js message")}},{key:"sendMessageToCallMachine",value:function(e,r,a){this._sendMessage(e,global.dailyJsToCallMachineEmitter,a,r,"sending message to call machine")}},{key:"sendMessageToDailyJs",value:function(e,r){this._sendMessage(e,global.callMachineToDailyJsEmitter,r,null,"sending message to daily-js")}},{key:"removeListener",value:function(e){var r=this._wrappedListeners[e];r&&(global.callMachineToDailyJsEmitter.removeListener("message",r),global.dailyJsToCallMachineEmitter.removeListener("message",r),delete this._wrappedListeners[e])}},{key:"_addListener",value:function(e,r,a,l,f){var h=this,y=function(v){if(v.callClientId===a){if(v.callbackStamp&&h._messageCallbacks[v.callbackStamp]){var b=v.callbackStamp;h._messageCallbacks[b].call(l,v),delete h._messageCallbacks[b]}e.call(l,v)}};this._wrappedListeners[e]=y,r.addListener("message",y)}},{key:"_sendMessage",value:function(e,r,a,l,f){var h=(function(v){for(var b=1;b<arguments.length;b++){var C=arguments[b]!=null?arguments[b]:{};b%2?zv(Object(C),!0).forEach((function(T){fi(v,T,C[T])})):Object.getOwnPropertyDescriptors?Object.defineProperties(v,Object.getOwnPropertyDescriptors(C)):zv(Object(C)).forEach((function(T){Object.defineProperty(v,T,Object.getOwnPropertyDescriptor(C,T))}))}return v})({},e);if(h.callClientId=a,l){var y=tu();this._messageCallbacks[y]=l,h.callbackStamp=y}r.emit("message",h)}}])})(),gh="replace",mh="shallow-merge",$v=[gh,mh],vk=(function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.data,a=e.mergeStrategy,l=a===void 0?gh:a;lr(this,n),n._validateMergeStrategy(l),n._validateData(r,l),this.mergeStrategy=l,this.data=r}return ur(n,[{key:"isNoOp",value:function(){return n.isNoOpUpdate(this.data,this.mergeStrategy)}}],[{key:"isNoOpUpdate",value:function(e,r){return Object.keys(e).length===0&&r===mh}},{key:"_validateMergeStrategy",value:function(e){if(!$v.includes(e))throw Error("Unrecognized mergeStrategy provided. Options are: [".concat($v,"]"))}},{key:"_validateData",value:function(e,r){if(!(function(y){if(y==null||ut(y)!=="object")return!1;var v=Object.getPrototypeOf(y);return v==null||v===Object.prototype})(e))throw Error("Meeting session data must be a plain (map-like) object");var a;try{if(a=JSON.stringify(e),r===gh){var l=JSON.parse(a);In(l,e)||console.warn("The meeting session data provided will be modified when serialized.",l,e)}else if(r===mh){for(var f in e)if(Object.hasOwnProperty.call(e,f)&&e[f]!==void 0){var h=JSON.parse(JSON.stringify(e[f]));In(e[f],h)||console.warn("At least one key in the meeting session data provided will be modified when serialized.",h,e[f])}}}catch(y){throw Error("Meeting session data must be serializable to JSON: ".concat(y))}if(a.length>Ev)throw Error("Meeting session data is too large (".concat(a.length," characters). Maximum size suppported is ").concat(Ev,"."))}}])})();function qv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(qv=function(){return!!n})()}function vh(n){var e=typeof Map=="function"?new Map:void 0;return vh=function(r){if(r===null||!(function(l){try{return Function.toString.call(l).indexOf("[native code]")!==-1}catch{return typeof l=="function"}})(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,a)}function a(){return(function(l,f,h){if(qv())return Reflect.construct.apply(null,arguments);var y=[null];y.push.apply(y,f);var v=new(l.bind.apply(l,y));return h&&bc(v,h.prototype),v})(r,arguments,Fr(this).constructor)}return a.prototype=Object.create(r.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),bc(a,r)},vh(n)}function Wv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(Wv=function(){return!!n})()}function Hv(n){var e,r=(e=window._daily)===null||e===void 0?void 0:e.pendings;if(r){var a=r.indexOf(n);a!==-1&&r.splice(a,1)}}var yk=(function(){return ur((function n(e){lr(this,n),this._currentLoad=null,this._callClientId=e}),[{key:"load",value:function(){var n,e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;if(this.loaded)return window._daily.instances[this._callClientId].callMachine.reset(),void a(!0);n=this._callClientId,window._daily.pendings.push(n),this._currentLoad&&this._currentLoad.cancel(),this._currentLoad=new _k(r,(function(){a(!1)}),(function(f,h){h||Hv(e._callClientId),l(f,h)})),this._currentLoad.start()}},{key:"cancel",value:function(){this._currentLoad&&this._currentLoad.cancel(),Hv(this._callClientId)}},{key:"loaded",get:function(){return this._currentLoad&&this._currentLoad.succeeded}}])})(),_k=(function(){return ur((function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;lr(this,n),this._attemptsRemaining=3,this._currentAttempt=null,this._dailyConfig=e,this._successCallback=r,this._failureCallback=a}),[{key:"start",value:function(){var n=this;if(!this._currentAttempt){var e=function(r){n._currentAttempt.cancelled||(n._attemptsRemaining--,n._failureCallback(r,n._attemptsRemaining>0),n._attemptsRemaining<=0||setTimeout((function(){n._currentAttempt.cancelled||(n._currentAttempt=new Gv(n._dailyConfig,n._successCallback,e),n._currentAttempt.start())}),3e3))};this._currentAttempt=new Gv(this._dailyConfig,this._successCallback,e),this._currentAttempt.start()}}},{key:"cancel",value:function(){this._currentAttempt&&this._currentAttempt.cancel()}},{key:"cancelled",get:function(){return this._currentAttempt&&this._currentAttempt.cancelled}},{key:"succeeded",get:function(){return this._currentAttempt&&this._currentAttempt.succeeded}}])})(),yh=(function(){function n(){return lr(this,n),e=this,a=arguments,r=Fr(r=n),Yl(e,Wv()?Reflect.construct(r,a||[],Fr(e).constructor):r.apply(e,a));var e,r,a}return Xl(n,vh(Error)),ur(n)})(),Tu=2e4,Gv=(function(){return ur((function e(r,a,l){lr(this,e),this._loadAttemptImpl=ot()||!r.avoidEval?new wk(r,a,l):new bk(r,a,l)}),[{key:"start",value:(n=Ge((function*(){return this._loadAttemptImpl.start()})),function(){return n.apply(this,arguments)})},{key:"cancel",value:function(){this._loadAttemptImpl.cancel()}},{key:"cancelled",get:function(){return this._loadAttemptImpl.cancelled}},{key:"succeeded",get:function(){return this._loadAttemptImpl.succeeded}}]);var n})(),wk=(function(){return ur((function l(f,h,y){lr(this,l),this.cancelled=!1,this.succeeded=!1,this._networkTimedOut=!1,this._networkTimeout=null,this._iosCache=typeof iOSCallObjectBundleCache<"u"&&iOSCallObjectBundleCache,this._refetchHeaders=null,this._dailyConfig=f,this._successCallback=h,this._failureCallback=y}),[{key:"start",value:(a=Ge((function*(){var l=nu(this._dailyConfig);!(yield this._tryLoadFromIOSCache(l))&&this._loadFromNetwork(l)})),function(){return a.apply(this,arguments)})},{key:"cancel",value:function(){clearTimeout(this._networkTimeout),this.cancelled=!0}},{key:"_tryLoadFromIOSCache",value:(r=Ge((function*(l){if(!this._iosCache)return!1;try{var f=yield this._iosCache.get(l);return!!this.cancelled||!!f&&(f.code?(Function('"use strict";'+f.code)(),this.succeeded=!0,this._successCallback(),!0):(this._refetchHeaders=f.refetchHeaders,!1))}catch{return!1}})),function(l){return r.apply(this,arguments)})},{key:"_loadFromNetwork",value:(e=Ge((function*(l){var f=this;this._networkTimeout=setTimeout((function(){f._networkTimedOut=!0,f._failureCallback({msg:"Timed out (>".concat(Tu," ms) when loading call object bundle ").concat(l),type:"timeout"})}),Tu);try{var h=this._refetchHeaders?{headers:this._refetchHeaders}:{},y=yield fetch(l,h);if(clearTimeout(this._networkTimeout),this.cancelled||this._networkTimedOut)throw new yh;var v=yield this._getBundleCodeFromResponse(l,y);if(this.cancelled)throw new yh;Function('"use strict";'+v)(),this._iosCache&&this._iosCache.set(l,v,y.headers),this.succeeded=!0,this._successCallback()}catch(b){if(clearTimeout(this._networkTimeout),b instanceof yh||this.cancelled||this._networkTimedOut)return;this._failureCallback({msg:"Failed to load call object bundle ".concat(l,": ").concat(b),type:b.message})}})),function(l){return e.apply(this,arguments)})},{key:"_getBundleCodeFromResponse",value:(n=Ge((function*(l,f){if(f.ok)return yield f.text();if(this._iosCache&&f.status===304)return(yield this._iosCache.renew(l,f.headers)).code;throw new Error("Received ".concat(f.status," response"))})),function(l,f){return n.apply(this,arguments)})}]);var n,e,r,a})(),bk=(function(){return ur((function n(e,r,a){lr(this,n),this.cancelled=!1,this.succeeded=!1,this._dailyConfig=e,this._successCallback=r,this._failureCallback=a,this._attemptId=tu(),this._networkTimeout=null,this._scriptElement=null}),[{key:"start",value:function(){window._dailyCallMachineLoadWaitlist||(window._dailyCallMachineLoadWaitlist=new Set);var n=nu(this._dailyConfig);(typeof document>"u"?"undefined":ut(document))==="object"?this._startLoading(n):this._failureCallback({msg:"Call object bundle must be loaded in a DOM/web context",type:"missing context"})}},{key:"cancel",value:function(){this._stopLoading(),this.cancelled=!0}},{key:"_startLoading",value:function(n){var e=this;this._signUpForCallMachineLoadWaitlist(),this._networkTimeout=setTimeout((function(){e._stopLoading(),e._failureCallback({msg:"Timed out (>".concat(Tu," ms) when loading call object bundle ").concat(n),type:"timeout"})}),Tu);var r=document.getElementsByTagName("head")[0],a=document.createElement("script");this._scriptElement=a,a.onload=function(){e._stopLoading(),e.succeeded=!0,e._successCallback()},a.onerror=function(l){e._stopLoading(),e._failureCallback({msg:"Failed to load call object bundle ".concat(l.target.src),type:l.message})},a.src=n,r.appendChild(a)}},{key:"_stopLoading",value:function(){this._withdrawFromCallMachineLoadWaitlist(),clearTimeout(this._networkTimeout),this._scriptElement&&(this._scriptElement.onload=null,this._scriptElement.onerror=null)}},{key:"_signUpForCallMachineLoadWaitlist",value:function(){window._dailyCallMachineLoadWaitlist.add(this._attemptId)}},{key:"_withdrawFromCallMachineLoadWaitlist",value:function(){window._dailyCallMachineLoadWaitlist.delete(this._attemptId)}}])})(),Ou=function(n,e,r){return kk(n.local,e,r)===!0},Sk=function(n,e,r){return n.local.streams&&n.local.streams[e]&&n.local.streams[e].stream&&n.local.streams[e].stream["get".concat(r==="video"?"Video":"Audio","Tracks")]()[0]},ba=function(n,e,r,a){var l=Ck(n,e,r,a);return l&&l.pendingTrack},kk=function(n,e,r){if(!n)return!1;var a=function(f){switch(f){case"avatar":return!0;case"staged":return f;default:return!!f}},l=n.public.subscribedTracks;return l&&l[e]?["cam-audio","cam-video","screen-video","screen-audio","rmpAudio","rmpVideo"].indexOf(r)===-1&&l[e].custom?[!0,"staged"].includes(l[e].custom)?a(l[e].custom):a(l[e].custom[r]):a(l[e][r]):!l||a(l.ALL)},Ck=function(n,e,r,a){var l=Object.values(n.streams||{}).filter((function(f){return f.participantId===e&&f.type===r&&f.pendingTrack&&f.pendingTrack.kind===a})).sort((function(f,h){return new Date(h.starttime)-new Date(f.starttime)}));return l&&l[0]},Ek=function(n,e){var r=n.local.public.customTracks;if(r&&r[e])return r[e].track};function Jv(n,e){for(var r=e.getState(),a=0,l=["cam","screen"];a<l.length;a++)for(var f=l[a],h=0,y=["video","audio"];h<y.length;h++){var v=y[h],b=f==="cam"?v:"screen".concat(v.charAt(0).toUpperCase()+v.slice(1)),C=n.tracks[b];if(C){var T=n.local?Sk(r,f,v):ba(r,n.session_id,f,v);C.state==="playable"&&(C.track=T),C.persistentTrack=T}}}function Qv(n,e){try{var r=e.getState();for(var a in n.tracks)if(!Mk(a)){var l=n.tracks[a].kind;if(l){var f=n.tracks[a];if(f){var h=n.local?Ek(r,a):ba(r,n.session_id,a,l);f.state==="playable"&&(n.tracks[a].track=h),f.persistentTrack=h}}else console.error("unknown type for custom track")}}catch(y){console.error(y)}}function Mk(n){return["video","audio","screenVideo","screenAudio"].includes(n)}function Kv(n,e,r){var a=r.getState();if(n.local){if(n.audio)try{n.audioTrack=a.local.streams.cam.stream.getAudioTracks()[0],n.audioTrack||(n.audio=!1)}catch{}if(n.video)try{n.videoTrack=a.local.streams.cam.stream.getVideoTracks()[0],n.videoTrack||(n.video=!1)}catch{}if(n.screen)try{n.screenVideoTrack=a.local.streams.screen.stream.getVideoTracks()[0],n.screenAudioTrack=a.local.streams.screen.stream.getAudioTracks()[0],n.screenVideoTrack||n.screenAudioTrack||(n.screen=!1)}catch{}}else{var l=!0;try{var f=a.participants[n.session_id];f&&f.public&&f.public.rtcType&&f.public.rtcType.impl==="peer-to-peer"&&f.private&&!["connected","completed"].includes(f.private.peeringState)&&(l=!1)}catch(C){console.error(C)}if(!l)return n.audio=!1,n.audioTrack=!1,n.video=!1,n.videoTrack=!1,n.screen=!1,void(n.screenTrack=!1);try{if(a.streams,n.audio&&Ou(a,n.session_id,"cam-audio")){var h=ba(a,n.session_id,"cam","audio");h&&(e&&e.audioTrack&&e.audioTrack.id===h.id?n.audioTrack=h:h.muted||(n.audioTrack=h)),n.audioTrack||(n.audio=!1)}if(n.video&&Ou(a,n.session_id,"cam-video")){var y=ba(a,n.session_id,"cam","video");y&&(e&&e.videoTrack&&e.videoTrack.id===y.id?n.videoTrack=y:y.muted||(n.videoTrack=y)),n.videoTrack||(n.video=!1)}if(n.screen&&Ou(a,n.session_id,"screen-audio")){var v=ba(a,n.session_id,"screen","audio");v&&(e&&e.screenAudioTrack&&e.screenAudioTrack.id===v.id?n.screenAudioTrack=v:v.muted||(n.screenAudioTrack=v))}if(n.screen&&Ou(a,n.session_id,"screen-video")){var b=ba(a,n.session_id,"screen","video");b&&(e&&e.screenVideoTrack&&e.screenVideoTrack.id===b.id?n.screenVideoTrack=b:b.muted||(n.screenVideoTrack=b))}n.screenVideoTrack||n.screenAudioTrack||(n.screen=!1)}catch(C){console.error("unexpected error matching up tracks",C)}}}function Tk(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=(function(v,b){if(v){if(typeof v=="string")return Yv(v,b);var C={}.toString.call(v).slice(8,-1);return C==="Object"&&v.constructor&&(C=v.constructor.name),C==="Map"||C==="Set"?Array.from(v):C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C)?Yv(v,b):void 0}})(n))||e){r&&(n=r);var a=0,l=function(){};return{s:l,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(v){throw v},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f,h=!0,y=!1;return{s:function(){r=r.call(n)},n:function(){var v=r.next();return h=v.done,v},e:function(v){y=!0,f=v},f:function(){try{h||r.return==null||r.return()}finally{if(y)throw f}}}}function Yv(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,a=Array(e);r<e;r++)a[r]=n[r];return a}var hi=new Map,Sa=null;function Ok(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=(function(v,b){if(v){if(typeof v=="string")return Xv(v,b);var C={}.toString.call(v).slice(8,-1);return C==="Object"&&v.constructor&&(C=v.constructor.name),C==="Map"||C==="Set"?Array.from(v):C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C)?Xv(v,b):void 0}})(n))||e){r&&(n=r);var a=0,l=function(){};return{s:l,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(v){throw v},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f,h=!0,y=!1;return{s:function(){r=r.call(n)},n:function(){var v=r.next();return h=v.done,v},e:function(v){y=!0,f=v},f:function(){try{h||r.return==null||r.return()}finally{if(y)throw f}}}}function Xv(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,a=Array(e);r<e;r++)a[r]=n[r];return a}var pi=new Map,Oc=null;function Rk(n){Zv()?(function(e){hi.has(e)||(hi.set(e,{}),navigator.mediaDevices.enumerateDevices().then((function(r){hi.has(e)&&(hi.get(e).lastDevicesString=JSON.stringify(r),Sa||(Sa=(function(){var a=Ge((function*(){var l,f=yield navigator.mediaDevices.enumerateDevices(),h=Tk(hi.keys());try{for(h.s();!(l=h.n()).done;){var y=l.value,v=JSON.stringify(f);v!==hi.get(y).lastDevicesString&&(hi.get(y).lastDevicesString=v,y(f))}}catch(b){h.e(b)}finally{h.f()}}));return function(){return a.apply(this,arguments)}})(),navigator.mediaDevices.addEventListener("devicechange",Sa)))})).catch((function(){})))})(n):(function(e){pi.has(e)||(pi.set(e,{}),navigator.mediaDevices.enumerateDevices().then((function(r){pi.has(e)&&(pi.get(e).lastDevicesString=JSON.stringify(r),Oc||(Oc=setInterval(Ge((function*(){var a,l=yield navigator.mediaDevices.enumerateDevices(),f=Ok(pi.keys());try{for(f.s();!(a=f.n()).done;){var h=a.value,y=JSON.stringify(l);y!==pi.get(h).lastDevicesString&&(pi.get(h).lastDevicesString=y,h(l))}}catch(v){f.e(v)}finally{f.f()}})),3e3)))})))})(n)}function Ak(n){Zv()?(function(e){hi.has(e)&&(hi.delete(e),hi.size===0&&Sa&&(navigator.mediaDevices.removeEventListener("devicechange",Sa),Sa=null))})(n):(function(e){pi.has(e)&&(pi.delete(e),pi.size===0&&Oc&&(clearInterval(Oc),Oc=null))})(n)}function Zv(){var n;return ot()||((n=navigator.mediaDevices)===null||n===void 0?void 0:n.ondevicechange)!==void 0}var Pk=new Set;function Ik(n,e){return n&&n.readyState==="live"&&!(function(r,a){return r.muted&&!Pk.has(r.id)})(n)}function ey(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),r.push.apply(r,a)}return r}function vs(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?ey(Object(r),!0).forEach((function(a){fi(n,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):ey(Object(r)).forEach((function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))}))}return n}var Rc=Object.freeze({VIDEO:"video",AUDIO:"audio",SCREEN_VIDEO:"screenVideo",SCREEN_AUDIO:"screenAudio",CUSTOM_VIDEO:"customVideo",CUSTOM_AUDIO:"customAudio"}),xk=Object.freeze({PARTICIPANTS:"participants",STREAMING:"streaming",TRANSCRIPTION:"transcription"}),Ac=Object.values(Rc),ty=["v","a","sv","sa","cv","ca"];Object.freeze(Ac.reduce((function(n,e,r){return n[e]=ty[r],n}),{})),Object.freeze(ty.reduce((function(n,e,r){return n[e]=Ac[r],n}),{}));var Lk=[Rc.VIDEO,Rc.AUDIO,Rc.SCREEN_VIDEO,Rc.SCREEN_AUDIO],ny=Object.values(xk),ry=["p","s","t"];Object.freeze(ny.reduce((function(n,e,r){return n[e]=ry[r],n}),{})),Object.freeze(ry.reduce((function(n,e,r){return n[e]=ny[r],n}),{}));var iy=(function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.base,a=e.byUserId,l=e.byParticipantId;lr(this,n),this.base=r,this.byUserId=a,this.byParticipantId=l}return ur(n,[{key:"clone",value:function(){var e=new n;if(this.base instanceof an?e.base=this.base.clone():e.base=this.base,this.byUserId!==void 0)for(var r in e.byUserId={},this.byUserId){var a=this.byUserId[r];e.byUserId[r]=a instanceof an?a.clone():a}if(this.byParticipantId!==void 0)for(var l in e.byParticipantId={},this.byParticipantId){var f=this.byParticipantId[l];e.byParticipantId[l]=f instanceof an?f.clone():f}return e}},{key:"toJSONObject",value:function(){var e={};if(typeof this.base=="boolean"?e.base=this.base:this.base instanceof an&&(e.base=this.base.toJSONObject()),this.byUserId!==void 0)for(var r in e.byUserId={},this.byUserId){var a=this.byUserId[r];e.byUserId[r]=a instanceof an?a.toJSONObject():a}if(this.byParticipantId!==void 0)for(var l in e.byParticipantId={},this.byParticipantId){var f=this.byParticipantId[l];e.byParticipantId[l]=f instanceof an?f.toJSONObject():f}return e}},{key:"toMinifiedJSONObject",value:function(){var e={};if(this.base!==void 0&&(typeof this.base=="boolean"?e.b=this.base:e.b=this.base.toMinifiedJSONObject()),this.byUserId!==void 0)for(var r in e.u={},this.byUserId){var a=this.byUserId[r];e.u[r]=typeof a=="boolean"?a:a.toMinifiedJSONObject()}if(this.byParticipantId!==void 0)for(var l in e.p={},this.byParticipantId){var f=this.byParticipantId[l];e.p[l]=typeof f=="boolean"?f:f.toMinifiedJSONObject()}return e}},{key:"normalize",value:function(){return this.base instanceof an&&(this.base=this.base.normalize()),this.byUserId&&(this.byUserId=Object.fromEntries(Object.entries(this.byUserId).map((function(e){var r=vn(e,2),a=r[0],l=r[1];return[a,l instanceof an?l.normalize():l]})))),this.byParticipantId&&(this.byParticipantId=Object.fromEntries(Object.entries(this.byParticipantId).map((function(e){var r=vn(e,2),a=r[0],l=r[1];return[a,l instanceof an?l.normalize():l]})))),this}}],[{key:"fromJSONObject",value:function(e){var r,a,l;if(e.base!==void 0&&(r=typeof e.base=="boolean"?e.base:an.fromJSONObject(e.base)),e.byUserId!==void 0)for(var f in a={},e.byUserId){var h=e.byUserId[f];a[f]=typeof h=="boolean"?h:an.fromJSONObject(h)}if(e.byParticipantId!==void 0)for(var y in l={},e.byParticipantId){var v=e.byParticipantId[y];l[y]=typeof v=="boolean"?v:an.fromJSONObject(v)}return new n({base:r,byUserId:a,byParticipantId:l})}},{key:"fromMinifiedJSONObject",value:function(e){var r,a,l;if(e.b!==void 0&&(r=typeof e.b=="boolean"?e.b:an.fromMinifiedJSONObject(e.b)),e.u!==void 0)for(var f in a={},e.u){var h=e.u[f];a[f]=typeof h=="boolean"?h:an.fromMinifiedJSONObject(h)}if(e.p!==void 0)for(var y in l={},e.p){var v=e.p[y];l[y]=typeof v=="boolean"?v:an.fromMinifiedJSONObject(v)}return new n({base:r,byUserId:a,byParticipantId:l})}},{key:"validateJSONObject",value:function(e){if(ut(e)!=="object")return[!1,"canReceive must be an object"];for(var r=["base","byUserId","byParticipantId"],a=0,l=Object.keys(e);a<l.length;a++){var f=l[a];if(!r.includes(f))return[!1,"canReceive can only contain keys (".concat(r.join(", "),")")];if(f==="base"){var h=vn(an.validateJSONObject(e.base,!0),2),y=h[0],v=h[1];if(!y)return[!1,v]}else{if(ut(e[f])!=="object")return[!1,"invalid (non-object) value for field '".concat(f,"' in canReceive")];for(var b=0,C=Object.values(e[f]);b<C.length;b++){var T=C[b],L=vn(an.validateJSONObject(T),2),A=L[0],P=L[1];if(!A)return[!1,P]}}}return[!0]}}])})(),an=(function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.video,a=e.audio,l=e.screenVideo,f=e.screenAudio,h=e.customVideo,y=e.customAudio;lr(this,n),this.video=r,this.audio=a,this.screenVideo=l,this.screenAudio=f,this.customVideo=h,this.customAudio=y}return ur(n,[{key:"clone",value:function(){var e=new n;return this.video!==void 0&&(e.video=this.video),this.audio!==void 0&&(e.audio=this.audio),this.screenVideo!==void 0&&(e.screenVideo=this.screenVideo),this.screenAudio!==void 0&&(e.screenAudio=this.screenAudio),this.customVideo!==void 0&&(e.customVideo=vs({},this.customVideo)),this.customAudio!==void 0&&(e.customAudio=vs({},this.customAudio)),e}},{key:"toJSONObject",value:function(){var e={};return this.video!==void 0&&(e.video=this.video),this.audio!==void 0&&(e.audio=this.audio),this.screenVideo!==void 0&&(e.screenVideo=this.screenVideo),this.screenAudio!==void 0&&(e.screenAudio=this.screenAudio),this.customVideo!==void 0&&(e.customVideo=vs({},this.customVideo)),this.customAudio!==void 0&&(e.customAudio=vs({},this.customAudio)),e}},{key:"toMinifiedJSONObject",value:function(){var e={};return this.video!==void 0&&(e.v=this.video),this.audio!==void 0&&(e.a=this.audio),this.screenVideo!==void 0&&(e.sv=this.screenVideo),this.screenAudio!==void 0&&(e.sa=this.screenAudio),this.customVideo!==void 0&&(e.cv=vs({},this.customVideo)),this.customAudio!==void 0&&(e.ca=vs({},this.customAudio)),e}},{key:"normalize",value:function(){function e(r,a){return r&&Object.keys(r).length===1&&r["*"]===a}return!(this.video!==!0||this.audio!==!0||this.screenVideo!==!0||this.screenAudio!==!0||!e(this.customVideo,!0)||!e(this.customAudio,!0))||(this.video!==!1||this.audio!==!1||this.screenVideo!==!1||this.screenAudio!==!1||!e(this.customVideo,!1)||!e(this.customAudio,!1))&&this}}],[{key:"fromBoolean",value:function(e){return new n({video:e,audio:e,screenVideo:e,screenAudio:e,customVideo:{"*":e},customAudio:{"*":e}})}},{key:"fromJSONObject",value:function(e){return new n({video:e.video,audio:e.audio,screenVideo:e.screenVideo,screenAudio:e.screenAudio,customVideo:e.customVideo!==void 0?vs({},e.customVideo):void 0,customAudio:e.customAudio!==void 0?vs({},e.customAudio):void 0})}},{key:"fromMinifiedJSONObject",value:function(e){return new n({video:e.v,audio:e.a,screenVideo:e.sv,screenAudio:e.sa,customVideo:e.cv,customAudio:e.ca})}},{key:"validateJSONObject",value:function(e,r){if(typeof e=="boolean")return[!0];if(ut(e)!=="object")return[!1,"invalid (non-object, non-boolean) value in canReceive"];for(var a=Object.keys(e),l=0,f=a;l<f.length;l++){var h=f[l];if(!Ac.includes(h))return[!1,"invalid media type '".concat(h,"' in canReceive")];if(Lk.includes(h)){if(typeof e[h]!="boolean")return[!1,"invalid (non-boolean) value for media type '".concat(h,"' in canReceive")]}else{if(ut(e[h])!=="object")return[!1,"invalid (non-object) value for media type '".concat(h,"' in canReceive")];for(var y=0,v=Object.values(e[h]);y<v.length;y++)if(typeof v[y]!="boolean")return[!1,"invalid (non-boolean) value for entry within '".concat(h,"' in canReceive")];if(r&&e[h]["*"]===void 0)return[!1,`canReceive "base" permission must specify "*" as an entry within '`.concat(h,"'")]}}return r&&a.length!==Ac.length?[!1,'canReceive "base" permission must specify all media types: '.concat(Ac.join(", ")," (or be set to a boolean shorthand)")]:[!0]}}])})(),jk=["result"],Nk=["preserveIframe"];function sy(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),r.push.apply(r,a)}return r}function Be(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?sy(Object(r),!0).forEach((function(a){fi(n,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):sy(Object(r)).forEach((function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))}))}return n}function oy(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(oy=function(){return!!n})()}function ay(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=(function(v,b){if(v){if(typeof v=="string")return cy(v,b);var C={}.toString.call(v).slice(8,-1);return C==="Object"&&v.constructor&&(C=v.constructor.name),C==="Map"||C==="Set"?Array.from(v):C==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(C)?cy(v,b):void 0}})(n))||e){r&&(n=r);var a=0,l=function(){};return{s:l,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(v){throw v},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f,h=!0,y=!1;return{s:function(){r=r.call(n)},n:function(){var v=r.next();return h=v.done,v},e:function(v){y=!0,f=v},f:function(){try{h||r.return==null||r.return()}finally{if(y)throw f}}}}function cy(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,a=Array(e);r<e;r++)a[r]=n[r];return a}var Eo={},ly="video",Dk="voice",uy=ot()?{data:{}}:{data:{},topology:"none"},dy={present:0,hidden:0},fy={maxBitrate:{min:1e5,max:25e5},maxFramerate:{min:1,max:30},scaleResolutionDownBy:{min:1,max:8}},_h=Object.keys(fy),hy=["state","volume","simulcastEncodings"],py={androidInCallNotification:{title:"string",subtitle:"string",iconName:"string",disableForCustomOverride:"boolean"},disableAutoDeviceManagement:{audio:"boolean",video:"boolean"}},Ru={id:{iconPath:"string",iconPathDarkMode:"string",label:"string",tooltip:"string",visualState:"'default' | 'sidebar-open' | 'active'"}},wh={id:{allow:"string",controlledBy:"'*' | 'owners' | string[]",csp:"string",iconURL:"string",label:"string",loading:"'eager' | 'lazy'",location:"'main' | 'sidebar'",name:"string",referrerPolicy:"string",sandbox:"string",src:"string",srcdoc:"string",shared:"string[] | 'owners' | boolean"}},Mo={customIntegrations:{validate:Cy,help:Sy()},customTrayButtons:{validate:ky,help:"customTrayButtons should be a dictionary of the type ".concat(JSON.stringify(Ru))},url:{validate:function(n){return typeof n=="string"},help:"url should be a string"},baseUrl:{validate:function(n){return typeof n=="string"},help:"baseUrl should be a string"},token:{validate:function(n){return typeof n=="string"},help:"token should be a string",queryString:"t"},dailyConfig:{validate:function(n,e){try{return e.validateDailyConfig(n),!0}catch(r){console.error("Failed to validate dailyConfig",r)}return!1},help:"Unsupported dailyConfig. Check error logs for detailed info."},reactNativeConfig:{validate:function(n){return Ey(n,py)},help:"reactNativeConfig should look like ".concat(JSON.stringify(py),", all fields optional")},lang:{validate:function(n){return["da","de","en-us","en","es","fi","fr","it","jp","ka","nl","no","pl","pt","pt-BR","ru","sv","tr","user"].includes(n)},help:"language not supported. Options are: da, de, en-us, en, es, fi, fr, it, jp, ka, nl, no, pl, pt, pt-BR, ru, sv, tr, user"},userName:!0,userData:{validate:function(n){try{return my(n),!0}catch(e){return console.error(e),!1}},help:"invalid userData type provided"},startVideoOff:!0,startAudioOff:!0,allowLocalVideo:!0,allowLocalAudio:!0,activeSpeakerMode:!0,showLeaveButton:!0,showLocalVideo:!0,showParticipantsBar:!0,showFullscreenButton:!0,showUserNameChangeUI:!0,iframeStyle:!0,customLayout:!0,cssFile:!0,cssText:!0,bodyClass:!0,videoSource:{validate:function(n,e){if(typeof n=="boolean")return e._preloadCache.allowLocalVideo=n,!0;var r;if(n instanceof MediaStreamTrack)e._sharedTracks.videoTrack=n,r={customTrack:Wi};else{if(delete e._sharedTracks.videoTrack,typeof n!="string")return console.error("videoSource must be a MediaStreamTrack, boolean, or a string"),!1;r={deviceId:n}}return e._updatePreloadCacheInputSettings({video:{settings:r}},!1),!0}},audioSource:{validate:function(n,e){if(typeof n=="boolean")return e._preloadCache.allowLocalAudio=n,!0;var r;if(n instanceof MediaStreamTrack)e._sharedTracks.audioTrack=n,r={customTrack:Wi};else{if(delete e._sharedTracks.audioTrack,typeof n!="string")return console.error("audioSource must be a MediaStreamTrack, boolean, or a string"),!1;r={deviceId:n}}return e._updatePreloadCacheInputSettings({audio:{settings:r}},!1),!0}},subscribeToTracksAutomatically:{validate:function(n,e){return e._preloadCache.subscribeToTracksAutomatically=n,!0}},theme:{validate:function(n){var e=["accent","accentText","background","backgroundAccent","baseText","border","mainAreaBg","mainAreaBgAccent","mainAreaText","supportiveText"],r=function(a){for(var l=0,f=Object.keys(a);l<f.length;l++){var h=f[l];if(!e.includes(h))return console.error('unsupported color "'.concat(h,'". Valid colors: ').concat(e.join(", "))),!1;if(!a[h].match(/^#[0-9a-f]{6}|#[0-9a-f]{3}$/i))return console.error("".concat(h,' theme color should be provided in valid hex color format. Received: "').concat(a[h],'"')),!1}return!0};return ut(n)==="object"&&("light"in n&&"dark"in n||"colors"in n)?"light"in n&&"dark"in n?"colors"in n.light?"colors"in n.dark?r(n.light.colors)&&r(n.dark.colors):(console.error('Dark theme is missing "colors" property.',n),!1):(console.error('Light theme is missing "colors" property.',n),!1):r(n.colors):(console.error('Theme must contain either both "light" and "dark" properties, or "colors".',n),!1)},help:"unsupported theme configuration. Check error logs for detailed info."},layoutConfig:{validate:function(n){if("grid"in n){var e=n.grid;if("maxTilesPerPage"in e){if(!Number.isInteger(e.maxTilesPerPage))return console.error("grid.maxTilesPerPage should be an integer. You passed ".concat(e.maxTilesPerPage,".")),!1;if(e.maxTilesPerPage>49)return console.error("grid.maxTilesPerPage can't be larger than 49 without sacrificing browser performance. Please contact us at https://www.daily.co/contact to talk about your use case."),!1}if("minTilesPerPage"in e){if(!Number.isInteger(e.minTilesPerPage))return console.error("grid.minTilesPerPage should be an integer. You passed ".concat(e.minTilesPerPage,".")),!1;if(e.minTilesPerPage<1)return console.error("grid.minTilesPerPage can't be lower than 1."),!1;if("maxTilesPerPage"in e&&e.minTilesPerPage>e.maxTilesPerPage)return console.error("grid.minTilesPerPage can't be higher than grid.maxTilesPerPage."),!1}}return!0},help:"unsupported layoutConfig. Check error logs for detailed info."},receiveSettings:{validate:function(n){return vy(n,{allowAllParticipantsKey:!1})},help:by({allowAllParticipantsKey:!1})},sendSettings:{validate:function(n,e){return!!(function(r,a){try{return a.validateUpdateSendSettings(r),!0}catch(l){return console.error("Failed to validate send settings",l),!1}})(n,e)&&(e._preloadCache.sendSettings=n,!0)},help:"Invalid sendSettings provided. Check error logs for detailed info."},inputSettings:{validate:function(n,e){var r;return!!yy(n)&&(e._inputSettings||(e._inputSettings={}),_y(n,(r=e.properties)===null||r===void 0?void 0:r.dailyConfig,e._sharedTracks),e._updatePreloadCacheInputSettings(n,!0),!0)},help:kh()},layout:{validate:function(n){return n==="custom-v1"||n==="browser"||n==="none"},help:'layout may only be set to "custom-v1"',queryString:"layout"},emb:{queryString:"emb"},embHref:{queryString:"embHref"},dailyJsVersion:{queryString:"dailyJsVersion"},proxy:{queryString:"proxy"},strictMode:!0,allowMultipleCallInstances:!0},Au={styles:{validate:function(n){for(var e in n)if(e!=="cam"&&e!=="screen")return!1;if(n.cam){for(var r in n.cam)if(r!=="div"&&r!=="video")return!1}if(n.screen){for(var a in n.screen)if(a!=="div"&&a!=="video")return!1}return!0},help:"styles format should be a subset of: { cam: {div: {}, video: {}}, screen: {div: {}, video: {}} }"},setSubscribedTracks:{validate:function(n,e){if(e._preloadCache.subscribeToTracksAutomatically)return!1;var r=[!0,!1,"staged"];if(r.includes(n)||!ot()&&n==="avatar")return!0;var a=["audio","video","screenAudio","screenVideo","rmpAudio","rmpVideo"],l=function(f){var h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];for(var y in f)if(y==="custom"){if(!r.includes(f[y])&&!l(f[y],!0))return!1}else{var v=!h&&!a.includes(y),b=!r.includes(f[y]);if(v||b)return!1}return!0};return l(n)},help:"setSubscribedTracks cannot be used when setSubscribeToTracksAutomatically is enabled, and should be of the form: "+"true".concat(ot()?"":" | 'avatar'"," | false | 'staged' | { [audio: true|false|'staged'], [video: true|false|'staged'], [screenAudio: true|false|'staged'], [screenVideo: true|false|'staged'] }")},setAudio:!0,setVideo:!0,setScreenShare:{validate:function(n){return n===!1},help:"setScreenShare must be false, as it's only meant for stopping remote participants' screen shares"},eject:!0,updatePermissions:{validate:function(n){for(var e=0,r=Object.entries(n);e<r.length;e++){var a=vn(r[e],2),l=a[0],f=a[1];switch(l){case"hasPresence":if(typeof f!="boolean")return!1;break;case"canSend":if(f instanceof Set||f instanceof Array||Array.isArray(f)){var h,y=["video","audio","screenVideo","screenAudio","customVideo","customAudio"],v=ay(f);try{for(v.s();!(h=v.n()).done;){var b=h.value;if(!y.includes(b))return!1}}catch(V){v.e(V)}finally{v.f()}}else if(typeof f!="boolean")return!1;(f instanceof Array||Array.isArray(f))&&(n.canSend=new Set(f));break;case"canReceive":var C=vn(iy.validateJSONObject(f),2),T=C[0],L=C[1];if(!T)return console.error(L),!1;break;case"canAdmin":if(f instanceof Set||f instanceof Array||Array.isArray(f)){var A,P=["participants","streaming","transcription"],R=ay(f);try{for(R.s();!(A=R.n()).done;){var N=A.value;if(!P.includes(N))return!1}}catch(V){R.e(V)}finally{R.f()}}else if(typeof f!="boolean")return!1;(f instanceof Array||Array.isArray(f))&&(n.canAdmin=new Set(f));break;default:return!1}}return!0},help:"updatePermissions can take hasPresence, canSend, canReceive, and canAdmin permissions. hasPresence must be a boolean. canSend can be a boolean or an Array or Set of media types (video, audio, screenVideo, screenAudio, customVideo, customAudio). canReceive must be an object specifying base, byUserId, and/or byParticipantId fields (see documentation for more details). canAdmin can be a boolean or an Array or Set of admin types (participants, streaming, transcription)."}};Promise.any||(Promise.any=(function(){var n=Ge((function*(e){return new Promise((function(r,a){var l=[];e.forEach((function(f){return Promise.resolve(f).then((function(h){r(h)})).catch((function(h){l.push(h),l.length===e.length&&a(l)}))}))}))}));return function(e){return n.apply(this,arguments)}})());var Pu=(function(){function n(g){var M,E,D,z,K,se,pe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(lr(this,n),D=this,z=Fr(z=n),fi(E=Yl(D,oy()?Reflect.construct(z,[],Fr(D).constructor):z.apply(D,K)),"startListeningForDeviceChanges",(function(){Rk(E.handleDeviceChange)})),fi(E,"stopListeningForDeviceChanges",(function(){Ak(E.handleDeviceChange)})),fi(E,"handleDeviceChange",(function($e){$e=$e.map((function(Xe){return JSON.parse(JSON.stringify(Xe))})),E.emitDailyJSEvent({action:"available-devices-updated",availableDevices:$e})})),fi(E,"handleNativeAppStateChange",(function(){var $e=Ge((function*(Xe){if(Xe==="destroyed")return console.warn("App has been destroyed before leaving the meeting. Cleaning up all the resources!"),void(yield E.destroy());var zt=Xe==="active";E.disableReactNativeAutoDeviceManagement("video")||(zt?E.camUnmutedBeforeLosingNativeActiveState&&E.setLocalVideo(!0):(E.camUnmutedBeforeLosingNativeActiveState=E.localVideo(),E.camUnmutedBeforeLosingNativeActiveState&&E.setLocalVideo(!1)))}));return function(Xe){return $e.apply(this,arguments)}})()),fi(E,"handleNativeAudioFocusChange",(function($e){E.disableReactNativeAutoDeviceManagement("audio")||(E._hasNativeAudioFocus=$e,E.toggleParticipantAudioBasedOnNativeAudioFocus(),E._hasNativeAudioFocus?E.micUnmutedBeforeLosingNativeAudioFocus&&E.setLocalAudio(!0):(E.micUnmutedBeforeLosingNativeAudioFocus=E.localAudio(),E.setLocalAudio(!1)))})),fi(E,"handleNativeSystemScreenCaptureStop",(function(){E.stopScreenShare()})),!uh()&&!ot())throw new Error("WebRTC not supported or suppressed");if(E.strictMode=pe.strictMode===void 0||pe.strictMode,E.allowMultipleCallInstances=(M=pe.allowMultipleCallInstances)!==null&&M!==void 0&&M,Object.keys(Eo).length&&(E._logDuplicateInstanceAttempt(),!E.allowMultipleCallInstances)){if(E.strictMode)throw new Error("Duplicate DailyIframe instances are not allowed");console.warn("Using strictMode: false to allow multiple call instances is now deprecated. Set `allowMultipleCallInstances: true`")}if(window._daily||(window._daily={pendings:[],instances:{}}),E.callClientId=tu(),Eo[(se=E).callClientId]=se,window._daily.instances[E.callClientId]={},E._sharedTracks={},window._daily.instances[E.callClientId].tracks=E._sharedTracks,pe.dailyJsVersion=n.version(),E._iframe=g,E._callObjectMode=pe.layout==="none"&&!E._iframe,E._preloadCache={subscribeToTracksAutomatically:!0,outputDeviceId:null,inputSettings:null,sendSettings:null,videoTrackForNetworkConnectivityTest:null,videoTrackForConnectionQualityTest:null},pe.showLocalVideo!==void 0?E._callObjectMode?console.error("showLocalVideo is not available in call object mode"):E._showLocalVideo=!!pe.showLocalVideo:E._showLocalVideo=!0,pe.showParticipantsBar!==void 0?E._callObjectMode?console.error("showParticipantsBar is not available in call object mode"):E._showParticipantsBar=!!pe.showParticipantsBar:E._showParticipantsBar=!0,pe.customIntegrations!==void 0?E._callObjectMode?console.error("customIntegrations is not available in call object mode"):E._customIntegrations=pe.customIntegrations:E._customIntegrations={},pe.customTrayButtons!==void 0?E._callObjectMode?console.error("customTrayButtons is not available in call object mode"):E._customTrayButtons=pe.customTrayButtons:E._customTrayButtons={},pe.activeSpeakerMode!==void 0?E._callObjectMode?console.error("activeSpeakerMode is not available in call object mode"):E._activeSpeakerMode=!!pe.activeSpeakerMode:E._activeSpeakerMode=!1,pe.receiveSettings?E._callObjectMode?E._receiveSettings=pe.receiveSettings:console.error("receiveSettings is only available in call object mode"):E._receiveSettings={},E.validateProperties(pe),E.properties=Be({},pe),E._inputSettings||(E._inputSettings={}),E._callObjectLoader=E._callObjectMode?new yk(E.callClientId):null,E._callState=gv,E._isPreparingToJoin=!1,E._accessState={access:ih},E._meetingSessionSummary={},E._finalSummaryOfPrevSession={},E._meetingSessionState=Ch(uy,E._callObjectMode),E._nativeInCallAudioMode=ly,E._participants={},E._isScreenSharing=!1,E._participantCounts=dy,E._rmpPlayerState={},E._waitingParticipants={},E._network={threshold:"good",quality:100,networkState:"unknown",stats:{}},E._activeSpeaker={},E._localAudioLevel=0,E._isLocalAudioLevelObserverRunning=!1,E._remoteParticipantsAudioLevel={},E._isRemoteParticipantsAudioLevelObserverRunning=!1,E._maxAppMessageSize=sh,E._messageChannel=ot()?new mk:new gk,E._iframe&&(E._iframe.requestFullscreen?E._iframe.addEventListener("fullscreenchange",(function(){document.fullscreenElement===E._iframe?(E.emitDailyJSEvent({action:Su}),E.sendMessageToCallMachine({action:Su})):(E.emitDailyJSEvent({action:ku}),E.sendMessageToCallMachine({action:ku}))})):E._iframe.webkitRequestFullscreen&&E._iframe.addEventListener("webkitfullscreenchange",(function(){document.webkitFullscreenElement===E._iframe?(E.emitDailyJSEvent({action:Su}),E.sendMessageToCallMachine({action:Su})):(E.emitDailyJSEvent({action:ku}),E.sendMessageToCallMachine({action:ku}))}))),ot()){var Re=E.nativeUtils();Re.addAudioFocusChangeListener&&Re.removeAudioFocusChangeListener&&Re.addAppStateChangeListener&&Re.removeAppStateChangeListener&&Re.addSystemScreenCaptureStopListener&&Re.removeSystemScreenCaptureStopListener||console.warn("expected (add|remove)(AudioFocusChange|AppActiveStateChange|SystemScreenCaptureStop)Listener to be available in React Native"),E._hasNativeAudioFocus=!0,Re.addAudioFocusChangeListener(E.handleNativeAudioFocusChange),Re.addAppStateChangeListener(E.handleNativeAppStateChange),Re.addSystemScreenCaptureStopListener(E.handleNativeSystemScreenCaptureStop)}return E._callObjectMode&&E.startListeningForDeviceChanges(),E._messageChannel.addListenerForMessagesFromCallMachine(E.handleMessageFromCallMachine,E.callClientId,E),E}return Xl(n,eu),ur(n,[{key:"destroy",value:(ue=Ge((function*(){var g;try{yield this.leave()}catch{}var M=this._iframe;if(M){var E=M.parentElement;E&&E.removeChild(M)}if(this._messageChannel.removeListener(this.handleMessageFromCallMachine),ot()){var D=this.nativeUtils();D.removeAudioFocusChangeListener(this.handleNativeAudioFocusChange),D.removeAppStateChangeListener(this.handleNativeAppStateChange),D.removeSystemScreenCaptureStopListener(this.handleNativeSystemScreenCaptureStop)}this._callObjectMode&&this.stopListeningForDeviceChanges(),this.resetMeetingDependentVars(),this._destroyed=!0,this.emitDailyJSEvent({action:"call-instance-destroyed"}),delete Eo[this.callClientId],!((g=window)===null||g===void 0||(g=g._daily)===null||g===void 0)&&g.instances&&delete window._daily.instances[this.callClientId],this.strictMode&&(this.callClientId=void 0)})),function(){return ue.apply(this,arguments)})},{key:"isDestroyed",value:function(){return!!this._destroyed}},{key:"loadCss",value:function(g){var M=g.bodyClass,E=g.cssFile,D=g.cssText;return at(),this.sendMessageToCallMachine({action:"load-css",cssFile:this.absoluteUrl(E),bodyClass:M,cssText:D}),this}},{key:"iframe",value:function(){return at(),this._iframe}},{key:"meetingState",value:function(){return this._callState}},{key:"accessState",value:function(){return $r(this._callObjectMode,"accessState()"),this._accessState}},{key:"participants",value:function(){return this._participants}},{key:"participantCounts",value:function(){return this._participantCounts}},{key:"waitingParticipants",value:function(){return $r(this._callObjectMode,"waitingParticipants()"),this._waitingParticipants}},{key:"validateParticipantProperties",value:function(g,M){for(var E in M){if(!Au[E])throw new Error("unrecognized updateParticipant property ".concat(E));if(Au[E].validate&&!Au[E].validate(M[E],this,this._participants[g]))throw new Error(Au[E].help)}}},{key:"updateParticipant",value:function(g,M){return this._participants.local&&this._participants.local.session_id===g&&(g="local"),g&&M&&(this.validateParticipantProperties(g,M),this.sendMessageToCallMachine({action:"update-participant",id:g,properties:M})),this}},{key:"updateParticipants",value:function(g){var M=this._participants.local&&this._participants.local.session_id;for(var E in g)E===M&&(E="local"),E&&g[E]&&this.validateParticipantProperties(E,g[E]);return this.sendMessageToCallMachine({action:"update-participants",participants:g}),this}},{key:"updateWaitingParticipant",value:(Q=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",E=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if($r(this._callObjectMode,"updateWaitingParticipant()"),_t(this._callState,"updateWaitingParticipant()"),typeof M!="string"||ut(E)!=="object")throw new Error("updateWaitingParticipant() must take an id string and a updates object");return new Promise((function(D,z){g.sendMessageToCallMachine({action:"daily-method-update-waiting-participant",id:M,updates:E},(function(K){K.error&&z(K.error),K.id||z(new Error("unknown error in updateWaitingParticipant()")),D({id:K.id})}))}))})),function(){return Q.apply(this,arguments)})},{key:"updateWaitingParticipants",value:(oe=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if($r(this._callObjectMode,"updateWaitingParticipants()"),_t(this._callState,"updateWaitingParticipants()"),ut(M)!=="object")throw new Error("updateWaitingParticipants() must take a mapping between ids and update objects");return new Promise((function(E,D){g.sendMessageToCallMachine({action:"daily-method-update-waiting-participants",updatesById:M},(function(z){z.error&&D(z.error),z.ids||D(new Error("unknown error in updateWaitingParticipants()")),E({ids:z.ids})}))}))})),function(){return oe.apply(this,arguments)})},{key:"requestAccess",value:(Oe=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},E=M.access,D=E===void 0?{level:uS}:E,z=M.name,K=z===void 0?"":z;return $r(this._callObjectMode,"requestAccess()"),_t(this._callState,"requestAccess()"),new Promise((function(se,pe){g.sendMessageToCallMachine({action:"daily-method-request-access",access:D,name:K},(function(Re){Re.error&&pe(Re.error),Re.access||pe(new Error("unknown error in requestAccess()")),se({access:Re.access,granted:Re.granted})}))}))})),function(){return Oe.apply(this,arguments)})},{key:"localAudio",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.audio.state):null}},{key:"localVideo",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.video.state):null}},{key:"setLocalAudio",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"forceDiscardTrack"in M&&(ot()?(console.warn("forceDiscardTrack option not supported in React Native; ignoring"),M={}):g&&(console.warn("forceDiscardTrack option only supported when calling setLocalAudio(false); ignoring"),M={})),this.sendMessageToCallMachine({action:"local-audio",state:g,options:M}),this}},{key:"localScreenAudio",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.screenAudio.state):null}},{key:"localScreenVideo",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.screenVideo.state):null}},{key:"updateScreenShare",value:function(g){if(this._isScreenSharing)return this.sendMessageToCallMachine({action:"local-screen-update",options:g}),this;console.warn("There is no screen share in progress. Try calling startScreenShare first.")}},{key:"setLocalVideo",value:function(g){return this.sendMessageToCallMachine({action:"local-video",state:g}),this}},{key:"_setAllowLocalAudio",value:function(g){if(this._preloadCache.allowLocalAudio=g,this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-allow-local-audio",state:g}),this}},{key:"_setAllowLocalVideo",value:function(g){if(this._preloadCache.allowLocalVideo=g,this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-allow-local-video",state:g}),this}},{key:"getReceiveSettings",value:(ge=Ge((function*(g){var M=this,E=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).showInheritedValues,D=E!==void 0&&E;if($r(this._callObjectMode,"getReceiveSettings()"),!this._callMachineInitialized)return this._receiveSettings;switch(ut(g)){case"string":return new Promise((function(z){M.sendMessageToCallMachine({action:"get-single-participant-receive-settings",id:g,showInheritedValues:D},(function(K){z(K.receiveSettings)}))}));case"undefined":return this._receiveSettings;default:throw new Error('first argument to getReceiveSettings() must be a participant id (or "base"), or there should be no arguments')}})),function(g){return ge.apply(this,arguments)})},{key:"updateReceiveSettings",value:(ve=Ge((function*(g){var M=this;if($r(this._callObjectMode,"updateReceiveSettings()"),!vy(g,{allowAllParticipantsKey:!0}))throw new Error(by({allowAllParticipantsKey:!0}));return _t(this._callState,"updateReceiveSettings()","To specify receive settings earlier, use the receiveSettings config property."),new Promise((function(E){M.sendMessageToCallMachine({action:"update-receive-settings",receiveSettings:g},(function(D){E({receiveSettings:D.receiveSettings})}))}))})),function(g){return ve.apply(this,arguments)})},{key:"_prepInputSettingsForSharing",value:function(g,M){if(g){var E={};if(g.audio){var D,z,K;g.audio.settings&&(!Object.keys(g.audio.settings).length&&M||(E.audio={settings:Be({},g.audio.settings)})),M&&(D=E.audio)!==null&&D!==void 0&&(D=D.settings)!==null&&D!==void 0&&D.customTrack&&(E.audio.settings={customTrack:this._sharedTracks.audioTrack});var se=((z=g.audio.processor)===null||z===void 0?void 0:z.type)==="none"&&((K=g.audio.processor)===null||K===void 0?void 0:K._isDefaultWhenNone);if(g.audio.processor&&!se){var pe=Be({},g.audio.processor);delete pe._isDefaultWhenNone,E.audio=Be(Be({},E.audio),{},{processor:pe})}}if(g.video){var Re,$e,Xe;g.video.settings&&(!Object.keys(g.video.settings).length&&M||(E.video={settings:Be({},g.video.settings)})),M&&(Re=E.video)!==null&&Re!==void 0&&(Re=Re.settings)!==null&&Re!==void 0&&Re.customTrack&&(E.video.settings={customTrack:this._sharedTracks.videoTrack});var zt=(($e=g.video.processor)===null||$e===void 0?void 0:$e.type)==="none"&&((Xe=g.video.processor)===null||Xe===void 0?void 0:Xe._isDefaultWhenNone);if(g.video.processor&&!zt){var Sn=Be({},g.video.processor);delete Sn._isDefaultWhenNone,E.video=Be(Be({},E.video),{},{processor:Sn})}}return E}}},{key:"getInputSettings",value:function(){var g=this;return at(),new Promise((function(M){M(g._getInputSettings())}))}},{key:"_getInputSettings",value:function(){var g,M,E,D,z,K,se={processor:{type:"none",_isDefaultWhenNone:!0}};this._inputSettings?(g=((E=this._inputSettings)===null||E===void 0?void 0:E.video)||se,M=((D=this._inputSettings)===null||D===void 0?void 0:D.audio)||se):(g=((z=this._preloadCache)===null||z===void 0||(z=z.inputSettings)===null||z===void 0?void 0:z.video)||se,M=((K=this._preloadCache)===null||K===void 0||(K=K.inputSettings)===null||K===void 0?void 0:K.audio)||se);var pe={audio:M,video:g};return this._prepInputSettingsForSharing(pe,!0)}},{key:"_updatePreloadCacheInputSettings",value:function(g,M){var E=this._inputSettings||{},D={};if(g.video){var z,K,se;D.video={},g.video.settings?(D.video.settings={},M||g.video.settings.customTrack||(se=E.video)===null||se===void 0||!se.settings?D.video.settings=g.video.settings:D.video.settings=Be(Be({},E.video.settings),g.video.settings),Object.keys(D.video.settings).length||delete D.video.settings):(z=E.video)!==null&&z!==void 0&&z.settings&&(D.video.settings=E.video.settings),g.video.processor?D.video.processor=g.video.processor:(K=E.video)!==null&&K!==void 0&&K.processor&&(D.video.processor=E.video.processor)}else E.video&&(D.video=E.video);if(g.audio){var pe,Re,$e;D.audio={},g.audio.settings?(D.audio.settings={},M||g.audio.settings.customTrack||($e=E.audio)===null||$e===void 0||!$e.settings?D.audio.settings=g.audio.settings:D.audio.settings=Be(Be({},E.audio.settings),g.audio.settings),Object.keys(D.audio.settings).length||delete D.audio.settings):(pe=E.audio)!==null&&pe!==void 0&&pe.settings&&(D.audio.settings=E.audio.settings),g.audio.processor?D.audio.processor=g.audio.processor:(Re=E.audio)!==null&&Re!==void 0&&Re.processor&&(D.audio.processor=E.audio.processor)}else E.audio&&(D.audio=E.audio);this._maybeUpdateInputSettings(D)}},{key:"_devicesFromInputSettings",value:function(g){var M,E,D=(g==null||(M=g.video)===null||M===void 0||(M=M.settings)===null||M===void 0?void 0:M.deviceId)||null,z=(g==null||(E=g.audio)===null||E===void 0||(E=E.settings)===null||E===void 0?void 0:E.deviceId)||null,K=this._preloadCache.outputDeviceId||null;return{camera:D?{deviceId:D}:{},mic:z?{deviceId:z}:{},speaker:K?{deviceId:K}:{}}}},{key:"updateInputSettings",value:(et=Ge((function*(g){var M=this;return at(),yy(g)?g.video||g.audio?(_y(g,this.properties.dailyConfig,this._sharedTracks),this._callObjectMode&&!this._callMachineInitialized?(this._updatePreloadCacheInputSettings(g,!0),this._getInputSettings()):new Promise((function(E,D){M.sendMessageToCallMachine({action:"update-input-settings",inputSettings:g},(function(z){if(z.error)D(z.error);else{if(z.returnPreloadCache)return M._updatePreloadCacheInputSettings(g,!0),void E(M._getInputSettings());M._maybeUpdateInputSettings(z.inputSettings),E(M._prepInputSettingsForSharing(z.inputSettings,!0))}}))}))):this._getInputSettings():(console.error(kh()),Promise.reject(kh()))})),function(g){return et.apply(this,arguments)})},{key:"setBandwidth",value:function(g){var M=g.kbs,E=g.trackConstraints;if(at(),this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-bandwidth",kbs:M,trackConstraints:E}),this}},{key:"getDailyLang",value:function(){var g=this;if(at(),this._callMachineInitialized)return new Promise((function(M){g.sendMessageToCallMachine({action:"get-daily-lang"},(function(E){delete E.action,delete E.callbackStamp,M(E)}))}))}},{key:"setDailyLang",value:function(g){return at(),this.sendMessageToCallMachine({action:"set-daily-lang",lang:g}),this}},{key:"setProxyUrl",value:function(g){return this.sendMessageToCallMachine({action:"set-proxy-url",proxyUrl:g}),this}},{key:"setIceConfig",value:function(g){return this.sendMessageToCallMachine({action:"set-ice-config",iceConfig:g}),this}},{key:"meetingSessionSummary",value:function(){return[ko,ms].includes(this._callState)?this._finalSummaryOfPrevSession:this._meetingSessionSummary}},{key:"getMeetingSession",value:(De=Ge((function*(){var g=this;return console.warn("getMeetingSession() is deprecated: use meetingSessionSummary(), which will return immediately"),_t(this._callState,"getMeetingSession()"),new Promise((function(M){g.sendMessageToCallMachine({action:"get-meeting-session"},(function(E){delete E.action,delete E.callbackStamp,M(E)}))}))})),function(){return De.apply(this,arguments)})},{key:"meetingSessionState",value:function(){return _t(this._callState,"meetingSessionState"),this._meetingSessionState}},{key:"setMeetingSessionData",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"replace";$r(this._callObjectMode,"setMeetingSessionData()"),_t(this._callState,"setMeetingSessionData");try{(function(E,D){new vk({data:E,mergeStrategy:D})})(g,M)}catch(E){throw console.error(E),E}try{this.sendMessageToCallMachine({action:"set-session-data",data:g,mergeStrategy:M})}catch(E){throw new Error("Error setting meeting session data: ".concat(E))}}},{key:"setUserName",value:function(g,M){var E=this;return this.properties.userName=g,new Promise((function(D){E.sendMessageToCallMachine({action:"set-user-name",name:g??"",thisMeetingOnly:ot()||!!M&&!!M.thisMeetingOnly},(function(z){delete z.action,delete z.callbackStamp,D(z)}))}))}},{key:"setUserData",value:(J=Ge((function*(g){var M=this;try{my(g)}catch(E){throw console.error(E),E}if(this.properties.userData=g,this._callMachineInitialized)return new Promise((function(E){try{M.sendMessageToCallMachine({action:"set-user-data",userData:g},(function(D){delete D.action,delete D.callbackStamp,E(D)}))}catch(D){throw new Error("Error setting user data: ".concat(D))}}))})),function(g){return J.apply(this,arguments)})},{key:"validateAudioLevelInterval",value:function(g){if(g&&(g<100||typeof g!="number"))throw new Error("The interval must be a number greater than or equal to 100 milliseconds.")}},{key:"startLocalAudioLevelObserver",value:function(g){var M=this;if(typeof AudioWorkletNode>"u"&&!ot())throw new Error("startLocalAudioLevelObserver() is not supported on this browser");if(this.validateAudioLevelInterval(g),this._callMachineInitialized)return this._isLocalAudioLevelObserverRunning=!0,new Promise((function(E,D){M.sendMessageToCallMachine({action:"start-local-audio-level-observer",interval:g},(function(z){M._isLocalAudioLevelObserverRunning=!z.error,z.error?D({error:z.error}):E()}))}));this._preloadCache.localAudioLevelObserver={enabled:!0,interval:g}}},{key:"isLocalAudioLevelObserverRunning",value:function(){return this._isLocalAudioLevelObserverRunning}},{key:"stopLocalAudioLevelObserver",value:function(){this._preloadCache.localAudioLevelObserver=null,this._localAudioLevel=0,this._isLocalAudioLevelObserverRunning=!1,this.sendMessageToCallMachine({action:"stop-local-audio-level-observer"})}},{key:"startRemoteParticipantsAudioLevelObserver",value:function(g){var M=this;if(this.validateAudioLevelInterval(g),this._callMachineInitialized)return this._isRemoteParticipantsAudioLevelObserverRunning=!0,new Promise((function(E,D){M.sendMessageToCallMachine({action:"start-remote-participants-audio-level-observer",interval:g},(function(z){M._isRemoteParticipantsAudioLevelObserverRunning=!z.error,z.error?D({error:z.error}):E()}))}));this._preloadCache.remoteParticipantsAudioLevelObserver={enabled:!0,interval:g}}},{key:"isRemoteParticipantsAudioLevelObserverRunning",value:function(){return this._isRemoteParticipantsAudioLevelObserverRunning}},{key:"stopRemoteParticipantsAudioLevelObserver",value:function(){this._preloadCache.remoteParticipantsAudioLevelObserver=null,this._remoteParticipantsAudioLevel={},this._isRemoteParticipantsAudioLevelObserverRunning=!1,this.sendMessageToCallMachine({action:"stop-remote-participants-audio-level-observer"})}},{key:"startCamera",value:(ke=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if($r(this._callObjectMode,"startCamera()"),bh(this._callState,this._isPreparingToJoin,"startCamera()","Did you mean to use setLocalAudio() and/or setLocalVideo() instead?"),this.needsLoad())try{yield this.load(M)}catch(E){return Promise.reject(E)}else{if(this._didPreAuth){if(M.url&&M.url!==this.properties.url)return console.error("url in startCamera() is different than the one used in preAuth()"),Promise.reject();if(M.token&&M.token!==this.properties.token)return console.error("token in startCamera() is different than the one used in preAuth()"),Promise.reject()}this.validateProperties(M),this.properties=Be(Be({},this.properties),M)}return new Promise((function(E){g._preloadCache.inputSettings=g._prepInputSettingsForSharing(g._inputSettings,!1),g.sendMessageToCallMachine({action:"start-camera",properties:ka(g.properties,g.callClientId),preloadCache:ka(g._preloadCache,g.callClientId)},(function(D){E({camera:D.camera,mic:D.mic,speaker:D.speaker})}))}))})),function(){return ke.apply(this,arguments)})},{key:"validateCustomTrack",value:function(g,M,E){if(E&&E.length>50)throw new Error("Custom track `trackName` must not be more than 50 characters");if(M&&M!=="music"&&M!=="speech"&&!(M instanceof Object))throw new Error("Custom track `mode` must be either `music` | `speech` | `DailyMicAudioModeSettings` or `undefined`");if(E&&["cam-audio","cam-video","screen-video","screen-audio","rmpAudio","rmpVideo","customVideoDefaults"].includes(E))throw new Error("Custom track `trackName` must not match a track name already used by daily: cam-audio, cam-video, customVideoDefaults, screen-video, screen-audio, rmpAudio, rmpVideo");if(!(g instanceof MediaStreamTrack))throw new Error("Custom tracks provided must be instances of MediaStreamTrack")}},{key:"startCustomTrack",value:function(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{track,mode,trackName,ignoreAudioLevel};return at(),_t(this._callState,"startCustomTrack()"),this.validateCustomTrack(M.track,M.mode,M.trackName),new Promise((function(E,D){g._sharedTracks.customTrack=M.track,M.track=Wi,g.sendMessageToCallMachine({action:"start-custom-track",properties:M},(function(z){z.error?D({error:z.error}):E(z.mediaTag)}))}))}},{key:"stopCustomTrack",value:function(g){var M=this;return at(),_t(this._callState,"stopCustomTrack()"),new Promise((function(E){M.sendMessageToCallMachine({action:"stop-custom-track",mediaTag:g},(function(D){E(D.mediaTag)}))}))}},{key:"setCamera",value:function(g){var M=this;return Pc(),xu(this._callMachineInitialized,"setCamera()"),new Promise((function(E){M.sendMessageToCallMachine({action:"set-camera",cameraDeviceId:g},(function(D){E({device:D.device})}))}))}},{key:"setAudioDevice",value:(Te=Ge((function*(g){return Pc(),this.nativeUtils().setAudioDevice(g),{deviceId:yield this.nativeUtils().getAudioDevice()}})),function(g){return Te.apply(this,arguments)})},{key:"cycleCamera",value:function(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise((function(E){g.sendMessageToCallMachine({action:"cycle-camera",properties:M},(function(D){E({device:D.device})}))}))}},{key:"cycleMic",value:function(){var g=this;return at(),new Promise((function(M){g.sendMessageToCallMachine({action:"cycle-mic"},(function(E){M({device:E.device})}))}))}},{key:"getCameraFacingMode",value:function(){var g=this;return Pc(),new Promise((function(M){g.sendMessageToCallMachine({action:"get-camera-facing-mode"},(function(E){M(E.facingMode)}))}))}},{key:"setInputDevicesAsync",value:(S=Ge((function*(g){var M=this,E=g.audioDeviceId,D=g.videoDeviceId,z=g.audioSource,K=g.videoSource;if(at(),z!==void 0&&(E=z),K!==void 0&&(D=K),typeof E=="boolean"&&(this._setAllowLocalAudio(E),E=void 0),typeof D=="boolean"&&(this._setAllowLocalVideo(D),D=void 0),!E&&!D)return yield this.getInputDevices();var se={};return E&&(E instanceof MediaStreamTrack?(this._sharedTracks.audioTrack=E,E=Wi,se.audio={settings:{customTrack:E}}):(delete this._sharedTracks.audioTrack,se.audio={settings:{deviceId:E}})),D&&(D instanceof MediaStreamTrack?(this._sharedTracks.videoTrack=D,D=Wi,se.video={settings:{customTrack:D}}):(delete this._sharedTracks.videoTrack,se.video={settings:{deviceId:D}})),this._callObjectMode&&this.needsLoad()?(this._updatePreloadCacheInputSettings(se,!1),this._devicesFromInputSettings(this._inputSettings)):new Promise((function(pe){M.sendMessageToCallMachine({action:"set-input-devices",audioDeviceId:E,videoDeviceId:D},(function(Re){if(delete Re.action,delete Re.callbackStamp,Re.returnPreloadCache)return M._updatePreloadCacheInputSettings(se,!1),void pe(M._devicesFromInputSettings(M._inputSettings));pe(Re)}))}))})),function(g){return S.apply(this,arguments)})},{key:"setOutputDeviceAsync",value:(we=Ge((function*(g){var M=this,E=g.outputDeviceId;if(at(),!E||typeof E!="string")throw new Error("outputDeviceId must be provided and must be a valid device id");return this._preloadCache.outputDeviceId=E,this._callObjectMode&&this.needsLoad()?this._devicesFromInputSettings(this._inputSettings):new Promise((function(D,z){M.sendMessageToCallMachine({action:"set-output-device",outputDeviceId:E},(function(K){if(delete K.action,delete K.callbackStamp,K.error){var se=new Error(K.error.message);return se.type=K.error.type,void z(se)}K.returnPreloadCache?D(M._devicesFromInputSettings(M._inputSettings)):D(K)}))}))})),function(g){return we.apply(this,arguments)})},{key:"getInputDevices",value:(ae=Ge((function*(){var g=this;return this._callObjectMode&&this.needsLoad()?this._devicesFromInputSettings(this._inputSettings):new Promise((function(M){g.sendMessageToCallMachine({action:"get-input-devices"},(function(E){E.returnPreloadCache?M(g._devicesFromInputSettings(g._inputSettings)):M({camera:E.camera,mic:E.mic,speaker:E.speaker})}))}))})),function(){return ae.apply(this,arguments)})},{key:"nativeInCallAudioMode",value:function(){return Pc(),this._nativeInCallAudioMode}},{key:"setNativeInCallAudioMode",value:function(g){if(Pc(),[ly,Dk].includes(g)){if(g!==this._nativeInCallAudioMode)return this._nativeInCallAudioMode=g,!this.disableReactNativeAutoDeviceManagement("audio")&&Iu(this._callState,this._isPreparingToJoin)&&this.nativeUtils().setAudioMode(this._nativeInCallAudioMode),this}else console.error("invalid in-call audio mode specified: ",g)}},{key:"preAuth",value:(me=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if($r(this._callObjectMode,"preAuth()"),bh(this._callState,this._isPreparingToJoin,"preAuth()"),this.needsLoad()&&(yield this.load(M)),!M.url)throw new Error("preAuth() requires at least a url to be provided");return this.validateProperties(M),this.properties=Be(Be({},this.properties),M),new Promise((function(E,D){g._preloadCache.inputSettings=g._prepInputSettingsForSharing(g._inputSettings,!1),g.sendMessageToCallMachine({action:"daily-method-preauth",properties:ka(g.properties,g.callClientId),preloadCache:ka(g._preloadCache,g.callClientId)},(function(z){return z.error?D(z.error):z.access?(g._didPreAuth=!0,void E({access:z.access})):D(new Error("unknown error in preAuth()"))}))}))})),function(){return me.apply(this,arguments)})},{key:"load",value:(re=Ge((function*(g){var M=this;if(this.needsLoad()){if(this._destroyed&&(this._logUseAfterDestroy(),this.strictMode))throw new Error("Use after destroy");if(g&&(this.validateProperties(g),this.properties=Be(Be({},this.properties),g)),!this._callObjectMode&&!this.properties.url)throw new Error("can't load iframe meeting because url property isn't set");return this._updateCallState(mv),this.emitDailyJSEvent({action:vS}),this._callObjectMode?new Promise((function(E,D){M._callObjectLoader.cancel();var z=Date.now();M._callObjectLoader.load(M.properties.dailyConfig,(function(K){M._bundleLoadTime=K?"no-op":Date.now()-z,M._updateCallState(vv),K&&M.emitDailyJSEvent({action:_v}),E()}),(function(K,se){if(M.emitDailyJSEvent({action:yS}),!se){M._updateCallState(ms),M.resetMeetingDependentVars();var pe={action:Cv,errorMsg:K.msg,error:{type:"connection-error",msg:"Failed to load call object bundle.",details:{on:"load",sourceError:K,bundleUrl:nu(M.properties.dailyConfig)}}};M._maybeSendToSentry(pe),M.emitDailyJSEvent(pe),D(K.msg)}}))})):(this._iframe.src=nm(this.assembleMeetingUrl(),this.properties.dailyConfig),new Promise((function(E,D){M._loadedCallback=function(z){M._callState!==ms?(M._updateCallState(vv),(M.properties.cssFile||M.properties.cssText)&&M.loadCss(M.properties),E()):D(z)}})))}})),function(g){return re.apply(this,arguments)})},{key:"join",value:(q=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._testCallInProgress&&this.stopTestCallQuality();var E=!1;if(this.needsLoad()){this.updateIsPreparingToJoin(!0);try{yield this.load(M)}catch(D){return this.updateIsPreparingToJoin(!1),Promise.reject(D)}}else{if(E=!(!this.properties.cssFile&&!this.properties.cssText),this._didPreAuth){if(M.url&&M.url!==this.properties.url)return console.error("url in join() is different than the one used in preAuth()"),this.updateIsPreparingToJoin(!1),Promise.reject();if(M.token&&M.token!==this.properties.token)return console.error("token in join() is different than the one used in preAuth()"),this.updateIsPreparingToJoin(!1),Promise.reject()}if(M.url&&!this._callObjectMode&&M.url&&M.url!==this.properties.url)return console.error("url in join() is different than the one used in load() (".concat(this.properties.url," -> ").concat(M.url,")")),this.updateIsPreparingToJoin(!1),Promise.reject();this.validateProperties(M),this.properties=Be(Be({},this.properties),M)}return M.showLocalVideo!==void 0&&(this._callObjectMode?console.error("showLocalVideo is not available in callObject mode"):this._showLocalVideo=!!M.showLocalVideo),M.showParticipantsBar!==void 0&&(this._callObjectMode?console.error("showParticipantsBar is not available in callObject mode"):this._showParticipantsBar=!!M.showParticipantsBar),this._callState===So||this._callState===rh?(console.warn("already joined meeting, call leave() before joining again"),void this.updateIsPreparingToJoin(!1)):(this._updateCallState(rh,!1),this.emitDailyJSEvent({action:bS}),this._preloadCache.inputSettings=this._prepInputSettingsForSharing(this._inputSettings||{},!1),this.sendMessageToCallMachine({action:"join-meeting",properties:ka(this.properties,this.callClientId),preloadCache:ka(this._preloadCache,this.callClientId)}),new Promise((function(D,z){g._joinedCallback=function(K,se){if(g._callState!==ms){if(g._updateCallState(So),K)for(var pe in K){if(g._callObjectMode){var Re=g._callMachine().store;Jv(K[pe],Re),Qv(K[pe],Re),Kv(K[pe],g._participants[pe],Re)}g._participants[pe]=Be({},K[pe]),g.toggleParticipantAudioBasedOnNativeAudioFocus()}E&&g.loadCss(g.properties),D(K)}else z(se)}})))})),function(){return q.apply(this,arguments)})},{key:"leave",value:($=Ge((function*(){var g=this;return this._testCallInProgress&&this.stopTestCallQuality(),new Promise((function(M){g._callState===ko||g._callState===ms?M():g._callObjectLoader&&!g._callObjectLoader.loaded?(g._callObjectLoader.cancel(),g._updateCallState(ko),g.resetMeetingDependentVars(),g.emitDailyJSEvent({action:ko}),M()):(g._resolveLeave=M,g.sendMessageToCallMachine({action:"leave-meeting"}))}))})),function(){return $.apply(this,arguments)})},{key:"startScreenShare",value:(x=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(xu(this._callMachineInitialized,"startScreenShare()"),M.screenVideoSendSettings&&this._validateVideoSendSettings("screenVideo",M.screenVideoSendSettings),M.mediaStream&&(this._sharedTracks.screenMediaStream=M.mediaStream,M.mediaStream=Wi),typeof DailyNativeUtils<"u"&&DailyNativeUtils.isIOS!==void 0&&DailyNativeUtils.isIOS){var E=this.nativeUtils();if(yield E.isScreenBeingCaptured())return void this.emitDailyJSEvent({action:kv,type:"screen-share-error",errorMsg:"Could not start the screen sharing. The screen is already been captured!"});E.setSystemScreenCaptureStartCallback((function(){E.setSystemScreenCaptureStartCallback(null),g.sendMessageToCallMachine({action:Mv,captureOptions:M})})),E.presentSystemScreenCapturePrompt()}else this.sendMessageToCallMachine({action:Mv,captureOptions:M})})),function(){return x.apply(this,arguments)})},{key:"stopScreenShare",value:function(){xu(this._callMachineInitialized,"stopScreenShare()"),this.sendMessageToCallMachine({action:"local-screen-stop"})}},{key:"startRecording",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=g.type;if(M&&M!=="cloud"&&M!=="raw-tracks"&&M!=="local")throw new Error("invalid type: ".concat(M,", allowed values 'cloud', 'raw-tracks', or 'local'"));this.sendMessageToCallMachine(Be({action:"local-recording-start"},g))}},{key:"updateRecording",value:function(g){var M=g.layout,E=M===void 0?{preset:"default"}:M,D=g.instanceId;this.sendMessageToCallMachine({action:"daily-method-update-recording",layout:E,instanceId:D})}},{key:"stopRecording",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(Be({action:"local-recording-stop"},g))}},{key:"startLiveStreaming",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(Be({action:"daily-method-start-live-streaming"},g))}},{key:"updateLiveStreaming",value:function(g){var M=g.layout,E=M===void 0?{preset:"default"}:M,D=g.instanceId;this.sendMessageToCallMachine({action:"daily-method-update-live-streaming",layout:E,instanceId:D})}},{key:"addLiveStreamingEndpoints",value:function(g){var M=g.endpoints,E=g.instanceId;this.sendMessageToCallMachine({action:Tv,endpointsOp:lk,endpoints:M,instanceId:E})}},{key:"removeLiveStreamingEndpoints",value:function(g){var M=g.endpoints,E=g.instanceId;this.sendMessageToCallMachine({action:Tv,endpointsOp:uk,endpoints:M,instanceId:E})}},{key:"stopLiveStreaming",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(Be({action:"daily-method-stop-live-streaming"},g))}},{key:"validateDailyConfig",value:function(g){g.camSimulcastEncodings&&(console.warn("camSimulcastEncodings is deprecated. Use sendSettings, found in DailyCallOptions, to provide camera simulcast settings."),this.validateSimulcastEncodings(g.camSimulcastEncodings)),g.screenSimulcastEncodings&&console.warn("screenSimulcastEncodings is deprecated. Use sendSettings, found in DailyCallOptions, to provide screen simulcast settings."),Lv()&&g.noAutoDefaultDeviceChange&&console.warn("noAutoDefaultDeviceChange is not supported on Android, and will be ignored.")}},{key:"validateSimulcastEncodings",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,E=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(g){if(!(g instanceof Array||Array.isArray(g)))throw new Error("encodings must be an Array");if(!Oy(g.length,1,3))throw new Error("encodings must be an Array with between 1 to ".concat(3," layers"));for(var D=0;D<g.length;D++){var z=g[D];for(var K in this._validateEncodingLayerHasValidProperties(z),z)if(_h.includes(K)){if(typeof z[K]!="number")throw new Error("".concat(K," must be a number"));if(M){var se=M[K],pe=se.min,Re=se.max;if(!Oy(z[K],pe,Re))throw new Error("".concat(K," value not in range. valid range: ").concat(pe," to ").concat(Re))}}else if(!["active","scalabilityMode"].includes(K))throw new Error("Invalid key ".concat(K,", valid keys are:")+Object.values(_h));if(E&&!z.hasOwnProperty("maxBitrate"))throw new Error("maxBitrate is not specified")}}}},{key:"startRemoteMediaPlayer",value:(X=Ge((function*(g){var M=this,E=g.url,D=g.settings,z=D===void 0?{state:ah.PLAY}:D;try{(function(K){if(typeof K!="string")throw new Error('url parameter must be "string" type')})(E),Ty(z),(function(K){for(var se in K)if(!hy.includes(se))throw new Error("Invalid key ".concat(se,", valid keys are: ").concat(hy));K.simulcastEncodings&&this.validateSimulcastEncodings(K.simulcastEncodings,fy,!0)})(z)}catch(K){throw console.error("invalid argument Error: ".concat(K)),console.error(`startRemoteMediaPlayer arguments must be of the form:
  { url: "playback url",
  settings?:
  {state: "play"|"pause", simulcastEncodings?: [{}] } }`),K}return new Promise((function(K,se){M.sendMessageToCallMachine({action:"daily-method-start-remote-media-player",url:E,settings:z},(function(pe){pe.error?se({error:pe.error,errorMsg:pe.errorMsg}):K({session_id:pe.session_id,remoteMediaPlayerState:{state:pe.state,settings:pe.settings}})}))}))})),function(g){return X.apply(this,arguments)})},{key:"stopRemoteMediaPlayer",value:(G=Ge((function*(g){var M=this;if(typeof g!="string")throw new Error(" remotePlayerID must be of type string");return new Promise((function(E,D){M.sendMessageToCallMachine({action:"daily-method-stop-remote-media-player",session_id:g},(function(z){z.error?D({error:z.error,errorMsg:z.errorMsg}):E()}))}))})),function(g){return G.apply(this,arguments)})},{key:"updateRemoteMediaPlayer",value:(V=Ge((function*(g){var M=this,E=g.session_id,D=g.settings;try{Ty(D)}catch(z){throw console.error("invalid argument Error: ".concat(z)),console.error(`updateRemoteMediaPlayer arguments must be of the form:
  session_id: "participant session",
  { settings?: {state: "play"|"pause"} }`),z}return new Promise((function(z,K){M.sendMessageToCallMachine({action:"daily-method-update-remote-media-player",session_id:E,settings:D},(function(se){se.error?K({error:se.error,errorMsg:se.errorMsg}):z({session_id:se.session_id,remoteMediaPlayerState:{state:se.state,settings:se.settings}})}))}))})),function(g){return V.apply(this,arguments)})},{key:"startTranscription",value:function(g){_t(this._callState,"startTranscription()"),this.sendMessageToCallMachine(Be({action:"daily-method-start-transcription"},g))}},{key:"updateTranscription",value:function(g){if(_t(this._callState,"updateTranscription()"),!g)throw new Error("updateTranscription Error: options is mandatory");if(ut(g)!=="object")throw new Error("updateTranscription Error: options must be object type");if(g.participants&&!Array.isArray(g.participants))throw new Error("updateTranscription Error: participants must be an array");this.sendMessageToCallMachine(Be({action:"daily-method-update-transcription"},g))}},{key:"stopTranscription",value:function(g){if(_t(this._callState,"stopTranscription()"),g&&ut(g)!=="object")throw new Error("stopTranscription Error: options must be object type");if(g&&!g.instanceId)throw new Error('"instanceId" not provided');this.sendMessageToCallMachine(Be({action:"daily-method-stop-transcription"},g))}},{key:"startDialOut",value:(N=Ge((function*(g){var M=this;_t(this._callState,"startDialOut()");var E=function(se){if(se){if(!Array.isArray(se))throw new Error("Error starting dial out: audio codec must be an array");if(se.length<=0)throw new Error("Error starting dial out: audio codec array specified but empty");se.forEach((function(pe){if(typeof pe!="string")throw new Error("Error starting dial out: audio codec must be a string");if(pe!=="OPUS"&&pe!=="PCMU"&&pe!=="PCMA"&&pe!=="G722")throw new Error("Error starting dial out: audio codec must be one of OPUS, PCMU, PCMA, G722")}))}};if(!g.sipUri&&!g.phoneNumber)throw new Error("Error starting dial out: either a sip uri or phone number must be provided");if(g.sipUri&&g.phoneNumber)throw new Error("Error starting dial out: only one of sip uri or phone number must be provided");if(g.sipUri){if(typeof g.sipUri!="string")throw new Error("Error starting dial out: sipUri must be a string");if(!g.sipUri.startsWith("sip:"))throw new Error("Error starting dial out: Invalid SIP URI, must start with 'sip:'");if(g.video&&typeof g.video!="boolean")throw new Error("Error starting dial out: video must be a boolean value");(function(se){if(se&&(E(se.audio),se.video)){if(!Array.isArray(se.video))throw new Error("Error starting dial out: video codec must be an array");if(se.video.length<=0)throw new Error("Error starting dial out: video codec array specified but empty");se.video.forEach((function(pe){if(typeof pe!="string")throw new Error("Error starting dial out: video codec must be a string");if(pe!=="H264"&&pe!=="VP8")throw new Error("Error starting dial out: video codec must be H264 or VP8")}))}})(g.codecs)}if(g.phoneNumber){if(typeof g.phoneNumber!="string")throw new Error("Error starting dial out: phoneNumber must be a string");if(!/^\+\d{1,}$/.test(g.phoneNumber))throw new Error("Error starting dial out: Invalid phone number, must be valid phone number as per E.164");g.codecs&&E(g.codecs.audio)}if(g.callerId){if(typeof g.callerId!="string")throw new Error("Error starting dial out: callerId must be a string");if(g.sipUri)throw new Error("Error starting dial out: callerId not allowed with sipUri")}if(g.displayName){if(typeof g.displayName!="string")throw new Error("Error starting dial out: displayName must be a string");if(g.displayName.length>=200)throw new Error("Error starting dial out: displayName length must be less than 200")}if(g.userId){if(typeof g.userId!="string")throw new Error("Error starting dial out: userId must be a string");if(g.userId.length>36)throw new Error("Error starting dial out: userId length must be less than or equal to 36")}if(gy(g),g.permissions&&g.permissions.canReceive){var D=vn(iy.validateJSONObject(g.permissions.canReceive),2),z=D[0],K=D[1];if(!z)throw new Error(K)}return new Promise((function(se,pe){M.sendMessageToCallMachine(Be({action:"dialout-start"},g),(function(Re){Re.error?pe(Re.error):se(Re)}))}))})),function(g){return N.apply(this,arguments)})},{key:"stopDialOut",value:function(g){var M=this;return _t(this._callState,"stopDialOut()"),new Promise((function(E,D){M.sendMessageToCallMachine(Be({action:"dialout-stop"},g),(function(z){z.error?D(z.error):E(z)}))}))}},{key:"sipCallTransfer",value:(R=Ge((function*(g){var M=this;if(_t(this._callState,"sipCallTransfer()"),!g)throw new Error("sipCallTransfer() requires a sessionId and toEndPoint");return g.useSipRefer=!1,My(g,"sipCallTransfer"),gy(g),new Promise((function(E,D){M.sendMessageToCallMachine(Be({action:Rv},g),(function(z){z.error?D(z.error):E(z)}))}))})),function(g){return R.apply(this,arguments)})},{key:"sipRefer",value:(P=Ge((function*(g){var M=this;if(_t(this._callState,"sipRefer()"),!g)throw new Error("sessionId and toEndPoint are mandatory parameter");return g.useSipRefer=!0,My(g,"sipRefer"),new Promise((function(E,D){M.sendMessageToCallMachine(Be({action:Rv},g),(function(z){z.error?D(z.error):E(z)}))}))})),function(g){return P.apply(this,arguments)})},{key:"sendDTMF",value:(A=Ge((function*(g){var M=this;return _t(this._callState,"sendDTMF()"),(function(E){var D=E.sessionId,z=E.tones;if(!D||!z)throw new Error("sessionId and tones are mandatory parameter");if(typeof D!="string"||typeof z!="string")throw new Error("sessionId and tones should be of string type");if(z.length>20)throw new Error("tones string must be upto 20 characters");var K=/[^0-9A-D*#]/g,se=z.match(K);if(se&&se[0])throw new Error("".concat(se[0]," is not valid DTMF tone"))})(g),new Promise((function(E,D){M.sendMessageToCallMachine(Be({action:"send-dtmf"},g),(function(z){z.error?D(z.error):E(z)}))}))})),function(g){return A.apply(this,arguments)})},{key:"getNetworkStats",value:function(){var g=this;return this._callState!==So?Promise.resolve(Be({stats:{latest:{}}},this._network)):new Promise((function(M){g.sendMessageToCallMachine({action:"get-calc-stats"},(function(E){M(Be(Be({},g._network),{},{stats:E.stats}))}))}))}},{key:"testWebsocketConnectivity",value:(L=Ge((function*(){var g=this;if(Sh(this._testCallInProgress,"testWebsocketConnectivity()"),this.needsLoad())try{yield this.load()}catch(M){return Promise.reject(M)}return new Promise((function(M,E){g.sendMessageToCallMachine({action:"test-websocket-connectivity"},(function(D){D.error?E(D.error):M(D.results)}))}))})),function(){return L.apply(this,arguments)})},{key:"abortTestWebsocketConnectivity",value:function(){this.sendMessageToCallMachine({action:"abort-test-websocket-connectivity"})}},{key:"_validateVideoTrackForNetworkTests",value:function(g){return g?g instanceof MediaStreamTrack?!!Ik(g)||(console.error("Video track is not playable. This test needs a live video track."),!1):(console.error("Video track needs to be of type `MediaStreamTrack`."),!1):(console.error("Missing video track. You must provide a video track in order to run this test."),!1)}},{key:"testCallQuality",value:(T=Ge((function*(){var g=this;at(),$r(this._callObjectMode,"testCallQuality()"),xu(this._callMachineInitialized,"testCallQuality()",null,!0),bh(this._callState,this._isPreparingToJoin,"testCallQuality()");var M=this._testCallAlreadyInProgress,E=function(z){M||(g._testCallInProgress=z)};if(E(!0),this.needsLoad())try{var D=this._callState;yield this.load(),this._callState=D}catch(z){return E(!1),Promise.reject(z)}return new Promise((function(z){g.sendMessageToCallMachine({action:"test-call-quality",dailyJsVersion:g.properties.dailyJsVersion},(function(K){var se=K.results,pe=se.result,Re=Hg(se,jk);if(pe==="failed"){var $e,Xe=Be({},Re);($e=Re.error)!==null&&$e!==void 0&&$e.details?(Re.error.details=JSON.parse(Re.error.details),Xe.error=Be(Be({},Xe.error),{},{details:Be({},Xe.error.details)}),Xe.error.details.duringTest="testCallQuality"):(Xe.error=Xe.error?Be({},Xe.error):{},Xe.error.details={duringTest:"testCallQuality"}),g._maybeSendToSentry(Xe)}E(!1),z(Be({result:pe},Re))}))}))})),function(){return T.apply(this,arguments)})},{key:"stopTestCallQuality",value:function(){this.sendMessageToCallMachine({action:"stop-test-call-quality"})}},{key:"testConnectionQuality",value:(C=Ge((function*(g){var M;ot()?(console.warn("testConnectionQuality() is deprecated: use testPeerToPeerCallQuality() instead"),M=yield this.testPeerToPeerCallQuality(g)):(console.warn("testConnectionQuality() is deprecated: use testCallQuality() instead"),M=yield this.testCallQuality());var E={result:M.result,secondsElapsed:M.secondsElapsed};return M.data&&(E.data={maxRTT:M.data.maxRoundTripTime,packetLoss:M.data.avgRecvPacketLoss}),E})),function(g){return C.apply(this,arguments)})},{key:"testPeerToPeerCallQuality",value:(b=Ge((function*(g){var M=this;if(Sh(this._testCallInProgress,"testPeerToPeerCallQuality()"),this.needsLoad())try{yield this.load()}catch(z){return Promise.reject(z)}var E=g.videoTrack,D=g.duration;if(!this._validateVideoTrackForNetworkTests(E))throw new Error("Video track error");return this._sharedTracks.videoTrackForConnectionQualityTest=E,new Promise((function(z,K){M.sendMessageToCallMachine({action:"test-p2p-call-quality",duration:D},(function(se){se.error?K(se.error):z(se.results)}))}))})),function(g){return b.apply(this,arguments)})},{key:"stopTestConnectionQuality",value:function(){ot()?(console.warn("stopTestConnectionQuality() is deprecated: use testPeerToPeerCallQuality() and stopTestPeerToPeerCallQuality() instead"),this.stopTestPeerToPeerCallQuality()):(console.warn("stopTestConnectionQuality() is deprecated: use testCallQuality() and stopTestCallQuality() instead"),this.stopTestCallQuality())}},{key:"stopTestPeerToPeerCallQuality",value:function(){this.sendMessageToCallMachine({action:"stop-test-p2p-call-quality"})}},{key:"testNetworkConnectivity",value:(v=Ge((function*(g){var M=this;if(Sh(this._testCallInProgress,"testNetworkConnectivity()"),this.needsLoad())try{yield this.load()}catch(E){return Promise.reject(E)}if(!this._validateVideoTrackForNetworkTests(g))throw new Error("Video track error");return this._sharedTracks.videoTrackForNetworkConnectivityTest=g,new Promise((function(E,D){M.sendMessageToCallMachine({action:"test-network-connectivity"},(function(z){z.error?D(z.error):E(z.results)}))}))})),function(g){return v.apply(this,arguments)})},{key:"abortTestNetworkConnectivity",value:function(){this.sendMessageToCallMachine({action:"abort-test-network-connectivity"})}},{key:"getCpuLoadStats",value:function(){var g=this;return new Promise((function(M){g._callState===So?g.sendMessageToCallMachine({action:"get-cpu-load-stats"},(function(E){M(E.cpuStats)})):M({cpuLoadState:void 0,cpuLoadStateReason:void 0,stats:{}})}))}},{key:"_validateEncodingLayerHasValidProperties",value:function(g){var M;if(!(((M=Object.keys(g))===null||M===void 0?void 0:M.length)>0))throw new Error("Empty encoding is not allowed. At least one of these valid keys should be specified:"+Object.values(_h))}},{key:"_validateVideoSendSettings",value:function(g,M){var E=g==="screenVideo"?["default-screen-video","detail-optimized","motion-optimized","motion-and-detail-balanced"]:["default-video","bandwidth-optimized","bandwidth-and-quality-balanced","quality-optimized","adaptive-2-layers","adaptive-3-layers"],D="Video send settings should be either an object or one of the supported presets: ".concat(E.join());if(typeof M=="string"){if(!E.includes(M))throw new Error(D)}else{if(ut(M)!=="object")throw new Error(D);if(!M.maxQuality&&!M.encodings&&M.allowAdaptiveLayers===void 0)throw new Error("Video send settings must contain at least maxQuality, allowAdaptiveLayers or encodings attribute");if(M.maxQuality&&["low","medium","high"].indexOf(M.maxQuality)===-1)throw new Error("maxQuality must be either low, medium or high");if(M.encodings){var z=!1;switch(Object.keys(M.encodings).length){case 1:z=!M.encodings.low;break;case 2:z=!M.encodings.low||!M.encodings.medium;break;case 3:z=!M.encodings.low||!M.encodings.medium||!M.encodings.high;break;default:z=!0}if(z)throw new Error("Encodings must be defined as: low, low and medium, or low, medium and high.");M.encodings.low&&this._validateEncodingLayerHasValidProperties(M.encodings.low),M.encodings.medium&&this._validateEncodingLayerHasValidProperties(M.encodings.medium),M.encodings.high&&this._validateEncodingLayerHasValidProperties(M.encodings.high)}}}},{key:"validateUpdateSendSettings",value:function(g){var M=this;if(!g||Object.keys(g).length===0)throw new Error("Send settings must contain at least information for one track!");Object.entries(g).forEach((function(E){var D=vn(E,2),z=D[0],K=D[1];M._validateVideoSendSettings(z,K)}))}},{key:"updateSendSettings",value:function(g){var M=this;return this.validateUpdateSendSettings(g),this.needsLoad()?(this._preloadCache.sendSettings=g,{sendSettings:this._preloadCache.sendSettings}):new Promise((function(E,D){M.sendMessageToCallMachine({action:"update-send-settings",sendSettings:g},(function(z){z.error?D(z.error):E(z.sendSettings)}))}))}},{key:"getSendSettings",value:function(){return this._sendSettings||this._preloadCache.sendSettings}},{key:"getLocalAudioLevel",value:function(){return this._localAudioLevel}},{key:"getRemoteParticipantsAudioLevel",value:function(){return this._remoteParticipantsAudioLevel}},{key:"getActiveSpeaker",value:function(){return at(),this._activeSpeaker}},{key:"setActiveSpeakerMode",value:function(g){return at(),this.sendMessageToCallMachine({action:"set-active-speaker-mode",enabled:g}),this}},{key:"activeSpeakerMode",value:function(){return at(),this._activeSpeakerMode}},{key:"subscribeToTracksAutomatically",value:function(){return this._preloadCache.subscribeToTracksAutomatically}},{key:"setSubscribeToTracksAutomatically",value:function(g){return _t(this._callState,"setSubscribeToTracksAutomatically()","Use the subscribeToTracksAutomatically configuration property."),this._preloadCache.subscribeToTracksAutomatically=g,this.sendMessageToCallMachine({action:"daily-method-subscribe-to-tracks-automatically",enabled:g}),this}},{key:"enumerateDevices",value:(y=Ge((function*(){var g=this;if(this._callObjectMode){var M=yield navigator.mediaDevices.enumerateDevices();return Co()==="Firefox"&&Mu().major>115&&Mu().major<123&&(M=M.filter((function(E){return E.kind!=="audiooutput"}))),{devices:M.map((function(E){var D=JSON.parse(JSON.stringify(E));if(!ot()&&E.kind==="videoinput"&&E.getCapabilities){var z,K=E.getCapabilities();D.facing=(K==null||(z=K.facingMode)===null||z===void 0?void 0:z.length)>=1?K.facingMode[0]:void 0}return D}))}}return new Promise((function(E){g.sendMessageToCallMachine({action:"enumerate-devices"},(function(D){E({devices:D.devices})}))}))})),function(){return y.apply(this,arguments)})},{key:"sendAppMessage",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"*";if(_t(this._callState,"sendAppMessage()"),JSON.stringify(g).length>this._maxAppMessageSize)throw new Error("Message data too large. Max size is "+this._maxAppMessageSize);return this.sendMessageToCallMachine({action:"app-msg",data:g,to:M}),this}},{key:"addFakeParticipant",value:function(g){return at(),_t(this._callState,"addFakeParticipant()"),this.sendMessageToCallMachine(Be({action:"add-fake-participant"},g)),this}},{key:"setShowNamesMode",value:function(g){return fr(this._callObjectMode,"setShowNamesMode()"),at(),g&&g!=="always"&&g!=="never"?(console.error('setShowNamesMode argument should be "always", "never", or false'),this):(this.sendMessageToCallMachine({action:"set-show-names",mode:g}),this)}},{key:"setShowLocalVideo",value:function(){var g=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return fr(this._callObjectMode,"setShowLocalVideo()"),at(),_t(this._callState,"setShowLocalVideo()"),typeof g!="boolean"?(console.error("setShowLocalVideo only accepts a boolean value"),this):(this.sendMessageToCallMachine({action:"set-show-local-video",show:g}),this._showLocalVideo=g,this)}},{key:"showLocalVideo",value:function(){return fr(this._callObjectMode,"showLocalVideo()"),at(),this._showLocalVideo}},{key:"setShowParticipantsBar",value:function(){var g=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return fr(this._callObjectMode,"setShowParticipantsBar()"),at(),_t(this._callState,"setShowParticipantsBar()"),typeof g!="boolean"?(console.error("setShowParticipantsBar only accepts a boolean value"),this):(this.sendMessageToCallMachine({action:"set-show-participants-bar",show:g}),this._showParticipantsBar=g,this)}},{key:"showParticipantsBar",value:function(){return fr(this._callObjectMode,"showParticipantsBar()"),at(),this._showParticipantsBar}},{key:"customIntegrations",value:function(){return at(),fr(this._callObjectMode,"customIntegrations()"),this._customIntegrations}},{key:"setCustomIntegrations",value:function(g){return at(),fr(this._callObjectMode,"setCustomIntegrations()"),_t(this._callState,"setCustomIntegrations()"),Cy(g)?(this.sendMessageToCallMachine({action:"set-custom-integrations",integrations:g}),this._customIntegrations=g,this):this}},{key:"startCustomIntegrations",value:function(g){var M=this;if(at(),fr(this._callObjectMode,"startCustomIntegrations()"),_t(this._callState,"startCustomIntegrations()"),Array.isArray(g)&&g.some((function(z){return typeof z!="string"}))||!Array.isArray(g)&&typeof g!="string")return console.error("startCustomIntegrations() only accepts string | string[]"),this;var E=typeof g=="string"?[g]:g,D=E.filter((function(z){return!(z in M._customIntegrations)}));return D.length?(console.error(`Can't find custom integration(s): "`.concat(D.join(", "),'"')),this):(this.sendMessageToCallMachine({action:"start-custom-integrations",ids:E}),this)}},{key:"stopCustomIntegrations",value:function(g){var M=this;if(at(),fr(this._callObjectMode,"stopCustomIntegrations()"),_t(this._callState,"stopCustomIntegrations()"),Array.isArray(g)&&g.some((function(z){return typeof z!="string"}))||!Array.isArray(g)&&typeof g!="string")return console.error("stopCustomIntegrations() only accepts string | string[]"),this;var E=typeof g=="string"?[g]:g,D=E.filter((function(z){return!(z in M._customIntegrations)}));return D.length?(console.error(`Can't find custom integration(s): "`.concat(D.join(", "),'"')),this):(this.sendMessageToCallMachine({action:"stop-custom-integrations",ids:E}),this)}},{key:"customTrayButtons",value:function(){return fr(this._callObjectMode,"customTrayButtons()"),at(),this._customTrayButtons}},{key:"updateCustomTrayButtons",value:function(g){return fr(this._callObjectMode,"updateCustomTrayButtons()"),at(),_t(this._callState,"updateCustomTrayButtons()"),ky(g)?(this.sendMessageToCallMachine({action:"update-custom-tray-buttons",btns:g}),this._customTrayButtons=g,this):(console.error("updateCustomTrayButtons only accepts a dictionary of the type ".concat(JSON.stringify(Ru))),this)}},{key:"theme",value:function(){return fr(this._callObjectMode,"theme()"),this.properties.theme}},{key:"setTheme",value:function(g){var M=this;return fr(this._callObjectMode,"setTheme()"),new Promise((function(E,D){try{M.validateProperties({theme:g}),M.properties.theme=Be({},g),M.sendMessageToCallMachine({action:"set-theme",theme:M.properties.theme});try{M.emitDailyJSEvent({action:mS,theme:M.properties.theme})}catch(z){console.log("could not emit 'theme-updated'",z)}E(M.properties.theme)}catch(z){D(z)}}))}},{key:"requestFullscreen",value:(h=Ge((function*(){if(at(),this._iframe&&!document.fullscreenElement&&Pv())try{(yield this._iframe.requestFullscreen)?this._iframe.requestFullscreen():this._iframe.webkitRequestFullscreen()}catch(g){console.log("could not make video call fullscreen",g)}})),function(){return h.apply(this,arguments)})},{key:"exitFullscreen",value:function(){at(),document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement&&document.webkitExitFullscreen()}},{key:"getSidebarView",value:(f=Ge((function*(){var g=this;return this._callObjectMode?(console.error("getSidebarView is not available in callObject mode"),Promise.resolve(null)):new Promise((function(M){g.sendMessageToCallMachine({action:"get-sidebar-view"},(function(E){M(E.view)}))}))})),function(){return f.apply(this,arguments)})},{key:"setSidebarView",value:function(g){return this._callObjectMode?(console.error("setSidebarView is not available in callObject mode"),this):(this.sendMessageToCallMachine({action:"set-sidebar-view",view:g}),this)}},{key:"room",value:(l=Ge((function*(){var g=this,M=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).includeRoomConfigDefaults,E=M===void 0||M;return this._accessState.access===ih||this.needsLoad()?this.properties.url?{roomUrlPendingJoin:this.properties.url}:null:new Promise((function(D){g.sendMessageToCallMachine({action:"lib-room-info",includeRoomConfigDefaults:E},(function(z){delete z.action,delete z.callbackStamp,D(z)}))}))})),function(){return l.apply(this,arguments)})},{key:"geo",value:(a=Ge((function*(){try{var g=yield fetch("https://gs.daily.co/_ks_/x-swsl/:");return{current:(yield g.json()).geo}}catch(M){return console.error("geo lookup failed",M),{current:""}}})),function(){return a.apply(this,arguments)})},{key:"setNetworkTopology",value:(r=Ge((function*(g){var M=this;return at(),_t(this._callState,"setNetworkTopology()"),new Promise((function(E,D){M.sendMessageToCallMachine({action:"set-network-topology",opts:g},(function(z){z.error?D({error:z.error}):E({workerId:z.workerId})}))}))})),function(g){return r.apply(this,arguments)})},{key:"getNetworkTopology",value:(e=Ge((function*(){var g=this;return new Promise((function(M,E){g.needsLoad()&&M({topology:"none"}),g.sendMessageToCallMachine({action:"get-network-topology"},(function(D){D.error?E({error:D.error}):M({topology:D.topology})}))}))})),function(){return e.apply(this,arguments)})},{key:"setPlayNewParticipantSound",value:function(g){if(at(),typeof g!="number"&&g!==!0&&g!==!1)throw new Error("argument to setShouldPlayNewParticipantSound should be true, false, or a number, but is ".concat(g));this.sendMessageToCallMachine({action:"daily-method-set-play-ding",arg:g})}},{key:"on",value:function(g,M){return eu.prototype.on.call(this,g,M)}},{key:"once",value:function(g,M){return eu.prototype.once.call(this,g,M)}},{key:"off",value:function(g,M){return eu.prototype.off.call(this,g,M)}},{key:"validateProperties",value:function(g){var M,E;if(g!=null&&(M=g.dailyConfig)!==null&&M!==void 0&&M.userMediaAudioConstraints){var D,z;ot()||console.warn("userMediaAudioConstraints is deprecated. You can override constraints with inputSettings.audio.settings, found in DailyCallOptions.");var K=g.inputSettings||{};K.audio=((D=g.inputSettings)===null||D===void 0?void 0:D.audio)||{},K.audio.settings=((z=g.inputSettings)===null||z===void 0||(z=z.audio)===null||z===void 0?void 0:z.settings)||{},K.audio.settings=Be(Be({},K.audio.settings),g.dailyConfig.userMediaAudioConstraints),g.inputSettings=K,delete g.dailyConfig.userMediaAudioConstraints}if(g!=null&&(E=g.dailyConfig)!==null&&E!==void 0&&E.userMediaVideoConstraints){var se,pe;ot()||console.warn("userMediaVideoConstraints is deprecated. You can override constraints with inputSettings.video.settings, found in DailyCallOptions.");var Re=g.inputSettings||{};Re.video=((se=g.inputSettings)===null||se===void 0?void 0:se.video)||{},Re.video.settings=((pe=g.inputSettings)===null||pe===void 0||(pe=pe.video)===null||pe===void 0?void 0:pe.settings)||{},Re.video.settings=Be(Be({},Re.video.settings),g.dailyConfig.userMediaVideoConstraints),g.inputSettings=Re,delete g.dailyConfig.userMediaVideoConstraints}for(var $e in g)if(Mo[$e]){if(Mo[$e].validate&&!Mo[$e].validate(g[$e],this))throw new Error("property '".concat($e,"': ").concat(Mo[$e].help))}else console.warn("Ignoring unrecognized property '".concat($e,"'")),delete g[$e]}},{key:"assembleMeetingUrl",value:function(){var g,M,E=Be(Be({},this.properties),{},{emb:this.callClientId,embHref:encodeURIComponent(window.location.href),proxy:(g=this.properties.dailyConfig)!==null&&g!==void 0&&g.proxyUrl?encodeURIComponent((M=this.properties.dailyConfig)===null||M===void 0?void 0:M.proxyUrl):void 0}),D=E.url.match(/\?/)?"&":"?";return E.url+D+Object.keys(Mo).filter((function(z){return Mo[z].queryString&&E[z]!==void 0})).map((function(z){return"".concat(Mo[z].queryString,"=").concat(E[z])})).join("&")}},{key:"needsLoad",value:function(){return[gv,mv,ko,ms].includes(this._callState)}},{key:"sendMessageToCallMachine",value:function(g,M){if(this._destroyed&&(this._logUseAfterDestroy(),this.strictMode))throw new Error("Use after destroy");this._messageChannel.sendMessageToCallMachine(g,M,this.callClientId,this._iframe)}},{key:"forwardPackagedMessageToCallMachine",value:function(g){this._messageChannel.forwardPackagedMessageToCallMachine(g,this._iframe,this.callClientId)}},{key:"addListenerForPackagedMessagesFromCallMachine",value:function(g){return this._messageChannel.addListenerForPackagedMessagesFromCallMachine(g,this.callClientId)}},{key:"removeListenerForPackagedMessagesFromCallMachine",value:function(g){this._messageChannel.removeListenerForPackagedMessagesFromCallMachine(g)}},{key:"handleMessageFromCallMachine",value:function(g){switch(g.action){case pS:this.sendMessageToCallMachine(Be({action:gS},this.properties));break;case"call-machine-initialized":this._callMachineInitialized=!0;var M={action:Cu,level:"log",code:1011,stats:{event:"bundle load",time:this._bundleLoadTime==="no-op"?0:this._bundleLoadTime,preLoaded:this._bundleLoadTime==="no-op",url:nu(this.properties.dailyConfig)}};this.sendMessageToCallMachine(M),this._delayDuplicateInstanceLog&&this._logDuplicateInstanceAttempt();break;case _v:this._loadedCallback&&(this._loadedCallback(),this._loadedCallback=null),this.emitDailyJSEvent(g);break;case SS:var E,D=Be({},g);delete D.internal,this._maxAppMessageSize=((E=g.internal)===null||E===void 0?void 0:E._maxAppMessageSize)||sh,this._joinedCallback&&(this._joinedCallback(g.participants),this._joinedCallback=null),this.emitDailyJSEvent(D);break;case CS:case ES:if(this._callState===ko)return;if(g.participant&&g.participant.session_id){var z=g.participant.local?"local":g.participant.session_id;if(this._callObjectMode){var K=this._callMachine().store;Jv(g.participant,K),Qv(g.participant,K),Kv(g.participant,this._participants[z],K)}try{this.maybeParticipantTracksStopped(this._participants[z],g.participant),this.maybeParticipantTracksStarted(this._participants[z],g.participant),this.maybeEventRecordingStopped(this._participants[z],g.participant),this.maybeEventRecordingStarted(this._participants[z],g.participant)}catch(Hi){console.error("track events error",Hi)}this.compareEqualForParticipantUpdateEvent(g.participant,this._participants[z])||(this._participants[z]=Be({},g.participant),this.toggleParticipantAudioBasedOnNativeAudioFocus(),this.emitDailyJSEvent(g))}break;case MS:if(g.participant&&g.participant.session_id){var se=this._participants[g.participant.session_id];se&&this.maybeParticipantTracksStopped(se,null),delete this._participants[g.participant.session_id],this.emitDailyJSEvent(g)}break;case TS:In(this._participantCounts,g.participantCounts)||(this._participantCounts=g.participantCounts,this.emitDailyJSEvent(g));break;case OS:var pe={access:g.access};g.awaitingAccess&&(pe.awaitingAccess=g.awaitingAccess),In(this._accessState,pe)||(this._accessState=pe,this.emitDailyJSEvent(g));break;case RS:if(g.meetingSession){this._meetingSessionSummary=g.meetingSession,this.emitDailyJSEvent(g);var Re=Be(Be({},g),{},{action:"meeting-session-updated"});this.emitDailyJSEvent(Re)}break;case Cv:var $e;this._iframe&&!g.preserveIframe&&(this._iframe.src=""),this._updateCallState(ms),this.resetMeetingDependentVars(),this._loadedCallback&&(this._loadedCallback(g.errorMsg),this._loadedCallback=null),g.preserveIframe;var Xe=Hg(g,Nk);Xe!=null&&($e=Xe.error)!==null&&$e!==void 0&&$e.details&&(Xe.error.details=JSON.parse(Xe.error.details)),this._maybeSendToSentry(g),this._joinedCallback&&(this._joinedCallback(null,Xe),this._joinedCallback=null),this.emitDailyJSEvent(Xe);break;case kS:this._callState!==ms&&this._updateCallState(ko),this.resetMeetingDependentVars(),this._resolveLeave&&(this._resolveLeave(),this._resolveLeave=null),this.emitDailyJSEvent(g);break;case"selected-devices-updated":g.devices&&this.emitDailyJSEvent(g);break;case ZS:var zt=g.state,Sn=g.threshold,jn=g.quality,mt=zt.state,At=zt.reasons;mt===this._network.networkState&&In(At,this._network.networkStateReasons)&&Sn===this._network.threshold&&jn===this._network.quality||(this._network.networkState=mt,this._network.networkStateReasons=At,this._network.quality=jn,this._network.threshold=Sn,g.networkState=mt,At.length&&(g.networkStateReasons=At),delete g.state,this.emitDailyJSEvent(g));break;case tk:g&&g.cpuLoadState&&this.emitDailyJSEvent(g);break;case nk:g&&g.faceCounts!==void 0&&this.emitDailyJSEvent(g);break;case YS:var en=g.activeSpeaker;this._activeSpeaker.peerId!==en.peerId&&(this._activeSpeaker.peerId=en.peerId,this.emitDailyJSEvent({action:g.action,activeSpeaker:this._activeSpeaker}));break;case"show-local-video-changed":if(this._callObjectMode)return;var Vt=g.show;this._showLocalVideo=Vt,this.emitDailyJSEvent({action:g.action,show:Vt});break;case XS:var Ze=g.enabled;this._activeSpeakerMode!==Ze&&(this._activeSpeakerMode=Ze,this.emitDailyJSEvent({action:g.action,enabled:this._activeSpeakerMode}));break;case PS:case IS:case xS:this._waitingParticipants=g.allWaitingParticipants,this.emitDailyJSEvent({action:g.action,participant:g.participant});break;case ck:In(this._receiveSettings,g.receiveSettings)||(this._receiveSettings=g.receiveSettings,this.emitDailyJSEvent({action:g.action,receiveSettings:g.receiveSettings}));break;case Sv:this._maybeUpdateInputSettings(g.inputSettings);break;case"send-settings-updated":In(this._sendSettings,g.sendSettings)||(this._sendSettings=g.sendSettings,this._preloadCache.sendSettings=null,this.emitDailyJSEvent({action:g.action,sendSettings:g.sendSettings}));break;case"local-audio-level":this._localAudioLevel=g.audioLevel,this._preloadCache.localAudioLevelObserver=null,this.emitDailyJSEvent(g);break;case"remote-participants-audio-level":this._remoteParticipantsAudioLevel=g.participantsAudioLevel,this._preloadCache.remoteParticipantsAudioLevelObserver=null,this.emitDailyJSEvent(g);break;case WS:var Nn=g.session_id;this._rmpPlayerState[Nn]=g.playerState,this.emitDailyJSEvent(g);break;case GS:delete this._rmpPlayerState[g.session_id],this.emitDailyJSEvent(g);break;case HS:var Kn=g.session_id,Jt=this._rmpPlayerState[Kn];Jt&&this.compareEqualForRMPUpdateEvent(Jt,g.remoteMediaPlayerState)||(this._rmpPlayerState[Kn]=g.remoteMediaPlayerState,this.emitDailyJSEvent(g));break;case"custom-button-click":case"sidebar-view-changed":case"pip-started":case"pip-stopped":this.emitDailyJSEvent(g);break;case AS:var Tr=this._meetingSessionState.topology!==(g.meetingSessionState&&g.meetingSessionState.topology);this._meetingSessionState=Ch(g.meetingSessionState,this._callObjectMode),(this._callObjectMode||Tr)&&this.emitDailyJSEvent(g);break;case JS:this._isScreenSharing=!0,this.emitDailyJSEvent(g);break;case QS:case KS:this._isScreenSharing=!1,this.emitDailyJSEvent(g);break;case wv:case bv:case BS:case FS:case zS:case NS:case DS:case US:case _S:case wS:case $S:case qS:case"test-completed":case ek:case VS:case rk:case ik:case sk:case ok:case kv:case ak:case"dialin-ready":case"dialin-connected":case"dialin-error":case"dialin-stopped":case"dialin-warning":case"dialout-connected":case"dialout-answered":case"dialout-error":case"dialout-stopped":case"dialout-warning":this.emitDailyJSEvent(g);break;case"request-fullscreen":this.requestFullscreen();break;case"request-exit-fullscreen":this.exitFullscreen()}}},{key:"maybeEventRecordingStopped",value:function(g,M){var E="record";g&&(M.local||M[E]!==!1||g[E]===M[E]||this.emitDailyJSEvent({action:bv}))}},{key:"maybeEventRecordingStarted",value:function(g,M){var E="record";g&&(M.local||M[E]!==!0||g[E]===M[E]||this.emitDailyJSEvent({action:wv}))}},{key:"_trackStatePlayable",value:function(g){return!(!g||g.state!==lS)}},{key:"_trackChanged",value:function(g,M){return g?.id!==M?.id}},{key:"maybeEventTrackStopped",value:function(g,M,E){var D,z,K=(D=M?.tracks[g])!==null&&D!==void 0?D:null,se=(z=E?.tracks[g])!==null&&z!==void 0?z:null,pe=K?.track;if(pe){var Re=this._trackStatePlayable(K),$e=this._trackStatePlayable(se),Xe=this._trackChanged(pe,se?.track);Re&&($e&&!Xe||this.emitDailyJSEvent({action:jS,track:pe,participant:E??M,type:g}))}}},{key:"maybeEventTrackStarted",value:function(g,M,E){var D,z,K=(D=M?.tracks[g])!==null&&D!==void 0?D:null,se=(z=E?.tracks[g])!==null&&z!==void 0?z:null,pe=se?.track;if(pe){var Re=this._trackStatePlayable(K),$e=this._trackStatePlayable(se),Xe=this._trackChanged(K?.track,pe);$e&&(Re&&!Xe||this.emitDailyJSEvent({action:LS,track:pe,participant:E,type:g}))}}},{key:"maybeParticipantTracksStopped",value:function(g,M){if(g)for(var E in g.tracks)this.maybeEventTrackStopped(E,g,M)}},{key:"maybeParticipantTracksStarted",value:function(g,M){if(M)for(var E in M.tracks)this.maybeEventTrackStarted(E,g,M)}},{key:"compareEqualForRMPUpdateEvent",value:function(g,M){var E,D;return g.state===M.state&&((E=g.settings)===null||E===void 0?void 0:E.volume)===((D=M.settings)===null||D===void 0?void 0:D.volume)}},{key:"emitDailyJSEvent",value:function(g){try{g.callClientId=this.callClientId,this.emit(g.action,g)}catch(M){console.log("could not emit",g,M)}}},{key:"compareEqualForParticipantUpdateEvent",value:function(g,M){return!!In(g,M)&&(!g.videoTrack||!M.videoTrack||g.videoTrack.id===M.videoTrack.id&&g.videoTrack.muted===M.videoTrack.muted&&g.videoTrack.enabled===M.videoTrack.enabled)&&(!g.audioTrack||!M.audioTrack||g.audioTrack.id===M.audioTrack.id&&g.audioTrack.muted===M.audioTrack.muted&&g.audioTrack.enabled===M.audioTrack.enabled)}},{key:"nativeUtils",value:function(){return ot()?typeof DailyNativeUtils>"u"?(console.warn("in React Native, DailyNativeUtils is expected to be available"),null):DailyNativeUtils:null}},{key:"updateIsPreparingToJoin",value:function(g){this._updateCallState(this._callState,g)}},{key:"_updateCallState",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._isPreparingToJoin;if(g!==this._callState||M!==this._isPreparingToJoin){var E=this._callState,D=this._isPreparingToJoin;this._callState=g,this._isPreparingToJoin=M;var z=this._callState===So;this.updateShowAndroidOngoingMeetingNotification(z);var K=Iu(E,D),se=Iu(this._callState,this._isPreparingToJoin);K!==se&&(this.updateKeepDeviceAwake(se),this.updateDeviceAudioMode(se),this.updateNoOpRecordingEnsuringBackgroundContinuity(se))}}},{key:"resetMeetingDependentVars",value:function(){this._participants={},this._participantCounts=dy,this._waitingParticipants={},this._activeSpeaker={},this._activeSpeakerMode=!1,this._didPreAuth=!1,this._accessState={access:ih},this._finalSummaryOfPrevSession=this._meetingSessionSummary,this._meetingSessionSummary={},this._meetingSessionState=Ch(uy,this._callObjectMode),this._isScreenSharing=!1,this._receiveSettings={},this._inputSettings=void 0,this._sendSettings={},this._localAudioLevel=0,this._isLocalAudioLevelObserverRunning=!1,this._remoteParticipantsAudioLevel={},this._isRemoteParticipantsAudioLevelObserverRunning=!1,this._maxAppMessageSize=sh,this._callMachineInitialized=!1,this._bundleLoadTime=void 0,this._preloadCache}},{key:"updateKeepDeviceAwake",value:function(g){ot()&&this.nativeUtils().setKeepDeviceAwake(g,this.callClientId)}},{key:"updateDeviceAudioMode",value:function(g){if(ot()&&!this.disableReactNativeAutoDeviceManagement("audio")){var M=g?this._nativeInCallAudioMode:"idle";this.nativeUtils().setAudioMode(M)}}},{key:"updateShowAndroidOngoingMeetingNotification",value:function(g){if(ot()&&this.nativeUtils().setShowOngoingMeetingNotification){var M,E,D,z;if(this.properties.reactNativeConfig&&this.properties.reactNativeConfig.androidInCallNotification){var K=this.properties.reactNativeConfig.androidInCallNotification;M=K.title,E=K.subtitle,D=K.iconName,z=K.disableForCustomOverride}z&&(g=!1),this.nativeUtils().setShowOngoingMeetingNotification(g,M,E,D,this.callClientId)}}},{key:"updateNoOpRecordingEnsuringBackgroundContinuity",value:function(g){ot()&&this.nativeUtils().enableNoOpRecordingEnsuringBackgroundContinuity&&this.nativeUtils().enableNoOpRecordingEnsuringBackgroundContinuity(g)}},{key:"toggleParticipantAudioBasedOnNativeAudioFocus",value:function(){var g;if(ot()){var M=(g=this._callMachine())===null||g===void 0||(g=g.store)===null||g===void 0?void 0:g.getState();for(var E in M?.streams){var D=M.streams[E];D&&D.pendingTrack&&D.pendingTrack.kind==="audio"&&(D.pendingTrack.enabled=this._hasNativeAudioFocus)}}}},{key:"disableReactNativeAutoDeviceManagement",value:function(g){return this.properties.reactNativeConfig&&this.properties.reactNativeConfig.disableAutoDeviceManagement&&this.properties.reactNativeConfig.disableAutoDeviceManagement[g]}},{key:"absoluteUrl",value:function(g){if(g!==void 0){var M=document.createElement("a");return M.href=g,M.href}}},{key:"sayHello",value:function(){var g="hello, world.";return console.log(g),g}},{key:"_logUseAfterDestroy",value:function(){var g=Object.values(Eo)[0];if(this.needsLoad())if(g&&!g.needsLoad()){var M={action:Cu,level:"error",code:this.strictMode?9995:9997};g.sendMessageToCallMachine(M)}else this.strictMode||console.error("You are are attempting to use a call instance that was previously destroyed, which is unsupported. Please remove `strictMode: false` from your constructor properties to enable strict mode to track down and fix this unsupported usage.");else{var E={action:Cu,level:"error",code:this.strictMode?9995:9997};this._messageChannel.sendMessageToCallMachine(E,null,this.callClientId,this._iframe)}}},{key:"_logDuplicateInstanceAttempt",value:function(){for(var g=0,M=Object.values(Eo);g<M.length;g++){var E=M[g];E._callMachineInitialized?(E.sendMessageToCallMachine({action:Cu,level:"warn",code:this.allowMultipleCallInstances?9993:9992}),E._delayDuplicateInstanceLog=!1):E._delayDuplicateInstanceLog=!0}}},{key:"_maybeSendToSentry",value:function(g){var M,E,D,z;if(!((M=g.error)!==null&&M!==void 0&&M.type&&(![hS,fS,yv].includes(g.error.type)||g.error.type===yv&&g.error.msg.includes("deleted")))){var K=(E=this.properties)!==null&&E!==void 0&&E.url?new URL(this.properties.url):void 0,se="production";K&&K.host.includes(".staging.daily")&&(se="staging");var pe,Re,$e,Xe,zt,Sn=(function(Nn){const Kn=[Rb(),Tb(),tS(),Zb(),oS(),cS(),xb(),aS()];return Nn.autoSessionTracking!==!1&&Kn.push(sS()),Kn})({}).filter((function(Nn){return!["BrowserApiErrors","Breadcrumbs","GlobalHandlers"].includes(Nn.name)})),jn=new zb({dsn:"https://f10f1c81e5d44a4098416c0867a8b740@o77906.ingest.sentry.io/168844",transport:Hb,stackParser:Xb,integrations:Sn,environment:se}),mt=new gs;if(mt.setClient(jn),jn.init(),this.session_id&&mt.setExtra("sessionId",this.session_id),this.properties){var At=Be({},this.properties);At.userName=At.userName?"[Filtered]":void 0,At.userData=At.userData?"[Filtered]":void 0,At.token=At.token?"[Filtered]":void 0,mt.setExtra("properties",At)}if(K){var en=K.searchParams.get("domain");if(!en){var Vt=K.host.match(/(.*?)\./);en=Vt&&Vt[1]||""}en&&mt.setTag("domain",en)}g.error&&(mt.setTag("fatalErrorType",g.error.type),mt.setExtra("errorDetails",g.error.details),!((pe=g.error.details)===null||pe===void 0)&&pe.uri&&mt.setTag("serverAddress",g.error.details.uri),!((Re=g.error.details)===null||Re===void 0)&&Re.workerGroup&&mt.setTag("workerGroup",g.error.details.workerGroup),!(($e=g.error.details)===null||$e===void 0)&&$e.geoGroup&&mt.setTag("geoGroup",g.error.details.geoGroup),!((Xe=g.error.details)===null||Xe===void 0)&&Xe.on&&mt.setTag("connectionAttempt",g.error.details.on),(zt=g.error.details)!==null&&zt!==void 0&&zt.bundleUrl&&(mt.setTag("bundleUrl",g.error.details.bundleUrl),mt.setTag("bundleError",g.error.details.sourceError.type))),mt.setTags({callMode:this._callObjectMode?ot()?"reactNative":(D=this.properties)!==null&&D!==void 0&&(D=D.dailyConfig)!==null&&D!==void 0&&(D=D.callMode)!==null&&D!==void 0&&D.includes("prebuilt")?this.properties.dailyConfig.callMode:"custom":"prebuilt-frame",version:n.version()});var Ze=((z=g.error)===null||z===void 0?void 0:z.msg)||g.errorMsg;mt.captureException(new Error(Ze))}}},{key:"_callMachine",value:function(){var g;return(g=window._daily)===null||g===void 0||(g=g.instances)===null||g===void 0||(g=g[this.callClientId])===null||g===void 0?void 0:g.callMachine}},{key:"_maybeUpdateInputSettings",value:function(g){if(!In(this._inputSettings,g)){var M=this._getInputSettings();this._inputSettings=g;var E=this._getInputSettings();In(M,E)||this.emitDailyJSEvent({action:Sv,inputSettings:E})}}}],[{key:"supportedBrowser",value:function(){if(ot())return{supported:!0,mobile:!0,name:"React Native",version:null,supportsScreenShare:!0,supportsSfu:!0,supportsVideoProcessing:!1,supportsAudioProcessing:!1};var g=Qw.getParser(Cr());return{supported:!!uh(),mobile:g.getPlatformType()==="mobile",name:g.getBrowserName(),version:g.getBrowserVersion(),supportsFullscreen:!!Pv(),supportsScreenShare:!!dk(),supportsSfu:!!uh(),supportsVideoProcessing:Iv(),supportsAudioProcessing:xv()}}},{key:"version",value:function(){return"0.84.0"}},{key:"createCallObject",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g.layout="none",new n(null,g)}},{key:"wrap",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(at(),!g||!g.contentWindow||typeof g.src!="string")throw new Error("DailyIframe::Wrap needs an iframe-like first argument");return M.layout||(M.customLayout?M.layout="custom-v1":M.layout="browser"),new n(g,M)}},{key:"createFrame",value:function(g,M){var E,D;at(),g&&M?(E=g,D=M):g&&g.append?(E=g,D={}):(E=document.body,D=g||{});var z=D.iframeStyle;z||(z=E===document.body?{position:"fixed",border:"1px solid black",backgroundColor:"white",width:"375px",height:"450px",right:"1em",bottom:"1em"}:{border:0,width:"100%",height:"100%"});var K=document.createElement("iframe");window.navigator&&window.navigator.userAgent.match(/Chrome\/61\./)?K.allow="microphone, camera":K.allow="microphone; camera; autoplay; display-capture; screen-wake-lock",K.style.visibility="hidden",E.appendChild(K),K.style.visibility=null,Object.keys(z).forEach((function(se){return K.style[se]=z[se]})),D.layout||(D.customLayout?D.layout="custom-v1":D.layout="browser");try{return new n(K,D)}catch(se){throw E.removeChild(K),se}}},{key:"createTransparentFrame",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};at();var M=document.createElement("iframe");return M.allow="microphone; camera; autoplay",M.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
      pointer-events: none;
    `,document.body.appendChild(M),g.layout||(g.layout="custom-v1"),n.wrap(M,g)}},{key:"getCallInstance",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return g?Eo[g]:Object.values(Eo)[0]}}]);var e,r,a,l,f,h,y,v,b,C,T,L,A,P,R,N,V,G,X,x,$,q,re,me,ae,we,S,Te,ke,J,De,et,ve,ge,Oe,oe,Q,ue})();function gy(n){if(n.extension){if(typeof n.extension!="string")throw new Error("Error starting dial out: extension must be a string");if(n.extension.length>20)throw new Error("Error starting dial out: extension length must be less than or equal to 20")}if(n.waitBeforeExtensionDialSec){if(typeof n.waitBeforeExtensionDialSec!="number")throw new Error("Error starting dial out: waitBeforeExtensionDialSec must be a number");if(n.waitBeforeExtensionDialSec>60)throw new Error("Error starting dial out: waitBeforeExtensionDialSec must be less than or equal to 60");if(!n.extension)throw new Error("Error starting dial out: waitBeforeExtensionDialSec requires a phoneNumber and extension")}}function ka(n,e){var r={};for(var a in n)if(n[a]instanceof MediaStreamTrack)console.warn("MediaStreamTrack found in props or cache.",a),r[a]=Wi;else if(a==="dailyConfig"){if(n[a].modifyLocalSdpHook){var l=window._daily.instances[e].customCallbacks||{};l.modifyLocalSdpHook=n[a].modifyLocalSdpHook,window._daily.instances[e].customCallbacks=l,delete n[a].modifyLocalSdpHook}if(n[a].modifyRemoteSdpHook){var f=window._daily.instances[e].customCallbacks||{};f.modifyRemoteSdpHook=n[a].modifyRemoteSdpHook,window._daily.instances[e].customCallbacks=f,delete n[a].modifyRemoteSdpHook}r[a]=n[a]}else r[a]=n[a];return r}function _t(n){var e=arguments.length>2?arguments[2]:void 0;if(n!==So){var r="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," only supported after join.");throw e&&(r+=" ".concat(e)),console.error(r),new Error(r)}}function Iu(n,e){return[rh,So].includes(n)||e}function bh(n,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"This daily-js method",a=arguments.length>3?arguments[3]:void 0;if(Iu(n,e)){var l="".concat(r," not supported after joining a meeting.");throw a&&(l+=" ".concat(a)),console.error(l),new Error(l)}}function xu(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method",r=arguments.length>2?arguments[2]:void 0;if(!n){var a="".concat(e,arguments.length>3&&arguments[3]!==void 0&&arguments[3]?" requires preAuth() or startCamera() to initialize call state.":" requires preAuth(), startCamera(), or join() to initialize call state.");throw r&&(a+=" ".concat(r)),console.error(a),new Error(a)}}function Sh(n){if(n){var e="A pre-call quality test is in progress. Please try ".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," again once testing has completed. Use stopTestCallQuality() to end it early.");throw console.error(e),new Error(e)}}function $r(n){if(!n){var e="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," is only supported on custom callObject instances");throw console.error(e),new Error(e)}}function fr(n){if(n){var e="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," is only supported as part of Daily's Prebuilt");throw console.error(e),new Error(e)}}function at(){if(ot())throw new Error("This daily-js method is not currently supported in React Native")}function Pc(){if(!ot())throw new Error("This daily-js method is only supported in React Native")}function my(n){if(n===void 0)return!0;var e;if(typeof n=="string")e=n;else try{e=JSON.stringify(n),In(JSON.parse(e),n)||console.warn("The userData provided will be modified when serialized.")}catch(r){throw Error("userData must be serializable to JSON: ".concat(r))}if(e.length>4096)throw Error("userData is too large (".concat(e.length," characters). Maximum size suppported is ").concat(4096,"."));return!0}function vy(n,e){for(var r=e.allowAllParticipantsKey,a=function(T){var L=["local"];return r||L.push("*"),T&&!L.includes(T)},l=function(T){return!!(T.layer===void 0||Number.isInteger(T.layer)&&T.layer>=0||T.layer==="inherit")},f=function(T){return!!T&&!(T.video&&!l(T.video))&&!(T.screenVideo&&!l(T.screenVideo))},h=0,y=Object.entries(n);h<y.length;h++){var v=vn(y[h],2),b=v[0],C=v[1];if(!a(b)||!f(C))return!1}return!0}function yy(n){if(ut(n)!=="object")return!1;for(var e=0,r=Object.entries(n);e<r.length;e++){var a=vn(r[e],2),l=a[0],f=a[1];switch(l){case"video":if(ut(f)!=="object")return!1;for(var h=0,y=Object.entries(f);h<y.length;h++){var v=vn(y[h],2),b=v[0],C=v[1];switch(b){case"processor":if(!Bk(C))return!1;break;case"settings":if(!wy(C))return!1;break;default:return!1}}break;case"audio":if(ut(f)!=="object")return!1;for(var T=0,L=Object.entries(f);T<L.length;T++){var A=vn(L[T],2),P=A[0],R=A[1];switch(P){case"processor":if(!Uk(R))return!1;break;case"settings":if(!wy(R))return!1;break;default:return!1}}break;default:return!1}}return!0}function _y(n,e,r){var a,l=[];n.video&&n.video.processor&&(Iv((a=e?.useLegacyVideoProcessor)!==null&&a!==void 0&&a)||(n.video.settings?delete n.video.processor:delete n.video,l.push("video"))),n.audio&&n.audio.processor&&(xv()||(n.audio.settings?delete n.audio.processor:delete n.audio,l.push("audio"))),l.length>0&&console.error("Ignoring settings for browser- or platform-unsupported input processor(s): ".concat(l.join(", "))),n.audio&&n.audio.settings&&(n.audio.settings.customTrack?(r.audioTrack=n.audio.settings.customTrack,n.audio.settings={customTrack:Wi}):delete r.audioTrack),n.video&&n.video.settings&&(n.video.settings.customTrack?(r.videoTrack=n.video.settings.customTrack,n.video.settings={customTrack:Wi}):delete r.videoTrack)}function Uk(n){if(ot())return console.warn("Video processing is not yet supported in React Native"),!1;var e=["type"];return!!n&&ut(n)==="object"&&(Object.keys(n).filter((function(r){return!e.includes(r)})).forEach((function(r){console.warn("invalid key inputSettings -> audio -> processor : ".concat(r)),delete n[r]})),!!(function(r){return typeof r!="string"?!1:Object.values(Ov).includes(r)?!0:(console.error("inputSettings audio processor type invalid"),!1)})(n.type))}function Bk(n){if(ot())return console.warn("Video processing is not yet supported in React Native"),!1;var e=["type","config"];return!n||ut(n)!=="object"||!(function(r){return typeof r!="string"?!1:Object.values(Eu).includes(r)?!0:(console.error("inputSettings video processor type invalid"),!1)})(n.type)||n.config&&(ut(n.config)!=="object"||!(function(r,a){var l=Object.keys(a);if(l.length===0)return!0;var f="invalid object in inputSettings -> video -> processor -> config";switch(r){case Eu.BGBLUR:return l.length>1||l[0]!=="strength"?(console.error(f),!1):!(typeof a.strength!="number"||a.strength<=0||a.strength>1||isNaN(a.strength))||(console.error("".concat(f,"; expected: {0 < strength <= 1}, got: ").concat(a.strength)),!1);case Eu.BGIMAGE:return!(a.source!==void 0&&!(function(h){if(h.source==="default")return h.type="default",!0;if(h.source instanceof ArrayBuffer)return!0;if(ru(h.source))return h.type="url",!!(function(b){var C=new URL(b),T=C.pathname;if(C.protocol==="data:")try{var L=T.substring(T.indexOf(":")+1,T.indexOf(";")).split("/")[1];return ch.includes(L)}catch(P){return console.error("failed to deduce blob content type",P),!1}var A=T.split(".").at(-1).toLowerCase().trim();return ch.includes(A)})(h.source)||(console.error("invalid image type; supported types: [".concat(ch.join(", "),"]")),!1);return y=h.source,v=Number(y),isNaN(v)||!Number.isInteger(v)||v<=0||v>10?(console.error("invalid image selection; must be an int, > 0, <= ".concat(10)),!1):(h.type="daily-preselect",!0);var y,v})(a));default:return!0}})(n.type,n.config))?!1:(Object.keys(n).filter((function(r){return!e.includes(r)})).forEach((function(r){console.warn("invalid key inputSettings -> video -> processor : ".concat(r)),delete n[r]})),!0)}function wy(n){return ut(n)==="object"&&(!n.customTrack||n.customTrack instanceof MediaStreamTrack)}function kh(){var n=Object.values(Eu).join(" | "),e=Object.values(Ov).join(" | ");return"inputSettings must be of the form: { video?: { processor?: { type: [ ".concat(n," ], config?: {} } }, audio?: { processor: {type: [ ").concat(e," ] } } }")}function by(n){var e=n.allowAllParticipantsKey;return"receiveSettings must be of the form { [<remote participant id> | ".concat(dS).concat(e?' | "'.concat("*",'"'):"","]: ")+'{ [video: [{ layer: [<non-negative integer> | "inherit"] } | "inherit"]], [screenVideo: [{ layer: [<non-negative integer> | "inherit"] } | "inherit"]] }}}'}function Sy(){return"customIntegrations should be an object of type ".concat(JSON.stringify(wh),".")}function ky(n){if(n&&ut(n)!=="object"||Array.isArray(n))return console.error("customTrayButtons should be an Object of the type ".concat(JSON.stringify(Ru),".")),!1;if(n)for(var e=0,r=Object.entries(n);e<r.length;e++)for(var a=vn(r[e],1)[0],l=0,f=Object.entries(n[a]);l<f.length;l++){var h=vn(f[l],2),y=h[0],v=h[1],b=Ru.id[y];if(!b)return console.error("customTrayButton does not support key ".concat(y)),!1;switch(y){case"iconPath":case"iconPathDarkMode":if(!ru(v))return console.error("customTrayButton ".concat(y," should be a url.")),!1;break;case"visualState":if(!["default","sidebar-open","active"].includes(v))return console.error("customTrayButton ".concat(y," should be ").concat(b,". Got: ").concat(v)),!1;break;default:if(ut(v)!==b)return console.error("customTrayButton ".concat(y," should be a ").concat(b,".")),!1}}return!0}function Cy(n){if(!n||n&&ut(n)!=="object"||Array.isArray(n))return console.error(Sy()),!1;for(var e=function(T){return"".concat(T," should be ").concat(wh.id[T])},r=function(T,L){return console.error("customIntegration ".concat(T,": ").concat(L))},a=0,l=Object.entries(n);a<l.length;a++){var f=vn(l[a],1)[0];if(!("label"in n[f]))return r(f,"label is required"),!1;if(!("location"in n[f]))return r(f,"location is required"),!1;if(!("src"in n[f])&&!("srcdoc"in n[f]))return r(f,"src or srcdoc is required"),!1;for(var h=0,y=Object.entries(n[f]);h<y.length;h++){var v=vn(y[h],2),b=v[0],C=v[1];switch(b){case"allow":case"csp":case"name":case"referrerPolicy":case"sandbox":if(typeof C!="string")return r(f,e(b)),!1;break;case"iconURL":if(!ru(C))return r(f,"".concat(b," should be a url")),!1;break;case"src":if("srcdoc"in n[f])return r(f,"cannot have both src and srcdoc"),!1;if(!ru(C))return r(f,'src "'.concat(C,'" is not a valid URL')),!1;break;case"srcdoc":if("src"in n[f])return r(f,"cannot have both src and srcdoc"),!1;if(typeof C!="string")return r(f,e(b)),!1;break;case"location":if(!["main","sidebar"].includes(C))return r(f,e(b)),!1;break;case"controlledBy":if(C!=="*"&&C!=="owners"&&(!Array.isArray(C)||C.some((function(T){return typeof T!="string"}))))return r(f,e(b)),!1;break;case"shared":if((!Array.isArray(C)||C.some((function(T){return typeof T!="string"})))&&C!=="owners"&&typeof C!="boolean")return r(f,e(b)),!1;break;default:if(!wh.id[b])return console.error("customIntegration does not support key ".concat(b)),!1}}}return!0}function Ey(n,e){if(e===void 0)return!1;switch(ut(e)){case"string":return ut(n)===e;case"object":if(ut(n)!=="object")return!1;for(var r in n)if(!Ey(n[r],e[r]))return!1;return!0;default:return!1}}function My(n,e){var r=n.sessionId,a=n.toEndPoint,l=n.callerId,f=n.useSipRefer;if(!r||!a)throw new Error("".concat(e,"() requires a sessionId and toEndPoint"));if(typeof r!="string"||typeof a!="string")throw new Error("Invalid paramater: sessionId and toEndPoint must be of type string");if(f&&!a.startsWith("sip:"))throw new Error('"toEndPoint" must be a "sip" address');if(!a.startsWith("sip:")&&!a.startsWith("+"))throw new Error("toEndPoint: ".concat(a,' must starts with either "sip:" or "+"'));if(l&&typeof l!="string")throw new Error("callerId must be of type string");if(l&&!a.startsWith("+"))throw new Error("callerId is only valid when transferring to a PSTN number")}function Ty(n){if(ut(n)!=="object")throw new Error('RemoteMediaPlayerSettings: must be "object" type');if(n.state&&!Object.values(ah).includes(n.state))throw new Error("Invalid value for RemoteMediaPlayerSettings.state, valid values are: "+JSON.stringify(ah));if(n.volume){if(typeof n.volume!="number")throw new Error('RemoteMediaPlayerSettings.volume: must be "number" type');if(n.volume<0||n.volume>2)throw new Error("RemoteMediaPlayerSettings.volume: must be between 0.0 - 2.0")}}function Oy(n,e,r){return!(typeof n!="number"||n<e||n>r)}function Ch(n,e){return n&&!e&&delete n.data,n}function hr(n){"@babel/helpers - typeof";return hr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},hr(n)}var nt=function(){return nt=Object.assign||function(r){for(var a,l=1,f=arguments.length;l<f;l++){a=arguments[l];for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(r[h]=a[h])}return r},nt.apply(this,arguments)};function Eh(n,e){var r={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(r[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(r[a[l]]=n[a[l]]);return r}function Ca(n,e,r,a){function l(f){return f instanceof r?f:new r(function(h){h(f)})}return new(r||(r=Promise))(function(f,h){function y(C){try{b(a.next(C))}catch(T){h(T)}}function v(C){try{b(a.throw(C))}catch(T){h(T)}}function b(C){C.done?f(C.value):l(C.value).then(y,v)}b((a=a.apply(n,[])).next())})}function Ea(n,e){var r={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},a,l,f,h;return h={next:y(0),throw:y(1),return:y(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function y(b){return function(C){return v([b,C])}}function v(b){if(a)throw new TypeError("Generator is already executing.");for(;h&&(h=0,b[0]&&(r=0)),r;)try{if(a=1,l&&(f=b[0]&2?l.return:b[0]?l.throw||((f=l.return)&&f.call(l),0):l.next)&&!(f=f.call(l,b[1])).done)return f;switch(l=0,f&&(b=[b[0]&2,f.value]),b[0]){case 0:case 1:f=b;break;case 4:return r.label++,{value:b[1],done:!1};case 5:r.label++,l=b[1],b=[0];continue;case 7:b=r.ops.pop(),r.trys.pop();continue;default:if(f=r.trys,!(f=f.length>0&&f[f.length-1])&&(b[0]===6||b[0]===2)){r=0;continue}if(b[0]===3&&(!f||b[1]>f[0]&&b[1]<f[3])){r.label=b[1];break}if(b[0]===6&&r.label<f[1]){r.label=f[1],f=b;break}if(f&&r.label<f[2]){r.label=f[2],r.ops.push(b);break}f[2]&&r.ops.pop(),r.trys.pop();continue}b=e.call(n,r)}catch(C){b=[6,C],l=0}finally{a=f=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function Ry(n){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&n[e],a=0;if(r)return r.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&a>=n.length&&(n=void 0),{value:n&&n[a++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function wt(n,e){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var a=r.call(n),l,f=[],h;try{for(;(e===void 0||e-- >0)&&!(l=a.next()).done;)f.push(l.value)}catch(y){h={error:y}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(h)throw h.error}}return f}function _n(n,e,r){if(arguments.length===2)for(var a=0,l=e.length,f;a<l;a++)(f||!(a in e))&&(f||(f=Array.prototype.slice.call(e,0,a)),f[a]=e[a]);return n.concat(f||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var Ay=U.createContext(null),gi=function(){var e=U.useContext(Ay);return U.useDebugValue(e),e},Mh=U.createContext({on:function(){},off:function(){}}),Fk=-1,Th=function(){return Fk--},zk=1,Oh=function(){return zk++},Qe=function(e,r,a){a===void 0&&(a=!1);var l=U.useContext(Mh),f=l.off,h=l.on,y=wt(U.useState(!1),2),v=y[0],b=y[1],C=U.useRef(0),T=U.useMemo(function(){return a?Th():Oh()},[a]);U.useEffect(function(){if(!(!e||v)){if(C.current>1e5){console.error(`useDailyEvent called with potentially non-memoized event callback or due to too many re-renders.
        Memoize using useCallback to avoid re-render loop or reduce the amount of state transitions the callback depends on.
        Passed callback for '`.concat(e,"' event is NOT registered."),r),b(!0);return}C.current++;var L=setTimeout(function(){C.current=0},50);return h(e,r,T),function(){clearTimeout(L),f(e,T)}}},[r,e,T,v,f,h]),U.useDebugValue({event:e,eventId:T,isBlocked:v,callback:r})};function qr(n,e){var r,a;if(n===e)return!0;if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;for(var l=0;l<n.length;l++)if(!qr(n[l],e[l]))return!1;return!0}if(MediaStream&&n instanceof MediaStream&&e instanceof MediaStream)return n.id===e.id&&n.active===e.active&&n.getTracks().length===e.getTracks().length&&n.getTracks().every(function(P,R){return qr(P,e.getTracks()[R])});if(MediaStreamTrack&&n instanceof MediaStreamTrack&&e instanceof MediaStreamTrack)return n.id===e.id&&n.kind===e.kind&&n.readyState===e.readyState;if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(n instanceof RegExp&&e instanceof RegExp)return n.source===e.source&&n.flags===e.flags;if(n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;var f=Array.from(n).sort(),h=Array.from(e).sort();return f.every(function(P,R){return qr(P,h[R])})}if(n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;try{for(var y=Ry(n.entries()),v=y.next();!v.done;v=y.next()){var b=wt(v.value,2),C=b[0],T=b[1];if(!e.has(C)||!qr(T,e.get(C)))return!1}}catch(P){r={error:P}}finally{try{v&&!v.done&&(a=y.return)&&a.call(y)}finally{if(r)throw r.error}}return!0}if(hr(n)!=="object"||n===null||hr(e)!=="object"||e===null)return!1;var L=Object.keys(n),A=Object.keys(e);if(L.length!==A.length)return!1;for(var l=0;l<L.length;l++){var C=L[l];if(!Object.prototype.hasOwnProperty.call(e,C)||!qr(n[C],e[C]))return!1}return!0}function Rh(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(var r=0;r<n.length;r++){var a=n[r],l=e[r],f=a!==null&&hr(a)==="object",h=l!==null&&hr(l)==="object";if(f||h){if(!qr(a,l))return!1}else if(a!==l)return!1}return!0}function gt(n){return"daily-react-"+n}function Ah(n){var e=new Map,r=new Map;return function(a){if(!e.has(a)){var l=st(function(f){var h=n.get(a)(f),y=r.get(a);return y!=null&&n.equals(h,y)?y:(r.set(a,h),h)});e.set(a,l)}return e.get(a)}}var Ph="::",Py=";",Ih=function(e,r){return e+Ph+r},Vk=function(e,r){return e+Ph+r.join(Py)},wn=function(e,r){return xh(Ih(e,r))},Ma=wc(function(n){var e=st([]);return e.debugLabel=gt("participant-property-paths-".concat(n)),e}),xh=wc(function(n){var e=st(null);return e.debugLabel=gt("participant-property-".concat(n)),e}),$k=Ah({equals:Rh,get:function(e){return function(r){var a=wt(e.split(Ph),2),l=a[0],f=a[1],h=f.split(Py);return h.map(function(y){return r(wn(l,y))})}}}),Iy=function(e,r){var a,l=uo(Array.isArray(r)?$k(Vk(e,r)):xh(Ih(e,r)));return U.useDebugValue(Array.isArray(r)?r.reduce(function(f,h,y){return f[h]=l[y],f},{}):(a={},a[r]=l,a)),l},Lu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function qk(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Lh,xy;function Wk(){if(xy)return Lh;xy=1;var n="Expected a function",e=NaN,r="[object Symbol]",a=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,h=/^0o[0-7]+$/i,y=parseInt,v=hr(Lu)=="object"&&Lu&&Lu.Object===Object&&Lu,b=(typeof self>"u"?"undefined":hr(self))=="object"&&self&&self.Object===Object&&self,C=v||b||Function("return this")(),T=Object.prototype,L=T.toString,A=Math.max,P=Math.min,R=function(){return C.Date.now()};function N(q,re,me){var ae,we,S,Te,ke,J,De=0,et=!1,ve=!1,ge=!0;if(typeof q!="function")throw new TypeError(n);re=$(re)||0,G(me)&&(et=!!me.leading,ve="maxWait"in me,S=ve?A($(me.maxWait)||0,re):S,ge="trailing"in me?!!me.trailing:ge);function Oe(K){var se=ae,pe=we;return ae=we=void 0,De=K,Te=q.apply(pe,se),Te}function oe(K){return De=K,ke=setTimeout(g,re),et?Oe(K):Te}function Q(K){var se=K-J,pe=K-De,Re=re-se;return ve?P(Re,S-pe):Re}function ue(K){var se=K-J,pe=K-De;return J===void 0||se>=re||se<0||ve&&pe>=S}function g(){var K=R();if(ue(K))return M(K);ke=setTimeout(g,Q(K))}function M(K){return ke=void 0,ge&&ae?Oe(K):(ae=we=void 0,Te)}function E(){ke!==void 0&&clearTimeout(ke),De=0,ae=J=we=ke=void 0}function D(){return ke===void 0?Te:M(R())}function z(){var K=R(),se=ue(K);if(ae=arguments,we=this,J=K,se){if(ke===void 0)return oe(J);if(ve)return ke=setTimeout(g,re),Oe(J)}return ke===void 0&&(ke=setTimeout(g,re)),Te}return z.cancel=E,z.flush=D,z}function V(q,re,me){var ae=!0,we=!0;if(typeof q!="function")throw new TypeError(n);return G(me)&&(ae="leading"in me?!!me.leading:ae,we="trailing"in me?!!me.trailing:we),N(q,re,{leading:ae,maxWait:re,trailing:we})}function G(q){var re=hr(q);return!!q&&(re=="object"||re=="function")}function X(q){return!!q&&hr(q)=="object"}function x(q){return hr(q)=="symbol"||X(q)&&L.call(q)==r}function $(q){if(typeof q=="number")return q;if(x(q))return e;if(G(q)){var re=typeof q.valueOf=="function"?q.valueOf():q;q=G(re)?re+"":re}if(typeof q!="string")return q===0?q:+q;q=q.replace(a,"");var me=f.test(q);return me||h.test(q)?y(q.slice(2),me?2:8):l.test(q)?e:+q}return Lh=V,Lh}var Hk=Wk(),Gk=qk(Hk),ju=function(e,r,a,l){a===void 0&&(a=500),l===void 0&&(l=!1);var f=U.useContext(Mh),h=f.off,y=f.on,v=U.useMemo(function(){var T;return Array.isArray(e)?e.reduce(function(L,A){return L[A]=l?Th():Oh(),L},{}):(T={},T[e]=l?Th():Oh(),T)},[e,l]),b=U.useRef([]);Qe("call-instance-destroyed",U.useCallback(function(){b.current.length=0},[]));var C=U.useMemo(function(){return Gk(function(){b.current.length!==0&&(r(b.current),b.current.length=0)},a,{trailing:!0})},[r,a]);U.useEffect(function(){if(e){var T=function(A){b.current.push(A),C()};return Array.isArray(e)?e.forEach(function(L){return y(L,T,v[L])}):y(e,T,v[e]),function(){Array.isArray(e)?e.forEach(function(L){return h(L,v[L])}):h(e,v[e])}}},[C,e,v,h,y]),U.useDebugValue({event:e,eventId:v})},Ly=function(e,r,a){if(r===void 0&&(r=""),a===void 0&&(a=new Set),hr(e)!=="object"||e===null||a.has(e))return[r];a.add(e);var l=[];for(var f in e)if(Object.prototype.hasOwnProperty.call(e,f)){var h=r?"".concat(r,".").concat(f):f;l.push.apply(l,_n([h],wt(Ly(e[f],h,a)),!1))}return a.delete(e),l},jh=function(e){return Ly(e)},Jk=function(e,r){return String(r).split(".").filter(function(a){return a.length}).reduce(function(a,l){return a&&a[l]},e)},Nh=function(e,r){return r.map(function(a){return Jk(e,a)})},Nu=st(null);Nu.debugLabel=gt("active-id");var Ic=st("");Ic.debugLabel=gt("local-id");var jy=st(null);jy.debugLabel=gt("local-join-date");var To=st([]);To.debugLabel=gt("participant-ids");var Oo=wc(function(n){var e=st(null);return e.debugLabel=gt("participant-".concat(n)),e}),Dh=st([]);Dh.debugLabel=gt("waiting-participants");var Uh=wc(function(n){var e=st({awaitingAccess:{level:"full"},id:n,name:""});return e.debugLabel=gt("waiting-participant-".concat(n)),e}),Qk=function(e){var r=e.children,a=gi(),l=wt(U.useState(!1),2),f=l[0],h=l[1],y=it(U.useCallback(function(C,T,L){T(Ic,L.local.session_id);var A=Object.values(L),P=A.map(function(R){return R.session_id});T(To,P),A.forEach(function(R){T(Oo(R.session_id),R);var N=jh(R);T(Ma(R.session_id),N),N.forEach(function(V){var G=wt(Nh(R,[V]),1),X=G[0];T(wn(R.session_id,V),X)})}),h(!0)},[]));U.useEffect(function(){if(!(!a||f)){var C=setInterval(function(){var T=a.participants();"local"in T&&(y(T),clearInterval(C))},100);return function(){clearInterval(C)}}},[a,f,y]);var v=U.useCallback(function(){if(a){var C=a?.participants();C.local&&y(C)}},[a,y]);Qe("started-camera",v,!0),Qe("access-state-updated",v,!0),Qe("joining-meeting",it(U.useCallback(function(C,T){T(jy,new Date),v()},[v])),!0),Qe("joined-meeting",U.useCallback(function(C){y(C.participants)},[y]),!0);var b=it(U.useCallback(function(C,T){T(Ic,""),T(Nu,null);var L=C(To);L.forEach(function(A){return Oo.remove(A)}),T(To,[])},[]));return Qe("call-instance-destroyed",b,!0),Qe("left-meeting",b,!0),ju(["active-speaker-change","participant-joined","participant-updated","participant-left"],it(U.useCallback(function(C,T,L){L.length&&L.forEach(function(A){switch(A.action){case"active-speaker-change":{T(Nu,A.activeSpeaker.peerId),T(Oo(A.activeSpeaker.peerId),function(x){return x?nt(nt({},x),{last_active:new Date}):null});break}case"participant-joined":{T(To,function(x){return x.includes(A.participant.session_id)?x:_n(_n([],wt(x),!1),[A.participant.session_id],!1)}),T(Oo(A.participant.session_id),A.participant);var P=jh(A.participant);T(Ma(A.participant.session_id),P),P.forEach(function(x){var $=wt(Nh(A.participant,[x]),1),q=$[0];T(wn(A.participant.session_id,x),q)});break}case"participant-updated":{T(Oo(A.participant.session_id),A.participant),A.participant.local&&T(Ic,A.participant.session_id);var P=jh(A.participant),R=C(Ma(A.participant.session_id)),N=P.length!==R.length||P.some(function($){return!R.includes($)});N&&T(Ma(A.participant.session_id),P);var V=new Set(R),G=Nh(A.participant,P);P.forEach(function($,q){var re=G[q];V.delete($),T(wn(A.participant.session_id,$),function(me){return qr(me,re)?me:re})}),V.forEach(function($){T(wn(A.participant.session_id,$),null)});break}case"participant-left":{T(To,function(x){return x.includes(A.participant.session_id)?x.filter(function($){return $!==A.participant.session_id}):x}),Oo.remove(A.participant.session_id);var X=C(Ma(A.participant.session_id));X.forEach(function(x){xh.remove(Ih(A.participant.session_id,x))}),Ma.remove(A.participant.session_id);break}}})},[])),100,!0),ju(["waiting-participant-added","waiting-participant-updated","waiting-participant-removed"],it(U.useCallback(function(C,T,L){L.forEach(function(A){switch(A.action){case"waiting-participant-added":T(Dh,function(P){return P.includes(A.participant.id)?P:_n(_n([],wt(P),!1),[A.participant.id],!1)}),T(Uh(A.participant.id),A.participant);break;case"waiting-participant-updated":T(Uh(A.participant.id),A.participant);break;case"waiting-participant-removed":T(Dh,function(P){return P.filter(function(R){return R!==A.participant.id})}),Uh.remove(A.participant.id);break}})},[])),100,!0),tt.createElement(tt.Fragment,null,r)},Du=function(){var e=uo(Ic);return U.useDebugValue(e),e},Kk=function(){return!0},Yk=function(e){var r=e===void 0?{}:e,a=r.filter,l=a===void 0?Kk:a,f=r.ignoreLocal,h=f===void 0?!1:f,y=Du(),v=uo(Nu),b=h&&v===y,C=!l?.(v),T=!b&&!C,L=wt(U.useState(T?v:null),2),A=L[0],P=L[1];return U.useEffect(function(){b||C||P(v)},[C,b,v]),U.useDebugValue(A),A},Uu=function(e){return["blocked","off"].includes(e)},Ny=";",Dy=function(e,r){return"".concat(e).concat(Ny).concat(r)},Uy=Ah({equals:qr,get:function(e){return function(r){var a=wt(e.split(Ny),2),l=a[0],f=a[1],h=r(To);return h.filter(function(y){switch(l){case"local":case"owner":case"record":return r(wn(y,l));case"remote":return!r(wn(y,"local"));case"screen":{var v=r(wn(y,"tracks.screenAudio.state")),b=r(wn(y,"tracks.screenVideo.state"));return!Uu(v)||!Uu(b)}default:return!0}}).sort(function(y,v){switch(f){case"joined_at":case"session_id":case"user_id":case"user_name":{var b=r(wn(y,f)),C=r(wn(v,f));if(b!==void 0||C!==void 0){if(b===void 0)return-1;if(C===void 0||b>C)return 1;if(b<C)return-1}return 0}default:return 0}})}}}),By=function(e){var r=e===void 0?{}:e,a=r.filter,l=r.onActiveSpeakerChange,f=r.onParticipantJoined,h=r.onParticipantLeft,y=r.onParticipantUpdated,v=r.sort,b=uo(Uy(Dy(typeof a=="string"?a:null,typeof v=="string"?v:null))),C=typeof a=="function"||typeof v=="function",T=U.useCallback(function(V){if(typeof a!="function"&&typeof v!="function")return[];var G=b.map(function(X){return V(Oo(X))});return G.filter(function(X){return!!X}).filter(typeof a=="function"?a:function(){return!0}).sort(typeof v=="function"?v:function(){return 0}).map(function(X){return X.session_id}).filter(Boolean)},[a,b,v]),L=wt(U.useState([]),2),A=L[0],P=L[1],R=it(U.useCallback(function(V){if(C){var G=T(V);qr(G,A)||P(G)}},[A,T,C]));U.useEffect(function(){R()},[R]),ju(["participant-joined","participant-updated","active-speaker-change","participant-left"],U.useCallback(function(V){V.length&&(V.forEach(function(G){switch(G.action){case"participant-joined":f?.(G);break;case"participant-updated":y?.(G);break;case"active-speaker-change":l?.(G);break;case"participant-left":h?.(G);break}}),R())},[R,l,f,h,y]));var N=typeof a=="function"||typeof v=="function"?A:b;return U.useDebugValue(N),N},Xk=Ah({equals:Rh,get:function(){return function(e){var r=e(Uy(Dy("screen",null)));return r.map(function(a){return{local:e(wn(a,"local")),screenAudio:e(wn(a,"tracks.screenAudio")),screenVideo:e(wn(a,"tracks.screenVideo")),screenId:"".concat(a,"-screen"),session_id:a}})}}}),Zk=function(e){var r={},a=r.onError,l=r.onLocalScreenShareStarted,f=r.onLocalScreenShareStopped,h=gi(),y=U.useCallback(function(){for(var T=[],L=0;L<arguments.length;L++)T[L]=arguments[L];h?.startScreenShare.apply(h,_n([],wt(T),!1))},[h]),v=U.useCallback(function(){for(var T=[],L=0;L<arguments.length;L++)T[L]=arguments[L];h?.stopScreenShare.apply(h,_n([],wt(T),!1))},[h]);Qe("local-screen-share-started",U.useCallback(function(){return l?.()},[l])),Qe("local-screen-share-stopped",U.useCallback(function(){return f?.()},[f])),Qe("nonfatal-error",U.useCallback(function(T){T.type==="screen-share-error"&&a?.(T)},[a]));var b=uo(Xk(void 0)),C={isSharingScreen:b.some(function(T){return T.local}),screens:b,startScreenShare:y,stopScreenShare:v};return U.useDebugValue(C),C},Fy=function(e,r){r===void 0&&(r="video");var a=Iy(e,"tracks.".concat(r)),l=a?nt(nt({},a),{isOff:Uu(a.state)}):{isOff:!0,persistentTrack:void 0,state:"off",subscribed:!1};return U.useDebugValue(l),l};function zy(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return U.useCallback(function(r){for(var a=0;a<n.length;a++){var l=n[a];typeof l=="function"?l(r):l&&hr(l)==="object"&&(l.current=r)}},n)}var Bu=U.memo(U.forwardRef(function(n,e){var r=n.onPlayFailed,a=n.sessionId,l=n.type,f=l===void 0?"audio":l,h=Eh(n,["onPlayFailed","sessionId","type"]),y=U.useRef(null),v=Fy(a,f),b=zy(y,e),C=v?.subscribed;return U.useEffect(function(){var T=y.current;if(!(!T||!v?.persistentTrack)){var L=function(){T.play().catch(function(P){r?.({sessionId:a,target:T,type:f,message:P.message,name:P.name})})};if(!MediaStream){console.warn("MediaStream API not available. Can't setup ".concat(f," for ").concat(a)),r?.({sessionId:a,target:T,type:f,message:"MediaStream API not available",name:"MediaStream API not available"});return}return T.addEventListener("canplay",L),T.srcObject=new MediaStream([v?.persistentTrack]),function(){T?.removeEventListener("canplay",L)}}},[v?.persistentTrack,r,a,f]),Qe("participant-left",U.useCallback(function(T){var L=y.current;T.participant.session_id!==a||!L||(L.srcObject=null)},[a])),tt.createElement("audio",nt({autoPlay:!0,ref:b},h,{"data-session-id":a,"data-audio-type":f,"data-subscribed":C}))}));Bu.displayName="DailyAudioTrack";var eC=U.memo(U.forwardRef(function(n,e){var r=n.autoSubscribeActiveSpeaker,a=r===void 0?!1:r,l=n.maxSpeakers,f=l===void 0?5:l,h=n.onPlayFailed,y=n.playLocalScreenAudio,v=y===void 0?!1:y,b=gi(),C=wt(U.useState(new Array(f).fill("")),2),T=C[0],L=C[1],A=Zk().screens,P=Du(),R=Yk({ignoreLocal:!0}),N=U.useRef(null);U.useImperativeHandle(e,function(){return{getActiveSpeakerAudio:function(){var $,q;return(q=($=N.current)===null||$===void 0?void 0:$.querySelector('audio[data-session-id="'.concat(R,'"][data-audio-type="audio"]')))!==null&&q!==void 0?q:null},getAllAudio:function(){var $,q;return Array.from((q=($=N.current)===null||$===void 0?void 0:$.querySelectorAll("audio"))!==null&&q!==void 0?q:[])},getAudioBySessionId:function($){var q,re;return(re=(q=N.current)===null||q===void 0?void 0:q.querySelector('audio[data-session-id="'.concat($,'"][data-audio-type="audio"]')))!==null&&re!==void 0?re:null},getRmpAudio:function(){var $,q;return Array.from((q=($=N.current)===null||$===void 0?void 0:$.querySelectorAll('audio[data-audio-type="rmpAudio"]'))!==null&&q!==void 0?q:[])},getScreenAudio:function(){var $,q;return Array.from((q=($=N.current)===null||$===void 0?void 0:$.querySelectorAll('audio[data-audio-type="screenAudio"]'))!==null&&q!==void 0?q:[])},getRmpAudioBySessionId:function($){var q,re;return(re=(q=N.current)===null||q===void 0?void 0:q.querySelector('audio[data-session-id="'.concat($,'"][data-audio-type="rmpAudio"]')))!==null&&re!==void 0?re:null},getScreenAudioBySessionId:function($){var q,re;return(re=(q=N.current)===null||q===void 0?void 0:q.querySelector('audio[data-session-id="'.concat($,'"][data-audio-type="screenAudio"]')))!==null&&re!==void 0?re:null}}},[R]);var V=it(U.useCallback(function(x,$,q){return Ca(void 0,void 0,void 0,function(){var re,me,ae;return Ea(this,function(we){if(re=Object.values((ae=b?.participants())!==null&&ae!==void 0?ae:{}).filter(function(S){return!S.local&&!!S.tracks.audio.subscribed}),me=function(Te){return re.some(function(ke){return ke.session_id===Te})},!me(q))if(b&&!b.isDestroyed()&&a&&!b.subscribeToTracksAutomatically())b.updateParticipant(q,{setSubscribedTracks:{audio:!0}});else return[2];return L(function(S){var Te;if(S.includes(q))return S;var ke=function(oe){return!oe||!me(oe)};if(S.some(ke)){var J=S.findIndex(ke);return S[J]=q,_n([],wt(S),!1)}var De=S.findIndex(function(Oe){return re.some(function(oe){return oe.session_id===Oe&&Uu(oe.tracks.audio.state)})});if(De>=0)return S[De]=q,_n([],wt(S),!1);var et=re.filter(function(Oe){return S.includes(Oe.session_id)&&Oe.session_id!==R}).sort(function(Oe,oe){var Q,ue,g=(Q=x(wn(Oe.session_id,"last_active")))!==null&&Q!==void 0?Q:new Date("1970-01-01"),M=(ue=x(wn(oe.session_id,"last_active")))!==null&&ue!==void 0?ue:new Date("1970-01-01");return g>M?1:g<M?-1:0});if(!et.length){var ve=S.findIndex(function(Oe){return Oe!==R});return S[ve]=q,_n([],wt(S),!1)}var ge=S.indexOf((Te=et[0])===null||Te===void 0?void 0:Te.session_id);return S[ge]=q,_n([],wt(S),!1)}),[2]})})},[R,a,b])),G=U.useCallback(function(x){L(function($){if(!$.includes(x))return $;var q=_n([],wt($),!1),re=q.indexOf(x);return q[re]="",q})},[]);ju(["active-speaker-change","track-started","participant-left"],U.useCallback(function(x){x.forEach(function($){switch($.action){case"active-speaker-change":if($.activeSpeaker.peerId===P)return;V($.activeSpeaker.peerId);break;case"track-started":$.track.kind==="audio"&&$.participant&&!$.participant.local&&V($.participant.session_id);break;case"participant-left":G($.participant.session_id);break}})},[V,P,G]),200);var X=By({filter:U.useCallback(function(x){var $;return!!(!(($=x?.tracks)===null||$===void 0)&&$.rmpAudio)},[])});return tt.createElement("div",{ref:N},T.map(function(x,$){return tt.createElement(Bu,{key:"speaker-slot-".concat($),onPlayFailed:h,sessionId:x,type:"audio"})}),A.filter(function(x){return v?!0:!x.local}).map(function(x){return tt.createElement(Bu,{key:x.screenId,onPlayFailed:h,sessionId:x.session_id,type:"screenAudio"})}),X.map(function(x){return tt.createElement(Bu,{key:"".concat(x,"-rmp"),onPlayFailed:h,sessionId:x,type:"rmpAudio"})}))}));eC.displayName="DailyAudio";var tC=U.forwardRef(function(e,r){var a=e.automirror,l=e.fit,f=l===void 0?"contain":l,h=e.mirror,y=e.onResize,v=e.playableStyle,b=v===void 0?{}:v,C=e.sessionId,T=e.style,L=T===void 0?{}:T,A=e.type,P=A===void 0?"video":A,R=Eh(e,["automirror","fit","mirror","onResize","playableStyle","sessionId","style","type"]),N=Du(),V=N===C,G=P==="screenVideo",X=V&&!G,x=U.useRef(null),$=zy(x,r),q=Fy(C,P),re=q.persistentTrack,me=X||G||!q.isOff,ae=Iy(C,"tracks.".concat(P)),we=ae?.subscribed,S=U.useMemo(function(){if(typeof h=="boolean")return h;if(!a)return!1;if(!re)return X;var Te=re.getSettings(),ke="facingMode"in Te?X&&Te.facingMode==="user":X;return ke},[a,X,h,re]);return U.useEffect(function(){var ke=x.current;if(ke){var J=function(){var oe=ke.play();oe!==void 0&&oe.then(function(){ke.controls=!1}).catch(function(Q){ke.controls=!0,console.warn("Failed to play video",Q)})},De=function(){ke.paused&&J()},et=function(){ke.style.transform="scale(1)"},ve=function(){ke.style.transform="",setTimeout(function(){ke.paused&&J()},100)},ge=function(){document.visibilityState!=="hidden"&&ke.paused&&J()};return ke.addEventListener("canplay",De),ke.addEventListener("enterpictureinpicture",et),ke.addEventListener("leavepictureinpicture",ve),document.addEventListener("visibilitychange",ge),function(){ke.removeEventListener("canplay",De),ke.removeEventListener("enterpictureinpicture",et),ke.removeEventListener("leavepictureinpicture",ve),document.removeEventListener("visibilitychange",ge)}}},[]),U.useEffect(function(){var ke=x.current;if(!(!ke||!re)){if(!MediaStream){console.warn("MediaStream API not available. Can't setup ".concat(P," for ").concat(C));return}return ke.srcObject=new MediaStream([re]),ke.load(),function(){ke.srcObject=null,ke.load()}}},[C,P,re,re?.id]),U.useEffect(function(){var ke=x.current;if(!y||!ke)return;var J;function De(){J&&cancelAnimationFrame(J),J=requestAnimationFrame(function(){var et=x.current;if(!(!et||document.hidden)){var ve=et.videoWidth,ge=et.videoHeight;ve&&ge&&y?.({aspectRatio:ve/ge,height:ge,width:ve})}})}return De(),ke.addEventListener("loadedmetadata",De),ke.addEventListener("resize",De),function(){J&&cancelAnimationFrame(J),ke.removeEventListener("loadedmetadata",De),ke.removeEventListener("resize",De)}},[y]),tt.createElement("video",nt({autoPlay:!0,muted:!0,playsInline:!0,ref:$,"data-local":V,"data-mirrored":S||void 0,"data-playable":me||void 0,"data-session-id":C,"data-subscribed":we,"data-video-type":P,style:nt(nt({objectFit:f,transform:S?"scale(-1, 1)":""},L),me?b:{})},R))});tC.displayName="DailyVideo";var nC=U.createContext({refreshDevices:function(){return Promise.resolve()}}),Ht=st("idle");Ht.debugLabel=gt("camera-state");var Gt=st("idle");Gt.debugLabel=gt("microphone-state");var Fu=st([]);Fu.debugLabel=gt("camera-devices");var zu=st([]);zu.debugLabel=gt("microphone-devices");var Vy=st([]);Vy.debugLabel=gt("speaker-devices");var $y=st(null);$y.debugLabel=gt("last-camera-error");var rC=function(e){var r=e.children,a=gi(),l=it(U.useCallback(function(h,y){return Ca(void 0,void 0,void 0,function(){var v,b,C,T,L,A,P,R,N,V,G,X;return Ea(this,function(x){switch(x.label){case 0:if(typeof((G=navigator?.mediaDevices)===null||G===void 0?void 0:G.getUserMedia)>"u"||typeof((X=navigator?.mediaDevices)===null||X===void 0?void 0:X.enumerateDevices)>"u")return y(Ht,"not-supported"),y(Gt,"not-supported"),[2];if(!a)return[2];x.label=1;case 1:return x.trys.push([1,4,,5]),[4,a.enumerateDevices()];case 2:return v=x.sent().devices,b=v.filter(function($){return $.kind==="videoinput"&&$.deviceId!==""}),C=v.filter(function($){return $.kind==="audioinput"&&$.deviceId!==""}),T=v.filter(function($){return $.kind==="audiooutput"&&$.deviceId!==""}),[4,a.getInputDevices()];case 3:return L=x.sent(),A=L.camera,P=L.mic,R=L.speaker,N=function(q,re,me){var ae,we;return{device:re,selected:"deviceId"in q&&re.deviceId===q.deviceId,state:(we=(ae=me.find(function(S){return S.device.deviceId===re.deviceId}))===null||ae===void 0?void 0:ae.state)!==null&&we!==void 0?we:"granted"}},V=function(q,re){return q.device.deviceId==="default"?-1:re.device.deviceId==="default"?1:q.device.label<re.device.label?-1:q.device.label>re.device.label?1:0},y(Fu,function($){return b.filter(Boolean).map(function(q){return N(A,q,$)}).sort(V)}),y(zu,function($){return C.filter(Boolean).map(function(q){return N(P,q,$)}).sort(V)}),y(Vy,function($){return T.filter(Boolean).map(function(q){return N(R,q,$)}).sort(V)}),[3,5];case 4:return x.sent(),y(Ht,"not-supported"),y(Gt,"not-supported"),[3,5];case 5:return[2]}})})},[a])),f=it(U.useCallback(function(h,y){return Ca(void 0,void 0,void 0,function(){var v,b,C,T,L,A,P,R,N,V,G,X,x,$,q,re,me,ae,we,S,Te,ke,J,De,et,ve;return Ea(this,function(ge){switch(ge.label){case 0:if(!a)return[2];if(v=h(Ht),b=h(Gt),C=a.participants(),!C.local)return[2];if(T=C.local.tracks,L="prompt",A="prompt",!navigator.permissions)return[3,5];ge.label=1;case 1:return ge.trys.push([1,4,,5]),[4,navigator.permissions.query({name:"camera"})];case 2:return P=ge.sent(),L=P.state,[4,navigator.permissions.query({name:"microphone"})];case 3:return R=ge.sent(),A=R.state,[3,5];case 4:return ge.sent(),[3,5];case 5:return N=L==="prompt"&&["idle","pending"].includes(v)&&T.video.state==="interrupted"&&!T.video.persistentTrack,V=["idle","pending"].includes(v)&&!T.video.persistentTrack&&!!(!((x=T.video.off)===null||x===void 0)&&x.byUser),G=A==="prompt"&&["idle","pending"].includes(b)&&T.audio.state==="interrupted"&&!T.audio.persistentTrack,X=["idle","pending"].includes(b)&&!T.audio.persistentTrack&&!!(!(($=T.audio.off)===null||$===void 0)&&$.byUser),!((re=(q=T.audio)===null||q===void 0?void 0:q.blocked)===null||re===void 0)&&re.byDeviceInUse?(y(Gt,"in-use"),y(zu,function(Oe){return Oe.map(function(oe){return oe.selected?nt(nt({},oe),{state:"in-use"}):oe})})):!((ae=(me=T.audio)===null||me===void 0?void 0:me.blocked)===null||ae===void 0)&&ae.byDeviceMissing?y(Gt,"not-found"):!((S=(we=T.audio)===null||we===void 0?void 0:we.blocked)===null||S===void 0)&&S.byPermissions||A==="denied"?y(Gt,"blocked"):G?y(Gt,"pending"):X?y(Gt,"idle"):(y(Gt,"granted"),y(zu,function(Oe){return Oe.map(function(oe){return oe.selected?nt(nt({},oe),{state:"granted"}):oe})})),!((ke=(Te=T.video)===null||Te===void 0?void 0:Te.blocked)===null||ke===void 0)&&ke.byDeviceInUse?(y(Ht,"in-use"),y(Fu,function(Oe){return Oe.map(function(oe){return oe.selected?nt(nt({},oe),{state:"in-use"}):oe})})):!((De=(J=T.video)===null||J===void 0?void 0:J.blocked)===null||De===void 0)&&De.byDeviceMissing?y(Ht,"not-found"):!((ve=(et=T.video)===null||et===void 0?void 0:et.blocked)===null||ve===void 0)&&ve.byPermissions||L==="denied"?y(Ht,"blocked"):N?y(Ht,"pending"):V?y(Ht,"idle"):(y(Ht,"granted"),y(Fu,function(Oe){return Oe.map(function(oe){return oe.selected?nt(nt({},oe),{state:"granted"}):oe})})),l(),[2]}})})},[a,l]));return Qe("participant-updated",U.useCallback(function(h){h.participant.local&&f()},[f])),Qe("available-devices-updated",l),Qe("selected-devices-updated",l),Qe("camera-error",it(U.useCallback(function(h,y,v){var b,C,T,L,A,P,R;switch(y($y,v.error),(b=v.error)===null||b===void 0?void 0:b.type){case"cam-in-use":y(Ht,"in-use");break;case"mic-in-use":y(Gt,"in-use");break;case"cam-mic-in-use":y(Ht,"in-use"),y(Gt,"in-use");break;case"not-found":!((C=v.error)===null||C===void 0)&&C.missingMedia.includes("video")&&y(Ht,"not-found"),!((T=v.error)===null||T===void 0)&&T.missingMedia.includes("audio")&&y(Gt,"not-found");break;case"permissions":!((L=v.error)===null||L===void 0)&&L.blockedMedia.includes("video")&&y(Ht,"blocked"),!((A=v.error)===null||A===void 0)&&A.blockedMedia.includes("audio")&&y(Gt,"blocked");break;case"constraints":((P=v.error)===null||P===void 0?void 0:P.reason)==="invalid"?(y(Ht,"constraints-invalid"),y(Gt,"constraints-invalid")):((R=v.error)===null||R===void 0?void 0:R.reason)==="none-specified"&&(y(Ht,"constraints-none-specified"),y(Gt,"constraints-none-specified"));break;case"undefined-mediadevices":y(Ht,"undefined-mediadevices"),y(Gt,"undefined-mediadevices");break;case"unknown":default:y(Ht,"unknown"),y(Gt,"unknown");break}},[]))),Qe("started-camera",it(U.useCallback(function(h,y){y(Ht,"granted"),y(Gt,"granted"),f()},[f]))),tt.createElement(nC.Provider,{value:{refreshDevices:l}},r)},xc=st({errorMsg:void 0,isLiveStreaming:!1,layout:void 0});xc.debugLabel=gt("live-streaming");var iC=function(e){var r=e.children;return Qe("live-streaming-started",it(U.useCallback(function(a,l,f){l(xc,{isLiveStreaming:!0,layout:f?.layout})},[]))),Qe("live-streaming-stopped",it(U.useCallback(function(a,l){l(xc,function(f){return nt(nt({},f),{isLiveStreaming:!1,layout:void 0})})},[]))),Qe("live-streaming-error",it(U.useCallback(function(a,l,f){l(xc,function(h){return nt(nt({},h),{errorMsg:f.errorMsg})})},[]))),Qe("left-meeting",it(U.useCallback(function(a,l){l(xc,{errorMsg:void 0,isLiveStreaming:!1,layout:void 0})},[]))),tt.createElement(tt.Fragment,null,r)},Vu=st("new");Vu.debugLabel=gt("meeting-state");var Bh=st(null);Bh.debugLabel=gt("meeting-error");var Fh=st(null);Fh.debugLabel=gt("non-fatal-error");var Lc=st({data:void 0,topology:"none"});Lc.debugLabel=gt("meeting-session-data");var sC=function(e){var r=e.children,a=gi(),l=it(U.useCallback(function(h,y){if(a){var v=a.meetingState();return y(Vu,v),v}},[a]));Qe("loading",l),Qe("loaded",l),Qe("joining-meeting",l),Qe("joined-meeting",l),Qe("left-meeting",l),Qe("error",it(U.useCallback(function(h,y,v){y(Bh,v),l()},[l]))),Qe("nonfatal-error",it(U.useCallback(function(h,y,v){y(Fh,v)},[])));var f=it(U.useCallback(function(h,y){a&&y(Lc,a.meetingSessionState())},[a]));return Qe("joined-meeting",f),Qe("meeting-session-state-updated",it(U.useCallback(function(h,y,v){y(Lc,v.meetingSessionState)},[]))),Qe("left-meeting",it(U.useCallback(function(h,y){y(Lc,{data:void 0,topology:"none"})},[]))),Qe("call-instance-destroyed",it(U.useCallback(function(h,y){y(Vu,"new"),y(Bh,null),y(Fh,null),y(Lc,{data:void 0,topology:"none"})},[]))),tt.createElement(tt.Fragment,null,r)},Ta=st("none");Ta.debugLabel=gt("topology");var qy=st("unknown"),Wy=st([]),zh=st(100);zh.debugLabel=gt("network-quality");var Vh=st("good");Vh.debugLabel=gt("network-threshold");var oC=function(e){var r=e.children,a=gi(),l=uo(Ta),f=it(U.useCallback(function(h,y){return Ca(void 0,void 0,void 0,function(){var v;return Ea(this,function(b){switch(b.label){case 0:return a?[4,a.getNetworkTopology()]:[2];case 1:return v=b.sent(),!v||v?.topology==="none"?[2]:(y(Ta,v.topology),[2])}})})},[a]));return Qe("joined-meeting",f),Qe("network-connection",it(U.useCallback(function(h,y,v){switch(v.event){case"connected":v.type==="peer-to-peer"&&y(Ta,"peer"),v.type==="sfu"&&y(Ta,"sfu");break}},[]))),Qe("network-quality-change",it(U.useCallback(function(h,y,v){y(qy,function(b){return b!==v.networkState?v.networkState:b}),y(Wy,function(b){var C,T=(C=v.networkStateReasons)!==null&&C!==void 0?C:[];return Rh(b,T)?b:T}),y(zh,function(b){return b!==v.quality?v.quality:b}),y(Vh,function(b){return b!==v.threshold?v.threshold:b})},[]))),Qe("left-meeting",it(U.useCallback(function(h,y){y(Ta,"none"),y(qy,"unknown"),y(Wy,[]),y(zh,100),y(Vh,"good")},[]))),U.useEffect(function(){!a||l!=="none"||f()},[a,f,l]),tt.createElement(tt.Fragment,null,r)},Ro=st({isLocalParticipantRecorded:!1,isRecording:!1});Ro.debugLabel=gt("recording-state");var aC=function(e){var r=e.children,a=Du(),l=By({filter:"record"}),f=it(U.useCallback(function(h,y,v,b){var C=h(Ro),T={isLocalParticipantRecorded:C.isLocalParticipantRecorded,isRecording:C.isRecording,local:C.local,type:C.type},L={isLocalParticipantRecorded:T?.type==="local"||!T?.type?v:T.isLocalParticipantRecorded,isRecording:T?.type==="local"||!T?.type?v:T.isRecording,local:(T?.type==="local"||!T?.type)&&v?b:T?.local,type:v?"local":C?.type};qr(T,L)||y(Ro,nt(nt({},T),L))},[]));return U.useEffect(function(){var h=l.length>0,y=l.includes(a||"local");f(h,y)},[a,f,l]),Qe("recording-started",it(U.useCallback(function(h,y,v){var b,C=!0;switch(v.type){case"cloud-beta":case"cloud":{a&&((b=v.layout)===null||b===void 0?void 0:b.preset)==="single-participant"&&v.layout.session_id!==a&&(C=!1);break}}y(Ro,{error:!1,isLocalParticipantRecorded:C,isRecording:!0,layout:v?.layout,local:v?.local,recordingId:v?.recordingId,recordingStartedDate:new Date,startedBy:v?.startedBy,type:v?.type})},[a]))),Qe("recording-stopped",it(U.useCallback(function(h,y){y(Ro,function(v){return nt(nt({},v),{isLocalParticipantRecorded:!1,isRecording:!1})})},[]))),Qe("recording-error",it(U.useCallback(function(h,y){y(Ro,function(v){return nt(nt({},v),{error:!0,isLocalParticipantRecorded:!1,isRecording:!1})})},[]))),Qe("left-meeting",it(U.useCallback(function(h,y){y(Ro,{isLocalParticipantRecorded:!1,isRecording:!1})},[]))),tt.createElement(tt.Fragment,null,r)},cC=function(){var e=uo(Vu);return U.useDebugValue(e),e},$h=st(null);$h.debugLabel=gt("room-state");var lC=function(e){var r=e.children,a=gi(),l=cC(),f=it(U.useCallback(function(h,y){return Ca(void 0,void 0,void 0,function(){var v;return Ea(this,function(b){switch(b.label){case 0:return!a||l==="left-meeting"?[2]:[4,a.room()];case 1:return v=b.sent(),v&&"id"in v&&y($h,v),[2,v]}})})},[a,l]));return Qe("access-state-updated",f),Qe("left-meeting",it(U.useCallback(function(h,y){return function(){y($h,null)}},[]))),tt.createElement(tt.Fragment,null,r)},Oa=st({isTranscribing:!1,model:"general",language:"en",transcriptions:[]});Oa.debugLabel=gt("transcription-state");var uC=function(e){var r=e.children;return Qe("transcription-started",it(U.useCallback(function(a,l,f){l(Oa,{error:!1,transcriptionStartDate:new Date,isTranscribing:!0,transcriptions:[],endpointing:f.endpointing,extra:f.extra,includeRawResponse:f.includeRawResponse,instanceId:f.instanceId,language:f.language,model:f.model,profanity_filter:f.profanity_filter,punctuate:f.punctuate,redact:f.redact,startedBy:f.startedBy,tier:f.tier})},[]))),Qe("transcription-stopped",it(U.useCallback(function(a,l,f){l(Oa,function(h){return nt(nt({},h),{updatedBy:f.updatedBy,isTranscribing:!1})})},[]))),Qe("transcription-error",it(U.useCallback(function(a,l){l(Oa,function(f){return nt(nt({},f),{error:!0,isTranscribing:!1})})},[]))),Qe("left-meeting",it(U.useCallback(function(a,l){l(Oa,function(f){return nt(nt({},f),{isTranscribing:!1})})},[]))),Qe("app-message",it(U.useCallback(function(a,l,f){f?.fromId==="transcription"&&l(Oa,function(h){return nt(nt({},h),{isTranscribing:!0,transcriptions:_n(_n([],wt(h.transcriptions),!1),[f.data],!1)})})},[]))),tt.createElement(tt.Fragment,null,r)},Hy={},Gy=function(){return!0},dC={options:Hy,shouldCreateInstance:Gy},fC=function(e,r){var a=r===void 0?dC:r,l=a.parentElRef,f=a.options,h=f===void 0?Hy:f,y=a.shouldCreateInstance,v=y===void 0?Gy:y,b=wt(U.useState(null),2),C=b[0],T=b[1],L=U.useRef();return U.useEffect(function(){if(!v())return;function A(N){return Ca(this,void 0,void 0,function(){return Ea(this,function(V){switch(V.label){case 0:return[4,N.destroy()];case 1:return V.sent(),[2]}})})}var P=function(){setTimeout(function(){return T(null)},0)},R=Pu.getCallInstance();if(!C&&R&&!R.isDestroyed()){R.once("call-instance-destroyed",P),T(R);return}if(C){qr(L.current,h)||A(C);return}if(!R||R.isDestroyed()){switch(e){case"callFrame":R=l?.current?Pu.createFrame(l.current,nt({},h)):Pu.createFrame(nt({},h));break;case"callObject":R=Pu.createCallObject(nt({},h));break}L.current=h}T(R),R.once("call-instance-destroyed",P)},[C,h,l,v,e]),C},hC=function(e){return fC("callObject",e)},Jy=function(e){var r=e.children,a=e.jotaiStore,l=Eh(e,["children","jotaiStore"]),f=U.useRef({}),h=U.useCallback(function(P){var R,N,V,G;if("action"in P){var X=P.action,x=Array.from((G=(V=f.current)===null||V===void 0?void 0:V[X])!==null&&G!==void 0?G:[]),$=x.filter(function(Te){var ke=wt(Te,1),J=ke[0];return J<0}),q=x.filter(function(Te){var ke=wt(Te,1),J=ke[0];return J>0}),re=_n(_n([],wt($),!1),wt(q),!1);try{for(var me=Ry(re),ae=me.next();!ae.done;ae=me.next()){var we=wt(ae.value,2),S=we[1];S(P)}}catch(Te){R={error:Te}}finally{try{ae&&!ae.done&&(N=me.return)&&N.call(me)}finally{if(R)throw R.error}}}},[]),y=U.useCallback(function(P){P&&Object.keys(f.current).forEach(function(R){P.off(R,h),P.isDestroyed()||P.on(R,h)})},[h]),v="callObject"in l?l.callObject:null,b=U.useMemo(function(){return"callObject"in l?{}:l},[l]),C=hC({options:b,shouldCreateInstance:U.useCallback(function(){return!("callObject"in l)},[l])}),T=v??C;U.useEffect(function(){T&&y(T)},[T,y]);var L=U.useCallback(function(P,R,N){var V,G;f.current[P]||(f.current[P]=new Map,T&&(T.off(P,h),T.isDestroyed()||T.on(P,h))),!((V=f.current[P])===null||V===void 0)&&V.has(N)||(G=f.current[P])===null||G===void 0||G.set(N,R)},[T,h]),A=U.useCallback(function(P,R){var N,V;(N=f.current[P])===null||N===void 0||N.delete(R),((V=f.current[P])===null||V===void 0?void 0:V.size)===0&&(T?.off(P,h),delete f.current[P])},[T,h]);return tt.createElement(Fw,{store:a},tt.createElement(Ay.Provider,{value:T},tt.createElement(Mh.Provider,{value:{on:L,off:A}},tt.createElement(lC,null,tt.createElement(sC,null,tt.createElement(oC,null,tt.createElement(Qk,null,tt.createElement(aC,null,tt.createElement(iC,null,tt.createElement(uC,null,tt.createElement(rC,null,r)))))))))))},pC=st({state:"low",reason:"none"});pC.debugLabel=gt("cpu-load");var gC=st(null);gC.debugLabel=gt("input-settings");var mC=st({hidden:0,present:0});mC.debugLabel=gt("participant-counts");var vC=wc(function(n){var e=st({},function(r,a,l){a(vC(n),l)});return e.debugLabel=gt("participant-receive-settings-".concat(n)),e}),yC=st(null);yC.debugLabel=gt("send-settings");/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _C=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),wC=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,a)=>a?a.toUpperCase():r.toLowerCase()),Qy=n=>{const e=wC(n);return e.charAt(0).toUpperCase()+e.slice(1)},Ky=(...n)=>n.filter((e,r,a)=>!!e&&e.trim()!==""&&a.indexOf(e)===r).join(" ").trim(),bC=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var SC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kC=U.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:l="",children:f,iconNode:h,...y},v)=>U.createElement("svg",{ref:v,...SC,width:e,height:e,stroke:n,strokeWidth:a?Number(r)*24/Number(e):r,className:Ky("lucide",l),...!f&&!bC(y)&&{"aria-hidden":"true"},...y},[...h.map(([b,C])=>U.createElement(b,C)),...Array.isArray(f)?f:[f]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wr=(n,e)=>{const r=U.forwardRef(({className:a,...l},f)=>U.createElement(kC,{ref:f,iconNode:e,className:Ky(`lucide-${_C(Qy(n))}`,`lucide-${n}`,a),...l}));return r.displayName=Qy(n),r};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CC=Wr("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Yy=Wr("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const EC=Wr("mic-off",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MC=Wr("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xy=Wr("phone-off",[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zy=Wr("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const TC=Wr("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e_=Wr("user-round",[["circle",{cx:"12",cy:"8",r:"5",key:"1hypcn"}],["path",{d:"M20 21a8 8 0 0 0-16 0",key:"rfgkzh"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OC=Wr("video-off",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t_=Wr("video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RC=Wr("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function AC({currentFields:n,onJoined:e,onAcceptCall:r,onInviteInfo:a,renderVideoFrame:l,isConnecting:f,onVideoControls:h,claimedUserName:y,claimedUserImage:v}){const[b,C]=U.useState(!1),[T,L]=U.useState(n.joined||!1),[A,P]=U.useState(window.__embedDeclined||!1),R=gi(),N=!!n.dailyRoomId&&!n.sessionEndedAt,V=!!n.joined,G=f&&!N;U.useEffect(()=>{if(N&&n.dailyRoomId&&R){const Te=`https://n2o.daily.co/${n.dailyRoomId}`,ke=ve=>{ve.participant.local&&(ve.track.kind==="video"?C(!0):ve.track.kind==="audio"&&L(!0))},J=ve=>{ve.participant.local&&(ve.track.kind==="video"?C(!1):ve.track.kind==="audio"&&L(!1))},De=ve=>{if(ve.participant.local){const ge=ve.participant;C(!!ge.videoTrack),L(!!ge.audioTrack)}};R.on("track-started",ke),R.on("track-stopped",J),R.on("participant-joined",De);const et=()=>{try{const ge=R.participants()?.local;ge?(C(!!ge.videoTrack),L(!!ge.audioTrack)):(C(!1),L(!1))}catch{C(!1),L(!1)}};return R.join({url:Te,startVideoOff:!0,startAudioOff:!0}).then(()=>{et()}).catch(ve=>{console.error("Visitor: Failed to join room:",ve),C(!1),L(!1)}),()=>{try{R.off("track-started",ke),R.off("track-stopped",J),R.off("participant-joined",De)}catch{}}}else if(!N&&R){C(!1),L(!1);try{R.leave()}catch{}}else N||(C(!1),L(!1))},[N,n.dailyRoomId,R]),U.useEffect(()=>{if(n.sessionEndedAt&&R){console.log("Visit completed, cleaning up camera/microphone");try{const Te=R.participants()?.local;Te&&(Te.videoTrack&&typeof Te.videoTrack.stop=="function"&&Te.videoTrack.stop(),Te.audioTrack&&typeof Te.audioTrack.stop=="function"&&Te.audioTrack.stop())}catch(Te){console.error("Error stopping local tracks:",Te)}try{R.setLocalAudio(!1),R.setLocalVideo(!1)}catch(Te){console.error("Error stopping tracks via Daily API:",Te)}try{R.leave()}catch(Te){console.error("Error leaving room:",Te)}C(!1),L(!1)}},[n.sessionEndedAt,R]),U.useEffect(()=>{if(n.joined&&R&&N)try{R.setLocalAudio(!0)}catch(Te){console.error("Failed to enable local audio:",Te)}},[n.joined,R,N]);const X=async()=>{if(!(!R||!N))try{!T?((await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(J=>J.stop()),R.setLocalAudio(!0),n.joined||e()):R.setLocalAudio(!1)}catch(Te){console.error("Microphone permission denied:",Te)}},x=async()=>{if(!(!R||!N))try{const Te=!b;Te&&(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(J=>J.stop()),R.setLocalVideo(Te)}catch(Te){console.error("Camera permission denied:",Te)}};U.useEffect(()=>{N||P(!1)},[N]),U.useEffect(()=>{V&&P(!1)},[V]);const $=N&&!V&&!A,q=()=>{window.__embedDeclined=!1,window.dispatchEvent(new CustomEvent("embed-declined",{detail:{declined:!1}})),P(!1),r()},re=()=>{window.__embedDeclined=!0,window.dispatchEvent(new CustomEvent("embed-declined",{detail:{declined:!0}})),P(!0)};U.useEffect(()=>{a&&a($?{showInvite:!0,onAccept:q,onDecline:re}:null)},[$,a]),U.useEffect(()=>{if(!h)return;h(N&&V&&!!R?{isVideoEnabled:b,isMicEnabled:T,onToggleMic:X,onToggleVideo:x}:null)},[N,V,b,T,R,X,x,h]);const me=N||G||$,ae=y||n.claimedUserName||null,we=v||n.claimedUserImage||null,S=me?le.jsx(PC,{isVideoEnabled:b,isMicEnabled:T,onToggleMic:X,onToggleVideo:x,joined:V,showInvite:$,onAccept:q,onDecline:re,noBorderRadius:!!l,isConnecting:G,claimedUserName:ae,claimedUserImage:we}):null;return U.useEffect(()=>{l&&l(S)},[S,l]),l?null:S}function PC({isVideoEnabled:n,isMicEnabled:e,onToggleMic:r,onToggleVideo:a,joined:l,showInvite:f,onAccept:h,onDecline:y,noBorderRadius:v,isConnecting:b,claimedUserName:C,claimedUserImage:T}){const L=U.useRef(null),A=U.useRef(null),P=U.useRef(null),[R,N]=U.useState(null),[V,G]=U.useState(window.__embedDeclined||!1),[X,x]=U.useState(!1),$=gi();return U.useEffect(()=>{if(!T){x(!1);return}let q=!1;x(!1);const re=new Image;return re.onload=()=>{q||x(!0)},re.onerror=()=>{q||x(!1)},re.src=T,()=>{q=!0}},[T]),U.useEffect(()=>{if(!$)return;const q=we=>{if(we.participant.local)we.participant.videoTrack&&A.current&&(A.current.srcObject=new MediaStream([we.participant.videoTrack]),A.current.muted=!0,A.current.playsInline=!0,A.current.play().catch(()=>{}));else{const S=we.participant.user_name||we.participant.userName||we.participant.name||null;S&&N(S),we.participant.videoTrack&&L.current&&(L.current.srcObject=new MediaStream([we.participant.videoTrack]),L.current.muted=!0,L.current.playsInline=!0,L.current.play().catch(()=>{})),we.participant.audioTrack&&P.current&&(P.current.srcObject=new MediaStream([we.participant.audioTrack]),P.current.muted=!l,l&&P.current.play().catch(()=>{}))}},re=we=>{if(!we.participant.local){const S=we.participant.user_name||we.participant.userName||we.participant.name||null;S&&N(S)}},me=we=>{we.participant.local&&we.track.kind==="video"&&A.current&&(A.current.srcObject=new MediaStream([we.track]),A.current.muted=!0,A.current.playsInline=!0,A.current.play().catch(()=>{})),!we.participant.local&&we.track.kind==="video"&&L.current&&(L.current.srcObject=new MediaStream([we.track]),L.current.muted=!0,L.current.playsInline=!0,L.current.play().catch(()=>{})),!we.participant.local&&we.track.kind==="audio"&&P.current&&(P.current.srcObject=new MediaStream([we.track]),P.current.muted=!l,l&&P.current.play().catch(()=>{}))},ae=we=>{we.participant.local&&we.track.kind==="video"&&A.current&&(A.current.srcObject=null),!we.participant.local&&we.track.kind==="video"&&L.current&&(L.current.srcObject=null),!we.participant.local&&we.track.kind==="audio"&&P.current&&(P.current.srcObject=null)};return $.on("participant-joined",q),$.on("track-started",me),$.on("track-stopped",ae),$.on("participant-updated",re),()=>{$.off("participant-joined",q),$.off("track-started",me),$.off("track-stopped",ae),$.off("participant-updated",re)}},[$,l]),U.useEffect(()=>{const q=re=>{re?.detail&&typeof re.detail.declined=="boolean"?G(re.detail.declined):G(!0)};return window.addEventListener("embed-declined",q),()=>window.removeEventListener("embed-declined",q)},[]),U.useEffect(()=>{P.current&&(P.current.muted=!l,l&&P.current.play().catch(()=>{}))},[l]),U.useEffect(()=>{if(!(!$||!n||!A.current))try{const re=$.participants()?.local?.videoTrack;re&&(A.current.srcObject=new MediaStream([re]),A.current.muted=!0,A.current.playsInline=!0,A.current.play().catch(()=>{}))}catch{}},[$,n]),V?null:le.jsxs("div",{style:{width:"100%",height:"192px",minHeight:"192px",maxHeight:"192px",background:"linear-gradient(to bottom, hsl(var(--special)), hsl(var(--special) / 0.7))",borderRadius:v?0:"24px",border:v?"none":"1px solid hsl(var(--border) / 0.4)",overflow:"hidden",boxShadow:v?"none":"0 18px 36px hsl(var(--foreground) / 0.12), 0 6px 16px hsl(var(--foreground) / 0.08)",position:"relative",flexShrink:0,flexGrow:0,zIndex:1},children:[!b&&le.jsx("video",{ref:L,autoPlay:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}),b&&le.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"hsl(var(--foreground))"},children:[le.jsxs("div",{className:"pulse-wrapper",children:[le.jsx("div",{className:"ring ring1"}),le.jsx("div",{className:"ring ring2"}),le.jsx("div",{style:{width:"64px",height:"64px",borderRadius:"50%",overflow:"hidden",flexShrink:0,boxShadow:"0 4px 12px hsl(var(--foreground) / 0.15)",backgroundColor:"hsl(var(--muted))",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:T&&X?le.jsx("img",{src:T,alt:C||"Avatar",style:{width:"100%",height:"100%",objectFit:"cover"}}):le.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"24px",fontWeight:600,color:"hsl(var(--muted-foreground))",backgroundColor:"hsl(var(--muted))"},children:C?C.charAt(0).toUpperCase():le.jsx(e_,{size:32})})})]}),le.jsxs("div",{style:{fontSize:"14px",fontWeight:500},children:["Connecting to ",C||"an agent"]}),le.jsx("style",{children:`
                  .pulse-wrapper {
                    position: relative;
                    width: 96px;
                    height: 96px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                  }
                  .pulse-wrapper .ring {
                    position: absolute;
                    width: 64px;
                    height: 64px;
                    border-radius: 50%;
                    border: 2px solid hsl(var(--foreground) / 0.25);
                    animation: ringPulse 1.8s ease-out infinite;
                  }
                  .pulse-wrapper .ring2 { animation-delay: 0.9s; }
                  @keyframes ringPulse {
                    0% { transform: scale(1); opacity: 0.6; }
                    70% { transform: scale(1.8); opacity: 0; }
                    100% { opacity: 0; }
                  }
                `})]}),!l&&!V&&!b&&le.jsx("div",{style:{position:"absolute",bottom:0,left:0,right:0,padding:"12px 16px 36px 16px",background:"linear-gradient(to bottom, hsl(var(--background) / 0.5), hsl(var(--background)))",borderTopLeftRadius:"24px",borderTopRightRadius:"24px",color:"hsl(var(--foreground))",fontSize:"13px",fontWeight:600,display:"flex",alignItems:"center",zIndex:10002,backdropFilter:"blur(8px)",WebkitBackdropFilter:"blur(8px)"},children:le.jsxs("span",{style:{fontWeight:700},children:[R||"Someone"," is calling you..."]})}),le.jsx("audio",{ref:P,autoPlay:!0,controls:!1,style:{display:"none"}}),n&&le.jsx("video",{ref:A,autoPlay:!0,muted:!0,style:{position:"absolute",top:"10px",right:"10px",width:"80px",height:"60px",objectFit:"cover",borderRadius:"8px",border:"1px solid hsl(var(--border) / 0.3)",zIndex:10001}})]})}var $u={exports:{}};/*@license Copyright 2015-2022 Ably Real-time Ltd (ably.com)

	Ably JavaScript Library v2.14.0
	https://github.com/ably/ably-js

	Released under the Apache Licence v2.0*/var IC=$u.exports,n_;function xC(){return n_||(n_=1,(function(n,e){(function(r,a){n.exports=a()})(IC,()=>{var r={},a={exports:r},l=Object.defineProperty,f=Object.defineProperties,h=Object.getOwnPropertyDescriptor,y=Object.getOwnPropertyDescriptors,v=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,C=Object.prototype.hasOwnProperty,T=Object.prototype.propertyIsEnumerable,L=(s,o,u)=>o in s?l(s,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[o]=u,A=(s,o)=>{for(var u in o||(o={}))C.call(o,u)&&L(s,u,o[u]);if(b)for(var u of b(o))T.call(o,u)&&L(s,u,o[u]);return s},P=(s,o)=>f(s,y(o)),R=(s,o)=>{var u={};for(var p in s)C.call(s,p)&&o.indexOf(p)<0&&(u[p]=s[p]);if(s!=null&&b)for(var p of b(s))o.indexOf(p)<0&&T.call(s,p)&&(u[p]=s[p]);return u},N=(s,o)=>{for(var u in o)l(s,u,{get:o[u],enumerable:!0})},V=(s,o,u,p)=>{if(o&&typeof o=="object"||typeof o=="function")for(let _ of v(o))!C.call(s,_)&&_!==u&&l(s,_,{get:()=>o[_],enumerable:!(p=h(o,_))||p.enumerable});return s},G=s=>V(l({},"__esModule",{value:!0}),s),X={};N(X,{ErrorInfo:()=>J,Realtime:()=>bl,Rest:()=>fl,default:()=>Pl,makeProtocolMessageFromDeserialized:()=>al,msgpack:()=>aa}),a.exports=G(X);var x=class{},$=typeof ds<"u"?ds:typeof window<"u"?window:self;function q(s,o){return`${s}`.padStart(o?3:2,"0")}function re(s){return x.Config.logTimestamps?function(o){const u=new Date;s(q(u.getHours())+":"+q(u.getMinutes())+":"+q(u.getSeconds())+"."+q(u.getMilliseconds(),1)+" "+o)}:function(o){s(o)}}var me=()=>{var s;let o,u;return typeof((s=$?.console)==null?void 0:s.log)=="function"?(o=function(...p){console.log.apply(console,p)},u=console.warn?function(...p){console.warn.apply(console,p)}:o):o=u=function(){},[o,u].map(re)},ae=class Vl{constructor(){this.deprecated=(o,u)=>{this.deprecationWarning(`${o} is deprecated and will be removed in a future version. ${u}`)},this.shouldLog=o=>o<=this.logLevel,this.setLog=(o,u)=>{o!==void 0&&(this.logLevel=o),u!==void 0&&(this.logHandler=this.logErrorHandler=u)},this.logLevel=Vl.defaultLogLevel,this.logHandler=Vl.defaultLogHandler,this.logErrorHandler=Vl.defaultLogErrorHandler}static initLogHandlers(){const[o,u]=me();this.defaultLogHandler=o,this.defaultLogErrorHandler=u,this.defaultLogger=new Vl}static logActionNoStrip(o,u,p,_){o.logAction(u,p,_)}logAction(o,u,p){this.shouldLog(o)&&(o===1?this.logErrorHandler:this.logHandler)("Ably: "+u+": "+p,o)}renamedClientOption(o,u){this.deprecationWarning(`The \`${o}\` client option has been renamed to \`${u}\`. Please update your code to use \`${u}\` instead. \`${o}\` will be removed in a future version.`)}renamedMethod(o,u,p){this.deprecationWarning(`\`${o}\`s \`${u}\` method has been renamed to \`${p}\`. Please update your code to use \`${p}\` instead. \`${u}\` will be removed in a future version.`)}deprecationWarning(o){this.shouldLog(1)&&this.logErrorHandler(`Ably: Deprecation warning - ${o}`,1)}};ae.defaultLogLevel=1,ae.LOG_NONE=0,ae.LOG_ERROR=1,ae.LOG_MAJOR=2,ae.LOG_MINOR=3,ae.LOG_MICRO=4,ae.logAction=(s,o,u,p)=>{ae.logActionNoStrip(s,o,u,p)};var we=ae,S=we,Te={};N(Te,{Format:()=>jn,allSame:()=>Sn,allToLowerCase:()=>Qr,allToUpperCase:()=>yi,arrChooseN:()=>Hi,arrDeleteValue:()=>pe,arrEquals:()=>wi,arrIntersect:()=>K,arrIntersectOb:()=>se,arrPopRandomElement:()=>mt,arrWithoutValue:()=>Re,cheapRandStr:()=>Jt,containsValue:()=>D,copy:()=>ge,createMissingPluginError:()=>Or,dataSizeBytes:()=>Kn,decodeBody:()=>Dt,encodeBody:()=>ln,ensureArray:()=>Oe,forInOwnNonNullProperties:()=>zt,getBackoffCoefficient:()=>Ia,getGlobalObject:()=>jo,getJitterCoefficient:()=>Lo,getRetryTime:()=>Gi,inherits:()=>E,inspectBody:()=>Nn,inspectError:()=>Ze,intersect:()=>z,isEmpty:()=>Q,isErrorInfoOrPartialErrorInfo:()=>Vt,isNil:()=>ue,isObject:()=>oe,keysArray:()=>$e,matchDerivedChannel:()=>_i,mixin:()=>ve,parseQueryString:()=>en,prototypicalClone:()=>M,randomString:()=>Tr,shallowClone:()=>g,shallowEquals:()=>ks,throwMissingPluginError:()=>bt,toBase64:()=>Yn,toQueryString:()=>At,valuesArray:()=>Xe,whenPromiseSettles:()=>Nt,withTimeoutAsync:()=>Dn});function ke(s){let o="["+s.constructor.name;return s.message&&(o+=": "+s.message),s.statusCode&&(o+="; statusCode="+s.statusCode),s.code&&(o+="; code="+s.code),s.cause&&(o+="; cause="+Ze(s.cause)),s.href&&!(s.message&&s.message.indexOf("help.ably.io")>-1)&&(o+="; see "+s.href+" "),o+="]",o}var J=class pg extends Error{constructor(o,u,p,_){super(o),typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(this,pg.prototype),this.code=u,this.statusCode=p,this.cause=_}toString(){return ke(this)}static fromValues(o){const{message:u,code:p,statusCode:_}=o;if(typeof u!="string"||typeof p!="number"||typeof _!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+x.Config.inspect(o));const k=Object.assign(new pg(u,p,_),o);return k.code&&!k.href&&(k.href="https://help.ably.io/error/"+k.code),k}},De=class gg extends Error{constructor(o,u,p,_){super(o),typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(this,gg.prototype),this.code=u,this.statusCode=p,this.cause=_}toString(){return ke(this)}static fromValues(o){const{message:u,code:p,statusCode:_}=o;if(typeof u!="string"||!ue(p)&&typeof p!="number"||!ue(_)&&typeof _!="number")throw new Error("PartialErrorInfo.fromValues(): invalid values: "+x.Config.inspect(o));const k=Object.assign(new gg(u,p,_),o);return k.code&&!k.href&&(k.href="https://help.ably.io/error/"+k.code),k}};function et(s){return Math.floor(Math.random()*s.length)}function ve(s,...o){for(let u=0;u<o.length;u++){const p=o[u];if(!p)break;for(const _ in p)Object.prototype.hasOwnProperty.call(p,_)&&(s[_]=p[_])}return s}function ge(s){return ve({},s)}function Oe(s){return ue(s)?[]:Array.isArray(s)?s:[s]}function oe(s){return Object.prototype.toString.call(s)=="[object Object]"}function Q(s){for(const o in s)return!1;return!0}function ue(s){return s==null}function g(s){const o=new Object;for(const u in s)o[u]=s[u];return o}function M(s,o){class u{}u.prototype=s;const p=new u;return o&&ve(p,o),p}var E=function(s,o){if(x.Config.inherits){x.Config.inherits(s,o);return}s.super_=o,s.prototype=M(o.prototype,{constructor:s})};function D(s,o){for(const u in s)if(s[u]==o)return!0;return!1}function z(s,o){return Array.isArray(o)?K(s,o):se(s,o)}function K(s,o){const u=[];for(let p=0;p<s.length;p++){const _=s[p];o.indexOf(_)!=-1&&u.push(_)}return u}function se(s,o){const u=[];for(let p=0;p<s.length;p++){const _=s[p];_ in o&&u.push(_)}return u}function pe(s,o){const u=s.indexOf(o),p=u!=-1;return p&&s.splice(u,1),p}function Re(s,o){const u=s.slice();return pe(u,o),u}function $e(s,o){const u=[];for(const p in s)o&&!Object.prototype.hasOwnProperty.call(s,p)||u.push(p);return u}function Xe(s,o){const u=[];for(const p in s)o&&!Object.prototype.hasOwnProperty.call(s,p)||u.push(s[p]);return u}function zt(s,o){for(const u in s)Object.prototype.hasOwnProperty.call(s,u)&&s[u]&&o(u)}function Sn(s,o){if(s.length===0)return!0;const u=s[0][o];return s.every(function(p){return p[o]===u})}var jn=(s=>(s.msgpack="msgpack",s.json="json",s))(jn||{});function mt(s){return s.splice(et(s),1)[0]}function At(s){const o=[];if(s)for(const u in s)o.push(encodeURIComponent(u)+"="+encodeURIComponent(s[u]));return o.length?"?"+o.join("&"):""}function en(s){let o;const u=/([^?&=]+)=?([^&]*)/g,p={};for(;o=u.exec(s);)p[decodeURIComponent(o[1])]=decodeURIComponent(o[2]);return p}function Vt(s){return typeof s=="object"&&s!==null&&(s instanceof J||s instanceof De)}function Ze(s){var o,u;return s instanceof Error||((o=s?.constructor)==null?void 0:o.name)==="ErrorInfo"||((u=s?.constructor)==null?void 0:u.name)==="PartialErrorInfo"?s.toString():x.Config.inspect(s)}function Nn(s){return x.BufferUtils.isBuffer(s)?s.toString():typeof s=="string"?s:x.Config.inspect(s)}function Kn(s){if(x.BufferUtils.isBuffer(s))return x.BufferUtils.byteLength(s);if(typeof s=="string")return x.Config.stringByteSize(s);if(typeof s=="number")return 8;if(typeof s=="boolean")return 1;throw new Error(`Expected input of Utils.dataSizeBytes to be a string, a number, a boolean or a buffer, but was: ${typeof s}`)}function Jt(){return String(Math.random()).substr(2)}var Tr=async s=>{const o=await x.Config.getRandomArrayBuffer(s);return x.BufferUtils.base64Encode(o)};function Hi(s,o){const u=Math.min(o,s.length),p=s.slice(),_=[];for(let k=0;k<u;k++)_.push(mt(p));return _}function Nt(s,o){s.then(u=>{o?.(null,u)}).catch(u=>{o?.(u)})}function Dt(s,o,u){return u=="msgpack"?(o||bt("MsgPack"),o.decode(s)):JSON.parse(String(s))}function ln(s,o,u){return u=="msgpack"?(o||bt("MsgPack"),o.encode(s,!0)):JSON.stringify(s)}function Qr(s){return s.map(function(o){return o&&o.toLowerCase()})}function yi(s){return s.map(function(o){return o&&o.toUpperCase()})}function Ia(s){return Math.min((s+2)/3,2)}function Lo(){return 1-Math.random()*.2}function Gi(s,o){return s*Ia(o)*Lo()}function jo(){return typeof ds<"u"?ds:typeof window<"u"?window:self}function ks(s,o){return Object.keys(s).every(u=>s[u]===o[u])&&Object.keys(o).every(u=>o[u]===s[u])}function _i(s){const o=/^(\[([^?]*)(?:(.*))\])?(.+)$/,u=s.match(o);if(!u||!u.length||u.length<5)throw new J("regex match failed",400,40010);if(u[2])throw new J(`cannot use a derived option with a ${u[2]} channel`,400,40010);return{qualifierParam:u[3]||"",channelName:u[4]}}function Yn(s){const o=x.BufferUtils,u=o.utf8Encode(s);return o.base64Encode(u)}function wi(s,o){return s.length===o.length&&s.every(function(u,p){return u===o[p]})}function Or(s){return new J(`${s} plugin not provided`,40019,400)}function bt(s){throw Or(s)}async function Dn(s,o=5e3,u="Timeout expired"){const p=new J(u,5e4,500);return Promise.race([s,new Promise((_,k)=>setTimeout(()=>k(p),o))])}var No="2.14.0",xa="ably-js/"+No,kn={ENDPOINT:"main",ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["main.a.fallback.ably-realtime.com","main.b.fallback.ably-realtime.com","main.c.fallback.ably-realtime.com","main.d.fallback.ably-realtime.com","main.e.fallback.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:1e4,httpMaxRetryDuration:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,webSocketConnectTimeout:1e4,webSocketSlowTimeout:4e3},httpMaxRetryCount:3,maxMessageSize:65536,version:No,protocolVersion:4,agent:xa,getPort:La,getHttpScheme:ja,getPrimaryDomainFromEndpoint:Cs,getEndpointFallbackHosts:Cn,getFallbackHosts:bi,getHosts:zc,checkHost:Si,objectifyOptions:Do,normaliseOptions:$c,defaultGetHeaders:Na,defaultPostHeaders:qc};function La(s,o){return o||s.tls?s.tlsPort:s.port}function ja(s){return s.tls?"https://":"http://"}function Ji(s){return s.includes(".")||s.includes("::")||s==="localhost"}function Cs(s){return Ji(s)?s:s.startsWith("nonprod:")?`${s.replace("nonprod:","")}.realtime.ably-nonprod.net`:`${s}.realtime.ably.net`}function Cn(s){if(Ji(s))return[];if(s.startsWith("nonprod:")){const o=s.replace("nonprod:","");return Es(o,"ably-realtime-nonprod.com")}return Es(s,"ably-realtime.com")}function Es(s,o){return["a","b","c","d","e"].map(u=>`${s}.${u}.fallback.${o}`)}function bi(s){const o=s.fallbackHosts,u=typeof s.httpMaxRetryCount<"u"?s.httpMaxRetryCount:kn.httpMaxRetryCount;return o?Hi(o,u):[]}function zc(s){return[s.primaryDomain].concat(bi(s))}function Si(s){if(typeof s!="string")throw new J("host must be a string; was a "+typeof s,4e4,400);if(!s.length)throw new J("host must not be zero-length",4e4,400)}function Ms(s){const o={};for(const u in kn.TIMEOUTS)o[u]=s[u]||kn.TIMEOUTS[u];return o}function tn(s){let o=kn.agent;if(s.agents)for(var u in s.agents)o+=" "+u+"/"+s.agents[u];return o}function Do(s,o,u,p,_){if(s===void 0){const I=o?`${u} must be initialized with either a client options object, an Ably API key, or an Ably Token`:`${u} must be initialized with a client options object`;throw S.logAction(p,S.LOG_ERROR,`${u}()`,I),new Error(I)}let k;if(typeof s=="string")if(s.indexOf(":")==-1){if(!o){const I=`${u} cannot be initialized with just an Ably Token; you must provide a client options object with a \`plugins\` property. (Set this Ably Token as the objects \`token\` property.)`;throw S.logAction(p,S.LOG_ERROR,`${u}()`,I),new Error(I)}k={token:s}}else{if(!o){const I=`${u} cannot be initialized with just an Ably API key; you must provide a client options object with a \`plugins\` property. (Set this Ably API key as the objects \`key\` property.)`;throw S.logAction(p,S.LOG_ERROR,`${u}()`,I),new Error(I)}k={key:s}}else k=s;return _&&(k=P(A({},k),{plugins:A(A({},_),k.plugins)})),k}function Vc(s){if(s.endpoint&&(s.environment||s.restHost||s.realtimeHost))throw new J("The `endpoint` option cannot be used in conjunction with the `environment`, `restHost`, or `realtimeHost` options.",40106,400);if(s.environment&&(s.restHost||s.realtimeHost))throw new J("The `environment` option cannot be used in conjunction with the `restHost`, or `realtimeHost` options.",40106,400)}function $c(s,o,u){const p=u??S.defaultLogger;s.environment&&p.deprecated("The `environment` client option","Use the `endpoint` client option instead."),s.restHost&&p.deprecated("The `restHost` client option","Use the `endpoint` client option instead."),s.realtimeHost&&p.deprecated("The `realtimeHost` client option","Use the `endpoint` client option instead."),Vc(s),typeof s.recover=="function"&&s.closeOnUnload===!0&&(S.logAction(p,S.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),s.recover=void 0),"closeOnUnload"in s||(s.closeOnUnload=!s.recover),"queueMessages"in s||(s.queueMessages=!0);const _=s.endpoint||kn.ENDPOINT;!s.fallbackHosts&&!s.restHost&&!s.realtimeHost&&!s.port&&!s.tlsPort&&(s.fallbackHosts=Cn(s.environment||_));const k=s.environment&&`${s.environment}.realtime.ably.net`,B=s.restHost||s.realtimeHost||k||Cs(_);(s.fallbackHosts||[]).concat(B).forEach(Si),s.port=s.port||kn.PORT,s.tlsPort=s.tlsPort||kn.TLS_PORT,"tls"in s||(s.tls=!0);const Z=Ms(s);o?"useBinaryProtocol"in s?s.useBinaryProtocol=x.Config.supportsBinary&&s.useBinaryProtocol:s.useBinaryProtocol=x.Config.preferBinary:s.useBinaryProtocol=!1;const Y={};s.clientId&&(Y["X-Ably-ClientId"]=x.BufferUtils.base64Encode(x.BufferUtils.utf8Encode(s.clientId))),"idempotentRestPublishing"in s||(s.idempotentRestPublishing=!0);let he=null,de=s.connectivityCheckUrl;if(s.connectivityCheckUrl){let[fe,Ae]=s.connectivityCheckUrl.split("?");he=Ae?en(Ae):{},fe.indexOf("://")===-1&&(fe="https://"+fe),de=fe}let Ee=s.wsConnectivityCheckUrl;return Ee&&Ee.indexOf("://")===-1&&(Ee="wss://"+Ee),P(A({},s),{primaryDomain:B,maxMessageSize:s.maxMessageSize||kn.maxMessageSize,timeouts:Z,connectivityCheckParams:he,connectivityCheckUrl:de,wsConnectivityCheckUrl:Ee,headers:Y})}function Ts(s,o,u){const p=u||{};if(p.cipher){s||bt("Crypto");const _=s.getCipher(p.cipher,o);p.cipher=_.cipherParams,p.channelCipher=_.cipher}else"cipher"in p&&(p.cipher=void 0,p.channelCipher=null);return p}var Rr={json:"application/json",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack",text:"text/plain"},Xn={format:"json",protocolVersion:kn.protocolVersion};function Na(s,{format:o=Xn.format,protocolVersion:u=Xn.protocolVersion}={}){return{accept:Rr[o],"X-Ably-Version":u.toString(),"Ably-Agent":tn(s)}}function qc(s,{format:o=Xn.format,protocolVersion:u=Xn.protocolVersion}={}){let p;return{accept:p=Rr[o],"content-type":p,"X-Ably-Version":u.toString(),"Ably-Agent":tn(s)}}var qe=kn;function Da(s){return Object.assign(kn,s)}var Ua=class Z0{constructor(o,u){this.logger=o,this.members=u||[]}call(o,u){for(const p of this.members)if(p)try{p(o,u)}catch(_){S.logAction(this.logger,S.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+_+"; stack = "+_.stack)}}push(...o){this.members.push(...o)}createPromise(){return new Promise((o,u)=>{this.push((p,_)=>{p?u(p):o(_)})})}resolveAll(o){this.call(null,o)}rejectAll(o){this.call(o)}static create(o,u){const p=new Z0(o,u);return Object.assign((_,k)=>p.call(_,k),{push:_=>p.push(_),createPromise:()=>p.createPromise(),resolveAll:_=>p.resolveAll(_),rejectAll:_=>p.rejectAll(_)})}},pr=Ua,Ba=(s=>(s.Get="get",s.Delete="delete",s.Post="post",s.Put="put",s.Patch="patch",s))(Ba||{}),Tt=Ba,Et=(s=>(s[s.Success=200]="Success",s[s.NoContent=204]="NoContent",s[s.BadRequest=400]="BadRequest",s[s.Unauthorized=401]="Unauthorized",s[s.Forbidden=403]="Forbidden",s[s.RequestTimeout=408]="RequestTimeout",s[s.InternalServerError=500]="InternalServerError",s))(Et||{});function Wc(s){return s>=200&&s<400}var ki=Et,Os=Math.pow(2,17);function Qi(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function Rs(s){return!!s.connection}function Uo(s){return Vt(s)?(s.code||(s.statusCode===403?s.code=40300:(s.code=40170,s.statusCode=401)),s):new J(Ze(s),s.code||40170,s.statusCode||401)}var Ci=(s,o)=>{const u=x.BufferUtils,p=u.utf8Encode(s),_=u.utf8Encode(o),k=u.hmacSha256(p,_);return u.base64Encode(k)};function Un(s){if(!s)return"";typeof s=="string"&&(s=JSON.parse(s));const o=Object.create(null),u=$e(s,!0);if(!u)return"";u.sort();for(let p=0;p<u.length;p++)o[u[p]]=s[u[p]].sort();return JSON.stringify(o)}function Fa(s,o){if(s.authCallback)S.logAction(o,S.LOG_MINOR,"Auth()","using token auth with authCallback");else if(s.authUrl)S.logAction(o,S.LOG_MINOR,"Auth()","using token auth with authUrl");else if(s.key)S.logAction(o,S.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(s.tokenDetails)S.logAction(o,S.LOG_MINOR,"Auth()","using token auth with supplied token only");else{const u="authOptions must include valid authentication parameters";throw S.logAction(o,S.LOG_ERROR,"Auth()",u),new Error(u)}}function Bn(s){return"useTokenAuth"in s&&!s.useTokenAuth}function za(s){return s.useTokenAuth||!Bn(s)&&(s.authCallback||s.authUrl||s.token||s.tokenDetails)}function Hc(s){return!s.key&&!s.authCallback&&!s.authUrl}var Gc=0;function Ei(){return Gc++}var As=class{constructor(s,o){if(this.authOptions={},this.client=s,this.tokenParams=o.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,za(o))Hc(o)&&S.logAction(this.logger,S.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(o.defaultTokenParams,o),Fa(this.authOptions,this.logger);else{if(!o.key){const u="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw S.logAction(this.logger,S.LOG_ERROR,"Auth()",u),new J(u,40160,401)}S.logAction(this.logger,S.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(o)}}get logger(){return this.client.logger}async authorize(s,o){if(o&&o.key&&this.authOptions.key!==o.key)throw new J("Unable to update auth options with incompatible key",40102,401);try{let u=await this._forceNewToken(s??null,o??null);return Rs(this.client)?new Promise((p,_)=>{this.client.connection.connectionManager.onAuthUpdated(u,(k,I)=>k?_(k):p(I))}):u}catch(u){throw this.client.connection&&u.statusCode===ki.Forbidden&&this.client.connection.connectionManager.actOnErrorFromAuthorize(u),u}}async _forceNewToken(s,o){this.tokenDetails=null,this._saveTokenOptions(s,o),Fa(this.authOptions,this.logger);try{return this._ensureValidAuthCredentials(!0)}finally{delete this.tokenParams.timestamp,delete this.authOptions.queryTime}}async requestToken(s,o){const u=o||this.authOptions,p=s||ge(this.tokenParams);let _,k=this.client;if(u.authCallback)S.logAction(this.logger,S.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),_=u.authCallback;else if(u.authUrl)S.logAction(this.logger,S.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),_=(B,Z)=>{const Y=ve({accept:"application/json, text/plain"},u.authHeaders),he=u.authMethod&&u.authMethod.toLowerCase()==="post";let de;const Ee=u.authUrl.indexOf("?");Ee>-1&&(de=en(u.authUrl.slice(Ee)),u.authUrl=u.authUrl.slice(0,Ee),he||(u.authParams=ve(de,u.authParams)));const fe=ve({},u.authParams||{},B),Ae=Pe=>{var Fe,lt;let ft=(Fe=Pe.body)!=null?Fe:null,We=null;if(Pe.error)S.logAction(this.logger,S.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+Ze(Pe.error));else{const qt=(lt=Pe.headers["content-type"])!=null?lt:null;Array.isArray(qt)?We=qt.join(", "):We=qt,S.logAction(this.logger,S.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+We+"; body: "+Nn(ft))}if(Pe.error){Z(Pe.error,null);return}if(Pe.unpacked){Z(null,ft);return}if(x.BufferUtils.isBuffer(ft)&&(ft=ft.toString()),!We){Z(new J("authUrl response is missing a content-type header",40170,401),null);return}const He=We.indexOf("application/json")>-1,hn=We.indexOf("text/plain")>-1||We.indexOf("application/jwt")>-1;if(!He&&!hn){Z(new J("authUrl responded with unacceptable content-type "+We+", should be either text/plain, application/jwt or application/json",40170,401),null);return}if(He){if(ft.length>Os){Z(new J("authUrl response exceeded max permitted length",40170,401),null);return}try{ft=JSON.parse(ft)}catch(qt){Z(new J("Unexpected error processing authURL response; err = "+qt.message,40170,401),null);return}}Z(null,ft,We)};if(S.logAction(this.logger,S.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+u.authUrl+"; Params: "+JSON.stringify(fe)+"; method: "+(he?"POST":"GET")),he){const Pe=Y||{};Pe["content-type"]="application/x-www-form-urlencoded";const Fe=At(fe).slice(1);Nt(this.client.http.doUri(Tt.Post,u.authUrl,Pe,Fe,de),(lt,ft)=>Ae(lt||ft))}else Nt(this.client.http.doUri(Tt.Get,u.authUrl,Y||{},null,fe),(Pe,Fe)=>Ae(Pe||Fe))};else if(u.key)S.logAction(this.logger,S.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),_=(B,Z)=>{Nt(this.createTokenRequest(B,u),(Y,he)=>Z(Y,he??null))};else{const B="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";throw S.logAction(this.logger,S.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),new J(B,40171,403)}"capability"in p&&(p.capability=Un(p.capability));const I=(B,Z)=>{const Y=B.keyName,he="/keys/"+Y+"/requestToken",de=function(fe){return k.baseUri(fe)+he},Ee=qe.defaultPostHeaders(this.client.options);u.requestHeaders&&ve(Ee,u.requestHeaders),S.logAction(this.logger,S.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+he+"; Token params: "+JSON.stringify(B)),Nt(this.client.http.do(Tt.Post,de,Ee,JSON.stringify(B),null),(fe,Ae)=>fe?Z(fe):Z(Ae.error,Ae.body,Ae.unpacked))};return new Promise((B,Z)=>{let Y=!1,he=this.client.options.timeouts.realtimeRequestTimeout,de=setTimeout(()=>{Y=!0;const Ee="Token request callback timed out after "+he/1e3+" seconds";S.logAction(this.logger,S.LOG_ERROR,"Auth.requestToken()",Ee),Z(new J(Ee,40170,401))},he);_(p,(Ee,fe,Ae)=>{if(Y)return;if(clearTimeout(de),Ee){S.logAction(this.logger,S.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+Ze(Ee)),Z(Uo(Ee));return}if(typeof fe=="string"){fe.length===0?Z(new J("Token string is empty",40170,401)):fe.length>Os?Z(new J("Token string exceeded max permitted length (was "+fe.length+" bytes)",40170,401)):fe==="undefined"||fe==="null"?Z(new J("Token string was literal null/undefined",40170,401)):fe[0]==="{"&&!(Ae&&Ae.indexOf("application/jwt")>-1)?Z(new J("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):B({token:fe});return}if(typeof fe!="object"||fe===null){const Fe="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof fe;S.logAction(this.logger,S.LOG_ERROR,"Auth.requestToken()",Fe),Z(new J(Fe,40170,401));return}const Pe=JSON.stringify(fe).length;if(Pe>Os&&!u.suppressMaxLengthCheck){Z(new J("Token request/details object exceeded max permitted stringified size (was "+Pe+" bytes)",40170,401));return}if("issued"in fe){B(fe);return}if(!("keyName"in fe)){const Fe="Expected token request callback to call back with a token string, token request object, or token details object";S.logAction(this.logger,S.LOG_ERROR,"Auth.requestToken()",Fe),Z(new J(Fe,40170,401));return}I(fe,(Fe,lt,ft)=>{if(Fe){S.logAction(this.logger,S.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+Ze(Fe)),Z(Uo(Fe));return}ft||(lt=JSON.parse(lt)),S.logAction(this.logger,S.LOG_MINOR,"Auth.getToken()","token received"),B(lt)})})})}async createTokenRequest(s,o){o=o||this.authOptions,s=s||ge(this.tokenParams);const u=o.key;if(!u)throw new J("No key specified",40101,403);const p=u.split(":"),_=p[0],k=p[1];if(!k)throw new J("Invalid key specified",40101,403);if(s.clientId==="")throw new J("clientId cant be an empty string",40012,400);"capability"in s&&(s.capability=Un(s.capability));const I=ve({keyName:_},s),B=s.clientId||"",Z=s.ttl||"",Y=s.capability||"";I.timestamp||(I.timestamp=await this._getTimestamp(o&&o.queryTime));const he=I.nonce||(I.nonce=Qi()),de=I.timestamp,Ee=I.keyName+`
`+Z+`
`+Y+`
`+B+`
`+de+`
`+he+`
`;return I.mac=I.mac||Ci(Ee,k),S.logAction(this.logger,S.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),I}async getAuthParams(){if(this.method=="basic")return{key:this.key};{let s=await this._ensureValidAuthCredentials(!1);if(!s)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");return{access_token:s.token}}}async getAuthHeaders(){if(this.method=="basic")return{authorization:"Basic "+this.basicKey};{const s=await this._ensureValidAuthCredentials(!1);if(!s)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");return{authorization:"Bearer "+Yn(s.token)}}}_saveBasicOptions(s){this.method="basic",this.key=s.key,this.basicKey=Yn(s.key),this.authOptions=s||{},"clientId"in s&&this._userSetClientId(s.clientId)}_saveTokenOptions(s,o){this.method="token",s&&(this.tokenParams=s),o&&(o.token&&(o.tokenDetails=typeof o.token=="string"?{token:o.token}:o.token),o.tokenDetails&&(this.tokenDetails=o.tokenDetails),"clientId"in o&&this._userSetClientId(o.clientId),this.authOptions=o)}async _ensureValidAuthCredentials(s){const o=this.tokenDetails;if(o){if(this._tokenClientIdMismatch(o.clientId))throw new J("Mismatch between clientId in token ("+o.clientId+") and current clientId ("+this.clientId+")",40102,403);if(!this.client.isTimeOffsetSet()||!o.expires||o.expires>=this.client.getTimestampUsingOffset())return S.logAction(this.logger,S.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+o.expires),o;S.logAction(this.logger,S.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}const u=(this.waitingForTokenRequest||(this.waitingForTokenRequest=pr.create(this.logger))).createPromise();if(this.currentTokenRequestId!==null&&!s)return u;const p=this.currentTokenRequestId=Ei();let _,k=null;try{_=await this.requestToken(this.tokenParams,this.authOptions)}catch(B){k=B}if(this.currentTokenRequestId>p)return S.logAction(this.logger,S.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one"),u;this.currentTokenRequestId=null;const I=this.waitingForTokenRequest;return this.waitingForTokenRequest=null,k?(I?.rejectAll(k),u):(I?.resolveAll(this.tokenDetails=_),u)}_userSetClientId(s){if(typeof s=="string"||s===null){if(s==="*")throw new J('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);{const o=this._uncheckedSetClientId(s);if(o)throw o}}else throw new J("clientId must be either a string or null",40012,400)}_uncheckedSetClientId(s){if(this._tokenClientIdMismatch(s)){const o="Unexpected clientId mismatch: client has "+this.clientId+", requested "+s,u=new J(o,40102,401);return S.logAction(this.logger,S.LOG_ERROR,"Auth._uncheckedSetClientId()",o),u}else return this.clientId=this.tokenParams.clientId=s,null}_tokenClientIdMismatch(s){return!!(this.clientId&&this.clientId!=="*"&&s&&s!=="*"&&this.clientId!==s)}static isTokenErr(s){return s.code&&s.code>=40140&&s.code<40150}revokeTokens(s,o){return this.client.rest.revokeTokens(s,o)}async _getTimestamp(s){return this.client.getTimestamp(s||!!this.authOptions.queryTime)}},un=As;function Mi(s){const o=[];if(s)for(const u in s)o.push(u+"="+s[u]);return o.join("&")}function Ti(s,o){return s+(o?"?":"")+Mi(o)}function Jc(s,o,u,p,_){s.error?S.logActionNoStrip(_,S.LOG_MICRO,"Http."+o+"()","Received Error; "+Ti(u,p)+"; Error: "+Ze(s.error)):S.logActionNoStrip(_,S.LOG_MICRO,"Http."+o+"()","Received; "+Ti(u,p)+"; Headers: "+Mi(s.headers)+"; StatusCode: "+s.statusCode+"; Body"+(x.BufferUtils.isBuffer(s.body)?" (Base64): "+x.BufferUtils.base64Encode(s.body):": "+s.body))}function Bo(s,o,u,p,_){_.shouldLog(S.LOG_MICRO)&&S.logActionNoStrip(_,S.LOG_MICRO,"Http."+s+"()","Sending; "+Ti(o,p)+"; Body"+(x.BufferUtils.isBuffer(u)?" (Base64): "+x.BufferUtils.base64Encode(u):": "+u))}var Ps=class{constructor(s){this.client=s,this.platformHttp=new x.Http(s),this.checkConnectivity=this.platformHttp.checkConnectivity?()=>this.platformHttp.checkConnectivity():void 0}get logger(){var s,o;return(o=(s=this.client)==null?void 0:s.logger)!=null?o:S.defaultLogger}get supportsAuthHeaders(){return this.platformHttp.supportsAuthHeaders}get supportsLinkHeaders(){return this.platformHttp.supportsLinkHeaders}_getHosts(s){const o=s.connection,u=o&&o.connectionManager.host;return u?[u].concat(qe.getFallbackHosts(s.options)):qe.getHosts(s.options)}async do(s,o,u,p,_){try{const k=this.client;if(!k)return{error:new J("http.do called without client",5e4,500)};const I=typeof o=="function"?o:function(de){return k.baseUri(de)+o},B=k._currentFallback;if(B)if(B.validUntil>Date.now()){const de=await this.doUri(s,I(B.host),u,p,_);return de.error&&this.platformHttp.shouldFallback(de.error)?(k._currentFallback=null,this.do(s,o,u,p,_)):de}else k._currentFallback=null;const Z=this._getHosts(k);if(Z.length===1)return this.doUri(s,I(Z[0]),u,p,_);let Y=null;const he=async(de,Ee)=>{const fe=de.shift();Y=Y??new Date;const Ae=await this.doUri(s,I(fe),u,p,_);return Ae.error&&this.platformHttp.shouldFallback(Ae.error)&&de.length?Date.now()-Y.getTime()>k.options.timeouts.httpMaxRetryDuration?{error:new J(`Timeout for trying fallback hosts retries. Total elapsed time exceeded the ${k.options.timeouts.httpMaxRetryDuration}ms limit`,50003,500)}:he(de,!0):(Ee&&(k._currentFallback={host:fe,validUntil:Date.now()+k.options.timeouts.fallbackRetryTimeout}),Ae)};return he(Z)}catch(k){return{error:new J(`Unexpected error in Http.do: ${Ze(k)}`,500,5e4)}}}async doUri(s,o,u,p,_){try{Bo(s,o,p,_,this.logger);const k=await this.platformHttp.doUri(s,o,u,p,_);return this.logger.shouldLog(S.LOG_MICRO)&&Jc(k,s,o,_,this.logger),k}catch(k){return{error:new J(`Unexpected error in Http.doUri: ${Ze(k)}`,500,5e4)}}}};function Is(s,o,u,p){try{u.apply(o,p)}catch(_){S.logAction(s,S.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+_+"; stack = "+(_&&_.stack))}}function Kr(s,o,u){let p,_,k;for(let I=0;I<s.length;I++)if(p=s[I],u&&(p=p[u]),Array.isArray(p)){for(;(_=p.indexOf(o))!==-1;)p.splice(_,1);u&&p.length===0&&delete s[I][u]}else if(oe(p))for(k in p)Object.prototype.hasOwnProperty.call(p,k)&&Array.isArray(p[k])&&Kr([p],o,k)}var Qc=class{constructor(s){this.logger=s,this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}on(...s){if(s.length===1){const o=s[0];if(typeof o=="function")this.any.push(o);else throw new Error("EventListener.on(): Invalid arguments: "+x.Config.inspect(s))}if(s.length===2){const[o,u]=s;if(typeof u!="function")throw new Error("EventListener.on(): Invalid arguments: "+x.Config.inspect(s));if(ue(o))this.any.push(u);else if(Array.isArray(o))o.forEach(p=>{this.on(p,u)});else{if(typeof o!="string")throw new Error("EventListener.on(): Invalid arguments: "+x.Config.inspect(s));(this.events[o]||(this.events[o]=[])).push(u)}}}off(...s){if(s.length==0||ue(s[0])&&ue(s[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}const[o,u]=s;let p=null,_=null;if(s.length===1||!u)typeof o=="function"?p=o:_=o;else{if(typeof u!="function")throw new Error("EventEmitter.off(): invalid arguments:"+x.Config.inspect(s));[_,p]=[o,u]}if(p&&ue(_)){Kr([this.any,this.events,this.anyOnce,this.eventsOnce],p);return}if(Array.isArray(_)){_.forEach(k=>{this.off(k,p)});return}if(typeof _!="string")throw new Error("EventEmitter.off(): invalid arguments:"+x.Config.inspect(s));p?Kr([this.events,this.eventsOnce],p,_):(delete this.events[_],delete this.eventsOnce[_])}listeners(s){if(s){const o=this.events[s]||[];return this.eventsOnce[s]&&Array.prototype.push.apply(o,this.eventsOnce[s]),o.length?o:null}return this.any.length?this.any:null}emit(s,...o){const u={event:s},p=[];this.anyOnce.length&&(Array.prototype.push.apply(p,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(p,this.any);const _=this.eventsOnce[s];_&&(Array.prototype.push.apply(p,_),delete this.eventsOnce[s]);const k=this.events[s];k&&Array.prototype.push.apply(p,k),p.forEach(I=>{Is(this.logger,u,I,o)})}once(...s){const o=s.length;if(o===0||o===1&&typeof s[0]!="function"){const _=s[0];return new Promise(k=>{this.once(_,k)})}const[u,p]=s;if(s.length===1&&typeof u=="function")this.anyOnce.push(u);else if(ue(u)){if(typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+x.Config.inspect(s));this.anyOnce.push(p)}else if(Array.isArray(u)){const _=this,k=function(){const I=Array.prototype.slice.call(arguments);if(u.forEach(function(B){_.off(B,k)}),typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+x.Config.inspect(s));p.apply(this,I)};u.forEach(function(I){_.on(I,k)})}else{if(typeof u!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+x.Config.inspect(s));const _=this.eventsOnce[u]||(this.eventsOnce[u]=[]);if(p){if(typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+x.Config.inspect(s));_.push(p)}}}async whenState(s,o){if(typeof s!="string"||typeof o!="string")throw new Error("whenState requires a valid state String argument");return s===o?null:this.once(s)}},St=Qc,Ce={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18,OBJECT:19,OBJECT_SYNC:20,ANNOTATION:21},xs=[];Object.keys(Ce).forEach(function(s){xs[Ce[s]]=s});var Ot={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,HAS_OBJECTS:128,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19,ANNOTATION_PUBLISH:1<<21,ANNOTATION_SUBSCRIBE:1<<22,OBJECT_SUBSCRIBE:1<<24,OBJECT_PUBLISH:1<<25},Fo=Object.keys(Ot);Ot.MODE_ALL=Ot.PRESENCE|Ot.PUBLISH|Ot.SUBSCRIBE|Ot.PRESENCE_SUBSCRIBE|Ot.ANNOTATION_PUBLISH|Ot.ANNOTATION_SUBSCRIBE|Ot.OBJECT_SUBSCRIBE|Ot.OBJECT_PUBLISH;var zo=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE","ANNOTATION_PUBLISH","ANNOTATION_SUBSCRIBE","OBJECT_SUBSCRIBE","OBJECT_PUBLISH"];function Va(s){return!s||!s.channelOptions?{channelOptions:s,plugins:{},baseEncodedPreviousPayload:void 0}:s}function Vo(s,o,u){if(u&&u.cipher){s||bt("Crypto");const p=s.getCipher(u.cipher,o);return{cipher:p.cipherParams,channelCipher:p.cipher}}return u??{}}async function $o(s,o){const{data:u,encoding:p}=await Ki(s.data,s.encoding,o);return s.data=u,s.encoding=p,s}async function Ki(s,o,u){let p=u.channelCipher,_=s,k=o?o+"/":"";x.BufferUtils.isBuffer(_)||(_=x.BufferUtils.utf8Encode(String(_)),k=k+"utf-8/");const I=await p.encrypt(_);return k=k+"cipher+"+p.algorithm,{data:I,encoding:k}}async function Fn(s,o){const{data:u,encoding:p}=Qt(s.data,s.encoding);return s.data=u,s.encoding=p,o!=null&&o.cipher?$o(s,o):s}function Qt(s,o){if(typeof s=="string"||x.BufferUtils.isBuffer(s)||s===null||s===void 0)return{data:s,encoding:o};if(oe(s)||Array.isArray(s))return{data:JSON.stringify(s),encoding:o?o+"/json":"json"};throw new J("Data type is unsupported",40013,400)}async function Zn(s,o){const{data:u,encoding:p,error:_}=await Yr(s.data,s.encoding,o);if(s.data=u,s.encoding=p,_)throw _}async function Yr(s,o,u){const p=Va(u);let _=s,k=s,I=o,B;if(o){const Z=o.split("/");let Y,he=Z.length,de="";try{for(;(Y=he)>0;){const Ee=Z[--he].match(/([-\w]+)(\+([\w-]+))?/);if(!Ee)break;switch(de=Ee[1],de){case"base64":k=x.BufferUtils.base64Decode(String(k)),Y==Z.length&&(_=k);continue;case"utf-8":k=x.BufferUtils.utf8Decode(k);continue;case"json":k=JSON.parse(k);continue;case"cipher":if(p.channelOptions!=null&&p.channelOptions.cipher&&p.channelOptions.channelCipher){const fe=Ee[3],Ae=p.channelOptions.channelCipher;if(fe!=Ae.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");k=await Ae.decrypt(k);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!p.plugins||!p.plugins.vcdiff)throw new J("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new J("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{let fe=p.baseEncodedPreviousPayload;typeof fe=="string"&&(fe=x.BufferUtils.utf8Encode(fe));const Ae=x.BufferUtils.toBuffer(fe);k=x.BufferUtils.toBuffer(k),k=x.BufferUtils.arrayBufferViewToBuffer(p.plugins.vcdiff.decode(k,Ae)),_=k}catch(fe){throw new J("Vcdiff delta decode failed with "+fe,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(Ee){const fe=Ee;B=new J(`Error processing the ${de} encoding, decoder returned ${fe.message}`,fe.code||40013,400)}finally{I=Y<=0?null:Z.slice(0,Y).join("/")}}return B?{error:B,data:k,encoding:I}:(p.baseEncodedPreviousPayload=_,{data:k,encoding:I})}function Xr(...s){const o=s.length>0?"json":"msgpack",{data:u,encoding:p}=zn(this.data,this.encoding,o);return Object.assign({},this,{encoding:p,data:u})}function zn(s,o,u){return!s||!x.BufferUtils.isBuffer(s)?{data:s,encoding:o}:u==="msgpack"?{data:x.BufferUtils.toBuffer(s),encoding:o}:{data:x.BufferUtils.base64Encode(s),encoding:o?o+"/base64":"base64"}}var Yi={encryptData:Ki,encodeData:Qt,encodeDataForWire:zn,decodeData:Yr};function Xi(s){const{id:o,connectionId:u,timestamp:p}=s;let _;switch(s.action){case Ce.MESSAGE:{_=s.messages;break}case Ce.PRESENCE:case Ce.SYNC:_=s.presence;break;case Ce.ANNOTATION:_=s.annotations;break;case Ce.OBJECT:case Ce.OBJECT_SYNC:_=s.state;break;default:throw new J("Unexpected action "+s.action,4e4,400)}for(let k=0;k<_.length;k++){const I=_[k];I.connectionId||(I.connectionId=u),I.timestamp||(I.timestamp=p),o&&!I.id&&(I.id=o+":"+k)}}function er(s,o){let u="["+o;for(const p in s)p==="data"?typeof s.data=="string"?u+="; data="+s.data:x.BufferUtils.isBuffer(s.data)?u+="; data (buffer)="+x.BufferUtils.base64Encode(s.data):typeof s.data<"u"&&(u+="; data (json)="+JSON.stringify(s.data)):p&&(p==="extras"||p==="operation")?u+="; "+p+"="+JSON.stringify(s[p]):p==="version"?u+="; version="+JSON.stringify(s[p]):p==="annotations"?u+="; annotations="+JSON.stringify(s[p]):s[p]!==void 0&&(u+="; "+p+"="+s[p]);return u+="]",u}var Zr=class{},qo=class{constructor(s){this.Platform=x,this.ErrorInfo=J,this.Logger=S,this.Defaults=qe,this.Utils=Te,this.EventEmitter=St,this.MessageEncoding=Yi;var o,u,p,_,k,I,B,Z,Y,he;this._additionalHTTPRequestImplementations=(o=s.plugins)!=null?o:null,this.logger=new S,this.logger.setLog(s.logLevel,s.logHandler),S.logAction(this.logger,S.LOG_MICRO,"BaseClient()","initialized with clientOptions "+x.Config.inspect(s)),this._MsgPack=(p=(u=s.plugins)==null?void 0:u.MsgPack)!=null?p:null;const de=this.options=qe.normaliseOptions(s,this._MsgPack,this.logger);if(de.key){const Ee=de.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!Ee){const fe="invalid key parameter";throw S.logAction(this.logger,S.LOG_ERROR,"BaseClient()",fe),new J(fe,40400,404)}de.keyName=Ee[1],de.keySecret=Ee[2]}if("clientId"in de)if(typeof de.clientId=="string"||de.clientId===null){if(de.clientId==="*")throw new J('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new J("clientId must be either a string or null",40012,400);S.logAction(this.logger,S.LOG_MINOR,"BaseClient()","started; version = "+qe.version),this._currentFallback=null,this.serverTimeOffset=null,this.http=new Ps(this),this.auth=new un(this,de),this._rest=(_=s.plugins)!=null&&_.Rest?new s.plugins.Rest(this):null,this._Crypto=(I=(k=s.plugins)==null?void 0:k.Crypto)!=null?I:null,this.__FilteredSubscriptions=(Z=(B=s.plugins)==null?void 0:B.MessageInteractions)!=null?Z:null,this._Annotations=(he=(Y=s.plugins)==null?void 0:Y.Annotations)!=null?he:null}get rest(){return this._rest||bt("Rest"),this._rest}get _FilteredSubscriptions(){return this.__FilteredSubscriptions||bt("MessageInteractions"),this.__FilteredSubscriptions}get channels(){return this.rest.channels}get push(){return this.rest.push}device(){var s;return(!((s=this.options.plugins)!=null&&s.Push)||!this.push.LocalDevice)&&bt("Push"),this._device||(this._device=this.push.LocalDevice.load(this)),this._device}baseUri(s){return qe.getHttpScheme(this.options)+s+":"+qe.getPort(this.options,!1)}async stats(s){return this.rest.stats(s)}async time(s){return this.rest.time(s)}async request(s,o,u,p,_,k){return this.rest.request(s,o,u,p,_,k)}batchPublish(s){return this.rest.batchPublish(s)}batchPresence(s){return this.rest.batchPresence(s)}setLog(s){this.logger.setLog(s.level,s.handler)}async getTimestamp(s){return!this.isTimeOffsetSet()&&s?this.time():this.getTimestampUsingOffset()}getTimestampUsingOffset(){return Date.now()+(this.serverTimeOffset||0)}isTimeOffsetSet(){return this.serverTimeOffset!==null}};qo.Platform=x;var Ar=qo,$a=class mc{toJSON(){var o,u,p;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(o=this.push)==null?void 0:o.recipient,state:(u=this.push)==null?void 0:u.state,error:(p=this.push)==null?void 0:p.error}}}toString(){var o,u,p,_;let k="[DeviceDetails";return this.id&&(k+="; id="+this.id),this.platform&&(k+="; platform="+this.platform),this.formFactor&&(k+="; formFactor="+this.formFactor),this.clientId&&(k+="; clientId="+this.clientId),this.metadata&&(k+="; metadata="+this.metadata),this.deviceIdentityToken&&(k+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),(o=this.push)!=null&&o.recipient&&(k+="; push.recipient="+JSON.stringify(this.push.recipient)),(u=this.push)!=null&&u.state&&(k+="; push.state="+this.push.state),(p=this.push)!=null&&p.error&&(k+="; push.error="+JSON.stringify(this.push.error)),(_=this.push)!=null&&_.metadata&&(k+="; push.metadata="+this.push.metadata),k+="]",k}static toRequestBody(o,u,p){return ln(o,u,p)}static fromResponseBody(o,u,p){return p&&(o=Dt(o,u,p)),Array.isArray(o)?mc.fromValuesArray(o):mc.fromValues(o)}static fromValues(o){return o.error=o.error&&J.fromValues(o.error),Object.assign(new mc,o)}static fromLocalDevice(o){return Object.assign(new mc,o)}static fromValuesArray(o){const u=o.length,p=new Array(u);for(let _=0;_<u;_++)p[_]=mc.fromValues(o[_]);return p}},Pr=$a;async function Oi(s,o,u,p){if(s.http.supportsAuthHeaders){const _=await s.auth.getAuthHeaders();return p(ve(_,o),u)}else{const _=await s.auth.getAuthParams();return p(o,ve(_,u))}}function Zi(s,o,u){if(s.err&&!s.body)return{err:s.err};if(s.statusCode===ki.NoContent)return P(A({},s),{body:[],unpacked:!0});let p=s.body;if(!s.unpacked)try{p=Dt(p,o,u)}catch(B){return Vt(B)?{err:B}:{err:new De(Ze(B),null)}}if(!p)return{err:new De("unenvelope(): Response body is missing",null)};const{statusCode:_,response:k,headers:I}=p;if(_===void 0)return P(A({},s),{body:p,unpacked:!0});if(_<200||_>=300){let B=k&&k.error||s.err;return B||(B=new Error("Error in unenveloping "+p),B.statusCode=_),{err:B,body:k,headers:I,unpacked:!0,statusCode:_}}return{err:s.err,body:k,headers:I,unpacked:!0,statusCode:_}}function j(s,o,u,p,_){s.err?S.logAction(_,S.LOG_MICRO,"Resource."+o+"()","Received Error; "+Ti(u,p)+"; Error: "+Ze(s.err)):S.logAction(_,S.LOG_MICRO,"Resource."+o+"()","Received; "+Ti(u,p)+"; Headers: "+Mi(s.headers)+"; StatusCode: "+s.statusCode+"; Body: "+(x.BufferUtils.isBuffer(s.body)?" (Base64): "+x.BufferUtils.base64Encode(s.body):": "+x.Config.inspect(s.body)))}var ne=class vc{static async get(o,u,p,_,k,I){return vc.do(Tt.Get,o,u,null,p,_,k,I??!1)}static async delete(o,u,p,_,k,I){return vc.do(Tt.Delete,o,u,null,p,_,k,I)}static async post(o,u,p,_,k,I,B){return vc.do(Tt.Post,o,u,p,_,k,I,B)}static async patch(o,u,p,_,k,I,B){return vc.do(Tt.Patch,o,u,p,_,k,I,B)}static async put(o,u,p,_,k,I,B){return vc.do(Tt.Put,o,u,p,_,k,I,B)}static async do(o,u,p,_,k,I,B,Z){B&&((I=I||{}).envelope=B);const Y=u.logger;async function he(Ee,fe){var Ae;if(Y.shouldLog(S.LOG_MICRO)){let Fe=_;if(((Ae=Ee["content-type"])==null?void 0:Ae.indexOf("msgpack"))>0)try{u._MsgPack||bt("MsgPack"),Fe=u._MsgPack.decode(_)}catch(lt){S.logAction(Y,S.LOG_MICRO,"Resource."+o+"()","Sending MsgPack Decoding Error: "+Ze(lt))}S.logAction(Y,S.LOG_MICRO,"Resource."+o+"()","Sending; "+Ti(p,fe)+"; Body: "+Fe)}const Pe=await u.http.do(o,p,Ee,_,fe);return Pe.error&&un.isTokenErr(Pe.error)?(await u.auth.authorize(null,null),Oi(u,Ee,fe,he)):{err:Pe.error,body:Pe.body,headers:Pe.headers,unpacked:Pe.unpacked,statusCode:Pe.statusCode}}let de=await Oi(u,k,I,he);if(B&&(de=Zi(de,u._MsgPack,B)),Y.shouldLog(S.LOG_MICRO)&&j(de,o,p,I,Y),Z){if(de.err)throw de.err;{const Ee=A({},de);return delete Ee.err,Ee}}return de}},ce=ne;function je(s){const o=s.match(/^\.\/(\w+)\?(.*)$/);return o&&o[2]&&en(o[2])}function Pt(s){typeof s=="string"&&(s=s.split(","));const o={};for(let u=0;u<s.length;u++){const p=s[u].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(p){const _=je(p[1]);_&&(o[p[2]]=_)}}return o}function Ut(s,o,u){return!(u&&(o||typeof s.code=="number"))}var Vn=class{constructor(s,o,u,p,_,k){this.client=s,this.path=o,this.headers=u,this.envelope=p??null,this.bodyHandler=_,this.useHttpPaginatedResponse=k||!1}get logger(){return this.client.logger}async get(s){const o=await ce.get(this.client,this.path,this.headers,s,this.envelope,!1);return this.handlePage(o)}async delete(s){const o=await ce.delete(this.client,this.path,this.headers,s,this.envelope,!1);return this.handlePage(o)}async post(s,o){const u=await ce.post(this.client,this.path,o,this.headers,s,this.envelope,!1);return this.handlePage(u)}async put(s,o){const u=await ce.put(this.client,this.path,o,this.headers,s,this.envelope,!1);return this.handlePage(u)}async patch(s,o){const u=await ce.patch(this.client,this.path,o,this.headers,s,this.envelope,!1);return this.handlePage(u)}async handlePage(s){if(s.err&&Ut(s.err,s.body,this.useHttpPaginatedResponse))throw S.logAction(this.logger,S.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+Ze(s.err)),s.err;let o,u,p;try{o=s.statusCode==ki.NoContent?[]:await this.bodyHandler(s.body,s.headers||{},s.unpacked)}catch(_){throw s.err||_}return s.headers&&(u=s.headers.Link||s.headers.link)&&(p=Pt(u)),this.useHttpPaginatedResponse?new gr(this,o,s.headers||{},s.statusCode,p,s.err):new $t(this,o,p)}},$t=class{constructor(s,o,u){this.resource=s,this.items=o,this._relParams=u}async first(){if(this.hasFirst())return this.get(this._relParams.first);throw new J("No link to the first page of results",40400,404)}async current(){if(this.hasCurrent())return this.get(this._relParams.current);throw new J("No link to the current page of results",40400,404)}async next(){return this.hasNext()?this.get(this._relParams.next):null}hasFirst(){return this._relParams!=null&&"first"in this._relParams}hasCurrent(){return this._relParams!=null&&"current"in this._relParams}hasNext(){return this._relParams!=null&&"next"in this._relParams}isLast(){return!this.hasNext()}async get(s){const o=this.resource,u=await ce.get(o.client,o.path,o.headers,s,o.envelope,!1);return o.handlePage(u)}},gr=class extends $t{constructor(s,o,u,p,_,k){super(s,o,_),this.statusCode=p,this.success=p<300&&p>=200,this.headers=u,this.errorCode=k&&k.code,this.errorMessage=k&&k.message}toJSON(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}}},Bt=Vn,Ri=class $l{toJSON(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}}toString(){let o="[PushChannelSubscription";return this.channel&&(o+="; channel="+this.channel),this.deviceId&&(o+="; deviceId="+this.deviceId),this.clientId&&(o+="; clientId="+this.clientId),o+="]",o}static fromResponseBody(o,u,p){return p&&(o=Dt(o,u,p)),Array.isArray(o)?$l.fromValuesArray(o):$l.fromValues(o)}static fromValues(o){return Object.assign(new $l,o)}static fromValuesArray(o){const u=o.length,p=new Array(u);for(let _=0;_<u;_++)p[_]=$l.fromValues(o[_]);return p}};Ri.toRequestBody=ln;var Wo=Ri,Ir=Wo,Ai=class{constructor(s){var o;this.client=s,this.admin=new es(s),x.Config.push&&((o=s.options.plugins)!=null&&o.Push)&&(this.stateMachine=new s.options.plugins.Push.ActivationStateMachine(s),this.LocalDevice=s.options.plugins.Push.localDeviceFactory(Pr))}async activate(s,o){await new Promise((u,p)=>{var _;if(!((_=this.client.options.plugins)!=null&&_.Push)){p(Or("Push"));return}if(!this.stateMachine){p(new J("This platform is not supported as a target of push notifications",4e4,400));return}if(this.stateMachine.activatedCallback){p(new J("Activation already in progress",4e4,400));return}this.stateMachine.activatedCallback=k=>{if(k){p(k);return}u()},this.stateMachine.updateFailedCallback=o,this.stateMachine.handleEvent(new this.client.options.plugins.Push.CalledActivate(this.stateMachine,s))})}async deactivate(s){await new Promise((o,u)=>{var p;if(!((p=this.client.options.plugins)!=null&&p.Push)){u(Or("Push"));return}if(!this.stateMachine){u(new J("This platform is not supported as a target of push notifications",4e4,400));return}if(this.stateMachine.deactivatedCallback){u(new J("Deactivation already in progress",4e4,400));return}this.stateMachine.deactivatedCallback=_=>{if(_){u(_);return}o()},this.stateMachine.handleEvent(new this.client.options.plugins.Push.CalledDeactivate(this.stateMachine,s))})}},es=class{constructor(s){this.client=s,this.deviceRegistrations=new $n(s),this.channelSubscriptions=new Ls(s)}async publish(s,o){const u=this.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=qe.defaultPostHeaders(u.options,{format:p}),k={},I=ve({recipient:s},o);ve(_,u.options.headers),u.options.pushFullWait&&ve(k,{fullWait:"true"});const B=ln(I,u._MsgPack,p);await ce.post(u,"/push/publish",B,_,k,null,!0)}},$n=class{constructor(s){this.client=s}async save(s){const o=this.client,u=Pr.fromValues(s),p=o.options.useBinaryProtocol?"msgpack":"json",_=qe.defaultPostHeaders(o.options,{format:p}),k={};ve(_,o.options.headers),o.options.pushFullWait&&ve(k,{fullWait:"true"});const I=ln(u,o._MsgPack,p),B=await ce.put(o,"/push/deviceRegistrations/"+encodeURIComponent(s.id),I,_,k,null,!0);return Pr.fromResponseBody(B.body,o._MsgPack,B.unpacked?void 0:p)}async get(s){const o=this.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=qe.defaultGetHeaders(o.options,{format:u}),_=s.id||s;if(typeof _!="string"||!_.length)throw new J("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400);ve(p,o.options.headers);const k=await ce.get(o,"/push/deviceRegistrations/"+encodeURIComponent(_),p,{},null,!0);return Pr.fromResponseBody(k.body,o._MsgPack,k.unpacked?void 0:u)}async list(s){const o=this.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=this.client.http.supportsLinkHeaders?void 0:u,_=qe.defaultGetHeaders(o.options,{format:u});return ve(_,o.options.headers),new Bt(o,"/push/deviceRegistrations",_,p,async function(k,I,B){return Pr.fromResponseBody(k,o._MsgPack,B?void 0:u)}).get(s)}async remove(s){const o=this.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=qe.defaultGetHeaders(o.options,{format:u}),_={},k=s.id||s;if(typeof k!="string"||!k.length)throw new J("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400);ve(p,o.options.headers),o.options.pushFullWait&&ve(_,{fullWait:"true"}),await ce.delete(o,"/push/deviceRegistrations/"+encodeURIComponent(k),p,_,null,!0)}async removeWhere(s){const o=this.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=qe.defaultGetHeaders(o.options,{format:u});ve(p,o.options.headers),o.options.pushFullWait&&ve(s,{fullWait:"true"}),await ce.delete(o,"/push/deviceRegistrations",p,s,null,!0)}},Ls=class ew{constructor(o){this.remove=ew.prototype.removeWhere,this.client=o}async save(o){const u=this.client,p=Ir.fromValues(o),_=u.options.useBinaryProtocol?"msgpack":"json",k=qe.defaultPostHeaders(u.options,{format:_}),I={};ve(k,u.options.headers),u.options.pushFullWait&&ve(I,{fullWait:"true"});const B=ln(p,u._MsgPack,_),Z=await ce.post(u,"/push/channelSubscriptions",B,k,I,null,!0);return Ir.fromResponseBody(Z.body,u._MsgPack,Z.unpacked?void 0:_)}async list(o){const u=this.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=this.client.http.supportsLinkHeaders?void 0:p,k=qe.defaultGetHeaders(u.options,{format:p});return ve(k,u.options.headers),new Bt(u,"/push/channelSubscriptions",k,_,async function(I,B,Z){return Ir.fromResponseBody(I,u._MsgPack,Z?void 0:p)}).get(o)}async removeWhere(o){const u=this.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=qe.defaultGetHeaders(u.options,{format:p});ve(_,u.options.headers),u.options.pushFullWait&&ve(o,{fullWait:"true"}),await ce.delete(u,"/push/channelSubscriptions",_,o,null,!0)}async listChannels(o){const u=this.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=this.client.http.supportsLinkHeaders?void 0:p,k=qe.defaultGetHeaders(u.options,{format:p});return ve(k,u.options.headers),u.options.pushFullWait&&ve(o,{fullWait:"true"}),new Bt(u,"/push/channels",k,_,async function(I,B,Z){const Y=!Z&&p?Dt(I,u._MsgPack,p):I;for(let he=0;he<Y.length;he++)Y[he]=String(Y[he]);return Y}).get(o)}},Kc=Ai,js=["absent","present","enter","leave","update"];async function rd(s,o,u,p){const _=Vo(o,s,p??null);return Ds.fromValues(u).decode(_,s)}async function Yc(s,o,u,p){return Promise.all(u.map(function(_){return rd(s,o,_,p)}))}async function Xc(s,o){return Ds.fromValues(s).decode(o.channelOptions,o.logger)}async function Ns(s,o){return Promise.all(s.map(function(u){return Xc(u,o)}))}var Ho=class ql extends Zr{isSynthesized(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId}parseId(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");const o=this.id.split(":");return{connectionId:o[0],msgSerial:parseInt(o[1],10),index:parseInt(o[2],10)}}async encode(o){const u=Object.assign(new Ds,this,{action:js.indexOf(this.action||"present")});return Fn(u,o)}static fromValues(o){return Object.assign(new ql,o)}static fromValuesArray(o){return o.map(u=>ql.fromValues(u))}static fromData(o){return o instanceof ql?o:ql.fromValues({data:o})}toString(){return er(this,"PresenceMessage")}},Ds=class mg extends Zr{toJSON(...o){return Xr.call(this,...o)}static fromValues(o){return Object.assign(new mg,o)}static fromValuesArray(o){return o.map(u=>mg.fromValues(u))}async decode(o,u){const p=Object.assign(new Ho,P(A({},this),{action:js[this.action]}));try{await Zn(p,o)}catch(_){S.logAction(u,S.LOG_ERROR,"WirePresenceMessage.decode()",Ze(_))}return p}toString(){return er(this,"WirePresenceMessage")}},Pi=Ho,ip=class{constructor(s){this.channel=s}get logger(){return this.channel.logger}async get(s){S.logAction(this.logger,S.LOG_MICRO,"RestPresence.get()","channel = "+this.channel.name);const o=this.channel.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=this.channel.client.http.supportsLinkHeaders?void 0:u,_=qe.defaultGetHeaders(o.options,{format:u});return ve(_,o.options.headers),new Bt(o,this.channel.client.rest.presenceMixin.basePath(this),_,p,async(k,I,B)=>{const Z=B?k:Dt(k,o._MsgPack,u);return Ns(Z,this.channel)}).get(s)}async history(s){return S.logAction(this.logger,S.LOG_MICRO,"RestPresence.history()","channel = "+this.channel.name),this.channel.client.rest.presenceMixin.history(this,s)}},sp=ip,qa=["message.create","message.update","message.delete","meta","message.summary"];function op(s){return qa[s||0]||"unknown"}function ap(s){let o=0;return s.name&&(o+=s.name.length),s.clientId&&(o+=s.clientId.length),s.extras&&(o+=JSON.stringify(s.extras).length),s.data&&(o+=Kn(s.data)),o}async function id(s,o,u,p){const _=Vo(o,s,p??null);return ts.fromValues(u).decode(_,s)}async function cp(s,o,u,p){return Promise.all(u.map(function(_){return id(s,o,_,p)}))}async function lp(s,o){return ts.fromValues(s).decode(o.channelOptions,o.logger)}async function sd(s,o){return Promise.all(s.map(function(u){return lp(u,o)}))}async function od(s,o){return Promise.all(s.map(u=>u.encode(o)))}var up=ln;function Zc(s){let o,u=0;for(let p=0;p<s.length;p++)o=s[p],u+=o.size||(o.size=ap(o));return u}var ad=class vg extends Zr{expandFields(){if(this.version||(this.version={}),!this.version.serial&&this.serial&&(this.version.serial=this.serial),!this.version.timestamp&&this.timestamp&&(this.version.timestamp=this.timestamp),this.annotations?this.annotations.summary||(this.annotations.summary={}):this.annotations={summary:{}},this.annotations&&this.annotations.summary)for(const[o,u]of Object.entries(this.annotations.summary))if(o.endsWith(":distinct.v1")||o.endsWith(":unique.v1")||o.endsWith(":multiple.v1"))for(const[,p]of Object.entries(u))p.clipped||(p.clipped=!1);else o.endsWith(":flag.v1")&&(u.clipped||(u.clipped=!1))}async encode(o){const u=Object.assign(new ts,this,{action:qa.indexOf(this.action||"message.create")});return Fn(u,o)}static fromValues(o){return Object.assign(new vg,o)}static fromValuesArray(o){return o.map(u=>vg.fromValues(u))}toString(){return er(this,"Message")}},ts=class yg extends Zr{toJSON(...o){return Xr.call(this,...o)}static fromValues(o){return Object.assign(new yg,o)}static fromValuesArray(o){return o.map(u=>yg.fromValues(u))}async decodeWithErr(o,u){const p=Object.assign(new ad,P(A({},this),{action:op(this.action)}));let _;try{await Zn(p,o)}catch(k){S.logAction(u,S.LOG_ERROR,"WireMessage.decode()",Ze(k)),_=k}return p.expandFields(),{decoded:p,err:_}}async decode(o,u){const{decoded:p}=await this.decodeWithErr(o,u);return p}toString(){return er(this,"WireMessage")}},Ii=ad,dp=9;function fp(s){return s.every(function(o){return!o.id})}var cd=class{constructor(s,o,u){this._annotations=null;var p,_;S.logAction(s.logger,S.LOG_MINOR,"RestChannel()","started; name = "+o),this.name=o,this.client=s,this.presence=new sp(this),this.channelOptions=Ts((p=s._Crypto)!=null?p:null,this.logger,u),(_=s.options.plugins)!=null&&_.Push&&(this._push=new s.options.plugins.Push.PushChannel(this)),s._Annotations&&(this._annotations=new s._Annotations.RestAnnotations(this))}get annotations(){return this._annotations||bt("Annotations"),this._annotations}get push(){return this._push||bt("Push"),this._push}get logger(){return this.client.logger}setOptions(s){var o;this.channelOptions=Ts((o=this.client._Crypto)!=null?o:null,this.logger,s)}async history(s){return S.logAction(this.logger,S.LOG_MICRO,"RestChannel.history()","channel = "+this.name),this.client.rest.channelMixin.history(this,s)}async publish(...s){const o=s[0],u=s[1];let p,_;if(typeof o=="string"||o===null)p=[Ii.fromValues({name:o,data:u})],_=s[2];else if(oe(o))p=[Ii.fromValues(o)],_=s[1];else if(Array.isArray(o))p=Ii.fromValuesArray(o),_=s[1];else throw new J("The single-argument form of publish() expects a message object or an array of message objects",40013,400);_||(_={});const k=this.client,I=k.options,B=I.useBinaryProtocol?"msgpack":"json",Z=k.options.idempotentRestPublishing,Y=qe.defaultPostHeaders(k.options,{format:B});if(ve(Y,I.headers),Z&&fp(p)){const fe=await Tr(dp);p.forEach(function(Ae,Pe){Ae.id=fe+":"+Pe.toString()})}const he=await od(p,this.channelOptions),de=Zc(he),Ee=I.maxMessageSize;if(de>Ee)throw new J(`Maximum size of messages that can be published at once exceeded (was ${de} bytes; limit is ${Ee} bytes)`,40009,400);await this._publish(up(he,k._MsgPack,B),Y,_)}async _publish(s,o,u){await ce.post(this.client,this.client.rest.channelMixin.basePath(this)+"/messages",s,o,u,null,!0)}async status(){return this.client.rest.channelMixin.status(this)}},hp=cd,pp=class tw{constructor(o){this.entries=o&&o.entries||void 0,this.schema=o&&o.schema||void 0,this.appId=o&&o.appId||void 0,this.inProgress=o&&o.inProgress||void 0,this.unit=o&&o.unit||void 0,this.intervalId=o&&o.intervalId||void 0}static fromValues(o){return new tw(o)}},gp=pp,ld=class{static basePath(s){return"/channels/"+encodeURIComponent(s.name)}static history(s,o){const u=s.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=s.client.http.supportsLinkHeaders?void 0:p,k=qe.defaultGetHeaders(u.options,{format:p});return ve(k,u.options.headers),new Bt(u,this.basePath(s)+"/messages",k,_,async function(I,B,Z){const Y=Z?I:Dt(I,u._MsgPack,p);return sd(Y,s)}).get(o)}static async status(s){const o=s.client.options.useBinaryProtocol?"msgpack":"json",u=qe.defaultPostHeaders(s.client.options,{format:o});return(await ce.get(s.client,this.basePath(s),u,{},o,!0)).body}},mp=class{static basePath(s){return ld.basePath(s.channel)+"/presence"}static async history(s,o){const u=s.channel.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=s.channel.client.http.supportsLinkHeaders?void 0:p,k=qe.defaultGetHeaders(u.options,{format:p});return ve(k,u.options.headers),new Bt(u,this.basePath(s)+"/history",k,_,async(I,B,Z)=>{const Y=Z?I:Dt(I,u._MsgPack,p);return Ns(Y,s.channel)}).get(o)}},ud=class{constructor(s){this.channelMixin=ld,this.presenceMixin=mp,this.Resource=ce,this.PaginatedResource=Bt,this.DeviceDetails=Pr,this.PushChannelSubscription=Ir,this.client=s,this.channels=new vp(this.client),this.push=new Kc(this.client)}async stats(s){const o=qe.defaultGetHeaders(this.client.options),u=this.client.options.useBinaryProtocol?"msgpack":"json",p=this.client.http.supportsLinkHeaders?void 0:u;return ve(o,this.client.options.headers),new Bt(this.client,"/stats",o,p,function(_,k,I){const B=I?_:JSON.parse(_);for(let Z=0;Z<B.length;Z++)B[Z]=gp.fromValues(B[Z]);return B}).get(s)}async time(s){const o=qe.defaultGetHeaders(this.client.options);this.client.options.headers&&ve(o,this.client.options.headers);const u=B=>this.client.baseUri(B)+"/time";let{error:p,body:_,unpacked:k}=await this.client.http.do(Tt.Get,u,o,null,s);if(p)throw p;k||(_=JSON.parse(_));const I=_[0];if(!I)throw new J("Internal error (unexpected result type from GET /time)",5e4,500);return this.client.serverTimeOffset=I-Date.now(),I}async request(s,o,u,p,_,k){var I;const[B,Z,Y]=this.client.options.useBinaryProtocol?(this.client._MsgPack||bt("MsgPack"),[this.client._MsgPack.encode,this.client._MsgPack.decode,"msgpack"]):[JSON.stringify,JSON.parse,"json"],he=this.client.http.supportsLinkHeaders?void 0:Y;p=p||{};const de=s.toLowerCase(),Ee=de=="get"?qe.defaultGetHeaders(this.client.options,{format:Y,protocolVersion:u}):qe.defaultPostHeaders(this.client.options,{format:Y,protocolVersion:u});typeof _!="string"&&(_=(I=B(_))!=null?I:null),ve(Ee,this.client.options.headers),k&&ve(Ee,k);const fe=new Bt(this.client,o,Ee,he,async function(Ae,Pe,Fe){return Oe(Fe?Ae:Z(Ae))},!0);if(!x.Http.methods.includes(de))throw new J("Unsupported method "+de,40500,405);return x.Http.methodsWithBody.includes(de)?fe[de](p,_):fe[de](p)}async batchPublish(s){let o,u;Array.isArray(s)?(o=s,u=!1):(o=[s],u=!0);const p=this.client.options.useBinaryProtocol?"msgpack":"json",_=qe.defaultPostHeaders(this.client.options,{format:p});this.client.options.headers&&ve(_,this.client.options.headers);const k=ln(o,this.client._MsgPack,p),I=await ce.post(this.client,"/messages",k,_,{},null,!0),B=I.unpacked?I.body:Dt(I.body,this.client._MsgPack,p);return u?B[0]:B}async batchPresence(s){const o=this.client.options.useBinaryProtocol?"msgpack":"json",u=qe.defaultPostHeaders(this.client.options,{format:o});this.client.options.headers&&ve(u,this.client.options.headers);const p=s.join(","),_=await ce.get(this.client,"/presence",u,{channels:p},null,!0);return _.unpacked?_.body:Dt(_.body,this.client._MsgPack,o)}async revokeTokens(s,o){if(za(this.client.options))throw new J("Cannot revoke tokens when using token auth",40162,401);const u=this.client.options.keyName;let p=o??{};const _=A({targets:s.map(Y=>`${Y.type}:${Y.value}`)},p),k=this.client.options.useBinaryProtocol?"msgpack":"json",I=qe.defaultPostHeaders(this.client.options,{format:k});this.client.options.headers&&ve(I,this.client.options.headers);const B=ln(_,this.client._MsgPack,k),Z=await ce.post(this.client,`/keys/${u}/revokeTokens`,B,I,{},null,!0);return Z.unpacked?Z.body:Dt(Z.body,this.client._MsgPack,k)}},vp=class{constructor(s){this.client=s,this.all=Object.create(null)}get(s,o){s=String(s);let u=this.all[s];return u?o&&u.setOptions(o):this.all[s]=u=new hp(this.client,s,o),u}release(s){delete this.all[String(s)]}},el=class extends Ar{constructor(s){super(qe.objectifyOptions(s,!1,"BaseRest",S.defaultLogger,{Rest:ud}))}},Us={Rest:ud},dd=class extends Ii{static async fromEncoded(s,o){return id(S.defaultLogger,x.Crypto,s,o)}static async fromEncodedArray(s,o){return cp(S.defaultLogger,x.Crypto,s,o)}static fromValues(s){return Ii.fromValues(s)}},tl=class extends Pi{static async fromEncoded(s,o){return rd(S.defaultLogger,x.Crypto,s,o)}static async fromEncodedArray(s,o){return Yc(S.defaultLogger,x.Crypto,s,o)}static fromValues(s){return Pi.fromValues(s)}},nl=["annotation.create","annotation.delete"];async function rl(s,o,u){return Fs.fromValues(o).decode(u||{},s)}async function fd(s,o,u){return Promise.all(o.map(function(p){return rl(s,p,u)}))}async function hd(s,o){return Fs.fromValues(s).decode(o.channelOptions,o.logger)}async function Bs(s,o){return Promise.all(s.map(function(u){return hd(u,o)}))}var pd=class _g extends Zr{async encode(){const o=Object.assign(new Fs,this,{action:nl.indexOf(this.action||"annotation.create")});return Fn(o,{})}static fromValues(o){return Object.assign(new _g,o)}static fromValuesArray(o){return o.map(u=>_g.fromValues(u))}toString(){return er(this,"Annotation")}},Fs=class wg extends Zr{toJSON(...o){return Xr.call(this,...o)}static fromValues(o){return Object.assign(new wg,o)}static fromValuesArray(o){return o.map(u=>wg.fromValues(u))}async decode(o,u){const p=Object.assign(new pd,P(A({},this),{action:nl[this.action]}));try{await Zn(p,o)}catch(_){S.logAction(u,S.LOG_ERROR,"WireAnnotation.decode()",Ze(_))}return p}toString(){return er(this,"WireAnnotation")}},Go=pd,il=class extends Go{static async fromEncoded(s,o){return rl(S.defaultLogger,s,o)}static async fromEncodedArray(s,o){return fd(S.defaultLogger,s,o)}static fromValues(s){return Go.fromValues(s)}};function sl(s){let o;switch(typeof s){case"string":o=s;break;case"object":o=s.serial;break}if(!o||typeof o!="string")throw new J("First argument of annotations.publish() must be either a Message (or at least an object with a string `serial` property) or a message serial (string)",40003,400);return o}function zs(s,o){const u=sl(s);if(!o||typeof o!="object")throw new J("Second argument of annotations.publish() must be an object (the intended annotation to publish)",40003,400);const p=Go.fromValues(o);return p.messageSerial=u,p.action||(p.action="annotation.create"),p}function Vs(s,o){return s.client.rest.channelMixin.basePath(s)+"/messages/"+encodeURIComponent(o)+"/annotations"}var yp=class{constructor(s){this.channel=s}async publish(s,o){const u=zs(s,o),p=await u.encode(),_=this.channel.client,k=_.options,I=k.useBinaryProtocol?"msgpack":"json",B=qe.defaultPostHeaders(_.options,{format:I}),Z={};ve(B,_.options.headers);const Y=ln([p],_._MsgPack,I);await ce.post(_,Vs(this.channel,u.messageSerial),Y,B,Z,null,!0)}async delete(s,o){return o.action="annotation.delete",this.publish(s,o)}async get(s,o){const u=this.channel.client,p=sl(s),_=u.options.useBinaryProtocol?"msgpack":"json",k=u.http.supportsLinkHeaders?void 0:_,I=qe.defaultGetHeaders(u.options,{format:_});return ve(I,u.options.headers),new Bt(u,Vs(this.channel,p),I,k,async(B,Z,Y)=>{const he=Y?B:Dt(B,u._MsgPack,_);return Bs(he,this.channel)}).get(o)}},$s=yp,_p=ln;function Jo(s){const o=[];if(s)for(let u=0;u<s.length;u++)o.push(s[u].toString());return"[ "+o.join(", ")+" ]"}function ol(s,o,u,p,_,k){const I=Dt(s,o,k);return Qo(I,u,p,_)}function Qo(s,o,u,p){let _;s.error&&(_=J.fromValues(s.error));let k;s.messages&&(k=ts.fromValuesArray(s.messages));let I;o&&s.presence&&(I=o.WirePresenceMessage.fromValuesArray(s.presence));let B;u&&s.annotations&&(B=u.WireAnnotation.fromValuesArray(s.annotations));let Z;return p&&s.state&&(Z=p.WireObjectMessage.fromValuesArray(s.state,Te,Yi)),Object.assign(new cl,P(A({},s),{presence:I,messages:k,annotations:B,state:Z,error:_}))}function al(s){return o=>{var u;return Qo(o,{WirePresenceMessage:Ds},{WireAnnotation:Fs},(u=s?.ObjectsPlugin)!=null?u:null)}}function En(s){return Object.assign(new cl,s)}function Wa(s,o,u,p){let _="[ProtocolMessage";s.action!==void 0&&(_+="; action="+xs[s.action]||s.action);const k=["id","channel","channelSerial","connectionId","count","msgSerial","timestamp"];let I;for(let B=0;B<k.length;B++)I=k[B],s[I]!==void 0&&(_+="; "+I+"="+s[I]);if(s.messages&&(_+="; messages="+Jo(ts.fromValuesArray(s.messages))),s.presence&&o&&(_+="; presence="+Jo(o.WirePresenceMessage.fromValuesArray(s.presence))),s.annotations&&u&&(_+="; annotations="+Jo(u.WireAnnotation.fromValuesArray(s.annotations))),s.state&&p&&(_+="; state="+Jo(p.WireObjectMessage.fromValuesArray(s.state,Te,Yi))),s.error&&(_+="; error="+J.fromValues(s.error).toString()),s.auth&&s.auth.accessToken&&(_+="; token="+s.auth.accessToken),s.flags&&(_+="; flags="+Fo.filter(s.hasFlag).join(",")),s.params){let B="";zt(s.params,function(Z){B.length>0&&(B+="; "),B+=Z+"="+s.params[Z]}),B.length>0&&(_+="; params=["+B+"]")}return _+="]",_}var cl=class{constructor(){this.hasFlag=s=>(this.flags&Ot[s])>0}setFlag(s){return this.flags=this.flags|Ot[s]}getMode(){return(this.flags||0)&Ot.MODE_ALL}encodeModesToFlags(s){s.forEach(o=>this.setFlag(o))}decodeModesFromFlags(){const s=[];return zo.forEach(o=>{this.hasFlag(o)&&s.push(o)}),s.length>0?s:void 0}},wp=cl,bp=class{constructor(s,o,u,p,_){this.previous=s,this.current=o,o==="attached"&&(this.resumed=u,this.hasBacklog=p),_&&(this.reason=_)}},ll=bp,gd=function(){};function mr(s){if(s&&"params"in s&&!oe(s.params))return new J("options.params must be an object",4e4,400);if(s&&"modes"in s){if(!Array.isArray(s.modes))return new J("options.modes must be an array",4e4,400);for(let o=0;o<s.modes.length;o++){const u=s.modes[o];if(!u||typeof u!="string"||!zo.includes(String.prototype.toUpperCase.call(u)))return new J("Invalid channel mode: "+u,4e4,400)}}}var Ko=class bg extends St{constructor(o,u,p){var _,k,I;super(o.logger),this._annotations=null,this._mode=0,this.retryCount=0,this.history=async function(B){S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name);const Z=this.client.rest.channelMixin;if(B&&B.untilAttach){if(this.state!=="attached")throw new J("option untilAttach requires the channel to be attached",4e4,400);if(!this.properties.attachSerial)throw new J("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400);delete B.untilAttach,B.from_serial=this.properties.attachSerial}return Z.history(this,B)},this.whenState=B=>St.prototype.whenState.call(this,B,this.state),S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel()","started; name = "+u),this.name=u,this.channelOptions=Ts((_=o._Crypto)!=null?_:null,this.logger,p),this.client=o,this._presence=o._RealtimePresence?new o._RealtimePresence.RealtimePresence(this):null,o._Annotations&&(this._annotations=new o._Annotations.RealtimeAnnotations(this)),this.connectionManager=o.connection.connectionManager,this.state="initialized",this.subscriptions=new St(this.logger),this.syncChannelSerial=void 0,this.properties={attachSerial:void 0,channelSerial:void 0},this.setOptions(p),this.errorReason=null,this._attachResume=!1,this._decodingContext={channelOptions:this.channelOptions,plugins:o.options.plugins||{},baseEncodedPreviousPayload:void 0},this._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},this._allChannelChanges=new St(this.logger),(k=o.options.plugins)!=null&&k.Push&&(this._push=new o.options.plugins.Push.PushChannel(this)),(I=o.options.plugins)!=null&&I.Objects&&(this._objects=new o.options.plugins.Objects.Objects(this))}get presence(){return this._presence||bt("RealtimePresence"),this._presence}get annotations(){return this._annotations||bt("Annotations"),this._annotations}get push(){return this._push||bt("Push"),this._push}get objects(){return this._objects||bt("Objects"),this._objects}invalidStateError(){return new J("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)}static processListenerArgs(o){return o=Array.prototype.slice.call(o),typeof o[0]=="function"&&o.unshift(null),o}async setOptions(o){var u;const p=this.channelOptions,_=mr(o);if(_)throw _;if(this.channelOptions=Ts((u=this.client._Crypto)!=null?u:null,this.logger,o),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(o,p))return this.attachImpl(),new Promise((k,I)=>{this._allChannelChanges.once(["attached","update","detached","failed"],function(B){switch(this.event){case"update":case"attached":k();break;default:I(B.reason)}})})}_shouldReattachToSetOptions(o,u){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(o?.params){const p=ul(o.params),_=ul(u.params);if(Object.keys(p).length!==Object.keys(_).length||!ks(_,p))return!0}return!!(o?.modes&&(!u.modes||!wi(o.modes,u.modes)))}async publish(...o){let u;if(o.length==1)if(oe(o[0]))u=[Ii.fromValues(o[0])];else if(Array.isArray(o[0]))u=Ii.fromValuesArray(o[0]);else throw new J("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else u=[Ii.fromValues({name:o[0],data:o[1]})];const _=this.client.options.maxMessageSize,k=await od(u,this.channelOptions),I=Zc(k);if(I>_)throw new J(`Maximum size of messages that can be published at once exceeded (was ${I} bytes; limit is ${_} bytes)`,40009,400);this.throwIfUnpublishableState(),S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+this.state+", message count = "+k.length);const B=En({action:Ce.MESSAGE,channel:this.name,messages:k});return this.sendMessage(B)}throwIfUnpublishableState(){if(!this.connectionManager.activeState())throw this.connectionManager.getError();if(this.state==="failed"||this.state==="suspended")throw this.invalidStateError()}onEvent(o){S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.onEvent()","received message");const u=this.subscriptions;for(let p=0;p<o.length;p++){const _=o[p];u.emit(_.name,_)}}async attach(){return this.state==="attached"?null:new Promise((o,u)=>{this._attach(!1,null,(p,_)=>p?u(p):o(_))})}_attach(o,u,p){p||(p=k=>{k&&S.logAction(this.logger,S.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+k.toString())});const _=this.connectionManager;if(!_.activeState()){p(_.getError());return}(this.state!=="attaching"||o)&&this.requestState("attaching",u),this.once(function(k){switch(this.event){case"attached":p?.(null,k);break;case"detached":case"suspended":case"failed":p?.(k.reason||_.getError()||new J("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":p?.(new J("Attach request superseded by a subsequent detach request",9e4,409));break}})}attachImpl(){S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");const o=En({action:Ce.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this.channelOptions.modes&&o.encodeModesToFlags(yi(this.channelOptions.modes)),this._attachResume&&o.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(o.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(o).catch(gd)}async detach(){const o=this.connectionManager;if(!o.activeState())throw o.getError();switch(this.state){case"suspended":this.notifyState("detached");return;case"detached":return;case"failed":throw new J("Unable to detach; channel state = failed",90001,400);default:this.requestState("detaching");case"detaching":return new Promise((u,p)=>{this.once(function(_){switch(this.event){case"detached":u();break;case"attached":case"suspended":case"failed":p(_.reason||o.getError()||new J("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":p(new J("Detach request superseded by a subsequent attach request",9e4,409));break}})})}}detachImpl(){S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");const o=En({action:Ce.DETACH,channel:this.name});this.sendMessage(o).catch(gd)}async subscribe(...o){const[u,p]=bg.processListenerArgs(o);if(this.state==="failed")throw J.fromValues(this.invalidStateError());return u&&typeof u=="object"&&!Array.isArray(u)?this.client._FilteredSubscriptions.subscribeFilter(this,u,p):this.subscriptions.on(u,p),this.channelOptions.attachOnSubscribe!==!1?this.attach():null}unsubscribe(...o){var u;const[p,_]=bg.processListenerArgs(o);if(typeof p=="object"&&!_||(u=this.filteredSubscriptions)!=null&&u.has(_)){this.client._FilteredSubscriptions.getAndDeleteFilteredSubscriptions(this,p,_).forEach(k=>this.subscriptions.off(k));return}this.subscriptions.off(p,_)}sync(){switch(this.state){case"initialized":case"detaching":case"detached":throw new De("Unable to sync to channel; not attached",4e4)}const o=this.connectionManager;if(!o.activeState())throw o.getError();const u=En({action:Ce.SYNC,channel:this.name});this.syncChannelSerial&&(u.channelSerial=this.syncChannelSerial),o.send(u)}async sendMessage(o){return new Promise((u,p)=>{this.connectionManager.send(o,this.client.options.queueMessages,_=>{_?p(_):u()})})}async sendPresence(o){const u=En({action:Ce.PRESENCE,channel:this.name,presence:o});return this.sendMessage(u)}sendState(o){const u=En({action:Ce.OBJECT,channel:this.name,state:o});return this.sendMessage(u)}async processMessage(o){(o.action===Ce.ATTACHED||o.action===Ce.MESSAGE||o.action===Ce.PRESENCE||o.action===Ce.OBJECT||o.action===Ce.ANNOTATION)&&this.setChannelSerial(o.channelSerial);let u,p=!1;switch(o.action){case Ce.ATTACHED:{this.properties.attachSerial=o.channelSerial,this._mode=o.getMode(),this.params=o.params||{};const _=o.decodeModesFromFlags();this.modes=_&&Qr(_)||void 0;const k=o.hasFlag("RESUMED"),I=o.hasFlag("HAS_PRESENCE"),B=o.hasFlag("HAS_BACKLOG"),Z=o.hasFlag("HAS_OBJECTS");if(this.state==="attached"){k||(this._presence&&this._presence.onAttached(I),this._objects&&this._objects.onAttached(Z));const Y=new ll(this.state,this.state,k,B,o.error);this._allChannelChanges.emit("update",Y),(!k||this.channelOptions.updateOnAttached)&&this.emit("update",Y)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",o.error,k,I,B,Z);break}case Ce.DETACHED:{const _=o.error?J.fromValues(o.error):new J("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",_):this.state==="attaching"?this.notifyState("suspended",_):(this.state==="attached"||this.state==="suspended")&&this.requestState("attaching",_);break}case Ce.SYNC:if(p=!0,u=this.syncChannelSerial=o.channelSerial,!o.presence)break;case Ce.PRESENCE:{if(!o.presence)break;Xi(o);const _=this.channelOptions;if(this._presence){const k=await Promise.all(o.presence.map(I=>I.decode(_,this.logger)));this._presence.setPresence(k,p,u)}break}case Ce.OBJECT:case Ce.OBJECT_SYNC:{if(!this._objects||!o.state)return;Xi(o);const _=this.client.connection.connectionManager.getActiveTransportFormat(),k=o.state.map(I=>I.decode(this.client,_));o.action===Ce.OBJECT?this._objects.handleObjectMessages(k):this._objects.handleObjectSyncMessages(k,o.channelSerial);break}case Ce.MESSAGE:{if(this.state!=="attached"){S.logAction(this.logger,S.LOG_MAJOR,"RealtimeChannel.processMessage()",'Message "'+o.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}Xi(o);const _=o.messages,k=_[0],I=_[_.length-1];if(k.extras&&k.extras.delta&&k.extras.delta.from!==this._lastPayload.messageId){const Z='Delta message decode failure - previous message not available for message "'+o.id+'" on this channel "'+this.name+'".';S.logAction(this.logger,S.LOG_ERROR,"RealtimeChannel.processMessage()",Z),this._startDecodeFailureRecovery(new J(Z,40018,400));break}let B=[];for(let Z=0;Z<_.length;Z++){const{decoded:Y,err:he}=await _[Z].decodeWithErr(this._decodingContext,this.logger);if(B[Z]=Y,he)switch(he.code){case 40018:this._startDecodeFailureRecovery(he);return;case 40019:case 40021:this.notifyState("failed",he);return}}this._lastPayload.messageId=I.id,this._lastPayload.protocolMessageChannelSerial=o.channelSerial,this.onEvent(B);break}case Ce.ANNOTATION:{Xi(o);const _=this.channelOptions;if(this._annotations){const k=await Promise.all((o.annotations||[]).map(I=>I.decode(_,this.logger)));this._annotations._processIncoming(k)}break}case Ce.ERROR:{const _=o.error;_&&_.code==80016?this.checkPendingState():this.notifyState("failed",J.fromValues(_));break}default:S.logAction(this.logger,S.LOG_MAJOR,"RealtimeChannel.processMessage()","Protocol error: unrecognised message action ("+o.action+")")}}_startDecodeFailureRecovery(o){this._lastPayload.decodeFailureRecoveryInProgress||(S.logAction(this.logger,S.LOG_MAJOR,"RealtimeChannel.processMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,o,()=>{this._lastPayload.decodeFailureRecoveryInProgress=!1}))}onAttached(){S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)}notifyState(o,u,p,_,k,I){if(S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+o),this.clearStateTimer(),["detached","suspended","failed"].includes(o)&&(this.properties.channelSerial=null),o===this.state)return;this._presence&&this._presence.actOnChannelState(o,_,u),this._objects&&this._objects.actOnChannelState(o,I),o==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),u&&(this.errorReason=u);const B=new ll(this.state,o,p,k,u),Z='Channel state for channel "'+this.name+'"',Y=o+(u?"; reason: "+u:"");o==="failed"?S.logAction(this.logger,S.LOG_ERROR,Z,Y):S.logAction(this.logger,S.LOG_MAJOR,Z,Y),o!=="attaching"&&o!=="suspended"&&(this.retryCount=0),o==="attached"&&this.onAttached(),o==="attached"?this._attachResume=!0:(o==="detaching"||o==="failed")&&(this._attachResume=!1),this.state=o,this._allChannelChanges.emit(o,B),this.emit(o,B)}requestState(o,u){S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+o),this.notifyState(o,u),this.checkPendingState()}checkPendingState(){if(!this.connectionManager.state.sendEvents){S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}}timeoutPendingState(){switch(this.state){case"attaching":{const o=new J("Channel attach timed out",90007,408);this.notifyState("suspended",o);break}case"detaching":{const o=new J("Channel detach timed out",90007,408);this.notifyState("attached",o);break}default:this.checkPendingState();break}}startStateTimerIfNotRunning(){this.stateTimer||(this.stateTimer=setTimeout(()=>{S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),this.stateTimer=null,this.timeoutPendingState()},this.client.options.timeouts.realtimeRequestTimeout))}clearStateTimer(){const o=this.stateTimer;o&&(clearTimeout(o),this.stateTimer=null)}startRetryTimer(){if(this.retryTimer)return;this.retryCount++;const o=Gi(this.client.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(()=>{this.state==="suspended"&&this.connectionManager.state.sendEvents&&(this.retryTimer=null,S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),this.requestState("attaching"))},o)}cancelRetryTimer(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}getReleaseErr(){const o=this.state;return o==="initialized"||o==="detached"||o==="failed"?null:new J("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+o,90001,400)}setChannelSerial(o){S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+o+"; previous = "+this.properties.channelSerial),o&&(this.properties.channelSerial=o)}async status(){return this.client.rest.channelMixin.status(this)}};function ul(s){const o=s||{},{agent:u}=o;return R(o,["agent"])}var qs=Ko,md=class{constructor(s){this.channel=s,this.logger=s.logger,this.subscriptions=new St(this.logger)}async publish(s,o){const u=this.channel.name,p=zs(s,o),_=await p.encode();this.channel.throwIfUnpublishableState(),S.logAction(this.logger,S.LOG_MICRO,"RealtimeAnnotations.publish()","channelName = "+u+", sending annotation with messageSerial = "+p.messageSerial+", type = "+p.type);const k=En({action:Ce.ANNOTATION,channel:u,annotations:[_]});return this.channel.sendMessage(k)}async delete(s,o){return o.action="annotation.delete",this.publish(s,o)}async subscribe(...s){const o=qs.processListenerArgs(s),u=o[0],p=o[1],_=this.channel;if(_.state==="failed")throw J.fromValues(_.invalidStateError());if(this.subscriptions.on(u,p),this.channel.channelOptions.attachOnSubscribe!==!1&&await _.attach(),(this.channel.state==="attached"&&this.channel._mode&Ot.ANNOTATION_SUBSCRIBE)===0)throw new J("You are trying to add an annotation listener, but you haven't requested the annotation_subscribe channel mode in ChannelOptions, so this won't do anything (we only deliver annotations to clients who have explicitly requested them)",93001,400)}unsubscribe(...s){const o=qs.processListenerArgs(s),u=o[0],p=o[1];this.subscriptions.off(u,p)}_processIncoming(s){for(const o of s)this.subscriptions.emit(o.type||"",o)}async get(s,o){return $s.prototype.get.call(this,s,o)}},dl=md,ei=class cf extends el{constructor(o){var u,p;if(!cf._MsgPack)throw new Error("Expected DefaultRest._MsgPack to have been set");super(qe.objectifyOptions(o,!0,"Rest",S.defaultLogger,P(A({},Us),{Crypto:(u=cf.Crypto)!=null?u:void 0,MsgPack:(p=cf._MsgPack)!=null?p:void 0,Annotations:{Annotation:Go,WireAnnotation:Fs,RealtimeAnnotations:dl,RestAnnotations:$s}})))}static get Crypto(){if(this._Crypto===null)throw new Error("Encryption not enabled; use ably.encryption.js instead");return this._Crypto}static set Crypto(o){this._Crypto=o}};ei._Crypto=null,ei.Message=dd,ei.PresenceMessage=tl,ei.Annotation=il,ei._MsgPack=null,ei._Http=Ps;var fl=ei,Sp=class extends St{constructor(s){super(s),this.messages=[]}count(){return this.messages.length}push(s){this.messages.push(s)}shift(){return this.messages.shift()}last(){return this.messages[this.messages.length-1]}copyAll(){return this.messages.slice()}append(s){this.messages.push.apply(this.messages,s)}prepend(s){this.messages.unshift.apply(this.messages,s)}completeMessages(s,o,u){S.logAction(this.logger,S.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+s+"; count = "+o),u=u||null;const p=this.messages;if(p.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");const _=p[0];if(_){const k=_.message.msgSerial,I=s+o;if(I>k){const B=p.splice(0,I-k);for(const Z of B)Z.callback(u)}p.length==0&&this.emit("idle")}}completeAllMessages(s){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,s)}resetSendAttempted(){for(let s of this.messages)s.sendAttempted=!1}clear(){S.logAction(this.logger,S.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")}},ns=Sp,Ha=class{constructor(s,o){this.message=s,this.callback=o,this.merged=!1;const u=s.action;this.sendAttempted=!1,this.ackRequired=typeof u=="number"&&[Ce.MESSAGE,Ce.PRESENCE,Ce.ANNOTATION,Ce.OBJECT].includes(u)}},Yo=class extends St{constructor(s){super(s.logger),this.transport=s,this.messageQueue=new ns(this.logger),s.on("ack",(o,u)=>{this.onAck(o,u)}),s.on("nack",(o,u,p)=>{this.onNack(o,u,p)})}onAck(s,o){S.logAction(this.logger,S.LOG_MICRO,"Protocol.onAck()","serial = "+s+"; count = "+o),this.messageQueue.completeMessages(s,o)}onNack(s,o,u){S.logAction(this.logger,S.LOG_ERROR,"Protocol.onNack()","serial = "+s+"; count = "+o+"; err = "+Ze(u)),u||(u=new J("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(s,o,u)}onceIdle(s){const o=this.messageQueue;if(o.count()===0){s();return}o.once("idle",s)}send(s){s.ackRequired&&this.messageQueue.push(s),this.logger.shouldLog(S.LOG_MICRO)&&S.logActionNoStrip(this.logger,S.LOG_MICRO,"Protocol.send()","sending msg; "+Wa(s.message,this.transport.connectionManager.realtime._RealtimePresence,this.transport.connectionManager.realtime._Annotations,this.transport.connectionManager.realtime._objectsPlugin)),s.sendAttempted=!0,this.transport.send(s.message)}getTransport(){return this.transport}getPendingMessages(){return this.messageQueue.copyAll()}clearPendingMessages(){return this.messageQueue.clear()}finish(){const s=this.transport;this.onceIdle(function(){s.disconnect()})}},hl=Yo,vd=class{constructor(s,o,u,p){this.previous=s,this.current=o,u&&(this.retryIn=u),p&&(this.reason=p)}},rs=vd,qn={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},pl={disconnected:()=>J.fromValues({statusCode:400,code:qn.DISCONNECTED,message:"Connection to server temporarily unavailable"}),suspended:()=>J.fromValues({statusCode:400,code:qn.SUSPENDED,message:"Connection to server unavailable"}),failed:()=>J.fromValues({statusCode:400,code:qn.FAILED,message:"Connection failed or disconnected by server"}),closing:()=>J.fromValues({statusCode:400,code:qn.CLOSING,message:"Connection closing"}),closed:()=>J.fromValues({statusCode:400,code:qn.CLOSED,message:"Connection closed"}),unknownConnectionErr:()=>J.fromValues({statusCode:500,code:qn.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"}),unknownChannelErr:()=>J.fromValues({statusCode:500,code:qn.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})};function yd(s){return!s.statusCode||!s.code||s.statusCode>=500?!0:Object.values(qn).includes(s.code)}var xr=pl,_d=En({action:Ce.CLOSE}),wd=En({action:Ce.DISCONNECT}),bd=class extends St{constructor(s,o,u,p){super(s.logger),p&&(u.format=void 0,u.heartbeats=!0),this.connectionManager=s,this.auth=o,this.params=u,this.timeouts=u.options.timeouts,this.format=u.format,this.isConnected=!1,this.isFinished=!1,this.isDisposed=!1,this.maxIdleInterval=null,this.idleTimer=null,this.lastActivity=null}connect(){}close(){this.isConnected&&this.requestClose(),this.finish("closed",xr.closed())}disconnect(s){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",s||xr.disconnected())}fail(s){this.isConnected&&this.requestDisconnect(),this.finish("failed",s||xr.failed())}finish(s,o){var u;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((u=this.idleTimer)!=null?u:void 0),this.idleTimer=null,this.emit(s,o),this.dispose())}onProtocolMessage(s){switch(this.logger.shouldLog(S.LOG_MICRO)&&S.logActionNoStrip(this.logger,S.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+Wa(s,this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),s.action){case Ce.HEARTBEAT:S.logActionNoStrip(this.logger,S.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",s.id);break;case Ce.CONNECTED:this.onConnect(s),this.emit("connected",s.error,s.connectionId,s.connectionDetails,s);break;case Ce.CLOSED:this.onClose(s);break;case Ce.DISCONNECTED:this.onDisconnect(s);break;case Ce.ACK:this.emit("ack",s.msgSerial,s.count);break;case Ce.NACK:this.emit("nack",s.msgSerial,s.count,s.error);break;case Ce.SYNC:this.connectionManager.onChannelMessage(s,this);break;case Ce.ACTIVATE:break;case Ce.AUTH:Nt(this.auth.authorize(),o=>{o&&S.logAction(this.logger,S.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+Ze(o))});break;case Ce.ERROR:if(S.logAction(this.logger,S.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+x.Config.inspect(s.error)+(s.channel?", channel: "+s.channel:"")),s.channel===void 0){this.onFatalError(s);break}this.connectionManager.onChannelMessage(s,this);break;default:this.connectionManager.onChannelMessage(s,this)}}onConnect(s){if(this.isConnected=!0,!s.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");const o=s.connectionDetails.maxIdleInterval;o&&(this.maxIdleInterval=o+this.timeouts.realtimeRequestTimeout,this.onActivity())}onDisconnect(s){const o=s&&s.error;S.logAction(this.logger,S.LOG_MINOR,"Transport.onDisconnect()","err = "+Ze(o)),this.finish("disconnected",o)}onFatalError(s){const o=s&&s.error;S.logAction(this.logger,S.LOG_MINOR,"Transport.onFatalError()","err = "+Ze(o)),this.finish("failed",o)}onClose(s){const o=s&&s.error;S.logAction(this.logger,S.LOG_MINOR,"Transport.onClose()","err = "+Ze(o)),this.finish("closed",o)}requestClose(){S.logAction(this.logger,S.LOG_MINOR,"Transport.requestClose()",""),this.send(_d)}requestDisconnect(){S.logAction(this.logger,S.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(wd)}ping(s){const o={action:Ce.HEARTBEAT};s&&(o.id=s),this.send(En(o))}dispose(){S.logAction(this.logger,S.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()}onActivity(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=Date.now(),this.setIdleTimer(this.maxIdleInterval+100))}setIdleTimer(s){this.idleTimer||(this.idleTimer=setTimeout(()=>{this.onIdleTimerExpire()},s))}onIdleTimerExpire(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;const s=Date.now()-this.lastActivity,o=this.maxIdleInterval-s;if(o<=0){const u="No activity seen from realtime in "+s+"ms; assuming connection has dropped";S.logAction(this.logger,S.LOG_ERROR,"Transport.onIdleTimerExpire()",u),this.disconnect(new J(u,80003,408))}else this.setIdleTimer(o+100)}static tryConnect(s,o,u,p,_){const k=new s(o,u,p);let I;const B=function(Y){clearTimeout(I),_({event:this.event,error:Y})},Z=o.options.timeouts.realtimeRequestTimeout;return I=setTimeout(()=>{k.off(["preconnect","disconnected","failed"]),k.dispose(),B.call({event:"disconnected"},new J("Timeout waiting for transport to indicate itself viable",5e4,500))},Z),k.on(["failed","disconnected"],B),k.on("preconnect",function(){S.logAction(o.logger,S.LOG_MINOR,"Transport.tryConnect()","viable transport "+k),clearTimeout(I),k.off(["failed","disconnected"],B),_(null,k)}),k.connect(),k}static isAvailable(){throw new J("isAvailable not implemented for transport",5e4,500)}},is=bd,dn;(s=>{s.WebSocket="web_socket",s.Comet="comet",s.XhrPolling="xhr_polling"})(dn||(dn={}));var Sd=typeof ds<"u"?ds:typeof window<"u"?window:self,Lr=()=>{var s;return typeof x.WebStorage<"u"&&((s=x.WebStorage)==null?void 0:s.localSupported)},ss=()=>{var s;return typeof x.WebStorage<"u"&&((s=x.WebStorage)==null?void 0:s.sessionSupported)},Ga=function(){},gl="ably-transport-preference";function kp(s,o,u){let p;if(s.channel!==o.channel||(p=s.action)!==Ce.PRESENCE&&p!==Ce.MESSAGE||p!==o.action)return!1;const _=p===Ce.PRESENCE?"presence":"messages",k=s[_].concat(o[_]);return Zc(k)>u||!Sn(k,"clientId")||!k.every(function(B){return!B.id})?!1:(s[_]=k,!0)}function os(s){try{return JSON.parse(s)}catch{return null}}var Cp=class{constructor(s,o,u,p){this.options=s,this.host=o,this.mode=u,this.connectionKey=p,this.format=s.useBinaryProtocol?"msgpack":"json"}getConnectParams(s){const o=s?ge(s):{},u=this.options;switch(this.mode){case"resume":o.resume=this.connectionKey;break;case"recover":{const p=os(u.recover);p&&(o.recover=p.connectionKey);break}}return u.clientId!==void 0&&(o.clientId=u.clientId),u.echoMessages===!1&&(o.echo="false"),this.format!==void 0&&(o.format=this.format),this.stream!==void 0&&(o.stream=this.stream),this.heartbeats!==void 0&&(o.heartbeats=this.heartbeats),o.v=qe.protocolVersion,o.agent=tn(this.options),u.transportParams!==void 0&&ve(o,u.transportParams),o}toString(){let s="[mode="+this.mode;return this.host&&(s+=",host="+this.host),this.connectionKey&&(s+=",connectionKey="+this.connectionKey),this.format&&(s+=",format="+this.format),s+="]",s}},kd=class nw extends St{constructor(o,u){super(o.logger),this.supportedTransports={},this.disconnectedRetryCount=0,this.pendingChannelMessagesState={isProcessing:!1,queue:[]},this.realtime=o,this.initTransports(),this.options=u;const p=u.timeouts,_=p.webSocketConnectTimeout+p.realtimeRequestTimeout;if(this.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:_,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:p.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:p.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:p.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},this.state=this.states.initialized,this.errorReason=null,this.queuedMessages=new ns(this.logger),this.msgSerial=0,this.connectionDetails=void 0,this.connectionId=void 0,this.connectionKey=void 0,this.connectionStateTtl=p.connectionStateTtl,this.maxIdleInterval=null,this.transports=z(u.transports||qe.defaultTransports,this.supportedTransports),this.transportPreference=null,this.transports.includes(dn.WebSocket)&&(this.webSocketTransportAvailable=!0),this.transports.includes(dn.XhrPolling)?this.baseTransport=dn.XhrPolling:this.transports.includes(dn.Comet)&&(this.baseTransport=dn.Comet),this.domains=qe.getHosts(u),this.activeProtocol=null,this.host=null,this.lastAutoReconnectAttempt=null,this.lastActivity=null,this.forceFallbackHost=!1,this.connectCounter=0,this.wsCheckResult=null,this.webSocketSlowTimer=null,this.webSocketGiveUpTimer=null,this.abandonedWebSocket=!1,S.logAction(this.logger,S.LOG_MINOR,"Realtime.ConnectionManager()","started"),S.logAction(this.logger,S.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(u.transports||qe.defaultTransports)+"]"),S.logAction(this.logger,S.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+this.transports+"]"),S.logAction(this.logger,S.LOG_MICRO,"Realtime.ConnectionManager()","http domains = ["+this.domains+"]"),!this.transports.length){const I="no requested transports available";throw S.logAction(this.logger,S.LOG_ERROR,"realtime.ConnectionManager()",I),new Error(I)}const k=x.Config.addEventListener;k&&(ss()&&typeof u.recover=="function"&&k("beforeunload",this.persistConnection.bind(this)),u.closeOnUnload===!0&&k("beforeunload",()=>{S.logAction(this.logger,S.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),this.requestState({state:"closing"})}),k("online",()=>{var I;this.state==this.states.disconnected||this.state==this.states.suspended?(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager caught browser online event","reattempting connection"),this.requestState({state:"connecting"})):this.state==this.states.connecting&&((I=this.pendingTransport)==null||I.off(),this.disconnectAllTransports(),this.startConnect())}),k("offline",()=>{this.state==this.states.connected&&(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager caught browser offline event","disconnecting active transport"),this.disconnectAllTransports())}))}static supportedTransports(o){const u={supportedTransports:{}};return this.initTransports(o,u),u.supportedTransports}static initTransports(o,u){const p=A(A({},x.Transports.bundledImplementations),o);[dn.WebSocket,...x.Transports.order].forEach(_=>{const k=p[_];k&&k.isAvailable()&&(u.supportedTransports[_]=k)})}initTransports(){nw.initTransports(this.realtime._additionalTransportImplementations,this)}createTransportParams(o,u){return new Cp(this.options,o,u,this.connectionKey)}getTransportParams(o){(p=>{if(this.connectionKey){p("resume");return}if(typeof this.options.recover=="string"){p("recover");return}const _=this.options.recover,k=this.getSessionRecoverData(),I=this.sessionRecoveryName();if(k&&typeof _=="function"){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data (recovery scope: "+I+")"),_(k,B=>{B?(this.options.recover=k.recoveryKey,p("recover")):p("clean")});return}p("clean")})(p=>{const _=this.createTransportParams(null,p);if(p==="recover"){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+this.options.recover);const k=os(this.options.recover);k&&(this.msgSerial=k.msgSerial)}else S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+_.toString());o(_)})}tryATransport(o,u,p){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+u),this.proposedTransport=is.tryConnect(this.supportedTransports[u],this,this.realtime.auth,o,(_,k)=>{const I=this.state;if(I==this.states.closing||I==this.states.closed||I==this.states.failed){k&&(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+I.state+" while we were attempting the transport; closing "+k),k.close()),p(!0);return}if(_){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+u+" "+_.event+", err: "+_.error.toString()),un.isTokenErr(_.error)&&!(this.errorReason&&un.isTokenErr(this.errorReason))?(this.errorReason=_.error,Nt(this.realtime.auth._forceNewToken(null,null),B=>{if(B){this.actOnErrorFromAuthorize(B);return}this.tryATransport(o,u,p)})):_.event==="failed"?(this.notifyState({state:"failed",error:_.error}),p(!0)):_.event==="disconnected"&&(yd(_.error)?p(!1):(this.notifyState({state:this.states.connecting.failState,error:_.error}),p(!0)));return}S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+u+"; setting pending"),this.setTransportPending(k,o),p(null,k)})}setTransportPending(o,u){const p=u.mode;S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+o+"; mode = "+p),this.pendingTransport=o,this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),o.once("connected",(k,I,B)=>{this.activateTransport(k,o,I,B),p==="recover"&&this.options.recover&&(delete this.options.recover,this.unpersistConnection())});const _=this;o.on(["disconnected","closed","failed"],function(k){_.deactivateTransport(o,this.event,k)}),this.emit("transport.pending",o)}activateTransport(o,u,p,_){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+u),o&&S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+o),p&&S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+p),_&&S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(_)),this.persistTransportPreference(u);const k=this.state,I=this.states.connected.state;if(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+k.state),k.state==this.states.closing.state||k.state==this.states.closed.state||k.state==this.states.failed.state)return S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),u.disconnect(),!1;if(delete this.pendingTransport,!u.isConnected)return S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+u+" since it appears to no longer be connected"),!1;const B=this.activeProtocol;this.activeProtocol=new hl(u),this.host=u.params.host;const Z=_.connectionKey;if(Z&&this.connectionKey!=Z&&this.setConnection(p,_,!!o),this.onConnectionDetailsUpdate(_,u),x.Config.nextTick(()=>{u.on("connected",(Y,he,de)=>{this.onConnectionDetailsUpdate(de,u),this.emit("update",new rs(I,I,null,Y))})}),k.state===this.states.connected.state?o&&(this.errorReason=this.realtime.connection.errorReason=o,this.emit("update",new rs(I,I,null,o))):(this.notifyState({state:"connected",error:o}),this.errorReason=this.realtime.connection.errorReason=o||null),this.emit("transport.active",u),B)if(B.messageQueue.count()>0&&S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+B.transport.shortName+", new one is "+u.shortName+") finishing with "+B.messageQueue.count()+" messages still pending"),B.transport===u){const Y="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+u.shortName+"; stack = "+new Error().stack;S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.activateTransport()",Y)}else B.finish();return!0}deactivateTransport(o,u,p){const _=this.activeProtocol,k=_&&_.getTransport()===o,I=o===this.pendingTransport,B=this.noTransportsScheduledForActivation();if(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+o),S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+u+(k?"; was active":I?"; was pending":"")+(B?"":"; another transport is scheduled for activation")),p&&p.message&&S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+p.message),k&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(_.getPendingMessages()),_.clearPendingMessages(),this.activeProtocol=this.host=null),this.emit("transport.inactive",o),k&&B||k&&u==="failed"||u==="closed"||_===null&&I){if(u==="disconnected"&&p&&p.statusCode>500&&this.domains.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:u,error:p,retryImmediately:!0});return}const Z=u==="failed"&&un.isTokenErr(p)?"disconnected":u;this.notifyState({state:Z,error:p});return}}noTransportsScheduledForActivation(){return!this.pendingTransport||!this.pendingTransport.isConnected}setConnection(o,u,p){const _=this.connectionId;(_&&_!==o||!_&&p)&&(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==o&&S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=o,this.realtime.connection.key=this.connectionKey=u.connectionKey}clearConnection(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()}createRecoveryKey(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null}checkConnectionStateFreshness(){if(!this.lastActivity||!this.connectionId)return;const o=Date.now()-this.lastActivity;o>this.connectionStateTtl+this.maxIdleInterval&&(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+o+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}persistConnection(){if(ss()){const o=this.createRecoveryKey();o&&this.setSessionRecoverData({recoveryKey:o,disconnectedAt:Date.now(),location:Sd.location,clientId:this.realtime.auth.clientId})}}unpersistConnection(){this.clearSessionRecoverData()}getActiveTransportFormat(){var o;return(o=this.activeProtocol)==null?void 0:o.getTransport().format}getError(){if(this.errorReason){const o=De.fromValues(this.errorReason);return o.cause=this.errorReason,o}return this.getStateError()}getStateError(){var o,u;return(u=(o=xr)[this.state.state])==null?void 0:u.call(o)}activeState(){return this.state.queueEvents||this.state.sendEvents}enactStateChange(o){const u="Connection state",p=o.current+(o.reason?"; reason: "+o.reason:"");o.current==="failed"?S.logAction(this.logger,S.LOG_ERROR,u,p):S.logAction(this.logger,S.LOG_MAJOR,u,p),S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+o.current+"; reason = "+(o.reason&&o.reason.message));const _=this.state=this.states[o.current];o.reason&&(this.errorReason=o.reason,this.realtime.connection.errorReason=o.reason),(_.terminal||_.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",o)}startTransitionTimer(o){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+o.state),this.transitionTimer&&(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(()=>{this.transitionTimer&&(this.transitionTimer=null,S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager "+o.state+" timer expired","requesting new state: "+o.failState),this.notifyState({state:o.failState}))},o.retryDelay)}cancelTransitionTimer(){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)}startSuspendTimer(){this.suspendTimer||(this.suspendTimer=setTimeout(()=>{this.suspendTimer&&(this.suspendTimer=null,S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),this.states.connecting.failState="suspended",this.notifyState({state:"suspended"}))},this.connectionStateTtl))}checkSuspendTimer(o){o!=="disconnected"&&o!=="suspended"&&o!=="connecting"&&this.cancelSuspendTimer()}cancelSuspendTimer(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)}startRetryTimer(o){this.retryTimer=setTimeout(()=>{S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),this.retryTimer=null,this.requestState({state:"connecting"})},o)}cancelRetryTimer(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}startWebSocketSlowTimer(){this.webSocketSlowTimer=setTimeout(()=>{S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager WebSocket slow timer","checking connectivity"),this.checkWsConnectivity().then(()=>{S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager WebSocket slow timer","ws connectivity check succeeded"),this.wsCheckResult=!0}).catch(()=>{S.logAction(this.logger,S.LOG_MAJOR,"ConnectionManager WebSocket slow timer","ws connectivity check failed"),this.wsCheckResult=!1}),this.realtime.http.checkConnectivity&&Nt(this.realtime.http.checkConnectivity(),(o,u)=>{o||!u?(S.logAction(this.logger,S.LOG_MAJOR,"ConnectionManager WebSocket slow timer","http connectivity check failed"),this.cancelWebSocketGiveUpTimer(),this.notifyState({state:"disconnected",error:new J("Unable to connect (network unreachable)",80003,404)})):S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager WebSocket slow timer","http connectivity check succeeded")})},this.options.timeouts.webSocketSlowTimeout)}cancelWebSocketSlowTimer(){this.webSocketSlowTimer&&(clearTimeout(this.webSocketSlowTimer),this.webSocketSlowTimer=null)}startWebSocketGiveUpTimer(o){this.webSocketGiveUpTimer=setTimeout(()=>{var u,p;this.wsCheckResult||(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager WebSocket give up timer","websocket connection took more than 10s; "+(this.baseTransport?"trying base transport":"")),this.baseTransport?(this.abandonedWebSocket=!0,(u=this.proposedTransport)==null||u.dispose(),(p=this.pendingTransport)==null||p.dispose(),this.connectBase(o,++this.connectCounter)):S.logAction(this.logger,S.LOG_MAJOR,"ConnectionManager WebSocket give up timer","websocket connectivity appears to be unavailable but no other transports to try"))},this.options.timeouts.webSocketConnectTimeout)}cancelWebSocketGiveUpTimer(){this.webSocketGiveUpTimer&&(clearTimeout(this.webSocketGiveUpTimer),this.webSocketGiveUpTimer=null)}notifyState(o){var u,p;const _=o.state,k=_==="disconnected"&&(this.state===this.states.connected||o.retryImmediately||this.state===this.states.connecting&&o.error&&un.isTokenErr(o.error)&&!(this.errorReason&&un.isTokenErr(this.errorReason)));if(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+_+(k?"; will retry connection immediately":"")),_==this.state.state||(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),this.checkSuspendTimer(o.state),(_==="suspended"||_==="connected")&&(this.disconnectedRetryCount=0),this.state.terminal))return;const I=this.states[o.state];let B=I.retryDelay;I.state==="disconnected"&&(this.disconnectedRetryCount++,B=Gi(I.retryDelay,this.disconnectedRetryCount));const Z=new rs(this.state.state,I.state,B,o.error||((p=(u=xr)[I.state])==null?void 0:p.call(u)));if(k){const Y=()=>{this.state===this.states.disconnected&&(this.lastAutoReconnectAttempt=Date.now(),this.requestState({state:"connecting"}))},he=this.lastAutoReconnectAttempt&&Date.now()-this.lastAutoReconnectAttempt+1;he&&he<1e3?(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+he+"ms ago, waiting another "+(1e3-he)+"ms before trying again"),setTimeout(Y,1e3-he)):x.Config.nextTick(Y)}else(_==="disconnected"||_==="suspended")&&this.startRetryTimer(B);(_==="disconnected"&&!k||_==="suspended"||I.terminal)&&x.Config.nextTick(()=>{this.disconnectAllTransports()}),_=="connected"&&!this.activeProtocol&&S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(Z),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(_,Z.reason),this.failQueuedMessages(Z.reason))}requestState(o){var u,p;const _=o.state;if(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+_+"; current state: "+this.state.state),_==this.state.state||(this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(_),_=="connecting"&&this.state.state=="connected")||_=="closing"&&this.state.state=="closed")return;const k=this.states[_],I=new rs(this.state.state,k.state,null,o.error||((p=(u=xr)[k.state])==null?void 0:p.call(u)));this.enactStateChange(I),_=="connecting"&&x.Config.nextTick(()=>{this.startConnect()}),_=="closing"&&this.closeImpl()}startConnect(){if(this.state!==this.states.connecting){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}const o=this.realtime.auth,u=++this.connectCounter,p=()=>{this.checkConnectionStateFreshness(),this.getTransportParams(_=>{if(_.mode==="recover"&&_.options.recover){const k=os(_.options.recover);k&&this.realtime.channels.recoverChannels(k.channelSerials)}u===this.connectCounter&&this.connectImpl(_,u)})};if(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),o.method==="basic")p();else{const _=k=>{u===this.connectCounter&&(k?this.actOnErrorFromAuthorize(k):p())};this.errorReason&&un.isTokenErr(this.errorReason)?Nt(o._forceNewToken(null,null),_):Nt(o._ensureValidAuthCredentials(!1),_)}}connectImpl(o,u){const p=this.state.state;if(p!==this.states.connecting.state){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect, but was "+p);return}const _=this.getTransportPreference();_&&_===this.baseTransport&&this.webSocketTransportAvailable&&this.checkWsConnectivity().then(()=>{this.unpersistTransportPreference(),this.state===this.states.connecting&&(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.connectImpl():","web socket connectivity available, cancelling connection attempt with "+this.baseTransport),this.disconnectAllTransports(),this.connectWs(o,++this.connectCounter))}).catch(Ga),_&&_===this.baseTransport||this.baseTransport&&!this.webSocketTransportAvailable?this.connectBase(o,u):this.connectWs(o,u)}connectWs(o,u){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.connectWs()"),this.wsCheckResult=null,this.abandonedWebSocket=!1,this.startWebSocketSlowTimer(),this.startWebSocketGiveUpTimer(o),this.tryTransportWithFallbacks("web_socket",o,!0,u,()=>this.wsCheckResult!==!1&&!this.abandonedWebSocket)}connectBase(o,u){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.connectBase()"),this.baseTransport?this.tryTransportWithFallbacks(this.baseTransport,o,!1,u,()=>!0):this.notifyState({state:"disconnected",error:new J("No transports left to try",8e4,404)})}tryTransportWithFallbacks(o,u,p,_,k){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.tryTransportWithFallbacks()",o);const I=de=>{this.notifyState({state:this.states.connecting.failState,error:de})},B=this.domains.slice(),Z=(de,Ee)=>{if(_===this.connectCounter){if(!k()){Ee&&Ee.dispose();return}!Ee&&!de&&he()}},Y=B.shift();if(!Y){I(new J("Unable to connect (no available host)",80003,404));return}u.host=Y;const he=()=>{if(!B.length){I(new J("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!this.realtime.http.checkConnectivity){I(new De("Internal error: Http.checkConnectivity not set",null,500));return}Nt(this.realtime.http.checkConnectivity(),(de,Ee)=>{if(_===this.connectCounter&&k()){if(de){I(de);return}if(!Ee){I(new J("Unable to connect (network unreachable)",80003,404));return}u.host=mt(B),this.tryATransport(u,o,Z)}})};if(this.forceFallbackHost&&B.length){this.forceFallbackHost=!1,he();return}this.tryATransport(u,o,Z)}closeImpl(){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),this.pendingTransport&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+this.pendingTransport),this.pendingTransport.close()),this.activeProtocol&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})}onAuthUpdated(o,u){var p;switch(this.state.state){case"connected":{S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport");const _=(p=this.activeProtocol)==null?void 0:p.getTransport();_&&_.onAuthUpdated&&_.onAuthUpdated(o);const k=En({action:Ce.AUTH,auth:{accessToken:o.token}});this.send(k);const I=()=>{this.off(B),u(null,o)},B=Z=>{Z.current==="failed"&&(this.off(I),this.off(B),u(Z.reason||this.getStateError()))};this.once("connectiondetails",I),this.on("connectionstate",B);break}case"connecting":S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");const _=k=>{switch(k.current){case"connected":this.off(_),u(null,o);break;case"failed":case"closed":case"suspended":this.off(_),u(k.reason||this.getStateError());break}};this.on("connectionstate",_),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}}disconnectAllTransports(){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"),this.connectCounter++,this.pendingTransport&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+this.pendingTransport),this.pendingTransport.disconnect()),delete this.pendingTransport,this.proposedTransport&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting proposed transport: "+this.pendingTransport),this.proposedTransport.disconnect()),delete this.pendingTransport,this.activeProtocol&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())}send(o,u,p){p=p||Ga;const _=this.state;if(_.sendEvents){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new Ha(o,p));return}if(!(u&&_.queueEvents)){const I="rejecting event, queueEvent was "+u+", state was "+_.state;S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.send()",I),p(this.errorReason||new J(I,9e4,400));return}this.logger.shouldLog(S.LOG_MICRO)&&S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+Wa(o,this.realtime._RealtimePresence,this.realtime._Annotations,this.realtime._objectsPlugin)),this.queue(o,p)}sendImpl(o){const u=o.message;o.ackRequired&&!o.sendAttempted&&(u.msgSerial=this.msgSerial++);try{this.activeProtocol.send(o)}catch(p){S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+p.stack)}}queue(o,u){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.queue()","queueing event");const p=this.queuedMessages.last(),_=this.options.maxMessageSize;p&&!p.sendAttempted&&kp(p.message,o,_)?(p.merged||(p.callback=pr.create(this.logger,[p.callback]),p.merged=!0),p.callback.push(u)):this.queuedMessages.push(new Ha(o,u))}sendQueuedMessages(){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");let o;for(;o=this.queuedMessages.shift();)this.sendImpl(o)}queuePendingMessages(o){o&&o.length&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+o.length+" pending messages"),this.queuedMessages.prepend(o))}failQueuedMessages(o){const u=this.queuedMessages.count();u>0&&(S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+u+" queued messages, err = "+Ze(o)),this.queuedMessages.completeAllMessages(o))}onChannelMessage(o,u){this.pendingChannelMessagesState.queue.push({message:o,transport:u}),this.pendingChannelMessagesState.isProcessing||this.processNextPendingChannelMessage()}processNextPendingChannelMessage(){if(this.pendingChannelMessagesState.queue.length>0){this.pendingChannelMessagesState.isProcessing=!0;const o=this.pendingChannelMessagesState.queue.shift();this.processChannelMessage(o.message).catch(u=>{S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.processNextPendingChannelMessage() received error ",u)}).finally(()=>{this.pendingChannelMessagesState.isProcessing=!1,this.processNextPendingChannelMessage()})}}async processChannelMessage(o){await this.realtime.channels.processChannelMessage(o)}async ping(){var o;if(this.state.state!=="connected")throw new J("Unable to ping service; not connected",4e4,400);const u=(o=this.activeProtocol)==null?void 0:o.getTransport();if(!u)throw this.getStateError();S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.ping()","transport = "+u);const p=Date.now(),_=Jt();return Dn(new Promise(k=>{const I=B=>{B===_&&(u.off("heartbeat",I),k(Date.now()-p))};u.on("heartbeat",I),u.ping(_)}),this.options.timeouts.realtimeRequestTimeout,"Timeout waiting for heartbeat response")}abort(o){this.activeProtocol.getTransport().fail(o)}getTransportPreference(){var o,u;return this.transportPreference||Lr()&&((u=(o=x.WebStorage)==null?void 0:o.get)==null?void 0:u.call(o,gl))}persistTransportPreference(o){var u,p;this.transportPreference=o.shortName,Lr()&&((p=(u=x.WebStorage)==null?void 0:u.set)==null||p.call(u,gl,o.shortName))}unpersistTransportPreference(){var o,u;this.transportPreference=null,Lr()&&((u=(o=x.WebStorage)==null?void 0:o.remove)==null||u.call(o,gl))}actOnErrorFromAuthorize(o){if(o.code===40171)this.notifyState({state:"failed",error:o});else if(o.code===40102)this.notifyState({state:"failed",error:o});else if(o.statusCode===ki.Forbidden){const u="Client configured authentication provider returned 403; failing the connection";S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",u),this.notifyState({state:"failed",error:new J(u,80019,403,o)})}else{const u="Client configured authentication provider request failed";S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",u),this.notifyState({state:this.state.failState,error:new J(u,80019,401,o)})}}onConnectionDetailsUpdate(o,u){if(!o)return;this.connectionDetails=o,o.maxMessageSize&&(this.options.maxMessageSize=o.maxMessageSize);const p=o.clientId;if(p){const k=this.realtime.auth._uncheckedSetClientId(p);if(k){S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",k.message),u.fail(k);return}}const _=o.connectionStateTtl;_&&(this.connectionStateTtl=_),this.maxIdleInterval=o.maxIdleInterval,this.emit("connectiondetails",o)}checkWsConnectivity(){const o=this.options.wsConnectivityCheckUrl||qe.wsConnectivityCheckUrl,u=new x.Config.WebSocket(o);return new Promise((p,_)=>{let k=!1;u.onopen=()=>{k||(k=!0,p(),u.close())},u.onclose=u.onerror=()=>{k||(k=!0,_())}})}sessionRecoveryName(){return this.options.recoveryKeyStorageName||"ably-connection-recovery"}getSessionRecoverData(){var o,u;return ss()&&((u=(o=x.WebStorage)==null?void 0:o.getSession)==null?void 0:u.call(o,this.sessionRecoveryName()))}setSessionRecoverData(o){var u,p;return ss()&&((p=(u=x.WebStorage)==null?void 0:u.setSession)==null?void 0:p.call(u,this.sessionRecoveryName(),o))}clearSessionRecoverData(){var o,u;return ss()&&((u=(o=x.WebStorage)==null?void 0:o.removeSession)==null?void 0:u.call(o,this.sessionRecoveryName()))}},ml=kd,kt=class extends St{constructor(s,o){super(s.logger),this.whenState=u=>St.prototype.whenState.call(this,u,this.state),this.ably=s,this.connectionManager=new ml(s,o),this.state=this.connectionManager.state.state,this.key=void 0,this.id=void 0,this.errorReason=null,this.connectionManager.on("connectionstate",u=>{const p=this.state=u.current;x.Config.nextTick(()=>{this.emit(p,u)})}),this.connectionManager.on("update",u=>{x.Config.nextTick(()=>{this.emit("update",u)})})}connect(){S.logAction(this.logger,S.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})}async ping(){return S.logAction(this.logger,S.LOG_MINOR,"Connection.ping()",""),this.connectionManager.ping()}close(){S.logAction(this.logger,S.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})}get recoveryKey(){return this.logger.deprecationWarning("The `Connection.recoveryKey` attribute has been replaced by the `Connection.createRecoveryKey()` method. Replace your usage of `recoveryKey` with the return value of `createRecoveryKey()`. `recoveryKey` will be removed in a future version."),this.createRecoveryKey()}createRecoveryKey(){return this.connectionManager.createRecoveryKey()}},vl=kt,Xo=class rw extends Ar{constructor(o){var u,p,_,k;if(super(qe.objectifyOptions(o,!1,"BaseRealtime",S.defaultLogger)),S.logAction(this.logger,S.LOG_MINOR,"Realtime()",""),typeof EdgeRuntime=="string")throw new J(`Ably.Realtime instance cannot be used in Vercel Edge runtime. If you are running Vercel Edge functions, please replace your "new Ably.Realtime()" with "new Ably.Rest()" and use Ably Rest API instead of the Realtime API. If you are server-rendering your application in the Vercel Edge runtime, please use the condition "if (typeof EdgeRuntime === 'string')" to prevent instantiating Ably.Realtime instance during SSR in the Vercel Edge runtime.`,4e4,400);this._additionalTransportImplementations=rw.transportImplementationsFromPlugins(this.options.plugins),this._RealtimePresence=(p=(u=this.options.plugins)==null?void 0:u.RealtimePresence)!=null?p:null,this._objectsPlugin=(k=(_=this.options.plugins)==null?void 0:_.Objects)!=null?k:null,this.connection=new vl(this,this.options),this._channels=new Cd(this),this.options.autoConnect!==!1&&this.connect()}static transportImplementationsFromPlugins(o){const u={};return o?.WebSocketTransport&&(u[dn.WebSocket]=o.WebSocketTransport),o?.XHRPolling&&(u[dn.XhrPolling]=o.XHRPolling),u}get channels(){return this._channels}connect(){S.logAction(this.logger,S.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()}close(){S.logAction(this.logger,S.LOG_MINOR,"Realtime.close()",""),this.connection.close()}};Xo.EventEmitter=St;var Zo=Xo,Cd=class extends St{constructor(s){super(s.logger),this.realtime=s,this.all=Object.create(null),s.connection.connectionManager.on("transport.active",()=>{this.onTransportActive()})}channelSerials(){let s={};for(const o of $e(this.all,!0)){const u=this.all[o];u.properties.channelSerial&&(s[o]=u.properties.channelSerial)}return s}recoverChannels(s){for(const o of $e(s,!0)){const u=this.get(o);u.properties.channelSerial=s[o]}}async processChannelMessage(s){const o=s.channel;if(o===void 0){S.logAction(this.logger,S.LOG_ERROR,"Channels.processChannelMessage()","received event unspecified channel, action = "+s.action);return}const u=this.all[o];if(!u){S.logAction(this.logger,S.LOG_ERROR,"Channels.processChannelMessage()","received event for non-existent channel: "+o);return}await u.processMessage(s)}onTransportActive(){for(const s in this.all){const o=this.all[s];o.state==="attaching"||o.state==="detaching"?o.checkPendingState():o.state==="suspended"?o._attach(!1,null):o.state==="attached"&&o.requestState("attaching")}}propogateConnectionInterruption(s,o){const u={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},p=["attaching","attached","detaching","suspended"],_=u[s];for(const k in this.all){const I=this.all[k];p.includes(I.state)&&I.notifyState(_,o)}}get(s,o){s=String(s);let u=this.all[s];if(!u)u=this.all[s]=new qs(this.realtime,s,o);else if(o){if(u._shouldReattachToSetOptions(o,u.channelOptions))throw new J("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);u.setOptions(o)}return u}getDerived(s,o,u){if(o.filter){const p=Yn(o.filter),_=_i(s);s=`[filter=${p}${_.qualifierParam}]${_.channelName}`}return this.get(s,u)}release(s){s=String(s);const o=this.all[s];if(!o)return;const u=o.getReleaseErr();if(u)throw u;delete this.all[s]}},yl=Zo;function ea(s,o){if(s.isSynthesized()||o.isSynthesized())return s.timestamp>=o.timestamp;const u=s.parseId(),p=o.parseId();return u.msgSerial===p.msgSerial?u.index>p.index:u.msgSerial>p.msgSerial}var Ws=class extends St{constructor(s,o,u=ea){super(s.logger),this.presence=s,this.map=Object.create(null),this.syncInProgress=!1,this.residualMembers=null,this.memberKey=o,this.newerThan=u}get(s){return this.map[s]}getClient(s){const o=this.map,u=[];for(const p in o){const _=o[p];_.clientId==s&&_.action!="absent"&&u.push(_)}return u}list(s){const o=this.map,u=s&&s.clientId,p=s&&s.connectionId,_=[];for(const k in o){const I=o[k];I.action!=="absent"&&(u&&u!=I.clientId||p&&p!=I.connectionId||_.push(I))}return _}put(s){(s.action==="enter"||s.action==="update")&&(s=Pi.fromValues(s),s.action="present");const o=this.map,u=this.memberKey(s);this.residualMembers&&delete this.residualMembers[u];const p=o[u];return p&&!this.newerThan(s,p)?!1:(o[u]=s,!0)}values(){const s=this.map,o=[];for(const u in s){const p=s[u];p.action!="absent"&&o.push(p)}return o}remove(s){const o=this.map,u=this.memberKey(s),p=o[u];return p&&!this.newerThan(s,p)?!1:(this.syncInProgress?(s=Pi.fromValues(s),s.action="absent",o[u]=s):delete o[u],!!p)}startSync(){const s=this.map,o=this.syncInProgress;S.logAction(this.logger,S.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+o),this.syncInProgress||(this.residualMembers=ge(s),this.setInProgress(!0))}endSync(){const s=this.map,o=this.syncInProgress;if(S.logAction(this.logger,S.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+o),o){for(const u in s)s[u].action==="absent"&&delete s[u];this.presence._synthesizeLeaves(Xe(this.residualMembers));for(const u in this.residualMembers)delete s[u];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")}waitSync(s){const o=this.syncInProgress;if(S.logAction(this.logger,S.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+o),!o){s();return}this.once("sync",s)}clear(){this.map={},this.setInProgress(!1),this.residualMembers=null}setInProgress(s){S.logAction(this.logger,S.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+s),this.syncInProgress=s,this.presence.syncComplete=!s}};function Hs(s){return s.channel.client.auth.clientId}function Ja(s){const o=s.channel.client,u=o.auth.clientId;return(!u||u==="*")&&o.connection.state==="connected"}function Ep(s,o,u){switch(s.state){case"attached":case"suspended":u();break;case"initialized":case"detached":case"detaching":case"attaching":Nt(s.attach(),function(p){p?o(p):u()});break;default:o(J.fromValues(s.invalidStateError()))}}var Mp=class extends St{constructor(s){super(s.logger),this.channel=s,this.syncComplete=!1,this.members=new Ws(this,o=>o.clientId+":"+o.connectionId),this._myMembers=new Ws(this,o=>o.clientId),this.subscriptions=new St(this.logger),this.pendingPresence=[]}async enter(s){if(Ja(this))throw new J("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,s,"enter")}async update(s){if(Ja(this))throw new J("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,s,"update")}async enterClient(s,o){return this._enterOrUpdateClient(void 0,s,o,"enter")}async updateClient(s,o){return this._enterOrUpdateClient(void 0,s,o,"update")}async _enterOrUpdateClient(s,o,u,p){const _=this.channel;if(!_.connectionManager.activeState())throw _.connectionManager.getError();S.logAction(this.logger,S.LOG_MICRO,"RealtimePresence."+p+"Client()","channel = "+_.name+", id = "+s+", client = "+(o||"(implicit) "+Hs(this)));const k=Pi.fromData(u);k.action=p,s&&(k.id=s),o&&(k.clientId=o);const I=await k.encode(_.channelOptions);switch(_.state){case"attached":return _.sendPresence([I]);case"initialized":case"detached":_.attach();case"attaching":return new Promise((B,Z)=>{this.pendingPresence.push({presence:I,callback:Y=>Y?Z(Y):B()})});default:{const B=new De("Unable to "+p+" presence channel while in "+_.state+" state",90001);throw B.code=90001,B}}}async leave(s){if(Ja(this))throw new J("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,s)}async leaveClient(s,o){const u=this.channel;if(!u.connectionManager.activeState())throw u.connectionManager.getError();S.logAction(this.logger,S.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+s);const p=Pi.fromData(o);p.action="leave",s&&(p.clientId=s);const _=await p.encode(u.channelOptions);switch(u.state){case"attached":return u.sendPresence([_]);case"attaching":return new Promise((k,I)=>{this.pendingPresence.push({presence:_,callback:B=>B?I(B):k()})});case"initialized":case"failed":throw new De("Unable to leave presence channel (incompatible state)",90001);default:throw u.invalidStateError()}}async get(s){const o=!s||("waitForSync"in s?s.waitForSync:!0);return new Promise((u,p)=>{function _(k){u(s?k.list(s):k.values())}if(this.channel.state==="suspended"){o?p(J.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):_(this.members);return}Ep(this.channel,k=>p(k),()=>{const k=this.members;o?k.waitSync(function(){_(k)}):_(k)})})}async history(s){S.logAction(this.logger,S.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name);const o=this.channel.client.rest.presenceMixin;if(s&&s.untilAttach)if(this.channel.state==="attached")delete s.untilAttach,s.from_serial=this.channel.properties.attachSerial;else throw new J("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400);return o.history(this,s)}setPresence(s,o,u){S.logAction(this.logger,S.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+s.length+" participants; syncChannelSerial = "+u);let p,_;const k=this.members,I=this._myMembers,B=[],Z=this.channel.connectionManager.connectionId;o&&(this.members.startSync(),u&&(_=u.match(/^[\w-]+:(.*)$/))&&(p=_[1]));for(let Y of s)switch(Y.action){case"leave":k.remove(Y)&&B.push(Y),Y.connectionId===Z&&!Y.isSynthesized()&&I.remove(Y);break;case"enter":case"present":case"update":k.put(Y)&&B.push(Y),Y.connectionId===Z&&I.put(Y);break}o&&!p&&(k.endSync(),this.channel.syncChannelSerial=null);for(let Y=0;Y<B.length;Y++){const he=B[Y];this.subscriptions.emit(he.action,he)}}onAttached(s){S.logAction(this.logger,S.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+s),s?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();const o=this.pendingPresence,u=o.length;if(u){this.pendingPresence=[];const p=[],_=pr.create(this.logger);S.logAction(this.logger,S.LOG_MICRO,"RealtimePresence.onAttached","sending "+u+" queued presence messages");for(let k=0;k<u;k++){const I=o[k];p.push(I.presence),_.push(I.callback)}this.channel.sendPresence(p).then(()=>_()).catch(k=>_(k))}}actOnChannelState(s,o,u){switch(s){case"attached":this.onAttached(o);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(u);break}}failPendingPresence(s){if(this.pendingPresence.length){S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+Ze(s));for(let o=0;o<this.pendingPresence.length;o++)try{this.pendingPresence[o].callback(s)}catch{}this.pendingPresence=[]}}_clearMyMembers(){this._myMembers.clear()}_ensureMyMembersPresent(){const s=this._myMembers,o=this.channel.connectionManager.connectionId;for(const u in s.map){const p=s.map[u];S.logAction(this.logger,S.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+p.clientId+'" into the presence set');const _=p.connectionId===o?p.id:void 0;this._enterOrUpdateClient(_,p.clientId,p.data,"enter").catch(k=>{const I=new J("Presence auto re-enter failed",91004,400,k);S.logAction(this.logger,S.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()","Presence auto re-enter failed; reason = "+Ze(k));const B=new ll(this.channel.state,this.channel.state,!0,!1,I);this.channel.emit("update",B)})}}_synthesizeLeaves(s){const o=this.subscriptions;s.forEach(function(u){const p=Pi.fromValues({action:"leave",connectionId:u.connectionId,clientId:u.clientId,data:u.data,encoding:u.encoding,timestamp:Date.now()});o.emit("leave",p)})}async subscribe(...s){const o=qs.processListenerArgs(s),u=o[0],p=o[1],_=this.channel;if(_.state==="failed")throw J.fromValues(_.invalidStateError());this.subscriptions.on(u,p),_.channelOptions.attachOnSubscribe!==!1&&await _.attach()}unsubscribe(...s){const o=qs.processListenerArgs(s),u=o[0],p=o[1];this.subscriptions.off(u,p)}},Ed=Mp,Qa=dn.WebSocket;function Ka(s){return!!s.on}var _l=class extends is{constructor(s,o,u){super(s,o,u),this.shortName=Qa,u.heartbeats=x.Config.useProtocolHeartbeats,this.wsHost=u.host}static isAvailable(){return!!x.Config.WebSocket}createWebSocket(s,o){return this.uri=s+At(o),new x.Config.WebSocket(this.uri)}toString(){return"WebSocketTransport; uri="+this.uri}connect(){S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.connect()","starting"),is.prototype.connect.call(this);const s=this,o=this.params,u=o.options,_=(u.tls?"wss://":"ws://")+this.wsHost+":"+qe.getPort(u)+"/";S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.connect()","uri: "+_),Nt(this.auth.getAuthParams(),function(k,I){if(s.isDisposed)return;let B="";for(const Y in I)B+=" "+Y+": "+I[Y]+";";if(S.logAction(s.logger,S.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+B+" err: "+k),k){s.disconnect(k);return}const Z=o.getConnectParams(I);try{const Y=s.wsConnection=s.createWebSocket(_,Z);Y.binaryType=x.Config.binaryType,Y.onopen=function(){s.onWsOpen()},Y.onclose=function(he){s.onWsClose(he)},Y.onmessage=function(he){s.onWsData(he.data)},Y.onerror=function(he){s.onWsError(he)},Ka(Y)&&Y.on("ping",function(){s.onActivity()})}catch(Y){S.logAction(s.logger,S.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(Y.stack||Y.message)),s.disconnect(Y)}})}send(s){const o=this.wsConnection;if(!o){S.logAction(this.logger,S.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{o.send(_p(s,this.connectionManager.realtime._MsgPack,this.params.format))}catch(u){const p="Exception from ws connection when trying to send: "+Ze(u);S.logAction(this.logger,S.LOG_ERROR,"WebSocketTransport.send()",p),this.finish("disconnected",new J(p,5e4,500))}}onWsData(s){S.logAction(this.logger,S.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+s.length+"; type = "+typeof s);try{this.onProtocolMessage(ol(s,this.connectionManager.realtime._MsgPack,this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin,this.format))}catch(o){S.logAction(this.logger,S.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+o.stack)}}onWsOpen(){S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")}onWsClose(s){let o,u;if(typeof s=="object"?(u=s.code,o=s.wasClean||u===1e3):(u=s,o=u==1e3),delete this.wsConnection,o){S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");const p=new J("Websocket closed",80003,400);this.finish("disconnected",p)}else{const p="Unclean disconnection of WebSocket ; code = "+u,_=new J(p,80003,400);S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.onWsClose()",p),this.finish("disconnected",_)}this.emit("disposed")}onWsError(s){S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+s.message),x.Config.nextTick(()=>{this.disconnect(Error(s.message))})}dispose(){S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;const s=this.wsConnection;s&&(s.onmessage=function(){},delete this.wsConnection,x.Config.nextTick(()=>{if(S.logAction(this.logger,S.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!s)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");s.close()}))}},Ya=_l,wl=class{static subscribeFilter(s,o,u){const p=_=>{var k,I,B,Z,Y,he;const de={name:_.name,refTimeserial:(I=(k=_.extras)==null?void 0:k.ref)==null?void 0:I.timeserial,refType:(Z=(B=_.extras)==null?void 0:B.ref)==null?void 0:Z.type,isRef:!!((he=(Y=_.extras)==null?void 0:Y.ref)!=null&&he.timeserial),clientId:_.clientId};Object.entries(o).find(([Ee,fe])=>fe!==void 0?de[Ee]!==fe:!1)||u(_)};this.addFilteredSubscription(s,o,u,p),s.subscriptions.on(p)}static addFilteredSubscription(s,o,u,p){var _;if(s.filteredSubscriptions||(s.filteredSubscriptions=new Map),s.filteredSubscriptions.has(u)){const k=s.filteredSubscriptions.get(u);k.set(o,((_=k?.get(o))==null?void 0:_.concat(p))||[p])}else s.filteredSubscriptions.set(u,new Map([[o,[p]]]))}static getAndDeleteFilteredSubscriptions(s,o,u){if(!s.filteredSubscriptions)return[];if(!u&&o)return Array.from(s.filteredSubscriptions.entries()).map(([k,I])=>{var B;let Z=I.get(o);return I.delete(o),I.size===0&&((B=s.filteredSubscriptions)==null||B.delete(k)),Z}).reduce((k,I)=>I?k.concat(...I):k,[]);if(!u||!s.filteredSubscriptions.has(u))return[];const p=s.filteredSubscriptions.get(u);if(!o){const k=Array.from(p.values()).reduce((I,B)=>I.concat(...B),[]);return s.filteredSubscriptions.delete(u),k}let _=p.get(o);return p.delete(o),_||[]}},Mn=class Sg extends yl{constructor(o){var u;const p=Sg._MsgPack;if(!p)throw new Error("Expected DefaultRealtime._MsgPack to have been set");super(qe.objectifyOptions(o,!0,"Realtime",S.defaultLogger,P(A({},Us),{Crypto:(u=Sg.Crypto)!=null?u:void 0,MsgPack:p,RealtimePresence:{RealtimePresence:Ed,PresenceMessage:Pi,WirePresenceMessage:Ds},Annotations:{Annotation:Go,WireAnnotation:Fs,RealtimeAnnotations:dl,RestAnnotations:$s},WebSocketTransport:Ya,MessageInteractions:wl})))}static get Crypto(){if(this._Crypto===null)throw new Error("Encryption not enabled; use ably.encryption.js instead");return this._Crypto}static set Crypto(o){this._Crypto=o}};Mn.Utils=Te,Mn.ConnectionManager=ml,Mn.ProtocolMessage=wp,Mn._Crypto=null,Mn.Message=dd,Mn.PresenceMessage=tl,Mn.Annotation=il,Mn._MsgPack=null,Mn._Http=Ps,Mn._PresenceMap=Ws,Mn._MessageEncoding=Yi;var bl=Mn,Xa=Uint8Array,ta=Uint32Array,Sl=Math.pow,Za=new ta(8),ti=[],Gs=new ta(64);function as(s){return(s-(s|0))*Sl(2,32)|0}for(var Tn=2,ni=0;ni<64;){for(vr=!0,Js=2;Js<=Tn/2;Js++)Tn%Js===0&&(vr=!1);vr&&(ni<8&&(Za[ni]=as(Sl(Tn,1/2))),ti[ni]=as(Sl(Tn,1/3)),ni++),Tn++}var vr,Js,Tp=!!new Xa(new ta([1]).buffer)[0];function kl(s){return Tp?s>>>24|(s>>>16&255)<<8|(s&65280)<<8|s<<24:s}function nn(s,o){return s>>>o|s<<32-o}function xi(s){var o=Za.slice(),u=s.length,p=u*8,_=512-(p+64)%512-1+p+65,k=new Xa(_/8),I=new ta(k.buffer);k.set(s,0),k[u]=128,I[I.length-1]=kl(p);for(var B,Z=0;Z<_/32;Z+=16){var Y=o.slice();for(B=0;B<64;B++){var he;if(B<16)he=kl(I[Z+B]);else{var de=Gs[B-15],Ee=Gs[B-2];he=Gs[B-7]+Gs[B-16]+(nn(de,7)^nn(de,18)^de>>>3)+(nn(Ee,17)^nn(Ee,19)^Ee>>>10)}Gs[B]=he|=0;for(var fe=(nn(Y[4],6)^nn(Y[4],11)^nn(Y[4],25))+(Y[4]&Y[5]^~Y[4]&Y[6])+Y[7]+he+ti[B],Ae=(nn(Y[0],2)^nn(Y[0],13)^nn(Y[0],22))+(Y[0]&Y[1]^Y[2]&(Y[0]^Y[1])),Pe=7;Pe>0;Pe--)Y[Pe]=Y[Pe-1];Y[0]=fe+Ae|0,Y[4]=Y[4]+fe|0}for(B=0;B<8;B++)o[B]=o[B]+Y[B]|0}return new Xa(new ta(o.map(function(Fe){return kl(Fe)})).buffer)}function Qs(s,o){if(s.length>64&&(s=xi(s)),s.length<64){const B=new Uint8Array(64);B.set(s,0),s=B}for(var u=new Uint8Array(64),p=new Uint8Array(64),_=0;_<64;_++)u[_]=54^s[_],p[_]=92^s[_];var k=new Uint8Array(o.length+64);k.set(u,0),k.set(o,64);var I=new Uint8Array(96);return I.set(p,0),I.set(xi(k),64),xi(I)}var ec=class{constructor(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}uint8ViewToBase64(s){let o="";const u=this.base64CharSet,p=s.byteLength,_=p%3,k=p-_;let I,B,Z,Y,he;for(let de=0;de<k;de=de+3)he=s[de]<<16|s[de+1]<<8|s[de+2],I=(he&16515072)>>18,B=(he&258048)>>12,Z=(he&4032)>>6,Y=he&63,o+=u[I]+u[B]+u[Z]+u[Y];return _==1?(he=s[k],I=(he&252)>>2,B=(he&3)<<4,o+=u[I]+u[B]+"=="):_==2&&(he=s[k]<<8|s[k+1],I=(he&64512)>>10,B=(he&1008)>>4,Z=(he&15)<<2,o+=u[I]+u[B]+u[Z]+"="),o}base64ToArrayBuffer(s){const o=atob?.(s),u=o.length,p=new Uint8Array(u);for(let _=0;_<u;_++){const k=o.charCodeAt(_);p[_]=k}return this.toArrayBuffer(p)}isBuffer(s){return s instanceof ArrayBuffer||ArrayBuffer.isView(s)}toBuffer(s){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(this.toArrayBuffer(s));throw new Error("BufferUtils.toBuffer expected an ArrayBuffer or a view onto one")}toArrayBuffer(s){if(!ArrayBuffer)throw new Error("Can't convert to ArrayBuffer: browser does not support the necessary types");if(s instanceof ArrayBuffer)return s;if(ArrayBuffer.isView(s))return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength);throw new Error("BufferUtils.toArrayBuffer expected an ArrayBuffer or a view onto one")}base64Encode(s){return this.uint8ViewToBase64(this.toBuffer(s))}base64UrlEncode(s){return this.base64Encode(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}base64Decode(s){if(ArrayBuffer&&x.Config.atob)return this.base64ToArrayBuffer(s);throw new Error("Expected ArrayBuffer to exist and Platform.Config.atob to be configured")}hexEncode(s){return this.toBuffer(s).reduce((u,p)=>u+p.toString(16).padStart(2,"0"),"")}hexDecode(s){if(s.length%2!==0)throw new Error("Can't create a byte array from a hex string of odd length");const o=new Uint8Array(s.length/2);for(let u=0;u<o.length;u++)o[u]=parseInt(s.slice(2*u,2*(u+1)),16);return this.toArrayBuffer(o)}utf8Encode(s){if(x.Config.TextEncoder){const o=new x.Config.TextEncoder().encode(s);return this.toArrayBuffer(o)}else throw new Error("Expected TextEncoder to be configured")}utf8Decode(s){if(!this.isBuffer(s))throw new Error("Expected input of utf8decode to be an arraybuffer or typed array");if(TextDecoder)return new TextDecoder().decode(s);throw new Error("Expected TextDecoder to be configured")}areBuffersEqual(s,o){if(!s||!o)return!1;const u=this.toArrayBuffer(s),p=this.toArrayBuffer(o);if(u.byteLength!=p.byteLength)return!1;const _=new Uint8Array(u),k=new Uint8Array(p);for(var I=0;I<_.length;I++)if(_[I]!=k[I])return!1;return!0}byteLength(s){return s instanceof ArrayBuffer||ArrayBuffer.isView(s)?s.byteLength:-1}arrayBufferViewToBuffer(s){return this.toArrayBuffer(s)}concat(s){const o=s.reduce((_,k)=>_+k.byteLength,0),u=new Uint8Array(o);let p=0;for(const _ of s){const k=this.toBuffer(_);u.set(k,p),p+=k.byteLength}return u.buffer}sha256(s){const o=xi(this.toBuffer(s));return this.toArrayBuffer(o)}hmacSha256(s,o){const u=Qs(this.toBuffer(o),this.toBuffer(s));return this.toArrayBuffer(u)}},tc=new ec,Ks=function(s,o){var u="aes",p=256,_="cbc",k=16;function I(Ee){if(Ee.algorithm==="aes"&&Ee.mode==="cbc"){if(Ee.keyLength===128||Ee.keyLength===256)return;throw new Error("Unsupported key length "+Ee.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function B(Ee){return Ee.replace("_","/").replace("-","+")}function Z(Ee){return Ee instanceof Y}class Y{constructor(fe,Ae,Pe,Fe){this.algorithm=fe,this.keyLength=Ae,this.mode=Pe,this.key=Fe}}class he{static getDefaultParams(fe){var Ae;if(!fe.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof fe.key=="string"?Ae=o.toArrayBuffer(o.base64Decode(B(fe.key))):fe.key instanceof ArrayBuffer?Ae=fe.key:Ae=o.toArrayBuffer(fe.key);var Pe=fe.algorithm||u,Fe=Ae.byteLength*8,lt=fe.mode||_,ft=new Y(Pe,Fe,lt,Ae);if(fe.keyLength&&fe.keyLength!==ft.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+fe.keyLength+" was specified, but the key actually has length "+ft.keyLength);return I(ft),ft}static async generateRandomKey(fe){try{return s.getRandomArrayBuffer((fe||p)/8)}catch(Ae){throw new J("Failed to generate random key: "+Ae.message,400,5e4,Ae)}}static getCipher(fe,Ae){var Pe,Fe=Z(fe)?fe:this.getDefaultParams(fe);return{cipherParams:Fe,cipher:new de(Fe,(Pe=fe.iv)!=null?Pe:null,Ae)}}}he.CipherParams=Y;class de{constructor(fe,Ae,Pe){if(this.logger=Pe,!crypto.subtle)throw isSecureContext?new Error("Crypto operations are not possible since the browsers SubtleCrypto class is unavailable (reason unknown)."):new Error("Crypto operations are is not possible since the current environment is a non-secure context and hence the browsers SubtleCrypto class is not available.");this.algorithm=fe.algorithm+"-"+String(fe.keyLength)+"-"+fe.mode,this.webCryptoAlgorithm=fe.algorithm+"-"+fe.mode,this.key=o.toArrayBuffer(fe.key),this.iv=Ae?o.toArrayBuffer(Ae):null}concat(fe,Ae){const Pe=new ArrayBuffer(fe.byteLength+Ae.byteLength),Fe=new DataView(Pe),lt=new DataView(o.toArrayBuffer(fe));for(let We=0;We<lt.byteLength;We++)Fe.setInt8(We,lt.getInt8(We));const ft=new DataView(o.toArrayBuffer(Ae));for(let We=0;We<ft.byteLength;We++)Fe.setInt8(lt.byteLength+We,ft.getInt8(We));return Pe}async encrypt(fe){S.logAction(this.logger,S.LOG_MICRO,"CBCCipher.encrypt()","");const Ae=await this.getIv(),Pe=await crypto.subtle.importKey("raw",this.key,this.webCryptoAlgorithm,!1,["encrypt"]),Fe=await crypto.subtle.encrypt({name:this.webCryptoAlgorithm,iv:Ae},Pe,fe);return this.concat(Ae,Fe)}async decrypt(fe){S.logAction(this.logger,S.LOG_MICRO,"CBCCipher.decrypt()","");const Ae=o.toArrayBuffer(fe),Pe=Ae.slice(0,k),Fe=Ae.slice(k),lt=await crypto.subtle.importKey("raw",this.key,this.webCryptoAlgorithm,!1,["decrypt"]);return crypto.subtle.decrypt({name:this.webCryptoAlgorithm,iv:Pe},lt,Fe)}async getIv(){if(this.iv){var fe=this.iv;return this.iv=null,fe}const Ae=await s.getRandomArrayBuffer(k);return o.toArrayBuffer(Ae)}}return he},ri=(s=>(s[s.REQ_SEND=0]="REQ_SEND",s[s.REQ_RECV=1]="REQ_RECV",s[s.REQ_RECV_POLL=2]="REQ_RECV_POLL",s[s.REQ_RECV_STREAM=3]="REQ_RECV_STREAM",s))(ri||{}),ct=ri;function vt(){return new J("No HTTP request plugin provided. Provide at least one of the FetchRequest or XHRRequest plugins.",400,4e4)}var tr,Kt=(tr=class{constructor(s){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1;var o;this.client=s??null;const u=s?.options.connectivityCheckUrl||qe.connectivityCheckUrl,p=(o=s?.options.connectivityCheckParams)!=null?o:null,_=!s?.options.connectivityCheckUrl,k=A(A({},Kt.bundledRequestImplementations),s?._additionalHTTPRequestImplementations),I=k.XHRRequest,B=k.FetchRequest,Z=!!(I||B);if(!Z)throw vt();x.Config.xhrSupported&&I?(this.supportsAuthHeaders=!0,this.Request=async function(Y,he,de,Ee,fe){return new Promise(Ae=>{var Pe;const Fe=I.createRequest(he,de,Ee,fe,ct.REQ_SEND,(Pe=s&&s.options.timeouts)!=null?Pe:null,this.logger,Y);Fe.once("complete",(lt,ft,We,He,hn)=>Ae({error:lt,body:ft,headers:We,unpacked:He,statusCode:hn})),Fe.exec()})},s?.options.disableConnectivityCheck?this.checkConnectivity=async function(){return!0}:this.checkConnectivity=async function(){var Y;S.logAction(this.logger,S.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+u);const he=await this.doUri(Tt.Get,u,null,null,p);let de=!1;return _?de=!he.error&&((Y=he.body)==null?void 0:Y.replace(/\n/,""))=="yes":de=!he.error&&Wc(he.statusCode),S.logAction(this.logger,S.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+de),de}):x.Config.fetchSupported&&B?(this.supportsAuthHeaders=!0,this.Request=async(Y,he,de,Ee,fe)=>B(Y,s??null,he,de,Ee,fe),s?.options.disableConnectivityCheck?this.checkConnectivity=async function(){return!0}:this.checkConnectivity=async function(){var Y;S.logAction(this.logger,S.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+u);const he=await this.doUri(Tt.Get,u,null,null,null),de=!he.error&&((Y=he.body)==null?void 0:Y.replace(/\n/,""))=="yes";return S.logAction(this.logger,S.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+de),de}):this.Request=async()=>({error:Z?new De("no supported HTTP transports available",null,400):vt()})}get logger(){var s,o;return(o=(s=this.client)==null?void 0:s.logger)!=null?o:S.defaultLogger}async doUri(s,o,u,p,_){return this.Request?this.Request(s,o,u,_,p):{error:new De("Request invoked before assigned to",null,500)}}shouldFallback(s){const o=s.statusCode;return o===408&&!s.code||o===400&&!s.code||o>=500&&o<=504}},tr.methods=[Tt.Get,Tt.Delete,Tt.Post,Tt.Put,Tt.Patch],tr.methodsWithoutBody=[Tt.Get,Tt.Delete],tr.methodsWithBody=[Tt.Post,Tt.Put,Tt.Patch],tr),fn=Kt,nr="ablyjs-storage-test",yr=typeof ds<"u"?ds:typeof window<"u"?window:self,On=class{constructor(){try{yr.sessionStorage.setItem(nr,nr),yr.sessionStorage.removeItem(nr),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{yr.localStorage.setItem(nr,nr),yr.localStorage.removeItem(nr),this.localSupported=!0}catch{this.localSupported=!1}}get(s){return this._get(s,!1)}getSession(s){return this._get(s,!0)}remove(s){return this._remove(s,!1)}removeSession(s){return this._remove(s,!0)}set(s,o,u){return this._set(s,o,u,!1)}setSession(s,o,u){return this._set(s,o,u,!0)}_set(s,o,u,p){const _={value:o};return u&&(_.expires=Date.now()+u),this.storageInterface(p).setItem(s,JSON.stringify(_))}_get(s,o){if(o&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!o&&!this.localSupported)throw new Error("Local Storage not supported");const u=this.storageInterface(o).getItem(s);if(!u)return null;const p=JSON.parse(u);return p.expires&&p.expires<Date.now()?(this.storageInterface(o).removeItem(s),null):p.value}_remove(s,o){return this.storageInterface(o).removeItem(s)}storageInterface(s){return s?yr.sessionStorage:yr.localStorage}},na=new On,It=jo(),Md=typeof EdgeRuntime=="string";typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&!Md&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function nc(){const s=It.location;return!It.WebSocket||!s||!s.origin||s.origin.indexOf("http")>-1}function Td(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}var ii=It.navigator&&It.navigator.userAgent.toString(),rc=It.location&&It.location.href,Cl={agent:"browser",logTimestamps:!0,userAgent:ii,currentUrl:rc,binaryType:"arraybuffer",WebSocket:It.WebSocket,fetchSupported:!!It.fetch,xhrSupported:It.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,allowComet:nc(),useProtocolHeartbeats:!0,supportsBinary:!!It.TextDecoder,preferBinary:!1,ArrayBuffer:It.ArrayBuffer,atob:It.atob,nextTick:typeof It.queueMicrotask=="function"?s=>It.queueMicrotask(s):s=>Promise.resolve().then(s),addEventListener:It.addEventListener,inspect:JSON.stringify,stringByteSize:function(s){return It.TextDecoder&&new It.TextEncoder().encode(s).length||s.length},TextEncoder:It.TextEncoder,TextDecoder:It.TextDecoder,getRandomArrayBuffer:async function(s){const o=new Uint8Array(s);return It.crypto.getRandomValues(o),o.buffer},isWebworker:Td(),push:{platform:"browser",formFactor:"desktop",storage:na}},El=Cl;function Op(s){const o=[80015,80017,80030];return s.code?un.isTokenErr(s)?!1:o.includes(s.code)?!0:s.code>=4e4&&s.code<5e4:!1}function jr(s){return Op(s)?[En({action:Ce.ERROR,error:s})]:[En({action:Ce.DISCONNECTED,error:s})]}var Ys=class extends is{constructor(s,o,u){super(s,o,u,!0),this.onAuthUpdated=p=>{this.authParams={access_token:p.token}},this.stream="stream"in u?u.stream:!0,this.sendRequest=null,this.recvRequest=null,this.pendingCallback=null,this.pendingItems=null}connect(){S.logAction(this.logger,S.LOG_MINOR,"CometTransport.connect()","starting"),is.prototype.connect.call(this);const s=this.params,o=s.options,u=s.host||o.primaryDomain,p=qe.getPort(o),_=o.tls?"https://":"http://";this.baseUri=_+u+":"+p+"/comet/";const k=this.baseUri+"connect";S.logAction(this.logger,S.LOG_MINOR,"CometTransport.connect()","uri: "+k),Nt(this.auth.getAuthParams(),(I,B)=>{if(I){this.disconnect(I);return}if(this.isDisposed)return;this.authParams=B;const Z=this.params.getConnectParams(B);"stream"in Z&&(this.stream=Z.stream),S.logAction(this.logger,S.LOG_MINOR,"CometTransport.connect()","connectParams:"+At(Z));let Y=!1;const he=this.recvRequest=this.createRequest(k,null,Z,null,this.stream?ct.REQ_RECV_STREAM:ct.REQ_RECV);he.on("data",de=>{this.recvRequest&&(Y||(Y=!0,this.emit("preconnect")),this.onData(de))}),he.on("complete",de=>{if(this.recvRequest||(de=de||new J("Request cancelled",80003,400)),this.recvRequest=null,!Y&&!de&&(Y=!0,this.emit("preconnect")),this.onActivity(),de){de.code?this.onData(jr(de)):this.disconnect(de);return}x.Config.nextTick(()=>{this.recv()})}),he.exec()})}requestClose(){S.logAction(this.logger,S.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)}requestDisconnect(){S.logAction(this.logger,S.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)}_requestCloseOrDisconnect(s){const o=s?this.closeUri:this.disconnectUri;if(o){const u=this.createRequest(o,null,this.authParams,null,ct.REQ_SEND);u.on("complete",p=>{p&&(S.logAction(this.logger,S.LOG_ERROR,"CometTransport.request"+(s?"Close()":"Disconnect()"),"request returned err = "+Ze(p)),this.finish("disconnected",p))}),u.exec()}}dispose(){S.logAction(this.logger,S.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(S.logAction(this.logger,S.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",xr.disconnected()),x.Config.nextTick(()=>{this.emit("disposed")}))}onConnect(s){var o;if(this.isDisposed)return;const u=(o=s.connectionDetails)==null?void 0:o.connectionKey;is.prototype.onConnect.call(this,s);const p=this.baseUri+u;S.logAction(this.logger,S.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+p),this.sendUri=p+"/send",this.recvUri=p+"/recv",this.closeUri=p+"/close",this.disconnectUri=p+"/disconnect"}send(s){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(s);return}const o=this.pendingItems||[];o.push(s),this.pendingItems=null,this.sendItems(o)}sendAnyPending(){const s=this.pendingItems;s&&(this.pendingItems=null,this.sendItems(s))}sendItems(s){const o=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(s),ct.REQ_SEND);o.on("complete",(u,p)=>{if(u&&S.logAction(this.logger,S.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+Ze(u)),this.sendRequest=null,u){u.code?this.onData(jr(u)):this.disconnect(u);return}p&&this.onData(p),this.pendingItems&&x.Config.nextTick(()=>{this.sendRequest||this.sendAnyPending()})}),o.exec()}recv(){if(this.recvRequest||!this.isConnected)return;const s=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?ct.REQ_RECV_STREAM:ct.REQ_RECV_POLL);s.on("data",o=>{this.onData(o)}),s.on("complete",o=>{if(this.recvRequest=null,this.onActivity(),o){o.code?this.onData(jr(o)):this.disconnect(o);return}x.Config.nextTick(()=>{this.recv()})}),s.exec()}onData(s){try{const o=this.decodeResponse(s);if(o&&o.length)for(let u=0;u<o.length;u++)this.onProtocolMessage(Qo(o[u],this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin))}catch(o){S.logAction(this.logger,S.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+o.stack)}}encodeRequest(s){return JSON.stringify(s)}decodeResponse(s){return typeof s=="string"?JSON.parse(s):s}},Xs=Ys;function ic(s,o){return Qr($e(o)).includes("x-ably-errorcode")}function sc(s,o){if(ic(s,o))return s.error&&J.fromValues(s.error)}var rr=function(){},ir=0,Li={};function si(s,o){return s.getResponseHeader&&s.getResponseHeader(o)}function oi(s){return s.getResponseHeader&&(s.getResponseHeader("transfer-encoding")||!s.getResponseHeader("content-length"))}function cs(s){const o=s.getAllResponseHeaders().trim().split(`\r
`),u={};for(let p=0;p<o.length;p++){const _=o[p].split(":").map(k=>k.trim());u[_[0].toLowerCase()]=_[1]}return u}var Od=class iw extends St{constructor(o,u,p,_,k,I,B,Z){super(B),p=p||{},p.rnd=Jt(),this.uri=o+At(p),this.headers=u||{},this.body=_,this.method=Z?Z.toUpperCase():ue(_)?"GET":"POST",this.requestMode=k,this.timeouts=I,this.timedOut=!1,this.requestComplete=!1,this.id=String(++ir),Li[this.id]=this}static createRequest(o,u,p,_,k,I,B,Z){const Y=I||qe.TIMEOUTS;return new iw(o,u,ge(p),_,k,Y,B,Z)}complete(o,u,p,_,k){this.requestComplete||(this.requestComplete=!0,!o&&u&&this.emit("data",u),this.emit("complete",o,u,p,_,k),this.dispose())}abort(){this.dispose()}exec(){let o=this.headers;const u=this.requestMode==ct.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,p=this.timer=setTimeout(()=>{this.timedOut=!0,k.abort()},u),_=this.method,k=this.xhr=new XMLHttpRequest,I=o.accept;let B=this.body,Z="text";I?I.indexOf("application/x-msgpack")===0&&(Z="arraybuffer"):o.accept="application/json",B&&(o["content-type"]||(o["content-type"]="application/json")).indexOf("application/json")>-1&&typeof B!="string"&&(B=JSON.stringify(B)),k.open(_,this.uri,!0),k.responseType=Z,"authorization"in o&&(k.withCredentials=!0);for(const He in o)k.setRequestHeader(He,o[He]);const Y=(He,hn,qt,Di)=>{var Ui;let ai=hn+" (event type: "+He.type+")";(Ui=this==null?void 0:this.xhr)!=null&&Ui.statusText&&(ai+=", current statusText is "+this.xhr.statusText),S.logAction(this.logger,S.LOG_ERROR,"Request.on"+He.type+"()",ai),this.complete(new De(ai,qt,Di))};k.onerror=He=>{Y(He,"XHR error occurred",null,400)},k.onabort=He=>{this.timedOut?Y(He,"Request aborted due to request timeout expiring",null,408):Y(He,"Request cancelled",null,400)},k.ontimeout=He=>{Y(He,"Request timed out",null,408)};let he,de,Ee,fe=0,Ae=!1;const Pe=()=>{if(clearTimeout(p),Ee=de<400,de==204){this.complete(null,null,null,null,de);return}he=this.requestMode==ct.REQ_RECV_STREAM&&Ee&&oi(k)},Fe=()=>{let He;try{const qt=si(k,"content-type");if(qt?qt.indexOf("application/json")>=0:k.responseType=="text"){const Ui=k.responseType==="arraybuffer"?x.BufferUtils.utf8Decode(k.response):String(k.responseText);Ui.length?He=JSON.parse(Ui):He=Ui,Ae=!0}else He=k.response;He.response!==void 0?(de=He.statusCode,Ee=de<400,o=He.headers,He=He.response):o=cs(k)}catch(qt){this.complete(new De("Malformed response body from server: "+qt.message,null,400));return}if(Ee||Array.isArray(He)){this.complete(null,He,o,Ae,de);return}let hn=sc(He,o);hn||(hn=new De("Error response received from server: "+de+" body was: "+x.Config.inspect(He),null,de)),this.complete(hn,He,o,Ae,de)};function lt(){const He=k.responseText,hn=He.length-1;let qt,Di;for(;fe<hn&&(qt=He.indexOf(`
`,fe))>-1;)Di=He.slice(fe,qt),fe=qt+1,ft(Di)}const ft=He=>{try{He=JSON.parse(He)}catch(hn){this.complete(new De("Malformed response body from server: "+hn.message,null,400));return}this.emit("data",He)},We=()=>{lt(),this.streamComplete=!0,x.Config.nextTick(()=>{this.complete()})};k.onreadystatechange=()=>{const He=k.readyState;He<3||k.status!==0&&(de===void 0&&(de=k.status,Pe()),He==3&&he?lt():He==4&&(he?We():Fe()))},k.send(B)}dispose(){const o=this.xhr;if(o){o.onreadystatechange=o.onerror=o.onabort=o.ontimeout=rr,this.xhr=null;const u=this.timer;u&&(clearTimeout(u),this.timer=null),this.requestComplete||o.abort()}delete Li[this.id]}},oc=Od,ac=dn.XhrPolling,Wn=class extends Xs{constructor(s,o,u){super(s,o,u),this.shortName=ac,u.stream=!1,this.shortName=ac}static isAvailable(){return!!(x.Config.xhrSupported&&x.Config.allowComet)}toString(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected}createRequest(s,o,u,p,_){return oc.createRequest(s,o,u,p,_,this.timeouts,this.logger)}},Hn=Wn,Mt=["xhr_polling"],_r={order:Mt,bundledImplementations:{web_socket:Ya,xhr_polling:Hn}},Rd=_r,Ad={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",wsConnectivityCheckUrl:"wss://ws-up.ably-realtime.com",defaultTransports:[dn.XhrPolling,dn.WebSocket]},Ml=Ad;function Tl(s){if(s===void 0)return"undefined";let o,u;if(s instanceof ArrayBuffer?(u="ArrayBuffer",o=new DataView(s)):s instanceof DataView&&(u="DataView",o=s),!o)return JSON.stringify(s);const p=[];for(let _=0;_<s.byteLength;_++){if(_>20){p.push("...");break}let k=o.getUint8(_).toString(16);k.length===1&&(k="0"+k),p.push(k)}return"<"+u+" "+p.join(" ")+">"}function Zs(s,o,u){for(let p=0,_=u.length;p<_;p++){const k=u.charCodeAt(p);if(k<128){s.setUint8(o++,k>>>0&127|0);continue}if(k<2048){s.setUint8(o++,k>>>6&31|192),s.setUint8(o++,k>>>0&63|128);continue}if(k<65536){s.setUint8(o++,k>>>12&15|224),s.setUint8(o++,k>>>6&63|128),s.setUint8(o++,k>>>0&63|128);continue}if(k<1114112){s.setUint8(o++,k>>>18&7|240),s.setUint8(o++,k>>>12&63|128),s.setUint8(o++,k>>>6&63|128),s.setUint8(o++,k>>>0&63|128);continue}throw new Error("bad codepoint "+k)}}function ra(s,o,u){let p="";for(let _=o,k=o+u;_<k;_++){const I=s.getUint8(_);if((I&128)===0){p+=String.fromCharCode(I);continue}if((I&224)===192){p+=String.fromCharCode((I&15)<<6|s.getUint8(++_)&63);continue}if((I&240)===224){p+=String.fromCharCode((I&15)<<12|(s.getUint8(++_)&63)<<6|(s.getUint8(++_)&63)<<0);continue}if((I&248)===240){p+=String.fromCharCode((I&7)<<18|(s.getUint8(++_)&63)<<12|(s.getUint8(++_)&63)<<6|(s.getUint8(++_)&63)<<0);continue}throw new Error("Invalid byte "+I.toString(16))}return p}function cc(s){let o=0;for(let u=0,p=s.length;u<p;u++){const _=s.charCodeAt(u);if(_<128){o+=1;continue}if(_<2048){o+=2;continue}if(_<65536){o+=3;continue}if(_<1114112){o+=4;continue}throw new Error("bad codepoint "+_)}return o}function eo(s,o){const u=Nr(s,o);if(u===0)return;const p=new ArrayBuffer(u),_=new DataView(p);return ji(s,_,0,o),p}var ia=65536*65536,Pd=1/ia;function sa(s,o){return o=o||0,s.getInt32(o)*ia+s.getUint32(o+4)}function lc(s,o){return o=o||0,s.getUint32(o)*ia+s.getUint32(o+4)}function Id(s,o,u){u<9223372036854776e3?(s.setInt32(o,Math.floor(u*Pd)),s.setInt32(o+4,u&-1)):(s.setUint32(o,2147483647),s.setUint32(o+4,2147483647))}function xd(s,o,u){u<18446744073709552e3?(s.setUint32(o,Math.floor(u*Pd)),s.setInt32(o+4,u&-1)):(s.setUint32(o,4294967295),s.setUint32(o+4,4294967295))}var to=class{constructor(s,o){this.map=u=>{const p={};for(let _=0;_<u;_++){const k=this.parse();p[k]=this.parse()}return p},this.bin=u=>{const p=new ArrayBuffer(u);return new Uint8Array(p).set(new Uint8Array(this.view.buffer,this.offset,u),0),this.offset+=u,p},this.buf=this.bin,this.str=u=>{const p=ra(this.view,this.offset,u);return this.offset+=u,p},this.array=u=>{const p=new Array(u);for(let _=0;_<u;_++)p[_]=this.parse();return p},this.ext=u=>(this.offset+=u,{type:this.view.getInt8(this.offset),data:this.buf(u)}),this.parse=()=>{const u=this.view.getUint8(this.offset);let p,_;if((u&128)===0)return this.offset++,u;if((u&240)===128)return _=u&15,this.offset++,this.map(_);if((u&240)===144)return _=u&15,this.offset++,this.array(_);if((u&224)===160)return _=u&31,this.offset++,this.str(_);if((u&224)===224)return p=this.view.getInt8(this.offset),this.offset++,p;switch(u){case 192:return this.offset++,null;case 193:this.offset++;return;case 194:return this.offset++,!1;case 195:return this.offset++,!0;case 196:return _=this.view.getUint8(this.offset+1),this.offset+=2,this.bin(_);case 197:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.bin(_);case 198:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.bin(_);case 199:return _=this.view.getUint8(this.offset+1),this.offset+=2,this.ext(_);case 200:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.ext(_);case 201:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.ext(_);case 202:return p=this.view.getFloat32(this.offset+1),this.offset+=5,p;case 203:return p=this.view.getFloat64(this.offset+1),this.offset+=9,p;case 204:return p=this.view.getUint8(this.offset+1),this.offset+=2,p;case 205:return p=this.view.getUint16(this.offset+1),this.offset+=3,p;case 206:return p=this.view.getUint32(this.offset+1),this.offset+=5,p;case 207:return p=lc(this.view,this.offset+1),this.offset+=9,p;case 208:return p=this.view.getInt8(this.offset+1),this.offset+=2,p;case 209:return p=this.view.getInt16(this.offset+1),this.offset+=3,p;case 210:return p=this.view.getInt32(this.offset+1),this.offset+=5,p;case 211:return p=sa(this.view,this.offset+1),this.offset+=9,p;case 212:return _=1,this.offset++,this.ext(_);case 213:return _=2,this.offset++,this.ext(_);case 214:return _=4,this.offset++,this.ext(_);case 215:return _=8,this.offset++,this.ext(_);case 216:return _=16,this.offset++,this.ext(_);case 217:return _=this.view.getUint8(this.offset+1),this.offset+=2,this.str(_);case 218:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.str(_);case 219:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.str(_);case 220:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.array(_);case 221:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.array(_);case 222:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.map(_);case 223:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.map(_)}throw new Error("Unknown type 0x"+u.toString(16))},this.offset=o||0,this.view=s}};function Ld(s){const o=new DataView(s),u=new to(o),p=u.parse();if(u.offset!==s.byteLength)throw new Error(s.byteLength-u.offset+" trailing bytes");return p}function oa(s,o){return Object.keys(s).filter(function(u){const p=s[u],_=typeof p;return(!o||p!=null)&&(_!=="function"||!!p.toJSON)})}function ji(s,o,u,p){const _=typeof s;if(typeof s=="string"){const k=cc(s);if(k<32)return o.setUint8(u,k|160),Zs(o,u+1,s),1+k;if(k<256)return o.setUint8(u,217),o.setUint8(u+1,k),Zs(o,u+2,s),2+k;if(k<65536)return o.setUint8(u,218),o.setUint16(u+1,k),Zs(o,u+3,s),3+k;if(k<4294967296)return o.setUint8(u,219),o.setUint32(u+1,k),Zs(o,u+5,s),5+k}if(ArrayBuffer.isView&&ArrayBuffer.isView(s)&&(s=s.buffer),s instanceof ArrayBuffer){const k=s.byteLength;if(k<256)return o.setUint8(u,196),o.setUint8(u+1,k),new Uint8Array(o.buffer).set(new Uint8Array(s),u+2),2+k;if(k<65536)return o.setUint8(u,197),o.setUint16(u+1,k),new Uint8Array(o.buffer).set(new Uint8Array(s),u+3),3+k;if(k<4294967296)return o.setUint8(u,198),o.setUint32(u+1,k),new Uint8Array(o.buffer).set(new Uint8Array(s),u+5),5+k}if(typeof s=="number"){if(Math.floor(s)!==s)return o.setUint8(u,203),o.setFloat64(u+1,s),9;if(s>=0){if(s<128)return o.setUint8(u,s),1;if(s<256)return o.setUint8(u,204),o.setUint8(u+1,s),2;if(s<65536)return o.setUint8(u,205),o.setUint16(u+1,s),3;if(s<4294967296)return o.setUint8(u,206),o.setUint32(u+1,s),5;if(s<18446744073709552e3)return o.setUint8(u,207),xd(o,u+1,s),9;throw new Error("Number too big 0x"+s.toString(16))}if(s>=-32)return o.setInt8(u,s),1;if(s>=-128)return o.setUint8(u,208),o.setInt8(u+1,s),2;if(s>=-32768)return o.setUint8(u,209),o.setInt16(u+1,s),3;if(s>=-2147483648)return o.setUint8(u,210),o.setInt32(u+1,s),5;if(s>=-9223372036854776e3)return o.setUint8(u,211),Id(o,u+1,s),9;throw new Error("Number too small -0x"+(-s).toString(16).substr(1))}if(_==="undefined")return p?0:(o.setUint8(u,212),o.setUint8(u+1,0),o.setUint8(u+2,0),3);if(s===null)return p?0:(o.setUint8(u,192),1);if(_==="boolean")return o.setUint8(u,s?195:194),1;if(typeof s.toJSON=="function")return ji(s.toJSON(),o,u,p);if(_==="object"){let k,I=0,B;const Z=Array.isArray(s);if(Z?k=s.length:(B=oa(s,p),k=B.length),k<16?(o.setUint8(u,k|(Z?144:128)),I=1):k<65536?(o.setUint8(u,Z?220:222),o.setUint16(u+1,k),I=3):k<4294967296&&(o.setUint8(u,Z?221:223),o.setUint32(u+1,k),I=5),Z)for(let Y=0;Y<k;Y++)I+=ji(s[Y],o,u+I,p);else if(B)for(let Y=0;Y<k;Y++){const he=B[Y];I+=ji(he,o,u+I),I+=ji(s[he],o,u+I,p)}return I}if(_==="function")return 0;throw new Error("Unknown type "+_)}function Nr(s,o){const u=typeof s;if(u==="string"){const p=cc(s);if(p<32)return 1+p;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(s)&&(s=s.buffer),s instanceof ArrayBuffer){const p=s.byteLength;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(typeof s=="number"){if(Math.floor(s)!==s)return 9;if(s>=0){if(s<128)return 1;if(s<256)return 2;if(s<65536)return 3;if(s<4294967296)return 5;if(s<18446744073709552e3)return 9;throw new Error("Number too big 0x"+s.toString(16))}if(s>=-32)return 1;if(s>=-128)return 2;if(s>=-32768)return 3;if(s>=-2147483648)return 5;if(s>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+s.toString(16).substr(1))}if(u==="boolean")return 1;if(s===null)return o?0:1;if(s===void 0)return o?0:3;if(typeof s.toJSON=="function")return Nr(s.toJSON(),o);if(u==="object"){let p,_=0;if(Array.isArray(s)){p=s.length;for(let k=0;k<p;k++)_+=Nr(s[k],o)}else{const k=oa(s,o);p=k.length;for(let I=0;I<p;I++){const B=k[I];_+=Nr(B)+Nr(s[B],o)}}if(p<16)return 1+_;if(p<65536)return 3+_;if(p<4294967296)return 5+_;throw new Error("Array or object too long 0x"+p.toString(16))}if(u==="function")return 0;throw new Error("Unknown type "+u)}var aa={encode:eo,decode:Ld,inspect:Tl,utf8Write:Zs,utf8Read:ra,utf8ByteCount:cc};function Ol(s,o){return!!o.get("x-ably-errorcode")}function Rl(s,o){if(Ol(s,o))return s.error&&J.fromValues(s.error)}function Al(s){const o={};return s.forEach((u,p)=>{o[p]=u}),o}async function no(s,o,u,p,_,k){const I=new Headers(p||{}),B=s?s.toUpperCase():ue(k)?"GET":"POST",Z=new AbortController;let Y;const he=new Promise(fe=>{Y=setTimeout(()=>{Z.abort(),fe({error:new De("Request timed out",null,408)})},o?o.options.timeouts.httpRequestTimeout:qe.TIMEOUTS.httpRequestTimeout)}),de={method:B,headers:I,body:k,signal:Z.signal};x.Config.isWebworker||(de.credentials=I.has("authorization")?"include":"same-origin");const Ee=(async()=>{try{const fe=new URLSearchParams(_||{});fe.set("rnd",Jt());const Ae=u+"?"+fe,Pe=await jo().fetch(Ae,de);if(clearTimeout(Y),Pe.status==204)return{error:null,statusCode:Pe.status};const Fe=Pe.headers.get("Content-Type");let lt;Fe&&Fe.indexOf("application/x-msgpack")>-1?lt=await Pe.arrayBuffer():Fe&&Fe.indexOf("application/json")>-1?lt=await Pe.json():lt=await Pe.text();const ft=!!Fe&&Fe.indexOf("application/x-msgpack")===-1,We=Al(Pe.headers);return Pe.ok?{error:null,body:lt,headers:We,unpacked:ft,statusCode:Pe.status}:{error:Rl(lt,Pe.headers)||new De("Error response received from server: "+Pe.status+" body was: "+x.Config.inspect(lt),null,Pe.status),body:lt,headers:We,unpacked:ft,statusCode:Pe.status}}catch(fe){return clearTimeout(Y),{error:fe}}})();return Promise.race([he,Ee])}var sr={XHRRequest:oc,FetchRequest:no},Ni=Ks(El,tc);x.Crypto=Ni,x.BufferUtils=tc,x.Http=fn,x.Config=El,x.Transports=Rd,x.WebStorage=na;for(const s of[fl,bl])s.Crypto=Ni,s._MsgPack=aa;fn.bundledRequestImplementations=sr,S.initLogHandlers(),x.Defaults=Da(Ml),x.Config.agent&&(x.Defaults.agent+=" "+x.Config.agent);var Pl={ErrorInfo:J,Rest:fl,Realtime:bl,msgpack:aa,makeProtocolMessageFromDeserialized:al};if(typeof a.exports=="object"&&typeof r=="object"){var jd=(s,o,u,p)=>{if(o&&typeof o=="object"||typeof o=="function")for(let _ of Object.getOwnPropertyNames(o))!Object.prototype.hasOwnProperty.call(s,_)&&_!==u&&Object.defineProperty(s,_,{get:()=>o[_],enumerable:!(p=Object.getOwnPropertyDescriptor(o,_))||p.enumerable});return s};a.exports=jd(a.exports,r)}return a.exports})})($u)),$u.exports}var Ke=xC(),qh=(n=>(n.Trace="trace",n.Debug="debug",n.Info="info",n.Warn="warn",n.Error="error",n.Silent="silent",n))(qh||{});const LC=(n,e,r)=>{const a=r?`, context: ${JSON.stringify(r)}`:"",l=`[${new Date().toISOString()}] ${e.valueOf().toUpperCase()} ably-chat: ${n}${a}`;switch(e){case"trace":case"debug":{console.log(l);break}case"info":{console.info(l);break}case"warn":{console.warn(l);break}case"error":{console.error(l);break}}},jC=n=>{const e=n.logHandler??LC;return new Wh(e,n.logLevel)},r_=new Map([["trace",0],["debug",1],["info",2],["warn",3],["error",4],["silent",5]]);class Wh{constructor(e,r,a){this._handler=e,this._context=a;const l=r_.get(r);if(l===void 0)throw new Ke.ErrorInfo(`Invalid log level: ${r}`,5e4,500);this._levelNumber=l}trace(e,r){this._write(e,"trace",0,r)}debug(e,r){this._write(e,"debug",1,r)}info(e,r){this._write(e,"info",2,r)}warn(e,r){this._write(e,"warn",3,r)}error(e,r){this._write(e,"error",4,r)}withContext(e){const r=[...r_.entries()].find(([,a])=>a===this._levelNumber)?.[0]??"error";return new Wh(this._handler,r,this._mergeContext(e))}_write(e,r,a,l){a>=this._levelNumber&&this._handler(e,r,this._mergeContext(l))}_mergeContext(e){return this._context?e?{...this._context,...e}:this._context:e??void 0}}const NC={logLevel:qh.Error},DC=n=>(n=n??{},{...n,logLevel:n.logLevel??NC.logLevel});function ys(n,e,r){if((Array.isArray(e)||typeof e=="string")&&r)return n.on(e,r),()=>{n.off(r)};if(typeof e=="function")return n.on(e),()=>{n.off(e)};throw new TypeError("Invalid arguments passed to on()")}function UC(n,e,r){if(r)return n.once(e,r),()=>{n.off(r)};throw new TypeError("Invalid arguments passed to once()")}function Ao(n,e,r){if((Array.isArray(e)||typeof e=="string")&&r){const a=n.subscribe(e,r);return()=>{a.then(()=>{n.unsubscribe(r)}).catch(l=>{console.error("Error subscribing to events:",l)})}}else if(typeof e=="function"){const a=n.subscribe(e);return()=>{a.then(()=>{n.unsubscribe(e)}).catch(l=>{console.error("Error subscribing to events:",l)})}}else throw new TypeError("Invalid arguments passed to subscribe()")}const BC=Ke.Realtime.EventEmitter;class mi extends BC{}const Er=n=>(...e)=>n(...e),_s=n=>{const e=n,r=Object.values(e.events).flat().length+e.any.length+Object.values(e.eventsOnce).flat().length+e.anyOnce.length;return r?r>0:!1};class FC{constructor(e,r){this._status="initialized",this._emitter=new mi,this._logger=r,this._status=this._mapAblyStatusToChat(e.connection.state),this._error=e.connection.errorReason;const a=l=>{const f=this._mapAblyStatusToChat(l.current);if(f===this._status)return;const h={current:f,previous:this._status,error:l.reason,retryIn:l.retryIn};this._applyStatusChange(h)};this._clearAblyConnectionListener=ys(e.connection,a)}get status(){return this._status}get error(){return this._error}onStatusChange(e){const r=Er(e);return this._emitter.on(r),{off:()=>{this._emitter.off(r)}}}dispose(){this._logger.trace("DefaultConnection.dispose();"),this._clearAblyConnectionListener(),this._emitter.off()}hasListeners(){return _s(this._emitter)}_applyStatusChange(e){this._status=e.current,this._error=e.error,this._logger.info("Connection state changed",e),this._emitter.emit(e.current,e)}_mapAblyStatusToChat(e){switch(e){case"closing":case"closed":return"failed";default:return e}}}const i_=()=>Math.random().toString(36).slice(2);var s_=Object.prototype.hasOwnProperty;function o_(n,e,r){for(r of n.keys())if(jc(r,e))return r}function jc(n,e){var r,a,l;if(n===e)return!0;if(n&&e&&(r=n.constructor)===e.constructor){if(r===Date)return n.getTime()===e.getTime();if(r===RegExp)return n.toString()===e.toString();if(r===Array){if((a=n.length)===e.length)for(;a--&&jc(n[a],e[a]););return a===-1}if(r===Set){if(n.size!==e.size)return!1;for(a of n)if(l=a,l&&typeof l=="object"&&(l=o_(e,l),!l)||!e.has(l))return!1;return!0}if(r===Map){if(n.size!==e.size)return!1;for(a of n)if(l=a[0],l&&typeof l=="object"&&(l=o_(e,l),!l)||!jc(a[1],e.get(l)))return!1;return!0}if(r===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(r===DataView){if((a=n.byteLength)===e.byteLength)for(;a--&&n.getInt8(a)===e.getInt8(a););return a===-1}if(ArrayBuffer.isView(n)){if((a=n.byteLength)===e.byteLength)for(;a--&&n[a]===e[a];);return a===-1}if(!r||typeof n=="object"){a=0;for(r in n)if(s_.call(n,r)&&++a&&!s_.call(e,r)||!(r in e)||!jc(n[r],e[r]))return!1;return Object.keys(e).length===a}}return n!==n&&e!==e}var ws=(n=>(n.Created="message.created",n.Updated="message.updated",n.Deleted="message.deleted",n))(ws||{}),a_=(n=>(n.ChatMessage="chat.message",n))(a_||{}),c_=(n=>(n.Occupancy="[meta]occupancy",n))(c_||{}),Mr=(n=>(n.MessageCreate="message.create",n.MessageUpdate="message.update",n.MessageDelete="message.delete",n.MessageAnnotationSummary="message.summary",n.MessageMetaOccupancy="meta.occupancy",n))(Mr||{}),Hr=(n=>(n.Started="typing.started",n.Stopped="typing.stopped",n))(Hr||{}),Po=(n=>(n.SetChanged="typing.set.changed",n))(Po||{}),Hh=(n=>(n.Reaction="roomReaction",n))(Hh||{}),Gh=(n=>(n.Reaction="reaction",n))(Gh||{}),Io=(n=>(n.Unique="unique",n.Distinct="distinct",n.Multiple="multiple",n))(Io||{}),qu=(n=>(n.Unique="reaction:unique.v1",n.Distinct="reaction:distinct.v1",n.Multiple="reaction:multiple.v1",n))(qu||{});const zC={"reaction:unique.v1":"unique","reaction:distinct.v1":"distinct","reaction:multiple.v1":"multiple"};var vi=(n=>(n.Create="reaction.create",n.Delete="reaction.delete",n.Summary="reaction.summary",n))(vi||{}),Jh=(n=>(n.Updated="occupancy.updated",n))(Jh||{}),Nc=(n=>(n.Discontinuity="room.discontinuity",n))(Nc||{}),Wu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function VC(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Hu={exports:{}};Hu.exports;var l_;function $C(){return l_||(l_=1,(function(n,e){var r=200,a="__lodash_hash_undefined__",l=9007199254740991,f="[object Arguments]",h="[object Array]",y="[object Boolean]",v="[object Date]",b="[object Error]",C="[object Function]",T="[object GeneratorFunction]",L="[object Map]",A="[object Number]",P="[object Object]",R="[object Promise]",N="[object RegExp]",V="[object Set]",G="[object String]",X="[object Symbol]",x="[object WeakMap]",$="[object ArrayBuffer]",q="[object DataView]",re="[object Float32Array]",me="[object Float64Array]",ae="[object Int8Array]",we="[object Int16Array]",S="[object Int32Array]",Te="[object Uint8Array]",ke="[object Uint8ClampedArray]",J="[object Uint16Array]",De="[object Uint32Array]",et=/[\\^$.*+?()[\]{}|]/g,ve=/\w*$/,ge=/^\[object .+?Constructor\]$/,Oe=/^(?:0|[1-9]\d*)$/,oe={};oe[f]=oe[h]=oe[$]=oe[q]=oe[y]=oe[v]=oe[re]=oe[me]=oe[ae]=oe[we]=oe[S]=oe[L]=oe[A]=oe[P]=oe[N]=oe[V]=oe[G]=oe[X]=oe[Te]=oe[ke]=oe[J]=oe[De]=!0,oe[b]=oe[C]=oe[x]=!1;var Q=typeof Wu=="object"&&Wu&&Wu.Object===Object&&Wu,ue=typeof self=="object"&&self&&self.Object===Object&&self,g=Q||ue||Function("return this")(),M=e&&!e.nodeType&&e,E=M&&!0&&n&&!n.nodeType&&n,D=E&&E.exports===M;function z(j,ne){return j.set(ne[0],ne[1]),j}function K(j,ne){return j.add(ne),j}function se(j,ne){for(var ce=-1,je=j?j.length:0;++ce<je&&ne(j[ce],ce,j)!==!1;);return j}function pe(j,ne){for(var ce=-1,je=ne.length,Pt=j.length;++ce<je;)j[Pt+ce]=ne[ce];return j}function Re(j,ne,ce,je){for(var Pt=-1,Ut=j?j.length:0;++Pt<Ut;)ce=ne(ce,j[Pt],Pt,j);return ce}function $e(j,ne){for(var ce=-1,je=Array(j);++ce<j;)je[ce]=ne(ce);return je}function Xe(j,ne){return j?.[ne]}function zt(j){var ne=!1;if(j!=null&&typeof j.toString!="function")try{ne=!!(j+"")}catch{}return ne}function Sn(j){var ne=-1,ce=Array(j.size);return j.forEach(function(je,Pt){ce[++ne]=[Pt,je]}),ce}function jn(j,ne){return function(ce){return j(ne(ce))}}function mt(j){var ne=-1,ce=Array(j.size);return j.forEach(function(je){ce[++ne]=je}),ce}var At=Array.prototype,en=Function.prototype,Vt=Object.prototype,Ze=g["__core-js_shared__"],Nn=(function(){var j=/[^.]+$/.exec(Ze&&Ze.keys&&Ze.keys.IE_PROTO||"");return j?"Symbol(src)_1."+j:""})(),Kn=en.toString,Jt=Vt.hasOwnProperty,Tr=Vt.toString,Hi=RegExp("^"+Kn.call(Jt).replace(et,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Nt=D?g.Buffer:void 0,Dt=g.Symbol,ln=g.Uint8Array,Qr=jn(Object.getPrototypeOf,Object),yi=Object.create,Ia=Vt.propertyIsEnumerable,Lo=At.splice,Gi=Object.getOwnPropertySymbols,jo=Nt?Nt.isBuffer:void 0,ks=jn(Object.keys,Object),_i=Ce(g,"DataView"),Yn=Ce(g,"Map"),wi=Ce(g,"Promise"),Or=Ce(g,"Set"),bt=Ce(g,"WeakMap"),Dn=Ce(Object,"create"),No=Qt(_i),xa=Qt(Yn),kn=Qt(wi),La=Qt(Or),ja=Qt(bt),Ji=Dt?Dt.prototype:void 0,Cs=Ji?Ji.valueOf:void 0;function Cn(j){var ne=-1,ce=j?j.length:0;for(this.clear();++ne<ce;){var je=j[ne];this.set(je[0],je[1])}}function Es(){this.__data__=Dn?Dn(null):{}}function bi(j){return this.has(j)&&delete this.__data__[j]}function zc(j){var ne=this.__data__;if(Dn){var ce=ne[j];return ce===a?void 0:ce}return Jt.call(ne,j)?ne[j]:void 0}function Si(j){var ne=this.__data__;return Dn?ne[j]!==void 0:Jt.call(ne,j)}function Ms(j,ne){var ce=this.__data__;return ce[j]=Dn&&ne===void 0?a:ne,this}Cn.prototype.clear=Es,Cn.prototype.delete=bi,Cn.prototype.get=zc,Cn.prototype.has=Si,Cn.prototype.set=Ms;function tn(j){var ne=-1,ce=j?j.length:0;for(this.clear();++ne<ce;){var je=j[ne];this.set(je[0],je[1])}}function Do(){this.__data__=[]}function Vc(j){var ne=this.__data__,ce=Rs(ne,j);if(ce<0)return!1;var je=ne.length-1;return ce==je?ne.pop():Lo.call(ne,ce,1),!0}function $c(j){var ne=this.__data__,ce=Rs(ne,j);return ce<0?void 0:ne[ce][1]}function Ts(j){return Rs(this.__data__,j)>-1}function Rr(j,ne){var ce=this.__data__,je=Rs(ce,j);return je<0?ce.push([j,ne]):ce[je][1]=ne,this}tn.prototype.clear=Do,tn.prototype.delete=Vc,tn.prototype.get=$c,tn.prototype.has=Ts,tn.prototype.set=Rr;function Xn(j){var ne=-1,ce=j?j.length:0;for(this.clear();++ne<ce;){var je=j[ne];this.set(je[0],je[1])}}function Na(){this.__data__={hash:new Cn,map:new(Yn||tn),string:new Cn}}function qc(j){return St(this,j).delete(j)}function qe(j){return St(this,j).get(j)}function Da(j){return St(this,j).has(j)}function Ua(j,ne){return St(this,j).set(j,ne),this}Xn.prototype.clear=Na,Xn.prototype.delete=qc,Xn.prototype.get=qe,Xn.prototype.has=Da,Xn.prototype.set=Ua;function pr(j){this.__data__=new tn(j)}function Ba(){this.__data__=new tn}function Tt(j){return this.__data__.delete(j)}function Et(j){return this.__data__.get(j)}function Wc(j){return this.__data__.has(j)}function ki(j,ne){var ce=this.__data__;if(ce instanceof tn){var je=ce.__data__;if(!Yn||je.length<r-1)return je.push([j,ne]),this;ce=this.__data__=new Xn(je)}return ce.set(j,ne),this}pr.prototype.clear=Ba,pr.prototype.delete=Tt,pr.prototype.get=Et,pr.prototype.has=Wc,pr.prototype.set=ki;function Os(j,ne){var ce=zn(j)||Xr(j)?$e(j.length,String):[],je=ce.length,Pt=!!je;for(var Ut in j)Jt.call(j,Ut)&&!(Pt&&(Ut=="length"||Vo(Ut,je)))&&ce.push(Ut);return ce}function Qi(j,ne,ce){var je=j[ne];(!(Jt.call(j,ne)&&Yr(je,ce))||ce===void 0&&!(ne in j))&&(j[ne]=ce)}function Rs(j,ne){for(var ce=j.length;ce--;)if(Yr(j[ce][0],ne))return ce;return-1}function Uo(j,ne){return j&&Is(ne,Pr(ne),j)}function Ci(j,ne,ce,je,Pt,Ut,Vn){var $t;if(je&&($t=Ut?je(j,Pt,Ut,Vn):je(j)),$t!==void 0)return $t;if(!Ar(j))return j;var gr=zn(j);if(gr){if($t=Fo(j),!ne)return Ps(j,$t)}else{var Bt=Ot(j),Ri=Bt==C||Bt==T;if(er(j))return Gc(j,ne);if(Bt==P||Bt==f||Ri&&!Ut){if(zt(j))return Ut?j:{};if($t=zo(Ri?{}:j),!ne)return Kr(j,Uo($t,j))}else{if(!oe[Bt])return Ut?j:{};$t=Va(j,Bt,Ci,ne)}}Vn||(Vn=new pr);var Wo=Vn.get(j);if(Wo)return Wo;if(Vn.set(j,$t),!gr)var Ir=ce?Qc(j):Pr(j);return se(Ir||j,function(Ai,es){Ir&&(es=Ai,Ai=j[es]),Qi($t,es,Ci(Ai,ne,ce,je,es,j,Vn))}),$t}function Un(j){return Ar(j)?yi(j):{}}function Fa(j,ne,ce){var je=ne(j);return zn(j)?je:pe(je,ce(j))}function Bn(j){return Tr.call(j)}function za(j){if(!Ar(j)||Ki(j))return!1;var ne=Zr(j)||zt(j)?Hi:ge;return ne.test(Qt(j))}function Hc(j){if(!Fn(j))return ks(j);var ne=[];for(var ce in Object(j))Jt.call(j,ce)&&ce!="constructor"&&ne.push(ce);return ne}function Gc(j,ne){if(ne)return j.slice();var ce=new j.constructor(j.length);return j.copy(ce),ce}function Ei(j){var ne=new j.constructor(j.byteLength);return new ln(ne).set(new ln(j)),ne}function As(j,ne){var ce=ne?Ei(j.buffer):j.buffer;return new j.constructor(ce,j.byteOffset,j.byteLength)}function un(j,ne,ce){var je=ne?ce(Sn(j),!0):Sn(j);return Re(je,z,new j.constructor)}function Mi(j){var ne=new j.constructor(j.source,ve.exec(j));return ne.lastIndex=j.lastIndex,ne}function Ti(j,ne,ce){var je=ne?ce(mt(j),!0):mt(j);return Re(je,K,new j.constructor)}function Jc(j){return Cs?Object(Cs.call(j)):{}}function Bo(j,ne){var ce=ne?Ei(j.buffer):j.buffer;return new j.constructor(ce,j.byteOffset,j.length)}function Ps(j,ne){var ce=-1,je=j.length;for(ne||(ne=Array(je));++ce<je;)ne[ce]=j[ce];return ne}function Is(j,ne,ce,je){ce||(ce={});for(var Pt=-1,Ut=ne.length;++Pt<Ut;){var Vn=ne[Pt],$t=void 0;Qi(ce,Vn,$t===void 0?j[Vn]:$t)}return ce}function Kr(j,ne){return Is(j,xs(j),ne)}function Qc(j){return Fa(j,Pr,xs)}function St(j,ne){var ce=j.__data__;return $o(ne)?ce[typeof ne=="string"?"string":"hash"]:ce.map}function Ce(j,ne){var ce=Xe(j,ne);return za(ce)?ce:void 0}var xs=Gi?jn(Gi,Object):Oi,Ot=Bn;(_i&&Ot(new _i(new ArrayBuffer(1)))!=q||Yn&&Ot(new Yn)!=L||wi&&Ot(wi.resolve())!=R||Or&&Ot(new Or)!=V||bt&&Ot(new bt)!=x)&&(Ot=function(j){var ne=Tr.call(j),ce=ne==P?j.constructor:void 0,je=ce?Qt(ce):void 0;if(je)switch(je){case No:return q;case xa:return L;case kn:return R;case La:return V;case ja:return x}return ne});function Fo(j){var ne=j.length,ce=j.constructor(ne);return ne&&typeof j[0]=="string"&&Jt.call(j,"index")&&(ce.index=j.index,ce.input=j.input),ce}function zo(j){return typeof j.constructor=="function"&&!Fn(j)?Un(Qr(j)):{}}function Va(j,ne,ce,je){var Pt=j.constructor;switch(ne){case $:return Ei(j);case y:case v:return new Pt(+j);case q:return As(j,je);case re:case me:case ae:case we:case S:case Te:case ke:case J:case De:return Bo(j,je);case L:return un(j,je,ce);case A:case G:return new Pt(j);case N:return Mi(j);case V:return Ti(j,je,ce);case X:return Jc(j)}}function Vo(j,ne){return ne=ne??l,!!ne&&(typeof j=="number"||Oe.test(j))&&j>-1&&j%1==0&&j<ne}function $o(j){var ne=typeof j;return ne=="string"||ne=="number"||ne=="symbol"||ne=="boolean"?j!=="__proto__":j===null}function Ki(j){return!!Nn&&Nn in j}function Fn(j){var ne=j&&j.constructor,ce=typeof ne=="function"&&ne.prototype||Vt;return j===ce}function Qt(j){if(j!=null){try{return Kn.call(j)}catch{}try{return j+""}catch{}}return""}function Zn(j){return Ci(j,!0,!0)}function Yr(j,ne){return j===ne||j!==j&&ne!==ne}function Xr(j){return Xi(j)&&Jt.call(j,"callee")&&(!Ia.call(j,"callee")||Tr.call(j)==f)}var zn=Array.isArray;function Yi(j){return j!=null&&qo(j.length)&&!Zr(j)}function Xi(j){return $a(j)&&Yi(j)}var er=jo||Zi;function Zr(j){var ne=Ar(j)?Tr.call(j):"";return ne==C||ne==T}function qo(j){return typeof j=="number"&&j>-1&&j%1==0&&j<=l}function Ar(j){var ne=typeof j;return!!j&&(ne=="object"||ne=="function")}function $a(j){return!!j&&typeof j=="object"}function Pr(j){return Yi(j)?Os(j):Hc(j)}function Oi(){return[]}function Zi(){return!1}n.exports=Zn})(Hu,Hu.exports)),Hu.exports}var qC=$C();const bs=VC(qC);let Qh=class Wl{constructor({serial:e,clientId:r,text:a,metadata:l,headers:f,action:h,version:y,timestamp:v,reactions:b}){this.serial=e,this.clientId=r,this.text=a,this.metadata=l,this.headers=f,this.action=h,this.version=y,this.timestamp=v,this.reactions=b,Object.freeze(this.version),Object.freeze(this.reactions),Object.freeze(this.reactions.multiple),Object.freeze(this.reactions.distinct),Object.freeze(this.reactions.unique),Object.freeze(this)}get isUpdated(){return this.action===Mr.MessageUpdate}get isDeleted(){return this.action===Mr.MessageDelete}get updatedBy(){return this.isUpdated?this.version.clientId:void 0}get deletedBy(){return this.isDeleted?this.version.clientId:void 0}get updatedAt(){return this.isUpdated?this.version.timestamp:void 0}get deletedAt(){return this.isDeleted?this.version.timestamp:void 0}isOlderVersionOf(e){return this._compareVersions(this,e,(r,a)=>r.serial<a.serial)}isNewerVersionOf(e){return this._compareVersions(this,e,(r,a)=>r.serial>a.serial)}isSameVersionAs(e){return this._compareVersions(this,e,(r,a)=>r.serial===a.serial)}_isNewerOrSameVersionOf(e){return this._compareVersions(this,e,(r,a)=>r.serial>=a.serial)}before(e){return this.serial<e.serial}after(e){return this.serial>e.serial}equal(e){return this.serial===e.serial}isSameAs(e){return this.equal(e)}with(e){if("serial"in e)return this._getLatestMessageVersion(e);if(e.type===ws.Created)throw new Ke.ErrorInfo("cannot apply a created event to a message",4e4,400);if(e.type===vi.Summary){if(e.summary.messageSerial!==this.serial)throw new Ke.ErrorInfo("cannot apply event for a different message",4e4,400);const r={unique:bs(e.summary.unique),distinct:bs(e.summary.distinct),multiple:bs(e.summary.multiple)};return Wl._clone(this,{reactions:r})}return this._getLatestMessageVersion(e.message)}_compareVersions(e,r,a){return e.equal(r)?e.equal(r)&&a(e.version,r.version):!1}_getLatestMessageVersion(e){if(e.serial!==this.serial)throw new Ke.ErrorInfo("cannot apply event for a different message",4e4,400);return this._isNewerOrSameVersionOf(e)?this:Wl._clone(e,{reactions:this.reactions})}static _clone(e,r){return new Wl({serial:r?.serial??e.serial,clientId:r?.clientId??e.clientId,text:r?.text??e.text,metadata:r?.metadata??bs(e.metadata),headers:r?.headers??bs(e.headers),action:r?.action??e.action,version:r?.version??bs(e.version),timestamp:r?.timestamp??e.timestamp,reactions:r?.reactions??bs(e.reactions)})}copy(e={}){return Wl._clone(this,e)}};const Kh=()=>({unique:{},distinct:{},multiple:{}}),WC=n=>{const e=n,r=e.data&&typeof e.data=="object"?e.data:{},a=e.extras&&typeof e.extras=="object"?e.extras:{},l=e.clientId||"",f=r.text||"",h=new Date(e.timestamp||0),y=e.serial||"",v=r.metadata&&typeof r.metadata=="object"?r.metadata:{},b=a.headers||{},C={...e.version,serial:e.version.serial||y,timestamp:new Date(e.version.timestamp||h)},T=Object.values(Mr).includes(e.action)?e.action:Mr.MessageCreate;return new Qh({serial:y,clientId:l,text:f,metadata:v,headers:b,action:T,version:C,timestamp:h,reactions:Kh()})},Ra=n=>{let e="";if(typeof n=="string")e=n;else try{"serial"in n&&(e=n.serial)}catch{}if(e==="")throw new Ke.ErrorInfo("invalid serial; must be string or object with serial property",4e4,400);return e},HC={"annotation.create":vi.Create,"annotation.delete":vi.Delete};class u_{constructor(e,r,a,l,f){this._logger=e,this._options=r,this._api=a,this._roomName=l,this._channel=f,this._emitter=new mi,this._unsubscribeMessageEvents=Ao(f,this._processMessageEvent.bind(this)),this._options?.rawMessageReactions&&(this._unsubscribeAnnotationEvents=Ao(f.annotations,this._processAnnotationEvent.bind(this))),this._defaultType=this._options?.defaultMessageReactionType??Io.Distinct}_processAnnotationEvent(e){this._logger.trace("MessagesReactions._processAnnotationEvent();",{event:e});const r=zC[e.type];if(!r){this._logger.info("MessagesReactions._processAnnotationEvent(); ignoring unknown reaction type",{event:e});return}const a=HC[e.action];if(!a){this._logger.info("MessagesReactions._processAnnotationEvent(); ignoring unknown reaction event type",{event:e});return}const l=e.name??"",f={type:a,timestamp:new Date(e.timestamp),reaction:{messageSerial:e.messageSerial,type:r,name:l,clientId:e.clientId??""}};e.count?f.reaction.count=e.count:a===vi.Create&&r===Io.Multiple&&(f.reaction.count=1),this._emitter.emit(a,f)}_processMessageEvent(e){if(this._logger.trace("MessagesReactions._processMessageEvent();",{event:e}),e.action!==Mr.MessageAnnotationSummary.valueOf())return;const r=e.serial,a=e.annotations.summary,l=a[qu.Unique]??{},f=a[qu.Distinct]??{},h=a[qu.Multiple]??{};this._emitter.emit(vi.Summary,{type:vi.Summary,summary:{messageSerial:r,unique:l,distinct:f,multiple:h}})}send(e,r){this._logger.trace("MessagesReactions.send();",{messageSerial:e,params:r});const a=Ra(e);let{type:l,count:f}=r;l||(l=this._defaultType),l===Io.Multiple&&!f&&(f=1);const h={type:l,name:r.name};return f&&(h.count=f),this._api.sendMessageReaction(this._roomName,a,h)}delete(e,r){this._logger.trace("MessagesReactions.delete();",{messageSerial:e,params:r});const a=Ra(e);let l=r?.type;if(l||(l=this._defaultType),l!==Io.Unique&&!r?.name)throw new Ke.ErrorInfo(`cannot delete reaction of type ${l} without a name`,40001,400);const f={type:l};return l!==Io.Unique&&(f.name=r?.name),this._api.deleteMessageReaction(this._roomName,a,f)}subscribe(e){this._logger.trace("MessagesReactions.subscribe();");const r=Er(e);return this._emitter.on(vi.Summary,r),{unsubscribe:()=>{this._emitter.off(r)}}}subscribeRaw(e){if(this._logger.trace("MessagesReactions.subscribeRaw();"),!this._options?.rawMessageReactions)throw new Ke.ErrorInfo("Raw message reactions are not enabled",40001,400);const r=Er(e);return this._emitter.on([vi.Create,vi.Delete],r),{unsubscribe:()=>{this._emitter.off(r)}}}static channelOptionMerger(e){return r=>(r.modes.includes("ANNOTATION_PUBLISH")||r.modes.push("ANNOTATION_PUBLISH"),e.messages.rawMessageReactions&&!r.modes.includes("ANNOTATION_SUBSCRIBE")&&r.modes.push("ANNOTATION_SUBSCRIBE"),r)}clientReactions(e,r){this._logger.trace("MessagesReactions.clientReactions();",{messageSerial:e,clientId:r});const a=Ra(e);return this._api.getClientReactions(this._roomName,a,r)}dispose(){this._logger.trace("DefaultMessageReactions.dispose();"),this._emitter.off(),this._unsubscribeMessageEvents(),this._unsubscribeAnnotationEvents?.(),this._logger.debug("DefaultMessageReactions.dispose(); disposed successfully")}hasListeners(){return _s(this._emitter)}}const Gu=n=>{const e={...Kh(),...n.reactions},r=Object.values(Mr).includes(n.action)?n.action:Mr.MessageCreate,a={serial:n.version.serial,timestamp:new Date(n.version.timestamp),clientId:n.version.clientId,description:n.version.description,metadata:n.version.metadata};return new Qh({serial:n.serial,clientId:n.clientId,text:n.text,metadata:n.metadata,headers:n.headers,action:r,version:a,timestamp:new Date(n.timestamp),reactions:e})},GC=new Map([[Mr.MessageCreate,ws.Created],[Mr.MessageUpdate,ws.Updated],[Mr.MessageDelete,ws.Deleted]]);var Yh=(n=>(n.OldestFirst="oldestFirst",n.NewestFirst="newestFirst",n))(Yh||{});class JC{constructor(e,r,a,l,f,h){this._pendingPromiseRejecters=new Set,this._pendingAttachListeners=new Set,this._emitter=new mi,this._roomName=e,this._options=r,this._channel=a,this._chatApi=l,this._clientId=f,this._logger=h,this._listenerSubscriptionPoints=new Map,this._reactions=new u_(this._logger,r,this._chatApi,this._roomName,this._channel);const y=this._processEvent.bind(this),v=C=>{this._handleAttach(C.resumed)},b=C=>{C.current==="attached"&&C.previous==="attached"&&this._handleAttach(C.resumed)};this._unsubscribeMessageEvents=Ao(this._channel,[a_.ChatMessage],y),this._offChannelAttached=ys(this._channel,"attached",v),this._offChannelUpdate=ys(this._channel,"update",b)}get reactions(){return this._reactions}async _getBeforeSubscriptionStart(e,r){this._logger.trace("DefaultSubscriptionManager.getBeforeSubscriptionStart();");const a=this._listenerSubscriptionPoints.get(e);if(a===void 0)throw this._logger.error("DefaultSubscriptionManager.getBeforeSubscriptionStart(); listener has not been subscribed yet"),new Ke.ErrorInfo("cannot query history; listener has not been subscribed yet",4e4,400);const l=await a;return this._chatApi.history(this._roomName,{...r,orderBy:"newestFirst",...l})}_handleAttach(e){if(this._logger.trace("DefaultSubscriptionManager.handleAttach();"),e)return;const r=this._subscribeAtChannelAttach();for(const[a]of this._listenerSubscriptionPoints.entries())this._listenerSubscriptionPoints.set(a,r)}async _resolveSubscriptionStart(){const e=this._getChannelProperties();if(e.state==="attached"){if(e.properties.channelSerial)return{fromSerial:e.properties.channelSerial};throw this._logger.error("DefaultSubscriptionManager.handleAttach(); channelSerial is undefined"),new Ke.ErrorInfo("channel is attached, but channelSerial is not defined",4e4,400)}return this._subscribeAtChannelAttach()}_getChannelProperties(){return this._channel}async _subscribeAtChannelAttach(){const e=this._getChannelProperties();return new Promise((r,a)=>{this._pendingPromiseRejecters.add(a);const l=()=>{this._pendingPromiseRejecters.delete(a)};if(e.state==="attached"){this._logger.debug("Messages._subscribeAtChannelAttach(); channel is attached already, using attachSerial",{attachSerial:e.properties.attachSerial}),l(),e.properties.attachSerial?r({fromSerial:e.properties.attachSerial}):(this._logger.error("DefaultSubscriptionManager.handleAttach(); attachSerial is undefined"),l(),a(new Ke.ErrorInfo("channel is attached, but attachSerial is not defined",4e4,400)));return}const f=UC(e,"attached",()=>{this._logger.debug("Messages._subscribeAtChannelAttach(); channel is now attached, using attachSerial",{attachSerial:e.properties.attachSerial}),l(),this._pendingAttachListeners.delete(f),e.properties.attachSerial?r({fromSerial:e.properties.attachSerial}):(this._logger.error("DefaultSubscriptionManager.handleAttach(); attachSerial is undefined"),a(new Ke.ErrorInfo("channel is attached, but attachSerial is not defined",4e4,400)))});this._pendingAttachListeners.add(f)})}async history(e){return this._logger.trace("Messages.query();"),this._chatApi.history(this._roomName,e)}get(e){return this._logger.trace("Messages.get();",{serial:e}),this._chatApi.getMessage(this._roomName,Ra(e))}async send(e){this._logger.trace("Messages.send();",{params:e});const{text:r,metadata:a,headers:l}=e,f=await this._chatApi.sendMessage(this._roomName,{text:r,headers:l,metadata:a}),h=new Date(f.timestamp);return new Qh({serial:f.serial,clientId:this._clientId,text:r,metadata:a??{},headers:l??{},action:Mr.MessageCreate,version:{serial:f.serial,timestamp:h},timestamp:h,reactions:Kh()})}async delete(e,r){this._logger.trace("Messages.delete();",{params:r}),e=Ra(e),this._logger.debug("Messages.delete(); serial",{serial:e});const a=await this._chatApi.deleteMessage(this._roomName,e,r);return Gu(a)}async update(e,r,a){this._logger.trace("Messages.update();",{updateParams:r,details:a}),e=Ra(e),this._logger.debug("Messages.update(); serial",{serial:e});const l=await this._chatApi.updateMessage(this._roomName,e,{message:{text:r.text,metadata:r.metadata,headers:r.headers},...a});return this._logger.debug("Messages.update(); message update successfully",{updateParams:r}),Gu(l)}subscribe(e){this._logger.trace("Messages.subscribe();");const r=Er(e);this._emitter.on([ws.Created,ws.Updated,ws.Deleted],r);const a=this._resolveSubscriptionStart();return a.catch(()=>{this._logger.debug("Messages.subscribe(); subscription point was not resolved before the room was released")}),this._listenerSubscriptionPoints.set(r,a),{unsubscribe:()=>{this._listenerSubscriptionPoints.delete(r),this._logger.trace("Messages.unsubscribe();"),this._emitter.off(r)},historyBeforeSubscribe:l=>this._getBeforeSubscriptionStart(r,l)}}_processEvent(e){this._logger.trace("Messages._processEvent();",{channelEventMessage:e});const{action:r}=e,a=GC.get(r);if(!a){this._logger.debug("Messages._processEvent(); received unknown message action",{action:r});return}const l=WC(e);this._emitter.emit(a,{type:a,message:l})}dispose(){this._logger.trace("DefaultMessages.dispose();"),this._emitter.off();const e=new Ke.ErrorInfo("room has been disposed",4e4,400);for(const r of this._pendingPromiseRejecters)try{r(e)}catch{}this._pendingPromiseRejecters.clear(),this._listenerSubscriptionPoints.clear();for(const r of this._pendingAttachListeners)r();this._pendingAttachListeners.clear(),this._unsubscribeMessageEvents(),this._offChannelAttached(),this._offChannelUpdate(),this._reactions.dispose(),this._logger.debug("DefaultMessages.dispose(); disposed successfully")}hasListeners(){return _s(this._emitter)}}class QC{constructor(e,r){this._apiProtocolVersion=4,this._realtime=e,this._logger=r}async history(e,r){const a={...r};if(r.orderBy)switch(r.orderBy){case Yh.NewestFirst:{a.direction="backwards";break}case Yh.OldestFirst:{a.direction="forwards";break}default:throw new Ke.ErrorInfo(`invalid orderBy value: ${r.orderBy}`,4e4,400)}const l=await this._makeAuthorizedPaginatedRequest(this._roomUrl(e,"/messages"),a);return this._recursivePaginateMessages(l)}_recursivePaginateMessages(e){const r={};return r.items=e.items.map(a=>Gu(a)),r.next=()=>e.next().then(a=>a?this._recursivePaginateMessages(a):null),r.first=()=>e.first().then(a=>this._recursivePaginateMessages(a)),r.current=()=>e.current().then(a=>this._recursivePaginateMessages(a)),r.hasNext=()=>e.hasNext(),r.isLast=()=>e.isLast(),{...e,...r}}async getMessage(e,r){const a=await this._makeAuthorizedRequest(this._messageUrl(e,r),"GET");return Gu(a)}deleteMessage(e,r,a){const l={...a?.description&&{description:a.description},...a?.metadata&&{metadata:a.metadata}};return this._makeAuthorizedRequest(this._messageUrl(e,r,"/delete"),"POST",l,{})}sendMessage(e,r){const a={text:r.text,...r.metadata&&{metadata:r.metadata},...r.headers&&{headers:r.headers}};return this._makeAuthorizedRequest(this._roomUrl(e,"/messages"),"POST",a)}updateMessage(e,r,a){return this._makeAuthorizedRequest(this._messageUrl(e,r),"PUT",a)}sendMessageReaction(e,r,a){return this._makeAuthorizedRequest(this._messageUrl(e,r,"/reactions"),"POST",a)}deleteMessageReaction(e,r,a){return this._makeAuthorizedRequest(this._messageUrl(e,r,"/reactions"),"DELETE",void 0,a)}getClientReactions(e,r,a){const l=a?{forClientId:a}:{};return this._makeAuthorizedRequest(this._messageUrl(e,r,"/client-reactions"),"GET",void 0,l)}getOccupancy(e){return this._makeAuthorizedRequest(this._roomUrl(e,"/occupancy"),"GET")}async _makeAuthorizedRequest(e,r,a,l){return(await this._doRequest(e,r,l,a)).items[0]}async _makeAuthorizedPaginatedRequest(e,r,a){return this._doRequest(e,"GET",r,a)}async _doRequest(e,r,a,l){const f=await this._realtime.request(r,e,this._apiProtocolVersion,a,l);if(!f.success)throw this._logger.error("ChatApi._doRequest(); failed to make request",{url:e,method:r,statusCode:f.statusCode,errorCode:f.errorCode,errorMessage:f.errorMessage}),new Ke.ErrorInfo(f.errorMessage,f.errorCode,f.statusCode);return f}_roomUrl(e,r=""){return`/chat/v4/rooms/${encodeURIComponent(e)}${r}`}_messageUrl(e,r,a=""){return`${this._roomUrl(e,"/messages")}/${encodeURIComponent(r)}${a}`}}var xo=(n=>(n[n.BadRequest=4e4]="BadRequest",n[n.MessageRejectedByBeforePublishRule=42211]="MessageRejectedByBeforePublishRule",n[n.MessageRejectedByModeration=42213]="MessageRejectedByModeration",n[n.PresenceAutoReentryFailed=91004]="PresenceAutoReentryFailed",n[n.RoomDiscontinuity=102100]="RoomDiscontinuity",n[n.RoomInFailedState=102101]="RoomInFailedState",n[n.RoomIsReleasing=102102]="RoomIsReleasing",n[n.RoomIsReleased=102103]="RoomIsReleased",n[n.RoomReleasedBeforeOperationCompleted=102106]="RoomReleasedBeforeOperationCompleted",n))(xo||{});const KC=n=>`${n}::$chat`,Ju="0.14.1",d_=`chat-js/${Ju}`,YC=`chat-react/${Ju}`,f_=["PUBLISH","SUBSCRIBE"],XC={params:{agent:d_},attachOnSubscribe:!1,modes:f_},ZC={params:{agent:`${d_} ${YC}`},attachOnSubscribe:!1,modes:f_};class e1{constructor(e,r,a,l){a.trace("ChannelManager();",{isReact:l}),this._realtime=r,this._logger=a,this._isReact=l,this._registeredOptions=this._defaultChannelOptions(),this._channelId=KC(e)}mergeOptions(e){if(this._logger.trace("ChannelManager.mergeOptions();"),this._resolvedChannel)throw this._logger.error("channel options cannot be modified after the channel has been requested"),new Ke.ErrorInfo("channel options cannot be modified after the channel has been requested",4e4,400);this._registeredOptions=e(this._registeredOptions)}get(){return this._logger.trace("ChannelManager.get();"),this._resolvedChannel??=this._realtime.channels.get(this._channelId,this._registeredOptions),this._resolvedChannel}release(){this._logger.trace("ChannelManager.release();",{channelId:this._channelId}),this._resolvedChannel&&this._realtime.channels.release(this._channelId)}_defaultChannelOptions(){this._logger.trace("ChannelManager._defaultChannelOptions();");const e=this._isReact?ZC:XC;return this._logger.trace(this._isReact?"using react channel options":"using default channel options"),{...e,modes:[...e.modes??[]]}}}const t1=n=>{const e=n;let r=0,a=0;if(!e.data||typeof e.data!="object")return{connections:r,presenceMembers:a};const{metrics:l}=e.data;return!l||typeof l!="object"?{connections:r,presenceMembers:a}:(typeof l.connections=="number"&&Number.isInteger(l.connections)&&(r=l.connections),typeof l.presenceMembers=="number"&&Number.isInteger(l.presenceMembers)&&(a=l.presenceMembers),{connections:r,presenceMembers:a})};class h_{constructor(e,r,a,l,f){this._emitter=new mi,this._roomName=e,this._channel=r,this._chatApi=a,this._logger=l,this._roomOptions=f;const h=this._internalOccupancyListener.bind(this);this._roomOptions.occupancy.enableEvents?(this._logger.debug("DefaultOccupancy(); subscribing to occupancy events"),this._unsubscribeOccupancyEvents=Ao(this._channel,[c_.Occupancy],h)):this._unsubscribeOccupancyEvents=()=>{}}subscribe(e){if(this._logger.trace("Occupancy.subscribe();"),!this._roomOptions.occupancy.enableEvents)throw new Ke.ErrorInfo("cannot subscribe to occupancy; occupancy events are not enabled in room options",4e4,400);const r=Er(e);return this._emitter.on(r),{unsubscribe:()=>{this._logger.trace("Occupancy.unsubscribe();"),this._emitter.off(r)}}}async get(){return this._logger.trace("Occupancy.get();"),this._chatApi.getOccupancy(this._roomName)}current(){if(this._logger.trace("Occupancy.current();"),!this._roomOptions.occupancy.enableEvents)throw new Ke.ErrorInfo("cannot get current occupancy; occupancy events are not enabled in room options",4e4,400);return this._latestOccupancyData}_internalOccupancyListener(e){this._logger.trace("Occupancy._internalOccupancyListener();",e),this._latestOccupancyData=t1(e),this._emitter.emit(Jh.Updated,{type:Jh.Updated,occupancy:this._latestOccupancyData})}static channelOptionMerger(e){return r=>e.occupancy.enableEvents?{...r,params:{...r.params,occupancy:"metrics"}}:r}dispose(){this._logger.trace("DefaultOccupancy.dispose();"),this._unsubscribeOccupancyEvents(),this._emitter.off(),this._logger.debug("DefaultOccupancy.dispose(); disposed successfully")}hasListeners(){return _s(this._emitter)}}class p_{constructor(e,r,a,l){this._emitter=new mi,this._stateEmitter=new mi,this._presenceState={present:!1},this.subscribeToEvents=v=>{this._emitter.emit(v.action,{type:v.action,member:this._realtimeMemberToPresenceMember(v)})},this._channel=e,this._clientId=r,this._logger=a,this._options=l;const f=this.subscribeToEvents.bind(this),h=v=>{if(v.reason?.code===91004){this._logger.debug("Presence auto-reentry failed",{reason:v.reason}),this._emitPresenceStateChange(!1,v.reason);return}if(v.current==="detached"){this._emitPresenceStateChange(!1);return}},y=v=>{this._emitPresenceStateChange(!1,v.reason)};this._offChannelUpdate=ys(this._channel,"update",h),this._offChannelDetach=ys(this._channel,["detached","failed"],y),this._unsubscribePresenceEvents=Ao(this._channel.presence,f)}async get(e){return this._logger.trace("Presence.get()",{params:e}),this._assertChannelState(),(await this._channel.presence.get(e)).map(r=>this._realtimeMemberToPresenceMember(r))}async isUserPresent(e){return this._logger.trace("Presence.isUserPresent()",{clientId:e}),this._assertChannelState(),(await this._channel.presence.get({clientId:e})).length>0}async enter(e){this._logger.trace("Presence.enter()",{data:e}),this._assertChannelState();try{await this._channel.presence.enterClient(this._clientId,e),this._emitPresenceStateChange(!0)}catch(r){throw this._emitPresenceStateChange(!1,r),r}}async update(e){this._logger.trace("Presence.update()",{data:e}),this._assertChannelState();try{await this._channel.presence.updateClient(this._clientId,e),this._emitPresenceStateChange(!0)}catch(r){throw this._emitPresenceStateChange(!1,r),r}}async leave(e){this._logger.trace("Presence.leave()",{data:e}),this._assertChannelState();try{await this._channel.presence.leaveClient(this._clientId,e),this._emitPresenceStateChange(!1)}catch(r){throw this._emitPresenceStateChange(!1,r),r}}subscribe(e,r){if(this._logger.trace("Presence.subscribe(); listenerOrEvents",{listenerOrEvents:e}),!this._options.presence.enableEvents)throw this._logger.error("could not subscribe to presence; presence events are not enabled"),new Ke.ErrorInfo("could not subscribe to presence; presence events are not enabled",4e4,400);if(!e&&!r)throw this._logger.error("could not subscribe to presence; invalid arguments"),new Ke.ErrorInfo("could not subscribe listener: invalid arguments",4e4,400);if(r){const a=Er(r);return this._emitter.on(e,a),{unsubscribe:()=>{this._logger.trace("Presence.unsubscribe();",{events:e}),this._emitter.off(a)}}}else{const a=Er(e);return this._emitter.on(a),{unsubscribe:()=>{this._logger.trace("Presence.unsubscribe();"),this._emitter.off(a)}}}}static channelOptionMerger(e){return r=>(r.modes.includes("PRESENCE")||r.modes.push("PRESENCE"),e.presence.enableEvents&&!r.modes.includes("PRESENCE_SUBSCRIBE")&&r.modes.push("PRESENCE_SUBSCRIBE"),r)}dispose(){this._logger.trace("DefaultPresence.dispose();"),this._emitter.off(),this._unsubscribePresenceEvents(),this._offChannelUpdate(),this._offChannelDetach(),this._logger.debug("DefaultPresence.dispose(); disposed successfully")}hasListeners(){return _s(this._emitter)}_realtimeMemberToPresenceMember(e){return{...e,data:e.data,updatedAt:new Date(e.timestamp)}}_assertChannelState(){if(this._channel.state!=="attaching"&&this._channel.state!=="attached")throw this._logger.error("could not perform presence operation; room is not attached"),new Ke.ErrorInfo("could not perform presence operation; room is not attached",4e4,400)}_emitPresenceStateChange(e,r){this._logger.trace("Presence._emitPresenceStateChange()",{present:e,error:r});const a={...this._presenceState};this._presenceState={present:e};const l={previous:a,current:this._presenceState,error:r};this._stateEmitter.emit("presence.state.change",l)}onPresenceStateChange(e){this._logger.trace("Presence.onPresenceStateChange()");const r=Er(e);return this._stateEmitter.on("presence.state.change",r),{unsubscribe:()=>{this._logger.trace("Presence.unsubscribeFromPresenceStateChanges()"),this._stateEmitter.off(r)}}}}const Qu=new Error("request for lock canceled");var n1=function(n,e,r,a){function l(f){return f instanceof r?f:new r(function(h){h(f)})}return new(r||(r=Promise))(function(f,h){function y(C){try{b(a.next(C))}catch(T){h(T)}}function v(C){try{b(a.throw(C))}catch(T){h(T)}}function b(C){C.done?f(C.value):l(C.value).then(y,v)}b((a=a.apply(n,e||[])).next())})};class r1{constructor(e,r=Qu){this._value=e,this._cancelError=r,this._queue=[],this._weightedWaiters=[]}acquire(e=1,r=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((a,l)=>{const f={resolve:a,reject:l,weight:e,priority:r},h=g_(this._queue,y=>r<=y.priority);h===-1&&e<=this._value?this._dispatchItem(f):this._queue.splice(h+1,0,f)})}runExclusive(e){return n1(this,arguments,void 0,function*(r,a=1,l=0){const[f,h]=yield this.acquire(a,l);try{return yield r(f)}finally{h()}})}waitForUnlock(e=1,r=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,r)?Promise.resolve():new Promise(a=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),i1(this._weightedWaiters[e-1],{resolve:a,priority:r})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){const r=this._value;this._value-=e.weight,e.resolve([r,this._newReleaser(e.weight)])}_newReleaser(e){let r=!1;return()=>{r||(r=!0,this.release(e))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let e=this._value;e>0;e--){const r=this._weightedWaiters[e-1];r&&(r.forEach(a=>a.resolve()),this._weightedWaiters[e-1]=[])}else{const e=this._queue[0].priority;for(let r=this._value;r>0;r--){const a=this._weightedWaiters[r-1];if(!a)continue;const l=a.findIndex(f=>f.priority<=e);(l===-1?a:a.splice(0,l)).forEach(f=>f.resolve())}}}_couldLockImmediately(e,r){return(this._queue.length===0||this._queue[0].priority<r)&&e<=this._value}}function i1(n,e){const r=g_(n,a=>e.priority<=a.priority);n.splice(r+1,0,e)}function g_(n,e){for(let r=n.length-1;r>=0;r--)if(e(n[r]))return r;return-1}var s1=function(n,e,r,a){function l(f){return f instanceof r?f:new r(function(h){h(f)})}return new(r||(r=Promise))(function(f,h){function y(C){try{b(a.next(C))}catch(T){h(T)}}function v(C){try{b(a.throw(C))}catch(T){h(T)}}function b(C){C.done?f(C.value):l(C.value).then(y,v)}b((a=a.apply(n,e||[])).next())})};class m_{constructor(e){this._semaphore=new r1(1,e)}acquire(){return s1(this,arguments,void 0,function*(e=0){const[,r]=yield this._semaphore.acquire(1,e);return r})}runExclusive(e,r=0){return this._semaphore.runExclusive(()=>e(),1,r)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}var Rt=(n=>(n.Initializing="initializing",n.Initialized="initialized",n.Attaching="attaching",n.Attached="attached",n.Detaching="detaching",n.Detached="detached",n.Suspended="suspended",n.Failed="failed",n.Releasing="releasing",n.Released="released",n))(Rt||{});class o1{constructor(e){this._status="initialized",this._emitter=new mi,this._logger=e}get status(){return this._status}get error(){return this._error}onChange(e){const r=Er(e);return this._emitter.on(r),{off:()=>{this._emitter.off(r)}}}setStatus(e){const r={current:e.status,error:e.error,previous:this._status};this._status=r.current,this._error=r.error,this._logger.info("room status changed",{...r}),this._emitter.emit(r.current,r)}dispose(){this._logger.trace("DefaultRoomLifecycle.dispose();"),this._emitter.off(),this._logger.debug("DefaultRoomLifecycle.dispose(); disposed successfully")}hasListeners(){return _s(this._emitter)}}class a1{constructor(e,r,a){this._channelManager=e,this._roomLifecycle=r,this._logger=a,this._eventEmitter=new mi,this._hasAttachedOnce=!1,this._isExplicitlyDetached=!1,this._mutex=new m_;const l=this._channelStateListener.bind(this),f=this._discontinuityOnAttachedListener.bind(this),h=this._discontinuityOnUpdateListener.bind(this),y=this._channelManager.get();this._unsubscribeChannelStateListener=ys(y,l),this._offDiscontinuityAttached=ys(y,"attached",f),this._offDiscontinuityUpdate=ys(y,"update",h)}onDiscontinuity(e){this._logger.trace("RoomLifecycleManager.onDiscontinuity()");const r=Er(e);return this._eventEmitter.on(Nc.Discontinuity,r),{off:()=>{this._eventEmitter.off(Nc.Discontinuity,r)}}}async attach(){await this._mutex.runExclusive(async()=>{if(this._logger.trace("RoomLifecycleManager.attach();"),this._checkRoomNotReleasing("attach"),this._roomStatusIs(Rt.Attached)){this._logger.debug("RoomLifecycleManager.attach(); room already attached, no-op");return}const e=this._channelManager.get();this._logger.debug("RoomLifecycleManager.attach(); attaching room",{channelState:e.state});try{this._setStatus(Rt.Attaching),await e.attach(),this._setStatus(Rt.Attached),this._isExplicitlyDetached=!1,this._hasAttachedOnce=!0,this._logger.debug("RoomLifecycleManager.attach(); room attached successfully")}catch(r){const a=r,l=new Ke.ErrorInfo(`failed to attach room: ${a.message}`,a.code,a.statusCode,a),f=this._mapChannelStateToRoomStatus(e.state);throw this._setStatus(f,l),l}},1)}async detach(){await this._mutex.runExclusive(async()=>{if(this._logger.trace("RoomLifecycleManager.detach();"),this._roomStatusIs(Rt.Failed))throw new Ke.ErrorInfo("cannot detach room, room is in failed state",xo.RoomInFailedState,400);if(this._checkRoomNotReleasing("detach"),this._roomStatusIs(Rt.Detached)){this._logger.debug("RoomLifecycleManager.detach(); room already detached, no-op");return}const e=this._channelManager.get();this._logger.debug("RoomLifecycleManager.detach(); detaching room",{channelState:e.state});try{this._setStatus(Rt.Detaching),await e.detach(),this._isExplicitlyDetached=!0,this._setStatus(Rt.Detached),this._logger.debug("RoomLifecycleManager.detach(); room detached successfully")}catch(r){const a=r,l=new Ke.ErrorInfo(`failed to detach room: ${a.message}`,a.code,a.statusCode,a),f=this._mapChannelStateToRoomStatus(e.state);throw this._setStatus(f,l),l}},1)}async release(){await this._mutex.runExclusive(async()=>{if(this._logger.trace("RoomLifecycleManager.release();"),this._roomStatusIs(Rt.Released)){this._logger.debug("RoomLifecycleManager.release(); room already released, no-op");return}if(this._roomStatusIs(Rt.Initialized)||this._roomStatusIs(Rt.Detached)){this._logger.debug("RoomLifecycleManager.release(); room is initialized or detached, releasing immediately",{status:this._roomLifecycle.status}),this._releaseChannel();return}this._setStatus(Rt.Releasing);const e=this._channelManager.get();this._logger.debug("RoomLifecycleManager.release(); attempting channel detach before release",{channelState:e.state}),await this._channelDetachLoop(e),this._releaseChannel()},0)}_mapChannelStateToRoomStatus(e){switch(e){case"initialized":return Rt.Initialized;case"attaching":return Rt.Attaching;case"attached":return Rt.Attached;case"detaching":return Rt.Detaching;case"detached":return Rt.Detached;case"suspended":return Rt.Suspended;case"failed":return Rt.Failed;default:return this._logger.error("RoomLifecycleManager._mapChannelStateToRoomStatus(); unknown channel state",{channelState:e}),Rt.Failed}}_checkRoomNotReleasing(e){switch(this._roomLifecycle.status){case Rt.Released:throw new Ke.ErrorInfo(`cannot ${e} room, room is released`,xo.RoomIsReleased,400);case Rt.Releasing:throw new Ke.ErrorInfo(`cannot ${e} room, room is currently releasing`,xo.RoomIsReleasing,400)}}_roomStatusIs(e){return this._roomLifecycle.status===e}dispose(){this._unsubscribeChannelStateListener(),this._offDiscontinuityAttached(),this._offDiscontinuityUpdate(),this._eventEmitter.off()}hasListeners(){return _s(this._eventEmitter)}_channelStateListener(e){if(this._logger.debug("RoomLifecycleManager.channel state changed",{oldState:e.previous,newState:e.current,reason:e.reason,resumed:e.resumed}),this._operationInProgress()){this._logger.debug("RoomLifecycleManager._startMonitoringChannelState(); ignoring channel state change - operation in progress",{status:this._roomLifecycle.status});return}const r=this._mapChannelStateToRoomStatus(e.current);this._setStatus(r,e.reason)}_discontinuityOnAttachedListener(e){if(!e.resumed&&this._hasAttachedOnce&&!this._isExplicitlyDetached){const r=new Ke.ErrorInfo("discontinuity detected",xo.RoomDiscontinuity,e.reason?.statusCode??0,e.reason);this._logger.warn("RoomLifecycleManager._startMonitoringDiscontinuity(); discontinuity detected",{error:r}),this._eventEmitter.emit(Nc.Discontinuity,r)}}_discontinuityOnUpdateListener(e){if(!e.resumed&&this._hasAttachedOnce&&!this._isExplicitlyDetached&&e.current==="attached"&&e.previous==="attached"){const r=new Ke.ErrorInfo("discontinuity detected",xo.RoomDiscontinuity,e.reason?.statusCode??0,e.reason);this._logger.warn("RoomLifecycleManager._startMonitoringDiscontinuity(); discontinuity detected",{error:r}),this._eventEmitter.emit(Nc.Discontinuity,r)}}async _channelDetachLoop(e){for(;;){if(e.state==="failed"){this._logger.debug("RoomLifecycleManager._channelDetachLoop(); channel is failed, skipping detach");break}try{await e.detach();break}catch(r){this._logger.error("RoomLifecycleManager._channelDetachLoop(); failed to detach channel during release",{error:r}),await new Promise(a=>setTimeout(a,250))}}}_setStatus(e,r){this._logger.debug("RoomLifecycleManager._setStatus(); updating room status",{oldStatus:this._roomLifecycle.status,newStatus:e,hasError:!!r}),this._roomLifecycle.setStatus({status:e,error:r})}_releaseChannel(){this._channelManager.release(),this._setStatus(Rt.Released),this._logger.debug("RoomLifecycleManager._releaseChannel(); room released successfully")}_operationInProgress(){return this._mutex.isLocked()}testForceHasAttachedOnce(e){this._logger.trace("RoomLifecycleManager.testForceHasAttachedOnce();",{firstAttach:e}),this._hasAttachedOnce=e}}const Ku={typing:{heartbeatThrottleMs:1e4},occupancy:{enableEvents:!1},presence:{enableEvents:!0},messages:{rawMessageReactions:!1,defaultMessageReactionType:Io.Distinct}},c1=n=>new Ke.ErrorInfo(`invalid room configuration: ${n}`,40001,400),l1=n=>{u1(n.typing)},u1=n=>{if(n.heartbeatThrottleMs<=0)throw c1("typing heartbeat interval must be greater than 0")},d1=n=>({...Ku.typing,...n?.typing}),f1=n=>({...Ku.occupancy,...n?.occupancy}),h1=n=>({...Ku.presence,...n?.presence}),p1=n=>({...Ku.messages,...n?.messages}),g1=(n,e)=>({typing:d1(n),occupancy:f1(n),presence:h1(n),messages:p1(n),isReactClient:e}),v_=(n,e)=>({name:n,data:e,extras:{ephemeral:!0}}),m1=n=>{const e=n.extras?n.extras:{};return{...n,extras:{...e,ephemeral:!0}}};class v1{constructor(e,r,a,l,f,h){this.name=e,this.clientId=r,this.createdAt=a,this.isSelf=l,this.metadata=f,this.headers=h,Object.freeze(this)}}const y1=(n,e)=>{const r=n,a=r.data?.name&&typeof r.data.name=="string"?r.data.name:"",l=r.clientId??"",f=r.timestamp?new Date(r.timestamp):new Date;return new v1(a,l,f,e?e===l:!1,r.data?.metadata??{},r.extras?.headers??{})};class _1{constructor(e,r,a,l){this._emitter=new mi,this._forwarder=h=>{const y=y1(h,this._clientId);this._emitter.emit(Gh.Reaction,{type:Gh.Reaction,reaction:y})},this._channel=e,this._connection=r,this._clientId=a,this._logger=l;const f=this._forwarder.bind(this);this._unsubscribeRoomReactionEvents=Ao(this._channel,[Hh.Reaction],f)}send(e){this._logger.trace("RoomReactions.send();",e);const{name:r,metadata:a,headers:l}=e;if(!r)return Promise.reject(new Ke.ErrorInfo("unable to send reaction; name not set and it is required",40001,400));if(this._connection.state!=="connected")return Promise.reject(new Ke.ErrorInfo("unable to send reaction; not connected to Ably",4e4,400));const f={name:r,metadata:a??{}},h={name:Hh.Reaction,data:f,extras:{headers:l??{}}};return this._channel.publish(m1(h))}subscribe(e){this._logger.trace("RoomReactions.subscribe();");const r=Er(e);return this._emitter.on(r),{unsubscribe:()=>{this._logger.trace("RoomReactions.unsubscribe();"),this._emitter.off(r)}}}dispose(){this._unsubscribeRoomReactionEvents(),this._emitter.off()}hasListeners(){return _s(this._emitter)}}class w1 extends mi{constructor(e,r,a,l,f){super(),this._timeoutMs=2e3,this._mutex=new m_,this._internalSubscribeToEvents=h=>{const{name:y,clientId:v}=h;if(this._logger.trace("DefaultTyping._internalSubscribeToEvents(); received event",{name:y,clientId:v}),!v){this._logger.error("DefaultTyping._internalSubscribeToEvents(); invalid clientId in received event",{inbound:h});return}y===Hr.Started||y===Hr.Stopped?this._updateCurrentlyTyping(v,y):this._logger.warn("DefaultTyping._internalSubscribeToEvents(); unrecognized event",{name:y})},this._clientId=l,this._channel=a,this._connection=r,this._heartbeatThrottleMs=e.heartbeatThrottleMs,this._currentlyTyping=new Map,this._logger=f,this._unsubscribeTypingEvents=Ao(this._channel,[Hr.Started,Hr.Stopped],this._internalSubscribeToEvents.bind(this))}_clearAllTypingStates(){this._logger.debug("DefaultTyping._clearAllTypingStates(); clearing all typing states"),this._clearHeartbeatTimer(),this._clearCurrentlyTyping()}_clearHeartbeatTimer(){this._logger.trace("DefaultTyping._clearHeartbeatTimer(); clearing heartbeat timer"),this._heartbeatTimerId&&(clearTimeout(this._heartbeatTimerId),this._heartbeatTimerId=void 0)}_clearCurrentlyTyping(){this._logger.trace("DefaultTyping._clearCurrentlyTyping(); clearing current store and timeouts");for(const[,e]of this._currentlyTyping.entries())clearTimeout(e);this._currentlyTyping.clear()}current(){return this._logger.trace("DefaultTyping.current();"),new Set(this._currentlyTyping.keys())}get channel(){return this._channel}_startHeartbeatTimer(){if(!this._heartbeatTimerId){this._logger.trace("DefaultTyping.startHeartbeatTimer();");const e=this._heartbeatTimerId=setTimeout(()=>{this._logger.debug("DefaultTyping.startHeartbeatTimer(); heartbeat timer expired"),e===this._heartbeatTimerId&&(this._heartbeatTimerId=void 0)},this._heartbeatThrottleMs)}}async keystroke(){this._logger.trace("DefaultTyping.keystroke();"),this._mutex.cancel();try{await this._mutex.acquire()}catch(e){if(e===Qu){this._logger.debug("DefaultTyping.keystroke(); mutex was canceled by a later operation");return}throw new Ke.ErrorInfo("mutex acquisition failed",5e4,500)}try{if(this._connection.state!=="connected")throw this._logger.error("DefaultTyping.keystroke(); connection is not connected",{status:this._connection.state}),new Ke.ErrorInfo("cannot type, connection is not connected",4e4,400);if(this._heartbeatTimerId){this._logger.debug("DefaultTyping.keystroke(); no-op, already typing and heartbeat timer has not expired");return}await this._channel.publish(v_(Hr.Started)),this._startHeartbeatTimer(),this._logger.trace("DefaultTyping.keystroke(); starting timers")}finally{this._logger.trace("DefaultTyping.keystroke(); releasing mutex"),this._mutex.release()}}async stop(){this._logger.trace("DefaultTyping.stop();"),this._mutex.cancel();try{await this._mutex.acquire()}catch(e){if(e===Qu){this._logger.debug("DefaultTyping.stop(); mutex was canceled by a later operation");return}throw new Ke.ErrorInfo("mutex acquisition failed",5e4,500)}try{if(this._connection.state!=="connected")throw this._logger.error("DefaultTyping.stop(); connection is not connected",{status:this._connection.state}),new Ke.ErrorInfo("cannot stop typing, connection is not connected",4e4,400);if(!this._heartbeatTimerId){this._logger.debug("DefaultTyping.stop(); no-op, not currently typing");return}await this._channel.publish(v_(Hr.Stopped)),this._logger.trace("DefaultTyping.stop(); clearing timers"),clearTimeout(this._heartbeatTimerId),this._heartbeatTimerId=void 0}finally{this._logger.trace("DefaultTyping.stop(); releasing mutex"),this._mutex.release()}}subscribe(e){this._logger.trace("DefaultTyping.subscribe();");const r=Er(e);return this.on(r),{unsubscribe:()=>{this._logger.trace("DefaultTyping.unsubscribe();"),this.off(r)}}}async dispose(){for(this._logger.trace("DefaultTyping.dispose();");;)try{this._mutex.cancel(),await this._mutex.acquire();break}catch(e){if(e===Qu)this._logger.debug("DefaultTyping.dispose(); mutex was canceled"),await new Promise(r=>setTimeout(r,200)),this._logger.debug("DefaultTyping.dispose(); retrying mutex acquisition");else{this._logger.error("DefaultTyping.dispose(); failed to acquire mutex; could not complete resource disposal",{error:e});return}}this._clearAllTypingStates(),this._unsubscribeTypingEvents(),this.off(),this._mutex.release()}_updateCurrentlyTyping(e,r){this._logger.trace("DefaultTyping._updateCurrentlyTyping();",{clientId:e,event:r}),r===Hr.Started?this._handleTypingStart(e):this._handleTypingStop(e)}_startNewClientInactivityTimer(e){this._logger.trace("DefaultTyping._startNewClientInactivityTimer(); starting new inactivity timer",{clientId:e});const r=setTimeout(()=>{if(this._logger.trace("DefaultTyping._startNewClientInactivityTimer(); client typing timeout expired",{clientId:e}),this._currentlyTyping.get(e)!==r){this._logger.debug("DefaultTyping._startNewClientInactivityTimer(); timeout already cleared; ignoring",{clientId:e});return}this._currentlyTyping.delete(e),this.emit(Po.SetChanged,{type:Po.SetChanged,currentlyTyping:new Set(this._currentlyTyping.keys()),change:{clientId:e,type:Hr.Stopped}})},this._heartbeatThrottleMs+this._timeoutMs);return r}_handleTypingStart(e){this._logger.debug("DefaultTyping._handleTypingStart();",{clientId:e});const r=this._startNewClientInactivityTimer(e),a=this._currentlyTyping.get(e);this._currentlyTyping.set(e,r),a?(this._logger.debug("DefaultTyping._handleTypingStart(); received heartbeat for currently typing client",{clientId:e}),clearTimeout(a)):(this._logger.debug("DefaultTyping._handleTypingStart(); new client started typing",{clientId:e}),this.emit(Po.SetChanged,{type:Po.SetChanged,currentlyTyping:new Set(this._currentlyTyping.keys()),change:{clientId:e,type:Hr.Started}}))}_handleTypingStop(e){const r=this._currentlyTyping.get(e);if(!r){this._logger.trace('DefaultTyping._handleTypingStop(); received "Stop" event for client not in currentlyTyping list',{clientId:e});return}this._logger.debug("DefaultTyping._handleTypingStop(); client stopped typing",{clientId:e}),clearTimeout(r),this._currentlyTyping.delete(e),this.emit(Po.SetChanged,{type:Po.SetChanged,currentlyTyping:new Set(this._currentlyTyping.keys()),change:{clientId:e,type:Hr.Stopped}})}get heartbeatThrottleMs(){return this._heartbeatThrottleMs}get hasHeartbeatTimer(){return!!this._heartbeatTimerId}}class b1{constructor(e,r,a,l,f,h){l1(a),this._nonce=r,this._logger=h.withContext({roomName:e,roomNonce:r}),this._logger.debug("Room();",{options:a}),this._name=e,this._options=a,this._chatApi=f,this._lifecycle=new o1(this._logger);const y=this._channelManager=this._getChannelManager(a,l,this._logger),v=y.get();this._messages=new JC(e,a.messages,v,this._chatApi,l.auth.clientId,this._logger),this._presence=new p_(v,l.auth.clientId,this._logger,a),this._typing=new w1(a.typing,l.connection,v,l.auth.clientId,this._logger),this._reactions=new _1(v,l.connection,l.auth.clientId,this._logger),this._occupancy=new h_(e,v,this._chatApi,this._logger,a),this._lifecycleManager=new a1(y,this._lifecycle,this._logger);let b=!1;this._finalizer=async()=>{if(b){this._logger.debug("Room.finalizer(); already finalized");return}await this._lifecycleManager.release(),this._lifecycleManager.dispose(),this._messages.dispose(),this._presence.dispose(),this._reactions.dispose(),this._occupancy.dispose(),await this._typing.dispose(),this._lifecycle.dispose(),b=!0}}_getChannelManager(e,r,a){const l=new e1(this._name,r,a,e.isReactClient);return l.mergeOptions(h_.channelOptionMerger(e)),l.mergeOptions(p_.channelOptionMerger(e)),l.mergeOptions(u_.channelOptionMerger(e)),l}get name(){return this._name}options(){return bs(this._options)}get messages(){return this._messages}get presence(){return this._presence}get reactions(){return this._reactions}get typing(){return this._typing}get occupancy(){return this._occupancy}get status(){return this._lifecycle.status}get error(){return this._lifecycle.error}onStatusChange(e){return this._lifecycle.onChange(e)}async attach(){return this._logger.trace("Room.attach();"),this._lifecycleManager.attach()}async detach(){return this._logger.trace("Room.detach();"),this._lifecycleManager.detach()}release(){return this._logger.trace("Room.release();"),this._finalizer()}get nonce(){return this._nonce}get lifecycle(){return this._lifecycle}get lifecycleManager(){return this._lifecycleManager}onDiscontinuity(e){return this._logger.trace("Room.onDiscontinuity();"),this._lifecycleManager.onDiscontinuity(e)}get channel(){return this._channelManager.get()}}class S1{constructor(e,r,a){this._rooms=new Map,this._releasing=new Map,this._isReact=!1,this._disposed=!1,this._realtime=e,this._chatApi=new QC(e,a),this._clientOptions=r,this._logger=a}async get(e,r){this._logger.trace("Rooms.get();",{roomName:e}),this._ensureNotDisposed();const a=this._rooms.get(e);if(a)return this._handleExistingRoom(a,e,r);const l=this._releasing.get(e),f=i_();return l?this._waitForReleaseAndCreateRoom(e,f,r,l):this._createNewRoom(e,f,r)}async release(e){this._logger.trace("Rooms.release();",{roomName:e});const r=this._rooms.get(e),a=this._releasing.get(e);return r?a?this._handleConcurrentRelease(e,r,a):this._performRoomRelease(e,r):this._handleNonExistentRoomRelease(e,a)}async dispose(){this._logger.trace("Rooms.dispose();"),this._disposed=!0;const e=[...this._rooms.keys()];if(e.length===0){this._logger.debug("Rooms.dispose(); no rooms to release");return}const r=e.map(f=>this.release(f)),a=[...this._releasing.values()],l=[...r,...a];this._logger.debug("Rooms.dispose(); releasing rooms",{roomCount:e.length,roomNames:e}),await Promise.all(l),this._logger.debug("Rooms.dispose(); all rooms released successfully")}get clientOptions(){return this._clientOptions}get count(){return this._rooms.size}_ensureNotDisposed(){if(this._disposed)throw new Ke.ErrorInfo("cannot get room, rooms instance has been disposed",4e4,400)}async _handleExistingRoom(e,r,a){if(!jc(e.options,a))throw new Ke.ErrorInfo("room already exists with different options",4e4,400);return this._logger.debug("Rooms.get(); returning existing room",{roomName:r,nonce:e.nonce,options:a}),await e.promise}_createNewRoom(e,r,a){const l=this._makeRoom(e,r,a),f={promise:Promise.resolve(l),nonce:r,options:a};return this._rooms.set(e,f),this._logger.debug("Rooms.get(); returning new room",{roomName:e,nonce:l.nonce}),l}async _waitForReleaseAndCreateRoom(e,r,a,l){const f=new AbortController,h=this._createAbortableRoomPromise(e,r,a,l,f);return this._rooms.set(e,{promise:h,options:a,nonce:r,abort:f}),this._logger.debug("Rooms.get(); creating new promise dependent on previous release",{roomName:e}),await h}_createAbortableRoomPromise(e,r,a,l,f){return new Promise((h,y)=>{const v=()=>{this._logger.debug("Rooms.get(); aborted before init",{roomName:e}),y(new Ke.ErrorInfo("room released before get operation could complete",xo.RoomReleasedBeforeOperationCompleted,400))};f.signal.addEventListener("abort",v),l.then(()=>{if(f.signal.aborted){this._logger.debug("Rooms.get(); aborted before releasing promise resolved",{roomName:e});return}this._logger.debug("Rooms.get(); releasing finished",{roomName:e});const b=this._makeRoom(e,r,a);f.signal.removeEventListener("abort",v),h(b)}).catch(b=>{f.signal.removeEventListener("abort",v),y(b)})})}async _handleNonExistentRoomRelease(e,r){if(r){this._logger.debug("Rooms.release(); waiting for previous release call",{roomName:e}),await r;return}this._logger.debug("Rooms.release(); room does not exist",{roomName:e})}async _handleConcurrentRelease(e,r,a){r.abort&&(this._logger.debug("Rooms.release(); aborting get call",{roomName:e,existingNonce:r.nonce}),r.abort.abort(),this._rooms.delete(e)),await a}async _performRoomRelease(e,r){this._rooms.delete(e);const a=this._executeRoomRelease(e,r);this._releasing.set(e,a),this._logger.debug("Rooms.release(); creating new release promise",{roomName:e,nonce:r.nonce}),await a}async _executeRoomRelease(e,r){const a=await r.promise;this._logger.debug("Rooms.release(); releasing room",{roomName:e,nonce:r.nonce}),await a.release(),this._logger.debug("Rooms.release(); room released",{roomName:e,nonce:r.nonce}),this._releasing.delete(e)}_makeRoom(e,r,a){return new b1(e,r,g1(a,this._isReact),this._realtime,this._chatApi,this._logger)}useReact(){this._logger.trace("Rooms.useReact();"),this._isReact=!0}}class k1{constructor(e,r){this._realtime=e,this._clientOptions=DC(r),this._nonce=i_(),this._logger=jC(this._clientOptions).withContext({chatClientNonce:this._nonce}),this._connection=new FC(e,this._logger),this._rooms=new S1(e,this._clientOptions,this._logger),this._addAgent("chat-js"),this._logger.trace(`ably chat client version ${Ju}; initialized`)}get rooms(){return this._rooms}get connection(){return this._connection}get clientId(){return this._realtime.auth.clientId}get realtime(){return this._realtime}get clientOptions(){return this._clientOptions}get logger(){return this._logger}addReactAgent(){this._addAgent("chat-react"),this._rooms.useReact()}addAgentWithVersion(e,r){this._addAgent(e,r),this._logger.trace(`Added agent ${e} with version ${r}`)}async dispose(){this._logger.trace("ChatClient.dispose();"),await this._rooms.dispose(),this._connection.dispose(),this._logger.debug("ChatClient.dispose(); client disposed successfully")}_addAgent(e,r){const a=this._realtime;a.options.agents={...a.options.agents??a.options.agents,[e]:r??Ju}}}const y_=Symbol.for("__ABLY_CONTEXT__"),__=typeof globalThis<"u"?globalThis:{};function C1(){let n=__[y_];return n||(n=__[y_]=tt.createContext({})),n}const w_=C1(),E1=({client:n,children:e,ablyId:r="default"})=>{if(!n)throw new Error("AblyProvider: the `client` prop is required");const a=tt.useContext(w_),l=U.useMemo(()=>Object.assign(Object.assign({},a),{[r]:{client:n,_channelNameToChannelContext:{}}}),[a,n,r]);return le.jsx(w_.Provider,Object.assign({value:l},{children:e}))},b_=U.createContext(void 0);Ke.Realtime.EventEmitter;var Xh=(n=>(n.Initialized="initialized",n.Connecting="connecting",n.Connected="connected",n.Disconnected="disconnected",n.Suspended="suspended",n.Failed="failed",n))(Xh||{});const S_=Symbol.for("__ABLY_CHAT_CLIENT_CONTEXT__"),k_=typeof globalThis>"u"?{}:globalThis,M1=()=>{let n=k_[S_];return n??=k_[S_]=tt.createContext({}),n},Yu=M1();var C_=Object.prototype.hasOwnProperty;function E_(n,e,r){for(r of n.keys())if(Dc(r,e))return r}function Dc(n,e){var r,a,l;if(n===e)return!0;if(n&&e&&(r=n.constructor)===e.constructor){if(r===Date)return n.getTime()===e.getTime();if(r===RegExp)return n.toString()===e.toString();if(r===Array){if((a=n.length)===e.length)for(;a--&&Dc(n[a],e[a]););return a===-1}if(r===Set){if(n.size!==e.size)return!1;for(a of n)if(l=a,l&&typeof l=="object"&&(l=E_(e,l),!l)||!e.has(l))return!1;return!0}if(r===Map){if(n.size!==e.size)return!1;for(a of n)if(l=a[0],l&&typeof l=="object"&&(l=E_(e,l),!l)||!Dc(a[1],e.get(l)))return!1;return!0}if(r===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(r===DataView){if((a=n.byteLength)===e.byteLength)for(;a--&&n.getInt8(a)===e.getInt8(a););return a===-1}if(ArrayBuffer.isView(n)){if((a=n.byteLength)===e.byteLength)for(;a--&&n[a]===e[a];);return a===-1}if(!r||typeof n=="object"){a=0;for(r in n)if(C_.call(n,r)&&++a&&!C_.call(e,r)||!(r in e)||!Dc(n[r],e[r]))return!1;return Object.keys(e).length===a}}return n!==n&&e!==e}var Zh=(n=>(n[n.BadRequest=4e4]="BadRequest",n[n.MessageRejectedByBeforePublishRule=42211]="MessageRejectedByBeforePublishRule",n[n.MessageRejectedByModeration=42213]="MessageRejectedByModeration",n[n.PresenceAutoReentryFailed=91004]="PresenceAutoReentryFailed",n[n.RoomDiscontinuity=102100]="RoomDiscontinuity",n[n.RoomInFailedState=102101]="RoomInFailedState",n[n.RoomIsReleasing=102102]="RoomIsReleasing",n[n.RoomIsReleased=102103]="RoomIsReleased",n[n.RoomReleasedBeforeOperationCompleted=102106]="RoomReleasedBeforeOperationCompleted",n))(Zh||{});const T1=(n,e)=>n.code===e,ep=n=>{if(n===null||typeof n!="object")return n;if(Array.isArray(n))return n.sort().map(a=>ep(a));const e={},r=Object.keys(n).sort();for(const a of r)e[a]=ep(n[a]);return e},O1=(n,e)=>{if(e===void 0)return;if(e===null||typeof e!="object")return e;if(Array.isArray(e))return e.sort().map(l=>ep(l));const r={},a=Object.keys(e).sort();for(const l of a)r[l]=e[l];return r},Xu=(n,e)=>JSON.stringify({roomName:n,options:e},O1);class R1{constructor(e,r){this._refCounts=new Map,this._releaseDelayMs=100,this._pendingReleases=new Map,this._client=e,this._logger=r}get client(){return this._client}async addReference(e,r){this._logger.trace("RoomReferenceManager.addReference();");const a=Xu(e,r),l=this._refCounts.get(a);if(l)return l.pendingRelease&&(clearTimeout(l.pendingRelease),l.pendingRelease=void 0,this._logger.debug("RoomReferenceManager.addReference(); aborted pending release",{roomName:e,options:r})),l.count++,this._logger.debug("RoomReferenceManager.addReference(); incremented ref count",{roomName:e,options:r,count:l.count}),l.resolvedRoom?l.resolvedRoom:new Promise((v,b)=>{const C=setInterval(()=>{l.resolvedRoom?(clearInterval(C),v(l.resolvedRoom)):l.resolutionError&&(clearInterval(C),b(l.resolutionError))},100)});const f=this._pendingReleases.get(e);if(f){this._logger.debug("RoomReferenceManager.addReference(); waiting for pending release to complete",{roomName:e,options:r});try{await f}catch(v){this._logger.debug("RoomReferenceManager.addReference(); pending release failed, continuing",{roomName:e,options:r,error:v})}}const h=[...this._refCounts.values()].find(v=>v.roomName===e&&!Dc(v.options,r));if(h){const v=h.pendingRelease!==void 0,b=h.count<=0;if(!v&&!b)throw new Ke.ErrorInfo(`cannot get room with different options; room "${e}" is already in use with different options`,Zh.BadRequest,400);this._logger.debug("RoomReferenceManager.addReference(); found existing room with different options, releasing it first",{roomName:e,newOptions:r,existingOptions:h.options,hasPendingRelease:v,hasZeroRefCount:b}),h.pendingRelease&&(clearTimeout(h.pendingRelease),h.pendingRelease=void 0);const C=Xu(e,h.options);this._refCounts.delete(C);const T=this._client.rooms.release(e).catch(L=>{this._logger.debug("RoomReferenceManager.addReference(); release of existing room failed",{roomName:e,error:L})}).finally(()=>{this._pendingReleases.delete(e)});this._pendingReleases.set(e,T);try{await T}catch(L){this._logger.debug("RoomReferenceManager.addReference(); release of existing room failed, continuing",{roomName:e,error:L})}}const y={count:1,roomName:e,options:r};this._refCounts.set(a,y),this._logger.debug("RoomReferenceManager.addReference(); first reference, attaching room",{roomName:e,options:r});try{const v=await this._client.rooms.get(e,r);return y.resolvedRoom=v,v.attach().catch(b=>{this._logger.error("RoomReferenceManager.addReference(); error attaching room",{roomName:e,options:r,error:b})}),v}catch(v){throw y.resolutionError=v,this._refCounts.delete(a),this._logger.error("RoomReferenceManager.addReference(); error creating room",{roomName:e,options:r,error:v}),v}}removeReference(e,r){this._logger.trace("RoomReferenceManager.removeReference();");const a=Xu(e,r),l=this._refCounts.get(a);if(!l){this._logger.debug("RoomReferenceManager.removeReference(); no existing reference found",{roomName:e,options:r});return}l.count--,this._logger.debug("RoomReferenceManager.removeReference(); decremented ref count",{roomName:e,options:r,count:l.count}),l.count<=0&&(this._logger.debug("RoomReferenceManager.removeReference(); scheduling delayed release",{roomName:e,options:r,delayMs:this._releaseDelayMs}),l.pendingRelease=setTimeout(()=>{const f=this._refCounts.get(a);if(f&&f.count<=0){this._refCounts.delete(a),this._logger.debug("RoomReferenceManager.removeReference(); executing delayed release",{roomName:e,options:r});const h=this._client.rooms.release(e).catch(y=>{this._logger.debug("RoomReferenceManager.removeReference(); release failed",{roomName:e,options:r,error:y})}).finally(()=>{this._pendingReleases.delete(e)});this._pendingReleases.set(e,h)}},this._releaseDelayMs))}getReferenceCount(e,r){this._logger.trace("RoomReferenceManager.getReferenceCount();");const a=Xu(e,r);return this._refCounts.get(a)?.count??0}}const M_=Symbol("roomReferenceManager"),A1=()=>{const n=U.useContext(Yu)[M_];if(!n)throw new Ke.ErrorInfo("useRoomReferenceManager must be used within a ChatClientProvider",4e4,400);return n},T_="default",P1=({children:n,client:e})=>{const r=U.useContext(Yu),a=U.useRef(void 0),l=U.useMemo(()=>{if(e.addReactAgent(),!a.current||a.current.client!==e){const h=e.logger;a.current=new R1(e,h)}const f=globalThis.__ABLY_CHAT_REACT_UI_COMPONENTS_VERSION__;return typeof f=="string"&&e.addAgentWithVersion("chat-react-ui-components",f),{...r,[T_]:{client:e},[M_]:a.current}},[e,r]);return le.jsx(Yu.Provider,{value:l,children:n})},Zu=()=>{const n=tt.useContext(Yu)[T_];if(!n)throw new Ke.ErrorInfo("useChatClient hook must be used within a chat client provider",4e4,400);return n.client},Aa=n=>{const e=U.useContext(b_);if(!e)throw new Ke.ErrorInfo(`${n} hook must be used within a <ChatRoomProvider>`,4e4,400);return e},O_=()=>{const n=Zu();return U.useMemo(()=>n.logger,[n])},Uc=()=>{const n=Aa("useRoomLogger"),e=Zu();return U.useMemo(()=>e.logger.withContext({roomName:n.roomName}),[e,n])},Gr=n=>{const e=U.useRef(n);U.useEffect(()=>{e.current=n});const r=U.useCallback((...a)=>{e.current&&e.current(...a)},[]);return n?r:void 0},ed=n=>{const e=Zu(),r=O_();r.trace("useChatConnection();",n);const[a,l]=U.useState(e.connection.status),[f,h]=U.useState(e.connection.error);U.useEffect(()=>{h(e.connection.error),l(e.connection.status)},[e]);const y=Gr(n?.onStatusChange);return U.useEffect(()=>{r.debug("useChatConnection(); applying internal listener");const{off:v}=e.connection.onStatusChange(b=>{l(b.current),h(b.error)});return()=>{r.debug("useChatConnection(); cleaning up listener"),v()}},[e.connection,r]),U.useEffect(()=>{if(!y)return;r.debug("useChatConnection(); applying client listener");const{off:v}=e.connection.onStatusChange(y);return()=>{r.debug("useChatConnection(); cleaning up client listener"),v()}},[e.connection,r,y]),{currentStatus:a,error:f}};class I1{constructor(e,r,a){this._unmounted=!1,this._onResolve=r,this._logger=a,this.mount(e).catch(l=>{this._logger.trace("DefaultRoomPromise(); mount error",{error:l})})}async mount(e){this._logger.debug("DefaultRoomPromise(); mount");try{const r=await e;if(this._unmounted)return;this._logger.debug("DefaultRoomPromise(); mount resolved"),this._onUnmount=this._onResolve(r)}catch(r){this._logger.error("DefaultRoomPromise(); mount error",{error:r})}}unmount(){return this._unmounted?()=>{}:()=>{this._logger.debug("DefaultRoomPromise(); unmount"),this._unmounted=!0,this._onUnmount?.()}}}const bn=(n,e,r)=>new I1(n,e,r);var Ss=(n=>(n.Initializing="initializing",n.Initialized="initialized",n.Attaching="attaching",n.Attached="attached",n.Detaching="detaching",n.Detached="detached",n.Suspended="suspended",n.Failed="failed",n.Releasing="releasing",n.Released="released",n))(Ss||{});const td=n=>{const e=Aa("useRoomStatus"),[r,a]=U.useState(Ss.Initializing),[l,f]=U.useState(),h=Uc(),y=Gr(n?.onRoomStatusChange);return U.useEffect(()=>bn(e.room,v=>{h.debug("useRoomStatus(); subscribing internal listener"),a(v.status),f(v.error);const{off:b}=v.onStatusChange(C=>{h.debug("useRoomStatus(); status change",C),a(C.current),f(C.error)});return()=>{h.debug("useRoomStatus(); unsubscribing internal listener"),b()}},h).unmount(),[e,h]),U.useEffect(()=>bn(e.room,v=>{let b;return y&&(h.debug("useRoomStatus(); subscribing to status changes"),b=v.onStatusChange(y).off),h.debug("useRoomStatus(); setting initial status",{status:v.status}),y&&(h.debug("useRoomStatus(); sending initial status event"),y({current:v.status,previous:Ss.Initializing,error:v.error})),()=>{h.debug("useRoomStatus(); unmounting"),b&&(h.debug("useRoomStatus(); unsubscribing from status changes"),b())}},h).unmount(),[e,h,y]),{status:r,error:l}},R_=n=>{const{currentStatus:e,error:r}=ed({onStatusChange:n?.onConnectionStatusChange}),a=Aa("useMessages"),{status:l,error:f}=td(n),h=Uc();h.trace("useMessages();",{params:n});const y=Gr(n?.listener),v=Gr(n?.reactionsListener),b=Gr(n?.rawReactionsListener),C=Gr(n?.onDiscontinuity),T=U.useCallback(x=>a.room.then($=>$.messages.send(x)),[a]),L=U.useCallback(x=>a.room.then($=>$.messages.get(x)),[a]),A=U.useCallback((x,$)=>a.room.then(q=>q.messages.delete(x,$)),[a]),P=U.useCallback(x=>a.room.then($=>$.messages.history(x)),[a]),R=U.useCallback((x,$,q)=>a.room.then(re=>re.messages.update(x,$,q)),[a]),N=U.useCallback((x,$)=>a.room.then(q=>q.messages.reactions.send(x,$)),[a]),V=U.useCallback((x,$)=>a.room.then(q=>q.messages.reactions.delete(x,$)),[a]),[G,X]=U.useState();return U.useEffect(()=>{if(y)return bn(a.room,x=>{let $=!1;h.debug("useMessages(); applying listener");const q=x.messages.subscribe(y);return X(()=>{if(h.debug("useMessages(); setting historyBeforeSubscribe state",{status:x.status,unmounted:$}),!$)return re=>(h.debug("useMessages(); historyBeforeSubscribe called"),$?Promise.reject(new Ke.ErrorInfo("component unmounted",4e4,400)):q.historyBeforeSubscribe(re))}),()=>{h.debug("useMessages(); removing listener and historyBeforeSubscribe state"),$=!0,q.unsubscribe(),X(void 0)}},h).unmount()},[a,h,y]),U.useEffect(()=>{if(C)return bn(a.room,x=>{h.debug("useMessages(); applying onDiscontinuity listener");const{off:$}=x.onDiscontinuity(C);return()=>{h.debug("useMessages(); removing onDiscontinuity listener"),$()}},h).unmount()},[a,h,C]),U.useEffect(()=>{if(v)return bn(a.room,x=>{h.debug("useMessages(); applying reactions listener");const{unsubscribe:$}=x.messages.reactions.subscribe(v);return()=>{h.debug("useMessages(); removing reactions listener"),$()}},h).unmount()},[a,h,v]),U.useEffect(()=>{if(b)return bn(a.room,x=>{h.debug("useMessages(); applying raw reactions listener");const{unsubscribe:$}=x.messages.reactions.subscribeRaw(b);return()=>{h.debug("useMessages(); removing raw reactions listener"),$()}},h).unmount()},[a,h,b]),{connectionStatus:e,connectionError:r,roomStatus:l,roomError:f,sendMessage:T,getMessage:L,updateMessage:R,history:P,deleteMessage:A,sendReaction:N,deleteReaction:V,historyBeforeSubscribe:G}},A_=new Set([Xh.Suspended,Xh.Failed]),x1=n=>{const{currentStatus:e,error:r}=ed({onStatusChange:n?.onConnectionStatusChange}),a=Aa("usePresence"),{status:l,error:f}=td(n),h=Uc();h.trace("usePresence();",{params:n});const y=U.useMemo(()=>n?.autoEnterLeave!==!1,[n?.autoEnterLeave]),[v,b]=U.useState({present:!1,error:void 0}),C=U.useRef({roomStatus:l,connectionStatus:e}),T=Gr(n?.onDiscontinuity),L=U.useRef(n?.initialData),A=U.useRef(!1),P=U.useRef(!1),R=U.useRef(!1);U.useEffect(()=>{P.current=!1,R.current=!1},[a]),U.useEffect(()=>{C.current={roomStatus:l,connectionStatus:e},l===Ss.Detached&&(R.current=!0)},[l,e]),U.useEffect(()=>(h.debug("usePresence(); subscribing to presence state changes"),bn(a.room,X=>{const x=X.presence.onPresenceStateChange($=>{h.debug("usePresence(); presence state changed",{stateChange:$}),b({...$.current,error:$.error})});return()=>{h.debug("usePresence(); unsubscribing from presence state changes"),x.unsubscribe()}},h).unmount()),[a,h]),U.useEffect(()=>(h.debug("usePresence(); running auto-enter hook"),y?bn(a.room,X=>{const x=X.status===Ss.Attached&&!A_.has(e),$=!P.current||R.current;return!x||A.current||!$?(h.debug("usePresence(); skipping enter room",{roomStatus:l,connectionStatus:e,hasExplicitlyLeft:A.current,shouldAutoEnter:$,hasAutoEntered:P.current,roomWasDetached:R.current}),()=>{}):(h.debug("usePresence(); entering room"),X.presence.enter(L.current).then(()=>{h.debug("usePresence(); entered room"),P.current=!0,R.current=!1}).catch(q=>{h.error("usePresence(); error entering room",{error:q})}),()=>{const q=X.status===Ss.Attached&&!A_.has(C.current.connectionStatus);h.debug("usePresence(); unmounting",{canLeavePresence:q,roomStatus:l,connectionStatus:e}),q&&!A.current&&X.presence.leave().then(()=>{h.debug("usePresence(); left room")}).catch(re=>{h.error("usePresence(); error leaving room",{error:re})})})},h).unmount():(h.debug("usePresence(); auto enter/leave disabled"),()=>{})),[a,e,l,h,y]),U.useEffect(()=>{if(T)return bn(a.room,X=>{const{off:x}=X.onDiscontinuity(T);return()=>{h.debug("usePresence(); removing onDiscontinuity listener"),x()}},h).unmount()},[a,T,h]);const N=U.useCallback(async X=>{L.current=X,A.current=!1,await(await a.room).presence.update(X)},[a]),V=U.useCallback(async X=>{L.current=X,A.current=!1,await(await a.room).presence.enter(X)},[a]),G=U.useCallback(async X=>{A.current=!0,await(await a.room).presence.leave(X)},[a]);return{connectionStatus:e,connectionError:r,roomStatus:l,roomError:f,update:N,enter:V,leave:G,myPresenceState:v}},L1=1500,j1=3e4,N1=5,D1=n=>{const{currentStatus:e,error:r}=ed({onStatusChange:n?.onConnectionStatusChange}),a=Aa("usePresenceListener"),{status:l,error:f}=td(n),h=Uc();h.trace("usePresenceListener();");const y=U.useRef(0),v=U.useRef(0),b=U.useRef(void 0),C=U.useRef(0),T=U.useRef([]),[L,A]=U.useState([]),P=U.useRef(void 0),[R,N]=U.useState(),V=Gr(n?.listener),G=Gr(n?.onDiscontinuity),X=U.useCallback($=>{h.debug("usePresenceListener(); setting error state",{error:$}),P.current=$,N($)},[h]),x=U.useCallback(()=>{h.debug("usePresenceListener(); clearing error state"),P.current=void 0,N(void 0)},[h]);return U.useEffect(()=>{const $=()=>{y.current+=1,b.current&&(clearTimeout(b.current),b.current=void 0,C.current=0),q(y.current)},q=re=>{bn(a.room,me=>(me.presence.get({waitForSync:!0}).then(ae=>{h.debug("usePresenceListener(); fetched presence data",{presenceMembers:ae}),b.current&&(clearTimeout(b.current),b.current=void 0,C.current=0),!(v.current>=re)&&(v.current=re,T.current=ae,A(ae),P.current&&x())}).catch(()=>{if(!(C.current<N1)){h.error("usePresenceListener(); failed to fetch presence data after max retries"),X(new Ke.ErrorInfo("failed to fetch presence data after max retries",5e4,500));return}if(b.current){h.debug("usePresenceListener(); waiting for retry but new event received");return}const ae=Math.min(j1,L1*Math.pow(2,C.current));C.current+=1,h.debug("usePresenceListener(); retrying to fetch presence data",{numRetries:C.current}),b.current=setTimeout(()=>{b.current=void 0,y.current+=1,q(y.current)},ae)}),()=>{}),h)};return bn(a.room,re=>{let me;return re.status===Ss.Attached?re.presence.get({waitForSync:!0}).then(ae=>{h.debug("usePresenceListener(); fetched initial presence data",{presenceMembers:ae}),T.current=ae,A(ae),x()}).catch(ae=>{const we=ae;T1(we,Zh.RoomIsReleased)||(h.error("usePresenceListener(); error fetching initial presence data",{error:ae}),X(we))}).finally(()=>{h.debug("usePresenceListener(); subscribing internal listener to presence events"),me=re.presence.subscribe(()=>{$()}).unsubscribe}):(h.debug("usePresenceListener(); not yet attached, subscribing internal listener to presence events"),me=re.presence.subscribe(()=>{$()}).unsubscribe),()=>{me&&(h.debug("usePresenceListener(); cleaning up internal listener"),me())}},h).unmount()},[a,X,x,h]),U.useEffect(()=>{if(V)return bn(a.room,$=>{h.debug("usePresenceListener(); applying external listener");const{unsubscribe:q}=$.presence.subscribe(V);return()=>{h.debug("usePresenceListener(); cleaning up external listener"),q()}},h).unmount()},[a,V,h]),U.useEffect(()=>{if(G)return bn(a.room,$=>{h.debug("usePresenceListener(); applying onDiscontinuity listener");const{off:q}=$.onDiscontinuity(G);return()=>{h.debug("usePresenceListener(); removing onDiscontinuity listener"),q()}},h).unmount()},[a,G,h]),{connectionStatus:e,connectionError:r,roomStatus:l,roomError:f,error:R,presenceData:L}},P_=n=>{const{currentStatus:e,error:r}=ed({onStatusChange:n?.onConnectionStatusChange}),a=Aa("useTyping"),{status:l,error:f}=td(n),h=Uc();h.trace("useTyping();");const[y,v]=U.useState(new Set),b=Gr(n?.listener),C=Gr(n?.onDiscontinuity);U.useEffect(()=>(v(A=>A.size===0?A:new Set),bn(a.room,A=>{h.debug("useTyping(); subscribing to typing events");const{unsubscribe:P}=A.typing.subscribe(R=>{v(R.currentlyTyping)});if(A.status===Ss.Attached){const R=A.typing.current();h.debug("useTyping(); room attached, getting initial typers",{typing:R}),v(R)}return()=>{h.debug("useTyping(); unsubscribing from typing events"),P()}},h).unmount()),[a,h]),U.useEffect(()=>{if(C)return bn(a.room,A=>{h.debug("useTyping(); applying onDiscontinuity listener");const{off:P}=A.onDiscontinuity(C);return()=>{h.debug("useTyping(); removing onDiscontinuity listener"),P()}},h).unmount()},[a,C,h]),U.useEffect(()=>{if(b)return bn(a.room,A=>{h.debug("useTyping(); applying listener");const{unsubscribe:P}=A.typing.subscribe(b);return()=>{h.debug("useTyping(); removing listener"),P()}},h).unmount()},[a,b,h]);const T=U.useCallback(()=>a.room.then(A=>A.typing.keystroke()),[a]),L=U.useCallback(()=>a.room.then(A=>A.typing.stop()),[a]);return{connectionStatus:e,connectionError:r,roomStatus:l,roomError:f,keystroke:T,stop:L,currentlyTyping:y}},U1=({name:n,options:e,children:r})=>{const a=Zu(),l=O_(),f=U.useMemo(()=>l.withContext({roomName:n}),[l,n]),h=A1();f.debug("ChatRoomProvider();",{options:e});const[y,v]=U.useState(()=>{f.debug("ChatRoomProvider(); initializing value",{options:e});const b=a.rooms.get(n,e);return b.catch(()=>{}),{room:b,roomName:n,options:e,client:a}});return U.useEffect(()=>{f.debug("ChatRoomProvider(); running lifecycle useEffect");let b=!1;const C=h.addReference(n,e);return v(T=>T.client===a&&T.roomName===n&&T.options===e?(f.debug("ChatRoomProvider(); no change in room id or options",{options:e}),T):(f.debug("ChatRoomProvider(); updating value",{options:e}),{room:C,roomName:n,options:e,client:a})),C.then(()=>{if(b){f.debug("ChatRoomProvider(); unmounted before room resolved");return}f.debug("ChatRoomProvider(); room resolved")}).catch(()=>{}),()=>{b=!0,f.debug("ChatRoomProvider(); cleaning up lifecycle useEffect"),h.removeReference(n,e)}},[n,e,f,a,h]),le.jsx(b_.Provider,{value:y,children:r})},nd={DOMAIN:"demoservice.app",get API_BASE(){return"https://demoservice.app"}};function B1(){x1();const n=D1();return U.useEffect(()=>{if(n&&typeof n.enterPresence=="function")return n.enterPresence(),()=>{n&&typeof n.leavePresence=="function"&&n.leavePresence()}},[n]),null}function tp({userName:n,userImage:e}){const[r,a]=U.useState(!1),[l,f]=U.useState(!1);U.useEffect(()=>{e&&(a(!1),f(!1))},[e]);const h=e&&e.trim()&&!r,y=n&&n.trim(),v=!h&&!y;return le.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",overflow:"hidden",flexShrink:0,boxShadow:"0 2px 4px hsl(var(--foreground) / 0.1)",backgroundColor:"hsl(var(--muted))",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:h?le.jsxs(le.Fragment,{children:[!l&&le.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:600,color:"hsl(var(--muted-foreground))",backgroundColor:"hsl(var(--muted))"},children:y?n.charAt(0).toUpperCase():null}),le.jsx("img",{src:e,alt:n||"Avatar",onLoad:()=>f(!0),onError:()=>{a(!0),f(!1)},style:{width:"100%",height:"100%",objectFit:"cover",display:l?"block":"none"}})]}):v?le.jsx(e_,{className:"w-4 h-4 text-foreground"}):le.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:600,color:"hsl(var(--muted-foreground))",backgroundColor:"hsl(var(--muted))"},children:y?n.charAt(0).toUpperCase():null})})}const cn={container:(n,e)=>({flex:1,overflowY:"auto",padding:"12px",paddingTop:n||e?"48px":"12px",display:"flex",flexDirection:"column",gap:"12px",minHeight:0,maxHeight:"100%",background:"transparent",boxSizing:"border-box",transition:"padding-top 0.5s cubic-bezier(0.4, 0, 0.2, 1)"}),welcomeMessageWrapper:(n,e)=>({animation:n>e?"slideUp 0.4s ease-out forwards":"none",opacity:n>e?1:0,transform:n>e?"translateY(0)":"translateY(20px)"}),systemMessageWrapper:{display:"flex",alignItems:"center",justifyContent:"center",padding:"8px 0",width:"100%"},systemMessageText:{color:"hsl(var(--muted-foreground))",fontSize:"12px",fontWeight:500,textAlign:"center"},joinedMessageWrapper:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",width:"100%"},joinedMessageContainer:{borderRadius:"20px",padding:"12px 16px",display:"flex",flexDirection:"inline-flex",alignItems:"center",justifyContent:"flex-end",gap:"8px",width:"calc(80% + 40px)",minWidth:"fit-content"},joinedMessageText:{color:"hsl(var(--foreground))",fontSize:"13px",fontWeight:600,textAlign:"center",whiteSpace:"nowrap"},messageWrapper:n=>({display:"flex",flexDirection:"column",alignItems:n?"flex-end":"flex-start",width:"100%"}),messageBubble:(n,e)=>({backgroundColor:n?"hsl(var(--muted-special))":"hsl(var(--muted))",color:"hsl(var(--foreground))",padding:"10px 12px",borderRadius:e?"20px":n?"20px 20px 4px 20px":"20px 20px 20px 4px",maxWidth:"80%",minWidth:0,wordWrap:"break-word",overflowWrap:"break-word",wordBreak:"normal",fontSize:"13px",lineHeight:1.45,flexShrink:1,flex:"0 1 auto",boxSizing:"border-box",display:"inline-flex",alignItems:"center",gap:"8px"}),typingContainer:{display:"flex",alignItems:"center",gap:"8px",padding:"4px 0"},typingBubble:{backgroundColor:"hsl(var(--muted) / 0.8)",color:"hsl(var(--foreground))",padding:"6px 12px",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",gap:"6px",minHeight:"28px",minWidth:"56px"},typingBar:n=>({width:"5px",height:"14px",borderRadius:"3px",backgroundColor:"hsl(var(--foreground) / 0.8)",opacity:.9,transformOrigin:"bottom center",animation:"typingBars 1s ease-in-out infinite",animationDelay:`${n}s`})},I_=`
@keyframes typingBars {
  0% { transform: scaleY(0.4); opacity: 0.6; }
  25% { transform: scaleY(1); opacity: 1; }
  50% { transform: scaleY(0.6); opacity: 0.8; }
  75% { transform: scaleY(0.9); opacity: 0.9; }
  100% { transform: scaleY(0.4); opacity: 0.6; }
}
@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(20px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
`;function F1({userName:n,userImage:e}){return le.jsxs("div",{style:cn.typingContainer,children:[le.jsx(tp,{userName:n,userImage:e}),le.jsx("div",{style:cn.typingBubble,children:[0,.1,.2,.3].map(r=>le.jsx("div",{style:cn.typingBar(r)},r))}),le.jsx("style",{children:I_})]})}function z1({currentFields:n,visitorClientId:e,hasInviteHeader:r,onChatOpen:a,onCallClick:l,hasOverlay:f=!1}){const[h,y]=U.useState([]),v=U.useRef(null),[b,C]=U.useState(0),T=U.useRef(!1),[L,A]=U.useState(()=>n.isReused===!0?!!n.dailyRoomId||n.joined===!0&&!n.dailyRoomId?"call":"chat":null),P=!!n.sessionEndedAt,{currentlyTyping:R}=P_(),[N,V]=U.useState(!1);U.useEffect(()=>{if(L&&n.isReused!==!0){V(!1);const ae=setTimeout(()=>V(!0),1e3);return()=>clearTimeout(ae)}else V(!1)},[L,n.isReused]);const G=R?Array.from(R).filter(ae=>!(!ae||ae===e||ae.startsWith("system-"))):[],X=ae=>{const we=h.filter(S=>S.clientId===ae);if(we.length>0){const S=we[we.length-1];return{userName:S.metadata?.userName??null,userImage:S.metadata?.userImage??null}}return{userName:null,userImage:null}},x=R_({listener:ae=>{const we=ae.message;y(S=>[...S,we])}}),$=()=>{v.current?.scrollIntoView({behavior:"smooth"})};U.useEffect(()=>{x.roomStatus==="attached"&&x.history({direction:"backwards",limit:50}).then(ae=>{if(ae&&ae.items){const we=ae.items.reverse();console.log("[MessagesList] Loaded message history:",{messageCount:we.length,isReused:n.isReused,welcomeStepInitialized:T.current}),y(we)}}).catch(ae=>{console.error("Error getting message history:",ae)})},[x.roomStatus]),U.useEffect(()=>{if(T.current||n.isReused===!0){n.isReused===!0&&b!==0&&C(0);return}n.isReused!==void 0&&(T.current=!0,h.length===0?(C(1),setTimeout(()=>C(2),1e3),setTimeout(()=>C(3),2e3),setTimeout(()=>C(4),3e3)):C(4))},[n.isReused,h.length,b]);const q=[{id:"welcome-1",text:"Hi there!",clientId:"ai",metadata:{userName:null,userImage:null}},{id:"welcome-2",text:"We can chat here or start a call",clientId:"ai",metadata:{userName:null,userImage:null}},{id:"welcome-3",text:"Which would you like to start with?",clientId:"ai",metadata:{userName:null,userImage:null}},{id:"welcome-4",text:"",clientId:"ai",metadata:{userName:null,userImage:null,hasButtons:!0}},{id:"welcome-5",text:"",clientId:"ai",metadata:{userName:null,userImage:null,isRedirect:!0}}],re=[...b>=1?[q[0]]:[],...b>=2?[q[1]]:[],...b>=3?[q[2]]:[],...b>=4?[q[3]]:[],...L?[q[4]]:[]],me=n.isReused===!0?h:[...re,...h];return U.useEffect(()=>{$()},[h,G.length,b,L,N]),le.jsxs("div",{style:cn.container(!!r,f),children:[le.jsx("style",{children:I_}),me&&me.length>0&&me.map((ae,we)=>{if(ae.id?.startsWith("welcome-")){const oe=me[we+1],Q=ae.metadata?.hasButtons===!0,ue=ae.metadata?.isRedirect===!0;if(Q){const E=q.findIndex(D=>D.id===ae.id);return le.jsx("div",{style:{...cn.messageWrapper(!0),...cn.welcomeMessageWrapper(b,E)},children:le.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"8px",flexDirection:"row-reverse",width:"100%",maxWidth:"100%"},children:le.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"8px",background:"transparent"},children:le.jsxs("div",{style:{display:"flex",gap:"8px"},children:[le.jsxs("button",{onClick:()=>{L||n.isReused||(A("chat"),a?.())},disabled:L!==null||n.isReused===!0,style:{flex:1,padding:"10px 16px",borderRadius:"9999px",border:"none",background:L==="chat"?"hsl(var(--special))":L==="call"?"hsl(var(--special) / 0.5)":"hsl(var(--special))",color:"#ffffff",fontSize:"13px",fontWeight:600,cursor:L||n.isReused?"not-allowed":"pointer",transition:"all 0.15s ease",fontFamily:"inherit",opacity:L&&L!=="chat"?.5:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[le.jsx(Yy,{size:16}),le.jsx("span",{children:"Chat"})]}),le.jsxs("button",{onClick:()=>{L||n.isReused||(A("call"),l?.(),a?.())},disabled:L!==null||n.isReused===!0,style:{flex:1,padding:"10px 16px",borderRadius:"9999px",border:"none",background:L==="call"?"hsl(25 95% 53%)":L==="chat"?"hsl(25 95% 53% / 0.5)":"hsl(25 95% 53%)",color:"#ffffff",fontSize:"13px",fontWeight:600,cursor:L||n.isReused?"not-allowed":"pointer",transition:"all 0.15s ease",fontFamily:"inherit",opacity:L&&L!=="call"?.5:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"6px"},children:[le.jsx(Zy,{size:16}),le.jsx("span",{children:"Call"})]})]})})})},ae.id)}const g=q.findIndex(E=>E.id===ae.id),M=ae.id==="welcome-4"||g===q.length-1&&!oe?.id?.startsWith("welcome-");return le.jsx("div",{style:{...cn.messageWrapper(!0),...ue?{}:cn.welcomeMessageWrapper(b,g),marginBottom:M?"-8px":void 0},children:le.jsx("div",{style:{display:"flex",alignItems:"flex-end",gap:"8px",flexDirection:"row-reverse",width:"100%",maxWidth:"100%"},children:le.jsx("div",{style:{...cn.messageBubble(!0,!1),maxWidth:"100%"},children:ue?N?le.jsx("span",{children:"Human agent has been notified and will join shortly"}):le.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px",whiteSpace:"nowrap"},children:[le.jsx("span",{children:"Redirecting to a real person"}),le.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[0,.1,.2,.3].map(E=>le.jsx("div",{style:cn.typingBar(E)},E))})]}):ae.text||ae.data})})},ae.id)}const Te=ae.metadata?.type==="system"||ae.metadata?.eventType==="joined"||ae.metadata?.eventType==="ended";if(ae.metadata?.eventType==="joined")return le.jsx("div",{style:cn.joinedMessageWrapper,children:le.jsxs("div",{style:cn.joinedMessageContainer,children:[le.jsx(tp,{userName:ae.metadata?.userName,userImage:ae.metadata?.userImage}),le.jsx("div",{style:cn.joinedMessageText,children:ae.text})]})},ae.id);if(Te)return le.jsx("div",{style:cn.systemMessageWrapper,children:le.jsx("div",{style:cn.systemMessageText,children:ae.text||"System message"})},ae.id);const ke=ae.clientId?.startsWith("embed-"),J=me[we+1],De=!J||J.clientId?.startsWith("embed-")!==ke||J.metadata?.type==="system"||J.metadata?.eventType==="joined"||J.id?.startsWith("welcome-"),et=ae.metadata?.userName??null,ve=ae.metadata?.userImage??null,ge=!ke&&De;return le.jsx("div",{style:cn.messageWrapper(ke),children:le.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:"8px",flexDirection:ke?"row-reverse":"row",width:"100%",maxWidth:"100%"},children:[ge&&le.jsx(tp,{userName:et,userImage:ve}),!ge&&!ke&&le.jsx("div",{style:{width:"32px",flexShrink:0}}),le.jsx("div",{style:cn.messageBubble(ke,!De),children:ae.text||ae.data})]})},ae.id)}),G.length>0&&!P&&(()=>{const ae=G[0],{userName:we,userImage:S}=X(ae);return le.jsx(F1,{userName:we,userImage:S})})(),le.jsx("div",{ref:v})]})}const Bc={wrapper:{padding:"0",display:"flex",flexDirection:"column",backgroundColor:"transparent",flexShrink:0},card:{borderTop:"1px solid hsl(var(--border) / 0.4)",borderRadius:"24px",backgroundColor:"hsl(var(--background))",padding:"10px",display:"flex",flexDirection:"column",gap:"8px"},inputRow:{position:"relative",display:"flex",alignItems:"center"},textarea:n=>({width:"100%",padding:"12px 48px 12px 14px",border:"1px solid hsl(var(--border) / 0.3)",borderRadius:"24px",resize:"none",fontSize:"13px",fontFamily:"inherit",outline:"none",backgroundColor:n?"hsl(var(--muted))":"hsl(var(--background) / 0.95)",color:n?"hsl(var(--muted-foreground))":"hsl(var(--foreground))",cursor:n?"not-allowed":"text"}),sendButton:(n,e)=>({position:"absolute",right:"8px",width:"32px",height:"32px",backgroundColor:"transparent",color:n||e?"hsl(var(--muted-foreground))":"hsl(var(--foreground))",border:"none",borderRadius:"50%",cursor:n?"not-allowed":"pointer",display:"flex",alignItems:"center",justifyContent:"center",padding:0})},np={container:{padding:"0",backgroundColor:"transparent",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",flexShrink:0},ghostButton:{display:"flex",alignItems:"center",gap:"4px",padding:"10px 8px",background:"transparent",color:"hsl(var(--foreground))",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.15s ease",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',whiteSpace:"nowrap",minHeight:"32px"},primaryButton:{display:"flex",alignItems:"center",gap:"8px",padding:"10px 14px",borderRadius:"9999px",background:"linear-gradient(to bottom, hsl(var(--constructive)), hsl(var(--constructive) / 0.85))",color:"hsl(var(--constructive-foreground))",border:"none",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.15s ease",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',whiteSpace:"nowrap",minHeight:"32px",boxShadow:"0 2px 4px hsl(var(--constructive) / 0.2)"}};function V1({currentFields:n,onCallClick:e,onCancelClick:r,onCloseClick:a,isConnecting:l}){const f=!!n.sessionEndedAt,h=!!n.dailyRoomId&&!f,y=!!n.joined;return f||h||(l||y&&!h)?null:le.jsxs("div",{style:np.container,children:[le.jsxs("button",{onClick:a,style:np.ghostButton,children:[le.jsx(CC,{size:13}),le.jsx("span",{children:"End chat"})]}),le.jsxs("button",{onClick:e,style:np.primaryButton,children:[le.jsx(t_,{size:13}),le.jsx("span",{children:"Start a video call"})]})]})}function $1({currentFields:n,onCallClick:e,onCancelClick:r,onCloseClick:a,isConnecting:l}){const[f,h]=U.useState(""),y=R_(),{keystroke:v,stop:b}=P_(),C=!!n.sessionEndedAt,T=U.useCallback(async()=>{if(f.trim()&&!C)try{const R=await y.sendMessage({text:f.trim()});h("");try{await b()}catch(N){console.error("Error stopping typing indicator:",N)}}catch(R){console.error("Error sending message:",R)}},[f,y,C,b]),L=R=>{R.key==="Enter"&&!R.shiftKey&&(R.preventDefault(),T())},A=R=>{h(R.target.value),C||v().catch(N=>{console.error("Error sending typing indicator:",N)})},P=()=>{C||b().catch(R=>{console.error("Error stopping typing indicator on blur:",R)})};return U.useEffect(()=>{C&&b().catch(()=>{})},[C,b]),U.useEffect(()=>()=>{b().catch(()=>{})},[b]),le.jsx("div",{style:Bc.wrapper,children:le.jsxs("div",{style:Bc.card,children:[le.jsx(V1,{currentFields:n,onCallClick:e,onCancelClick:r,onCloseClick:a,isConnecting:l}),le.jsxs("div",{style:Bc.inputRow,children:[le.jsx("textarea",{value:f,onChange:A,onKeyPress:L,onBlur:P,placeholder:"Send a message...",disabled:C,style:Bc.textarea(C),rows:1}),le.jsx("button",{onClick:T,disabled:C,style:Bc.sendButton(C,!f.trim()),children:le.jsx(TC,{size:14})})]})]})})}const q1={root:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"}};function W1({currentFields:n,onCallClick:e,onCancelClick:r,onCloseClick:a,visitorData:l,hasInviteHeader:f,showChatInput:h=!0,onChatOpen:y,isConnecting:v,hasOverlay:b=!1}){const C=l?`embed-${l.visitorId}`:void 0;return le.jsxs("div",{style:q1.root,children:[le.jsx(B1,{}),le.jsx(z1,{currentFields:n,visitorClientId:C,hasInviteHeader:f,onChatOpen:y,onCallClick:e,hasOverlay:b}),h&&le.jsx($1,{currentFields:n,onCallClick:e,onCancelClick:r,onCloseClick:a,isConnecting:v})]})}function H1({chatRoomId:n,visitorData:e,currentFields:r,onCallClick:a,onCancelClick:l,onCloseClick:f,inviteInfo:h,videoFrame:y,isConnecting:v,videoControls:b,onEndCall:C}){const[T,L]=U.useState(null),[A,P]=U.useState(r.isReused===!0),[R,N]=U.useState(!1),[V,G]=U.useState(!1),[X,x]=U.useState(null),$=tt.useRef(!1);U.useEffect(()=>{r.isReused===!0&&P(!0)},[r.isReused]),U.useEffect(()=>{if(!y){$.current=!1;return}!$.current&&!V&&!R&&r.isReused!==!0&&($.current=!0,G(!0),setTimeout(()=>G(!1),500))},[!!y,r.isReused,V,R]);const q=()=>{y?(x(y),N(!0),G(!1),setTimeout(()=>{N(!1),x(null),l()},500)):l()},re=!!(h?.showInvite||v&&y||b);return U.useEffect(()=>{if(!n||!e)return;const me=new Ke.Realtime({authCallback:async(we,S)=>{try{console.log("Requesting Ably token for visitor:",e.visitorId);const Te=await fetch(`${nd.API_BASE}/api/ably/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitorId:e.visitorId,sessionId:e.sessionId,companyId:e.companyId})});if(!Te.ok)throw new Error("Failed to get token");const ke=await Te.json();console.log("Received Ably token request:",!!ke),S(null,ke)}catch(Te){console.error("Token auth error:",Te),S(String(Te),null)}},clientId:`embed-${e.visitorId}`}),ae=new k1(me,{logLevel:qh.Info});return L({realtimeClient:me,chatClient:ae}),()=>{me.connection.close()}},[n,e]),!n||!e||!T?le.jsx("div",{style:{width:"100%",height:"320px",minHeight:"320px",maxHeight:"320px",flexShrink:0,flexGrow:0,backgroundColor:"hsl(var(--background))",borderRadius:"24px",display:"flex",flexDirection:"column",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',overflow:"hidden"},children:le.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"12px",textAlign:"center",color:"hsl(var(--muted-foreground))"},children:le.jsx("div",{children:le.jsx("p",{style:{margin:0,fontSize:"14px"},children:!n||!e?"Initializing...":"Connecting to chat..."})})})}):le.jsxs("div",{style:{width:"100%",minHeight:"320px",flexShrink:0,flexGrow:0,backgroundColor:"transparent",borderRadius:"24px",display:"flex",flexDirection:"column",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',overflow:"hidden",position:"relative"},children:[y&&!R&&le.jsx("div",{className:`video-frame-container ${V&&r.isReused!==!0?"entering":""}`,style:{width:"100%",flexShrink:0,borderTopLeftRadius:"24px",borderTopRightRadius:"24px",overflow:"hidden"},children:y}),R&&X&&le.jsx("div",{className:"video-frame-container exiting",style:{width:"100%",flexShrink:0,borderTopLeftRadius:"24px",borderTopRightRadius:"24px",overflow:"hidden"},children:X}),le.jsx("style",{children:`
        .video-frame-container {
          max-height: 192px;
          opacity: 1;
          transform: translateY(0);
        }
        
        .video-frame-container.entering {
          max-height: 0;
          opacity: 0;
          transform: translateY(100%);
          animation: slideUpFromBottom 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        
        .video-frame-container.exiting {
          animation: slideDownToBottom 0.5s cubic-bezier(0.4, 0, 0.2, 1) forwards;
        }
        
        @keyframes slideUpFromBottom {
          from {
            max-height: 0;
            opacity: 0;
            transform: translateY(100%);
          }
          to {
            max-height: 192px;
            opacity: 1;
            transform: translateY(0);
          }
        }
        
        @keyframes slideDownToBottom {
          from {
            max-height: 192px;
            opacity: 1;
            transform: translateY(0);
          }
          to {
            max-height: 0;
            opacity: 0;
            transform: translateY(100%);
          }
        }
      `}),le.jsxs("div",{style:{width:"100%",height:"320px",flexShrink:0,flexGrow:0,background:"hsl(var(--background) / 0.7)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)",borderRadius:y?"0 0 24px 24px":"24px",overflow:"visible",position:"relative"},children:[re&&le.jsxs("div",{style:{position:"absolute",top:"-24px",left:0,right:0,display:"flex",gap:"12px",background:"hsl(var(--background))",alignItems:h?.showInvite||v&&y?"flex-start":"center",justifyContent:b?"center":"flex-start",padding:"8px",boxSizing:"border-box",borderRadius:"24px 24px 0 0",zIndex:1e3,pointerEvents:"none",height:"fit-content",borderBottom:"1px solid hsl(var(--border) / 0.3)"},children:[h?.showInvite&&le.jsxs(le.Fragment,{children:[le.jsxs("button",{onClick:h.onAccept,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 18px",borderRadius:"18px",background:"linear-gradient(to bottom, hsl(var(--constructive)), hsl(var(--constructive) / 0.85))",color:"hsl(var(--constructive-foreground))",border:"1px solid hsl(var(--constructive-foreground) / 0.25)",fontSize:"15px",fontWeight:600,cursor:"pointer",pointerEvents:"auto"},children:[le.jsx(Zy,{size:16}),le.jsx("span",{children:"Accept"})]}),le.jsxs("button",{onClick:h.onDecline,style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 18px",borderRadius:"18px",background:"hsl(var(--background))",color:"hsl(var(--foreground))",border:"1px solid hsl(var(--border) / 0.6)",fontSize:"15px",fontWeight:600,cursor:"pointer",pointerEvents:"auto"},children:[le.jsx(Xy,{size:16}),le.jsx("span",{children:"Decline"})]})]}),v&&y&&!h?.showInvite&&le.jsx("button",{onClick:q,style:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",padding:"14px 18px",borderRadius:"18px",background:"hsl(var(--background))",color:"hsl(var(--foreground))",border:"1px solid hsl(var(--border) / 0.6)",fontSize:"15px",fontWeight:600,cursor:"pointer",pointerEvents:"auto"},children:le.jsx("span",{children:"Cancel"})}),b&&!h?.showInvite&&!(v&&y)&&le.jsxs(le.Fragment,{children:[le.jsx("button",{style:{flex:1,height:"48px",borderRadius:"18px",display:"flex",alignItems:"center",justifyContent:"center",background:"hsl(var(--muted))",color:"hsl(var(--foreground))",cursor:"pointer",pointerEvents:"auto"},children:le.jsx(Yy,{size:20})}),le.jsx("button",{onClick:b.onToggleMic,style:{flex:1,height:"48px",borderRadius:"18px",display:"flex",alignItems:"center",justifyContent:"center",background:"hsl(var(--background))",color:b.isMicEnabled?"hsl(var(--foreground))":"hsl(var(--muted-foreground))",cursor:"pointer",opacity:b.isMicEnabled?1:.6,pointerEvents:"auto"},children:b.isMicEnabled?le.jsx(MC,{size:20}):le.jsx(EC,{size:20})}),le.jsx("button",{onClick:b.onToggleVideo,style:{flex:1,height:"48px",borderRadius:"18px",display:"flex",alignItems:"center",justifyContent:"center",background:"hsl(var(--background))",color:b.isVideoEnabled?"hsl(var(--foreground))":"hsl(var(--muted-foreground))",cursor:"pointer",opacity:b.isVideoEnabled?1:.6,pointerEvents:"auto"},children:b.isVideoEnabled?le.jsx(t_,{size:20}):le.jsx(OC,{size:20})}),C&&le.jsx("button",{onClick:C,style:{flex:1,height:"48px",borderRadius:"18px",display:"flex",alignItems:"center",justifyContent:"center",background:"hsl(var(--destructive))",color:"hsl(var(--destructive-foreground))",border:"none",cursor:"pointer",pointerEvents:"auto"},children:le.jsx(Xy,{size:20})})]})]}),le.jsx(E1,{client:T.realtimeClient,children:le.jsx(P1,{client:T.chatClient,children:le.jsx(U1,{name:n,children:le.jsx(W1,{currentFields:r,onCallClick:a,onCancelClick:l,onCloseClick:f,visitorData:e,hasInviteHeader:!!h?.showInvite,showChatInput:A,onChatOpen:()=>P(!0),isConnecting:v,hasOverlay:re})})})})]})]})}function G1(){const[n,e]=U.useState(null),[r,a]=U.useState({active:!1,joined:!1,dailyRoomId:null,chatRoomId:null,sessionEndedAt:null,isReused:void 0,claimedUserName:null,claimedUserImage:null}),[l,f]=U.useState(!1),[h,y]=U.useState(null),v=U.useCallback(()=>{const L=document.getElementsByTagName("script");for(let A=0;A<L.length;A++){const P=L[A];if(P.src&&P.src.includes("embed.js")){const N=new URL(P.src).searchParams.get("token");if(N)return N}if(P.dataset.token)return P.dataset.token}return null},[]),b=U.useCallback(async L=>{let A=localStorage.getItem("service_visitor_id");A||(A=gf(),localStorage.setItem("service_visitor_id",A));let P=localStorage.getItem("current_session_id");P||(P=gf(),localStorage.setItem("current_session_id",P));const R=`chat-${A}-${P}`;try{const N=await fetch(`${nd.API_BASE}/api/visitors/initialize`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitorId:A,sessionId:P,token:L,chatRoomId:R})});if(!N.ok)throw new Error(`HTTP ${N.status}: ${N.statusText}`);const V=await N.json();return V.success?(e({visitorId:A,sessionId:P,companyId:V.companyId,token:L}),f(!0),{visitorId:A,sessionId:P,companyId:V.companyId,token:L,visitData:V}):null}catch(N){return console.error("Error initializing visitor with token:",N),null}},[]),C=U.useCallback(async L=>{if(!n)return;const A=JSON.stringify({visitorId:n.visitorId,sessionId:n.sessionId,companyId:n.companyId,...L});try{const P=await fetch(`${nd.API_BASE}/api/visitors/status`,{method:"POST",headers:{"Content-Type":"application/json"},body:A});if(!P.ok)throw new Error(`HTTP error! status: ${P.status}`);await P.json()}catch(P){console.error("Error updating visit status:",P)}},[n]),T=U.useCallback(L=>{const A=L||n;if(!A||h)return;const P=`${nd.API_BASE}/api/visitors/events?visitorId=${encodeURIComponent(A.visitorId)}`,R=new EventSource(P);R.onmessage=function(N){try{const V=JSON.parse(N.data);V.type==="visit_update"&&a(G=>{const X=V.user,x=X&&typeof X=="object"&&"name"in X?X.name||null:G.claimedUserName,$=X&&typeof X=="object"&&"image"in X?X.image||null:G.claimedUserImage;return{active:"active"in V?!!V.active:G.active,joined:"joined"in V&&typeof V.joined=="boolean"?V.joined:G.joined,dailyRoomId:"dailyRoomId"in V?V.dailyRoomId||null:G.dailyRoomId,chatRoomId:"chatRoomId"in V?V.chatRoomId||null:G.chatRoomId,sessionEndedAt:"sessionEndedAt"in V?V.sessionEndedAt||null:G.sessionEndedAt,isReused:G.isReused,claimedUserName:x,claimedUserImage:$}})}catch(V){console.error("EventSource message error:",V)}},R.onerror=function(){setTimeout(()=>{R.readyState===EventSource.CLOSED&&(y(null),T())},3e3)},y(R)},[n,h]);return U.useEffect(()=>{const L=v();if(!L||l)return;(async()=>{try{const P=await b(L);if(P){const R=P.visitData;if(R){const N=R.chatRoomId||`chat-${P.visitorId}-${P.sessionId}`;a({active:!!R.active,joined:R.joined===!0,dailyRoomId:R.dailyRoomId||null,chatRoomId:N,sessionEndedAt:R.sessionEndedAt||null,isReused:R.isReused===!0,claimedUserName:R.user?.name||null,claimedUserImage:R.user?.image||null})}else{const N=`chat-${P.visitorId}-${P.sessionId}`;a({active:!0,joined:!1,dailyRoomId:null,chatRoomId:N,sessionEndedAt:null,isReused:!1,claimedUserName:null,claimedUserImage:null})}T(P)}}catch{}})()},[v,b,T,l]),U.useEffect(()=>()=>{h&&h.close()},[h]),{visitorData:n,currentFields:r,isInitialized:l,updateVisitFields:C}}function J1({visitorData:n,currentFields:e,updateVisitFields:r}){U.useEffect(()=>{const a=()=>{const h=!!e.dailyRoomId;if(h)return;const y=!h&&e.joined;document.hidden&&e.active&&!y?r({active:!1}):!document.hidden&&!e.active&&!e.joined&&r({active:!0})},l=()=>{n&&r({endedAt:new Date().toISOString(),active:!1})},f=()=>{n&&r({endedAt:new Date().toISOString(),active:!1})};return document.addEventListener("visibilitychange",a),window.addEventListener("pagehide",l),window.addEventListener("beforeunload",f),()=>{document.removeEventListener("visibilitychange",a),window.removeEventListener("pagehide",l),window.removeEventListener("beforeunload",f)}},[n,e,r])}function x_({sessionEndedAt:n}){const e=gi();return U.useEffect(()=>{n&&e&&(console.log("Visit ended, stopping camera/mic and leaving room"),e.setLocalAudio(!1),e.setLocalVideo(!1),e.leave())},[n,e]),null}function L_(){const{visitorData:n,currentFields:e,isInitialized:r,updateVisitFields:a}=G1(),[l,f]=U.useState(null),[h,y]=U.useState(null),[v,b]=U.useState(!1),[C,T]=U.useState(null);J1({visitorData:n,currentFields:e,updateVisitFields:a});const L=()=>{const G=!!e.dailyRoomId;console.log("Call button clicked - inCall:",G,"joined:",e.joined),e.joined||(console.log("Setting joined to true"),b(!0),a({joined:!0}))},A=()=>{const G=!!e.dailyRoomId;v?(b(!1),e.joined&&a({joined:!1})):!G&&e.joined&&a({joined:!1})},P=()=>{e.dailyRoomId&&!e.joined&&a({joined:!0})};U.useEffect(()=>{e.dailyRoomId&&v&&b(!1)},[e.dailyRoomId,v]);const R=()=>{(e.dailyRoomId||e.joined)&&a({dailyRoomId:null,joined:!1})},N=()=>{if(!n)return;const G=document.querySelector('[id^="embed-widget-"]');G&&(G.style.display="none"),e.sessionEndedAt||a({endedAt:new Date().toISOString(),active:!1})};if(!r||!n||e.sessionEndedAt)return e.sessionEndedAt?le.jsx(Jy,{children:le.jsx(x_,{sessionEndedAt:e.sessionEndedAt})}):null;const V=!e.sessionEndedAt;return le.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",width:"100%",position:"relative",alignItems:"stretch"},children:[V&&le.jsx("button",{onClick:N,style:{position:"absolute",top:"-4px",right:"-4px",zIndex:1e5,padding:"6px 8px",borderRadius:"50%",background:"hsl(var(--background))",color:"hsl(var(--foreground))",border:"none",cursor:"pointer",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"auto"},children:le.jsx(RC,{size:20})}),le.jsxs(Jy,{children:[le.jsx(x_,{sessionEndedAt:e.sessionEndedAt}),le.jsx(AC,{currentFields:e,visitorData:n,onJoined:P,onAcceptCall:L,onInviteInfo:f,renderVideoFrame:y,isConnecting:v,onVideoControls:T,claimedUserName:e.claimedUserName,claimedUserImage:e.claimedUserImage}),le.jsx(H1,{chatRoomId:e.chatRoomId,visitorData:n,currentFields:e,onCallClick:L,onCancelClick:A,onCloseClick:N,inviteInfo:l,videoFrame:h,isConnecting:v,videoControls:C,onEndCall:R})]})]})}const j_=document.getElementsByTagName("script");let Fc="light";for(let n=0;n<j_.length;n++){const e=j_[n];if(e.src&&e.src.includes("embed.js")){const a=new URL(e.src).searchParams.get("theme");if(a){Fc=a;break}}if(e.dataset.theme){Fc=e.dataset.theme;break}if(e.getAttribute("theme")){Fc=e.getAttribute("theme")||"light";break}}const rp=gf(),N_=`embed-widget-${rp}`,Jr=`embed-widget-${rp}`,D_=document.createElement("style");D_.textContent=`
  /* Embed widget CSS variables - theme: ${Fc} - ID: ${rp} */
  .${Jr} {
    ${Fc==="dark"?`
    /* Dark theme colors for embed */
    --background: 202 7% 3%;
    --foreground: 202 7% 93%;
    --muted: 202 7% 12%;
    --muted-special: 202 15% 15%;
    --special: 25 95% 53%;
    --muted-foreground: 202 7% 83%;
    --primary: 202 7% 17%;
    --primary-foreground: 202 7% 93%;
    --constructive: 116 54% 50%;
    --constructive-foreground: 202 7% 93%;
    --destructive: 4 75% 25%;
    --destructive-foreground: 202 7% 93%;
    --border: 202 7% 50%;
    --ring: 202 7% 93%;
    `:`
    /* Light theme colors for embed */
    --background: 202 7% 93%;
    --foreground: 202 7% 7%;
    --muted: 202 7% 88%;
    --muted-special: 202 15% 85%;
    --special: 25 95% 53%;
    --muted-foreground: 202 7% 17%;
    --primary: 202 7% 83%;
    --primary-foreground: 202 7% 7%;
    --constructive: 116 54% 50%;
    --constructive-foreground: 202 7% 93%;
    --destructive: 4 75% 25%;
    --destructive-foreground: 202 7% 7%;
    --border: 202 7% 50%;
    --ring: 202 7% 7%;
    `}
    --radius: 0.5rem;
  }

  /* Spinner animation with unique name */
  @keyframes ${Jr}-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Aggressive CSS reset and isolation for all children */
  .${Jr} *,
  .${Jr} *::before,
  .${Jr} *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    border: 0;
    font-size: 100%;
    font: inherit;
    vertical-align: baseline;
    line-height: inherit;
    color: inherit;
    text-decoration: none;
    background: transparent;
    list-style: none;
    quotes: none;
    outline: none;
  }

  /* Completely isolated styles for embed root */
  .${Jr} {
    all: initial;
    position: fixed !important;
    bottom: 20px !important;
    right: 20px !important;
    width: 300px !important;
    max-height: 600px !important;
    display: flex !important;
    flex-direction: column !important;
    z-index: 10000 !important;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif !important;
    font-size: 14px !important;
    line-height: 1.5 !important;
    color: hsl(var(--foreground)) !important;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    -webkit-tap-highlight-color: transparent;
    user-select: text;
    -webkit-user-select: text;
    -moz-user-select: text;
    -ms-user-select: text;
  }

  /* Reset form elements */
  .${Jr} input,
  .${Jr} textarea,
  .${Jr} select {
    font-family: inherit !important;
    font-size: inherit !important;
    line-height: inherit !important;
    color: inherit !important;
    background: transparent;
    border: none;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
  }
  
  /* Buttons - don't override color to allow explicit styling */
  .${Jr} button {
    font-family: inherit !important;
    font-size: inherit !important;
    line-height: inherit !important;
    background: transparent;
    border: none;
    appearance: none;
    -webkit-appearance: none;
    -moz-appearance: none;
  }
`,document.head.appendChild(D_);let Pa=document.getElementById(N_);Pa||(Pa=document.createElement("div"),Pa.id=N_,Pa.className=Jr,document.body.appendChild(Pa)),pw.createRoot(Pa).render(le.jsx(tt.StrictMode,{children:le.jsx(L_,{})})),window.EmbedWidget=L_})();
