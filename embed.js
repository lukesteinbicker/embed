(function(){"use strict";var ls=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Sg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var uf={exports:{}},yc={},df={exports:{}},nt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kg;function Z0(){if(kg)return nt;kg=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),h=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),b=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),O=Symbol.iterator;function j(J){return J===null||typeof J!="object"?null:(J=O&&J[O]||J["@@iterator"],typeof J=="function"?J:null)}var I={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},A=Object.assign,R={};function D(J,le,g){this.props=J,this.context=le,this.refs=R,this.updater=g||I}D.prototype.isReactComponent={},D.prototype.setState=function(J,le){if(typeof J!="object"&&typeof J!="function"&&J!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,J,le,"setState")},D.prototype.forceUpdate=function(J){this.updater.enqueueForceUpdate(this,J,"forceUpdate")};function V(){}V.prototype=D.prototype;function Y(J,le,g){this.props=J,this.context=le,this.refs=R,this.updater=g||I}var ne=Y.prototype=new V;ne.constructor=Y,A(ne,D.prototype),ne.isPureReactComponent=!0;var L=Array.isArray,q=Object.prototype.hasOwnProperty,H={current:null},ae={key:!0,ref:!0,__self:!0,__source:!0};function ye(J,le,g){var M,C={},N=null,F=null;if(le!=null)for(M in le.ref!==void 0&&(F=le.ref),le.key!==void 0&&(N=""+le.key),le)q.call(le,M)&&!ae.hasOwnProperty(M)&&(C[M]=le[M]);var G=arguments.length-2;if(G===1)C.children=g;else if(1<G){for(var ie=Array(G),fe=0;fe<G;fe++)ie[fe]=arguments[fe+2];C.children=ie}if(J&&J.defaultProps)for(M in G=J.defaultProps,G)C[M]===void 0&&(C[M]=G[M]);return{$$typeof:n,type:J,key:N,ref:F,props:C,_owner:H.current}}function Ee(J,le){return{$$typeof:n,type:J.type,key:le,ref:J.ref,props:J.props,_owner:J._owner}}function Ve(J){return typeof J=="object"&&J!==null&&J.$$typeof===n}function k(J){var le={"=":"=0",":":"=2"};return"$"+J.replace(/[=:]/g,function(g){return le[g]})}var ze=/\/+/g;function Me(J,le){return typeof J=="object"&&J!==null&&J.key!=null?k(""+J.key):le.toString(36)}function K(J,le,g,M,C){var N=typeof J;(N==="undefined"||N==="boolean")&&(J=null);var F=!1;if(J===null)F=!0;else switch(N){case"string":case"number":F=!0;break;case"object":switch(J.$$typeof){case n:case e:F=!0}}if(F)return F=J,C=C(F),J=M===""?"."+Me(F,0):M,L(C)?(g="",J!=null&&(g=J.replace(ze,"$&/")+"/"),K(C,le,g,"",function(fe){return fe})):C!=null&&(Ve(C)&&(C=Ee(C,g+(!C.key||F&&F.key===C.key?"":(""+C.key).replace(ze,"$&/")+"/")+J)),le.push(C)),1;if(F=0,M=M===""?".":M+":",L(J))for(var G=0;G<J.length;G++){N=J[G];var ie=M+Me(N,G);F+=K(N,le,g,ie,C)}else if(ie=j(J),typeof ie=="function")for(J=ie.call(J),G=0;!(N=J.next()).done;)N=N.value,ie=M+Me(N,G++),F+=K(N,le,g,ie,C);else if(N==="object")throw le=String(J),Error("Objects are not valid as a React child (found: "+(le==="[object Object]"?"object with keys {"+Object.keys(J).join(", ")+"}":le)+"). If you meant to render a collection of children, use an array instead.");return F}function Ue(J,le,g){if(J==null)return J;var M=[],C=0;return K(J,M,"","",function(N){return le.call(g,N,C++)}),M}function it(J){if(J._status===-1){var le=J._result;le=le(),le.then(function(g){(J._status===0||J._status===-1)&&(J._status=1,J._result=g)},function(g){(J._status===0||J._status===-1)&&(J._status=2,J._result=g)}),J._status===-1&&(J._status=0,J._result=le)}if(J._status===1)return J._result.default;throw J._result}var be={current:null},he={transition:null},Ce={ReactCurrentDispatcher:be,ReactCurrentBatchConfig:he,ReactCurrentOwner:H};function oe(){throw Error("act(...) is not supported in production builds of React.")}return nt.Children={map:Ue,forEach:function(J,le,g){Ue(J,function(){le.apply(this,arguments)},g)},count:function(J){var le=0;return Ue(J,function(){le++}),le},toArray:function(J){return Ue(J,function(le){return le})||[]},only:function(J){if(!Ve(J))throw Error("React.Children.only expected to receive a single React element child.");return J}},nt.Component=D,nt.Fragment=r,nt.Profiler=l,nt.PureComponent=Y,nt.StrictMode=a,nt.Suspense=y,nt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Ce,nt.act=oe,nt.cloneElement=function(J,le,g){if(J==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+J+".");var M=A({},J.props),C=J.key,N=J.ref,F=J._owner;if(le!=null){if(le.ref!==void 0&&(N=le.ref,F=H.current),le.key!==void 0&&(C=""+le.key),J.type&&J.type.defaultProps)var G=J.type.defaultProps;for(ie in le)q.call(le,ie)&&!ae.hasOwnProperty(ie)&&(M[ie]=le[ie]===void 0&&G!==void 0?G[ie]:le[ie])}var ie=arguments.length-2;if(ie===1)M.children=g;else if(1<ie){G=Array(ie);for(var fe=0;fe<ie;fe++)G[fe]=arguments[fe+2];M.children=G}return{$$typeof:n,type:J.type,key:C,ref:N,props:M,_owner:F}},nt.createContext=function(J){return J={$$typeof:h,_currentValue:J,_currentValue2:J,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},J.Provider={$$typeof:f,_context:J},J.Consumer=J},nt.createElement=ye,nt.createFactory=function(J){var le=ye.bind(null,J);return le.type=J,le},nt.createRef=function(){return{current:null}},nt.forwardRef=function(J){return{$$typeof:v,render:J}},nt.isValidElement=Ve,nt.lazy=function(J){return{$$typeof:E,_payload:{_status:-1,_result:J},_init:it}},nt.memo=function(J,le){return{$$typeof:b,type:J,compare:le===void 0?null:le}},nt.startTransition=function(J){var le=he.transition;he.transition={};try{J()}finally{he.transition=le}},nt.unstable_act=oe,nt.useCallback=function(J,le){return be.current.useCallback(J,le)},nt.useContext=function(J){return be.current.useContext(J)},nt.useDebugValue=function(){},nt.useDeferredValue=function(J){return be.current.useDeferredValue(J)},nt.useEffect=function(J,le){return be.current.useEffect(J,le)},nt.useId=function(){return be.current.useId()},nt.useImperativeHandle=function(J,le,g){return be.current.useImperativeHandle(J,le,g)},nt.useInsertionEffect=function(J,le){return be.current.useInsertionEffect(J,le)},nt.useLayoutEffect=function(J,le){return be.current.useLayoutEffect(J,le)},nt.useMemo=function(J,le){return be.current.useMemo(J,le)},nt.useReducer=function(J,le,g){return be.current.useReducer(J,le,g)},nt.useRef=function(J){return be.current.useRef(J)},nt.useState=function(J){return be.current.useState(J)},nt.useSyncExternalStore=function(J,le,g){return be.current.useSyncExternalStore(J,le,g)},nt.useTransition=function(){return be.current.useTransition()},nt.version="18.3.1",nt}var Cg;function ff(){return Cg||(Cg=1,df.exports=Z0()),df.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Eg;function ew(){if(Eg)return yc;Eg=1;var n=ff(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,f={key:!0,ref:!0,__self:!0,__source:!0};function h(v,y,b){var E,O={},j=null,I=null;b!==void 0&&(j=""+b),y.key!==void 0&&(j=""+y.key),y.ref!==void 0&&(I=y.ref);for(E in y)a.call(y,E)&&!f.hasOwnProperty(E)&&(O[E]=y[E]);if(v&&v.defaultProps)for(E in y=v.defaultProps,y)O[E]===void 0&&(O[E]=y[E]);return{$$typeof:e,type:v,key:j,ref:I,props:O,_owner:l.current}}return yc.Fragment=r,yc.jsx=h,yc.jsxs=h,yc}var Mg;function tw(){return Mg||(Mg=1,uf.exports=ew()),uf.exports}var _e=tw(),z=ff();const et=Sg(z);var Wl={},hf={exports:{}},Jn={},pf={exports:{}},gf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Og;function nw(){return Og||(Og=1,(function(n){function e(he,Ce){var oe=he.length;he.push(Ce);e:for(;0<oe;){var J=oe-1>>>1,le=he[J];if(0<l(le,Ce))he[J]=Ce,he[oe]=le,oe=J;else break e}}function r(he){return he.length===0?null:he[0]}function a(he){if(he.length===0)return null;var Ce=he[0],oe=he.pop();if(oe!==Ce){he[0]=oe;e:for(var J=0,le=he.length,g=le>>>1;J<g;){var M=2*(J+1)-1,C=he[M],N=M+1,F=he[N];if(0>l(C,oe))N<le&&0>l(F,C)?(he[J]=F,he[N]=oe,J=N):(he[J]=C,he[M]=oe,J=M);else if(N<le&&0>l(F,oe))he[J]=F,he[N]=oe,J=N;else break e}}return Ce}function l(he,Ce){var oe=he.sortIndex-Ce.sortIndex;return oe!==0?oe:he.id-Ce.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;n.unstable_now=function(){return f.now()}}else{var h=Date,v=h.now();n.unstable_now=function(){return h.now()-v}}var y=[],b=[],E=1,O=null,j=3,I=!1,A=!1,R=!1,D=typeof setTimeout=="function"?setTimeout:null,V=typeof clearTimeout=="function"?clearTimeout:null,Y=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ne(he){for(var Ce=r(b);Ce!==null;){if(Ce.callback===null)a(b);else if(Ce.startTime<=he)a(b),Ce.sortIndex=Ce.expirationTime,e(y,Ce);else break;Ce=r(b)}}function L(he){if(R=!1,ne(he),!A)if(r(y)!==null)A=!0,it(q);else{var Ce=r(b);Ce!==null&&be(L,Ce.startTime-he)}}function q(he,Ce){A=!1,R&&(R=!1,V(ye),ye=-1),I=!0;var oe=j;try{for(ne(Ce),O=r(y);O!==null&&(!(O.expirationTime>Ce)||he&&!k());){var J=O.callback;if(typeof J=="function"){O.callback=null,j=O.priorityLevel;var le=J(O.expirationTime<=Ce);Ce=n.unstable_now(),typeof le=="function"?O.callback=le:O===r(y)&&a(y),ne(Ce)}else a(y);O=r(y)}if(O!==null)var g=!0;else{var M=r(b);M!==null&&be(L,M.startTime-Ce),g=!1}return g}finally{O=null,j=oe,I=!1}}var H=!1,ae=null,ye=-1,Ee=5,Ve=-1;function k(){return!(n.unstable_now()-Ve<Ee)}function ze(){if(ae!==null){var he=n.unstable_now();Ve=he;var Ce=!0;try{Ce=ae(!0,he)}finally{Ce?Me():(H=!1,ae=null)}}else H=!1}var Me;if(typeof Y=="function")Me=function(){Y(ze)};else if(typeof MessageChannel<"u"){var K=new MessageChannel,Ue=K.port2;K.port1.onmessage=ze,Me=function(){Ue.postMessage(null)}}else Me=function(){D(ze,0)};function it(he){ae=he,H||(H=!0,Me())}function be(he,Ce){ye=D(function(){he(n.unstable_now())},Ce)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(he){he.callback=null},n.unstable_continueExecution=function(){A||I||(A=!0,it(q))},n.unstable_forceFrameRate=function(he){0>he||125<he?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ee=0<he?Math.floor(1e3/he):5},n.unstable_getCurrentPriorityLevel=function(){return j},n.unstable_getFirstCallbackNode=function(){return r(y)},n.unstable_next=function(he){switch(j){case 1:case 2:case 3:var Ce=3;break;default:Ce=j}var oe=j;j=Ce;try{return he()}finally{j=oe}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(he,Ce){switch(he){case 1:case 2:case 3:case 4:case 5:break;default:he=3}var oe=j;j=he;try{return Ce()}finally{j=oe}},n.unstable_scheduleCallback=function(he,Ce,oe){var J=n.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?J+oe:J):oe=J,he){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=oe+le,he={id:E++,callback:Ce,priorityLevel:he,startTime:oe,expirationTime:le,sortIndex:-1},oe>J?(he.sortIndex=oe,e(b,he),r(y)===null&&he===r(b)&&(R?(V(ye),ye=-1):R=!0,be(L,oe-J))):(he.sortIndex=le,e(y,he),A||I||(A=!0,it(q))),he},n.unstable_shouldYield=k,n.unstable_wrapCallback=function(he){var Ce=j;return function(){var oe=j;j=Ce;try{return he.apply(this,arguments)}finally{j=oe}}}})(gf)),gf}var Tg;function rw(){return Tg||(Tg=1,pf.exports=nw()),pf.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Rg;function iw(){if(Rg)return Jn;Rg=1;var n=ff(),e=rw();function r(t){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+t,c=1;c<arguments.length;c++)i+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+t+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function f(t,i){h(t,i),h(t+"Capture",i)}function h(t,i){for(l[t]=i,t=0;t<i.length;t++)a.add(i[t])}var v=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),y=Object.prototype.hasOwnProperty,b=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,E={},O={};function j(t){return y.call(O,t)?!0:y.call(E,t)?!1:b.test(t)?O[t]=!0:(E[t]=!0,!1)}function I(t,i,c,d){if(c!==null&&c.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return d?!1:c!==null?!c.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function A(t,i,c,d){if(i===null||typeof i>"u"||I(t,i,c,d))return!0;if(d)return!1;if(c!==null)switch(c.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function R(t,i,c,d,m,w,T){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=d,this.attributeNamespace=m,this.mustUseProperty=c,this.propertyName=t,this.type=i,this.sanitizeURL=w,this.removeEmptyString=T}var D={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){D[t]=new R(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var i=t[0];D[i]=new R(i,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){D[t]=new R(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){D[t]=new R(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){D[t]=new R(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){D[t]=new R(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){D[t]=new R(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){D[t]=new R(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){D[t]=new R(t,5,!1,t.toLowerCase(),null,!1,!1)});var V=/[\-:]([a-z])/g;function Y(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var i=t.replace(V,Y);D[i]=new R(i,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var i=t.replace(V,Y);D[i]=new R(i,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var i=t.replace(V,Y);D[i]=new R(i,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){D[t]=new R(t,1,!1,t.toLowerCase(),null,!1,!1)}),D.xlinkHref=new R("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){D[t]=new R(t,1,!1,t.toLowerCase(),null,!0,!0)});function ne(t,i,c,d){var m=D.hasOwnProperty(i)?D[i]:null;(m!==null?m.type!==0:d||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(A(i,c,m,d)&&(c=null),d||m===null?j(i)&&(c===null?t.removeAttribute(i):t.setAttribute(i,""+c)):m.mustUseProperty?t[m.propertyName]=c===null?m.type===3?!1:"":c:(i=m.attributeName,d=m.attributeNamespace,c===null?t.removeAttribute(i):(m=m.type,c=m===3||m===4&&c===!0?"":""+c,d?t.setAttributeNS(d,i,c):t.setAttribute(i,c))))}var L=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,q=Symbol.for("react.element"),H=Symbol.for("react.portal"),ae=Symbol.for("react.fragment"),ye=Symbol.for("react.strict_mode"),Ee=Symbol.for("react.profiler"),Ve=Symbol.for("react.provider"),k=Symbol.for("react.context"),ze=Symbol.for("react.forward_ref"),Me=Symbol.for("react.suspense"),K=Symbol.for("react.suspense_list"),Ue=Symbol.for("react.memo"),it=Symbol.for("react.lazy"),be=Symbol.for("react.offscreen"),he=Symbol.iterator;function Ce(t){return t===null||typeof t!="object"?null:(t=he&&t[he]||t["@@iterator"],typeof t=="function"?t:null)}var oe=Object.assign,J;function le(t){if(J===void 0)try{throw Error()}catch(c){var i=c.stack.trim().match(/\n( *(at )?)/);J=i&&i[1]||""}return`
`+J+t}var g=!1;function M(t,i){if(!t||g)return"";g=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(re){var d=re}Reflect.construct(t,[],i)}else{try{i.call()}catch(re){d=re}t.call(i.prototype)}else{try{throw Error()}catch(re){d=re}t()}}catch(re){if(re&&d&&typeof re.stack=="string"){for(var m=re.stack.split(`
`),w=d.stack.split(`
`),T=m.length-1,B=w.length-1;1<=T&&0<=B&&m[T]!==w[B];)B--;for(;1<=T&&0<=B;T--,B--)if(m[T]!==w[B]){if(T!==1||B!==1)do if(T--,B--,0>B||m[T]!==w[B]){var $=`
`+m[T].replace(" at new "," at ");return t.displayName&&$.includes("<anonymous>")&&($=$.replace("<anonymous>",t.displayName)),$}while(1<=T&&0<=B);break}}}finally{g=!1,Error.prepareStackTrace=c}return(t=t?t.displayName||t.name:"")?le(t):""}function C(t){switch(t.tag){case 5:return le(t.type);case 16:return le("Lazy");case 13:return le("Suspense");case 19:return le("SuspenseList");case 0:case 2:case 15:return t=M(t.type,!1),t;case 11:return t=M(t.type.render,!1),t;case 1:return t=M(t.type,!0),t;default:return""}}function N(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ae:return"Fragment";case H:return"Portal";case Ee:return"Profiler";case ye:return"StrictMode";case Me:return"Suspense";case K:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case k:return(t.displayName||"Context")+".Consumer";case Ve:return(t._context.displayName||"Context")+".Provider";case ze:var i=t.render;return t=t.displayName,t||(t=i.displayName||i.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case Ue:return i=t.displayName||null,i!==null?i:N(t.type)||"Memo";case it:i=t._payload,t=t._init;try{return N(t(i))}catch{}}return null}function F(t){var i=t.type;switch(t.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=i.render,t=t.displayName||t.name||"",i.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return N(i);case 8:return i===ye?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function G(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function ie(t){var i=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function fe(t){var i=ie(t)?"checked":"value",c=Object.getOwnPropertyDescriptor(t.constructor.prototype,i),d=""+t[i];if(!t.hasOwnProperty(i)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var m=c.get,w=c.set;return Object.defineProperty(t,i,{configurable:!0,get:function(){return m.call(this)},set:function(T){d=""+T,w.call(this,T)}}),Object.defineProperty(t,i,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(T){d=""+T},stopTracking:function(){t._valueTracker=null,delete t[i]}}}}function Oe(t){t._valueTracker||(t._valueTracker=fe(t))}function $e(t){if(!t)return!1;var i=t._valueTracker;if(!i)return!0;var c=i.getValue(),d="";return t&&(d=ie(t)?t.checked?"true":"false":t.value),t=d,t!==c?(i.setValue(t),!0):!1}function Xe(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Vt(t,i){var c=i.checked;return oe({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??t._wrapperState.initialChecked})}function bn(t,i){var c=i.defaultValue==null?"":i.defaultValue,d=i.checked!=null?i.checked:i.defaultChecked;c=G(i.value!=null?i.value:c),t._wrapperState={initialChecked:d,initialValue:c,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function Ln(t,i){i=i.checked,i!=null&&ne(t,"checked",i,!1)}function mt(t,i){Ln(t,i);var c=G(i.value),d=i.type;if(c!=null)d==="number"?(c===0&&t.value===""||t.value!=c)&&(t.value=""+c):t.value!==""+c&&(t.value=""+c);else if(d==="submit"||d==="reset"){t.removeAttribute("value");return}i.hasOwnProperty("value")?en(t,i.type,c):i.hasOwnProperty("defaultValue")&&en(t,i.type,G(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(t.defaultChecked=!!i.defaultChecked)}function At(t,i,c){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var d=i.type;if(!(d!=="submit"&&d!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+t._wrapperState.initialValue,c||i===t.value||(t.value=i),t.defaultValue=i}c=t.name,c!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,c!==""&&(t.name=c)}function en(t,i,c){(i!=="number"||Xe(t.ownerDocument)!==t)&&(c==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+c&&(t.defaultValue=""+c))}var zt=Array.isArray;function Ze(t,i,c,d){if(t=t.options,i){i={};for(var m=0;m<c.length;m++)i["$"+c[m]]=!0;for(c=0;c<t.length;c++)m=i.hasOwnProperty("$"+t[c].value),t[c].selected!==m&&(t[c].selected=m),m&&d&&(t[c].defaultSelected=!0)}else{for(c=""+G(c),i=null,m=0;m<t.length;m++){if(t[m].value===c){t[m].selected=!0,d&&(t[m].defaultSelected=!0);return}i!==null||t[m].disabled||(i=t[m])}i!==null&&(i.selected=!0)}}function jn(t,i){if(i.dangerouslySetInnerHTML!=null)throw Error(r(91));return oe({},i,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Qn(t,i){var c=i.value;if(c==null){if(c=i.children,i=i.defaultValue,c!=null){if(i!=null)throw Error(r(92));if(zt(c)){if(1<c.length)throw Error(r(93));c=c[0]}i=c}i==null&&(i=""),c=i}t._wrapperState={initialValue:G(c)}}function Jt(t,i){var c=G(i.value),d=G(i.defaultValue);c!=null&&(c=""+c,c!==t.value&&(t.value=c),i.defaultValue==null&&t.defaultValue!==c&&(t.defaultValue=c)),d!=null&&(t.defaultValue=""+d)}function Mr(t){var i=t.textContent;i===t._wrapperState.initialValue&&i!==""&&i!==null&&(t.value=i)}function qi(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Nt(t,i){return t==null||t==="http://www.w3.org/1999/xhtml"?qi(i):t==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Dt,cn=(function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,c,d,m){MSApp.execUnsafeLocalFunction(function(){return t(i,c,d,m)})}:t})(function(t,i){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=i;else{for(Dt=Dt||document.createElement("div"),Dt.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Dt.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;i.firstChild;)t.appendChild(i.firstChild)}});function Hr(t,i){if(i){var c=t.firstChild;if(c&&c===t.lastChild&&c.nodeType===3){c.nodeValue=i;return}}t.textContent=i}var gi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ia=["Webkit","ms","Moz","O"];Object.keys(gi).forEach(function(t){Ia.forEach(function(i){i=i+t.charAt(0).toUpperCase()+t.substring(1),gi[i]=gi[t]})});function Lo(t,i,c){return i==null||typeof i=="boolean"||i===""?"":c||typeof i!="number"||i===0||gi.hasOwnProperty(t)&&gi[t]?(""+i).trim():i+"px"}function Wi(t,i){t=t.style;for(var c in i)if(i.hasOwnProperty(c)){var d=c.indexOf("--")===0,m=Lo(c,i[c],d);c==="float"&&(c="cssFloat"),d?t.setProperty(c,m):t[c]=m}}var jo=oe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Ss(t,i){if(i){if(jo[t]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(r(137,t));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(r(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(r(61))}if(i.style!=null&&typeof i.style!="object")throw Error(r(62))}}function mi(t,i){if(t.indexOf("-")===-1)return typeof i.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Kn=null;function vi(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Or=null,bt=null,Nn=null;function No(t){if(t=Ai(t)){if(typeof Or!="function")throw Error(r(280));var i=t.stateNode;i&&(i=ec(i),Or(t.stateNode,t.type,i))}}function xa(t){bt?Nn?Nn.push(t):Nn=[t]:bt=t}function Sn(){if(bt){var t=bt,i=Nn;if(Nn=bt=null,No(t),i)for(t=0;t<i.length;t++)No(i[t])}}function La(t,i){return t(i)}function ja(){}var Hi=!1;function ks(t,i,c){if(Hi)return t(i,c);Hi=!0;try{return La(t,i,c)}finally{Hi=!1,(bt!==null||Nn!==null)&&(ja(),Sn())}}function kn(t,i){var c=t.stateNode;if(c===null)return null;var d=ec(c);if(d===null)return null;c=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(t=t.type,d=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!d;break e;default:t=!1}if(t)return null;if(c&&typeof c!="function")throw Error(r(231,i,typeof c));return c}var Cs=!1;if(v)try{var yi={};Object.defineProperty(yi,"passive",{get:function(){Cs=!0}}),window.addEventListener("test",yi,yi),window.removeEventListener("test",yi,yi)}catch{Cs=!1}function Fc(t,i,c,d,m,w,T,B,$){var re=Array.prototype.slice.call(arguments,3);try{i.apply(c,re)}catch(me){this.onError(me)}}var _i=!1,Es=null,tn=!1,Do=null,Vc={onError:function(t){_i=!0,Es=t}};function zc(t,i,c,d,m,w,T,B,$){_i=!1,Es=null,Fc.apply(Vc,arguments)}function Ms(t,i,c,d,m,w,T,B,$){if(zc.apply(this,arguments),_i){if(_i){var re=Es;_i=!1,Es=null}else throw Error(r(198));tn||(tn=!0,Do=re)}}function Tr(t){var i=t,c=t;if(t.alternate)for(;i.return;)i=i.return;else{t=i;do i=t,(i.flags&4098)!==0&&(c=i.return),t=i.return;while(t)}return i.tag===3?c:null}function Yn(t){if(t.tag===13){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function Na(t){if(Tr(t)!==t)throw Error(r(188))}function $c(t){var i=t.alternate;if(!i){if(i=Tr(t),i===null)throw Error(r(188));return i!==t?null:t}for(var c=t,d=i;;){var m=c.return;if(m===null)break;var w=m.alternate;if(w===null){if(d=m.return,d!==null){c=d;continue}break}if(m.child===w.child){for(w=m.child;w;){if(w===c)return Na(m),t;if(w===d)return Na(m),i;w=w.sibling}throw Error(r(188))}if(c.return!==d.return)c=m,d=w;else{for(var T=!1,B=m.child;B;){if(B===c){T=!0,c=m,d=w;break}if(B===d){T=!0,d=m,c=w;break}B=B.sibling}if(!T){for(B=w.child;B;){if(B===c){T=!0,c=w,d=m;break}if(B===d){T=!0,d=w,c=m;break}B=B.sibling}if(!T)throw Error(r(189))}}if(c.alternate!==d)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?t:i}function qe(t){return t=$c(t),t!==null?Da(t):null}function Da(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var i=Da(t);if(i!==null)return i;t=t.sibling}return null}var Ua=e.unstable_scheduleCallback,hr=e.unstable_cancelCallback,Ba=e.unstable_shouldYield,Ot=e.unstable_requestPaint,Et=e.unstable_now,qc=e.unstable_getCurrentPriorityLevel,wi=e.unstable_ImmediatePriority,Os=e.unstable_UserBlockingPriority,Gi=e.unstable_NormalPriority,Ts=e.unstable_LowPriority,Uo=e.unstable_IdlePriority,bi=null,Dn=null;function Fa(t){if(Dn&&typeof Dn.onCommitFiberRoot=="function")try{Dn.onCommitFiberRoot(bi,t,void 0,(t.current.flags&128)===128)}catch{}}var Un=Math.clz32?Math.clz32:Hc,Va=Math.log,Wc=Math.LN2;function Hc(t){return t>>>=0,t===0?32:31-(Va(t)/Wc|0)|0}var Si=64,Rs=4194304;function ln(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function ki(t,i){var c=t.pendingLanes;if(c===0)return 0;var d=0,m=t.suspendedLanes,w=t.pingedLanes,T=c&268435455;if(T!==0){var B=T&~m;B!==0?d=ln(B):(w&=T,w!==0&&(d=ln(w)))}else T=c&~m,T!==0?d=ln(T):w!==0&&(d=ln(w));if(d===0)return 0;if(i!==0&&i!==d&&(i&m)===0&&(m=d&-d,w=i&-i,m>=w||m===16&&(w&4194240)!==0))return i;if((d&4)!==0&&(d|=c&16),i=t.entangledLanes,i!==0)for(t=t.entanglements,i&=d;0<i;)c=31-Un(i),m=1<<c,d|=t[c],i&=~m;return d}function Ci(t,i){switch(t){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Gc(t,i){for(var c=t.suspendedLanes,d=t.pingedLanes,m=t.expirationTimes,w=t.pendingLanes;0<w;){var T=31-Un(w),B=1<<T,$=m[T];$===-1?((B&c)===0||(B&d)!==0)&&(m[T]=Ci(B,i)):$<=i&&(t.expiredLanes|=B),w&=~B}}function Bo(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function As(){var t=Si;return Si<<=1,(Si&4194240)===0&&(Si=64),t}function Ps(t){for(var i=[],c=0;31>c;c++)i.push(t);return i}function Gr(t,i,c){t.pendingLanes|=i,i!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,i=31-Un(i),t[i]=c}function Jc(t,i){var c=t.pendingLanes&~i;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=i,t.mutableReadLanes&=i,t.entangledLanes&=i,i=t.entanglements;var d=t.eventTimes;for(t=t.expirationTimes;0<c;){var m=31-Un(c),w=1<<m;i[m]=0,d[m]=-1,t[m]=-1,c&=~w}}function St(t,i){var c=t.entangledLanes|=i;for(t=t.entanglements;c;){var d=31-Un(c),m=1<<d;m&i|t[d]&i&&(t[d]|=i),c&=~m}}var we=0;function Is(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var Tt,Fo,Vo,za,zo,$o=!1,Ji=[],Bn=null,Qt=null,Xn=null,Jr=new Map,Qr=new Map,Fn=[],Qi="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ki(t,i){switch(t){case"focusin":case"focusout":Bn=null;break;case"dragenter":case"dragleave":Qt=null;break;case"mouseover":case"mouseout":Xn=null;break;case"pointerover":case"pointerout":Jr.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Qr.delete(i.pointerId)}}function Zn(t,i,c,d,m,w){return t===null||t.nativeEvent!==w?(t={blockedOn:i,domEventName:c,eventSystemFlags:d,nativeEvent:w,targetContainers:[m]},i!==null&&(i=Ai(i),i!==null&&Fo(i)),t):(t.eventSystemFlags|=d,i=t.targetContainers,m!==null&&i.indexOf(m)===-1&&i.push(m),t)}function Kr(t,i,c,d,m){switch(i){case"focusin":return Bn=Zn(Bn,t,i,c,d,m),!0;case"dragenter":return Qt=Zn(Qt,t,i,c,d,m),!0;case"mouseover":return Xn=Zn(Xn,t,i,c,d,m),!0;case"pointerover":var w=m.pointerId;return Jr.set(w,Zn(Jr.get(w)||null,t,i,c,d,m)),!0;case"gotpointercapture":return w=m.pointerId,Qr.set(w,Zn(Qr.get(w)||null,t,i,c,d,m)),!0}return!1}function qo(t){var i=nn(t.target);if(i!==null){var c=Tr(i);if(c!==null){if(i=c.tag,i===13){if(i=Yn(c),i!==null){t.blockedOn=i,zo(t.priority,function(){Vo(c)});return}}else if(i===3&&c.stateNode.current.memoizedState.isDehydrated){t.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Rr(t){if(t.blockedOn!==null)return!1;for(var i=t.targetContainers;0<i.length;){var c=Vn(t.domEventName,t.eventSystemFlags,i[0],t.nativeEvent);if(c===null){c=t.nativeEvent;var d=new c.constructor(c.type,c);Kn=d,c.target.dispatchEvent(d),Kn=null}else return i=Ai(c),i!==null&&Fo(i),t.blockedOn=c,!1;i.shift()}return!0}function $a(t,i,c){Rr(t)&&c.delete(i)}function Ar(){$o=!1,Bn!==null&&Rr(Bn)&&(Bn=null),Qt!==null&&Rr(Qt)&&(Qt=null),Xn!==null&&Rr(Xn)&&(Xn=null),Jr.forEach($a),Qr.forEach($a)}function Ei(t,i){t.blockedOn===i&&(t.blockedOn=null,$o||($o=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Ar)))}function Yi(t){function i(m){return Ei(m,t)}if(0<Ji.length){Ei(Ji[0],t);for(var c=1;c<Ji.length;c++){var d=Ji[c];d.blockedOn===t&&(d.blockedOn=null)}}for(Bn!==null&&Ei(Bn,t),Qt!==null&&Ei(Qt,t),Xn!==null&&Ei(Xn,t),Jr.forEach(i),Qr.forEach(i),c=0;c<Fn.length;c++)d=Fn[c],d.blockedOn===t&&(d.blockedOn=null);for(;0<Fn.length&&(c=Fn[0],c.blockedOn===null);)qo(c),c.blockedOn===null&&Fn.shift()}var x=L.ReactCurrentBatchConfig,te=!0;function se(t,i,c,d){var m=we,w=x.transition;x.transition=null;try{we=1,Pt(t,i,c,d)}finally{we=m,x.transition=w}}function xe(t,i,c,d){var m=we,w=x.transition;x.transition=null;try{we=4,Pt(t,i,c,d)}finally{we=m,x.transition=w}}function Pt(t,i,c,d){if(te){var m=Vn(t,i,c,d);if(m===null)vl(t,i,d,Ut,c),Ki(t,d);else if(Kr(m,t,i,c,d))d.stopPropagation();else if(Ki(t,d),i&4&&-1<Qi.indexOf(t)){for(;m!==null;){var w=Ai(m);if(w!==null&&Tt(w),w=Vn(t,i,c,d),w===null&&vl(t,i,d,Ut,c),w===m)break;m=w}m!==null&&d.stopPropagation()}else vl(t,i,d,null,c)}}var Ut=null;function Vn(t,i,c,d){if(Ut=null,t=vi(d),t=nn(t),t!==null)if(i=Tr(t),i===null)t=null;else if(c=i.tag,c===13){if(t=Yn(i),t!==null)return t;t=null}else if(c===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;t=null}else i!==t&&(t=null);return Ut=t,null}function $t(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(qc()){case wi:return 1;case Os:return 4;case Gi:case Ts:return 16;case Uo:return 536870912;default:return 16}default:return 16}}var pr=null,Bt=null,Mi=null;function Wo(){if(Mi)return Mi;var t,i=Bt,c=i.length,d,m="value"in pr?pr.value:pr.textContent,w=m.length;for(t=0;t<c&&i[t]===m[t];t++);var T=c-t;for(d=1;d<=T&&i[c-d]===m[w-d];d++);return Mi=m.slice(t,1<d?1-d:void 0)}function Pr(t){var i=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&i===13&&(t=13)):t=i,t===10&&(t=13),32<=t||t===13?t:0}function Oi(){return!0}function Xi(){return!1}function zn(t){function i(c,d,m,w,T){this._reactName=c,this._targetInst=m,this.type=d,this.nativeEvent=w,this.target=T,this.currentTarget=null;for(var B in t)t.hasOwnProperty(B)&&(c=t[B],this[B]=c?c(w):w[B]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Oi:Xi,this.isPropagationStopped=Xi,this}return oe(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Oi)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Oi)},persist:function(){},isPersistent:Oi}),i}var xs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Qc=zn(xs),Ls=oe({},xs,{view:0,detail:0}),id=zn(Ls),Kc,Yc,js,Ho=oe({},Ls,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Zi,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==js&&(js&&t.type==="mousemove"?(Kc=t.screenX-js.screenX,Yc=t.screenY-js.screenY):Yc=Kc=0,js=t),Kc)},movementY:function(t){return"movementY"in t?t.movementY:Yc}}),Ns=zn(Ho),Ti=oe({},Ho,{dataTransfer:0}),rp=zn(Ti),ip=oe({},Ls,{relatedTarget:0}),qa=zn(ip),sp=oe({},xs,{animationName:0,elapsedTime:0,pseudoElement:0}),op=zn(sp),sd=oe({},xs,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),ap=zn(sd),cp=oe({},xs,{data:0}),od=zn(cp),ad={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},lp={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Xc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function cd(t){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(t):(t=Xc[t])?!!i[t]:!1}function Zi(){return cd}var Ri=oe({},Ls,{key:function(t){if(t.key){var i=ad[t.key]||t.key;if(i!=="Unidentified")return i}return t.type==="keypress"?(t=Pr(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?lp[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Zi,charCode:function(t){return t.type==="keypress"?Pr(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Pr(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),up=zn(Ri),dp=oe({},Ho,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ld=zn(dp),fp=oe({},Ls,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Zi}),hp=zn(fp),pp=oe({},xs,{propertyName:0,elapsedTime:0,pseudoElement:0}),ud=zn(pp),gp=oe({},Ho,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),dd=zn(gp),mp=[9,13,27,32],Zc=v&&"CompositionEvent"in window,Ds=null;v&&"documentMode"in document&&(Ds=document.documentMode);var fd=v&&"TextEvent"in window&&!Ds,el=v&&(!Zc||Ds&&8<Ds&&11>=Ds),tl=" ",nl=!1;function hd(t,i){switch(t){case"keyup":return mp.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function pd(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Us=!1;function gd(t,i){switch(t){case"compositionend":return pd(i);case"keypress":return i.which!==32?null:(nl=!0,tl);case"textInput":return t=i.data,t===tl&&nl?null:t;default:return null}}function Bs(t,i){if(Us)return t==="compositionend"||!Zc&&hd(t,i)?(t=Wo(),Mi=Bt=pr=null,Us=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return el&&i.locale!=="ko"?null:i.data;default:return null}}var Go={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function rl(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i==="input"?!!Go[t.type]:i==="textarea"}function il(t,i,c,d){xa(d),i=qs(i,"onChange"),0<i.length&&(c=new Qc("onChange","change",null,c,d),t.push({event:c,listeners:i}))}var Fs=null,Vs=null;function vp(t){gl(t,0)}function zs(t){var i=Js(t);if($e(i))return t}function yp(t,i){if(t==="change")return i}var Jo=!1;if(v){var sl;if(v){var Qo="oninput"in document;if(!Qo){var ol=document.createElement("div");ol.setAttribute("oninput","return;"),Qo=typeof ol.oninput=="function"}sl=Qo}else sl=!1;Jo=sl&&(!document.documentMode||9<document.documentMode)}function Cn(){Fs&&(Fs.detachEvent("onpropertychange",Wa),Vs=Fs=null)}function Wa(t){if(t.propertyName==="value"&&zs(Vs)){var i=[];il(i,Vs,t,vi(t)),ks(vp,i)}}function al(t,i,c){t==="focusin"?(Cn(),Fs=i,Vs=c,Fs.attachEvent("onpropertychange",Wa)):t==="focusout"&&Cn()}function _p(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return zs(Vs)}function wp(t,i){if(t==="click")return zs(i)}function cl(t,i){if(t==="input"||t==="change")return zs(i)}function md(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var gr=typeof Object.is=="function"?Object.is:md;function Ko(t,i){if(gr(t,i))return!0;if(typeof t!="object"||t===null||typeof i!="object"||i===null)return!1;var c=Object.keys(t),d=Object.keys(i);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var m=c[d];if(!y.call(i,m)||!gr(t[m],i[m]))return!1}return!0}function ll(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function $s(t,i){var c=ll(t);t=0;for(var d;c;){if(c.nodeType===3){if(d=t+c.textContent.length,t<=i&&d>=i)return{node:c,offset:i-t};t=d}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=ll(c)}}function vd(t,i){return t&&i?t===i?!0:t&&t.nodeType===3?!1:i&&i.nodeType===3?vd(t,i.parentNode):"contains"in t?t.contains(i):t.compareDocumentPosition?!!(t.compareDocumentPosition(i)&16):!1:!1}function ul(){for(var t=window,i=Xe();i instanceof t.HTMLIFrameElement;){try{var c=typeof i.contentWindow.location.href=="string"}catch{c=!1}if(c)t=i.contentWindow;else break;i=Xe(t.document)}return i}function Yr(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i&&(i==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||i==="textarea"||t.contentEditable==="true")}function dl(t){var i=ul(),c=t.focusedElem,d=t.selectionRange;if(i!==c&&c&&c.ownerDocument&&vd(c.ownerDocument.documentElement,c)){if(d!==null&&Yr(c)){if(i=d.start,t=d.end,t===void 0&&(t=i),"selectionStart"in c)c.selectionStart=i,c.selectionEnd=Math.min(t,c.value.length);else if(t=(i=c.ownerDocument||document)&&i.defaultView||window,t.getSelection){t=t.getSelection();var m=c.textContent.length,w=Math.min(d.start,m);d=d.end===void 0?w:Math.min(d.end,m),!t.extend&&w>d&&(m=d,d=w,w=m),m=$s(c,w);var T=$s(c,d);m&&T&&(t.rangeCount!==1||t.anchorNode!==m.node||t.anchorOffset!==m.offset||t.focusNode!==T.node||t.focusOffset!==T.offset)&&(i=i.createRange(),i.setStart(m.node,m.offset),t.removeAllRanges(),w>d?(t.addRange(i),t.extend(T.node,T.offset)):(i.setEnd(T.node,T.offset),t.addRange(i)))}}for(i=[],t=c;t=t.parentNode;)t.nodeType===1&&i.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<i.length;c++)t=i[c],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var bp=v&&"documentMode"in document&&11>=document.documentMode,es=null,Ha=null,Yo=null,fl=!1;function yd(t,i,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;fl||es==null||es!==Xe(d)||(d=es,"selectionStart"in d&&Yr(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Yo&&Ko(Yo,d)||(Yo=d,d=qs(Ha,"onSelect"),0<d.length&&(i=new Qc("onSelect","select",null,i,c),t.push({event:i,listeners:d}),i.target=es)))}function ts(t,i){var c={};return c[t.toLowerCase()]=i.toLowerCase(),c["Webkit"+t]="webkit"+i,c["Moz"+t]="moz"+i,c}var $n={animationend:ts("Animation","AnimationEnd"),animationiteration:ts("Animation","AnimationIteration"),animationstart:ts("Animation","AnimationStart"),transitionend:ts("Transition","TransitionEnd")},hl={},_d={};v&&(_d=document.createElement("div").style,"AnimationEvent"in window||(delete $n.animationend.animation,delete $n.animationiteration.animation,delete $n.animationstart.animation),"TransitionEvent"in window||delete $n.transitionend.transition);function Ir(t){if(hl[t])return hl[t];if(!$n[t])return t;var i=$n[t],c;for(c in i)if(i.hasOwnProperty(c)&&c in _d)return hl[t]=i[c];return t}var wd=Ir("animationend"),bd=Ir("animationiteration"),Sd=Ir("animationstart"),ns=Ir("transitionend"),un=new Map,kd="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xr(t,i){un.set(t,i),f(i,[t])}for(var rs=0;rs<kd.length;rs++){var Ga=kd[rs],pl=Ga.toLowerCase(),Sp=Ga[0].toUpperCase()+Ga.slice(1);xr(pl,"on"+Sp)}xr(wd,"onAnimationEnd"),xr(bd,"onAnimationIteration"),xr(Sd,"onAnimationStart"),xr("dblclick","onDoubleClick"),xr("focusin","onFocus"),xr("focusout","onBlur"),xr(ns,"onTransitionEnd"),h("onMouseEnter",["mouseout","mouseover"]),h("onMouseLeave",["mouseout","mouseover"]),h("onPointerEnter",["pointerout","pointerover"]),h("onPointerLeave",["pointerout","pointerover"]),f("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),f("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),f("onBeforeInput",["compositionend","keypress","textInput","paste"]),f("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),f("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),f("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var is="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),kp=new Set("cancel close invalid load scroll toggle".split(" ").concat(is));function Cd(t,i,c){var d=t.type||"unknown-event";t.currentTarget=c,Ms(d,i,void 0,t),t.currentTarget=null}function gl(t,i){i=(i&4)!==0;for(var c=0;c<t.length;c++){var d=t[c],m=d.event;d=d.listeners;e:{var w=void 0;if(i)for(var T=d.length-1;0<=T;T--){var B=d[T],$=B.instance,re=B.currentTarget;if(B=B.listener,$!==w&&m.isPropagationStopped())break e;Cd(m,B,re),w=$}else for(T=0;T<d.length;T++){if(B=d[T],$=B.instance,re=B.currentTarget,B=B.listener,$!==w&&m.isPropagationStopped())break e;Cd(m,B,re),w=$}}}if(tn)throw t=Do,tn=!1,Do=null,t}function kt(t,i){var c=i[Gs];c===void 0&&(c=i[Gs]=new Set);var d=t+"__bubble";c.has(d)||(Ed(i,t,2,!1),c.add(d))}function ml(t,i,c){var d=0;i&&(d|=4),Ed(c,t,d,i)}var Xo="_reactListening"+Math.random().toString(36).slice(2);function Zo(t){if(!t[Xo]){t[Xo]=!0,a.forEach(function(c){c!=="selectionchange"&&(kp.has(c)||ml(c,!1,t),ml(c,!0,t))});var i=t.nodeType===9?t:t.ownerDocument;i===null||i[Xo]||(i[Xo]=!0,ml("selectionchange",!1,i))}}function Ed(t,i,c,d){switch($t(i)){case 1:var m=se;break;case 4:m=xe;break;default:m=Pt}c=m.bind(null,i,c,t),m=void 0,!Cs||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(m=!0),d?m!==void 0?t.addEventListener(i,c,{capture:!0,passive:m}):t.addEventListener(i,c,!0):m!==void 0?t.addEventListener(i,c,{passive:m}):t.addEventListener(i,c,!1)}function vl(t,i,c,d,m){var w=d;if((i&1)===0&&(i&2)===0&&d!==null)e:for(;;){if(d===null)return;var T=d.tag;if(T===3||T===4){var B=d.stateNode.containerInfo;if(B===m||B.nodeType===8&&B.parentNode===m)break;if(T===4)for(T=d.return;T!==null;){var $=T.tag;if(($===3||$===4)&&($=T.stateNode.containerInfo,$===m||$.nodeType===8&&$.parentNode===m))return;T=T.return}for(;B!==null;){if(T=nn(B),T===null)return;if($=T.tag,$===5||$===6){d=w=T;continue e}B=B.parentNode}}d=d.return}ks(function(){var re=w,me=vi(c),ve=[];e:{var pe=un.get(t);if(pe!==void 0){var Ae=Qc,Ie=t;switch(t){case"keypress":if(Pr(c)===0)break e;case"keydown":case"keyup":Ae=up;break;case"focusin":Ie="focus",Ae=qa;break;case"focusout":Ie="blur",Ae=qa;break;case"beforeblur":case"afterblur":Ae=qa;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ae=Ns;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ae=rp;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ae=hp;break;case wd:case bd:case Sd:Ae=op;break;case ns:Ae=ud;break;case"scroll":Ae=id;break;case"wheel":Ae=dd;break;case"copy":case"cut":case"paste":Ae=ap;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ae=ld}var Le=(i&4)!==0,Ft=!Le&&t==="scroll",Z=Le?pe!==null?pe+"Capture":null:pe;Le=[];for(var W=re,ee;W!==null;){ee=W;var ke=ee.stateNode;if(ee.tag===5&&ke!==null&&(ee=ke,Z!==null&&(ke=kn(W,Z),ke!=null&&Le.push(ea(W,ke,ee)))),Ft)break;W=W.return}0<Le.length&&(pe=new Ae(pe,Ie,null,c,me),ve.push({event:pe,listeners:Le}))}}if((i&7)===0){e:{if(pe=t==="mouseover"||t==="pointerover",Ae=t==="mouseout"||t==="pointerout",pe&&c!==Kn&&(Ie=c.relatedTarget||c.fromElement)&&(nn(Ie)||Ie[mr]))break e;if((Ae||pe)&&(pe=me.window===me?me:(pe=me.ownerDocument)?pe.defaultView||pe.parentWindow:window,Ae?(Ie=c.relatedTarget||c.toElement,Ae=re,Ie=Ie?nn(Ie):null,Ie!==null&&(Ft=Tr(Ie),Ie!==Ft||Ie.tag!==5&&Ie.tag!==6)&&(Ie=null)):(Ae=null,Ie=re),Ae!==Ie)){if(Le=Ns,ke="onMouseLeave",Z="onMouseEnter",W="mouse",(t==="pointerout"||t==="pointerover")&&(Le=ld,ke="onPointerLeave",Z="onPointerEnter",W="pointer"),Ft=Ae==null?pe:Js(Ae),ee=Ie==null?pe:Js(Ie),pe=new Le(ke,W+"leave",Ae,c,me),pe.target=Ft,pe.relatedTarget=ee,ke=null,nn(me)===re&&(Le=new Le(Z,W+"enter",Ie,c,me),Le.target=ee,Le.relatedTarget=Ft,ke=Le),Ft=ke,Ae&&Ie)t:{for(Le=Ae,Z=Ie,W=0,ee=Le;ee;ee=Ws(ee))W++;for(ee=0,ke=Z;ke;ke=Ws(ke))ee++;for(;0<W-ee;)Le=Ws(Le),W--;for(;0<ee-W;)Z=Ws(Z),ee--;for(;W--;){if(Le===Z||Z!==null&&Le===Z.alternate)break t;Le=Ws(Le),Z=Ws(Z)}Le=null}else Le=null;Ae!==null&&Ja(ve,pe,Ae,Le,!1),Ie!==null&&Ft!==null&&Ja(ve,Ft,Ie,Le,!0)}}e:{if(pe=re?Js(re):window,Ae=pe.nodeName&&pe.nodeName.toLowerCase(),Ae==="select"||Ae==="input"&&pe.type==="file")var je=yp;else if(rl(pe))if(Jo)je=cl;else{je=_p;var Be=al}else(Ae=pe.nodeName)&&Ae.toLowerCase()==="input"&&(pe.type==="checkbox"||pe.type==="radio")&&(je=wp);if(je&&(je=je(t,re))){il(ve,je,c,me);break e}Be&&Be(t,pe,re),t==="focusout"&&(Be=pe._wrapperState)&&Be.controlled&&pe.type==="number"&&en(pe,"number",pe.value)}switch(Be=re?Js(re):window,t){case"focusin":(rl(Be)||Be.contentEditable==="true")&&(es=Be,Ha=re,Yo=null);break;case"focusout":Yo=Ha=es=null;break;case"mousedown":fl=!0;break;case"contextmenu":case"mouseup":case"dragend":fl=!1,yd(ve,c,me);break;case"selectionchange":if(bp)break;case"keydown":case"keyup":yd(ve,c,me)}var Fe;if(Zc)e:{switch(t){case"compositionstart":var Je="onCompositionStart";break e;case"compositionend":Je="onCompositionEnd";break e;case"compositionupdate":Je="onCompositionUpdate";break e}Je=void 0}else Us?hd(t,c)&&(Je="onCompositionEnd"):t==="keydown"&&c.keyCode===229&&(Je="onCompositionStart");Je&&(el&&c.locale!=="ko"&&(Us||Je!=="onCompositionStart"?Je==="onCompositionEnd"&&Us&&(Fe=Wo()):(pr=me,Bt="value"in pr?pr.value:pr.textContent,Us=!0)),Be=qs(re,Je),0<Be.length&&(Je=new od(Je,t,null,c,me),ve.push({event:Je,listeners:Be}),Fe?Je.data=Fe:(Fe=pd(c),Fe!==null&&(Je.data=Fe)))),(Fe=fd?gd(t,c):Bs(t,c))&&(re=qs(re,"onBeforeInput"),0<re.length&&(me=new od("onBeforeInput","beforeinput",null,c,me),ve.push({event:me,listeners:re}),me.data=Fe))}gl(ve,i)})}function ea(t,i,c){return{instance:t,listener:i,currentTarget:c}}function qs(t,i){for(var c=i+"Capture",d=[];t!==null;){var m=t,w=m.stateNode;m.tag===5&&w!==null&&(m=w,w=kn(t,c),w!=null&&d.unshift(ea(t,w,m)),w=kn(t,i),w!=null&&d.push(ea(t,w,m))),t=t.return}return d}function Ws(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function Ja(t,i,c,d,m){for(var w=i._reactName,T=[];c!==null&&c!==d;){var B=c,$=B.alternate,re=B.stateNode;if($!==null&&$===d)break;B.tag===5&&re!==null&&(B=re,m?($=kn(c,w),$!=null&&T.unshift(ea(c,$,B))):m||($=kn(c,w),$!=null&&T.push(ea(c,$,B)))),c=c.return}T.length!==0&&t.push({event:i,listeners:T})}var Cp=/\r\n?/g,Ep=/\u0000|\uFFFD/g;function Md(t){return(typeof t=="string"?t:""+t).replace(Cp,`
`).replace(Ep,"")}function Qa(t,i,c){if(i=Md(i),Md(t)!==i&&c)throw Error(r(425))}function Ka(){}var yl=null,Ya=null;function _l(t,i){return t==="textarea"||t==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var En=typeof setTimeout=="function"?setTimeout:void 0,wl=typeof clearTimeout=="function"?clearTimeout:void 0,Xa=typeof Promise=="function"?Promise:void 0,ta=typeof queueMicrotask=="function"?queueMicrotask:typeof Xa<"u"?function(t){return Xa.resolve(null).then(t).catch(bl)}:En;function bl(t){setTimeout(function(){throw t})}function Za(t,i){var c=i,d=0;do{var m=c.nextSibling;if(t.removeChild(c),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(d===0){t.removeChild(m),Yi(i);return}d--}else c!=="$"&&c!=="$?"&&c!=="$!"||d++;c=m}while(c);Yi(i)}function Xr(t){for(;t!=null;t=t.nextSibling){var i=t.nodeType;if(i===1||i===3)break;if(i===8){if(i=t.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return t}function Hs(t){t=t.previousSibling;for(var i=0;t;){if(t.nodeType===8){var c=t.data;if(c==="$"||c==="$!"||c==="$?"){if(i===0)return t;i--}else c==="/$"&&i++}t=t.previousSibling}return null}var ss=Math.random().toString(36).slice(2),Mn="__reactFiber$"+ss,Zr="__reactProps$"+ss,mr="__reactContainer$"+ss,Gs="__reactEvents$"+ss,Mp="__reactListeners$"+ss,Sl="__reactHandles$"+ss;function nn(t){var i=t[Mn];if(i)return i;for(var c=t.parentNode;c;){if(i=c[mr]||c[Mn]){if(c=i.alternate,i.child!==null||c!==null&&c.child!==null)for(t=Hs(t);t!==null;){if(c=t[Mn])return c;t=Hs(t)}return i}t=c,c=t.parentNode}return null}function Ai(t){return t=t[Mn]||t[mr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Js(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(r(33))}function ec(t){return t[Zr]||null}var tc=[],Qs=-1;function ei(t){return{current:t}}function ct(t){0>Qs||(t.current=tc[Qs],tc[Qs]=null,Qs--)}function vt(t,i){Qs++,tc[Qs]=t.current,t.current=i}var er={},Kt=ei(er),dn=ei(!1),tr=er;function vr(t,i){var c=t.type.contextTypes;if(!c)return er;var d=t.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===i)return d.__reactInternalMemoizedMaskedChildContext;var m={},w;for(w in c)m[w]=i[w];return d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=m),m}function On(t){return t=t.childContextTypes,t!=null}function na(){ct(dn),ct(Kt)}function It(t,i,c){if(Kt.current!==er)throw Error(r(168));vt(Kt,i),vt(dn,c)}function Od(t,i,c){var d=t.stateNode;if(i=i.childContextTypes,typeof d.getChildContext!="function")return c;d=d.getChildContext();for(var m in d)if(!(m in i))throw Error(r(108,F(t)||"Unknown",m));return oe({},c,d)}function nc(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||er,tr=Kt.current,vt(Kt,t),vt(dn,dn.current),!0}function Td(t,i,c){var d=t.stateNode;if(!d)throw Error(r(169));c?(t=Od(t,i,tr),d.__reactInternalMemoizedMergedChildContext=t,ct(dn),ct(Kt),vt(Kt,t)):ct(dn),vt(dn,c)}var ti=null,rc=!1,kl=!1;function Cl(t){ti===null?ti=[t]:ti.push(t)}function Op(t){rc=!0,Cl(t)}function Lr(){if(!kl&&ti!==null){kl=!0;var t=0,i=we;try{var c=ti;for(we=1;t<c.length;t++){var d=c[t];do d=d(!0);while(d!==null)}ti=null,rc=!1}catch(m){throw ti!==null&&(ti=ti.slice(t+1)),Ua(wi,Lr),m}finally{we=i,kl=!1}}return null}var Ks=[],Ys=0,ic=null,sc=0,nr=[],rr=0,Pi=null,ni=1,ri="";function os(t,i){Ks[Ys++]=sc,Ks[Ys++]=ic,ic=t,sc=i}function Rd(t,i,c){nr[rr++]=ni,nr[rr++]=ri,nr[rr++]=Pi,Pi=t;var d=ni;t=ri;var m=32-Un(d)-1;d&=~(1<<m),c+=1;var w=32-Un(i)+m;if(30<w){var T=m-m%5;w=(d&(1<<T)-1).toString(32),d>>=T,m-=T,ni=1<<32-Un(i)+m|c<<m|d,ri=w+t}else ni=1<<w|c<<m|d,ri=t}function oc(t){t.return!==null&&(os(t,1),Rd(t,1,0))}function ac(t){for(;t===ic;)ic=Ks[--Ys],Ks[Ys]=null,sc=Ks[--Ys],Ks[Ys]=null;for(;t===Pi;)Pi=nr[--rr],nr[rr]=null,ri=nr[--rr],nr[rr]=null,ni=nr[--rr],nr[rr]=null}var qn=null,Wn=null,Mt=!1,yr=null;function Ad(t,i){var c=Ur(5,null,null,0);c.elementType="DELETED",c.stateNode=i,c.return=t,i=t.deletions,i===null?(t.deletions=[c],t.flags|=16):i.push(c)}function Pd(t,i){switch(t.tag){case 5:var c=t.type;return i=i.nodeType!==1||c.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(t.stateNode=i,qn=t,Wn=Xr(i.firstChild),!0):!1;case 6:return i=t.pendingProps===""||i.nodeType!==3?null:i,i!==null?(t.stateNode=i,qn=t,Wn=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(c=Pi!==null?{id:ni,overflow:ri}:null,t.memoizedState={dehydrated:i,treeContext:c,retryLane:1073741824},c=Ur(18,null,null,0),c.stateNode=i,c.return=t,t.child=c,qn=t,Wn=null,!0):!1;default:return!1}}function El(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Ml(t){if(Mt){var i=Wn;if(i){var c=i;if(!Pd(t,i)){if(El(t))throw Error(r(418));i=Xr(c.nextSibling);var d=qn;i&&Pd(t,i)?Ad(d,c):(t.flags=t.flags&-4097|2,Mt=!1,qn=t)}}else{if(El(t))throw Error(r(418));t.flags=t.flags&-4097|2,Mt=!1,qn=t}}}function Xs(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;qn=t}function ra(t){if(t!==qn)return!1;if(!Mt)return Xs(t),Mt=!0,!1;var i;if((i=t.tag!==3)&&!(i=t.tag!==5)&&(i=t.type,i=i!=="head"&&i!=="body"&&!_l(t.type,t.memoizedProps)),i&&(i=Wn)){if(El(t))throw cc(),Error(r(418));for(;i;)Ad(t,i),i=Xr(i.nextSibling)}if(Xs(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(r(317));e:{for(t=t.nextSibling,i=0;t;){if(t.nodeType===8){var c=t.data;if(c==="/$"){if(i===0){Wn=Xr(t.nextSibling);break e}i--}else c!=="$"&&c!=="$!"&&c!=="$?"||i++}t=t.nextSibling}Wn=null}}else Wn=qn?Xr(t.stateNode.nextSibling):null;return!0}function cc(){for(var t=Wn;t;)t=Xr(t.nextSibling)}function Zs(){Wn=qn=null,Mt=!1}function ia(t){yr===null?yr=[t]:yr.push(t)}var Id=L.ReactCurrentBatchConfig;function sa(t,i,c){if(t=c.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(r(309));var d=c.stateNode}if(!d)throw Error(r(147,t));var m=d,w=""+t;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===w?i.ref:(i=function(T){var B=m.refs;T===null?delete B[w]:B[w]=T},i._stringRef=w,i)}if(typeof t!="string")throw Error(r(284));if(!c._owner)throw Error(r(290,t))}return t}function lc(t,i){throw t=Object.prototype.toString.call(i),Error(r(31,t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t))}function xd(t){var i=t._init;return i(t._payload)}function Ld(t){function i(Z,W){if(t){var ee=Z.deletions;ee===null?(Z.deletions=[W],Z.flags|=16):ee.push(W)}}function c(Z,W){if(!t)return null;for(;W!==null;)i(Z,W),W=W.sibling;return null}function d(Z,W){for(Z=new Map;W!==null;)W.key!==null?Z.set(W.key,W):Z.set(W.index,W),W=W.sibling;return Z}function m(Z,W){return Z=ao(Z,W),Z.index=0,Z.sibling=null,Z}function w(Z,W,ee){return Z.index=ee,t?(ee=Z.alternate,ee!==null?(ee=ee.index,ee<W?(Z.flags|=2,W):ee):(Z.flags|=2,W)):(Z.flags|=1048576,W)}function T(Z){return t&&Z.alternate===null&&(Z.flags|=2),Z}function B(Z,W,ee,ke){return W===null||W.tag!==6?(W=ag(ee,Z.mode,ke),W.return=Z,W):(W=m(W,ee),W.return=Z,W)}function $(Z,W,ee,ke){var je=ee.type;return je===ae?me(Z,W,ee.props.children,ke,ee.key):W!==null&&(W.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===it&&xd(je)===W.type)?(ke=m(W,ee.props),ke.ref=sa(Z,W,ee),ke.return=Z,ke):(ke=ef(ee.type,ee.key,ee.props,null,Z.mode,ke),ke.ref=sa(Z,W,ee),ke.return=Z,ke)}function re(Z,W,ee,ke){return W===null||W.tag!==4||W.stateNode.containerInfo!==ee.containerInfo||W.stateNode.implementation!==ee.implementation?(W=cg(ee,Z.mode,ke),W.return=Z,W):(W=m(W,ee.children||[]),W.return=Z,W)}function me(Z,W,ee,ke,je){return W===null||W.tag!==7?(W=fa(ee,Z.mode,ke,je),W.return=Z,W):(W=m(W,ee),W.return=Z,W)}function ve(Z,W,ee){if(typeof W=="string"&&W!==""||typeof W=="number")return W=ag(""+W,Z.mode,ee),W.return=Z,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case q:return ee=ef(W.type,W.key,W.props,null,Z.mode,ee),ee.ref=sa(Z,null,W),ee.return=Z,ee;case H:return W=cg(W,Z.mode,ee),W.return=Z,W;case it:var ke=W._init;return ve(Z,ke(W._payload),ee)}if(zt(W)||Ce(W))return W=fa(W,Z.mode,ee,null),W.return=Z,W;lc(Z,W)}return null}function pe(Z,W,ee,ke){var je=W!==null?W.key:null;if(typeof ee=="string"&&ee!==""||typeof ee=="number")return je!==null?null:B(Z,W,""+ee,ke);if(typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case q:return ee.key===je?$(Z,W,ee,ke):null;case H:return ee.key===je?re(Z,W,ee,ke):null;case it:return je=ee._init,pe(Z,W,je(ee._payload),ke)}if(zt(ee)||Ce(ee))return je!==null?null:me(Z,W,ee,ke,null);lc(Z,ee)}return null}function Ae(Z,W,ee,ke,je){if(typeof ke=="string"&&ke!==""||typeof ke=="number")return Z=Z.get(ee)||null,B(W,Z,""+ke,je);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case q:return Z=Z.get(ke.key===null?ee:ke.key)||null,$(W,Z,ke,je);case H:return Z=Z.get(ke.key===null?ee:ke.key)||null,re(W,Z,ke,je);case it:var Be=ke._init;return Ae(Z,W,ee,Be(ke._payload),je)}if(zt(ke)||Ce(ke))return Z=Z.get(ee)||null,me(W,Z,ke,je,null);lc(W,ke)}return null}function Ie(Z,W,ee,ke){for(var je=null,Be=null,Fe=W,Je=W=0,on=null;Fe!==null&&Je<ee.length;Je++){Fe.index>Je?(on=Fe,Fe=null):on=Fe.sibling;var ht=pe(Z,Fe,ee[Je],ke);if(ht===null){Fe===null&&(Fe=on);break}t&&Fe&&ht.alternate===null&&i(Z,Fe),W=w(ht,W,Je),Be===null?je=ht:Be.sibling=ht,Be=ht,Fe=on}if(Je===ee.length)return c(Z,Fe),Mt&&os(Z,Je),je;if(Fe===null){for(;Je<ee.length;Je++)Fe=ve(Z,ee[Je],ke),Fe!==null&&(W=w(Fe,W,Je),Be===null?je=Fe:Be.sibling=Fe,Be=Fe);return Mt&&os(Z,Je),je}for(Fe=d(Z,Fe);Je<ee.length;Je++)on=Ae(Fe,Z,Je,ee[Je],ke),on!==null&&(t&&on.alternate!==null&&Fe.delete(on.key===null?Je:on.key),W=w(on,W,Je),Be===null?je=on:Be.sibling=on,Be=on);return t&&Fe.forEach(function(co){return i(Z,co)}),Mt&&os(Z,Je),je}function Le(Z,W,ee,ke){var je=Ce(ee);if(typeof je!="function")throw Error(r(150));if(ee=je.call(ee),ee==null)throw Error(r(151));for(var Be=je=null,Fe=W,Je=W=0,on=null,ht=ee.next();Fe!==null&&!ht.done;Je++,ht=ee.next()){Fe.index>Je?(on=Fe,Fe=null):on=Fe.sibling;var co=pe(Z,Fe,ht.value,ke);if(co===null){Fe===null&&(Fe=on);break}t&&Fe&&co.alternate===null&&i(Z,Fe),W=w(co,W,Je),Be===null?je=co:Be.sibling=co,Be=co,Fe=on}if(ht.done)return c(Z,Fe),Mt&&os(Z,Je),je;if(Fe===null){for(;!ht.done;Je++,ht=ee.next())ht=ve(Z,ht.value,ke),ht!==null&&(W=w(ht,W,Je),Be===null?je=ht:Be.sibling=ht,Be=ht);return Mt&&os(Z,Je),je}for(Fe=d(Z,Fe);!ht.done;Je++,ht=ee.next())ht=Ae(Fe,Z,Je,ht.value,ke),ht!==null&&(t&&ht.alternate!==null&&Fe.delete(ht.key===null?Je:ht.key),W=w(ht,W,Je),Be===null?je=ht:Be.sibling=ht,Be=ht);return t&&Fe.forEach(function(CE){return i(Z,CE)}),Mt&&os(Z,Je),je}function Ft(Z,W,ee,ke){if(typeof ee=="object"&&ee!==null&&ee.type===ae&&ee.key===null&&(ee=ee.props.children),typeof ee=="object"&&ee!==null){switch(ee.$$typeof){case q:e:{for(var je=ee.key,Be=W;Be!==null;){if(Be.key===je){if(je=ee.type,je===ae){if(Be.tag===7){c(Z,Be.sibling),W=m(Be,ee.props.children),W.return=Z,Z=W;break e}}else if(Be.elementType===je||typeof je=="object"&&je!==null&&je.$$typeof===it&&xd(je)===Be.type){c(Z,Be.sibling),W=m(Be,ee.props),W.ref=sa(Z,Be,ee),W.return=Z,Z=W;break e}c(Z,Be);break}else i(Z,Be);Be=Be.sibling}ee.type===ae?(W=fa(ee.props.children,Z.mode,ke,ee.key),W.return=Z,Z=W):(ke=ef(ee.type,ee.key,ee.props,null,Z.mode,ke),ke.ref=sa(Z,W,ee),ke.return=Z,Z=ke)}return T(Z);case H:e:{for(Be=ee.key;W!==null;){if(W.key===Be)if(W.tag===4&&W.stateNode.containerInfo===ee.containerInfo&&W.stateNode.implementation===ee.implementation){c(Z,W.sibling),W=m(W,ee.children||[]),W.return=Z,Z=W;break e}else{c(Z,W);break}else i(Z,W);W=W.sibling}W=cg(ee,Z.mode,ke),W.return=Z,Z=W}return T(Z);case it:return Be=ee._init,Ft(Z,W,Be(ee._payload),ke)}if(zt(ee))return Ie(Z,W,ee,ke);if(Ce(ee))return Le(Z,W,ee,ke);lc(Z,ee)}return typeof ee=="string"&&ee!==""||typeof ee=="number"?(ee=""+ee,W!==null&&W.tag===6?(c(Z,W.sibling),W=m(W,ee),W.return=Z,Z=W):(c(Z,W),W=ag(ee,Z.mode,ke),W.return=Z,Z=W),T(Z)):c(Z,W)}return Ft}var eo=Ld(!0),jd=Ld(!1),oa=ei(null),Ii=null,jr=null,aa=null;function Ol(){aa=jr=Ii=null}function Tl(t){var i=oa.current;ct(oa),t._currentValue=i}function Rl(t,i,c){for(;t!==null;){var d=t.alternate;if((t.childLanes&i)!==i?(t.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),t===c)break;t=t.return}}function to(t,i){Ii=t,aa=jr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&i)!==0&&(sr=!0),t.firstContext=null)}function ir(t){var i=t._currentValue;if(aa!==t)if(t={context:t,memoizedValue:i,next:null},jr===null){if(Ii===null)throw Error(r(308));jr=t,Ii.dependencies={lanes:0,firstContext:t}}else jr=jr.next=t;return i}var xi=null;function Al(t){xi===null?xi=[t]:xi.push(t)}function Nd(t,i,c,d){var m=i.interleaved;return m===null?(c.next=c,Al(i)):(c.next=m.next,m.next=c),i.interleaved=c,s(t,d)}function s(t,i){t.lanes|=i;var c=t.alternate;for(c!==null&&(c.lanes|=i),c=t,t=t.return;t!==null;)t.childLanes|=i,c=t.alternate,c!==null&&(c.childLanes|=i),c=t,t=t.return;return c.tag===3?c.stateNode:null}var o=!1;function u(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function p(t,i){t=t.updateQueue,i.updateQueue===t&&(i.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function _(t,i){return{eventTime:t,lane:i,tag:0,payload:null,callback:null,next:null}}function S(t,i,c){var d=t.updateQueue;if(d===null)return null;if(d=d.shared,(dt&2)!==0){var m=d.pending;return m===null?i.next=i:(i.next=m.next,m.next=i),d.pending=i,s(t,c)}return m=d.interleaved,m===null?(i.next=i,Al(d)):(i.next=m.next,m.next=i),d.interleaved=i,s(t,c)}function P(t,i,c){if(i=i.updateQueue,i!==null&&(i=i.shared,(c&4194240)!==0)){var d=i.lanes;d&=t.pendingLanes,c|=d,i.lanes=c,St(t,c)}}function U(t,i){var c=t.updateQueue,d=t.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var m=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var T={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};w===null?m=w=T:w=w.next=T,c=c.next}while(c!==null);w===null?m=w=i:w=w.next=i}else m=w=i;c={baseState:d.baseState,firstBaseUpdate:m,lastBaseUpdate:w,shared:d.shared,effects:d.effects},t.updateQueue=c;return}t=c.lastBaseUpdate,t===null?c.firstBaseUpdate=i:t.next=i,c.lastBaseUpdate=i}function X(t,i,c,d){var m=t.updateQueue;o=!1;var w=m.firstBaseUpdate,T=m.lastBaseUpdate,B=m.shared.pending;if(B!==null){m.shared.pending=null;var $=B,re=$.next;$.next=null,T===null?w=re:T.next=re,T=$;var me=t.alternate;me!==null&&(me=me.updateQueue,B=me.lastBaseUpdate,B!==T&&(B===null?me.firstBaseUpdate=re:B.next=re,me.lastBaseUpdate=$))}if(w!==null){var ve=m.baseState;T=0,me=re=$=null,B=w;do{var pe=B.lane,Ae=B.eventTime;if((d&pe)===pe){me!==null&&(me=me.next={eventTime:Ae,lane:0,tag:B.tag,payload:B.payload,callback:B.callback,next:null});e:{var Ie=t,Le=B;switch(pe=i,Ae=c,Le.tag){case 1:if(Ie=Le.payload,typeof Ie=="function"){ve=Ie.call(Ae,ve,pe);break e}ve=Ie;break e;case 3:Ie.flags=Ie.flags&-65537|128;case 0:if(Ie=Le.payload,pe=typeof Ie=="function"?Ie.call(Ae,ve,pe):Ie,pe==null)break e;ve=oe({},ve,pe);break e;case 2:o=!0}}B.callback!==null&&B.lane!==0&&(t.flags|=64,pe=m.effects,pe===null?m.effects=[B]:pe.push(B))}else Ae={eventTime:Ae,lane:pe,tag:B.tag,payload:B.payload,callback:B.callback,next:null},me===null?(re=me=Ae,$=ve):me=me.next=Ae,T|=pe;if(B=B.next,B===null){if(B=m.shared.pending,B===null)break;pe=B,B=pe.next,pe.next=null,m.lastBaseUpdate=pe,m.shared.pending=null}}while(!0);if(me===null&&($=ve),m.baseState=$,m.firstBaseUpdate=re,m.lastBaseUpdate=me,i=m.shared.interleaved,i!==null){m=i;do T|=m.lane,m=m.next;while(m!==i)}else w===null&&(m.shared.lanes=0);ca|=T,t.lanes=T,t.memoizedState=ve}}function Q(t,i,c){if(t=i.effects,i.effects=null,t!==null)for(i=0;i<t.length;i++){var d=t[i],m=d.callback;if(m!==null){if(d.callback=null,d=c,typeof m!="function")throw Error(r(191,m));m.call(d)}}}var de={},ce=ei(de),Se=ei(de),ue=ei(de);function Te(t){if(t===de)throw Error(r(174));return t}function Re(t,i){switch(vt(ue,i),vt(Se,t),vt(ce,de),t=i.nodeType,t){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Nt(null,"");break;default:t=t===8?i.parentNode:i,i=t.namespaceURI||null,t=t.tagName,i=Nt(i,t)}ct(ce),vt(ce,i)}function De(){ct(ce),ct(Se),ct(ue)}function lt(t){Te(ue.current);var i=Te(ce.current),c=Nt(i,t.type);i!==c&&(vt(Se,t),vt(ce,c))}function ft(t){Se.current===t&&(ct(ce),ct(Se))}var We=ei(0);function He(t){for(var i=t;i!==null;){if(i.tag===13){var c=i.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var fn=[];function qt(){for(var t=0;t<fn.length;t++)fn[t]._workInProgressVersionPrimary=null;fn.length=0}var Li=L.ReactCurrentDispatcher,ji=L.ReactCurrentBatchConfig,ii=0,xt=null,Yt=null,rn=null,Dd=!1,Pl=!1,Il=0,H1=0;function Tn(){throw Error(r(321))}function Tp(t,i){if(i===null)return!1;for(var c=0;c<i.length&&c<t.length;c++)if(!gr(t[c],i[c]))return!1;return!0}function Rp(t,i,c,d,m,w){if(ii=w,xt=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Li.current=t===null||t.memoizedState===null?K1:Y1,t=c(d,m),Pl){w=0;do{if(Pl=!1,Il=0,25<=w)throw Error(r(301));w+=1,rn=Yt=null,i.updateQueue=null,Li.current=X1,t=c(d,m)}while(Pl)}if(Li.current=Fd,i=Yt!==null&&Yt.next!==null,ii=0,rn=Yt=xt=null,Dd=!1,i)throw Error(r(300));return t}function Ap(){var t=Il!==0;return Il=0,t}function Ni(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rn===null?xt.memoizedState=rn=t:rn=rn.next=t,rn}function Nr(){if(Yt===null){var t=xt.alternate;t=t!==null?t.memoizedState:null}else t=Yt.next;var i=rn===null?xt.memoizedState:rn.next;if(i!==null)rn=i,Yt=t;else{if(t===null)throw Error(r(310));Yt=t,t={memoizedState:Yt.memoizedState,baseState:Yt.baseState,baseQueue:Yt.baseQueue,queue:Yt.queue,next:null},rn===null?xt.memoizedState=rn=t:rn=rn.next=t}return rn}function xl(t,i){return typeof i=="function"?i(t):i}function Pp(t){var i=Nr(),c=i.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=t;var d=Yt,m=d.baseQueue,w=c.pending;if(w!==null){if(m!==null){var T=m.next;m.next=w.next,w.next=T}d.baseQueue=m=w,c.pending=null}if(m!==null){w=m.next,d=d.baseState;var B=T=null,$=null,re=w;do{var me=re.lane;if((ii&me)===me)$!==null&&($=$.next={lane:0,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null}),d=re.hasEagerState?re.eagerState:t(d,re.action);else{var ve={lane:me,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null};$===null?(B=$=ve,T=d):$=$.next=ve,xt.lanes|=me,ca|=me}re=re.next}while(re!==null&&re!==w);$===null?T=d:$.next=B,gr(d,i.memoizedState)||(sr=!0),i.memoizedState=d,i.baseState=T,i.baseQueue=$,c.lastRenderedState=d}if(t=c.interleaved,t!==null){m=t;do w=m.lane,xt.lanes|=w,ca|=w,m=m.next;while(m!==t)}else m===null&&(c.lanes=0);return[i.memoizedState,c.dispatch]}function Ip(t){var i=Nr(),c=i.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=t;var d=c.dispatch,m=c.pending,w=i.memoizedState;if(m!==null){c.pending=null;var T=m=m.next;do w=t(w,T.action),T=T.next;while(T!==m);gr(w,i.memoizedState)||(sr=!0),i.memoizedState=w,i.baseQueue===null&&(i.baseState=w),c.lastRenderedState=w}return[w,d]}function I_(){}function x_(t,i){var c=xt,d=Nr(),m=i(),w=!gr(d.memoizedState,m);if(w&&(d.memoizedState=m,sr=!0),d=d.queue,xp(N_.bind(null,c,d,t),[t]),d.getSnapshot!==i||w||rn!==null&&rn.memoizedState.tag&1){if(c.flags|=2048,Ll(9,j_.bind(null,c,d,m,i),void 0,null),sn===null)throw Error(r(349));(ii&30)!==0||L_(c,i,m)}return m}function L_(t,i,c){t.flags|=16384,t={getSnapshot:i,value:c},i=xt.updateQueue,i===null?(i={lastEffect:null,stores:null},xt.updateQueue=i,i.stores=[t]):(c=i.stores,c===null?i.stores=[t]:c.push(t))}function j_(t,i,c,d){i.value=c,i.getSnapshot=d,D_(i)&&U_(t)}function N_(t,i,c){return c(function(){D_(i)&&U_(t)})}function D_(t){var i=t.getSnapshot;t=t.value;try{var c=i();return!gr(t,c)}catch{return!0}}function U_(t){var i=s(t,1);i!==null&&ci(i,t,1,-1)}function B_(t){var i=Ni();return typeof t=="function"&&(t=t()),i.memoizedState=i.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:xl,lastRenderedState:t},i.queue=t,t=t.dispatch=Q1.bind(null,xt,t),[i.memoizedState,t]}function Ll(t,i,c,d){return t={tag:t,create:i,destroy:c,deps:d,next:null},i=xt.updateQueue,i===null?(i={lastEffect:null,stores:null},xt.updateQueue=i,i.lastEffect=t.next=t):(c=i.lastEffect,c===null?i.lastEffect=t.next=t:(d=c.next,c.next=t,t.next=d,i.lastEffect=t)),t}function F_(){return Nr().memoizedState}function Ud(t,i,c,d){var m=Ni();xt.flags|=t,m.memoizedState=Ll(1|i,c,void 0,d===void 0?null:d)}function Bd(t,i,c,d){var m=Nr();d=d===void 0?null:d;var w=void 0;if(Yt!==null){var T=Yt.memoizedState;if(w=T.destroy,d!==null&&Tp(d,T.deps)){m.memoizedState=Ll(i,c,w,d);return}}xt.flags|=t,m.memoizedState=Ll(1|i,c,w,d)}function V_(t,i){return Ud(8390656,8,t,i)}function xp(t,i){return Bd(2048,8,t,i)}function z_(t,i){return Bd(4,2,t,i)}function $_(t,i){return Bd(4,4,t,i)}function q_(t,i){if(typeof i=="function")return t=t(),i(t),function(){i(null)};if(i!=null)return t=t(),i.current=t,function(){i.current=null}}function W_(t,i,c){return c=c!=null?c.concat([t]):null,Bd(4,4,q_.bind(null,i,t),c)}function Lp(){}function H_(t,i){var c=Nr();i=i===void 0?null:i;var d=c.memoizedState;return d!==null&&i!==null&&Tp(i,d[1])?d[0]:(c.memoizedState=[t,i],t)}function G_(t,i){var c=Nr();i=i===void 0?null:i;var d=c.memoizedState;return d!==null&&i!==null&&Tp(i,d[1])?d[0]:(t=t(),c.memoizedState=[t,i],t)}function J_(t,i,c){return(ii&21)===0?(t.baseState&&(t.baseState=!1,sr=!0),t.memoizedState=c):(gr(c,i)||(c=As(),xt.lanes|=c,ca|=c,t.baseState=!0),i)}function G1(t,i){var c=we;we=c!==0&&4>c?c:4,t(!0);var d=ji.transition;ji.transition={};try{t(!1),i()}finally{we=c,ji.transition=d}}function Q_(){return Nr().memoizedState}function J1(t,i,c){var d=so(t);if(c={lane:d,action:c,hasEagerState:!1,eagerState:null,next:null},K_(t))Y_(i,c);else if(c=Nd(t,i,c,d),c!==null){var m=Gn();ci(c,t,d,m),X_(c,i,d)}}function Q1(t,i,c){var d=so(t),m={lane:d,action:c,hasEagerState:!1,eagerState:null,next:null};if(K_(t))Y_(i,m);else{var w=t.alternate;if(t.lanes===0&&(w===null||w.lanes===0)&&(w=i.lastRenderedReducer,w!==null))try{var T=i.lastRenderedState,B=w(T,c);if(m.hasEagerState=!0,m.eagerState=B,gr(B,T)){var $=i.interleaved;$===null?(m.next=m,Al(i)):(m.next=$.next,$.next=m),i.interleaved=m;return}}catch{}finally{}c=Nd(t,i,m,d),c!==null&&(m=Gn(),ci(c,t,d,m),X_(c,i,d))}}function K_(t){var i=t.alternate;return t===xt||i!==null&&i===xt}function Y_(t,i){Pl=Dd=!0;var c=t.pending;c===null?i.next=i:(i.next=c.next,c.next=i),t.pending=i}function X_(t,i,c){if((c&4194240)!==0){var d=i.lanes;d&=t.pendingLanes,c|=d,i.lanes=c,St(t,c)}}var Fd={readContext:ir,useCallback:Tn,useContext:Tn,useEffect:Tn,useImperativeHandle:Tn,useInsertionEffect:Tn,useLayoutEffect:Tn,useMemo:Tn,useReducer:Tn,useRef:Tn,useState:Tn,useDebugValue:Tn,useDeferredValue:Tn,useTransition:Tn,useMutableSource:Tn,useSyncExternalStore:Tn,useId:Tn,unstable_isNewReconciler:!1},K1={readContext:ir,useCallback:function(t,i){return Ni().memoizedState=[t,i===void 0?null:i],t},useContext:ir,useEffect:V_,useImperativeHandle:function(t,i,c){return c=c!=null?c.concat([t]):null,Ud(4194308,4,q_.bind(null,i,t),c)},useLayoutEffect:function(t,i){return Ud(4194308,4,t,i)},useInsertionEffect:function(t,i){return Ud(4,2,t,i)},useMemo:function(t,i){var c=Ni();return i=i===void 0?null:i,t=t(),c.memoizedState=[t,i],t},useReducer:function(t,i,c){var d=Ni();return i=c!==void 0?c(i):i,d.memoizedState=d.baseState=i,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},d.queue=t,t=t.dispatch=J1.bind(null,xt,t),[d.memoizedState,t]},useRef:function(t){var i=Ni();return t={current:t},i.memoizedState=t},useState:B_,useDebugValue:Lp,useDeferredValue:function(t){return Ni().memoizedState=t},useTransition:function(){var t=B_(!1),i=t[0];return t=G1.bind(null,t[1]),Ni().memoizedState=t,[i,t]},useMutableSource:function(){},useSyncExternalStore:function(t,i,c){var d=xt,m=Ni();if(Mt){if(c===void 0)throw Error(r(407));c=c()}else{if(c=i(),sn===null)throw Error(r(349));(ii&30)!==0||L_(d,i,c)}m.memoizedState=c;var w={value:c,getSnapshot:i};return m.queue=w,V_(N_.bind(null,d,w,t),[t]),d.flags|=2048,Ll(9,j_.bind(null,d,w,c,i),void 0,null),c},useId:function(){var t=Ni(),i=sn.identifierPrefix;if(Mt){var c=ri,d=ni;c=(d&~(1<<32-Un(d)-1)).toString(32)+c,i=":"+i+"R"+c,c=Il++,0<c&&(i+="H"+c.toString(32)),i+=":"}else c=H1++,i=":"+i+"r"+c.toString(32)+":";return t.memoizedState=i},unstable_isNewReconciler:!1},Y1={readContext:ir,useCallback:H_,useContext:ir,useEffect:xp,useImperativeHandle:W_,useInsertionEffect:z_,useLayoutEffect:$_,useMemo:G_,useReducer:Pp,useRef:F_,useState:function(){return Pp(xl)},useDebugValue:Lp,useDeferredValue:function(t){var i=Nr();return J_(i,Yt.memoizedState,t)},useTransition:function(){var t=Pp(xl)[0],i=Nr().memoizedState;return[t,i]},useMutableSource:I_,useSyncExternalStore:x_,useId:Q_,unstable_isNewReconciler:!1},X1={readContext:ir,useCallback:H_,useContext:ir,useEffect:xp,useImperativeHandle:W_,useInsertionEffect:z_,useLayoutEffect:$_,useMemo:G_,useReducer:Ip,useRef:F_,useState:function(){return Ip(xl)},useDebugValue:Lp,useDeferredValue:function(t){var i=Nr();return Yt===null?i.memoizedState=t:J_(i,Yt.memoizedState,t)},useTransition:function(){var t=Ip(xl)[0],i=Nr().memoizedState;return[t,i]},useMutableSource:I_,useSyncExternalStore:x_,useId:Q_,unstable_isNewReconciler:!1};function si(t,i){if(t&&t.defaultProps){i=oe({},i),t=t.defaultProps;for(var c in t)i[c]===void 0&&(i[c]=t[c]);return i}return i}function jp(t,i,c,d){i=t.memoizedState,c=c(d,i),c=c==null?i:oe({},i,c),t.memoizedState=c,t.lanes===0&&(t.updateQueue.baseState=c)}var Vd={isMounted:function(t){return(t=t._reactInternals)?Tr(t)===t:!1},enqueueSetState:function(t,i,c){t=t._reactInternals;var d=Gn(),m=so(t),w=_(d,m);w.payload=i,c!=null&&(w.callback=c),i=S(t,w,m),i!==null&&(ci(i,t,m,d),P(i,t,m))},enqueueReplaceState:function(t,i,c){t=t._reactInternals;var d=Gn(),m=so(t),w=_(d,m);w.tag=1,w.payload=i,c!=null&&(w.callback=c),i=S(t,w,m),i!==null&&(ci(i,t,m,d),P(i,t,m))},enqueueForceUpdate:function(t,i){t=t._reactInternals;var c=Gn(),d=so(t),m=_(c,d);m.tag=2,i!=null&&(m.callback=i),i=S(t,m,d),i!==null&&(ci(i,t,d,c),P(i,t,d))}};function Z_(t,i,c,d,m,w,T){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(d,w,T):i.prototype&&i.prototype.isPureReactComponent?!Ko(c,d)||!Ko(m,w):!0}function e0(t,i,c){var d=!1,m=er,w=i.contextType;return typeof w=="object"&&w!==null?w=ir(w):(m=On(i)?tr:Kt.current,d=i.contextTypes,w=(d=d!=null)?vr(t,m):er),i=new i(c,w),t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Vd,t.stateNode=i,i._reactInternals=t,d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=m,t.__reactInternalMemoizedMaskedChildContext=w),i}function t0(t,i,c,d){t=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(c,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(c,d),i.state!==t&&Vd.enqueueReplaceState(i,i.state,null)}function Np(t,i,c,d){var m=t.stateNode;m.props=c,m.state=t.memoizedState,m.refs={},u(t);var w=i.contextType;typeof w=="object"&&w!==null?m.context=ir(w):(w=On(i)?tr:Kt.current,m.context=vr(t,w)),m.state=t.memoizedState,w=i.getDerivedStateFromProps,typeof w=="function"&&(jp(t,i,w,c),m.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(i=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),i!==m.state&&Vd.enqueueReplaceState(m,m.state,null),X(t,c,m,d),m.state=t.memoizedState),typeof m.componentDidMount=="function"&&(t.flags|=4194308)}function uc(t,i){try{var c="",d=i;do c+=C(d),d=d.return;while(d);var m=c}catch(w){m=`
Error generating stack: `+w.message+`
`+w.stack}return{value:t,source:i,stack:m,digest:null}}function Dp(t,i,c){return{value:t,source:null,stack:c??null,digest:i??null}}function Up(t,i){try{console.error(i.value)}catch(c){setTimeout(function(){throw c})}}var Z1=typeof WeakMap=="function"?WeakMap:Map;function n0(t,i,c){c=_(-1,c),c.tag=3,c.payload={element:null};var d=i.value;return c.callback=function(){Jd||(Jd=!0,Zp=d),Up(t,i)},c}function r0(t,i,c){c=_(-1,c),c.tag=3;var d=t.type.getDerivedStateFromError;if(typeof d=="function"){var m=i.value;c.payload=function(){return d(m)},c.callback=function(){Up(t,i)}}var w=t.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(c.callback=function(){Up(t,i),typeof d!="function"&&(ro===null?ro=new Set([this]):ro.add(this));var T=i.stack;this.componentDidCatch(i.value,{componentStack:T!==null?T:""})}),c}function i0(t,i,c){var d=t.pingCache;if(d===null){d=t.pingCache=new Z1;var m=new Set;d.set(i,m)}else m=d.get(i),m===void 0&&(m=new Set,d.set(i,m));m.has(c)||(m.add(c),t=hE.bind(null,t,i,c),i.then(t,t))}function s0(t){do{var i;if((i=t.tag===13)&&(i=t.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return t;t=t.return}while(t!==null);return null}function o0(t,i,c,d,m){return(t.mode&1)===0?(t===i?t.flags|=65536:(t.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(i=_(-1,1),i.tag=2,S(c,i,1))),c.lanes|=1),t):(t.flags|=65536,t.lanes=m,t)}var eE=L.ReactCurrentOwner,sr=!1;function Hn(t,i,c,d){i.child=t===null?jd(i,null,c,d):eo(i,t.child,c,d)}function a0(t,i,c,d,m){c=c.render;var w=i.ref;return to(i,m),d=Rp(t,i,c,d,w,m),c=Ap(),t!==null&&!sr?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~m,as(t,i,m)):(Mt&&c&&oc(i),i.flags|=1,Hn(t,i,d,m),i.child)}function c0(t,i,c,d,m){if(t===null){var w=c.type;return typeof w=="function"&&!og(w)&&w.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(i.tag=15,i.type=w,l0(t,i,w,d,m)):(t=ef(c.type,null,d,i,i.mode,m),t.ref=i.ref,t.return=i,i.child=t)}if(w=t.child,(t.lanes&m)===0){var T=w.memoizedProps;if(c=c.compare,c=c!==null?c:Ko,c(T,d)&&t.ref===i.ref)return as(t,i,m)}return i.flags|=1,t=ao(w,d),t.ref=i.ref,t.return=i,i.child=t}function l0(t,i,c,d,m){if(t!==null){var w=t.memoizedProps;if(Ko(w,d)&&t.ref===i.ref)if(sr=!1,i.pendingProps=d=w,(t.lanes&m)!==0)(t.flags&131072)!==0&&(sr=!0);else return i.lanes=t.lanes,as(t,i,m)}return Bp(t,i,c,d,m)}function u0(t,i,c){var d=i.pendingProps,m=d.children,w=t!==null?t.memoizedState:null;if(d.mode==="hidden")if((i.mode&1)===0)i.memoizedState={baseLanes:0,cachePool:null,transitions:null},vt(fc,_r),_r|=c;else{if((c&1073741824)===0)return t=w!==null?w.baseLanes|c:c,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:t,cachePool:null,transitions:null},i.updateQueue=null,vt(fc,_r),_r|=t,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=w!==null?w.baseLanes:c,vt(fc,_r),_r|=d}else w!==null?(d=w.baseLanes|c,i.memoizedState=null):d=c,vt(fc,_r),_r|=d;return Hn(t,i,m,c),i.child}function d0(t,i){var c=i.ref;(t===null&&c!==null||t!==null&&t.ref!==c)&&(i.flags|=512,i.flags|=2097152)}function Bp(t,i,c,d,m){var w=On(c)?tr:Kt.current;return w=vr(i,w),to(i,m),c=Rp(t,i,c,d,w,m),d=Ap(),t!==null&&!sr?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~m,as(t,i,m)):(Mt&&d&&oc(i),i.flags|=1,Hn(t,i,c,m),i.child)}function f0(t,i,c,d,m){if(On(c)){var w=!0;nc(i)}else w=!1;if(to(i,m),i.stateNode===null)$d(t,i),e0(i,c,d),Np(i,c,d,m),d=!0;else if(t===null){var T=i.stateNode,B=i.memoizedProps;T.props=B;var $=T.context,re=c.contextType;typeof re=="object"&&re!==null?re=ir(re):(re=On(c)?tr:Kt.current,re=vr(i,re));var me=c.getDerivedStateFromProps,ve=typeof me=="function"||typeof T.getSnapshotBeforeUpdate=="function";ve||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(B!==d||$!==re)&&t0(i,T,d,re),o=!1;var pe=i.memoizedState;T.state=pe,X(i,d,T,m),$=i.memoizedState,B!==d||pe!==$||dn.current||o?(typeof me=="function"&&(jp(i,c,me,d),$=i.memoizedState),(B=o||Z_(i,c,B,d,pe,$,re))?(ve||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(i.flags|=4194308)):(typeof T.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=$),T.props=d,T.state=$,T.context=re,d=B):(typeof T.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{T=i.stateNode,p(t,i),B=i.memoizedProps,re=i.type===i.elementType?B:si(i.type,B),T.props=re,ve=i.pendingProps,pe=T.context,$=c.contextType,typeof $=="object"&&$!==null?$=ir($):($=On(c)?tr:Kt.current,$=vr(i,$));var Ae=c.getDerivedStateFromProps;(me=typeof Ae=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(B!==ve||pe!==$)&&t0(i,T,d,$),o=!1,pe=i.memoizedState,T.state=pe,X(i,d,T,m);var Ie=i.memoizedState;B!==ve||pe!==Ie||dn.current||o?(typeof Ae=="function"&&(jp(i,c,Ae,d),Ie=i.memoizedState),(re=o||Z_(i,c,re,d,pe,Ie,$)||!1)?(me||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(d,Ie,$),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(d,Ie,$)),typeof T.componentDidUpdate=="function"&&(i.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof T.componentDidUpdate!="function"||B===t.memoizedProps&&pe===t.memoizedState||(i.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||B===t.memoizedProps&&pe===t.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=Ie),T.props=d,T.state=Ie,T.context=$,d=re):(typeof T.componentDidUpdate!="function"||B===t.memoizedProps&&pe===t.memoizedState||(i.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||B===t.memoizedProps&&pe===t.memoizedState||(i.flags|=1024),d=!1)}return Fp(t,i,c,d,w,m)}function Fp(t,i,c,d,m,w){d0(t,i);var T=(i.flags&128)!==0;if(!d&&!T)return m&&Td(i,c,!1),as(t,i,w);d=i.stateNode,eE.current=i;var B=T&&typeof c.getDerivedStateFromError!="function"?null:d.render();return i.flags|=1,t!==null&&T?(i.child=eo(i,t.child,null,w),i.child=eo(i,null,B,w)):Hn(t,i,B,w),i.memoizedState=d.state,m&&Td(i,c,!0),i.child}function h0(t){var i=t.stateNode;i.pendingContext?It(t,i.pendingContext,i.pendingContext!==i.context):i.context&&It(t,i.context,!1),Re(t,i.containerInfo)}function p0(t,i,c,d,m){return Zs(),ia(m),i.flags|=256,Hn(t,i,c,d),i.child}var Vp={dehydrated:null,treeContext:null,retryLane:0};function zp(t){return{baseLanes:t,cachePool:null,transitions:null}}function g0(t,i,c){var d=i.pendingProps,m=We.current,w=!1,T=(i.flags&128)!==0,B;if((B=T)||(B=t!==null&&t.memoizedState===null?!1:(m&2)!==0),B?(w=!0,i.flags&=-129):(t===null||t.memoizedState!==null)&&(m|=1),vt(We,m&1),t===null)return Ml(i),t=i.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((i.mode&1)===0?i.lanes=1:t.data==="$!"?i.lanes=8:i.lanes=1073741824,null):(T=d.children,t=d.fallback,w?(d=i.mode,w=i.child,T={mode:"hidden",children:T},(d&1)===0&&w!==null?(w.childLanes=0,w.pendingProps=T):w=tf(T,d,0,null),t=fa(t,d,c,null),w.return=i,t.return=i,w.sibling=t,i.child=w,i.child.memoizedState=zp(c),i.memoizedState=Vp,t):$p(i,T));if(m=t.memoizedState,m!==null&&(B=m.dehydrated,B!==null))return tE(t,i,T,d,B,m,c);if(w){w=d.fallback,T=i.mode,m=t.child,B=m.sibling;var $={mode:"hidden",children:d.children};return(T&1)===0&&i.child!==m?(d=i.child,d.childLanes=0,d.pendingProps=$,i.deletions=null):(d=ao(m,$),d.subtreeFlags=m.subtreeFlags&14680064),B!==null?w=ao(B,w):(w=fa(w,T,c,null),w.flags|=2),w.return=i,d.return=i,d.sibling=w,i.child=d,d=w,w=i.child,T=t.child.memoizedState,T=T===null?zp(c):{baseLanes:T.baseLanes|c,cachePool:null,transitions:T.transitions},w.memoizedState=T,w.childLanes=t.childLanes&~c,i.memoizedState=Vp,d}return w=t.child,t=w.sibling,d=ao(w,{mode:"visible",children:d.children}),(i.mode&1)===0&&(d.lanes=c),d.return=i,d.sibling=null,t!==null&&(c=i.deletions,c===null?(i.deletions=[t],i.flags|=16):c.push(t)),i.child=d,i.memoizedState=null,d}function $p(t,i){return i=tf({mode:"visible",children:i},t.mode,0,null),i.return=t,t.child=i}function zd(t,i,c,d){return d!==null&&ia(d),eo(i,t.child,null,c),t=$p(i,i.pendingProps.children),t.flags|=2,i.memoizedState=null,t}function tE(t,i,c,d,m,w,T){if(c)return i.flags&256?(i.flags&=-257,d=Dp(Error(r(422))),zd(t,i,T,d)):i.memoizedState!==null?(i.child=t.child,i.flags|=128,null):(w=d.fallback,m=i.mode,d=tf({mode:"visible",children:d.children},m,0,null),w=fa(w,m,T,null),w.flags|=2,d.return=i,w.return=i,d.sibling=w,i.child=d,(i.mode&1)!==0&&eo(i,t.child,null,T),i.child.memoizedState=zp(T),i.memoizedState=Vp,w);if((i.mode&1)===0)return zd(t,i,T,null);if(m.data==="$!"){if(d=m.nextSibling&&m.nextSibling.dataset,d)var B=d.dgst;return d=B,w=Error(r(419)),d=Dp(w,d,void 0),zd(t,i,T,d)}if(B=(T&t.childLanes)!==0,sr||B){if(d=sn,d!==null){switch(T&-T){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=(m&(d.suspendedLanes|T))!==0?0:m,m!==0&&m!==w.retryLane&&(w.retryLane=m,s(t,m),ci(d,t,m,-1))}return sg(),d=Dp(Error(r(421))),zd(t,i,T,d)}return m.data==="$?"?(i.flags|=128,i.child=t.child,i=pE.bind(null,t),m._reactRetry=i,null):(t=w.treeContext,Wn=Xr(m.nextSibling),qn=i,Mt=!0,yr=null,t!==null&&(nr[rr++]=ni,nr[rr++]=ri,nr[rr++]=Pi,ni=t.id,ri=t.overflow,Pi=i),i=$p(i,d.children),i.flags|=4096,i)}function m0(t,i,c){t.lanes|=i;var d=t.alternate;d!==null&&(d.lanes|=i),Rl(t.return,i,c)}function qp(t,i,c,d,m){var w=t.memoizedState;w===null?t.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:m}:(w.isBackwards=i,w.rendering=null,w.renderingStartTime=0,w.last=d,w.tail=c,w.tailMode=m)}function v0(t,i,c){var d=i.pendingProps,m=d.revealOrder,w=d.tail;if(Hn(t,i,d.children,c),d=We.current,(d&2)!==0)d=d&1|2,i.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=i.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&m0(t,c,i);else if(t.tag===19)m0(t,c,i);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break e;for(;t.sibling===null;){if(t.return===null||t.return===i)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}d&=1}if(vt(We,d),(i.mode&1)===0)i.memoizedState=null;else switch(m){case"forwards":for(c=i.child,m=null;c!==null;)t=c.alternate,t!==null&&He(t)===null&&(m=c),c=c.sibling;c=m,c===null?(m=i.child,i.child=null):(m=c.sibling,c.sibling=null),qp(i,!1,m,c,w);break;case"backwards":for(c=null,m=i.child,i.child=null;m!==null;){if(t=m.alternate,t!==null&&He(t)===null){i.child=m;break}t=m.sibling,m.sibling=c,c=m,m=t}qp(i,!0,c,null,w);break;case"together":qp(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function $d(t,i){(i.mode&1)===0&&t!==null&&(t.alternate=null,i.alternate=null,i.flags|=2)}function as(t,i,c){if(t!==null&&(i.dependencies=t.dependencies),ca|=i.lanes,(c&i.childLanes)===0)return null;if(t!==null&&i.child!==t.child)throw Error(r(153));if(i.child!==null){for(t=i.child,c=ao(t,t.pendingProps),i.child=c,c.return=i;t.sibling!==null;)t=t.sibling,c=c.sibling=ao(t,t.pendingProps),c.return=i;c.sibling=null}return i.child}function nE(t,i,c){switch(i.tag){case 3:h0(i),Zs();break;case 5:lt(i);break;case 1:On(i.type)&&nc(i);break;case 4:Re(i,i.stateNode.containerInfo);break;case 10:var d=i.type._context,m=i.memoizedProps.value;vt(oa,d._currentValue),d._currentValue=m;break;case 13:if(d=i.memoizedState,d!==null)return d.dehydrated!==null?(vt(We,We.current&1),i.flags|=128,null):(c&i.child.childLanes)!==0?g0(t,i,c):(vt(We,We.current&1),t=as(t,i,c),t!==null?t.sibling:null);vt(We,We.current&1);break;case 19:if(d=(c&i.childLanes)!==0,(t.flags&128)!==0){if(d)return v0(t,i,c);i.flags|=128}if(m=i.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),vt(We,We.current),d)break;return null;case 22:case 23:return i.lanes=0,u0(t,i,c)}return as(t,i,c)}var y0,Wp,_0,w0;y0=function(t,i){for(var c=i.child;c!==null;){if(c.tag===5||c.tag===6)t.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===i)break;for(;c.sibling===null;){if(c.return===null||c.return===i)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},Wp=function(){},_0=function(t,i,c,d){var m=t.memoizedProps;if(m!==d){t=i.stateNode,Te(ce.current);var w=null;switch(c){case"input":m=Vt(t,m),d=Vt(t,d),w=[];break;case"select":m=oe({},m,{value:void 0}),d=oe({},d,{value:void 0}),w=[];break;case"textarea":m=jn(t,m),d=jn(t,d),w=[];break;default:typeof m.onClick!="function"&&typeof d.onClick=="function"&&(t.onclick=Ka)}Ss(c,d);var T;c=null;for(re in m)if(!d.hasOwnProperty(re)&&m.hasOwnProperty(re)&&m[re]!=null)if(re==="style"){var B=m[re];for(T in B)B.hasOwnProperty(T)&&(c||(c={}),c[T]="")}else re!=="dangerouslySetInnerHTML"&&re!=="children"&&re!=="suppressContentEditableWarning"&&re!=="suppressHydrationWarning"&&re!=="autoFocus"&&(l.hasOwnProperty(re)?w||(w=[]):(w=w||[]).push(re,null));for(re in d){var $=d[re];if(B=m?.[re],d.hasOwnProperty(re)&&$!==B&&($!=null||B!=null))if(re==="style")if(B){for(T in B)!B.hasOwnProperty(T)||$&&$.hasOwnProperty(T)||(c||(c={}),c[T]="");for(T in $)$.hasOwnProperty(T)&&B[T]!==$[T]&&(c||(c={}),c[T]=$[T])}else c||(w||(w=[]),w.push(re,c)),c=$;else re==="dangerouslySetInnerHTML"?($=$?$.__html:void 0,B=B?B.__html:void 0,$!=null&&B!==$&&(w=w||[]).push(re,$)):re==="children"?typeof $!="string"&&typeof $!="number"||(w=w||[]).push(re,""+$):re!=="suppressContentEditableWarning"&&re!=="suppressHydrationWarning"&&(l.hasOwnProperty(re)?($!=null&&re==="onScroll"&&kt("scroll",t),w||B===$||(w=[])):(w=w||[]).push(re,$))}c&&(w=w||[]).push("style",c);var re=w;(i.updateQueue=re)&&(i.flags|=4)}},w0=function(t,i,c,d){c!==d&&(i.flags|=4)};function jl(t,i){if(!Mt)switch(t.tailMode){case"hidden":i=t.tail;for(var c=null;i!==null;)i.alternate!==null&&(c=i),i=i.sibling;c===null?t.tail=null:c.sibling=null;break;case"collapsed":c=t.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?i||t.tail===null?t.tail=null:t.tail.sibling=null:d.sibling=null}}function Rn(t){var i=t.alternate!==null&&t.alternate.child===t.child,c=0,d=0;if(i)for(var m=t.child;m!==null;)c|=m.lanes|m.childLanes,d|=m.subtreeFlags&14680064,d|=m.flags&14680064,m.return=t,m=m.sibling;else for(m=t.child;m!==null;)c|=m.lanes|m.childLanes,d|=m.subtreeFlags,d|=m.flags,m.return=t,m=m.sibling;return t.subtreeFlags|=d,t.childLanes=c,i}function rE(t,i,c){var d=i.pendingProps;switch(ac(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Rn(i),null;case 1:return On(i.type)&&na(),Rn(i),null;case 3:return d=i.stateNode,De(),ct(dn),ct(Kt),qt(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(t===null||t.child===null)&&(ra(i)?i.flags|=4:t===null||t.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,yr!==null&&(ng(yr),yr=null))),Wp(t,i),Rn(i),null;case 5:ft(i);var m=Te(ue.current);if(c=i.type,t!==null&&i.stateNode!=null)_0(t,i,c,d,m),t.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!d){if(i.stateNode===null)throw Error(r(166));return Rn(i),null}if(t=Te(ce.current),ra(i)){d=i.stateNode,c=i.type;var w=i.memoizedProps;switch(d[Mn]=i,d[Zr]=w,t=(i.mode&1)!==0,c){case"dialog":kt("cancel",d),kt("close",d);break;case"iframe":case"object":case"embed":kt("load",d);break;case"video":case"audio":for(m=0;m<is.length;m++)kt(is[m],d);break;case"source":kt("error",d);break;case"img":case"image":case"link":kt("error",d),kt("load",d);break;case"details":kt("toggle",d);break;case"input":bn(d,w),kt("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!w.multiple},kt("invalid",d);break;case"textarea":Qn(d,w),kt("invalid",d)}Ss(c,w),m=null;for(var T in w)if(w.hasOwnProperty(T)){var B=w[T];T==="children"?typeof B=="string"?d.textContent!==B&&(w.suppressHydrationWarning!==!0&&Qa(d.textContent,B,t),m=["children",B]):typeof B=="number"&&d.textContent!==""+B&&(w.suppressHydrationWarning!==!0&&Qa(d.textContent,B,t),m=["children",""+B]):l.hasOwnProperty(T)&&B!=null&&T==="onScroll"&&kt("scroll",d)}switch(c){case"input":Oe(d),At(d,w,!0);break;case"textarea":Oe(d),Mr(d);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(d.onclick=Ka)}d=m,i.updateQueue=d,d!==null&&(i.flags|=4)}else{T=m.nodeType===9?m:m.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=qi(c)),t==="http://www.w3.org/1999/xhtml"?c==="script"?(t=T.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof d.is=="string"?t=T.createElement(c,{is:d.is}):(t=T.createElement(c),c==="select"&&(T=t,d.multiple?T.multiple=!0:d.size&&(T.size=d.size))):t=T.createElementNS(t,c),t[Mn]=i,t[Zr]=d,y0(t,i,!1,!1),i.stateNode=t;e:{switch(T=mi(c,d),c){case"dialog":kt("cancel",t),kt("close",t),m=d;break;case"iframe":case"object":case"embed":kt("load",t),m=d;break;case"video":case"audio":for(m=0;m<is.length;m++)kt(is[m],t);m=d;break;case"source":kt("error",t),m=d;break;case"img":case"image":case"link":kt("error",t),kt("load",t),m=d;break;case"details":kt("toggle",t),m=d;break;case"input":bn(t,d),m=Vt(t,d),kt("invalid",t);break;case"option":m=d;break;case"select":t._wrapperState={wasMultiple:!!d.multiple},m=oe({},d,{value:void 0}),kt("invalid",t);break;case"textarea":Qn(t,d),m=jn(t,d),kt("invalid",t);break;default:m=d}Ss(c,m),B=m;for(w in B)if(B.hasOwnProperty(w)){var $=B[w];w==="style"?Wi(t,$):w==="dangerouslySetInnerHTML"?($=$?$.__html:void 0,$!=null&&cn(t,$)):w==="children"?typeof $=="string"?(c!=="textarea"||$!=="")&&Hr(t,$):typeof $=="number"&&Hr(t,""+$):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(l.hasOwnProperty(w)?$!=null&&w==="onScroll"&&kt("scroll",t):$!=null&&ne(t,w,$,T))}switch(c){case"input":Oe(t),At(t,d,!1);break;case"textarea":Oe(t),Mr(t);break;case"option":d.value!=null&&t.setAttribute("value",""+G(d.value));break;case"select":t.multiple=!!d.multiple,w=d.value,w!=null?Ze(t,!!d.multiple,w,!1):d.defaultValue!=null&&Ze(t,!!d.multiple,d.defaultValue,!0);break;default:typeof m.onClick=="function"&&(t.onclick=Ka)}switch(c){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return Rn(i),null;case 6:if(t&&i.stateNode!=null)w0(t,i,t.memoizedProps,d);else{if(typeof d!="string"&&i.stateNode===null)throw Error(r(166));if(c=Te(ue.current),Te(ce.current),ra(i)){if(d=i.stateNode,c=i.memoizedProps,d[Mn]=i,(w=d.nodeValue!==c)&&(t=qn,t!==null))switch(t.tag){case 3:Qa(d.nodeValue,c,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Qa(d.nodeValue,c,(t.mode&1)!==0)}w&&(i.flags|=4)}else d=(c.nodeType===9?c:c.ownerDocument).createTextNode(d),d[Mn]=i,i.stateNode=d}return Rn(i),null;case 13:if(ct(We),d=i.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Mt&&Wn!==null&&(i.mode&1)!==0&&(i.flags&128)===0)cc(),Zs(),i.flags|=98560,w=!1;else if(w=ra(i),d!==null&&d.dehydrated!==null){if(t===null){if(!w)throw Error(r(318));if(w=i.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(r(317));w[Mn]=i}else Zs(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Rn(i),w=!1}else yr!==null&&(ng(yr),yr=null),w=!0;if(!w)return i.flags&65536?i:null}return(i.flags&128)!==0?(i.lanes=c,i):(d=d!==null,d!==(t!==null&&t.memoizedState!==null)&&d&&(i.child.flags|=8192,(i.mode&1)!==0&&(t===null||(We.current&1)!==0?Xt===0&&(Xt=3):sg())),i.updateQueue!==null&&(i.flags|=4),Rn(i),null);case 4:return De(),Wp(t,i),t===null&&Zo(i.stateNode.containerInfo),Rn(i),null;case 10:return Tl(i.type._context),Rn(i),null;case 17:return On(i.type)&&na(),Rn(i),null;case 19:if(ct(We),w=i.memoizedState,w===null)return Rn(i),null;if(d=(i.flags&128)!==0,T=w.rendering,T===null)if(d)jl(w,!1);else{if(Xt!==0||t!==null&&(t.flags&128)!==0)for(t=i.child;t!==null;){if(T=He(t),T!==null){for(i.flags|=128,jl(w,!1),d=T.updateQueue,d!==null&&(i.updateQueue=d,i.flags|=4),i.subtreeFlags=0,d=c,c=i.child;c!==null;)w=c,t=d,w.flags&=14680066,T=w.alternate,T===null?(w.childLanes=0,w.lanes=t,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=T.childLanes,w.lanes=T.lanes,w.child=T.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=T.memoizedProps,w.memoizedState=T.memoizedState,w.updateQueue=T.updateQueue,w.type=T.type,t=T.dependencies,w.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),c=c.sibling;return vt(We,We.current&1|2),i.child}t=t.sibling}w.tail!==null&&Et()>hc&&(i.flags|=128,d=!0,jl(w,!1),i.lanes=4194304)}else{if(!d)if(t=He(T),t!==null){if(i.flags|=128,d=!0,c=t.updateQueue,c!==null&&(i.updateQueue=c,i.flags|=4),jl(w,!0),w.tail===null&&w.tailMode==="hidden"&&!T.alternate&&!Mt)return Rn(i),null}else 2*Et()-w.renderingStartTime>hc&&c!==1073741824&&(i.flags|=128,d=!0,jl(w,!1),i.lanes=4194304);w.isBackwards?(T.sibling=i.child,i.child=T):(c=w.last,c!==null?c.sibling=T:i.child=T,w.last=T)}return w.tail!==null?(i=w.tail,w.rendering=i,w.tail=i.sibling,w.renderingStartTime=Et(),i.sibling=null,c=We.current,vt(We,d?c&1|2:c&1),i):(Rn(i),null);case 22:case 23:return ig(),d=i.memoizedState!==null,t!==null&&t.memoizedState!==null!==d&&(i.flags|=8192),d&&(i.mode&1)!==0?(_r&1073741824)!==0&&(Rn(i),i.subtreeFlags&6&&(i.flags|=8192)):Rn(i),null;case 24:return null;case 25:return null}throw Error(r(156,i.tag))}function iE(t,i){switch(ac(i),i.tag){case 1:return On(i.type)&&na(),t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 3:return De(),ct(dn),ct(Kt),qt(),t=i.flags,(t&65536)!==0&&(t&128)===0?(i.flags=t&-65537|128,i):null;case 5:return ft(i),null;case 13:if(ct(We),t=i.memoizedState,t!==null&&t.dehydrated!==null){if(i.alternate===null)throw Error(r(340));Zs()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 19:return ct(We),null;case 4:return De(),null;case 10:return Tl(i.type._context),null;case 22:case 23:return ig(),null;case 24:return null;default:return null}}var qd=!1,An=!1,sE=typeof WeakSet=="function"?WeakSet:Set,Pe=null;function dc(t,i){var c=t.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(d){Lt(t,i,d)}else c.current=null}function Hp(t,i,c){try{c()}catch(d){Lt(t,i,d)}}var b0=!1;function oE(t,i){if(yl=te,t=ul(),Yr(t)){if("selectionStart"in t)var c={start:t.selectionStart,end:t.selectionEnd};else e:{c=(c=t.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var m=d.anchorOffset,w=d.focusNode;d=d.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var T=0,B=-1,$=-1,re=0,me=0,ve=t,pe=null;t:for(;;){for(var Ae;ve!==c||m!==0&&ve.nodeType!==3||(B=T+m),ve!==w||d!==0&&ve.nodeType!==3||($=T+d),ve.nodeType===3&&(T+=ve.nodeValue.length),(Ae=ve.firstChild)!==null;)pe=ve,ve=Ae;for(;;){if(ve===t)break t;if(pe===c&&++re===m&&(B=T),pe===w&&++me===d&&($=T),(Ae=ve.nextSibling)!==null)break;ve=pe,pe=ve.parentNode}ve=Ae}c=B===-1||$===-1?null:{start:B,end:$}}else c=null}c=c||{start:0,end:0}}else c=null;for(Ya={focusedElem:t,selectionRange:c},te=!1,Pe=i;Pe!==null;)if(i=Pe,t=i.child,(i.subtreeFlags&1028)!==0&&t!==null)t.return=i,Pe=t;else for(;Pe!==null;){i=Pe;try{var Ie=i.alternate;if((i.flags&1024)!==0)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Ie!==null){var Le=Ie.memoizedProps,Ft=Ie.memoizedState,Z=i.stateNode,W=Z.getSnapshotBeforeUpdate(i.elementType===i.type?Le:si(i.type,Le),Ft);Z.__reactInternalSnapshotBeforeUpdate=W}break;case 3:var ee=i.stateNode.containerInfo;ee.nodeType===1?ee.textContent="":ee.nodeType===9&&ee.documentElement&&ee.removeChild(ee.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(ke){Lt(i,i.return,ke)}if(t=i.sibling,t!==null){t.return=i.return,Pe=t;break}Pe=i.return}return Ie=b0,b0=!1,Ie}function Nl(t,i,c){var d=i.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var m=d=d.next;do{if((m.tag&t)===t){var w=m.destroy;m.destroy=void 0,w!==void 0&&Hp(i,c,w)}m=m.next}while(m!==d)}}function Wd(t,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var c=i=i.next;do{if((c.tag&t)===t){var d=c.create;c.destroy=d()}c=c.next}while(c!==i)}}function Gp(t){var i=t.ref;if(i!==null){var c=t.stateNode;switch(t.tag){case 5:t=c;break;default:t=c}typeof i=="function"?i(t):i.current=t}}function S0(t){var i=t.alternate;i!==null&&(t.alternate=null,S0(i)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(i=t.stateNode,i!==null&&(delete i[Mn],delete i[Zr],delete i[Gs],delete i[Mp],delete i[Sl])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function k0(t){return t.tag===5||t.tag===3||t.tag===4}function C0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||k0(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Jp(t,i,c){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?c.nodeType===8?c.parentNode.insertBefore(t,i):c.insertBefore(t,i):(c.nodeType===8?(i=c.parentNode,i.insertBefore(t,c)):(i=c,i.appendChild(t)),c=c._reactRootContainer,c!=null||i.onclick!==null||(i.onclick=Ka));else if(d!==4&&(t=t.child,t!==null))for(Jp(t,i,c),t=t.sibling;t!==null;)Jp(t,i,c),t=t.sibling}function Qp(t,i,c){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?c.insertBefore(t,i):c.appendChild(t);else if(d!==4&&(t=t.child,t!==null))for(Qp(t,i,c),t=t.sibling;t!==null;)Qp(t,i,c),t=t.sibling}var hn=null,oi=!1;function no(t,i,c){for(c=c.child;c!==null;)E0(t,i,c),c=c.sibling}function E0(t,i,c){if(Dn&&typeof Dn.onCommitFiberUnmount=="function")try{Dn.onCommitFiberUnmount(bi,c)}catch{}switch(c.tag){case 5:An||dc(c,i);case 6:var d=hn,m=oi;hn=null,no(t,i,c),hn=d,oi=m,hn!==null&&(oi?(t=hn,c=c.stateNode,t.nodeType===8?t.parentNode.removeChild(c):t.removeChild(c)):hn.removeChild(c.stateNode));break;case 18:hn!==null&&(oi?(t=hn,c=c.stateNode,t.nodeType===8?Za(t.parentNode,c):t.nodeType===1&&Za(t,c),Yi(t)):Za(hn,c.stateNode));break;case 4:d=hn,m=oi,hn=c.stateNode.containerInfo,oi=!0,no(t,i,c),hn=d,oi=m;break;case 0:case 11:case 14:case 15:if(!An&&(d=c.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){m=d=d.next;do{var w=m,T=w.destroy;w=w.tag,T!==void 0&&((w&2)!==0||(w&4)!==0)&&Hp(c,i,T),m=m.next}while(m!==d)}no(t,i,c);break;case 1:if(!An&&(dc(c,i),d=c.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=c.memoizedProps,d.state=c.memoizedState,d.componentWillUnmount()}catch(B){Lt(c,i,B)}no(t,i,c);break;case 21:no(t,i,c);break;case 22:c.mode&1?(An=(d=An)||c.memoizedState!==null,no(t,i,c),An=d):no(t,i,c);break;default:no(t,i,c)}}function M0(t){var i=t.updateQueue;if(i!==null){t.updateQueue=null;var c=t.stateNode;c===null&&(c=t.stateNode=new sE),i.forEach(function(d){var m=gE.bind(null,t,d);c.has(d)||(c.add(d),d.then(m,m))})}}function ai(t,i){var c=i.deletions;if(c!==null)for(var d=0;d<c.length;d++){var m=c[d];try{var w=t,T=i,B=T;e:for(;B!==null;){switch(B.tag){case 5:hn=B.stateNode,oi=!1;break e;case 3:hn=B.stateNode.containerInfo,oi=!0;break e;case 4:hn=B.stateNode.containerInfo,oi=!0;break e}B=B.return}if(hn===null)throw Error(r(160));E0(w,T,m),hn=null,oi=!1;var $=m.alternate;$!==null&&($.return=null),m.return=null}catch(re){Lt(m,i,re)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)O0(i,t),i=i.sibling}function O0(t,i){var c=t.alternate,d=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(ai(i,t),Di(t),d&4){try{Nl(3,t,t.return),Wd(3,t)}catch(Le){Lt(t,t.return,Le)}try{Nl(5,t,t.return)}catch(Le){Lt(t,t.return,Le)}}break;case 1:ai(i,t),Di(t),d&512&&c!==null&&dc(c,c.return);break;case 5:if(ai(i,t),Di(t),d&512&&c!==null&&dc(c,c.return),t.flags&32){var m=t.stateNode;try{Hr(m,"")}catch(Le){Lt(t,t.return,Le)}}if(d&4&&(m=t.stateNode,m!=null)){var w=t.memoizedProps,T=c!==null?c.memoizedProps:w,B=t.type,$=t.updateQueue;if(t.updateQueue=null,$!==null)try{B==="input"&&w.type==="radio"&&w.name!=null&&Ln(m,w),mi(B,T);var re=mi(B,w);for(T=0;T<$.length;T+=2){var me=$[T],ve=$[T+1];me==="style"?Wi(m,ve):me==="dangerouslySetInnerHTML"?cn(m,ve):me==="children"?Hr(m,ve):ne(m,me,ve,re)}switch(B){case"input":mt(m,w);break;case"textarea":Jt(m,w);break;case"select":var pe=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!w.multiple;var Ae=w.value;Ae!=null?Ze(m,!!w.multiple,Ae,!1):pe!==!!w.multiple&&(w.defaultValue!=null?Ze(m,!!w.multiple,w.defaultValue,!0):Ze(m,!!w.multiple,w.multiple?[]:"",!1))}m[Zr]=w}catch(Le){Lt(t,t.return,Le)}}break;case 6:if(ai(i,t),Di(t),d&4){if(t.stateNode===null)throw Error(r(162));m=t.stateNode,w=t.memoizedProps;try{m.nodeValue=w}catch(Le){Lt(t,t.return,Le)}}break;case 3:if(ai(i,t),Di(t),d&4&&c!==null&&c.memoizedState.isDehydrated)try{Yi(i.containerInfo)}catch(Le){Lt(t,t.return,Le)}break;case 4:ai(i,t),Di(t);break;case 13:ai(i,t),Di(t),m=t.child,m.flags&8192&&(w=m.memoizedState!==null,m.stateNode.isHidden=w,!w||m.alternate!==null&&m.alternate.memoizedState!==null||(Xp=Et())),d&4&&M0(t);break;case 22:if(me=c!==null&&c.memoizedState!==null,t.mode&1?(An=(re=An)||me,ai(i,t),An=re):ai(i,t),Di(t),d&8192){if(re=t.memoizedState!==null,(t.stateNode.isHidden=re)&&!me&&(t.mode&1)!==0)for(Pe=t,me=t.child;me!==null;){for(ve=Pe=me;Pe!==null;){switch(pe=Pe,Ae=pe.child,pe.tag){case 0:case 11:case 14:case 15:Nl(4,pe,pe.return);break;case 1:dc(pe,pe.return);var Ie=pe.stateNode;if(typeof Ie.componentWillUnmount=="function"){d=pe,c=pe.return;try{i=d,Ie.props=i.memoizedProps,Ie.state=i.memoizedState,Ie.componentWillUnmount()}catch(Le){Lt(d,c,Le)}}break;case 5:dc(pe,pe.return);break;case 22:if(pe.memoizedState!==null){A0(ve);continue}}Ae!==null?(Ae.return=pe,Pe=Ae):A0(ve)}me=me.sibling}e:for(me=null,ve=t;;){if(ve.tag===5){if(me===null){me=ve;try{m=ve.stateNode,re?(w=m.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(B=ve.stateNode,$=ve.memoizedProps.style,T=$!=null&&$.hasOwnProperty("display")?$.display:null,B.style.display=Lo("display",T))}catch(Le){Lt(t,t.return,Le)}}}else if(ve.tag===6){if(me===null)try{ve.stateNode.nodeValue=re?"":ve.memoizedProps}catch(Le){Lt(t,t.return,Le)}}else if((ve.tag!==22&&ve.tag!==23||ve.memoizedState===null||ve===t)&&ve.child!==null){ve.child.return=ve,ve=ve.child;continue}if(ve===t)break e;for(;ve.sibling===null;){if(ve.return===null||ve.return===t)break e;me===ve&&(me=null),ve=ve.return}me===ve&&(me=null),ve.sibling.return=ve.return,ve=ve.sibling}}break;case 19:ai(i,t),Di(t),d&4&&M0(t);break;case 21:break;default:ai(i,t),Di(t)}}function Di(t){var i=t.flags;if(i&2){try{e:{for(var c=t.return;c!==null;){if(k0(c)){var d=c;break e}c=c.return}throw Error(r(160))}switch(d.tag){case 5:var m=d.stateNode;d.flags&32&&(Hr(m,""),d.flags&=-33);var w=C0(t);Qp(t,w,m);break;case 3:case 4:var T=d.stateNode.containerInfo,B=C0(t);Jp(t,B,T);break;default:throw Error(r(161))}}catch($){Lt(t,t.return,$)}t.flags&=-3}i&4096&&(t.flags&=-4097)}function aE(t,i,c){Pe=t,T0(t)}function T0(t,i,c){for(var d=(t.mode&1)!==0;Pe!==null;){var m=Pe,w=m.child;if(m.tag===22&&d){var T=m.memoizedState!==null||qd;if(!T){var B=m.alternate,$=B!==null&&B.memoizedState!==null||An;B=qd;var re=An;if(qd=T,(An=$)&&!re)for(Pe=m;Pe!==null;)T=Pe,$=T.child,T.tag===22&&T.memoizedState!==null?P0(m):$!==null?($.return=T,Pe=$):P0(m);for(;w!==null;)Pe=w,T0(w),w=w.sibling;Pe=m,qd=B,An=re}R0(t)}else(m.subtreeFlags&8772)!==0&&w!==null?(w.return=m,Pe=w):R0(t)}}function R0(t){for(;Pe!==null;){var i=Pe;if((i.flags&8772)!==0){var c=i.alternate;try{if((i.flags&8772)!==0)switch(i.tag){case 0:case 11:case 15:An||Wd(5,i);break;case 1:var d=i.stateNode;if(i.flags&4&&!An)if(c===null)d.componentDidMount();else{var m=i.elementType===i.type?c.memoizedProps:si(i.type,c.memoizedProps);d.componentDidUpdate(m,c.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var w=i.updateQueue;w!==null&&Q(i,w,d);break;case 3:var T=i.updateQueue;if(T!==null){if(c=null,i.child!==null)switch(i.child.tag){case 5:c=i.child.stateNode;break;case 1:c=i.child.stateNode}Q(i,T,c)}break;case 5:var B=i.stateNode;if(c===null&&i.flags&4){c=B;var $=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":$.autoFocus&&c.focus();break;case"img":$.src&&(c.src=$.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var re=i.alternate;if(re!==null){var me=re.memoizedState;if(me!==null){var ve=me.dehydrated;ve!==null&&Yi(ve)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}An||i.flags&512&&Gp(i)}catch(pe){Lt(i,i.return,pe)}}if(i===t){Pe=null;break}if(c=i.sibling,c!==null){c.return=i.return,Pe=c;break}Pe=i.return}}function A0(t){for(;Pe!==null;){var i=Pe;if(i===t){Pe=null;break}var c=i.sibling;if(c!==null){c.return=i.return,Pe=c;break}Pe=i.return}}function P0(t){for(;Pe!==null;){var i=Pe;try{switch(i.tag){case 0:case 11:case 15:var c=i.return;try{Wd(4,i)}catch($){Lt(i,c,$)}break;case 1:var d=i.stateNode;if(typeof d.componentDidMount=="function"){var m=i.return;try{d.componentDidMount()}catch($){Lt(i,m,$)}}var w=i.return;try{Gp(i)}catch($){Lt(i,w,$)}break;case 5:var T=i.return;try{Gp(i)}catch($){Lt(i,T,$)}}}catch($){Lt(i,i.return,$)}if(i===t){Pe=null;break}var B=i.sibling;if(B!==null){B.return=i.return,Pe=B;break}Pe=i.return}}var cE=Math.ceil,Hd=L.ReactCurrentDispatcher,Kp=L.ReactCurrentOwner,Dr=L.ReactCurrentBatchConfig,dt=0,sn=null,Wt=null,pn=0,_r=0,fc=ei(0),Xt=0,Dl=null,ca=0,Gd=0,Yp=0,Ul=null,or=null,Xp=0,hc=1/0,cs=null,Jd=!1,Zp=null,ro=null,Qd=!1,io=null,Kd=0,Bl=0,eg=null,Yd=-1,Xd=0;function Gn(){return(dt&6)!==0?Et():Yd!==-1?Yd:Yd=Et()}function so(t){return(t.mode&1)===0?1:(dt&2)!==0&&pn!==0?pn&-pn:Id.transition!==null?(Xd===0&&(Xd=As()),Xd):(t=we,t!==0||(t=window.event,t=t===void 0?16:$t(t.type)),t)}function ci(t,i,c,d){if(50<Bl)throw Bl=0,eg=null,Error(r(185));Gr(t,c,d),((dt&2)===0||t!==sn)&&(t===sn&&((dt&2)===0&&(Gd|=c),Xt===4&&oo(t,pn)),ar(t,d),c===1&&dt===0&&(i.mode&1)===0&&(hc=Et()+500,rc&&Lr()))}function ar(t,i){var c=t.callbackNode;Gc(t,i);var d=ki(t,t===sn?pn:0);if(d===0)c!==null&&hr(c),t.callbackNode=null,t.callbackPriority=0;else if(i=d&-d,t.callbackPriority!==i){if(c!=null&&hr(c),i===1)t.tag===0?Op(x0.bind(null,t)):Cl(x0.bind(null,t)),ta(function(){(dt&6)===0&&Lr()}),c=null;else{switch(Is(d)){case 1:c=wi;break;case 4:c=Os;break;case 16:c=Gi;break;case 536870912:c=Uo;break;default:c=Gi}c=V0(c,I0.bind(null,t))}t.callbackPriority=i,t.callbackNode=c}}function I0(t,i){if(Yd=-1,Xd=0,(dt&6)!==0)throw Error(r(327));var c=t.callbackNode;if(pc()&&t.callbackNode!==c)return null;var d=ki(t,t===sn?pn:0);if(d===0)return null;if((d&30)!==0||(d&t.expiredLanes)!==0||i)i=Zd(t,d);else{i=d;var m=dt;dt|=2;var w=j0();(sn!==t||pn!==i)&&(cs=null,hc=Et()+500,ua(t,i));do try{dE();break}catch(B){L0(t,B)}while(!0);Ol(),Hd.current=w,dt=m,Wt!==null?i=0:(sn=null,pn=0,i=Xt)}if(i!==0){if(i===2&&(m=Bo(t),m!==0&&(d=m,i=tg(t,m))),i===1)throw c=Dl,ua(t,0),oo(t,d),ar(t,Et()),c;if(i===6)oo(t,d);else{if(m=t.current.alternate,(d&30)===0&&!lE(m)&&(i=Zd(t,d),i===2&&(w=Bo(t),w!==0&&(d=w,i=tg(t,w))),i===1))throw c=Dl,ua(t,0),oo(t,d),ar(t,Et()),c;switch(t.finishedWork=m,t.finishedLanes=d,i){case 0:case 1:throw Error(r(345));case 2:da(t,or,cs);break;case 3:if(oo(t,d),(d&130023424)===d&&(i=Xp+500-Et(),10<i)){if(ki(t,0)!==0)break;if(m=t.suspendedLanes,(m&d)!==d){Gn(),t.pingedLanes|=t.suspendedLanes&m;break}t.timeoutHandle=En(da.bind(null,t,or,cs),i);break}da(t,or,cs);break;case 4:if(oo(t,d),(d&4194240)===d)break;for(i=t.eventTimes,m=-1;0<d;){var T=31-Un(d);w=1<<T,T=i[T],T>m&&(m=T),d&=~w}if(d=m,d=Et()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*cE(d/1960))-d,10<d){t.timeoutHandle=En(da.bind(null,t,or,cs),d);break}da(t,or,cs);break;case 5:da(t,or,cs);break;default:throw Error(r(329))}}}return ar(t,Et()),t.callbackNode===c?I0.bind(null,t):null}function tg(t,i){var c=Ul;return t.current.memoizedState.isDehydrated&&(ua(t,i).flags|=256),t=Zd(t,i),t!==2&&(i=or,or=c,i!==null&&ng(i)),t}function ng(t){or===null?or=t:or.push.apply(or,t)}function lE(t){for(var i=t;;){if(i.flags&16384){var c=i.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var d=0;d<c.length;d++){var m=c[d],w=m.getSnapshot;m=m.value;try{if(!gr(w(),m))return!1}catch{return!1}}}if(c=i.child,i.subtreeFlags&16384&&c!==null)c.return=i,i=c;else{if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function oo(t,i){for(i&=~Yp,i&=~Gd,t.suspendedLanes|=i,t.pingedLanes&=~i,t=t.expirationTimes;0<i;){var c=31-Un(i),d=1<<c;t[c]=-1,i&=~d}}function x0(t){if((dt&6)!==0)throw Error(r(327));pc();var i=ki(t,0);if((i&1)===0)return ar(t,Et()),null;var c=Zd(t,i);if(t.tag!==0&&c===2){var d=Bo(t);d!==0&&(i=d,c=tg(t,d))}if(c===1)throw c=Dl,ua(t,0),oo(t,i),ar(t,Et()),c;if(c===6)throw Error(r(345));return t.finishedWork=t.current.alternate,t.finishedLanes=i,da(t,or,cs),ar(t,Et()),null}function rg(t,i){var c=dt;dt|=1;try{return t(i)}finally{dt=c,dt===0&&(hc=Et()+500,rc&&Lr())}}function la(t){io!==null&&io.tag===0&&(dt&6)===0&&pc();var i=dt;dt|=1;var c=Dr.transition,d=we;try{if(Dr.transition=null,we=1,t)return t()}finally{we=d,Dr.transition=c,dt=i,(dt&6)===0&&Lr()}}function ig(){_r=fc.current,ct(fc)}function ua(t,i){t.finishedWork=null,t.finishedLanes=0;var c=t.timeoutHandle;if(c!==-1&&(t.timeoutHandle=-1,wl(c)),Wt!==null)for(c=Wt.return;c!==null;){var d=c;switch(ac(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&na();break;case 3:De(),ct(dn),ct(Kt),qt();break;case 5:ft(d);break;case 4:De();break;case 13:ct(We);break;case 19:ct(We);break;case 10:Tl(d.type._context);break;case 22:case 23:ig()}c=c.return}if(sn=t,Wt=t=ao(t.current,null),pn=_r=i,Xt=0,Dl=null,Yp=Gd=ca=0,or=Ul=null,xi!==null){for(i=0;i<xi.length;i++)if(c=xi[i],d=c.interleaved,d!==null){c.interleaved=null;var m=d.next,w=c.pending;if(w!==null){var T=w.next;w.next=m,d.next=T}c.pending=d}xi=null}return t}function L0(t,i){do{var c=Wt;try{if(Ol(),Li.current=Fd,Dd){for(var d=xt.memoizedState;d!==null;){var m=d.queue;m!==null&&(m.pending=null),d=d.next}Dd=!1}if(ii=0,rn=Yt=xt=null,Pl=!1,Il=0,Kp.current=null,c===null||c.return===null){Xt=1,Dl=i,Wt=null;break}e:{var w=t,T=c.return,B=c,$=i;if(i=pn,B.flags|=32768,$!==null&&typeof $=="object"&&typeof $.then=="function"){var re=$,me=B,ve=me.tag;if((me.mode&1)===0&&(ve===0||ve===11||ve===15)){var pe=me.alternate;pe?(me.updateQueue=pe.updateQueue,me.memoizedState=pe.memoizedState,me.lanes=pe.lanes):(me.updateQueue=null,me.memoizedState=null)}var Ae=s0(T);if(Ae!==null){Ae.flags&=-257,o0(Ae,T,B,w,i),Ae.mode&1&&i0(w,re,i),i=Ae,$=re;var Ie=i.updateQueue;if(Ie===null){var Le=new Set;Le.add($),i.updateQueue=Le}else Ie.add($);break e}else{if((i&1)===0){i0(w,re,i),sg();break e}$=Error(r(426))}}else if(Mt&&B.mode&1){var Ft=s0(T);if(Ft!==null){(Ft.flags&65536)===0&&(Ft.flags|=256),o0(Ft,T,B,w,i),ia(uc($,B));break e}}w=$=uc($,B),Xt!==4&&(Xt=2),Ul===null?Ul=[w]:Ul.push(w),w=T;do{switch(w.tag){case 3:w.flags|=65536,i&=-i,w.lanes|=i;var Z=n0(w,$,i);U(w,Z);break e;case 1:B=$;var W=w.type,ee=w.stateNode;if((w.flags&128)===0&&(typeof W.getDerivedStateFromError=="function"||ee!==null&&typeof ee.componentDidCatch=="function"&&(ro===null||!ro.has(ee)))){w.flags|=65536,i&=-i,w.lanes|=i;var ke=r0(w,B,i);U(w,ke);break e}}w=w.return}while(w!==null)}D0(c)}catch(je){i=je,Wt===c&&c!==null&&(Wt=c=c.return);continue}break}while(!0)}function j0(){var t=Hd.current;return Hd.current=Fd,t===null?Fd:t}function sg(){(Xt===0||Xt===3||Xt===2)&&(Xt=4),sn===null||(ca&268435455)===0&&(Gd&268435455)===0||oo(sn,pn)}function Zd(t,i){var c=dt;dt|=2;var d=j0();(sn!==t||pn!==i)&&(cs=null,ua(t,i));do try{uE();break}catch(m){L0(t,m)}while(!0);if(Ol(),dt=c,Hd.current=d,Wt!==null)throw Error(r(261));return sn=null,pn=0,Xt}function uE(){for(;Wt!==null;)N0(Wt)}function dE(){for(;Wt!==null&&!Ba();)N0(Wt)}function N0(t){var i=F0(t.alternate,t,_r);t.memoizedProps=t.pendingProps,i===null?D0(t):Wt=i,Kp.current=null}function D0(t){var i=t;do{var c=i.alternate;if(t=i.return,(i.flags&32768)===0){if(c=rE(c,i,_r),c!==null){Wt=c;return}}else{if(c=iE(c,i),c!==null){c.flags&=32767,Wt=c;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Xt=6,Wt=null;return}}if(i=i.sibling,i!==null){Wt=i;return}Wt=i=t}while(i!==null);Xt===0&&(Xt=5)}function da(t,i,c){var d=we,m=Dr.transition;try{Dr.transition=null,we=1,fE(t,i,c,d)}finally{Dr.transition=m,we=d}return null}function fE(t,i,c,d){do pc();while(io!==null);if((dt&6)!==0)throw Error(r(327));c=t.finishedWork;var m=t.finishedLanes;if(c===null)return null;if(t.finishedWork=null,t.finishedLanes=0,c===t.current)throw Error(r(177));t.callbackNode=null,t.callbackPriority=0;var w=c.lanes|c.childLanes;if(Jc(t,w),t===sn&&(Wt=sn=null,pn=0),(c.subtreeFlags&2064)===0&&(c.flags&2064)===0||Qd||(Qd=!0,V0(Gi,function(){return pc(),null})),w=(c.flags&15990)!==0,(c.subtreeFlags&15990)!==0||w){w=Dr.transition,Dr.transition=null;var T=we;we=1;var B=dt;dt|=4,Kp.current=null,oE(t,c),O0(c,t),dl(Ya),te=!!yl,Ya=yl=null,t.current=c,aE(c),Ot(),dt=B,we=T,Dr.transition=w}else t.current=c;if(Qd&&(Qd=!1,io=t,Kd=m),w=t.pendingLanes,w===0&&(ro=null),Fa(c.stateNode),ar(t,Et()),i!==null)for(d=t.onRecoverableError,c=0;c<i.length;c++)m=i[c],d(m.value,{componentStack:m.stack,digest:m.digest});if(Jd)throw Jd=!1,t=Zp,Zp=null,t;return(Kd&1)!==0&&t.tag!==0&&pc(),w=t.pendingLanes,(w&1)!==0?t===eg?Bl++:(Bl=0,eg=t):Bl=0,Lr(),null}function pc(){if(io!==null){var t=Is(Kd),i=Dr.transition,c=we;try{if(Dr.transition=null,we=16>t?16:t,io===null)var d=!1;else{if(t=io,io=null,Kd=0,(dt&6)!==0)throw Error(r(331));var m=dt;for(dt|=4,Pe=t.current;Pe!==null;){var w=Pe,T=w.child;if((Pe.flags&16)!==0){var B=w.deletions;if(B!==null){for(var $=0;$<B.length;$++){var re=B[$];for(Pe=re;Pe!==null;){var me=Pe;switch(me.tag){case 0:case 11:case 15:Nl(8,me,w)}var ve=me.child;if(ve!==null)ve.return=me,Pe=ve;else for(;Pe!==null;){me=Pe;var pe=me.sibling,Ae=me.return;if(S0(me),me===re){Pe=null;break}if(pe!==null){pe.return=Ae,Pe=pe;break}Pe=Ae}}}var Ie=w.alternate;if(Ie!==null){var Le=Ie.child;if(Le!==null){Ie.child=null;do{var Ft=Le.sibling;Le.sibling=null,Le=Ft}while(Le!==null)}}Pe=w}}if((w.subtreeFlags&2064)!==0&&T!==null)T.return=w,Pe=T;else e:for(;Pe!==null;){if(w=Pe,(w.flags&2048)!==0)switch(w.tag){case 0:case 11:case 15:Nl(9,w,w.return)}var Z=w.sibling;if(Z!==null){Z.return=w.return,Pe=Z;break e}Pe=w.return}}var W=t.current;for(Pe=W;Pe!==null;){T=Pe;var ee=T.child;if((T.subtreeFlags&2064)!==0&&ee!==null)ee.return=T,Pe=ee;else e:for(T=W;Pe!==null;){if(B=Pe,(B.flags&2048)!==0)try{switch(B.tag){case 0:case 11:case 15:Wd(9,B)}}catch(je){Lt(B,B.return,je)}if(B===T){Pe=null;break e}var ke=B.sibling;if(ke!==null){ke.return=B.return,Pe=ke;break e}Pe=B.return}}if(dt=m,Lr(),Dn&&typeof Dn.onPostCommitFiberRoot=="function")try{Dn.onPostCommitFiberRoot(bi,t)}catch{}d=!0}return d}finally{we=c,Dr.transition=i}}return!1}function U0(t,i,c){i=uc(c,i),i=n0(t,i,1),t=S(t,i,1),i=Gn(),t!==null&&(Gr(t,1,i),ar(t,i))}function Lt(t,i,c){if(t.tag===3)U0(t,t,c);else for(;i!==null;){if(i.tag===3){U0(i,t,c);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(ro===null||!ro.has(d))){t=uc(c,t),t=r0(i,t,1),i=S(i,t,1),t=Gn(),i!==null&&(Gr(i,1,t),ar(i,t));break}}i=i.return}}function hE(t,i,c){var d=t.pingCache;d!==null&&d.delete(i),i=Gn(),t.pingedLanes|=t.suspendedLanes&c,sn===t&&(pn&c)===c&&(Xt===4||Xt===3&&(pn&130023424)===pn&&500>Et()-Xp?ua(t,0):Yp|=c),ar(t,i)}function B0(t,i){i===0&&((t.mode&1)===0?i=1:(i=Rs,Rs<<=1,(Rs&130023424)===0&&(Rs=4194304)));var c=Gn();t=s(t,i),t!==null&&(Gr(t,i,c),ar(t,c))}function pE(t){var i=t.memoizedState,c=0;i!==null&&(c=i.retryLane),B0(t,c)}function gE(t,i){var c=0;switch(t.tag){case 13:var d=t.stateNode,m=t.memoizedState;m!==null&&(c=m.retryLane);break;case 19:d=t.stateNode;break;default:throw Error(r(314))}d!==null&&d.delete(i),B0(t,c)}var F0;F0=function(t,i,c){if(t!==null)if(t.memoizedProps!==i.pendingProps||dn.current)sr=!0;else{if((t.lanes&c)===0&&(i.flags&128)===0)return sr=!1,nE(t,i,c);sr=(t.flags&131072)!==0}else sr=!1,Mt&&(i.flags&1048576)!==0&&Rd(i,sc,i.index);switch(i.lanes=0,i.tag){case 2:var d=i.type;$d(t,i),t=i.pendingProps;var m=vr(i,Kt.current);to(i,c),m=Rp(null,i,d,t,m,c);var w=Ap();return i.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,On(d)?(w=!0,nc(i)):w=!1,i.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,u(i),m.updater=Vd,i.stateNode=m,m._reactInternals=i,Np(i,d,t,c),i=Fp(null,i,d,!0,w,c)):(i.tag=0,Mt&&w&&oc(i),Hn(null,i,m,c),i=i.child),i;case 16:d=i.elementType;e:{switch($d(t,i),t=i.pendingProps,m=d._init,d=m(d._payload),i.type=d,m=i.tag=vE(d),t=si(d,t),m){case 0:i=Bp(null,i,d,t,c);break e;case 1:i=f0(null,i,d,t,c);break e;case 11:i=a0(null,i,d,t,c);break e;case 14:i=c0(null,i,d,si(d.type,t),c);break e}throw Error(r(306,d,""))}return i;case 0:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:si(d,m),Bp(t,i,d,m,c);case 1:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:si(d,m),f0(t,i,d,m,c);case 3:e:{if(h0(i),t===null)throw Error(r(387));d=i.pendingProps,w=i.memoizedState,m=w.element,p(t,i),X(i,d,null,c);var T=i.memoizedState;if(d=T.element,w.isDehydrated)if(w={element:d,isDehydrated:!1,cache:T.cache,pendingSuspenseBoundaries:T.pendingSuspenseBoundaries,transitions:T.transitions},i.updateQueue.baseState=w,i.memoizedState=w,i.flags&256){m=uc(Error(r(423)),i),i=p0(t,i,d,c,m);break e}else if(d!==m){m=uc(Error(r(424)),i),i=p0(t,i,d,c,m);break e}else for(Wn=Xr(i.stateNode.containerInfo.firstChild),qn=i,Mt=!0,yr=null,c=jd(i,null,d,c),i.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Zs(),d===m){i=as(t,i,c);break e}Hn(t,i,d,c)}i=i.child}return i;case 5:return lt(i),t===null&&Ml(i),d=i.type,m=i.pendingProps,w=t!==null?t.memoizedProps:null,T=m.children,_l(d,m)?T=null:w!==null&&_l(d,w)&&(i.flags|=32),d0(t,i),Hn(t,i,T,c),i.child;case 6:return t===null&&Ml(i),null;case 13:return g0(t,i,c);case 4:return Re(i,i.stateNode.containerInfo),d=i.pendingProps,t===null?i.child=eo(i,null,d,c):Hn(t,i,d,c),i.child;case 11:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:si(d,m),a0(t,i,d,m,c);case 7:return Hn(t,i,i.pendingProps,c),i.child;case 8:return Hn(t,i,i.pendingProps.children,c),i.child;case 12:return Hn(t,i,i.pendingProps.children,c),i.child;case 10:e:{if(d=i.type._context,m=i.pendingProps,w=i.memoizedProps,T=m.value,vt(oa,d._currentValue),d._currentValue=T,w!==null)if(gr(w.value,T)){if(w.children===m.children&&!dn.current){i=as(t,i,c);break e}}else for(w=i.child,w!==null&&(w.return=i);w!==null;){var B=w.dependencies;if(B!==null){T=w.child;for(var $=B.firstContext;$!==null;){if($.context===d){if(w.tag===1){$=_(-1,c&-c),$.tag=2;var re=w.updateQueue;if(re!==null){re=re.shared;var me=re.pending;me===null?$.next=$:($.next=me.next,me.next=$),re.pending=$}}w.lanes|=c,$=w.alternate,$!==null&&($.lanes|=c),Rl(w.return,c,i),B.lanes|=c;break}$=$.next}}else if(w.tag===10)T=w.type===i.type?null:w.child;else if(w.tag===18){if(T=w.return,T===null)throw Error(r(341));T.lanes|=c,B=T.alternate,B!==null&&(B.lanes|=c),Rl(T,c,i),T=w.sibling}else T=w.child;if(T!==null)T.return=w;else for(T=w;T!==null;){if(T===i){T=null;break}if(w=T.sibling,w!==null){w.return=T.return,T=w;break}T=T.return}w=T}Hn(t,i,m.children,c),i=i.child}return i;case 9:return m=i.type,d=i.pendingProps.children,to(i,c),m=ir(m),d=d(m),i.flags|=1,Hn(t,i,d,c),i.child;case 14:return d=i.type,m=si(d,i.pendingProps),m=si(d.type,m),c0(t,i,d,m,c);case 15:return l0(t,i,i.type,i.pendingProps,c);case 17:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:si(d,m),$d(t,i),i.tag=1,On(d)?(t=!0,nc(i)):t=!1,to(i,c),e0(i,d,m),Np(i,d,m,c),Fp(null,i,d,!0,t,c);case 19:return v0(t,i,c);case 22:return u0(t,i,c)}throw Error(r(156,i.tag))};function V0(t,i){return Ua(t,i)}function mE(t,i,c,d){this.tag=t,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ur(t,i,c,d){return new mE(t,i,c,d)}function og(t){return t=t.prototype,!(!t||!t.isReactComponent)}function vE(t){if(typeof t=="function")return og(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ze)return 11;if(t===Ue)return 14}return 2}function ao(t,i){var c=t.alternate;return c===null?(c=Ur(t.tag,i,t.key,t.mode),c.elementType=t.elementType,c.type=t.type,c.stateNode=t.stateNode,c.alternate=t,t.alternate=c):(c.pendingProps=i,c.type=t.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=t.flags&14680064,c.childLanes=t.childLanes,c.lanes=t.lanes,c.child=t.child,c.memoizedProps=t.memoizedProps,c.memoizedState=t.memoizedState,c.updateQueue=t.updateQueue,i=t.dependencies,c.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},c.sibling=t.sibling,c.index=t.index,c.ref=t.ref,c}function ef(t,i,c,d,m,w){var T=2;if(d=t,typeof t=="function")og(t)&&(T=1);else if(typeof t=="string")T=5;else e:switch(t){case ae:return fa(c.children,m,w,i);case ye:T=8,m|=8;break;case Ee:return t=Ur(12,c,i,m|2),t.elementType=Ee,t.lanes=w,t;case Me:return t=Ur(13,c,i,m),t.elementType=Me,t.lanes=w,t;case K:return t=Ur(19,c,i,m),t.elementType=K,t.lanes=w,t;case be:return tf(c,m,w,i);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Ve:T=10;break e;case k:T=9;break e;case ze:T=11;break e;case Ue:T=14;break e;case it:T=16,d=null;break e}throw Error(r(130,t==null?t:typeof t,""))}return i=Ur(T,c,i,m),i.elementType=t,i.type=d,i.lanes=w,i}function fa(t,i,c,d){return t=Ur(7,t,d,i),t.lanes=c,t}function tf(t,i,c,d){return t=Ur(22,t,d,i),t.elementType=be,t.lanes=c,t.stateNode={isHidden:!1},t}function ag(t,i,c){return t=Ur(6,t,null,i),t.lanes=c,t}function cg(t,i,c){return i=Ur(4,t.children!==null?t.children:[],t.key,i),i.lanes=c,i.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},i}function yE(t,i,c,d,m){this.tag=i,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ps(0),this.expirationTimes=Ps(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ps(0),this.identifierPrefix=d,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function lg(t,i,c,d,m,w,T,B,$){return t=new yE(t,i,c,B,$),i===1?(i=1,w===!0&&(i|=8)):i=0,w=Ur(3,null,null,i),t.current=w,w.stateNode=t,w.memoizedState={element:d,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},u(w),t}function _E(t,i,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:H,key:d==null?null:""+d,children:t,containerInfo:i,implementation:c}}function z0(t){if(!t)return er;t=t._reactInternals;e:{if(Tr(t)!==t||t.tag!==1)throw Error(r(170));var i=t;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(On(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(r(171))}if(t.tag===1){var c=t.type;if(On(c))return Od(t,c,i)}return i}function $0(t,i,c,d,m,w,T,B,$){return t=lg(c,d,!0,t,m,w,T,B,$),t.context=z0(null),c=t.current,d=Gn(),m=so(c),w=_(d,m),w.callback=i??null,S(c,w,m),t.current.lanes=m,Gr(t,m,d),ar(t,d),t}function nf(t,i,c,d){var m=i.current,w=Gn(),T=so(m);return c=z0(c),i.context===null?i.context=c:i.pendingContext=c,i=_(w,T),i.payload={element:t},d=d===void 0?null:d,d!==null&&(i.callback=d),t=S(m,i,T),t!==null&&(ci(t,m,T,w),P(t,m,T)),T}function rf(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function q0(t,i){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var c=t.retryLane;t.retryLane=c!==0&&c<i?c:i}}function ug(t,i){q0(t,i),(t=t.alternate)&&q0(t,i)}function wE(){return null}var W0=typeof reportError=="function"?reportError:function(t){console.error(t)};function dg(t){this._internalRoot=t}sf.prototype.render=dg.prototype.render=function(t){var i=this._internalRoot;if(i===null)throw Error(r(409));nf(t,i,null,null)},sf.prototype.unmount=dg.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var i=t.containerInfo;la(function(){nf(null,t,null,null)}),i[mr]=null}};function sf(t){this._internalRoot=t}sf.prototype.unstable_scheduleHydration=function(t){if(t){var i=za();t={blockedOn:null,target:t,priority:i};for(var c=0;c<Fn.length&&i!==0&&i<Fn[c].priority;c++);Fn.splice(c,0,t),c===0&&qo(t)}};function fg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function of(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function H0(){}function bE(t,i,c,d,m){if(m){if(typeof d=="function"){var w=d;d=function(){var re=rf(T);w.call(re)}}var T=$0(i,d,t,0,null,!1,!1,"",H0);return t._reactRootContainer=T,t[mr]=T.current,Zo(t.nodeType===8?t.parentNode:t),la(),T}for(;m=t.lastChild;)t.removeChild(m);if(typeof d=="function"){var B=d;d=function(){var re=rf($);B.call(re)}}var $=lg(t,0,!1,null,null,!1,!1,"",H0);return t._reactRootContainer=$,t[mr]=$.current,Zo(t.nodeType===8?t.parentNode:t),la(function(){nf(i,$,c,d)}),$}function af(t,i,c,d,m){var w=c._reactRootContainer;if(w){var T=w;if(typeof m=="function"){var B=m;m=function(){var $=rf(T);B.call($)}}nf(i,T,t,m)}else T=bE(c,i,t,m,d);return rf(T)}Tt=function(t){switch(t.tag){case 3:var i=t.stateNode;if(i.current.memoizedState.isDehydrated){var c=ln(i.pendingLanes);c!==0&&(St(i,c|1),ar(i,Et()),(dt&6)===0&&(hc=Et()+500,Lr()))}break;case 13:la(function(){var d=s(t,1);if(d!==null){var m=Gn();ci(d,t,1,m)}}),ug(t,1)}},Fo=function(t){if(t.tag===13){var i=s(t,134217728);if(i!==null){var c=Gn();ci(i,t,134217728,c)}ug(t,134217728)}},Vo=function(t){if(t.tag===13){var i=so(t),c=s(t,i);if(c!==null){var d=Gn();ci(c,t,i,d)}ug(t,i)}},za=function(){return we},zo=function(t,i){var c=we;try{return we=t,i()}finally{we=c}},Or=function(t,i,c){switch(i){case"input":if(mt(t,c),i=c.name,c.type==="radio"&&i!=null){for(c=t;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<c.length;i++){var d=c[i];if(d!==t&&d.form===t.form){var m=ec(d);if(!m)throw Error(r(90));$e(d),mt(d,m)}}}break;case"textarea":Jt(t,c);break;case"select":i=c.value,i!=null&&Ze(t,!!c.multiple,i,!1)}},La=rg,ja=la;var SE={usingClientEntryPoint:!1,Events:[Ai,Js,ec,xa,Sn,rg]},Fl={findFiberByHostInstance:nn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},kE={bundleType:Fl.bundleType,version:Fl.version,rendererPackageName:Fl.rendererPackageName,rendererConfig:Fl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:L.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=qe(t),t===null?null:t.stateNode},findFiberByHostInstance:Fl.findFiberByHostInstance||wE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var cf=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!cf.isDisabled&&cf.supportsFiber)try{bi=cf.inject(kE),Dn=cf}catch{}}return Jn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=SE,Jn.createPortal=function(t,i){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!fg(i))throw Error(r(200));return _E(t,i,null,c)},Jn.createRoot=function(t,i){if(!fg(t))throw Error(r(299));var c=!1,d="",m=W0;return i!=null&&(i.unstable_strictMode===!0&&(c=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onRecoverableError!==void 0&&(m=i.onRecoverableError)),i=lg(t,1,!1,null,null,c,!1,d,m),t[mr]=i.current,Zo(t.nodeType===8?t.parentNode:t),new dg(i)},Jn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var i=t._reactInternals;if(i===void 0)throw typeof t.render=="function"?Error(r(188)):(t=Object.keys(t).join(","),Error(r(268,t)));return t=qe(i),t=t===null?null:t.stateNode,t},Jn.flushSync=function(t){return la(t)},Jn.hydrate=function(t,i,c){if(!of(i))throw Error(r(200));return af(null,t,i,!0,c)},Jn.hydrateRoot=function(t,i,c){if(!fg(t))throw Error(r(405));var d=c!=null&&c.hydratedSources||null,m=!1,w="",T=W0;if(c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(w=c.identifierPrefix),c.onRecoverableError!==void 0&&(T=c.onRecoverableError)),i=$0(i,null,t,1,c??null,m,!1,w,T),t[mr]=i.current,Zo(t),d)for(t=0;t<d.length;t++)c=d[t],m=c._getVersion,m=m(c._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[c,m]:i.mutableSourceEagerHydrationData.push(c,m);return new sf(i)},Jn.render=function(t,i,c){if(!of(i))throw Error(r(200));return af(null,t,i,!1,c)},Jn.unmountComponentAtNode=function(t){if(!of(t))throw Error(r(40));return t._reactRootContainer?(la(function(){af(null,null,t,!1,function(){t._reactRootContainer=null,t[mr]=null})}),!0):!1},Jn.unstable_batchedUpdates=rg,Jn.unstable_renderSubtreeIntoContainer=function(t,i,c,d){if(!of(c))throw Error(r(200));if(t==null||t._reactInternals===void 0)throw Error(r(38));return af(t,i,c,!1,d)},Jn.version="18.3.1-next-f1338f8080-20240426",Jn}var Ag;function sw(){if(Ag)return hf.exports;Ag=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),hf.exports=iw(),hf.exports}var Pg;function ow(){if(Pg)return Wl;Pg=1;var n=sw();return Wl.createRoot=n.createRoot,Wl.hydrateRoot=n.hydrateRoot,Wl}var aw=ow();const cw=Sg(aw),lw="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let mf=(n=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=lw[r[n]&63];return e};const ha={};function Ig(n){return"init"in n}function vf(n){return!!n.write}function xg(n){return"v"in n||"e"in n}function Hl(n){if("e"in n)throw n.e;if((ha?"production":void 0)!=="production"&&!("v"in n))throw new Error("[Bug] atom state is not initialized");return n.v}const Gl=new WeakMap;function Lg(n){var e;return Jl(n)&&!!((e=Gl.get(n))!=null&&e[0])}function uw(n){const e=Gl.get(n);e?.[0]&&(e[0]=!1,e[1].forEach(r=>r()))}function yf(n,e){let r=Gl.get(n);if(!r){r=[!0,new Set],Gl.set(n,r);const a=()=>{r[0]=!1};n.then(a,a)}r[1].add(e)}function Jl(n){return typeof n?.then=="function"}function jg(n,e,r){if(!r.p.has(n)){r.p.add(n);const a=()=>r.p.delete(n);e.then(a,a)}}function Ng(n,e,r){var a;const l=new Set;for(const f of((a=r.get(n))==null?void 0:a.t)||[])r.has(f)&&l.add(f);for(const f of e.p)l.add(f);return l}const dw=(n,e,...r)=>e.read(...r),fw=(n,e,...r)=>e.write(...r),hw=(n,e)=>{var r;return(r=e.unstable_onInit)==null?void 0:r.call(e,n)},pw=(n,e,r)=>{var a;return(a=e.onMount)==null?void 0:a.call(e,r)},gw=(n,e)=>{const r=gn(n),a=r[0],l=r[9];if((ha?"production":void 0)!=="production"&&!e)throw new Error("Atom is undefined or null");let f=a.get(e);return f||(f={d:new Map,p:new Set,n:0},a.set(e,f),l?.(n,e)),f},mw=n=>{const e=gn(n),r=e[1],a=e[3],l=e[4],f=e[5],h=e[6],v=e[13],y=[],b=E=>{try{E()}catch(O){y.push(O)}};do{h.f&&b(h.f);const E=new Set,O=E.add.bind(E);a.forEach(j=>{var I;return(I=r.get(j))==null?void 0:I.l.forEach(O)}),a.clear(),f.forEach(O),f.clear(),l.forEach(O),l.clear(),E.forEach(b),a.size&&v(n)}while(a.size||f.size||l.size);if(y.length)throw new AggregateError(y)},vw=n=>{const e=gn(n),r=e[1],a=e[2],l=e[3],f=e[11],h=e[14],v=e[17],y=[],b=new WeakSet,E=new WeakSet,O=Array.from(l);for(;O.length;){const j=O[O.length-1],I=f(n,j);if(E.has(j)){O.pop();continue}if(b.has(j)){if(a.get(j)===I.n)y.push([j,I]);else if((ha?"production":void 0)!=="production"&&a.has(j))throw new Error("[Bug] invalidated atom exists");E.add(j),O.pop();continue}b.add(j);for(const A of Ng(j,I,r))b.has(A)||O.push(A)}for(let j=y.length-1;j>=0;--j){const[I,A]=y[j];let R=!1;for(const D of A.d.keys())if(D!==I&&l.has(D)){R=!0;break}R&&(h(n,I),v(n,I)),a.delete(I)}},yw=(n,e)=>{var r,a;const l=gn(n),f=l[1],h=l[2],v=l[3],y=l[6],b=l[7],E=l[11],O=l[12],j=l[13],I=l[14],A=l[16],R=l[17],D=E(n,e);if(xg(D)&&(f.has(e)&&h.get(e)!==D.n||Array.from(D.d).every(([ye,Ee])=>I(n,ye).n===Ee)))return D;D.d.clear();let V=!0;function Y(){f.has(e)&&(R(n,e),j(n),O(n))}function ne(ye){var Ee;if(ye===e){const k=E(n,ye);if(!xg(k))if(Ig(ye))Ql(n,ye,ye.init);else throw new Error("no atom init");return Hl(k)}const Ve=I(n,ye);try{return Hl(Ve)}finally{D.d.set(ye,Ve.n),Lg(D.v)&&jg(e,D.v,Ve),(Ee=f.get(ye))==null||Ee.t.add(e),V||Y()}}let L,q;const H={get signal(){return L||(L=new AbortController),L.signal},get setSelf(){return(ha?"production":void 0)!=="production"&&!vf(e)&&console.warn("setSelf function cannot be used with read-only atom"),!q&&vf(e)&&(q=(...ye)=>{if((ha?"production":void 0)!=="production"&&V&&console.warn("setSelf function cannot be called in sync"),!V)try{return A(n,e,...ye)}finally{j(n),O(n)}}),q}},ae=D.n;try{const ye=b(n,e,ne,H);return Ql(n,e,ye),Jl(ye)&&(yf(ye,()=>L?.abort()),ye.then(Y,Y)),(r=y.r)==null||r.call(y,e),D}catch(ye){return delete D.v,D.e=ye,++D.n,D}finally{V=!1,ae!==D.n&&h.get(e)===ae&&(h.set(e,D.n),v.add(e),(a=y.c)==null||a.call(y,e))}},_w=(n,e)=>{const r=gn(n),a=r[1],l=r[2],f=r[11],h=[e];for(;h.length;){const v=h.pop(),y=f(n,v);for(const b of Ng(v,y,a)){const E=f(n,b);l.set(b,E.n),h.push(b)}}},Dg=(n,e,...r)=>{const a=gn(n),l=a[3],f=a[6],h=a[8],v=a[11],y=a[12],b=a[13],E=a[14],O=a[15],j=a[17];let I=!0;const A=D=>Hl(E(n,D)),R=(D,...V)=>{var Y;const ne=v(n,D);try{if(D===e){if(!Ig(D))throw new Error("atom not writable");const L=ne.n,q=V[0];Ql(n,D,q),j(n,D),L!==ne.n&&(l.add(D),(Y=f.c)==null||Y.call(f,D),O(n,D));return}else return Dg(n,D,...V)}finally{I||(b(n),y(n))}};try{return h(n,e,A,R,...r)}finally{I=!1}},ww=(n,e)=>{var r;const a=gn(n),l=a[1],f=a[3],h=a[6],v=a[11],y=a[15],b=a[18],E=a[19],O=v(n,e),j=l.get(e);if(j&&!Lg(O.v)){for(const[I,A]of O.d)if(!j.d.has(I)){const R=v(n,I);b(n,I).t.add(e),j.d.add(I),A!==R.n&&(f.add(I),(r=h.c)==null||r.call(h,I),y(n,I))}for(const I of j.d||[])if(!O.d.has(I)){j.d.delete(I);const A=E(n,I);A?.t.delete(e)}}},Ug=(n,e)=>{var r;const a=gn(n),l=a[1],f=a[4],h=a[6],v=a[10],y=a[11],b=a[12],E=a[13],O=a[14],j=a[16],I=y(n,e);let A=l.get(e);if(!A){O(n,e);for(const R of I.d.keys())Ug(n,R).t.add(e);if(A={l:new Set,d:new Set(I.d.keys()),t:new Set},l.set(e,A),(r=h.m)==null||r.call(h,e),vf(e)){const R=()=>{let D=!0;const V=(...Y)=>{try{return j(n,e,...Y)}finally{D||(E(n),b(n))}};try{const Y=v(n,e,V);Y&&(A.u=()=>{D=!0;try{Y()}finally{D=!1}})}finally{D=!1}};f.add(R)}}return A},bw=(n,e)=>{var r;const a=gn(n),l=a[1],f=a[5],h=a[6],v=a[11],y=a[19],b=v(n,e);let E=l.get(e);if(E&&!E.l.size&&!Array.from(E.t).some(O=>{var j;return(j=l.get(O))==null?void 0:j.d.has(e)})){E.u&&f.add(E.u),E=void 0,l.delete(e),(r=h.u)==null||r.call(h,e);for(const O of b.d.keys()){const j=y(n,O);j?.t.delete(e)}return}return E},Ql=(n,e,r)=>{const a=gn(n)[11],l=a(n,e),f="v"in l,h=l.v;if(Jl(r))for(const v of l.d.keys())jg(e,r,a(n,v));l.v=r,delete l.e,(!f||!Object.is(h,l.v))&&(++l.n,Jl(h)&&uw(h))},Sw=(n,e)=>{const r=gn(n)[14];return Hl(r(n,e))},kw=(n,e,...r)=>{const a=gn(n),l=a[12],f=a[13],h=a[16];try{return h(n,e,...r)}finally{f(n),l(n)}},Cw=(n,e,r)=>{const a=gn(n),l=a[12],f=a[18],h=a[19],y=f(n,e).l;return y.add(r),l(n),()=>{y.delete(r),h(n,e),l(n)}},Bg=new WeakMap,gn=n=>{const e=Bg.get(n);if((ha?"production":void 0)!=="production"&&!e)throw new Error("Store must be created by buildStore to read its building blocks");return e};function Ew(...n){const e={get(a){const l=gn(e)[21];return l(e,a)},set(a,...l){const f=gn(e)[22];return f(e,a,...l)},sub(a,l){const f=gn(e)[23];return f(e,a,l)}},r=[new WeakMap,new WeakMap,new WeakMap,new Set,new Set,new Set,{},dw,fw,hw,pw,gw,mw,vw,yw,_w,Dg,ww,Ug,bw,Ql,Sw,kw,Cw,void 0].map((a,l)=>n[l]||a);return Bg.set(e,Object.freeze(r)),e}const Fg={};let Mw=0;function st(n,e){const r=`atom${++Mw}`,a={toString(){return(Fg?"production":void 0)!=="production"&&this.debugLabel?r+":"+this.debugLabel:r}};return typeof n=="function"?a.read=n:(a.init=n,a.read=Ow,a.write=Tw),e&&(a.write=e),a}function Ow(n){return n(this)}function Tw(n,e,r){return e(this,typeof r=="function"?r(n(this)):r)}function Vg(){return Ew()}let _c;function Rw(){return _c||(_c=Vg(),(Fg?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=_c),globalThis.__JOTAI_DEFAULT_STORE__!==_c&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),_c}const Aw={};function wc(n,e){let r=null;const a=new Map,l=new Set,f=v=>{let y;if(y=a.get(v),y!==void 0)if(r?.(y[1],v))f.remove(v);else return y[0];const b=n(v);return a.set(v,[b,Date.now()]),h("CREATE",v,b),b},h=(v,y,b)=>{for(const E of l)E({type:v,param:y,atom:b})};return f.unstable_listen=v=>(l.add(v),()=>{l.delete(v)}),f.getParams=()=>a.keys(),f.remove=v=>{{if(!a.has(v))return;const[y]=a.get(v);a.delete(v),h("REMOVE",v,y)}},f.setShouldRemove=v=>{if(r=v,!!r)for(const[y,[b,E]]of a)r(E,y)&&(a.delete(y),h("REMOVE",y,b))},f}const Pw=n=>typeof n?.then=="function";function Iw(n=()=>{try{return window.localStorage}catch(r){(Aw?"production":void 0)!=="production"&&typeof window<"u"&&console.warn(r);return}},e){var r;let a,l;const f={getItem:(y,b)=>{var E,O;const j=A=>{if(A=A||"",a!==A){try{l=JSON.parse(A,e?.reviver)}catch{return b}a=A}return l},I=(O=(E=n())==null?void 0:E.getItem(y))!=null?O:null;return Pw(I)?I.then(j):j(I)},setItem:(y,b)=>{var E;return(E=n())==null?void 0:E.setItem(y,JSON.stringify(b,void 0))},removeItem:y=>{var b;return(b=n())==null?void 0:b.removeItem(y)}},h=y=>(b,E,O)=>y(b,j=>{let I;try{I=JSON.parse(j||"")}catch{I=O}E(I)});let v;try{v=(r=n())==null?void 0:r.subscribe}catch{}return!v&&typeof window<"u"&&typeof window.addEventListener=="function"&&window.Storage&&(v=(y,b)=>{if(!(n()instanceof window.Storage))return()=>{};const E=O=>{O.storageArea===n()&&O.key===y&&b(O.newValue)};return window.addEventListener("storage",E),()=>{window.removeEventListener("storage",E)}}),v&&(f.subscribe=h(v)),f}Iw();const xw={},zg=z.createContext(void 0);function $g(n){return z.useContext(zg)||Rw()}function Lw({children:n,store:e}){const r=z.useRef(void 0);return!e&&!r.current&&(r.current=Vg()),z.createElement(zg.Provider,{value:e||r.current},n)}const _f=n=>typeof n?.then=="function",wf=n=>{n.status||(n.status="pending",n.then(e=>{n.status="fulfilled",n.value=e},e=>{n.status="rejected",n.reason=e}))},jw=et.use||(n=>{if(n.status==="pending")throw n;if(n.status==="fulfilled")return n.value;throw n.status==="rejected"?n.reason:(wf(n),n)}),bf=new WeakMap,qg=(n,e)=>{let r=bf.get(n);return r||(r=new Promise((a,l)=>{let f=n;const h=b=>E=>{f===b&&a(E)},v=b=>E=>{f===b&&l(E)},y=()=>{try{const b=e();_f(b)?(bf.set(b,r),f=b,b.then(h(b),v(b)),yf(b,y)):a(b)}catch(b){l(b)}};n.then(h(n),v(n)),yf(n,y)}),bf.set(n,r)),r};function lo(n,e){const{delay:r,unstable_promiseStatus:a=!et.use}={},l=$g(),[[f,h,v],y]=z.useReducer(E=>{const O=l.get(n);return Object.is(E[0],O)&&E[1]===l&&E[2]===n?E:[O,l,n]},void 0,()=>[l.get(n),l,n]);let b=f;if((h!==l||v!==n)&&(y(),b=l.get(n)),z.useEffect(()=>{const E=l.sub(n,()=>{if(a)try{const O=l.get(n);_f(O)&&wf(qg(O,()=>l.get(n)))}catch{}if(typeof r=="number"){setTimeout(y,r);return}y()});return y(),E},[l,n,r,a]),z.useDebugValue(b),_f(b)){const E=qg(b,()=>l.get(n));return a&&wf(E),jw(E)}return b}function Nw(n,e){const r=$g();return z.useCallback((...l)=>{if((xw?"production":void 0)!=="production"&&!("write"in n))throw new Error("not writable atom");return r.set(n,...l)},[r,n])}function rt(n,e){const r=z.useMemo(()=>st(null,(a,l,...f)=>n(a,l,...f)),[n]);return Nw(r)}function Wg(n,e){if(n==null)return{};var r,a,l=(function(h,v){if(h==null)return{};var y={};for(var b in h)if({}.hasOwnProperty.call(h,b)){if(v.indexOf(b)!==-1)continue;y[b]=h[b]}return y})(n,e);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(n);for(a=0;a<f.length;a++)r=f[a],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(n,r)&&(l[r]=n[r])}return l}function cr(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function ut(n){return ut=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(n)}function Hg(n){var e=(function(r,a){if(ut(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var f=l.call(r,a);if(ut(f)!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)})(n,"string");return ut(e)=="symbol"?e:e+""}function Gg(n,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,Hg(a.key),a)}}function lr(n,e,r){return e&&Gg(n.prototype,e),r&&Gg(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}function Kl(n,e){if(e&&(ut(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r})(n)}function Br(n){return Br=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Br(n)}function bc(n,e){return bc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,a){return r.__proto__=a,r},bc(n,e)}function Yl(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&bc(n,e)}function li(n,e,r){return(e=Hg(e))in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function Jg(n,e,r,a,l,f,h){try{var v=n[f](h),y=v.value}catch(b){return void r(b)}v.done?e(y):Promise.resolve(y).then(a,l)}function Ge(n){return function(){var e=this,r=arguments;return new Promise((function(a,l){var f=n.apply(e,r);function h(y){Jg(f,a,l,h,v,"next",y)}function v(y){Jg(f,a,l,h,v,"throw",y)}h(void 0)}))}}function Qg(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,a=Array(e);r<e;r++)a[r]=n[r];return a}function mn(n,e){return(function(r){if(Array.isArray(r))return r})(n)||(function(r,a){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var f,h,v,y,b=[],E=!0,O=!1;try{if(v=(l=l.call(r)).next,a===0){if(Object(l)!==l)return;E=!1}else for(;!(E=(f=v.call(l)).done)&&(b.push(f.value),b.length!==a);E=!0);}catch(j){O=!0,h=j}finally{try{if(!E&&l.return!=null&&(y=l.return(),Object(y)!==y))return}finally{if(O)throw h}}return b}})(n,e)||(function(r,a){if(r){if(typeof r=="string")return Qg(r,a);var l={}.toString.call(r).slice(8,-1);return l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set"?Array.from(r):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?Qg(r,a):void 0}})(n,e)||(function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function Dw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Kg,Xl={exports:{}},Sf=(function(){if(Kg)return Xl.exports;Kg=1;var n,e=typeof Reflect=="object"?Reflect:null,r=e&&typeof e.apply=="function"?e.apply:function(R,D,V){return Function.prototype.apply.call(R,D,V)};n=e&&typeof e.ownKeys=="function"?e.ownKeys:Object.getOwnPropertySymbols?function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:function(R){return Object.getOwnPropertyNames(R)};var a=Number.isNaN||function(R){return R!=R};function l(){l.init.call(this)}Xl.exports=l,Xl.exports.once=function(R,D){return new Promise((function(V,Y){function ne(q){R.removeListener(D,L),Y(q)}function L(){typeof R.removeListener=="function"&&R.removeListener("error",ne),V([].slice.call(arguments))}A(R,D,L,{once:!0}),D!=="error"&&(function(q,H,ae){typeof q.on=="function"&&A(q,"error",H,ae)})(R,ne,{once:!0})}))},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var f=10;function h(R){if(typeof R!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof R)}function v(R){return R._maxListeners===void 0?l.defaultMaxListeners:R._maxListeners}function y(R,D,V,Y){var ne,L,q,H;if(h(V),(L=R._events)===void 0?(L=R._events=Object.create(null),R._eventsCount=0):(L.newListener!==void 0&&(R.emit("newListener",D,V.listener?V.listener:V),L=R._events),q=L[D]),q===void 0)q=L[D]=V,++R._eventsCount;else if(typeof q=="function"?q=L[D]=Y?[V,q]:[q,V]:Y?q.unshift(V):q.push(V),(ne=v(R))>0&&q.length>ne&&!q.warned){q.warned=!0;var ae=new Error("Possible EventEmitter memory leak detected. "+q.length+" "+String(D)+" listeners added. Use emitter.setMaxListeners() to increase limit");ae.name="MaxListenersExceededWarning",ae.emitter=R,ae.type=D,ae.count=q.length,H=ae,console&&console.warn&&console.warn(H)}return R}function b(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E(R,D,V){var Y={fired:!1,wrapFn:void 0,target:R,type:D,listener:V},ne=b.bind(Y);return ne.listener=V,Y.wrapFn=ne,ne}function O(R,D,V){var Y=R._events;if(Y===void 0)return[];var ne=Y[D];return ne===void 0?[]:typeof ne=="function"?V?[ne.listener||ne]:[ne]:V?(function(L){for(var q=new Array(L.length),H=0;H<q.length;++H)q[H]=L[H].listener||L[H];return q})(ne):I(ne,ne.length)}function j(R){var D=this._events;if(D!==void 0){var V=D[R];if(typeof V=="function")return 1;if(V!==void 0)return V.length}return 0}function I(R,D){for(var V=new Array(D),Y=0;Y<D;++Y)V[Y]=R[Y];return V}function A(R,D,V,Y){if(typeof R.on=="function")Y.once?R.once(D,V):R.on(D,V);else{if(typeof R.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof R);R.addEventListener(D,(function ne(L){Y.once&&R.removeEventListener(D,ne),V(L)}))}}return Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(R){if(typeof R!="number"||R<0||a(R))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+R+".");f=R}}),l.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(R){if(typeof R!="number"||R<0||a(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this},l.prototype.getMaxListeners=function(){return v(this)},l.prototype.emit=function(R){for(var D=[],V=1;V<arguments.length;V++)D.push(arguments[V]);var Y=R==="error",ne=this._events;if(ne!==void 0)Y=Y&&ne.error===void 0;else if(!Y)return!1;if(Y){var L;if(D.length>0&&(L=D[0]),L instanceof Error)throw L;var q=new Error("Unhandled error."+(L?" ("+L.message+")":""));throw q.context=L,q}var H=ne[R];if(H===void 0)return!1;if(typeof H=="function")r(H,this,D);else{var ae=H.length,ye=I(H,ae);for(V=0;V<ae;++V)r(ye[V],this,D)}return!0},l.prototype.addListener=function(R,D){return y(this,R,D,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(R,D){return y(this,R,D,!0)},l.prototype.once=function(R,D){return h(D),this.on(R,E(this,R,D)),this},l.prototype.prependOnceListener=function(R,D){return h(D),this.prependListener(R,E(this,R,D)),this},l.prototype.removeListener=function(R,D){var V,Y,ne,L,q;if(h(D),(Y=this._events)===void 0)return this;if((V=Y[R])===void 0)return this;if(V===D||V.listener===D)--this._eventsCount==0?this._events=Object.create(null):(delete Y[R],Y.removeListener&&this.emit("removeListener",R,V.listener||D));else if(typeof V!="function"){for(ne=-1,L=V.length-1;L>=0;L--)if(V[L]===D||V[L].listener===D){q=V[L].listener,ne=L;break}if(ne<0)return this;ne===0?V.shift():(function(H,ae){for(;ae+1<H.length;ae++)H[ae]=H[ae+1];H.pop()})(V,ne),V.length===1&&(Y[R]=V[0]),Y.removeListener!==void 0&&this.emit("removeListener",R,q||D)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(R){var D,V,Y;if((V=this._events)===void 0)return this;if(V.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):V[R]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete V[R]),this;if(arguments.length===0){var ne,L=Object.keys(V);for(Y=0;Y<L.length;++Y)(ne=L[Y])!=="removeListener"&&this.removeAllListeners(ne);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(D=V[R])=="function")this.removeListener(R,D);else if(D!==void 0)for(Y=D.length-1;Y>=0;Y--)this.removeListener(R,D[Y]);return this},l.prototype.listeners=function(R){return O(this,R,!0)},l.prototype.rawListeners=function(R){return O(this,R,!1)},l.listenerCount=function(R,D){return typeof R.listenerCount=="function"?R.listenerCount(D):j.call(R,D)},l.prototype.listenerCount=j,l.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]},Xl.exports})(),Zl=Dw(Sf),Yg=Object.prototype.hasOwnProperty;function Xg(n,e,r){for(r of n.keys())if(Pn(r,e))return r}function Pn(n,e){var r,a,l;if(n===e)return!0;if(n&&e&&(r=n.constructor)===e.constructor){if(r===Date)return n.getTime()===e.getTime();if(r===RegExp)return n.toString()===e.toString();if(r===Array){if((a=n.length)===e.length)for(;a--&&Pn(n[a],e[a]););return a===-1}if(r===Set){if(n.size!==e.size)return!1;for(a of n)if((l=a)&&typeof l=="object"&&!(l=Xg(e,l))||!e.has(l))return!1;return!0}if(r===Map){if(n.size!==e.size)return!1;for(a of n)if((l=a[0])&&typeof l=="object"&&!(l=Xg(e,l))||!Pn(a[1],e.get(l)))return!1;return!0}if(r===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(r===DataView){if((a=n.byteLength)===e.byteLength)for(;a--&&n.getInt8(a)===e.getInt8(a););return a===-1}if(ArrayBuffer.isView(n)){if((a=n.byteLength)===e.byteLength)for(;a--&&n[a]===e[a];);return a===-1}if(!r||typeof n=="object"){for(r in a=0,n)if(Yg.call(n,r)&&++a&&!Yg.call(e,r)||!(r in e)||!Pn(n[r],e[r]))return!1;return Object.keys(e).length===a}}return n!=n&&e!=e}const Uw={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},Zg={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},jt={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},In={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},us={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};let ge=class gc{static getFirstMatch(e,r){const a=r.match(e);return a&&a.length>0&&a[1]||""}static getSecondMatch(e,r){const a=r.match(e);return a&&a.length>1&&a[2]||""}static matchAndReturnConst(e,r,a){if(e.test(r))return a}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const r=e.split(".").splice(0,2).map((a=>parseInt(a,10)||0));if(r.push(0),r[0]===10)switch(r[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const r=e.split(".").splice(0,2).map((a=>parseInt(a,10)||0));if(r.push(0),!(r[0]===1&&r[1]<5))return r[0]===1&&r[1]<6?"Cupcake":r[0]===1&&r[1]>=6?"Donut":r[0]===2&&r[1]<2?"Eclair":r[0]===2&&r[1]===2?"Froyo":r[0]===2&&r[1]>2?"Gingerbread":r[0]===3?"Honeycomb":r[0]===4&&r[1]<1?"Ice Cream Sandwich":r[0]===4&&r[1]<4?"Jelly Bean":r[0]===4&&r[1]>=4?"KitKat":r[0]===5?"Lollipop":r[0]===6?"Marshmallow":r[0]===7?"Nougat":r[0]===8?"Oreo":r[0]===9?"Pie":void 0}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,r,a=!1){const l=gc.getVersionPrecision(e),f=gc.getVersionPrecision(r);let h=Math.max(l,f),v=0;const y=gc.map([e,r],(b=>{const E=h-gc.getVersionPrecision(b),O=b+new Array(E+1).join(".0");return gc.map(O.split("."),(j=>new Array(20-j.length).join("0")+j)).reverse()}));for(a&&(v=h-Math.min(l,f)),h-=1;h>=v;){if(y[0][h]>y[1][h])return 1;if(y[0][h]===y[1][h]){if(h===v)return 0;h-=1}else if(y[0][h]<y[1][h])return-1}}static map(e,r){const a=[];let l;if(Array.prototype.map)return Array.prototype.map.call(e,r);for(l=0;l<e.length;l+=1)a.push(r(e[l]));return a}static find(e,r){let a,l;if(Array.prototype.find)return Array.prototype.find.call(e,r);for(a=0,l=e.length;a<l;a+=1){const f=e[a];if(r(f,a))return f}}static assign(e,...r){const a=e;let l,f;if(Object.assign)return Object.assign(e,...r);for(l=0,f=r.length;l<f;l+=1){const h=r[l];typeof h=="object"&&h!==null&&Object.keys(h).forEach((v=>{a[v]=h[v]}))}return e}static getBrowserAlias(e){return Uw[e]}static getBrowserTypeByAlias(e){return Zg[e]||""}};const yt=/version\/(\d+(\.?_?\d+)+)/i,Bw=[{test:[/googlebot/i],describe(n){const e={name:"Googlebot"},r=ge.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/opera/i],describe(n){const e={name:"Opera"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/opr\/|opios/i],describe(n){const e={name:"Opera"},r=ge.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/SamsungBrowser/i],describe(n){const e={name:"Samsung Internet for Android"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/Whale/i],describe(n){const e={name:"NAVER Whale Browser"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/MZBrowser/i],describe(n){const e={name:"MZ Browser"},r=ge.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/focus/i],describe(n){const e={name:"Focus"},r=ge.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/swing/i],describe(n){const e={name:"Swing"},r=ge.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/coast/i],describe(n){const e={name:"Opera Coast"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(n){const e={name:"Opera Touch"},r=ge.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/yabrowser/i],describe(n){const e={name:"Yandex Browser"},r=ge.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/ucbrowser/i],describe(n){const e={name:"UC Browser"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/Maxthon|mxios/i],describe(n){const e={name:"Maxthon"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/epiphany/i],describe(n){const e={name:"Epiphany"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/puffin/i],describe(n){const e={name:"Puffin"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/sleipnir/i],describe(n){const e={name:"Sleipnir"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/k-meleon/i],describe(n){const e={name:"K-Meleon"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/micromessenger/i],describe(n){const e={name:"WeChat"},r=ge.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/qqbrowser/i],describe(n){const e={name:/qqbrowserlite/i.test(n)?"QQ Browser Lite":"QQ Browser"},r=ge.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/msie|trident/i],describe(n){const e={name:"Internet Explorer"},r=ge.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/\sedg\//i],describe(n){const e={name:"Microsoft Edge"},r=ge.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/edg([ea]|ios)/i],describe(n){const e={name:"Microsoft Edge"},r=ge.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/vivaldi/i],describe(n){const e={name:"Vivaldi"},r=ge.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/seamonkey/i],describe(n){const e={name:"SeaMonkey"},r=ge.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/sailfish/i],describe(n){const e={name:"Sailfish"},r=ge.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,n);return r&&(e.version=r),e}},{test:[/silk/i],describe(n){const e={name:"Amazon Silk"},r=ge.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/phantom/i],describe(n){const e={name:"PhantomJS"},r=ge.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/slimerjs/i],describe(n){const e={name:"SlimerJS"},r=ge.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const e={name:"BlackBerry"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/(web|hpw)[o0]s/i],describe(n){const e={name:"WebOS Browser"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/bada/i],describe(n){const e={name:"Bada"},r=ge.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/tizen/i],describe(n){const e={name:"Tizen"},r=ge.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/qupzilla/i],describe(n){const e={name:"QupZilla"},r=ge.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/firefox|iceweasel|fxios/i],describe(n){const e={name:"Firefox"},r=ge.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/electron/i],describe(n){const e={name:"Electron"},r=ge.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/MiuiBrowser/i],describe(n){const e={name:"Miui"},r=ge.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/chromium/i],describe(n){const e={name:"Chromium"},r=ge.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/chrome|crios|crmo/i],describe(n){const e={name:"Chrome"},r=ge.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/GSA/i],describe(n){const e={name:"Google Search"},r=ge.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test(n){const e=!n.test(/like android/i),r=n.test(/android/i);return e&&r},describe(n){const e={name:"Android Browser"},r=ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/playstation 4/i],describe(n){const e={name:"PlayStation 4"},r=ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/safari|applewebkit/i],describe(n){const e={name:"Safari"},r=ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/.*/i],describe(n){const e=n.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:ge.getFirstMatch(e,n),version:ge.getSecondMatch(e,n)}}}];var Fw=[{test:[/Roku\/DVP/],describe(n){const e=ge.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,n);return{name:In.Roku,version:e}}},{test:[/windows phone/i],describe(n){const e=ge.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,n);return{name:In.WindowsPhone,version:e}}},{test:[/windows /i],describe(n){const e=ge.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,n),r=ge.getWindowsVersionName(e);return{name:In.Windows,version:e,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(n){const e={name:In.iOS},r=ge.getSecondMatch(/(Version\/)(\d[\d.]+)/,n);return r&&(e.version=r),e}},{test:[/macintosh/i],describe(n){const e=ge.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,n).replace(/[_\s]/g,"."),r=ge.getMacOSVersionName(e),a={name:In.MacOS,version:e};return r&&(a.versionName=r),a}},{test:[/(ipod|iphone|ipad)/i],describe(n){const e=ge.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,n).replace(/[_\s]/g,".");return{name:In.iOS,version:e}}},{test(n){const e=!n.test(/like android/i),r=n.test(/android/i);return e&&r},describe(n){const e=ge.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,n),r=ge.getAndroidVersionName(e),a={name:In.Android,version:e};return r&&(a.versionName=r),a}},{test:[/(web|hpw)[o0]s/i],describe(n){const e=ge.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,n),r={name:In.WebOS};return e&&e.length&&(r.version=e),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const e=ge.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,n)||ge.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,n)||ge.getFirstMatch(/\bbb(\d+)/i,n);return{name:In.BlackBerry,version:e}}},{test:[/bada/i],describe(n){const e=ge.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,n);return{name:In.Bada,version:e}}},{test:[/tizen/i],describe(n){const e=ge.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,n);return{name:In.Tizen,version:e}}},{test:[/linux/i],describe:()=>({name:In.Linux})},{test:[/CrOS/],describe:()=>({name:In.ChromeOS})},{test:[/PlayStation 4/],describe(n){const e=ge.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,n);return{name:In.PlayStation4,version:e}}}],Vw=[{test:[/googlebot/i],describe:()=>({type:"bot",vendor:"Google"})},{test:[/huawei/i],describe(n){const e=ge.getFirstMatch(/(can-l01)/i,n)&&"Nova",r={type:jt.mobile,vendor:"Huawei"};return e&&(r.model=e),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:()=>({type:jt.tablet,vendor:"Nexus"})},{test:[/ipad/i],describe:()=>({type:jt.tablet,vendor:"Apple",model:"iPad"})},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:()=>({type:jt.tablet,vendor:"Apple",model:"iPad"})},{test:[/kftt build/i],describe:()=>({type:jt.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"})},{test:[/silk/i],describe:()=>({type:jt.tablet,vendor:"Amazon"})},{test:[/tablet(?! pc)/i],describe:()=>({type:jt.tablet})},{test(n){const e=n.test(/ipod|iphone/i),r=n.test(/like (ipod|iphone)/i);return e&&!r},describe(n){const e=ge.getFirstMatch(/(ipod|iphone)/i,n);return{type:jt.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:()=>({type:jt.mobile,vendor:"Nexus"})},{test:[/[^-]mobi/i],describe:()=>({type:jt.mobile})},{test:n=>n.getBrowserName(!0)==="blackberry",describe:()=>({type:jt.mobile,vendor:"BlackBerry"})},{test:n=>n.getBrowserName(!0)==="bada",describe:()=>({type:jt.mobile})},{test:n=>n.getBrowserName()==="windows phone",describe:()=>({type:jt.mobile,vendor:"Microsoft"})},{test(n){const e=Number(String(n.getOSVersion()).split(".")[0]);return n.getOSName(!0)==="android"&&e>=3},describe:()=>({type:jt.tablet})},{test:n=>n.getOSName(!0)==="android",describe:()=>({type:jt.mobile})},{test:n=>n.getOSName(!0)==="macos",describe:()=>({type:jt.desktop,vendor:"Apple"})},{test:n=>n.getOSName(!0)==="windows",describe:()=>({type:jt.desktop})},{test:n=>n.getOSName(!0)==="linux",describe:()=>({type:jt.desktop})},{test:n=>n.getOSName(!0)==="playstation 4",describe:()=>({type:jt.tv})},{test:n=>n.getOSName(!0)==="roku",describe:()=>({type:jt.tv})}],zw=[{test:n=>n.getBrowserName(!0)==="microsoft edge",describe(n){if(/\sedg\//i.test(n))return{name:us.Blink};const e=ge.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,n);return{name:us.EdgeHTML,version:e}}},{test:[/trident/i],describe(n){const e={name:us.Trident},r=ge.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:n=>n.test(/presto/i),describe(n){const e={name:us.Presto},r=ge.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test(n){const e=n.test(/gecko/i),r=n.test(/like gecko/i);return e&&!r},describe(n){const e={name:us.Gecko},r=ge.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/(apple)?webkit\/537\.36/i],describe:()=>({name:us.Blink})},{test:[/(apple)?webkit/i],describe(n){const e={name:us.WebKit},r=ge.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}}];let em=class{constructor(e,r=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},r!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=ge.find(Bw,(r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some((a=>this.test(a)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=ge.find(Fw,(r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some((a=>this.test(a)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:r}=this.getOS();return e?String(r).toLowerCase()||"":r||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:r}=this.getPlatform();return e?String(r).toLowerCase()||"":r||""}parsePlatform(){this.parsedResult.platform={};const e=ge.find(Vw,(r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some((a=>this.test(a)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=ge.find(zw,(r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some((a=>this.test(a)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return ge.assign({},this.parsedResult)}satisfies(e){const r={};let a=0;const l={};let f=0;if(Object.keys(e).forEach((h=>{const v=e[h];typeof v=="string"?(l[h]=v,f+=1):typeof v=="object"&&(r[h]=v,a+=1)})),a>0){const h=Object.keys(r),v=ge.find(h,(b=>this.isOS(b)));if(v){const b=this.satisfies(r[v]);if(b!==void 0)return b}const y=ge.find(h,(b=>this.isPlatform(b)));if(y){const b=this.satisfies(r[y]);if(b!==void 0)return b}}if(f>0){const h=Object.keys(l),v=ge.find(h,(y=>this.isBrowser(y,!0)));if(v!==void 0)return this.compareVersion(l[v])}}isBrowser(e,r=!1){const a=this.getBrowserName().toLowerCase();let l=e.toLowerCase();const f=ge.getBrowserTypeByAlias(l);return r&&f&&(l=f.toLowerCase()),l===a}compareVersion(e){let r=[0],a=e,l=!1;const f=this.getBrowserVersion();if(typeof f=="string")return e[0]===">"||e[0]==="<"?(a=e.substr(1),e[1]==="="?(l=!0,a=e.substr(2)):r=[],e[0]===">"?r.push(1):r.push(-1)):e[0]==="="?a=e.substr(1):e[0]==="~"&&(l=!0,a=e.substr(1)),r.indexOf(ge.compareVersions(f,a,l))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,r=!1){return this.isBrowser(e,r)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some((r=>this.is(r)))}};/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */let $w=class{static getParser(e,r=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new em(e,r)}static parse(e){return new em(e).getResult()}static get BROWSER_MAP(){return Zg}static get ENGINE_MAP(){return us}static get OS_MAP(){return In}static get PLATFORMS_MAP(){return jt}};function eu(){return Date.now()+Math.random().toString()}function Sc(){throw new Error("Method must be implemented in subclass")}function tm(n,e){return e!=null&&e.proxyUrl?e.proxyUrl+(e.proxyUrl.slice(-1)==="/"?"":"/")+n.substring(8):n}function tu(n){return n!=null&&n.callObjectBundleUrlOverride?n.callObjectBundleUrlOverride:tm("https://c.daily.co/call-machine/versioned/".concat("0.84.0","/static/call-machine-object-bundle.js"),n)}function nu(n){try{new URL(n)}catch{return!1}return!0}const Ct=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,uo="8.55.0",pt=globalThis;function ru(n,e,r){const a=pt,l=a.__SENTRY__=a.__SENTRY__||{},f=l[uo]=l[uo]||{};return f[n]||(f[n]=e())}const fo=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,kf=["debug","info","warn","error","log","assert","trace"],iu={};function kc(n){if(!("console"in pt))return n();const e=pt.console,r={},a=Object.keys(iu);a.forEach((l=>{const f=iu[l];r[l]=e[l],e[l]=f}));try{return n()}finally{a.forEach((l=>{e[l]=r[l]}))}}const Ye=ru("logger",(function(){let n=!1;const e={enable:()=>{n=!0},disable:()=>{n=!1},isEnabled:()=>n};return fo?kf.forEach((r=>{e[r]=(...a)=>{n&&kc((()=>{pt.console[r](`Sentry Logger [${r}]:`,...a)}))}})):kf.forEach((r=>{e[r]=()=>{}})),e})),ho="?",nm=/\(error: (.*)\)/,rm=/captureMessage|captureException/;function su(n){return n[n.length-1]||{}}const im="<anonymous>";function ds(n){try{return n&&typeof n=="function"&&n.name||im}catch{return im}}function sm(n){const e=n.exception;if(e){const r=[];try{return e.values.forEach((a=>{a.stacktrace.frames&&r.push(...a.stacktrace.frames)})),r}catch{return}}}const ou={},om={};function po(n,e){ou[n]=ou[n]||[],ou[n].push(e)}function go(n,e){if(!om[n]){om[n]=!0;try{e()}catch(r){fo&&Ye.error(`Error while instrumenting ${n}`,r)}}}function Fr(n,e){const r=n&&ou[n];if(r)for(const a of r)try{a(e)}catch(l){fo&&Ye.error(`Error while triggering instrumentation handler.
Type: ${n}
Name: ${ds(a)}
Error:`,l)}}let Cf=null;function qw(){Cf=pt.onerror,pt.onerror=function(n,e,r,a,l){return Fr("error",{column:a,error:l,line:r,msg:n,url:e}),!!Cf&&Cf.apply(this,arguments)},pt.onerror.__SENTRY_INSTRUMENTED__=!0}let Ef=null;function Ww(){Ef=pt.onunhandledrejection,pt.onunhandledrejection=function(n){return Fr("unhandledrejection",n),!Ef||Ef.apply(this,arguments)},pt.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function au(){return Mf(pt),pt}function Mf(n){const e=n.__SENTRY__=n.__SENTRY__||{};return e.version=e.version||uo,e[uo]=e[uo]||{}}const am=Object.prototype.toString;function Of(n){switch(am.call(n)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return mo(n,Error)}}function pa(n,e){return am.call(n)===`[object ${e}]`}function cm(n){return pa(n,"ErrorEvent")}function lm(n){return pa(n,"DOMError")}function Ui(n){return pa(n,"String")}function Tf(n){return typeof n=="object"&&n!==null&&"__sentry_template_string__"in n&&"__sentry_template_values__"in n}function Rf(n){return n===null||Tf(n)||typeof n!="object"&&typeof n!="function"}function ga(n){return pa(n,"Object")}function cu(n){return typeof Event<"u"&&mo(n,Event)}function lu(n){return!!(n&&n.then&&typeof n.then=="function")}function mo(n,e){try{return n instanceof e}catch{return!1}}function um(n){return!(typeof n!="object"||n===null||!n.__isVue&&!n._isVue)}const Af=pt;function dm(n,e={}){if(!n)return"<unknown>";try{let r=n;const a=5,l=[];let f=0,h=0;const v=" > ",y=v.length;let b;const E=Array.isArray(e)?e:e.keyAttrs,O=!Array.isArray(e)&&e.maxStringLength||80;for(;r&&f++<a&&(b=Hw(r,E),!(b==="html"||f>1&&h+l.length*y+b.length>=O));)l.push(b),h+=b.length,r=r.parentNode;return l.reverse().join(v)}catch{return"<unknown>"}}function Hw(n,e){const r=n,a=[];if(!r||!r.tagName)return"";if(Af.HTMLElement&&r instanceof HTMLElement&&r.dataset){if(r.dataset.sentryComponent)return r.dataset.sentryComponent;if(r.dataset.sentryElement)return r.dataset.sentryElement}a.push(r.tagName.toLowerCase());const l=e&&e.length?e.filter((h=>r.getAttribute(h))).map((h=>[h,r.getAttribute(h)])):null;if(l&&l.length)l.forEach((h=>{a.push(`[${h[0]}="${h[1]}"]`)}));else{r.id&&a.push(`#${r.id}`);const h=r.className;if(h&&Ui(h)){const v=h.split(/\s+/);for(const y of v)a.push(`.${y}`)}}const f=["aria-label","type","name","title","alt"];for(const h of f){const v=r.getAttribute(h);v&&a.push(`[${h}="${v}"]`)}return a.join("")}function ma(n,e=0){return typeof n!="string"||e===0||n.length<=e?n:`${n.slice(0,e)}...`}function fm(n,e){if(!Array.isArray(n))return"";const r=[];for(let a=0;a<n.length;a++){const l=n[a];try{um(l)?r.push("[VueViewModel]"):r.push(String(l))}catch{r.push("[value cannot be serialized]")}}return r.join(e)}function Gw(n,e,r=!1){return!!Ui(n)&&(pa(e,"RegExp")?e.test(n):!!Ui(e)&&(r?n===e:n.includes(e)))}function uu(n,e=[],r=!1){return e.some((a=>Gw(n,a,r)))}function ur(n,e,r){if(!(e in n))return;const a=n[e],l=r(a);typeof l=="function"&&hm(l,a);try{n[e]=l}catch{fo&&Ye.log(`Failed to replace method "${e}" in object`,n)}}function vo(n,e,r){try{Object.defineProperty(n,e,{value:r,writable:!0,configurable:!0})}catch{fo&&Ye.log(`Failed to add non-enumerable property "${e}" to object`,n)}}function hm(n,e){try{const r=e.prototype||{};n.prototype=e.prototype=r,vo(n,"__sentry_original__",e)}catch{}}function Pf(n){return n.__sentry_original__}function pm(n){if(Of(n))return{message:n.message,name:n.name,stack:n.stack,...mm(n)};if(cu(n)){const e={type:n.type,target:gm(n.target),currentTarget:gm(n.currentTarget),...mm(n)};return typeof CustomEvent<"u"&&mo(n,CustomEvent)&&(e.detail=n.detail),e}return n}function gm(n){try{return e=n,typeof Element<"u"&&mo(e,Element)?dm(n):Object.prototype.toString.call(n)}catch{return"<unknown>"}var e}function mm(n){if(typeof n=="object"&&n!==null){const e={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}return{}}function wr(n){return If(n,new Map)}function If(n,e){if((function(r){if(!ga(r))return!1;try{const a=Object.getPrototypeOf(r).constructor.name;return!a||a==="Object"}catch{return!0}})(n)){const r=e.get(n);if(r!==void 0)return r;const a={};e.set(n,a);for(const l of Object.getOwnPropertyNames(n))n[l]!==void 0&&(a[l]=If(n[l],e));return a}if(Array.isArray(n)){const r=e.get(n);if(r!==void 0)return r;const a=[];return e.set(n,a),n.forEach((l=>{a.push(If(l,e))})),a}return n}function Cc(){return Date.now()/1e3}const Bi=(function(){const{performance:n}=pt;if(!n||!n.now)return Cc;const e=Date.now()-n.now(),r=n.timeOrigin==null?e:n.timeOrigin;return()=>(r+n.now())/1e3})();function br(){const n=pt,e=n.crypto||n.msCrypto;let r=()=>16*Math.random();try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(r=()=>{const a=new Uint8Array(1);return e.getRandomValues(a),a[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,(a=>(a^(15&r())>>a/4).toString(16)))}function vm(n){return n.exception&&n.exception.values?n.exception.values[0]:void 0}function fs(n){const{message:e,event_id:r}=n;if(e)return e;const a=vm(n);return a?a.type&&a.value?`${a.type}: ${a.value}`:a.type||a.value||r||"<unknown>":r||"<unknown>"}function xf(n,e,r){const a=n.exception=n.exception||{},l=a.values=a.values||[],f=l[0]=l[0]||{};f.value||(f.value=e||""),f.type||(f.type="Error")}function va(n,e){const r=vm(n);if(!r)return;const a=r.mechanism;if(r.mechanism={type:"generic",handled:!0,...a,...e},e&&"data"in e){const l={...a&&a.data,...e.data};r.mechanism.data=l}}function ym(n){if((function(e){try{return e.__sentry_captured__}catch{}})(n))return!0;try{vo(n,"__sentry_captured__",!0)}catch{}return!1}var Fi;function yo(n){return new Sr((e=>{e(n)}))}function du(n){return new Sr(((e,r)=>{r(n)}))}(()=>{const{performance:n}=pt;!n||!n.now||(n.now(),n.timing&&n.timing.navigationStart)})(),(function(n){n[n.PENDING=0]="PENDING",n[n.RESOLVED=1]="RESOLVED",n[n.REJECTED=2]="REJECTED"})(Fi||(Fi={}));class Sr{constructor(e){Sr.prototype.__init.call(this),Sr.prototype.__init2.call(this),Sr.prototype.__init3.call(this),Sr.prototype.__init4.call(this),this._state=Fi.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(r){this._reject(r)}}then(e,r){return new Sr(((a,l)=>{this._handlers.push([!1,f=>{if(e)try{a(e(f))}catch(h){l(h)}else a(f)},f=>{if(r)try{a(r(f))}catch(h){l(h)}else l(f)}]),this._executeHandlers()}))}catch(e){return this.then((r=>r),e)}finally(e){return new Sr(((r,a)=>{let l,f;return this.then((h=>{f=!1,l=h,e&&e()}),(h=>{f=!0,l=h,e&&e()})).then((()=>{f?a(l):r(l)}))}))}__init(){this._resolve=e=>{this._setResult(Fi.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(Fi.REJECTED,e)}}__init3(){this._setResult=(e,r)=>{this._state===Fi.PENDING&&(lu(r)?r.then(this._resolve,this._reject):(this._state=e,this._value=r,this._executeHandlers()))}}__init4(){this._executeHandlers=()=>{if(this._state===Fi.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach((r=>{r[0]||(this._state===Fi.RESOLVED&&r[1](this._value),this._state===Fi.REJECTED&&r[2](this._value),r[0]=!0)}))}}}function Jw(n){const e=Bi(),r={sid:br(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>(function(a){return wr({sid:`${a.sid}`,init:a.init,started:new Date(1e3*a.started).toISOString(),timestamp:new Date(1e3*a.timestamp).toISOString(),status:a.status,errors:a.errors,did:typeof a.did=="number"||typeof a.did=="string"?`${a.did}`:void 0,duration:a.duration,abnormal_mechanism:a.abnormal_mechanism,attrs:{release:a.release,environment:a.environment,ip_address:a.ipAddress,user_agent:a.userAgent}})})(r)};return n&&ya(r,n),r}function ya(n,e={}){if(e.user&&(!n.ipAddress&&e.user.ip_address&&(n.ipAddress=e.user.ip_address),n.did||e.did||(n.did=e.user.id||e.user.email||e.user.username)),n.timestamp=e.timestamp||Bi(),e.abnormal_mechanism&&(n.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(n.ignoreDuration=e.ignoreDuration),e.sid&&(n.sid=e.sid.length===32?e.sid:br()),e.init!==void 0&&(n.init=e.init),!n.did&&e.did&&(n.did=`${e.did}`),typeof e.started=="number"&&(n.started=e.started),n.ignoreDuration)n.duration=void 0;else if(typeof e.duration=="number")n.duration=e.duration;else{const r=n.timestamp-n.started;n.duration=r>=0?r:0}e.release&&(n.release=e.release),e.environment&&(n.environment=e.environment),!n.ipAddress&&e.ipAddress&&(n.ipAddress=e.ipAddress),!n.userAgent&&e.userAgent&&(n.userAgent=e.userAgent),typeof e.errors=="number"&&(n.errors=e.errors),e.status&&(n.status=e.status)}function _m(){return br()}function Lf(){return br().substring(16)}function fu(n,e,r=2){if(!e||typeof e!="object"||r<=0)return e;if(n&&e&&Object.keys(e).length===0)return n;const a={...n};for(const l in e)Object.prototype.hasOwnProperty.call(e,l)&&(a[l]=fu(a[l],e[l],r-1));return a}const jf="_sentrySpan";function wm(n,e){e?vo(n,jf,e):delete n[jf]}function bm(n){return n[jf]}class Nf{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:_m(),spanId:Lf()}}clone(){const e=new Nf;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,wm(e,bm(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&ya(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,r){return this._tags={...this._tags,[e]:r},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,r){return this._extra={...this._extra,[e]:r},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,r){return r===null?delete this._contexts[e]:this._contexts[e]=r,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const r=typeof e=="function"?e(this):e,[a,l]=r instanceof hs?[r.getScopeData(),r.getRequestSession()]:ga(r)?[e,e.requestSession]:[],{tags:f,extra:h,user:v,contexts:y,level:b,fingerprint:E=[],propagationContext:O}=a||{};return this._tags={...this._tags,...f},this._extra={...this._extra,...h},this._contexts={...this._contexts,...y},v&&Object.keys(v).length&&(this._user=v),b&&(this._level=b),E.length&&(this._fingerprint=E),O&&(this._propagationContext=O),l&&(this._requestSession=l),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,wm(this,void 0),this._attachments=[],this.setPropagationContext({traceId:_m()}),this._notifyScopeListeners(),this}addBreadcrumb(e,r){const a=typeof r=="number"?r:100;if(a<=0)return this;const l={timestamp:Cc(),...e};return this._breadcrumbs.push(l),this._breadcrumbs.length>a&&(this._breadcrumbs=this._breadcrumbs.slice(-a),this._client&&this._client.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:bm(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=fu(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext={spanId:Lf(),...e},this}getPropagationContext(){return this._propagationContext}captureException(e,r){const a=r&&r.event_id?r.event_id:br();if(!this._client)return Ye.warn("No client configured on scope - will not capture exception!"),a;const l=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:l,...r,event_id:a},this),a}captureMessage(e,r,a){const l=a&&a.event_id?a.event_id:br();if(!this._client)return Ye.warn("No client configured on scope - will not capture message!"),l;const f=new Error(e);return this._client.captureMessage(e,r,{originalException:e,syntheticException:f,...a,event_id:l},this),l}captureEvent(e,r){const a=r&&r.event_id?r.event_id:br();return this._client?(this._client.captureEvent(e,{...r,event_id:a},this),a):(Ye.warn("No client configured on scope - will not capture event!"),a)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((e=>{e(this)})),this._notifyingListeners=!1)}}const hs=Nf;class Qw{constructor(e,r){let a,l;a=e||new hs,l=r||new hs,this._stack=[{scope:a}],this._isolationScope=l}withScope(e){const r=this._pushScope();let a;try{a=e(r)}catch(l){throw this._popScope(),l}return lu(a)?a.then((l=>(this._popScope(),l)),(l=>{throw this._popScope(),l})):(this._popScope(),a)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function _a(){const n=Mf(au());return n.stack=n.stack||new Qw(ru("defaultCurrentScope",(()=>new hs)),ru("defaultIsolationScope",(()=>new hs)))}function Kw(n){return _a().withScope(n)}function Yw(n,e){const r=_a();return r.withScope((()=>(r.getStackTop().scope=n,e(n))))}function Sm(n){return _a().withScope((()=>n(_a().getIsolationScope())))}function Df(n){const e=Mf(n);return e.acs?e.acs:{withIsolationScope:Sm,withScope:Kw,withSetScope:Yw,withSetIsolationScope:(r,a)=>Sm(a),getCurrentScope:()=>_a().getScope(),getIsolationScope:()=>_a().getIsolationScope()}}function _o(){return Df(au()).getCurrentScope()}function Ec(){return Df(au()).getIsolationScope()}function vn(){return _o().getClient()}function Xw(n){const e=n.getPropagationContext(),{traceId:r,spanId:a,parentSpanId:l}=e;return wr({trace_id:r,span_id:a,parent_span_id:l})}function Zw(n){const e=n._sentryMetrics;if(!e)return;const r={};for(const[,[a,l]]of e)(r[a]||(r[a]=[])).push(wr(l));return r}const eb=/^sentry-/;function tb(n){const e=(function(a){if(!(!a||!Ui(a)&&!Array.isArray(a)))return Array.isArray(a)?a.reduce(((l,f)=>{const h=km(f);return Object.entries(h).forEach((([v,y])=>{l[v]=y})),l}),{}):km(a)})(n);if(!e)return;const r=Object.entries(e).reduce(((a,[l,f])=>(l.match(eb)&&(a[l.slice(7)]=f),a)),{});return Object.keys(r).length>0?r:void 0}function km(n){return n.split(",").map((e=>e.split("=").map((r=>decodeURIComponent(r.trim()))))).reduce(((e,[r,a])=>(r&&a&&(e[r]=a),e)),{})}let Cm=!1;function nb(n){const{spanId:e,traceId:r,isRemote:a}=n.spanContext();return wr({parent_span_id:a?e:Uf(n).parent_span_id,span_id:a?Lf():e,trace_id:r})}function Em(n){return typeof n=="number"?Mm(n):Array.isArray(n)?n[0]+n[1]/1e9:n instanceof Date?Mm(n.getTime()):Bi()}function Mm(n){return n>9999999999?n/1e3:n}function Uf(n){if((function(e){return typeof e.getSpanJSON=="function"})(n))return n.getSpanJSON();try{const{spanId:e,traceId:r}=n.spanContext();if((function(a){const l=a;return!!(l.attributes&&l.startTime&&l.name&&l.endTime&&l.status)})(n)){const{attributes:a,startTime:l,name:f,endTime:h,parentSpanId:v,status:y}=n;return wr({span_id:e,trace_id:r,data:a,description:f,parent_span_id:v,start_timestamp:Em(l),timestamp:Em(h)||void 0,status:rb(y),op:a["sentry.op"],origin:a["sentry.origin"],_metrics_summary:Zw(n)})}return{span_id:e,trace_id:r}}catch{return{}}}function rb(n){if(n&&n.code!==0)return n.code===1?"ok":n.message||"unknown_error"}function Om(n){return n._sentryRootSpan||n}function ib(){Cm||(kc((()=>{console.warn("[Sentry] Deprecation warning: Returning null from `beforeSendSpan` will be disallowed from SDK version 9.0.0 onwards. The callback will only support mutating spans. To drop certain spans, configure the respective integrations directly.")})),Cm=!0)}const Bf="production";function Tm(n,e){const r=e.getOptions(),{publicKey:a}=e.getDsn()||{},l=wr({environment:r.environment||Bf,release:r.release,public_key:a,trace_id:n});return e.emit("createDsc",l),l}function sb(n){const e=vn();if(!e)return{};const r=Om(n),a=r._frozenDsc;if(a)return a;const l=r.spanContext().traceState,f=l&&l.get("sentry.dsc"),h=f&&tb(f);if(h)return h;const v=Tm(n.spanContext().traceId,e),y=Uf(r),b=y.data||{},E=b["sentry.sample_rate"];E!=null&&(v.sample_rate=`${E}`);const O=b["sentry.source"],j=y.description;return O!=="url"&&j&&(v.transaction=j),(function(I){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const A=vn(),R=A&&A.getOptions();return!!R&&(R.enableTracing||"tracesSampleRate"in R||"tracesSampler"in R)})()&&(v.sampled=String((function(I){const{traceFlags:A}=I.spanContext();return A===1})(r))),e.emit("createDsc",v,r),v}const ob=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function hu(n,e=!1){const{host:r,path:a,pass:l,port:f,projectId:h,protocol:v,publicKey:y}=n;return`${v}://${y}${e&&l?`:${l}`:""}@${r}${f?`:${f}`:""}/${a&&`${a}/`}${h}`}function Rm(n){return{protocol:n.protocol,publicKey:n.publicKey||"",pass:n.pass||"",host:n.host,port:n.port||"",path:n.path||"",projectId:n.projectId}}function ab(n){const e=typeof n=="string"?(function(r){const a=ob.exec(r);if(!a)return void kc((()=>{console.error(`Invalid Sentry Dsn: ${r}`)}));const[l,f,h="",v="",y="",b=""]=a.slice(1);let E="",O=b;const j=O.split("/");if(j.length>1&&(E=j.slice(0,-1).join("/"),O=j.pop()),O){const I=O.match(/^\d+/);I&&(O=I[0])}return Rm({host:v,pass:h,path:E,projectId:O,port:y,protocol:l,publicKey:f})})(n):Rm(n);if(e&&(function(r){if(!fo)return!0;const{port:a,projectId:l,protocol:f}=r;return!(["protocol","publicKey","host","projectId"].find((h=>!r[h]&&(Ye.error(`Invalid Sentry Dsn: ${h} missing`),!0)))||(l.match(/^\d+$/)?(function(h){return h==="http"||h==="https"})(f)?a&&isNaN(parseInt(a,10))&&(Ye.error(`Invalid Sentry Dsn: Invalid port ${a}`),1):(Ye.error(`Invalid Sentry Dsn: Invalid protocol ${f}`),1):(Ye.error(`Invalid Sentry Dsn: Invalid projectId ${l}`),1)))})(e))return e}function Vi(n,e=100,r=1/0){try{return Ff("",n,e,r)}catch(a){return{ERROR:`**non-serializable** (${a})`}}}function Am(n,e=3,r=102400){const a=Vi(n,e);return l=a,(function(f){return~-encodeURI(f).split(/%..|./).length})(JSON.stringify(l))>r?Am(n,e-1,r):a;var l}function Ff(n,e,r=1/0,a=1/0,l=(function(){const f=typeof WeakSet=="function",h=f?new WeakSet:[];return[function(v){if(f)return!!h.has(v)||(h.add(v),!1);for(let y=0;y<h.length;y++)if(h[y]===v)return!0;return h.push(v),!1},function(v){if(f)h.delete(v);else for(let y=0;y<h.length;y++)if(h[y]===v){h.splice(y,1);break}}]})()){const[f,h]=l;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const v=(function(I,A){try{if(I==="domain"&&A&&typeof A=="object"&&A._events)return"[Domain]";if(I==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&A===global)return"[Global]";if(typeof window<"u"&&A===window)return"[Window]";if(typeof document<"u"&&A===document)return"[Document]";if(um(A))return"[VueViewModel]";if(ga(R=A)&&"nativeEvent"in R&&"preventDefault"in R&&"stopPropagation"in R)return"[SyntheticEvent]";if(typeof A=="number"&&!Number.isFinite(A))return`[${A}]`;if(typeof A=="function")return`[Function: ${ds(A)}]`;if(typeof A=="symbol")return`[${String(A)}]`;if(typeof A=="bigint")return`[BigInt: ${String(A)}]`;const D=(function(V){const Y=Object.getPrototypeOf(V);return Y?Y.constructor.name:"null prototype"})(A);return/^HTML(\w*)Element$/.test(D)?`[HTMLElement: ${D}]`:`[object ${D}]`}catch(D){return`**non-serializable** (${D})`}var R})(n,e);if(!v.startsWith("[object "))return v;if(e.__sentry_skip_normalization__)return e;const y=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:r;if(y===0)return v.replace("object ","");if(f(e))return"[Circular ~]";const b=e;if(b&&typeof b.toJSON=="function")try{return Ff("",b.toJSON(),y-1,a,l)}catch{}const E=Array.isArray(e)?[]:{};let O=0;const j=pm(e);for(const I in j){if(!Object.prototype.hasOwnProperty.call(j,I))continue;if(O>=a){E[I]="[MaxProperties ~]";break}const A=j[I];E[I]=Ff(I,A,y-1,a,l),O++}return h(e),E}function Mc(n,e=[]){return[n,e]}function cb(n,e){const[r,a]=n;return[r,[...a,e]]}function Pm(n,e){const r=n[1];for(const a of r)if(e(a,a[0].type))return!0;return!1}function Vf(n){return pt.__SENTRY__&&pt.__SENTRY__.encodePolyfill?pt.__SENTRY__.encodePolyfill(n):new TextEncoder().encode(n)}function lb(n){const[e,r]=n;let a=JSON.stringify(e);function l(f){typeof a=="string"?a=typeof f=="string"?a+f:[Vf(a),f]:a.push(typeof f=="string"?Vf(f):f)}for(const f of r){const[h,v]=f;if(l(`
${JSON.stringify(h)}
`),typeof v=="string"||v instanceof Uint8Array)l(v);else{let y;try{y=JSON.stringify(v)}catch{y=JSON.stringify(Vi(v))}l(y)}}return typeof a=="string"?a:(function(f){const h=f.reduce(((b,E)=>b+E.length),0),v=new Uint8Array(h);let y=0;for(const b of f)v.set(b,y),y+=b.length;return v})(a)}function ub(n){const e=typeof n.data=="string"?Vf(n.data):n.data;return[wr({type:"attachment",length:e.length,filename:n.filename,content_type:n.contentType,attachment_type:n.attachmentType}),e]}const db={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket",raw_security:"security"};function Im(n){return db[n]}function xm(n){if(!n||!n.sdk)return;const{name:e,version:r}=n.sdk;return{name:e,version:r}}function fb(n,e,r,a){const l=xm(r),f=n.type&&n.type!=="replay_event"?n.type:"event";(function(v,y){y&&(v.sdk=v.sdk||{},v.sdk.name=v.sdk.name||y.name,v.sdk.version=v.sdk.version||y.version,v.sdk.integrations=[...v.sdk.integrations||[],...y.integrations||[]],v.sdk.packages=[...v.sdk.packages||[],...y.packages||[]])})(n,r&&r.sdk);const h=(function(v,y,b,E){const O=v.sdkProcessingMetadata&&v.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:v.event_id,sent_at:new Date().toISOString(),...y&&{sdk:y},...!!b&&E&&{dsn:hu(E)},...O&&{trace:wr({...O})}}})(n,l,a,e);return delete n.sdkProcessingMetadata,Mc(h,[[{type:f},n]])}function zf(n,e,r,a=0){return new Sr(((l,f)=>{const h=n[a];if(e===null||typeof h!="function")l(e);else{const v=h({...e},r);Ct&&h.id&&v===null&&Ye.log(`Event processor "${h.id}" dropped event`),lu(v)?v.then((y=>zf(n,y,r,a+1).then(l))).then(null,f):zf(n,v,r,a+1).then(l).then(null,f)}}))}let pu,Lm,$f;function hb(n,e){const{fingerprint:r,span:a,breadcrumbs:l,sdkProcessingMetadata:f}=e;(function(h,v){const{extra:y,tags:b,user:E,contexts:O,level:j,transactionName:I}=v,A=wr(y);A&&Object.keys(A).length&&(h.extra={...A,...h.extra});const R=wr(b);R&&Object.keys(R).length&&(h.tags={...R,...h.tags});const D=wr(E);D&&Object.keys(D).length&&(h.user={...D,...h.user});const V=wr(O);V&&Object.keys(V).length&&(h.contexts={...V,...h.contexts}),j&&(h.level=j),I&&h.type!=="transaction"&&(h.transaction=I)})(n,e),a&&(function(h,v){h.contexts={trace:nb(v),...h.contexts},h.sdkProcessingMetadata={dynamicSamplingContext:sb(v),...h.sdkProcessingMetadata};const y=Om(v),b=Uf(y).description;b&&!h.transaction&&h.type==="transaction"&&(h.transaction=b)})(n,a),(function(h,v){h.fingerprint=h.fingerprint?Array.isArray(h.fingerprint)?h.fingerprint:[h.fingerprint]:[],v&&(h.fingerprint=h.fingerprint.concat(v)),h.fingerprint&&!h.fingerprint.length&&delete h.fingerprint})(n,r),(function(h,v){const y=[...h.breadcrumbs||[],...v];h.breadcrumbs=y.length?y:void 0})(n,l),(function(h,v){h.sdkProcessingMetadata={...h.sdkProcessingMetadata,...v}})(n,f)}function jm(n,e){const{extra:r,tags:a,user:l,contexts:f,level:h,sdkProcessingMetadata:v,breadcrumbs:y,fingerprint:b,eventProcessors:E,attachments:O,propagationContext:j,transactionName:I,span:A}=e;gu(n,"extra",r),gu(n,"tags",a),gu(n,"user",l),gu(n,"contexts",f),n.sdkProcessingMetadata=fu(n.sdkProcessingMetadata,v,2),h&&(n.level=h),I&&(n.transactionName=I),A&&(n.span=A),y.length&&(n.breadcrumbs=[...n.breadcrumbs,...y]),b.length&&(n.fingerprint=[...n.fingerprint,...b]),E.length&&(n.eventProcessors=[...n.eventProcessors,...E]),O.length&&(n.attachments=[...n.attachments,...O]),n.propagationContext={...n.propagationContext,...j}}function gu(n,e,r){n[e]=fu(n[e],r,1)}function pb(n,e,r,a,l,f){const{normalizeDepth:h=3,normalizeMaxBreadth:v=1e3}=n,y={...e,event_id:e.event_id||r.event_id||br(),timestamp:e.timestamp||Cc()},b=r.integrations||n.integrations.map((A=>A.name));(function(A,R){const{environment:D,release:V,dist:Y,maxValueLength:ne=250}=R;A.environment=A.environment||D||Bf,!A.release&&V&&(A.release=V),!A.dist&&Y&&(A.dist=Y),A.message&&(A.message=ma(A.message,ne));const L=A.exception&&A.exception.values&&A.exception.values[0];L&&L.value&&(L.value=ma(L.value,ne));const q=A.request;q&&q.url&&(q.url=ma(q.url,ne))})(y,n),(function(A,R){R.length>0&&(A.sdk=A.sdk||{},A.sdk.integrations=[...A.sdk.integrations||[],...R])})(y,b),l&&l.emit("applyFrameMetadata",e),e.type===void 0&&(function(A,R){const D=(function(V){const Y=pt._sentryDebugIds;if(!Y)return{};const ne=Object.keys(Y);return $f&&ne.length===Lm||(Lm=ne.length,$f=ne.reduce(((L,q)=>{pu||(pu={});const H=pu[q];if(H)L[H[0]]=H[1];else{const ae=V(q);for(let ye=ae.length-1;ye>=0;ye--){const Ee=ae[ye],Ve=Ee&&Ee.filename,k=Y[q];if(Ve&&k){L[Ve]=k,pu[q]=[Ve,k];break}}}return L}),{})),$f})(R);try{A.exception.values.forEach((V=>{V.stacktrace.frames.forEach((Y=>{D&&Y.filename&&(Y.debug_id=D[Y.filename])}))}))}catch{}})(y,n.stackParser);const E=(function(A,R){if(!R)return A;const D=A?A.clone():new hs;return D.update(R),D})(a,r.captureContext);r.mechanism&&va(y,r.mechanism);const O=l?l.getEventProcessors():[],j=ru("globalScope",(()=>new hs)).getScopeData();f&&jm(j,f.getScopeData()),E&&jm(j,E.getScopeData());const I=[...r.attachments||[],...j.attachments];return I.length&&(r.attachments=I),hb(y,j),zf([...O,...j.eventProcessors],y,r).then((A=>(A&&(function(R){const D={};try{R.exception.values.forEach((Y=>{Y.stacktrace.frames.forEach((ne=>{ne.debug_id&&(ne.abs_path?D[ne.abs_path]=ne.debug_id:ne.filename&&(D[ne.filename]=ne.debug_id),delete ne.debug_id)}))}))}catch{}if(Object.keys(D).length===0)return;R.debug_meta=R.debug_meta||{},R.debug_meta.images=R.debug_meta.images||[];const V=R.debug_meta.images;Object.entries(D).forEach((([Y,ne])=>{V.push({type:"sourcemap",code_file:Y,debug_id:ne})}))})(A),typeof h=="number"&&h>0?(function(R,D,V){if(!R)return null;const Y={...R,...R.breadcrumbs&&{breadcrumbs:R.breadcrumbs.map((ne=>({...ne,...ne.data&&{data:Vi(ne.data,D,V)}})))},...R.user&&{user:Vi(R.user,D,V)},...R.contexts&&{contexts:Vi(R.contexts,D,V)},...R.extra&&{extra:Vi(R.extra,D,V)}};return R.contexts&&R.contexts.trace&&Y.contexts&&(Y.contexts.trace=R.contexts.trace,R.contexts.trace.data&&(Y.contexts.trace.data=Vi(R.contexts.trace.data,D,V))),R.spans&&(Y.spans=R.spans.map((ne=>({...ne,...ne.data&&{data:Vi(ne.data,D,V)}})))),R.contexts&&R.contexts.flags&&Y.contexts&&(Y.contexts.flags=Vi(R.contexts.flags,3,V)),Y})(A,h,v):A)))}function EE(n){}function Nm(n,e){return _o().captureEvent(n,e)}function Dm(n){const e=vn(),r=Ec(),a=_o(),{release:l,environment:f=Bf}=e&&e.getOptions()||{},{userAgent:h}=pt.navigator||{},v=Jw({release:l,environment:f,user:a.getUser()||r.getUser(),...h&&{userAgent:h},...n}),y=r.getSession();return y&&y.status==="ok"&&ya(y,{status:"exited"}),Um(),r.setSession(v),a.setSession(v),v}function Um(){const n=Ec(),e=_o(),r=e.getSession()||n.getSession();r&&(function(a,l){let f={};a.status==="ok"&&(f={status:"exited"}),ya(a,f)})(r),Bm(),n.setSession(),e.setSession()}function Bm(){const n=Ec(),e=_o(),r=vn(),a=e.getSession()||n.getSession();a&&r&&r.captureSession(a)}function Fm(n=!1){n?Um():Bm()}function gb(n,e,r){return e||`${(function(a){return`${(function(l){const f=l.protocol?`${l.protocol}:`:"",h=l.port?`:${l.port}`:"";return`${f}//${l.host}${h}${l.path?`/${l.path}`:""}/api/`})(a)}${a.projectId}/envelope/`})(n)}?${(function(a,l){const f={sentry_version:"7"};return a.publicKey&&(f.sentry_key=a.publicKey),l&&(f.sentry_client=`${l.name}/${l.version}`),new URLSearchParams(f).toString()})(n,r)}`}const Vm=[];function zm(n,e){for(const r of e)r&&r.afterAllSetup&&r.afterAllSetup(n)}function $m(n,e,r){if(r[e.name])Ct&&Ye.log(`Integration skipped because it was already installed: ${e.name}`);else{if(r[e.name]=e,Vm.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),Vm.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(n),typeof e.preprocessEvent=="function"){const a=e.preprocessEvent.bind(e);n.on("preprocessEvent",((l,f)=>a(l,f,n)))}if(typeof e.processEvent=="function"){const a=e.processEvent.bind(e),l=Object.assign(((f,h)=>a(f,h,n)),{id:e.name});n.addEventProcessor(l)}Ct&&Ye.log(`Integration installed: ${e.name}`)}}class Vr extends Error{constructor(e,r="warn"){super(e),this.message=e,this.logLevel=r}}const qm="Not capturing exception because it's already been captured.";class mb{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=ab(e.dsn):Ct&&Ye.warn("No DSN provided, client will not send events."),this._dsn){const a=gb(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:a})}const r=["enableTracing","tracesSampleRate","tracesSampler"].find((a=>a in e&&e[a]==null));r&&kc((()=>{console.warn(`[Sentry] Deprecation warning: \`${r}\` is set to undefined, which leads to tracing being enabled. In v9, a value of \`undefined\` will result in tracing being disabled.`)}))}captureException(e,r,a){const l=br();if(ym(e))return Ct&&Ye.log(qm),l;const f={event_id:l,...r};return this._process(this.eventFromException(e,f).then((h=>this._captureEvent(h,f,a)))),f.event_id}captureMessage(e,r,a,l){const f={event_id:br(),...a},h=Tf(e)?e:String(e),v=Rf(e)?this.eventFromMessage(h,r,f):this.eventFromException(e,f);return this._process(v.then((y=>this._captureEvent(y,f,l)))),f.event_id}captureEvent(e,r,a){const l=br();if(r&&r.originalException&&ym(r.originalException))return Ct&&Ye.log(qm),l;const f={event_id:l,...r},h=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,f,h||a)),f.event_id}captureSession(e){typeof e.release!="string"?Ct&&Ye.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),ya(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const r=this._transport;return r?(this.emit("flush"),this._isClientDoneProcessing(e).then((a=>r.flush(e).then((l=>a&&l))))):yo(!0)}close(e){return this.flush(e).then((r=>(this.getOptions().enabled=!1,this.emit("close"),r)))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some((({name:e})=>e.startsWith("Spotlight"))))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const r=this._integrations[e.name];$m(this,e,this._integrations),r||zm(this,[e])}sendEvent(e,r={}){this.emit("beforeSendEvent",e,r);let a=fb(e,this._dsn,this._options._metadata,this._options.tunnel);for(const f of r.attachments||[])a=cb(a,ub(f));const l=this.sendEnvelope(a);l&&l.then((f=>this.emit("afterSendEvent",e,f)),null)}sendSession(e){const r=(function(a,l,f,h){const v=xm(f);return Mc({sent_at:new Date().toISOString(),...v&&{sdk:v},...!!h&&l&&{dsn:hu(l)}},["aggregates"in a?[{type:"sessions"},a]:[{type:"session"},a.toJSON()]])})(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(r)}recordDroppedEvent(e,r,a){if(this._options.sendClientReports){const l=typeof a=="number"?a:1,f=`${e}:${r}`;Ct&&Ye.log(`Recording outcome: "${f}"${l>1?` (${l} times)`:""}`),this._outcomes[f]=(this._outcomes[f]||0)+l}}on(e,r){const a=this._hooks[e]=this._hooks[e]||[];return a.push(r),()=>{const l=a.indexOf(r);l>-1&&a.splice(l,1)}}emit(e,...r){const a=this._hooks[e];a&&a.forEach((l=>l(...r)))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,(r=>(Ct&&Ye.error("Error while sending envelope:",r),r))):(Ct&&Ye.error("Transport disabled"),yo({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=(function(r,a){const l={};return a.forEach((f=>{f&&$m(r,f,l)})),l})(this,e),zm(this,e)}_updateSessionFromEvent(e,r){let a=r.level==="fatal",l=!1;const f=r.exception&&r.exception.values;if(f){l=!0;for(const v of f){const y=v.mechanism;if(y&&y.handled===!1){a=!0;break}}}const h=e.status==="ok";(h&&e.errors===0||h&&a)&&(ya(e,{...a&&{status:"crashed"},errors:e.errors||Number(l||a)}),this.captureSession(e))}_isClientDoneProcessing(e){return new Sr((r=>{let a=0;const l=setInterval((()=>{this._numProcessing==0?(clearInterval(l),r(!0)):(a+=1,e&&a>=e&&(clearInterval(l),r(!1)))}),1)}))}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,r,a=_o(),l=Ec()){const f=this.getOptions(),h=Object.keys(this._integrations);return!r.integrations&&h.length>0&&(r.integrations=h),this.emit("preprocessEvent",e,r),e.type||l.setLastEventId(e.event_id||r.event_id),pb(f,e,r,a,this,l).then((v=>{if(v===null)return v;v.contexts={trace:Xw(a),...v.contexts};const y=(function(b,E){const O=E.getPropagationContext();return O.dsc||Tm(O.traceId,b)})(this,a);return v.sdkProcessingMetadata={dynamicSamplingContext:y,...v.sdkProcessingMetadata},v}))}_captureEvent(e,r={},a){return this._processEvent(e,r,a).then((l=>l.event_id),(l=>{Ct&&(l instanceof Vr&&l.logLevel==="log"?Ye.log(l.message):Ye.warn(l))}))}_processEvent(e,r,a){const l=this.getOptions(),{sampleRate:f}=l,h=Hm(e),v=Wm(e),y=e.type||"error",b=`before send for type \`${y}\``,E=f===void 0?void 0:(function(I){if(typeof I=="boolean")return Number(I);const A=typeof I=="string"?parseFloat(I):I;if(!(typeof A!="number"||isNaN(A)||A<0||A>1))return A;Ct&&Ye.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(I)} of type ${JSON.stringify(typeof I)}.`)})(f);if(v&&typeof E=="number"&&Math.random()>E)return this.recordDroppedEvent("sample_rate","error",e),du(new Vr(`Discarding event because it's not included in the random sample (sampling rate = ${f})`,"log"));const O=y==="replay_event"?"replay":y,j=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,r,a,j).then((I=>{if(I===null)throw this.recordDroppedEvent("event_processor",O,e),new Vr("An event processor returned `null`, will not send event.","log");if(r.data&&r.data.__sentry__===!0)return I;const A=(function(R,D,V,Y){const{beforeSend:ne,beforeSendTransaction:L,beforeSendSpan:q}=D;if(Wm(V)&&ne)return ne(V,Y);if(Hm(V)){if(V.spans&&q){const H=[];for(const ae of V.spans){const ye=q(ae);ye?H.push(ye):(ib(),R.recordDroppedEvent("before_send","span"))}V.spans=H}if(L){if(V.spans){const H=V.spans.length;V.sdkProcessingMetadata={...V.sdkProcessingMetadata,spanCountBeforeProcessing:H}}return L(V,Y)}}return V})(this,l,I,r);return(function(R,D){const V=`${D} must return \`null\` or a valid event.`;if(lu(R))return R.then((Y=>{if(!ga(Y)&&Y!==null)throw new Vr(V);return Y}),(Y=>{throw new Vr(`${D} rejected with ${Y}`)}));if(!ga(R)&&R!==null)throw new Vr(V);return R})(A,b)})).then((I=>{if(I===null){if(this.recordDroppedEvent("before_send",O,e),h){const D=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",D)}throw new Vr(`${b} returned \`null\`, will not send event.`,"log")}const A=a&&a.getSession();if(!h&&A&&this._updateSessionFromEvent(A,I),h){const D=(I.sdkProcessingMetadata&&I.sdkProcessingMetadata.spanCountBeforeProcessing||0)-(I.spans?I.spans.length:0);D>0&&this.recordDroppedEvent("before_send","span",D)}const R=I.transaction_info;if(h&&R&&I.transaction!==e.transaction){const D="custom";I.transaction_info={...R,source:D}}return this.sendEvent(I,r),I})).then(null,(I=>{throw I instanceof Vr?I:(this.captureException(I,{data:{__sentry__:!0},originalException:I}),new Vr(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${I}`))}))}_process(e){this._numProcessing++,e.then((r=>(this._numProcessing--,r)),(r=>(this._numProcessing--,r)))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map((([r,a])=>{const[l,f]=r.split(":");return{reason:l,category:f,quantity:a}}))}_flushOutcomes(){Ct&&Ye.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0)return void(Ct&&Ye.log("No outcomes to send"));if(!this._dsn)return void(Ct&&Ye.log("No dsn provided, will not send outcomes"));Ct&&Ye.log("Sending outcomes:",e);const r=(a=e,Mc((l=this._options.tunnel&&hu(this._dsn))?{dsn:l}:{},[[{type:"client_report"},{timestamp:f||Cc(),discarded_events:a}]]));var a,l,f;this.sendEnvelope(r)}}function Wm(n){return n.type===void 0}function Hm(n){return n.type==="transaction"}function vb(n){const e=[];function r(a){return e.splice(e.indexOf(a),1)[0]||Promise.resolve(void 0)}return{$:e,add:function(a){if(!(n===void 0||e.length<n))return du(new Vr("Not adding Promise because buffer limit was reached."));const l=a();return e.indexOf(l)===-1&&e.push(l),l.then((()=>r(l))).then(null,(()=>r(l).then(null,(()=>{})))),l},drain:function(a){return new Sr(((l,f)=>{let h=e.length;if(!h)return l(!0);const v=setTimeout((()=>{a&&a>0&&l(!1)}),a);e.forEach((y=>{yo(y).then((()=>{--h||(clearTimeout(v),l(!0))}),f)}))}))}}}function yb(n,{statusCode:e,headers:r},a=Date.now()){const l={...n},f=r&&r["x-sentry-rate-limits"],h=r&&r["retry-after"];if(f)for(const v of f.trim().split(",")){const[y,b,,,E]=v.split(":",5),O=parseInt(y,10),j=1e3*(isNaN(O)?60:O);if(b)for(const I of b.split(";"))I==="metric_bucket"&&E&&!E.split(";").includes("custom")||(l[I]=a+j);else l.all=a+j}else h?l.all=a+(function(v,y=Date.now()){const b=parseInt(`${v}`,10);if(!isNaN(b))return 1e3*b;const E=Date.parse(`${v}`);return isNaN(E)?6e4:E-y})(h,a):e===429&&(l.all=a+6e4);return l}function _b(n,e,r=vb(n.bufferSize||64)){let a={};return{send:function(l){const f=[];if(Pm(l,((y,b)=>{const E=Im(b);if((function(O,j,I=Date.now()){return(function(A,R){return A[R]||A.all||0})(O,j)>I})(a,E)){const O=Gm(y,b);n.recordDroppedEvent("ratelimit_backoff",E,O)}else f.push(y)})),f.length===0)return yo({});const h=Mc(l[0],f),v=y=>{Pm(h,((b,E)=>{const O=Gm(b,E);n.recordDroppedEvent(y,Im(E),O)}))};return r.add((()=>e({body:lb(h)}).then((y=>(y.statusCode!==void 0&&(y.statusCode<200||y.statusCode>=300)&&Ct&&Ye.warn(`Sentry responded with status code ${y.statusCode} to sent event.`),a=yb(a,y),y)),(y=>{throw v("network_error"),y})))).then((y=>y),(y=>{if(y instanceof Vr)return Ct&&Ye.error("Skipped sending event because buffer is full."),v("queue_overflow"),yo({});throw y}))},flush:l=>r.drain(l)}}function Gm(n,e){if(e==="event"||e==="transaction")return Array.isArray(n)?n[1]:void 0}const wb=100;function wo(n,e){const r=vn(),a=Ec();if(!r)return;const{beforeBreadcrumb:l=null,maxBreadcrumbs:f=wb}=r.getOptions();if(f<=0)return;const h={timestamp:Cc(),...n},v=l?kc((()=>l(h,e))):h;v!==null&&(r.emit&&r.emit("beforeAddBreadcrumb",v,e),a.addBreadcrumb(v,f))}let Jm;const Qm=new WeakMap,bb=()=>({name:"FunctionToString",setupOnce(){Jm=Function.prototype.toString;try{Function.prototype.toString=function(...n){const e=Pf(this),r=Qm.has(vn())&&e!==void 0?e:this;return Jm.apply(r,n)}}catch{}},setup(n){Qm.set(n,!0)}}),Sb=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/],kb=(n={})=>({name:"InboundFilters",processEvent(e,r,a){const l=a.getOptions(),f=(function(h={},v={}){return{allowUrls:[...h.allowUrls||[],...v.allowUrls||[]],denyUrls:[...h.denyUrls||[],...v.denyUrls||[]],ignoreErrors:[...h.ignoreErrors||[],...v.ignoreErrors||[],...h.disableErrorDefaults?[]:Sb],ignoreTransactions:[...h.ignoreTransactions||[],...v.ignoreTransactions||[]],ignoreInternal:h.ignoreInternal===void 0||h.ignoreInternal}})(n,l);return(function(h,v){return v.ignoreInternal&&(function(y){try{return y.exception.values[0].type==="SentryError"}catch{}return!1})(h)?(Ct&&Ye.warn(`Event dropped due to being internal Sentry Error.
Event: ${fs(h)}`),!0):(function(y,b){return y.type||!b||!b.length?!1:(function(E){const O=[];E.message&&O.push(E.message);let j;try{j=E.exception.values[E.exception.values.length-1]}catch{}return j&&j.value&&(O.push(j.value),j.type&&O.push(`${j.type}: ${j.value}`)),O})(y).some((E=>uu(E,b)))})(h,v.ignoreErrors)?(Ct&&Ye.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${fs(h)}`),!0):(function(y){return y.type||!y.exception||!y.exception.values||y.exception.values.length===0?!1:!y.message&&!y.exception.values.some((b=>b.stacktrace||b.type&&b.type!=="Error"||b.value))})(h)?(Ct&&Ye.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${fs(h)}`),!0):(function(y,b){if(y.type!=="transaction"||!b||!b.length)return!1;const E=y.transaction;return!!E&&uu(E,b)})(h,v.ignoreTransactions)?(Ct&&Ye.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${fs(h)}`),!0):(function(y,b){if(!b||!b.length)return!1;const E=mu(y);return!!E&&uu(E,b)})(h,v.denyUrls)?(Ct&&Ye.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${fs(h)}.
Url: ${mu(h)}`),!0):(function(y,b){if(!b||!b.length)return!0;const E=mu(y);return!E||uu(E,b)})(h,v.allowUrls)?!1:(Ct&&Ye.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${fs(h)}.
Url: ${mu(h)}`),!0)})(e,f)?null:e}});function mu(n){try{let e;try{e=n.exception.values[0].stacktrace.frames}catch{}return e?(function(r=[]){for(let a=r.length-1;a>=0;a--){const l=r[a];if(l&&l.filename!=="<anonymous>"&&l.filename!=="[native code]")return l.filename||null}return null})(e):null}catch{return Ct&&Ye.error(`Cannot extract url for event ${fs(n)}`),null}}function Cb(n,e,r=250,a,l,f,h){if(!(f.exception&&f.exception.values&&h&&mo(h.originalException,Error)))return;const v=f.exception.values.length>0?f.exception.values[f.exception.values.length-1]:void 0;var y,b;v&&(f.exception.values=(y=qf(n,e,l,h.originalException,a,f.exception.values,v,0),b=r,y.map((E=>(E.value&&(E.value=ma(E.value,b)),E)))))}function qf(n,e,r,a,l,f,h,v){if(f.length>=r+1)return f;let y=[...f];if(mo(a[l],Error)){Km(h,v);const b=n(e,a[l]),E=y.length;Ym(b,l,E,v),y=qf(n,e,r,a[l],l,[b,...y],b,E)}return Array.isArray(a.errors)&&a.errors.forEach(((b,E)=>{if(mo(b,Error)){Km(h,v);const O=n(e,b),j=y.length;Ym(O,`errors[${E}]`,j,v),y=qf(n,e,r,b,l,[O,...y],O,j)}})),y}function Km(n,e){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,...n.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function Ym(n,e,r,a){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,type:"chained",source:e,exception_id:r,parent_id:a}}function Wf(n){if(!n)return{};const e=n.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const r=e[6]||"",a=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:r,hash:a,relative:e[5]+r+a}}function Eb(){"console"in pt&&kf.forEach((function(n){n in pt.console&&ur(pt.console,n,(function(e){return iu[n]=e,function(...r){Fr("console",{args:r,level:n});const a=iu[n];a&&a.apply(pt.console,r)}}))}))}function Mb(n){return n==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(n)?n:"log"}const Ob=()=>{let n;return{name:"Dedupe",processEvent(e){if(e.type)return e;try{if((function(r,a){return a?!!((function(l,f){const h=l.message,v=f.message;return!(!h&&!v||h&&!v||!h&&v||h!==v||!Zm(l,f)||!Xm(l,f))})(r,a)||(function(l,f){const h=ev(f),v=ev(l);return!(!h||!v||h.type!==v.type||h.value!==v.value||!Zm(l,f)||!Xm(l,f))})(r,a)):!1})(e,n))return Ct&&Ye.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return n=e}}};function Xm(n,e){let r=sm(n),a=sm(e);if(!r&&!a)return!0;if(r&&!a||!r&&a||a.length!==r.length)return!1;for(let l=0;l<a.length;l++){const f=a[l],h=r[l];if(f.filename!==h.filename||f.lineno!==h.lineno||f.colno!==h.colno||f.function!==h.function)return!1}return!0}function Zm(n,e){let r=n.fingerprint,a=e.fingerprint;if(!r&&!a)return!0;if(r&&!a||!r&&a)return!1;try{return r.join("")===a.join("")}catch{return!1}}function ev(n){return n.exception&&n.exception.values&&n.exception.values[0]}function tv(n){return n===void 0?void 0:n>=400&&n<500?"warning":n>=500?"error":void 0}const Hf=pt;function Gf(n){return n&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(n.toString())}function Tb(){if(typeof EdgeRuntime=="string")return!0;if(!(function(){if(!("fetch"in Hf))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}})())return!1;if(Gf(Hf.fetch))return!0;let n=!1;const e=Hf.document;if(e&&typeof e.createElement=="function")try{const r=e.createElement("iframe");r.hidden=!0,e.head.appendChild(r),r.contentWindow&&r.contentWindow.fetch&&(n=Gf(r.contentWindow.fetch)),e.head.removeChild(r)}catch(r){fo&&Ye.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",r)}return n}function Rb(n,e){const r="fetch";po(r,n),go(r,(()=>(function(a,l=!1){l&&!Tb()||ur(pt,"fetch",(function(f){return function(...h){const v=new Error,{method:y,url:b}=(function(O){if(O.length===0)return{method:"GET",url:""};if(O.length===2){const[I,A]=O;return{url:nv(I),method:Jf(A,"method")?String(A.method).toUpperCase():"GET"}}const j=O[0];return{url:nv(j),method:Jf(j,"method")?String(j.method).toUpperCase():"GET"}})(h),E={args:h,fetchData:{method:y,url:b},startTimestamp:1e3*Bi(),virtualError:v};return a||Fr("fetch",{...E}),f.apply(pt,h).then((async O=>(a?a(O):Fr("fetch",{...E,endTimestamp:1e3*Bi(),response:O}),O)),(O=>{throw Fr("fetch",{...E,endTimestamp:1e3*Bi(),error:O}),Of(O)&&O.stack===void 0&&(O.stack=v.stack,vo(O,"framesToPop",1)),O}))}}))})(void 0,e)))}function Jf(n,e){return!!n&&typeof n=="object"&&!!n[e]}function nv(n){return typeof n=="string"?n:n?Jf(n,"url")?n.url:n.toString?n.toString():"":""}const vu=pt,Zt=pt;let Qf=0;function rv(){return Qf>0}function wa(n,e={}){if(!(function(a){return typeof a=="function"})(n))return n;try{const a=n.__sentry_wrapped__;if(a)return typeof a=="function"?a:n;if(Pf(n))return n}catch{return n}const r=function(...a){try{const l=a.map((f=>wa(f,e)));return n.apply(this,l)}catch(l){throw Qf++,setTimeout((()=>{Qf--})),(function(...f){const h=Df(au());if(f.length===2){const[v,y]=f;return v?h.withSetScope(v,y):h.withScope(y)}h.withScope(f[0])})((f=>{var h;f.addEventProcessor((v=>(e.mechanism&&(xf(v,void 0),va(v,e.mechanism)),v.extra={...v.extra,arguments:a},v))),h=l,_o().captureException(h,void 0)})),l}};try{for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])}catch{}hm(r,n),vo(n,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get:()=>n.name})}catch{}return r}const yu=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function Kf(n,e){const r=Xf(n,e),a={type:Ib(e),value:xb(e)};return r.length&&(a.stacktrace={frames:r}),a.type===void 0&&a.value===""&&(a.value="Unrecoverable error caught"),a}function Ab(n,e,r,a){const l=vn(),f=l&&l.getOptions().normalizeDepth,h=(function(b){for(const E in b)if(Object.prototype.hasOwnProperty.call(b,E)){const O=b[E];if(O instanceof Error)return O}})(e),v={__serialized__:Am(e,f)};if(h)return{exception:{values:[Kf(n,h)]},extra:v};const y={exception:{values:[{type:cu(e)?e.constructor.name:a?"UnhandledRejection":"Error",value:Lb(e,{isUnhandledRejection:a})}]},extra:v};if(r){const b=Xf(n,r);b.length&&(y.exception.values[0].stacktrace={frames:b})}return y}function Yf(n,e){return{exception:{values:[Kf(n,e)]}}}function Xf(n,e){const r=e.stacktrace||e.stack||"",a=(function(f){return f&&Pb.test(f.message)?1:0})(e),l=(function(f){return typeof f.framesToPop=="number"?f.framesToPop:0})(e);try{return n(r,a,l)}catch{}return[]}const Pb=/Minified React error #\d+;/i;function iv(n){return typeof WebAssembly<"u"&&WebAssembly.Exception!==void 0&&n instanceof WebAssembly.Exception}function Ib(n){const e=n&&n.name;return!e&&iv(n)?n.message&&Array.isArray(n.message)&&n.message.length==2?n.message[0]:"WebAssembly.Exception":e}function xb(n){const e=n&&n.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:iv(n)&&Array.isArray(n.message)&&n.message.length==2?n.message[1]:e:"No error message"}function Zf(n,e,r,a,l){let f;if(cm(e)&&e.error)return Yf(n,e.error);if(lm(e)||pa(e,"DOMException")){const h=e;if("stack"in e)f=Yf(n,e);else{const v=h.name||(lm(h)?"DOMError":"DOMException"),y=h.message?`${v}: ${h.message}`:v;f=eh(n,y,r,a),xf(f,y)}return"code"in h&&(f.tags={...f.tags,"DOMException.code":`${h.code}`}),f}return Of(e)?Yf(n,e):ga(e)||cu(e)?(f=Ab(n,e,r,l),va(f,{synthetic:!0}),f):(f=eh(n,e,r,a),xf(f,`${e}`),va(f,{synthetic:!0}),f)}function eh(n,e,r,a){const l={};if(a&&r){const f=Xf(n,r);f.length&&(l.exception={values:[{value:e,stacktrace:{frames:f}}]}),va(l,{synthetic:!0})}if(Tf(e)){const{__sentry_template_string__:f,__sentry_template_values__:h}=e;return l.logentry={message:f,params:h},l}return l.message=e,l}function Lb(n,{isUnhandledRejection:e}){const r=(function(l,f=40){const h=Object.keys(pm(l));h.sort();const v=h[0];if(!v)return"[object has no keys]";if(v.length>=f)return ma(v,f);for(let y=h.length;y>0;y--){const b=h.slice(0,y).join(", ");if(!(b.length>f))return y===h.length?b:ma(b,f)}return""})(n),a=e?"promise rejection":"exception";return cm(n)?`Event \`ErrorEvent\` captured as ${a} with message \`${n.message}\``:cu(n)?`Event \`${(function(l){try{const f=Object.getPrototypeOf(l);return f?f.constructor.name:void 0}catch{}})(n)}\` (type=${n.type}) captured as ${a}`:`Object captured as ${a} with keys: ${r}`}let jb=class extends mb{constructor(e){const r={parentSpanIsAlwaysRootSpan:!0,...e};(function(a,l,f=[l],h="npm"){const v=a._metadata||{};v.sdk||(v.sdk={name:`sentry.javascript.${l}`,packages:f.map((y=>({name:`${h}:@sentry/${y}`,version:uo}))),version:uo}),a._metadata=v})(r,"browser",["browser"],Zt.SENTRY_SDK_SOURCE||"npm"),super(r),r.sendClientReports&&Zt.document&&Zt.document.addEventListener("visibilitychange",(()=>{Zt.document.visibilityState==="hidden"&&this._flushOutcomes()}))}eventFromException(e,r){return(function(a,l,f,h){const v=Zf(a,l,f&&f.syntheticException||void 0,h);return va(v),v.level="error",f&&f.event_id&&(v.event_id=f.event_id),yo(v)})(this._options.stackParser,e,r,this._options.attachStacktrace)}eventFromMessage(e,r="info",a){return(function(l,f,h="info",v,y){const b=eh(l,f,v&&v.syntheticException||void 0,y);return b.level=h,v&&v.event_id&&(b.event_id=v.event_id),yo(b)})(this._options.stackParser,e,r,a,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled())return void(yu&&Ye.warn("SDK not enabled, will not capture user feedback."));const r=(function(a,{metadata:l,tunnel:f,dsn:h}){const v={event_id:a.event_id,sent_at:new Date().toISOString(),...l&&l.sdk&&{sdk:{name:l.sdk.name,version:l.sdk.version}},...!!f&&!!h&&{dsn:hu(h)}};return Mc(v,[(function(b){return[{type:"user_report"},b]})(a)])})(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(r)}_prepareEvent(e,r,a){return e.platform=e.platform||"javascript",super._prepareEvent(e,r,a)}};const Nb=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,xn=pt;let sv,th,nh,_u;function Db(){if(!xn.document)return;const n=Fr.bind(null,"dom"),e=ov(n,!0);xn.document.addEventListener("click",e,!1),xn.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach((r=>{const a=xn[r],l=a&&a.prototype;l&&l.hasOwnProperty&&l.hasOwnProperty("addEventListener")&&(ur(l,"addEventListener",(function(f){return function(h,v,y){if(h==="click"||h=="keypress")try{const b=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},E=b[h]=b[h]||{refCount:0};if(!E.handler){const O=ov(n);E.handler=O,f.call(this,h,O,y)}E.refCount++}catch{}return f.call(this,h,v,y)}})),ur(l,"removeEventListener",(function(f){return function(h,v,y){if(h==="click"||h=="keypress")try{const b=this.__sentry_instrumentation_handlers__||{},E=b[h];E&&(E.refCount--,E.refCount<=0&&(f.call(this,h,E.handler,y),E.handler=void 0,delete b[h]),Object.keys(b).length===0&&delete this.__sentry_instrumentation_handlers__)}catch{}return f.call(this,h,v,y)}})))}))}function ov(n,e=!1){return r=>{if(!r||r._sentryCaptured)return;const a=(function(f){try{return f.target}catch{return null}})(r);if((function(f,h){return f==="keypress"&&(!h||!h.tagName||h.tagName!=="INPUT"&&h.tagName!=="TEXTAREA"&&!h.isContentEditable)})(r.type,a))return;vo(r,"_sentryCaptured",!0),a&&!a._sentryId&&vo(a,"_sentryId",br());const l=r.type==="keypress"?"input":r.type;(function(f){if(f.type!==th)return!1;try{if(!f.target||f.target._sentryId!==nh)return!1}catch{}return!0})(r)||(n({event:r,name:l,global:e}),th=r.type,nh=a?a._sentryId:void 0),clearTimeout(sv),sv=xn.setTimeout((()=>{nh=void 0,th=void 0}),1e3)}}function av(n){const e="history";po(e,n),go(e,Ub)}function Ub(){if(!(function(){const r=vu.chrome,a=r&&r.app&&r.app.runtime,l="history"in vu&&!!vu.history.pushState&&!!vu.history.replaceState;return!a&&l})())return;const n=xn.onpopstate;function e(r){return function(...a){const l=a.length>2?a[2]:void 0;if(l){const f=_u,h=String(l);_u=h,Fr("history",{from:f,to:h})}return r.apply(this,a)}}xn.onpopstate=function(...r){const a=xn.location.href,l=_u;if(_u=a,Fr("history",{from:l,to:a}),n)try{return n.apply(this,r)}catch{}},ur(xn.history,"pushState",e),ur(xn.history,"replaceState",e)}const wu={};function cv(n){wu[n]=void 0}const Oc="__sentry_xhr_v3__";function Bb(){if(!xn.XMLHttpRequest)return;const n=XMLHttpRequest.prototype;n.open=new Proxy(n.open,{apply(e,r,a){const l=new Error,f=1e3*Bi(),h=Ui(a[0])?a[0].toUpperCase():void 0,v=(function(b){if(Ui(b))return b;try{return b.toString()}catch{}})(a[1]);if(!h||!v)return e.apply(r,a);r[Oc]={method:h,url:v,request_headers:{}},h==="POST"&&v.match(/sentry_key/)&&(r.__sentry_own_request__=!0);const y=()=>{const b=r[Oc];if(b&&r.readyState===4){try{b.status_code=r.status}catch{}Fr("xhr",{endTimestamp:1e3*Bi(),startTimestamp:f,xhr:r,virtualError:l})}};return"onreadystatechange"in r&&typeof r.onreadystatechange=="function"?r.onreadystatechange=new Proxy(r.onreadystatechange,{apply:(b,E,O)=>(y(),b.apply(E,O))}):r.addEventListener("readystatechange",y),r.setRequestHeader=new Proxy(r.setRequestHeader,{apply(b,E,O){const[j,I]=O,A=E[Oc];return A&&Ui(j)&&Ui(I)&&(A.request_headers[j.toLowerCase()]=I),b.apply(E,O)}}),e.apply(r,a)}}),n.send=new Proxy(n.send,{apply(e,r,a){const l=r[Oc];return l?(a[0]!==void 0&&(l.body=a[0]),Fr("xhr",{startTimestamp:1e3*Bi(),xhr:r}),e.apply(r,a)):e.apply(r,a)}})}function Fb(n,e=(function(r){const a=wu[r];if(a)return a;let l=xn[r];if(Gf(l))return wu[r]=l.bind(xn);const f=xn.document;if(f&&typeof f.createElement=="function")try{const h=f.createElement("iframe");h.hidden=!0,f.head.appendChild(h);const v=h.contentWindow;v&&v[r]&&(l=v[r]),f.head.removeChild(h)}catch(h){Nb&&Ye.warn(`Could not create sandbox iframe for ${r} check, bailing to window.${r}: `,h)}return l&&(wu[r]=l.bind(xn))})("fetch")){let r=0,a=0;return _b(n,(function(l){const f=l.body.length;r+=f,a++;const h={body:l.body,method:"POST",referrerPolicy:"origin",headers:n.headers,keepalive:r<=6e4&&a<15,...n.fetchOptions};if(!e)return cv("fetch"),du("No fetch implementation available");try{return e(n.url,h).then((v=>(r-=f,a--,{statusCode:v.status,headers:{"x-sentry-rate-limits":v.headers.get("X-Sentry-Rate-Limits"),"retry-after":v.headers.get("Retry-After")}})))}catch(v){return cv("fetch"),r-=f,a--,du(v)}}))}function rh(n,e,r,a){const l={filename:n,function:e==="<anonymous>"?ho:e,in_app:!0};return r!==void 0&&(l.lineno=r),a!==void 0&&(l.colno=a),l}const Vb=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,zb=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,$b=/\((\S*)(?::(\d+))(?::(\d+))\)/,qb=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,Wb=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Hb=(function(...n){const e=n.sort(((r,a)=>r[0]-a[0])).map((r=>r[1]));return(r,a=0,l=0)=>{const f=[],h=r.split(`
`);for(let v=a;v<h.length;v++){const y=h[v];if(y.length>1024)continue;const b=nm.test(y)?y.replace(nm,"$1"):y;if(!b.match(/\S*Error: /)){for(const E of e){const O=E(b);if(O){f.push(O);break}}if(f.length>=50+l)break}}return(function(v){if(!v.length)return[];const y=Array.from(v);return/sentryWrapped/.test(su(y).function||"")&&y.pop(),y.reverse(),rm.test(su(y).function||"")&&(y.pop(),rm.test(su(y).function||"")&&y.pop()),y.slice(0,50).map((b=>({...b,filename:b.filename||su(y).filename,function:b.function||ho})))})(f.slice(l))}})([30,n=>{const e=Vb.exec(n);if(e){const[,a,l,f]=e;return rh(a,ho,+l,+f)}const r=zb.exec(n);if(r){if(r[2]&&r[2].indexOf("eval")===0){const f=$b.exec(r[2]);f&&(r[2]=f[1],r[3]=f[2],r[4]=f[3])}const[a,l]=lv(r[1]||ho,r[2]);return rh(l,a,r[3]?+r[3]:void 0,r[4]?+r[4]:void 0)}}],[50,n=>{const e=qb.exec(n);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const l=Wb.exec(e[3]);l&&(e[1]=e[1]||"eval",e[3]=l[1],e[4]=l[2],e[5]="")}let r=e[3],a=e[1]||ho;return[a,r]=lv(a,r),rh(r,a,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}}]),lv=(n,e)=>{const r=n.indexOf("safari-extension")!==-1,a=n.indexOf("safari-web-extension")!==-1;return r||a?[n.indexOf("@")!==-1?n.split("@")[0]:ho,r?`safari-extension:${e}`:`safari-web-extension:${e}`]:[n,e]},uv=1024,Gb=(n={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...n};return{name:"Breadcrumbs",setup(r){var a;e.console&&(function(l){const f="console";po(f,l),go(f,Eb)})((function(l){return function(f){if(vn()!==l)return;const h={category:"console",data:{arguments:f.args,logger:"console"},level:Mb(f.level),message:fm(f.args," ")};if(f.level==="assert"){if(f.args[0]!==!1)return;h.message=`Assertion failed: ${fm(f.args.slice(1)," ")||"console.assert"}`,h.data.arguments=f.args.slice(1)}wo(h,{input:f.args,level:f.level})}})(r)),e.dom&&(a=(function(l,f){return function(h){if(vn()!==l)return;let v,y,b=typeof f=="object"?f.serializeAttribute:void 0,E=typeof f=="object"&&typeof f.maxStringLength=="number"?f.maxStringLength:void 0;E&&E>uv&&(yu&&Ye.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${E} was configured. Sentry will use 1024 instead.`),E=uv),typeof b=="string"&&(b=[b]);try{const j=h.event,I=(function(A){return!!A&&!!A.target})(j)?j.target:j;v=dm(I,{keyAttrs:b,maxStringLength:E}),y=(function(A){if(!Af.HTMLElement)return null;let R=A;for(let D=0;D<5;D++){if(!R)return null;if(R instanceof HTMLElement){if(R.dataset.sentryComponent)return R.dataset.sentryComponent;if(R.dataset.sentryElement)return R.dataset.sentryElement}R=R.parentNode}return null})(I)}catch{v="<unknown>"}if(v.length===0)return;const O={category:`ui.${h.name}`,message:v};y&&(O.data={"ui.component_name":y}),wo(O,{event:h.event,name:h.name,global:h.global})}})(r,e.dom),po("dom",a),go("dom",Db)),e.xhr&&(function(l){po("xhr",l),go("xhr",Bb)})((function(l){return function(f){if(vn()!==l)return;const{startTimestamp:h,endTimestamp:v}=f,y=f.xhr[Oc];if(!h||!v||!y)return;const{method:b,url:E,status_code:O,body:j}=y,I={method:b,url:E,status_code:O},A={xhr:f.xhr,input:j,startTimestamp:h,endTimestamp:v};wo({category:"xhr",data:I,type:"http",level:tv(O)},A)}})(r)),e.fetch&&Rb((function(l){return function(f){if(vn()!==l)return;const{startTimestamp:h,endTimestamp:v}=f;if(v&&(!f.fetchData.url.match(/sentry_key/)||f.fetchData.method!=="POST"))if(f.error)wo({category:"fetch",data:f.fetchData,level:"error",type:"http"},{data:f.error,input:f.args,startTimestamp:h,endTimestamp:v});else{const y=f.response,b={...f.fetchData,status_code:y&&y.status},E={input:f.args,response:y,startTimestamp:h,endTimestamp:v};wo({category:"fetch",data:b,type:"http",level:tv(b.status_code)},E)}}})(r)),e.history&&av((function(l){return function(f){if(vn()!==l)return;let h=f.from,v=f.to;const y=Wf(Zt.location.href);let b=h?Wf(h):void 0;const E=Wf(v);b&&b.path||(b=y),y.protocol===E.protocol&&y.host===E.host&&(v=E.relative),y.protocol===b.protocol&&y.host===b.host&&(h=b.relative),wo({category:"navigation",data:{from:h,to:v}})}})(r)),e.sentry&&r.on("beforeSendEvent",(function(l){return function(f){vn()===l&&wo({category:"sentry."+(f.type==="transaction"?"transaction":"event"),event_id:f.event_id,level:f.level,message:fs(f)},{event:f})}})(r))}}},Jb=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],Qb=(n={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...n};return{name:"BrowserApiErrors",setupOnce(){e.setTimeout&&ur(Zt,"setTimeout",dv),e.setInterval&&ur(Zt,"setInterval",dv),e.requestAnimationFrame&&ur(Zt,"requestAnimationFrame",Kb),e.XMLHttpRequest&&"XMLHttpRequest"in Zt&&ur(XMLHttpRequest.prototype,"send",Yb);const r=e.eventTarget;r&&(Array.isArray(r)?r:Jb).forEach(Xb)}}};function dv(n){return function(...e){const r=e[0];return e[0]=wa(r,{mechanism:{data:{function:ds(n)},handled:!1,type:"instrument"}}),n.apply(this,e)}}function Kb(n){return function(e){return n.apply(this,[wa(e,{mechanism:{data:{function:"requestAnimationFrame",handler:ds(n)},handled:!1,type:"instrument"}})])}}function Yb(n){return function(...e){const r=this;return["onload","onerror","onprogress","onreadystatechange"].forEach((a=>{a in r&&typeof r[a]=="function"&&ur(r,a,(function(l){const f={mechanism:{data:{function:a,handler:ds(l)},handled:!1,type:"instrument"}},h=Pf(l);return h&&(f.mechanism.data.handler=ds(h)),wa(l,f)}))})),n.apply(this,e)}}function Xb(n){const e=Zt[n],r=e&&e.prototype;r&&r.hasOwnProperty&&r.hasOwnProperty("addEventListener")&&(ur(r,"addEventListener",(function(a){return function(l,f,h){try{typeof f.handleEvent=="function"&&(f.handleEvent=wa(f.handleEvent,{mechanism:{data:{function:"handleEvent",handler:ds(f),target:n},handled:!1,type:"instrument"}}))}catch{}return a.apply(this,[l,wa(f,{mechanism:{data:{function:"addEventListener",handler:ds(f),target:n},handled:!1,type:"instrument"}}),h])}})),ur(r,"removeEventListener",(function(a){return function(l,f,h){try{const v=f.__sentry_wrapped__;v&&a.call(this,l,v,h)}catch{}return a.call(this,l,f,h)}})))}const Zb=()=>({name:"BrowserSession",setupOnce(){Zt.document!==void 0?(Dm({ignoreDuration:!0}),Fm(),av((({from:n,to:e})=>{n!==void 0&&n!==e&&(Dm({ignoreDuration:!0}),Fm())}))):yu&&Ye.warn("Using the `browserSessionIntegration` in non-browser environments is not supported.")}}),eS=(n={})=>{const e={onerror:!0,onunhandledrejection:!0,...n};return{name:"GlobalHandlers",setupOnce(){Error.stackTraceLimit=50},setup(r){e.onerror&&((function(a){(function(l){const f="error";po(f,l),go(f,qw)})((l=>{const{stackParser:f,attachStacktrace:h}=hv();if(vn()!==a||rv())return;const{msg:v,url:y,line:b,column:E,error:O}=l,j=(function(I,A,R,D){const V=I.exception=I.exception||{},Y=V.values=V.values||[],ne=Y[0]=Y[0]||{},L=ne.stacktrace=ne.stacktrace||{},q=L.frames=L.frames||[],H=D,ae=R,ye=Ui(A)&&A.length>0?A:(function(){try{return Af.document.location.href}catch{return""}})();return q.length===0&&q.push({colno:H,filename:ye,function:ho,in_app:!0,lineno:ae}),I})(Zf(f,O||v,void 0,h,!1),y,b,E);j.level="error",Nm(j,{originalException:O,mechanism:{handled:!1,type:"onerror"}})}))})(r),fv("onerror")),e.onunhandledrejection&&((function(a){(function(l){const f="unhandledrejection";po(f,l),go(f,Ww)})((l=>{const{stackParser:f,attachStacktrace:h}=hv();if(vn()!==a||rv())return;const v=(function(b){if(Rf(b))return b;try{if("reason"in b)return b.reason;if("detail"in b&&"reason"in b.detail)return b.detail.reason}catch{}return b})(l),y=Rf(v)?{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(v)}`}]}}:Zf(f,v,void 0,h,!0);y.level="error",Nm(y,{originalException:v,mechanism:{handled:!1,type:"onunhandledrejection"}})}))})(r),fv("onunhandledrejection"))}}};function fv(n){yu&&Ye.log(`Global Handler attached: ${n}`)}function hv(){const n=vn();return n&&n.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const tS=()=>({name:"HttpContext",preprocessEvent(n){if(!Zt.navigator&&!Zt.location&&!Zt.document)return;const e=n.request&&n.request.url||Zt.location&&Zt.location.href,{referrer:r}=Zt.document||{},{userAgent:a}=Zt.navigator||{},l={...n.request&&n.request.headers,...r&&{Referer:r},...a&&{"User-Agent":a}},f={...n.request,...e&&{url:e},headers:l};n.request=f}}),nS=(n={})=>{const e=n.limit||5,r=n.key||"cause";return{name:"LinkedErrors",preprocessEvent(a,l,f){const h=f.getOptions();Cb(Kf,h.stackParser,h.maxValueLength,r,e,a,l)}}};var pv="new",gv="loading",mv="loaded",ih="joining-meeting",bo="joined-meeting",So="left-meeting",ps="error",rS="playable",sh="unknown",iS="full",sS="base",vv="no-room",oS="end-of-life",aS="connection-error",cS="iframe-ready-for-launch-config",lS="iframe-launch-config",uS="theme-updated",dS="loading",fS="load-attempt-failed",yv="loaded",hS="started-camera",pS="camera-error",gS="joining-meeting",mS="joined-meeting",vS="left-meeting",yS="participant-joined",_S="participant-updated",wS="participant-left",bS="participant-counts-updated",SS="access-state-updated",kS="meeting-session-summary-updated",CS="meeting-session-state-updated",ES="waiting-participant-added",MS="waiting-participant-updated",OS="waiting-participant-removed",TS="track-started",RS="track-stopped",AS="transcription-started",PS="transcription-stopped",IS="transcription-error",_v="recording-started",wv="recording-stopped",xS="recording-stats",LS="recording-error",jS="recording-upload-completed",NS="recording-data",DS="app-message",US="transcription-message",BS="remote-media-player-started",FS="remote-media-player-updated",VS="remote-media-player-stopped",zS="local-screen-share-started",$S="local-screen-share-stopped",qS="local-screen-share-canceled",WS="active-speaker-change",HS="active-speaker-mode-change",GS="network-quality-change",JS="network-connection",QS="cpu-load-change",KS="face-counts-updated",bu="fullscreen",Su="exited-fullscreen",YS="live-streaming-started",XS="live-streaming-updated",ZS="live-streaming-stopped",ek="live-streaming-error",tk="lang-updated",nk="receive-settings-updated",bv="input-settings-updated",Sv="nonfatal-error",kv="error",oh=4096,Cv=102400,ah="iframe-call-message",Ev="local-screen-start",Mv="daily-method-update-live-streaming-endpoints",ku="transmit-log",zi="daily-custom-track",Cu={NONE:"none",BGBLUR:"background-blur",BGIMAGE:"background-image",FACE_DETECTION:"face-detection"},Ov={NONE:"none",NOISE_CANCELLATION:"noise-cancellation"},ch={PLAY:"play",PAUSE:"pause"},lh=["jpg","png","jpeg"],rk="add-endpoints",ik="remove-endpoints",Tv="sip-call-transfer";function kr(){return!ot()&&typeof window<"u"&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:""}function ot(){return typeof navigator<"u"&&navigator.product&&navigator.product==="ReactNative"}function Rv(){return navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia}function sk(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)&&((function(n,e){if(!n||!e)return!0;switch(n){case"Chrome":return e.major>=75;case"Safari":return RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")&&!(e.major===13&&e.minor===0&&e.point===0);case"Firefox":return e.major>=67}return!0})(ko(),Eu())||ot())}function Av(){if(ot()||!document)return!1;var n=document.createElement("iframe");return!!n.requestFullscreen||!!n.webkitRequestFullscreen}var uh="none",ok="software",ak="hardware",ck=(function(){try{var n,e=document.createElement("canvas"),r=!1;(n=e.getContext("webgl2",{failIfMajorPerformanceCaveat:!0}))||(r=!0,n=e.getContext("webgl2"));var a=n!=null;return e.remove(),a?r?ok:ak:uh}catch{return uh}})();function Pv(){var n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return!ot()&&ck!==uh&&(n?(function(){return Lv()?!1:["Chrome","Firefox"].includes(ko())})():(function(){if(Lv())return!1;var e=ko();if(e==="Safari"){var r=hh();if(r.major<15||r.major===15&&r.minor<4)return!1}return e==="Chrome"?fh().major>=77:e==="Firefox"?ph().major>=97:["Chrome","Firefox","Safari"].includes(e)})())}function Iv(){if(ot()||xv()||typeof AudioWorkletNode>"u")return!1;switch(ko()){case"Chrome":case"Firefox":return!0;case"Safari":var n=Eu();return n.major>17||n.major===17&&n.minor>=4}return!1}function dh(){return Rv()&&typeof MediaStreamTrack<"u"&&!(function(){var n,e=ko();if(!kr())return!0;switch(e){case"Chrome":return(n=fh()).major&&n.major>0&&n.major<75;case"Firefox":return(n=ph()).major<91;case"Safari":return(n=hh()).major<13||n.major===13&&n.minor<1;default:return!0}})()}function xv(){return kr().match(/Linux; Android/)}function Lv(){var n,e=kr(),r=e.match(/Mac/)&&(!ot()&&typeof window<"u"&&(n=window)!==null&&n!==void 0&&(n=n.navigator)!==null&&n!==void 0&&n.maxTouchPoints?window.navigator.maxTouchPoints:0)>=5;return!!(e.match(/Mobi/)||e.match(/Android/)||r)||!!kr().match(/DailyAnd\//)||void 0}function ko(){if(typeof window<"u"){var n=kr();return jv()?"Safari":n.indexOf("Edge")>-1?"Edge":n.match(/Chrome\//)?"Chrome":n.indexOf("Safari")>-1||Nv()?"Safari":n.indexOf("Firefox")>-1?"Firefox":n.indexOf("MSIE")>-1||n.indexOf(".NET")>-1?"IE":"Unknown Browser"}}function Eu(){switch(ko()){case"Chrome":return fh();case"Safari":return hh();case"Firefox":return ph();case"Edge":return(function(){var n=0,e=0;if(typeof window<"u"){var r=kr().match(/Edge\/(\d+).(\d+)/);if(r)try{n=parseInt(r[1]),e=parseInt(r[2])}catch{}}return{major:n,minor:e}})()}}function fh(){var n=0,e=0,r=0,a=0,l=!1;if(typeof window<"u"){var f=kr(),h=f.match(/Chrome\/(\d+).(\d+).(\d+).(\d+)/);if(h)try{n=parseInt(h[1]),e=parseInt(h[2]),r=parseInt(h[3]),a=parseInt(h[4]),l=f.indexOf("OPR/")>-1}catch{}}return{major:n,minor:e,build:r,patch:a,opera:l}}function jv(){return!!kr().match(/iPad|iPhone|iPod/i)&&Rv()}function Nv(){return kr().indexOf("AppleWebKit/605.1.15")>-1}function hh(){var n=0,e=0,r=0;if(typeof window<"u"){var a=kr().match(/Version\/(\d+).(\d+)(.(\d+))?/);if(a)try{n=parseInt(a[1]),e=parseInt(a[2]),r=parseInt(a[4])}catch{}else(jv()||Nv())&&(n=14,e=0,r=3)}return{major:n,minor:e,point:r}}function ph(){var n=0,e=0;if(typeof window<"u"){var r=kr().match(/Firefox\/(\d+).(\d+)/);if(r)try{n=parseInt(r[1]),e=parseInt(r[2])}catch{}}return{major:n,minor:e}}var Dv=(function(){return lr((function n(){cr(this,n)}),[{key:"addListenerForMessagesFromCallMachine",value:function(n,e,r){Sc()}},{key:"addListenerForMessagesFromDailyJs",value:function(n,e,r){Sc()}},{key:"sendMessageToCallMachine",value:function(n,e,r,a){Sc()}},{key:"sendMessageToDailyJs",value:function(n,e){Sc()}},{key:"removeListener",value:function(n){Sc()}}])})();function Uv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),r.push.apply(r,a)}return r}function gh(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Uv(Object(r),!0).forEach((function(a){li(n,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Uv(Object(r)).forEach((function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))}))}return n}function Bv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(Bv=function(){return!!n})()}var lk=(function(){function n(){var e,r,a,l;return cr(this,n),r=this,a=Br(a=n),(e=Kl(r,Bv()?Reflect.construct(a,[],Br(r).constructor):a.apply(r,l)))._wrappedListeners={},e._messageCallbacks={},e}return Yl(n,Dv),lr(n,[{key:"addListenerForMessagesFromCallMachine",value:function(e,r,a){var l=this,f=function(h){if(h.data&&h.data.what==="iframe-call-message"&&(!h.data.callClientId||h.data.callClientId===r)&&(!h.data.from||h.data.from!=="module")){var v=gh({},h.data);if(delete v.from,v.callbackStamp&&l._messageCallbacks[v.callbackStamp]){var y=v.callbackStamp;l._messageCallbacks[y].call(a,v),delete l._messageCallbacks[y]}delete v.what,delete v.callbackStamp,e.call(a,v)}};this._wrappedListeners[e]=f,window.addEventListener("message",f)}},{key:"addListenerForMessagesFromDailyJs",value:function(e,r,a){var l=function(f){var h;if(!(!f.data||f.data.what!==ah||!f.data.action||f.data.from&&f.data.from!=="module"||f.data.callClientId&&r&&f.data.callClientId!==r||f!=null&&(h=f.data)!==null&&h!==void 0&&h.callFrameId)){var v=f.data;e.call(a,v)}};this._wrappedListeners[e]=l,window.addEventListener("message",l)}},{key:"sendMessageToCallMachine",value:function(e,r,a,l){if(!a)throw new Error("undefined callClientId. Are you trying to use a DailyCall instance previously destroyed?");var f=gh({},e);if(f.what=ah,f.from="module",f.callClientId=a,r){var h=eu();this._messageCallbacks[h]=r,f.callbackStamp=h}var v=l?l.contentWindow:window,y=this._callMachineTargetOrigin(l);y&&v.postMessage(f,y)}},{key:"sendMessageToDailyJs",value:function(e,r){e.what=ah,e.callClientId=r,e.from="embedded",window.postMessage(e,this._targetOriginFromWindowLocation())}},{key:"removeListener",value:function(e){var r=this._wrappedListeners[e];r&&(window.removeEventListener("message",r),delete this._wrappedListeners[e])}},{key:"forwardPackagedMessageToCallMachine",value:function(e,r,a){var l=gh({},e);l.callClientId=a;var f=r?r.contentWindow:window,h=this._callMachineTargetOrigin(r);h&&f.postMessage(l,h)}},{key:"addListenerForPackagedMessagesFromCallMachine",value:function(e,r){var a=function(l){if(l.data&&l.data.what==="iframe-call-message"&&(!l.data.callClientId||l.data.callClientId===r)&&(!l.data.from||l.data.from!=="module")){var f=l.data;e(f)}};return this._wrappedListeners[e]=a,window.addEventListener("message",a),e}},{key:"removeListenerForPackagedMessagesFromCallMachine",value:function(e){var r=this._wrappedListeners[e];r&&(window.removeEventListener("message",r),delete this._wrappedListeners[e])}},{key:"_callMachineTargetOrigin",value:function(e){return e?e.src?new URL(e.src).origin:void 0:this._targetOriginFromWindowLocation()}},{key:"_targetOriginFromWindowLocation",value:function(){return window.location.protocol==="file:"?"*":window.location.origin}}])})();function Fv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),r.push.apply(r,a)}return r}function Vv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(Vv=function(){return!!n})()}var uk=(function(){function n(){var e,r,a,l;return cr(this,n),r=this,a=Br(a=n),e=Kl(r,Vv()?Reflect.construct(a,[],Br(r).constructor):a.apply(r,l)),global.callMachineToDailyJsEmitter=global.callMachineToDailyJsEmitter||new Sf.EventEmitter,global.dailyJsToCallMachineEmitter=global.dailyJsToCallMachineEmitter||new Sf.EventEmitter,e._wrappedListeners={},e._messageCallbacks={},e}return Yl(n,Dv),lr(n,[{key:"addListenerForMessagesFromCallMachine",value:function(e,r,a){this._addListener(e,global.callMachineToDailyJsEmitter,r,a,"received call machine message")}},{key:"addListenerForMessagesFromDailyJs",value:function(e,r,a){this._addListener(e,global.dailyJsToCallMachineEmitter,r,a,"received daily-js message")}},{key:"sendMessageToCallMachine",value:function(e,r,a){this._sendMessage(e,global.dailyJsToCallMachineEmitter,a,r,"sending message to call machine")}},{key:"sendMessageToDailyJs",value:function(e,r){this._sendMessage(e,global.callMachineToDailyJsEmitter,r,null,"sending message to daily-js")}},{key:"removeListener",value:function(e){var r=this._wrappedListeners[e];r&&(global.callMachineToDailyJsEmitter.removeListener("message",r),global.dailyJsToCallMachineEmitter.removeListener("message",r),delete this._wrappedListeners[e])}},{key:"_addListener",value:function(e,r,a,l,f){var h=this,v=function(y){if(y.callClientId===a){if(y.callbackStamp&&h._messageCallbacks[y.callbackStamp]){var b=y.callbackStamp;h._messageCallbacks[b].call(l,y),delete h._messageCallbacks[b]}e.call(l,y)}};this._wrappedListeners[e]=v,r.addListener("message",v)}},{key:"_sendMessage",value:function(e,r,a,l,f){var h=(function(y){for(var b=1;b<arguments.length;b++){var E=arguments[b]!=null?arguments[b]:{};b%2?Fv(Object(E),!0).forEach((function(O){li(y,O,E[O])})):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(E)):Fv(Object(E)).forEach((function(O){Object.defineProperty(y,O,Object.getOwnPropertyDescriptor(E,O))}))}return y})({},e);if(h.callClientId=a,l){var v=eu();this._messageCallbacks[v]=l,h.callbackStamp=v}r.emit("message",h)}}])})(),mh="replace",vh="shallow-merge",zv=[mh,vh],dk=(function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.data,a=e.mergeStrategy,l=a===void 0?mh:a;cr(this,n),n._validateMergeStrategy(l),n._validateData(r,l),this.mergeStrategy=l,this.data=r}return lr(n,[{key:"isNoOp",value:function(){return n.isNoOpUpdate(this.data,this.mergeStrategy)}}],[{key:"isNoOpUpdate",value:function(e,r){return Object.keys(e).length===0&&r===vh}},{key:"_validateMergeStrategy",value:function(e){if(!zv.includes(e))throw Error("Unrecognized mergeStrategy provided. Options are: [".concat(zv,"]"))}},{key:"_validateData",value:function(e,r){if(!(function(v){if(v==null||ut(v)!=="object")return!1;var y=Object.getPrototypeOf(v);return y==null||y===Object.prototype})(e))throw Error("Meeting session data must be a plain (map-like) object");var a;try{if(a=JSON.stringify(e),r===mh){var l=JSON.parse(a);Pn(l,e)||console.warn("The meeting session data provided will be modified when serialized.",l,e)}else if(r===vh){for(var f in e)if(Object.hasOwnProperty.call(e,f)&&e[f]!==void 0){var h=JSON.parse(JSON.stringify(e[f]));Pn(e[f],h)||console.warn("At least one key in the meeting session data provided will be modified when serialized.",h,e[f])}}}catch(v){throw Error("Meeting session data must be serializable to JSON: ".concat(v))}if(a.length>Cv)throw Error("Meeting session data is too large (".concat(a.length," characters). Maximum size suppported is ").concat(Cv,"."))}}])})();function $v(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return($v=function(){return!!n})()}function yh(n){var e=typeof Map=="function"?new Map:void 0;return yh=function(r){if(r===null||!(function(l){try{return Function.toString.call(l).indexOf("[native code]")!==-1}catch{return typeof l=="function"}})(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,a)}function a(){return(function(l,f,h){if($v())return Reflect.construct.apply(null,arguments);var v=[null];v.push.apply(v,f);var y=new(l.bind.apply(l,v));return h&&bc(y,h.prototype),y})(r,arguments,Br(this).constructor)}return a.prototype=Object.create(r.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),bc(a,r)},yh(n)}function qv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(qv=function(){return!!n})()}function Wv(n){var e,r=(e=window._daily)===null||e===void 0?void 0:e.pendings;if(r){var a=r.indexOf(n);a!==-1&&r.splice(a,1)}}var fk=(function(){return lr((function n(e){cr(this,n),this._currentLoad=null,this._callClientId=e}),[{key:"load",value:function(){var n,e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;if(this.loaded)return window._daily.instances[this._callClientId].callMachine.reset(),void a(!0);n=this._callClientId,window._daily.pendings.push(n),this._currentLoad&&this._currentLoad.cancel(),this._currentLoad=new hk(r,(function(){a(!1)}),(function(f,h){h||Wv(e._callClientId),l(f,h)})),this._currentLoad.start()}},{key:"cancel",value:function(){this._currentLoad&&this._currentLoad.cancel(),Wv(this._callClientId)}},{key:"loaded",get:function(){return this._currentLoad&&this._currentLoad.succeeded}}])})(),hk=(function(){return lr((function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;cr(this,n),this._attemptsRemaining=3,this._currentAttempt=null,this._dailyConfig=e,this._successCallback=r,this._failureCallback=a}),[{key:"start",value:function(){var n=this;if(!this._currentAttempt){var e=function(r){n._currentAttempt.cancelled||(n._attemptsRemaining--,n._failureCallback(r,n._attemptsRemaining>0),n._attemptsRemaining<=0||setTimeout((function(){n._currentAttempt.cancelled||(n._currentAttempt=new Hv(n._dailyConfig,n._successCallback,e),n._currentAttempt.start())}),3e3))};this._currentAttempt=new Hv(this._dailyConfig,this._successCallback,e),this._currentAttempt.start()}}},{key:"cancel",value:function(){this._currentAttempt&&this._currentAttempt.cancel()}},{key:"cancelled",get:function(){return this._currentAttempt&&this._currentAttempt.cancelled}},{key:"succeeded",get:function(){return this._currentAttempt&&this._currentAttempt.succeeded}}])})(),_h=(function(){function n(){return cr(this,n),e=this,a=arguments,r=Br(r=n),Kl(e,qv()?Reflect.construct(r,a||[],Br(e).constructor):r.apply(e,a));var e,r,a}return Yl(n,yh(Error)),lr(n)})(),Mu=2e4,Hv=(function(){return lr((function e(r,a,l){cr(this,e),this._loadAttemptImpl=ot()||!r.avoidEval?new pk(r,a,l):new gk(r,a,l)}),[{key:"start",value:(n=Ge((function*(){return this._loadAttemptImpl.start()})),function(){return n.apply(this,arguments)})},{key:"cancel",value:function(){this._loadAttemptImpl.cancel()}},{key:"cancelled",get:function(){return this._loadAttemptImpl.cancelled}},{key:"succeeded",get:function(){return this._loadAttemptImpl.succeeded}}]);var n})(),pk=(function(){return lr((function l(f,h,v){cr(this,l),this.cancelled=!1,this.succeeded=!1,this._networkTimedOut=!1,this._networkTimeout=null,this._iosCache=typeof iOSCallObjectBundleCache<"u"&&iOSCallObjectBundleCache,this._refetchHeaders=null,this._dailyConfig=f,this._successCallback=h,this._failureCallback=v}),[{key:"start",value:(a=Ge((function*(){var l=tu(this._dailyConfig);!(yield this._tryLoadFromIOSCache(l))&&this._loadFromNetwork(l)})),function(){return a.apply(this,arguments)})},{key:"cancel",value:function(){clearTimeout(this._networkTimeout),this.cancelled=!0}},{key:"_tryLoadFromIOSCache",value:(r=Ge((function*(l){if(!this._iosCache)return!1;try{var f=yield this._iosCache.get(l);return!!this.cancelled||!!f&&(f.code?(Function('"use strict";'+f.code)(),this.succeeded=!0,this._successCallback(),!0):(this._refetchHeaders=f.refetchHeaders,!1))}catch{return!1}})),function(l){return r.apply(this,arguments)})},{key:"_loadFromNetwork",value:(e=Ge((function*(l){var f=this;this._networkTimeout=setTimeout((function(){f._networkTimedOut=!0,f._failureCallback({msg:"Timed out (>".concat(Mu," ms) when loading call object bundle ").concat(l),type:"timeout"})}),Mu);try{var h=this._refetchHeaders?{headers:this._refetchHeaders}:{},v=yield fetch(l,h);if(clearTimeout(this._networkTimeout),this.cancelled||this._networkTimedOut)throw new _h;var y=yield this._getBundleCodeFromResponse(l,v);if(this.cancelled)throw new _h;Function('"use strict";'+y)(),this._iosCache&&this._iosCache.set(l,y,v.headers),this.succeeded=!0,this._successCallback()}catch(b){if(clearTimeout(this._networkTimeout),b instanceof _h||this.cancelled||this._networkTimedOut)return;this._failureCallback({msg:"Failed to load call object bundle ".concat(l,": ").concat(b),type:b.message})}})),function(l){return e.apply(this,arguments)})},{key:"_getBundleCodeFromResponse",value:(n=Ge((function*(l,f){if(f.ok)return yield f.text();if(this._iosCache&&f.status===304)return(yield this._iosCache.renew(l,f.headers)).code;throw new Error("Received ".concat(f.status," response"))})),function(l,f){return n.apply(this,arguments)})}]);var n,e,r,a})(),gk=(function(){return lr((function n(e,r,a){cr(this,n),this.cancelled=!1,this.succeeded=!1,this._dailyConfig=e,this._successCallback=r,this._failureCallback=a,this._attemptId=eu(),this._networkTimeout=null,this._scriptElement=null}),[{key:"start",value:function(){window._dailyCallMachineLoadWaitlist||(window._dailyCallMachineLoadWaitlist=new Set);var n=tu(this._dailyConfig);(typeof document>"u"?"undefined":ut(document))==="object"?this._startLoading(n):this._failureCallback({msg:"Call object bundle must be loaded in a DOM/web context",type:"missing context"})}},{key:"cancel",value:function(){this._stopLoading(),this.cancelled=!0}},{key:"_startLoading",value:function(n){var e=this;this._signUpForCallMachineLoadWaitlist(),this._networkTimeout=setTimeout((function(){e._stopLoading(),e._failureCallback({msg:"Timed out (>".concat(Mu," ms) when loading call object bundle ").concat(n),type:"timeout"})}),Mu);var r=document.getElementsByTagName("head")[0],a=document.createElement("script");this._scriptElement=a,a.onload=function(){e._stopLoading(),e.succeeded=!0,e._successCallback()},a.onerror=function(l){e._stopLoading(),e._failureCallback({msg:"Failed to load call object bundle ".concat(l.target.src),type:l.message})},a.src=n,r.appendChild(a)}},{key:"_stopLoading",value:function(){this._withdrawFromCallMachineLoadWaitlist(),clearTimeout(this._networkTimeout),this._scriptElement&&(this._scriptElement.onload=null,this._scriptElement.onerror=null)}},{key:"_signUpForCallMachineLoadWaitlist",value:function(){window._dailyCallMachineLoadWaitlist.add(this._attemptId)}},{key:"_withdrawFromCallMachineLoadWaitlist",value:function(){window._dailyCallMachineLoadWaitlist.delete(this._attemptId)}}])})(),Ou=function(n,e,r){return vk(n.local,e,r)===!0},mk=function(n,e,r){return n.local.streams&&n.local.streams[e]&&n.local.streams[e].stream&&n.local.streams[e].stream["get".concat(r==="video"?"Video":"Audio","Tracks")]()[0]},ba=function(n,e,r,a){var l=yk(n,e,r,a);return l&&l.pendingTrack},vk=function(n,e,r){if(!n)return!1;var a=function(f){switch(f){case"avatar":return!0;case"staged":return f;default:return!!f}},l=n.public.subscribedTracks;return l&&l[e]?["cam-audio","cam-video","screen-video","screen-audio","rmpAudio","rmpVideo"].indexOf(r)===-1&&l[e].custom?[!0,"staged"].includes(l[e].custom)?a(l[e].custom):a(l[e].custom[r]):a(l[e][r]):!l||a(l.ALL)},yk=function(n,e,r,a){var l=Object.values(n.streams||{}).filter((function(f){return f.participantId===e&&f.type===r&&f.pendingTrack&&f.pendingTrack.kind===a})).sort((function(f,h){return new Date(h.starttime)-new Date(f.starttime)}));return l&&l[0]},_k=function(n,e){var r=n.local.public.customTracks;if(r&&r[e])return r[e].track};function Gv(n,e){for(var r=e.getState(),a=0,l=["cam","screen"];a<l.length;a++)for(var f=l[a],h=0,v=["video","audio"];h<v.length;h++){var y=v[h],b=f==="cam"?y:"screen".concat(y.charAt(0).toUpperCase()+y.slice(1)),E=n.tracks[b];if(E){var O=n.local?mk(r,f,y):ba(r,n.session_id,f,y);E.state==="playable"&&(E.track=O),E.persistentTrack=O}}}function Jv(n,e){try{var r=e.getState();for(var a in n.tracks)if(!wk(a)){var l=n.tracks[a].kind;if(l){var f=n.tracks[a];if(f){var h=n.local?_k(r,a):ba(r,n.session_id,a,l);f.state==="playable"&&(n.tracks[a].track=h),f.persistentTrack=h}}else console.error("unknown type for custom track")}}catch(v){console.error(v)}}function wk(n){return["video","audio","screenVideo","screenAudio"].includes(n)}function Qv(n,e,r){var a=r.getState();if(n.local){if(n.audio)try{n.audioTrack=a.local.streams.cam.stream.getAudioTracks()[0],n.audioTrack||(n.audio=!1)}catch{}if(n.video)try{n.videoTrack=a.local.streams.cam.stream.getVideoTracks()[0],n.videoTrack||(n.video=!1)}catch{}if(n.screen)try{n.screenVideoTrack=a.local.streams.screen.stream.getVideoTracks()[0],n.screenAudioTrack=a.local.streams.screen.stream.getAudioTracks()[0],n.screenVideoTrack||n.screenAudioTrack||(n.screen=!1)}catch{}}else{var l=!0;try{var f=a.participants[n.session_id];f&&f.public&&f.public.rtcType&&f.public.rtcType.impl==="peer-to-peer"&&f.private&&!["connected","completed"].includes(f.private.peeringState)&&(l=!1)}catch(E){console.error(E)}if(!l)return n.audio=!1,n.audioTrack=!1,n.video=!1,n.videoTrack=!1,n.screen=!1,void(n.screenTrack=!1);try{if(a.streams,n.audio&&Ou(a,n.session_id,"cam-audio")){var h=ba(a,n.session_id,"cam","audio");h&&(e&&e.audioTrack&&e.audioTrack.id===h.id?n.audioTrack=h:h.muted||(n.audioTrack=h)),n.audioTrack||(n.audio=!1)}if(n.video&&Ou(a,n.session_id,"cam-video")){var v=ba(a,n.session_id,"cam","video");v&&(e&&e.videoTrack&&e.videoTrack.id===v.id?n.videoTrack=v:v.muted||(n.videoTrack=v)),n.videoTrack||(n.video=!1)}if(n.screen&&Ou(a,n.session_id,"screen-audio")){var y=ba(a,n.session_id,"screen","audio");y&&(e&&e.screenAudioTrack&&e.screenAudioTrack.id===y.id?n.screenAudioTrack=y:y.muted||(n.screenAudioTrack=y))}if(n.screen&&Ou(a,n.session_id,"screen-video")){var b=ba(a,n.session_id,"screen","video");b&&(e&&e.screenVideoTrack&&e.screenVideoTrack.id===b.id?n.screenVideoTrack=b:b.muted||(n.screenVideoTrack=b))}n.screenVideoTrack||n.screenAudioTrack||(n.screen=!1)}catch(E){console.error("unexpected error matching up tracks",E)}}}function bk(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=(function(y,b){if(y){if(typeof y=="string")return Kv(y,b);var E={}.toString.call(y).slice(8,-1);return E==="Object"&&y.constructor&&(E=y.constructor.name),E==="Map"||E==="Set"?Array.from(y):E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E)?Kv(y,b):void 0}})(n))||e){r&&(n=r);var a=0,l=function(){};return{s:l,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(y){throw y},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f,h=!0,v=!1;return{s:function(){r=r.call(n)},n:function(){var y=r.next();return h=y.done,y},e:function(y){v=!0,f=y},f:function(){try{h||r.return==null||r.return()}finally{if(v)throw f}}}}function Kv(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,a=Array(e);r<e;r++)a[r]=n[r];return a}var ui=new Map,Sa=null;function Sk(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=(function(y,b){if(y){if(typeof y=="string")return Yv(y,b);var E={}.toString.call(y).slice(8,-1);return E==="Object"&&y.constructor&&(E=y.constructor.name),E==="Map"||E==="Set"?Array.from(y):E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E)?Yv(y,b):void 0}})(n))||e){r&&(n=r);var a=0,l=function(){};return{s:l,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(y){throw y},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f,h=!0,v=!1;return{s:function(){r=r.call(n)},n:function(){var y=r.next();return h=y.done,y},e:function(y){v=!0,f=y},f:function(){try{h||r.return==null||r.return()}finally{if(v)throw f}}}}function Yv(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,a=Array(e);r<e;r++)a[r]=n[r];return a}var di=new Map,Tc=null;function kk(n){Xv()?(function(e){ui.has(e)||(ui.set(e,{}),navigator.mediaDevices.enumerateDevices().then((function(r){ui.has(e)&&(ui.get(e).lastDevicesString=JSON.stringify(r),Sa||(Sa=(function(){var a=Ge((function*(){var l,f=yield navigator.mediaDevices.enumerateDevices(),h=bk(ui.keys());try{for(h.s();!(l=h.n()).done;){var v=l.value,y=JSON.stringify(f);y!==ui.get(v).lastDevicesString&&(ui.get(v).lastDevicesString=y,v(f))}}catch(b){h.e(b)}finally{h.f()}}));return function(){return a.apply(this,arguments)}})(),navigator.mediaDevices.addEventListener("devicechange",Sa)))})).catch((function(){})))})(n):(function(e){di.has(e)||(di.set(e,{}),navigator.mediaDevices.enumerateDevices().then((function(r){di.has(e)&&(di.get(e).lastDevicesString=JSON.stringify(r),Tc||(Tc=setInterval(Ge((function*(){var a,l=yield navigator.mediaDevices.enumerateDevices(),f=Sk(di.keys());try{for(f.s();!(a=f.n()).done;){var h=a.value,v=JSON.stringify(l);v!==di.get(h).lastDevicesString&&(di.get(h).lastDevicesString=v,h(l))}}catch(y){f.e(y)}finally{f.f()}})),3e3)))})))})(n)}function Ck(n){Xv()?(function(e){ui.has(e)&&(ui.delete(e),ui.size===0&&Sa&&(navigator.mediaDevices.removeEventListener("devicechange",Sa),Sa=null))})(n):(function(e){di.has(e)&&(di.delete(e),di.size===0&&Tc&&(clearInterval(Tc),Tc=null))})(n)}function Xv(){var n;return ot()||((n=navigator.mediaDevices)===null||n===void 0?void 0:n.ondevicechange)!==void 0}var Ek=new Set;function Mk(n,e){return n&&n.readyState==="live"&&!(function(r,a){return r.muted&&!Ek.has(r.id)})(n)}function Zv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),r.push.apply(r,a)}return r}function gs(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Zv(Object(r),!0).forEach((function(a){li(n,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Zv(Object(r)).forEach((function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))}))}return n}var Rc=Object.freeze({VIDEO:"video",AUDIO:"audio",SCREEN_VIDEO:"screenVideo",SCREEN_AUDIO:"screenAudio",CUSTOM_VIDEO:"customVideo",CUSTOM_AUDIO:"customAudio"}),Ok=Object.freeze({PARTICIPANTS:"participants",STREAMING:"streaming",TRANSCRIPTION:"transcription"}),Ac=Object.values(Rc),ey=["v","a","sv","sa","cv","ca"];Object.freeze(Ac.reduce((function(n,e,r){return n[e]=ey[r],n}),{})),Object.freeze(ey.reduce((function(n,e,r){return n[e]=Ac[r],n}),{}));var Tk=[Rc.VIDEO,Rc.AUDIO,Rc.SCREEN_VIDEO,Rc.SCREEN_AUDIO],ty=Object.values(Ok),ny=["p","s","t"];Object.freeze(ty.reduce((function(n,e,r){return n[e]=ny[r],n}),{})),Object.freeze(ny.reduce((function(n,e,r){return n[e]=ty[r],n}),{}));var ry=(function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.base,a=e.byUserId,l=e.byParticipantId;cr(this,n),this.base=r,this.byUserId=a,this.byParticipantId=l}return lr(n,[{key:"clone",value:function(){var e=new n;if(this.base instanceof an?e.base=this.base.clone():e.base=this.base,this.byUserId!==void 0)for(var r in e.byUserId={},this.byUserId){var a=this.byUserId[r];e.byUserId[r]=a instanceof an?a.clone():a}if(this.byParticipantId!==void 0)for(var l in e.byParticipantId={},this.byParticipantId){var f=this.byParticipantId[l];e.byParticipantId[l]=f instanceof an?f.clone():f}return e}},{key:"toJSONObject",value:function(){var e={};if(typeof this.base=="boolean"?e.base=this.base:this.base instanceof an&&(e.base=this.base.toJSONObject()),this.byUserId!==void 0)for(var r in e.byUserId={},this.byUserId){var a=this.byUserId[r];e.byUserId[r]=a instanceof an?a.toJSONObject():a}if(this.byParticipantId!==void 0)for(var l in e.byParticipantId={},this.byParticipantId){var f=this.byParticipantId[l];e.byParticipantId[l]=f instanceof an?f.toJSONObject():f}return e}},{key:"toMinifiedJSONObject",value:function(){var e={};if(this.base!==void 0&&(typeof this.base=="boolean"?e.b=this.base:e.b=this.base.toMinifiedJSONObject()),this.byUserId!==void 0)for(var r in e.u={},this.byUserId){var a=this.byUserId[r];e.u[r]=typeof a=="boolean"?a:a.toMinifiedJSONObject()}if(this.byParticipantId!==void 0)for(var l in e.p={},this.byParticipantId){var f=this.byParticipantId[l];e.p[l]=typeof f=="boolean"?f:f.toMinifiedJSONObject()}return e}},{key:"normalize",value:function(){return this.base instanceof an&&(this.base=this.base.normalize()),this.byUserId&&(this.byUserId=Object.fromEntries(Object.entries(this.byUserId).map((function(e){var r=mn(e,2),a=r[0],l=r[1];return[a,l instanceof an?l.normalize():l]})))),this.byParticipantId&&(this.byParticipantId=Object.fromEntries(Object.entries(this.byParticipantId).map((function(e){var r=mn(e,2),a=r[0],l=r[1];return[a,l instanceof an?l.normalize():l]})))),this}}],[{key:"fromJSONObject",value:function(e){var r,a,l;if(e.base!==void 0&&(r=typeof e.base=="boolean"?e.base:an.fromJSONObject(e.base)),e.byUserId!==void 0)for(var f in a={},e.byUserId){var h=e.byUserId[f];a[f]=typeof h=="boolean"?h:an.fromJSONObject(h)}if(e.byParticipantId!==void 0)for(var v in l={},e.byParticipantId){var y=e.byParticipantId[v];l[v]=typeof y=="boolean"?y:an.fromJSONObject(y)}return new n({base:r,byUserId:a,byParticipantId:l})}},{key:"fromMinifiedJSONObject",value:function(e){var r,a,l;if(e.b!==void 0&&(r=typeof e.b=="boolean"?e.b:an.fromMinifiedJSONObject(e.b)),e.u!==void 0)for(var f in a={},e.u){var h=e.u[f];a[f]=typeof h=="boolean"?h:an.fromMinifiedJSONObject(h)}if(e.p!==void 0)for(var v in l={},e.p){var y=e.p[v];l[v]=typeof y=="boolean"?y:an.fromMinifiedJSONObject(y)}return new n({base:r,byUserId:a,byParticipantId:l})}},{key:"validateJSONObject",value:function(e){if(ut(e)!=="object")return[!1,"canReceive must be an object"];for(var r=["base","byUserId","byParticipantId"],a=0,l=Object.keys(e);a<l.length;a++){var f=l[a];if(!r.includes(f))return[!1,"canReceive can only contain keys (".concat(r.join(", "),")")];if(f==="base"){var h=mn(an.validateJSONObject(e.base,!0),2),v=h[0],y=h[1];if(!v)return[!1,y]}else{if(ut(e[f])!=="object")return[!1,"invalid (non-object) value for field '".concat(f,"' in canReceive")];for(var b=0,E=Object.values(e[f]);b<E.length;b++){var O=E[b],j=mn(an.validateJSONObject(O),2),I=j[0],A=j[1];if(!I)return[!1,A]}}}return[!0]}}])})(),an=(function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.video,a=e.audio,l=e.screenVideo,f=e.screenAudio,h=e.customVideo,v=e.customAudio;cr(this,n),this.video=r,this.audio=a,this.screenVideo=l,this.screenAudio=f,this.customVideo=h,this.customAudio=v}return lr(n,[{key:"clone",value:function(){var e=new n;return this.video!==void 0&&(e.video=this.video),this.audio!==void 0&&(e.audio=this.audio),this.screenVideo!==void 0&&(e.screenVideo=this.screenVideo),this.screenAudio!==void 0&&(e.screenAudio=this.screenAudio),this.customVideo!==void 0&&(e.customVideo=gs({},this.customVideo)),this.customAudio!==void 0&&(e.customAudio=gs({},this.customAudio)),e}},{key:"toJSONObject",value:function(){var e={};return this.video!==void 0&&(e.video=this.video),this.audio!==void 0&&(e.audio=this.audio),this.screenVideo!==void 0&&(e.screenVideo=this.screenVideo),this.screenAudio!==void 0&&(e.screenAudio=this.screenAudio),this.customVideo!==void 0&&(e.customVideo=gs({},this.customVideo)),this.customAudio!==void 0&&(e.customAudio=gs({},this.customAudio)),e}},{key:"toMinifiedJSONObject",value:function(){var e={};return this.video!==void 0&&(e.v=this.video),this.audio!==void 0&&(e.a=this.audio),this.screenVideo!==void 0&&(e.sv=this.screenVideo),this.screenAudio!==void 0&&(e.sa=this.screenAudio),this.customVideo!==void 0&&(e.cv=gs({},this.customVideo)),this.customAudio!==void 0&&(e.ca=gs({},this.customAudio)),e}},{key:"normalize",value:function(){function e(r,a){return r&&Object.keys(r).length===1&&r["*"]===a}return!(this.video!==!0||this.audio!==!0||this.screenVideo!==!0||this.screenAudio!==!0||!e(this.customVideo,!0)||!e(this.customAudio,!0))||(this.video!==!1||this.audio!==!1||this.screenVideo!==!1||this.screenAudio!==!1||!e(this.customVideo,!1)||!e(this.customAudio,!1))&&this}}],[{key:"fromBoolean",value:function(e){return new n({video:e,audio:e,screenVideo:e,screenAudio:e,customVideo:{"*":e},customAudio:{"*":e}})}},{key:"fromJSONObject",value:function(e){return new n({video:e.video,audio:e.audio,screenVideo:e.screenVideo,screenAudio:e.screenAudio,customVideo:e.customVideo!==void 0?gs({},e.customVideo):void 0,customAudio:e.customAudio!==void 0?gs({},e.customAudio):void 0})}},{key:"fromMinifiedJSONObject",value:function(e){return new n({video:e.v,audio:e.a,screenVideo:e.sv,screenAudio:e.sa,customVideo:e.cv,customAudio:e.ca})}},{key:"validateJSONObject",value:function(e,r){if(typeof e=="boolean")return[!0];if(ut(e)!=="object")return[!1,"invalid (non-object, non-boolean) value in canReceive"];for(var a=Object.keys(e),l=0,f=a;l<f.length;l++){var h=f[l];if(!Ac.includes(h))return[!1,"invalid media type '".concat(h,"' in canReceive")];if(Tk.includes(h)){if(typeof e[h]!="boolean")return[!1,"invalid (non-boolean) value for media type '".concat(h,"' in canReceive")]}else{if(ut(e[h])!=="object")return[!1,"invalid (non-object) value for media type '".concat(h,"' in canReceive")];for(var v=0,y=Object.values(e[h]);v<y.length;v++)if(typeof y[v]!="boolean")return[!1,"invalid (non-boolean) value for entry within '".concat(h,"' in canReceive")];if(r&&e[h]["*"]===void 0)return[!1,`canReceive "base" permission must specify "*" as an entry within '`.concat(h,"'")]}}return r&&a.length!==Ac.length?[!1,'canReceive "base" permission must specify all media types: '.concat(Ac.join(", ")," (or be set to a boolean shorthand)")]:[!0]}}])})(),Rk=["result"],Ak=["preserveIframe"];function iy(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),r.push.apply(r,a)}return r}function Ne(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?iy(Object(r),!0).forEach((function(a){li(n,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):iy(Object(r)).forEach((function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))}))}return n}function sy(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(sy=function(){return!!n})()}function oy(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=(function(y,b){if(y){if(typeof y=="string")return ay(y,b);var E={}.toString.call(y).slice(8,-1);return E==="Object"&&y.constructor&&(E=y.constructor.name),E==="Map"||E==="Set"?Array.from(y):E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E)?ay(y,b):void 0}})(n))||e){r&&(n=r);var a=0,l=function(){};return{s:l,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(y){throw y},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f,h=!0,v=!1;return{s:function(){r=r.call(n)},n:function(){var y=r.next();return h=y.done,y},e:function(y){v=!0,f=y},f:function(){try{h||r.return==null||r.return()}finally{if(v)throw f}}}}function ay(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,a=Array(e);r<e;r++)a[r]=n[r];return a}var Co={},cy="video",Pk="voice",ly=ot()?{data:{}}:{data:{},topology:"none"},uy={present:0,hidden:0},dy={maxBitrate:{min:1e5,max:25e5},maxFramerate:{min:1,max:30},scaleResolutionDownBy:{min:1,max:8}},wh=Object.keys(dy),fy=["state","volume","simulcastEncodings"],hy={androidInCallNotification:{title:"string",subtitle:"string",iconName:"string",disableForCustomOverride:"boolean"},disableAutoDeviceManagement:{audio:"boolean",video:"boolean"}},Tu={id:{iconPath:"string",iconPathDarkMode:"string",label:"string",tooltip:"string",visualState:"'default' | 'sidebar-open' | 'active'"}},bh={id:{allow:"string",controlledBy:"'*' | 'owners' | string[]",csp:"string",iconURL:"string",label:"string",loading:"'eager' | 'lazy'",location:"'main' | 'sidebar'",name:"string",referrerPolicy:"string",sandbox:"string",src:"string",srcdoc:"string",shared:"string[] | 'owners' | boolean"}},Eo={customIntegrations:{validate:ky,help:by()},customTrayButtons:{validate:Sy,help:"customTrayButtons should be a dictionary of the type ".concat(JSON.stringify(Tu))},url:{validate:function(n){return typeof n=="string"},help:"url should be a string"},baseUrl:{validate:function(n){return typeof n=="string"},help:"baseUrl should be a string"},token:{validate:function(n){return typeof n=="string"},help:"token should be a string",queryString:"t"},dailyConfig:{validate:function(n,e){try{return e.validateDailyConfig(n),!0}catch(r){console.error("Failed to validate dailyConfig",r)}return!1},help:"Unsupported dailyConfig. Check error logs for detailed info."},reactNativeConfig:{validate:function(n){return Cy(n,hy)},help:"reactNativeConfig should look like ".concat(JSON.stringify(hy),", all fields optional")},lang:{validate:function(n){return["da","de","en-us","en","es","fi","fr","it","jp","ka","nl","no","pl","pt","pt-BR","ru","sv","tr","user"].includes(n)},help:"language not supported. Options are: da, de, en-us, en, es, fi, fr, it, jp, ka, nl, no, pl, pt, pt-BR, ru, sv, tr, user"},userName:!0,userData:{validate:function(n){try{return gy(n),!0}catch(e){return console.error(e),!1}},help:"invalid userData type provided"},startVideoOff:!0,startAudioOff:!0,allowLocalVideo:!0,allowLocalAudio:!0,activeSpeakerMode:!0,showLeaveButton:!0,showLocalVideo:!0,showParticipantsBar:!0,showFullscreenButton:!0,showUserNameChangeUI:!0,iframeStyle:!0,customLayout:!0,cssFile:!0,cssText:!0,bodyClass:!0,videoSource:{validate:function(n,e){if(typeof n=="boolean")return e._preloadCache.allowLocalVideo=n,!0;var r;if(n instanceof MediaStreamTrack)e._sharedTracks.videoTrack=n,r={customTrack:zi};else{if(delete e._sharedTracks.videoTrack,typeof n!="string")return console.error("videoSource must be a MediaStreamTrack, boolean, or a string"),!1;r={deviceId:n}}return e._updatePreloadCacheInputSettings({video:{settings:r}},!1),!0}},audioSource:{validate:function(n,e){if(typeof n=="boolean")return e._preloadCache.allowLocalAudio=n,!0;var r;if(n instanceof MediaStreamTrack)e._sharedTracks.audioTrack=n,r={customTrack:zi};else{if(delete e._sharedTracks.audioTrack,typeof n!="string")return console.error("audioSource must be a MediaStreamTrack, boolean, or a string"),!1;r={deviceId:n}}return e._updatePreloadCacheInputSettings({audio:{settings:r}},!1),!0}},subscribeToTracksAutomatically:{validate:function(n,e){return e._preloadCache.subscribeToTracksAutomatically=n,!0}},theme:{validate:function(n){var e=["accent","accentText","background","backgroundAccent","baseText","border","mainAreaBg","mainAreaBgAccent","mainAreaText","supportiveText"],r=function(a){for(var l=0,f=Object.keys(a);l<f.length;l++){var h=f[l];if(!e.includes(h))return console.error('unsupported color "'.concat(h,'". Valid colors: ').concat(e.join(", "))),!1;if(!a[h].match(/^#[0-9a-f]{6}|#[0-9a-f]{3}$/i))return console.error("".concat(h,' theme color should be provided in valid hex color format. Received: "').concat(a[h],'"')),!1}return!0};return ut(n)==="object"&&("light"in n&&"dark"in n||"colors"in n)?"light"in n&&"dark"in n?"colors"in n.light?"colors"in n.dark?r(n.light.colors)&&r(n.dark.colors):(console.error('Dark theme is missing "colors" property.',n),!1):(console.error('Light theme is missing "colors" property.',n),!1):r(n.colors):(console.error('Theme must contain either both "light" and "dark" properties, or "colors".',n),!1)},help:"unsupported theme configuration. Check error logs for detailed info."},layoutConfig:{validate:function(n){if("grid"in n){var e=n.grid;if("maxTilesPerPage"in e){if(!Number.isInteger(e.maxTilesPerPage))return console.error("grid.maxTilesPerPage should be an integer. You passed ".concat(e.maxTilesPerPage,".")),!1;if(e.maxTilesPerPage>49)return console.error("grid.maxTilesPerPage can't be larger than 49 without sacrificing browser performance. Please contact us at https://www.daily.co/contact to talk about your use case."),!1}if("minTilesPerPage"in e){if(!Number.isInteger(e.minTilesPerPage))return console.error("grid.minTilesPerPage should be an integer. You passed ".concat(e.minTilesPerPage,".")),!1;if(e.minTilesPerPage<1)return console.error("grid.minTilesPerPage can't be lower than 1."),!1;if("maxTilesPerPage"in e&&e.minTilesPerPage>e.maxTilesPerPage)return console.error("grid.minTilesPerPage can't be higher than grid.maxTilesPerPage."),!1}}return!0},help:"unsupported layoutConfig. Check error logs for detailed info."},receiveSettings:{validate:function(n){return my(n,{allowAllParticipantsKey:!1})},help:wy({allowAllParticipantsKey:!1})},sendSettings:{validate:function(n,e){return!!(function(r,a){try{return a.validateUpdateSendSettings(r),!0}catch(l){return console.error("Failed to validate send settings",l),!1}})(n,e)&&(e._preloadCache.sendSettings=n,!0)},help:"Invalid sendSettings provided. Check error logs for detailed info."},inputSettings:{validate:function(n,e){var r;return!!vy(n)&&(e._inputSettings||(e._inputSettings={}),yy(n,(r=e.properties)===null||r===void 0?void 0:r.dailyConfig,e._sharedTracks),e._updatePreloadCacheInputSettings(n,!0),!0)},help:Ch()},layout:{validate:function(n){return n==="custom-v1"||n==="browser"||n==="none"},help:'layout may only be set to "custom-v1"',queryString:"layout"},emb:{queryString:"emb"},embHref:{queryString:"embHref"},dailyJsVersion:{queryString:"dailyJsVersion"},proxy:{queryString:"proxy"},strictMode:!0,allowMultipleCallInstances:!0},Ru={styles:{validate:function(n){for(var e in n)if(e!=="cam"&&e!=="screen")return!1;if(n.cam){for(var r in n.cam)if(r!=="div"&&r!=="video")return!1}if(n.screen){for(var a in n.screen)if(a!=="div"&&a!=="video")return!1}return!0},help:"styles format should be a subset of: { cam: {div: {}, video: {}}, screen: {div: {}, video: {}} }"},setSubscribedTracks:{validate:function(n,e){if(e._preloadCache.subscribeToTracksAutomatically)return!1;var r=[!0,!1,"staged"];if(r.includes(n)||!ot()&&n==="avatar")return!0;var a=["audio","video","screenAudio","screenVideo","rmpAudio","rmpVideo"],l=function(f){var h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];for(var v in f)if(v==="custom"){if(!r.includes(f[v])&&!l(f[v],!0))return!1}else{var y=!h&&!a.includes(v),b=!r.includes(f[v]);if(y||b)return!1}return!0};return l(n)},help:"setSubscribedTracks cannot be used when setSubscribeToTracksAutomatically is enabled, and should be of the form: "+"true".concat(ot()?"":" | 'avatar'"," | false | 'staged' | { [audio: true|false|'staged'], [video: true|false|'staged'], [screenAudio: true|false|'staged'], [screenVideo: true|false|'staged'] }")},setAudio:!0,setVideo:!0,setScreenShare:{validate:function(n){return n===!1},help:"setScreenShare must be false, as it's only meant for stopping remote participants' screen shares"},eject:!0,updatePermissions:{validate:function(n){for(var e=0,r=Object.entries(n);e<r.length;e++){var a=mn(r[e],2),l=a[0],f=a[1];switch(l){case"hasPresence":if(typeof f!="boolean")return!1;break;case"canSend":if(f instanceof Set||f instanceof Array||Array.isArray(f)){var h,v=["video","audio","screenVideo","screenAudio","customVideo","customAudio"],y=oy(f);try{for(y.s();!(h=y.n()).done;){var b=h.value;if(!v.includes(b))return!1}}catch(V){y.e(V)}finally{y.f()}}else if(typeof f!="boolean")return!1;(f instanceof Array||Array.isArray(f))&&(n.canSend=new Set(f));break;case"canReceive":var E=mn(ry.validateJSONObject(f),2),O=E[0],j=E[1];if(!O)return console.error(j),!1;break;case"canAdmin":if(f instanceof Set||f instanceof Array||Array.isArray(f)){var I,A=["participants","streaming","transcription"],R=oy(f);try{for(R.s();!(I=R.n()).done;){var D=I.value;if(!A.includes(D))return!1}}catch(V){R.e(V)}finally{R.f()}}else if(typeof f!="boolean")return!1;(f instanceof Array||Array.isArray(f))&&(n.canAdmin=new Set(f));break;default:return!1}}return!0},help:"updatePermissions can take hasPresence, canSend, canReceive, and canAdmin permissions. hasPresence must be a boolean. canSend can be a boolean or an Array or Set of media types (video, audio, screenVideo, screenAudio, customVideo, customAudio). canReceive must be an object specifying base, byUserId, and/or byParticipantId fields (see documentation for more details). canAdmin can be a boolean or an Array or Set of admin types (participants, streaming, transcription)."}};Promise.any||(Promise.any=(function(){var n=Ge((function*(e){return new Promise((function(r,a){var l=[];e.forEach((function(f){return Promise.resolve(f).then((function(h){r(h)})).catch((function(h){l.push(h),l.length===e.length&&a(l)}))}))}))}));return function(e){return n.apply(this,arguments)}})());var Au=(function(){function n(g){var M,C,N,F,G,ie,fe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(cr(this,n),N=this,F=Br(F=n),li(C=Kl(N,sy()?Reflect.construct(F,[],Br(N).constructor):F.apply(N,G)),"startListeningForDeviceChanges",(function(){kk(C.handleDeviceChange)})),li(C,"stopListeningForDeviceChanges",(function(){Ck(C.handleDeviceChange)})),li(C,"handleDeviceChange",(function($e){$e=$e.map((function(Xe){return JSON.parse(JSON.stringify(Xe))})),C.emitDailyJSEvent({action:"available-devices-updated",availableDevices:$e})})),li(C,"handleNativeAppStateChange",(function(){var $e=Ge((function*(Xe){if(Xe==="destroyed")return console.warn("App has been destroyed before leaving the meeting. Cleaning up all the resources!"),void(yield C.destroy());var Vt=Xe==="active";C.disableReactNativeAutoDeviceManagement("video")||(Vt?C.camUnmutedBeforeLosingNativeActiveState&&C.setLocalVideo(!0):(C.camUnmutedBeforeLosingNativeActiveState=C.localVideo(),C.camUnmutedBeforeLosingNativeActiveState&&C.setLocalVideo(!1)))}));return function(Xe){return $e.apply(this,arguments)}})()),li(C,"handleNativeAudioFocusChange",(function($e){C.disableReactNativeAutoDeviceManagement("audio")||(C._hasNativeAudioFocus=$e,C.toggleParticipantAudioBasedOnNativeAudioFocus(),C._hasNativeAudioFocus?C.micUnmutedBeforeLosingNativeAudioFocus&&C.setLocalAudio(!0):(C.micUnmutedBeforeLosingNativeAudioFocus=C.localAudio(),C.setLocalAudio(!1)))})),li(C,"handleNativeSystemScreenCaptureStop",(function(){C.stopScreenShare()})),!dh()&&!ot())throw new Error("WebRTC not supported or suppressed");if(C.strictMode=fe.strictMode===void 0||fe.strictMode,C.allowMultipleCallInstances=(M=fe.allowMultipleCallInstances)!==null&&M!==void 0&&M,Object.keys(Co).length&&(C._logDuplicateInstanceAttempt(),!C.allowMultipleCallInstances)){if(C.strictMode)throw new Error("Duplicate DailyIframe instances are not allowed");console.warn("Using strictMode: false to allow multiple call instances is now deprecated. Set `allowMultipleCallInstances: true`")}if(window._daily||(window._daily={pendings:[],instances:{}}),C.callClientId=eu(),Co[(ie=C).callClientId]=ie,window._daily.instances[C.callClientId]={},C._sharedTracks={},window._daily.instances[C.callClientId].tracks=C._sharedTracks,fe.dailyJsVersion=n.version(),C._iframe=g,C._callObjectMode=fe.layout==="none"&&!C._iframe,C._preloadCache={subscribeToTracksAutomatically:!0,outputDeviceId:null,inputSettings:null,sendSettings:null,videoTrackForNetworkConnectivityTest:null,videoTrackForConnectionQualityTest:null},fe.showLocalVideo!==void 0?C._callObjectMode?console.error("showLocalVideo is not available in call object mode"):C._showLocalVideo=!!fe.showLocalVideo:C._showLocalVideo=!0,fe.showParticipantsBar!==void 0?C._callObjectMode?console.error("showParticipantsBar is not available in call object mode"):C._showParticipantsBar=!!fe.showParticipantsBar:C._showParticipantsBar=!0,fe.customIntegrations!==void 0?C._callObjectMode?console.error("customIntegrations is not available in call object mode"):C._customIntegrations=fe.customIntegrations:C._customIntegrations={},fe.customTrayButtons!==void 0?C._callObjectMode?console.error("customTrayButtons is not available in call object mode"):C._customTrayButtons=fe.customTrayButtons:C._customTrayButtons={},fe.activeSpeakerMode!==void 0?C._callObjectMode?console.error("activeSpeakerMode is not available in call object mode"):C._activeSpeakerMode=!!fe.activeSpeakerMode:C._activeSpeakerMode=!1,fe.receiveSettings?C._callObjectMode?C._receiveSettings=fe.receiveSettings:console.error("receiveSettings is only available in call object mode"):C._receiveSettings={},C.validateProperties(fe),C.properties=Ne({},fe),C._inputSettings||(C._inputSettings={}),C._callObjectLoader=C._callObjectMode?new fk(C.callClientId):null,C._callState=pv,C._isPreparingToJoin=!1,C._accessState={access:sh},C._meetingSessionSummary={},C._finalSummaryOfPrevSession={},C._meetingSessionState=Eh(ly,C._callObjectMode),C._nativeInCallAudioMode=cy,C._participants={},C._isScreenSharing=!1,C._participantCounts=uy,C._rmpPlayerState={},C._waitingParticipants={},C._network={threshold:"good",quality:100,networkState:"unknown",stats:{}},C._activeSpeaker={},C._localAudioLevel=0,C._isLocalAudioLevelObserverRunning=!1,C._remoteParticipantsAudioLevel={},C._isRemoteParticipantsAudioLevelObserverRunning=!1,C._maxAppMessageSize=oh,C._messageChannel=ot()?new uk:new lk,C._iframe&&(C._iframe.requestFullscreen?C._iframe.addEventListener("fullscreenchange",(function(){document.fullscreenElement===C._iframe?(C.emitDailyJSEvent({action:bu}),C.sendMessageToCallMachine({action:bu})):(C.emitDailyJSEvent({action:Su}),C.sendMessageToCallMachine({action:Su}))})):C._iframe.webkitRequestFullscreen&&C._iframe.addEventListener("webkitfullscreenchange",(function(){document.webkitFullscreenElement===C._iframe?(C.emitDailyJSEvent({action:bu}),C.sendMessageToCallMachine({action:bu})):(C.emitDailyJSEvent({action:Su}),C.sendMessageToCallMachine({action:Su}))}))),ot()){var Oe=C.nativeUtils();Oe.addAudioFocusChangeListener&&Oe.removeAudioFocusChangeListener&&Oe.addAppStateChangeListener&&Oe.removeAppStateChangeListener&&Oe.addSystemScreenCaptureStopListener&&Oe.removeSystemScreenCaptureStopListener||console.warn("expected (add|remove)(AudioFocusChange|AppActiveStateChange|SystemScreenCaptureStop)Listener to be available in React Native"),C._hasNativeAudioFocus=!0,Oe.addAudioFocusChangeListener(C.handleNativeAudioFocusChange),Oe.addAppStateChangeListener(C.handleNativeAppStateChange),Oe.addSystemScreenCaptureStopListener(C.handleNativeSystemScreenCaptureStop)}return C._callObjectMode&&C.startListeningForDeviceChanges(),C._messageChannel.addListenerForMessagesFromCallMachine(C.handleMessageFromCallMachine,C.callClientId,C),C}return Yl(n,Zl),lr(n,[{key:"destroy",value:(le=Ge((function*(){var g;try{yield this.leave()}catch{}var M=this._iframe;if(M){var C=M.parentElement;C&&C.removeChild(M)}if(this._messageChannel.removeListener(this.handleMessageFromCallMachine),ot()){var N=this.nativeUtils();N.removeAudioFocusChangeListener(this.handleNativeAudioFocusChange),N.removeAppStateChangeListener(this.handleNativeAppStateChange),N.removeSystemScreenCaptureStopListener(this.handleNativeSystemScreenCaptureStop)}this._callObjectMode&&this.stopListeningForDeviceChanges(),this.resetMeetingDependentVars(),this._destroyed=!0,this.emitDailyJSEvent({action:"call-instance-destroyed"}),delete Co[this.callClientId],!((g=window)===null||g===void 0||(g=g._daily)===null||g===void 0)&&g.instances&&delete window._daily.instances[this.callClientId],this.strictMode&&(this.callClientId=void 0)})),function(){return le.apply(this,arguments)})},{key:"isDestroyed",value:function(){return!!this._destroyed}},{key:"loadCss",value:function(g){var M=g.bodyClass,C=g.cssFile,N=g.cssText;return at(),this.sendMessageToCallMachine({action:"load-css",cssFile:this.absoluteUrl(C),bodyClass:M,cssText:N}),this}},{key:"iframe",value:function(){return at(),this._iframe}},{key:"meetingState",value:function(){return this._callState}},{key:"accessState",value:function(){return zr(this._callObjectMode,"accessState()"),this._accessState}},{key:"participants",value:function(){return this._participants}},{key:"participantCounts",value:function(){return this._participantCounts}},{key:"waitingParticipants",value:function(){return zr(this._callObjectMode,"waitingParticipants()"),this._waitingParticipants}},{key:"validateParticipantProperties",value:function(g,M){for(var C in M){if(!Ru[C])throw new Error("unrecognized updateParticipant property ".concat(C));if(Ru[C].validate&&!Ru[C].validate(M[C],this,this._participants[g]))throw new Error(Ru[C].help)}}},{key:"updateParticipant",value:function(g,M){return this._participants.local&&this._participants.local.session_id===g&&(g="local"),g&&M&&(this.validateParticipantProperties(g,M),this.sendMessageToCallMachine({action:"update-participant",id:g,properties:M})),this}},{key:"updateParticipants",value:function(g){var M=this._participants.local&&this._participants.local.session_id;for(var C in g)C===M&&(C="local"),C&&g[C]&&this.validateParticipantProperties(C,g[C]);return this.sendMessageToCallMachine({action:"update-participants",participants:g}),this}},{key:"updateWaitingParticipant",value:(J=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(zr(this._callObjectMode,"updateWaitingParticipant()"),_t(this._callState,"updateWaitingParticipant()"),typeof M!="string"||ut(C)!=="object")throw new Error("updateWaitingParticipant() must take an id string and a updates object");return new Promise((function(N,F){g.sendMessageToCallMachine({action:"daily-method-update-waiting-participant",id:M,updates:C},(function(G){G.error&&F(G.error),G.id||F(new Error("unknown error in updateWaitingParticipant()")),N({id:G.id})}))}))})),function(){return J.apply(this,arguments)})},{key:"updateWaitingParticipants",value:(oe=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(zr(this._callObjectMode,"updateWaitingParticipants()"),_t(this._callState,"updateWaitingParticipants()"),ut(M)!=="object")throw new Error("updateWaitingParticipants() must take a mapping between ids and update objects");return new Promise((function(C,N){g.sendMessageToCallMachine({action:"daily-method-update-waiting-participants",updatesById:M},(function(F){F.error&&N(F.error),F.ids||N(new Error("unknown error in updateWaitingParticipants()")),C({ids:F.ids})}))}))})),function(){return oe.apply(this,arguments)})},{key:"requestAccess",value:(Ce=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},C=M.access,N=C===void 0?{level:iS}:C,F=M.name,G=F===void 0?"":F;return zr(this._callObjectMode,"requestAccess()"),_t(this._callState,"requestAccess()"),new Promise((function(ie,fe){g.sendMessageToCallMachine({action:"daily-method-request-access",access:N,name:G},(function(Oe){Oe.error&&fe(Oe.error),Oe.access||fe(new Error("unknown error in requestAccess()")),ie({access:Oe.access,granted:Oe.granted})}))}))})),function(){return Ce.apply(this,arguments)})},{key:"localAudio",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.audio.state):null}},{key:"localVideo",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.video.state):null}},{key:"setLocalAudio",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"forceDiscardTrack"in M&&(ot()?(console.warn("forceDiscardTrack option not supported in React Native; ignoring"),M={}):g&&(console.warn("forceDiscardTrack option only supported when calling setLocalAudio(false); ignoring"),M={})),this.sendMessageToCallMachine({action:"local-audio",state:g,options:M}),this}},{key:"localScreenAudio",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.screenAudio.state):null}},{key:"localScreenVideo",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.screenVideo.state):null}},{key:"updateScreenShare",value:function(g){if(this._isScreenSharing)return this.sendMessageToCallMachine({action:"local-screen-update",options:g}),this;console.warn("There is no screen share in progress. Try calling startScreenShare first.")}},{key:"setLocalVideo",value:function(g){return this.sendMessageToCallMachine({action:"local-video",state:g}),this}},{key:"_setAllowLocalAudio",value:function(g){if(this._preloadCache.allowLocalAudio=g,this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-allow-local-audio",state:g}),this}},{key:"_setAllowLocalVideo",value:function(g){if(this._preloadCache.allowLocalVideo=g,this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-allow-local-video",state:g}),this}},{key:"getReceiveSettings",value:(he=Ge((function*(g){var M=this,C=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).showInheritedValues,N=C!==void 0&&C;if(zr(this._callObjectMode,"getReceiveSettings()"),!this._callMachineInitialized)return this._receiveSettings;switch(ut(g)){case"string":return new Promise((function(F){M.sendMessageToCallMachine({action:"get-single-participant-receive-settings",id:g,showInheritedValues:N},(function(G){F(G.receiveSettings)}))}));case"undefined":return this._receiveSettings;default:throw new Error('first argument to getReceiveSettings() must be a participant id (or "base"), or there should be no arguments')}})),function(g){return he.apply(this,arguments)})},{key:"updateReceiveSettings",value:(be=Ge((function*(g){var M=this;if(zr(this._callObjectMode,"updateReceiveSettings()"),!my(g,{allowAllParticipantsKey:!0}))throw new Error(wy({allowAllParticipantsKey:!0}));return _t(this._callState,"updateReceiveSettings()","To specify receive settings earlier, use the receiveSettings config property."),new Promise((function(C){M.sendMessageToCallMachine({action:"update-receive-settings",receiveSettings:g},(function(N){C({receiveSettings:N.receiveSettings})}))}))})),function(g){return be.apply(this,arguments)})},{key:"_prepInputSettingsForSharing",value:function(g,M){if(g){var C={};if(g.audio){var N,F,G;g.audio.settings&&(!Object.keys(g.audio.settings).length&&M||(C.audio={settings:Ne({},g.audio.settings)})),M&&(N=C.audio)!==null&&N!==void 0&&(N=N.settings)!==null&&N!==void 0&&N.customTrack&&(C.audio.settings={customTrack:this._sharedTracks.audioTrack});var ie=((F=g.audio.processor)===null||F===void 0?void 0:F.type)==="none"&&((G=g.audio.processor)===null||G===void 0?void 0:G._isDefaultWhenNone);if(g.audio.processor&&!ie){var fe=Ne({},g.audio.processor);delete fe._isDefaultWhenNone,C.audio=Ne(Ne({},C.audio),{},{processor:fe})}}if(g.video){var Oe,$e,Xe;g.video.settings&&(!Object.keys(g.video.settings).length&&M||(C.video={settings:Ne({},g.video.settings)})),M&&(Oe=C.video)!==null&&Oe!==void 0&&(Oe=Oe.settings)!==null&&Oe!==void 0&&Oe.customTrack&&(C.video.settings={customTrack:this._sharedTracks.videoTrack});var Vt=(($e=g.video.processor)===null||$e===void 0?void 0:$e.type)==="none"&&((Xe=g.video.processor)===null||Xe===void 0?void 0:Xe._isDefaultWhenNone);if(g.video.processor&&!Vt){var bn=Ne({},g.video.processor);delete bn._isDefaultWhenNone,C.video=Ne(Ne({},C.video),{},{processor:bn})}}return C}}},{key:"getInputSettings",value:function(){var g=this;return at(),new Promise((function(M){M(g._getInputSettings())}))}},{key:"_getInputSettings",value:function(){var g,M,C,N,F,G,ie={processor:{type:"none",_isDefaultWhenNone:!0}};this._inputSettings?(g=((C=this._inputSettings)===null||C===void 0?void 0:C.video)||ie,M=((N=this._inputSettings)===null||N===void 0?void 0:N.audio)||ie):(g=((F=this._preloadCache)===null||F===void 0||(F=F.inputSettings)===null||F===void 0?void 0:F.video)||ie,M=((G=this._preloadCache)===null||G===void 0||(G=G.inputSettings)===null||G===void 0?void 0:G.audio)||ie);var fe={audio:M,video:g};return this._prepInputSettingsForSharing(fe,!0)}},{key:"_updatePreloadCacheInputSettings",value:function(g,M){var C=this._inputSettings||{},N={};if(g.video){var F,G,ie;N.video={},g.video.settings?(N.video.settings={},M||g.video.settings.customTrack||(ie=C.video)===null||ie===void 0||!ie.settings?N.video.settings=g.video.settings:N.video.settings=Ne(Ne({},C.video.settings),g.video.settings),Object.keys(N.video.settings).length||delete N.video.settings):(F=C.video)!==null&&F!==void 0&&F.settings&&(N.video.settings=C.video.settings),g.video.processor?N.video.processor=g.video.processor:(G=C.video)!==null&&G!==void 0&&G.processor&&(N.video.processor=C.video.processor)}else C.video&&(N.video=C.video);if(g.audio){var fe,Oe,$e;N.audio={},g.audio.settings?(N.audio.settings={},M||g.audio.settings.customTrack||($e=C.audio)===null||$e===void 0||!$e.settings?N.audio.settings=g.audio.settings:N.audio.settings=Ne(Ne({},C.audio.settings),g.audio.settings),Object.keys(N.audio.settings).length||delete N.audio.settings):(fe=C.audio)!==null&&fe!==void 0&&fe.settings&&(N.audio.settings=C.audio.settings),g.audio.processor?N.audio.processor=g.audio.processor:(Oe=C.audio)!==null&&Oe!==void 0&&Oe.processor&&(N.audio.processor=C.audio.processor)}else C.audio&&(N.audio=C.audio);this._maybeUpdateInputSettings(N)}},{key:"_devicesFromInputSettings",value:function(g){var M,C,N=(g==null||(M=g.video)===null||M===void 0||(M=M.settings)===null||M===void 0?void 0:M.deviceId)||null,F=(g==null||(C=g.audio)===null||C===void 0||(C=C.settings)===null||C===void 0?void 0:C.deviceId)||null,G=this._preloadCache.outputDeviceId||null;return{camera:N?{deviceId:N}:{},mic:F?{deviceId:F}:{},speaker:G?{deviceId:G}:{}}}},{key:"updateInputSettings",value:(it=Ge((function*(g){var M=this;return at(),vy(g)?g.video||g.audio?(yy(g,this.properties.dailyConfig,this._sharedTracks),this._callObjectMode&&!this._callMachineInitialized?(this._updatePreloadCacheInputSettings(g,!0),this._getInputSettings()):new Promise((function(C,N){M.sendMessageToCallMachine({action:"update-input-settings",inputSettings:g},(function(F){if(F.error)N(F.error);else{if(F.returnPreloadCache)return M._updatePreloadCacheInputSettings(g,!0),void C(M._getInputSettings());M._maybeUpdateInputSettings(F.inputSettings),C(M._prepInputSettingsForSharing(F.inputSettings,!0))}}))}))):this._getInputSettings():(console.error(Ch()),Promise.reject(Ch()))})),function(g){return it.apply(this,arguments)})},{key:"setBandwidth",value:function(g){var M=g.kbs,C=g.trackConstraints;if(at(),this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-bandwidth",kbs:M,trackConstraints:C}),this}},{key:"getDailyLang",value:function(){var g=this;if(at(),this._callMachineInitialized)return new Promise((function(M){g.sendMessageToCallMachine({action:"get-daily-lang"},(function(C){delete C.action,delete C.callbackStamp,M(C)}))}))}},{key:"setDailyLang",value:function(g){return at(),this.sendMessageToCallMachine({action:"set-daily-lang",lang:g}),this}},{key:"setProxyUrl",value:function(g){return this.sendMessageToCallMachine({action:"set-proxy-url",proxyUrl:g}),this}},{key:"setIceConfig",value:function(g){return this.sendMessageToCallMachine({action:"set-ice-config",iceConfig:g}),this}},{key:"meetingSessionSummary",value:function(){return[So,ps].includes(this._callState)?this._finalSummaryOfPrevSession:this._meetingSessionSummary}},{key:"getMeetingSession",value:(Ue=Ge((function*(){var g=this;return console.warn("getMeetingSession() is deprecated: use meetingSessionSummary(), which will return immediately"),_t(this._callState,"getMeetingSession()"),new Promise((function(M){g.sendMessageToCallMachine({action:"get-meeting-session"},(function(C){delete C.action,delete C.callbackStamp,M(C)}))}))})),function(){return Ue.apply(this,arguments)})},{key:"meetingSessionState",value:function(){return _t(this._callState,"meetingSessionState"),this._meetingSessionState}},{key:"setMeetingSessionData",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"replace";zr(this._callObjectMode,"setMeetingSessionData()"),_t(this._callState,"setMeetingSessionData");try{(function(C,N){new dk({data:C,mergeStrategy:N})})(g,M)}catch(C){throw console.error(C),C}try{this.sendMessageToCallMachine({action:"set-session-data",data:g,mergeStrategy:M})}catch(C){throw new Error("Error setting meeting session data: ".concat(C))}}},{key:"setUserName",value:function(g,M){var C=this;return this.properties.userName=g,new Promise((function(N){C.sendMessageToCallMachine({action:"set-user-name",name:g??"",thisMeetingOnly:ot()||!!M&&!!M.thisMeetingOnly},(function(F){delete F.action,delete F.callbackStamp,N(F)}))}))}},{key:"setUserData",value:(K=Ge((function*(g){var M=this;try{gy(g)}catch(C){throw console.error(C),C}if(this.properties.userData=g,this._callMachineInitialized)return new Promise((function(C){try{M.sendMessageToCallMachine({action:"set-user-data",userData:g},(function(N){delete N.action,delete N.callbackStamp,C(N)}))}catch(N){throw new Error("Error setting user data: ".concat(N))}}))})),function(g){return K.apply(this,arguments)})},{key:"validateAudioLevelInterval",value:function(g){if(g&&(g<100||typeof g!="number"))throw new Error("The interval must be a number greater than or equal to 100 milliseconds.")}},{key:"startLocalAudioLevelObserver",value:function(g){var M=this;if(typeof AudioWorkletNode>"u"&&!ot())throw new Error("startLocalAudioLevelObserver() is not supported on this browser");if(this.validateAudioLevelInterval(g),this._callMachineInitialized)return this._isLocalAudioLevelObserverRunning=!0,new Promise((function(C,N){M.sendMessageToCallMachine({action:"start-local-audio-level-observer",interval:g},(function(F){M._isLocalAudioLevelObserverRunning=!F.error,F.error?N({error:F.error}):C()}))}));this._preloadCache.localAudioLevelObserver={enabled:!0,interval:g}}},{key:"isLocalAudioLevelObserverRunning",value:function(){return this._isLocalAudioLevelObserverRunning}},{key:"stopLocalAudioLevelObserver",value:function(){this._preloadCache.localAudioLevelObserver=null,this._localAudioLevel=0,this._isLocalAudioLevelObserverRunning=!1,this.sendMessageToCallMachine({action:"stop-local-audio-level-observer"})}},{key:"startRemoteParticipantsAudioLevelObserver",value:function(g){var M=this;if(this.validateAudioLevelInterval(g),this._callMachineInitialized)return this._isRemoteParticipantsAudioLevelObserverRunning=!0,new Promise((function(C,N){M.sendMessageToCallMachine({action:"start-remote-participants-audio-level-observer",interval:g},(function(F){M._isRemoteParticipantsAudioLevelObserverRunning=!F.error,F.error?N({error:F.error}):C()}))}));this._preloadCache.remoteParticipantsAudioLevelObserver={enabled:!0,interval:g}}},{key:"isRemoteParticipantsAudioLevelObserverRunning",value:function(){return this._isRemoteParticipantsAudioLevelObserverRunning}},{key:"stopRemoteParticipantsAudioLevelObserver",value:function(){this._preloadCache.remoteParticipantsAudioLevelObserver=null,this._remoteParticipantsAudioLevel={},this._isRemoteParticipantsAudioLevelObserverRunning=!1,this.sendMessageToCallMachine({action:"stop-remote-participants-audio-level-observer"})}},{key:"startCamera",value:(Me=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(zr(this._callObjectMode,"startCamera()"),Sh(this._callState,this._isPreparingToJoin,"startCamera()","Did you mean to use setLocalAudio() and/or setLocalVideo() instead?"),this.needsLoad())try{yield this.load(M)}catch(C){return Promise.reject(C)}else{if(this._didPreAuth){if(M.url&&M.url!==this.properties.url)return console.error("url in startCamera() is different than the one used in preAuth()"),Promise.reject();if(M.token&&M.token!==this.properties.token)return console.error("token in startCamera() is different than the one used in preAuth()"),Promise.reject()}this.validateProperties(M),this.properties=Ne(Ne({},this.properties),M)}return new Promise((function(C){g._preloadCache.inputSettings=g._prepInputSettingsForSharing(g._inputSettings,!1),g.sendMessageToCallMachine({action:"start-camera",properties:ka(g.properties,g.callClientId),preloadCache:ka(g._preloadCache,g.callClientId)},(function(N){C({camera:N.camera,mic:N.mic,speaker:N.speaker})}))}))})),function(){return Me.apply(this,arguments)})},{key:"validateCustomTrack",value:function(g,M,C){if(C&&C.length>50)throw new Error("Custom track `trackName` must not be more than 50 characters");if(M&&M!=="music"&&M!=="speech"&&!(M instanceof Object))throw new Error("Custom track `mode` must be either `music` | `speech` | `DailyMicAudioModeSettings` or `undefined`");if(C&&["cam-audio","cam-video","screen-video","screen-audio","rmpAudio","rmpVideo","customVideoDefaults"].includes(C))throw new Error("Custom track `trackName` must not match a track name already used by daily: cam-audio, cam-video, customVideoDefaults, screen-video, screen-audio, rmpAudio, rmpVideo");if(!(g instanceof MediaStreamTrack))throw new Error("Custom tracks provided must be instances of MediaStreamTrack")}},{key:"startCustomTrack",value:function(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{track,mode,trackName,ignoreAudioLevel};return at(),_t(this._callState,"startCustomTrack()"),this.validateCustomTrack(M.track,M.mode,M.trackName),new Promise((function(C,N){g._sharedTracks.customTrack=M.track,M.track=zi,g.sendMessageToCallMachine({action:"start-custom-track",properties:M},(function(F){F.error?N({error:F.error}):C(F.mediaTag)}))}))}},{key:"stopCustomTrack",value:function(g){var M=this;return at(),_t(this._callState,"stopCustomTrack()"),new Promise((function(C){M.sendMessageToCallMachine({action:"stop-custom-track",mediaTag:g},(function(N){C(N.mediaTag)}))}))}},{key:"setCamera",value:function(g){var M=this;return Pc(),Iu(this._callMachineInitialized,"setCamera()"),new Promise((function(C){M.sendMessageToCallMachine({action:"set-camera",cameraDeviceId:g},(function(N){C({device:N.device})}))}))}},{key:"setAudioDevice",value:(ze=Ge((function*(g){return Pc(),this.nativeUtils().setAudioDevice(g),{deviceId:yield this.nativeUtils().getAudioDevice()}})),function(g){return ze.apply(this,arguments)})},{key:"cycleCamera",value:function(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise((function(C){g.sendMessageToCallMachine({action:"cycle-camera",properties:M},(function(N){C({device:N.device})}))}))}},{key:"cycleMic",value:function(){var g=this;return at(),new Promise((function(M){g.sendMessageToCallMachine({action:"cycle-mic"},(function(C){M({device:C.device})}))}))}},{key:"getCameraFacingMode",value:function(){var g=this;return Pc(),new Promise((function(M){g.sendMessageToCallMachine({action:"get-camera-facing-mode"},(function(C){M(C.facingMode)}))}))}},{key:"setInputDevicesAsync",value:(k=Ge((function*(g){var M=this,C=g.audioDeviceId,N=g.videoDeviceId,F=g.audioSource,G=g.videoSource;if(at(),F!==void 0&&(C=F),G!==void 0&&(N=G),typeof C=="boolean"&&(this._setAllowLocalAudio(C),C=void 0),typeof N=="boolean"&&(this._setAllowLocalVideo(N),N=void 0),!C&&!N)return yield this.getInputDevices();var ie={};return C&&(C instanceof MediaStreamTrack?(this._sharedTracks.audioTrack=C,C=zi,ie.audio={settings:{customTrack:C}}):(delete this._sharedTracks.audioTrack,ie.audio={settings:{deviceId:C}})),N&&(N instanceof MediaStreamTrack?(this._sharedTracks.videoTrack=N,N=zi,ie.video={settings:{customTrack:N}}):(delete this._sharedTracks.videoTrack,ie.video={settings:{deviceId:N}})),this._callObjectMode&&this.needsLoad()?(this._updatePreloadCacheInputSettings(ie,!1),this._devicesFromInputSettings(this._inputSettings)):new Promise((function(fe){M.sendMessageToCallMachine({action:"set-input-devices",audioDeviceId:C,videoDeviceId:N},(function(Oe){if(delete Oe.action,delete Oe.callbackStamp,Oe.returnPreloadCache)return M._updatePreloadCacheInputSettings(ie,!1),void fe(M._devicesFromInputSettings(M._inputSettings));fe(Oe)}))}))})),function(g){return k.apply(this,arguments)})},{key:"setOutputDeviceAsync",value:(Ve=Ge((function*(g){var M=this,C=g.outputDeviceId;if(at(),!C||typeof C!="string")throw new Error("outputDeviceId must be provided and must be a valid device id");return this._preloadCache.outputDeviceId=C,this._callObjectMode&&this.needsLoad()?this._devicesFromInputSettings(this._inputSettings):new Promise((function(N,F){M.sendMessageToCallMachine({action:"set-output-device",outputDeviceId:C},(function(G){if(delete G.action,delete G.callbackStamp,G.error){var ie=new Error(G.error.message);return ie.type=G.error.type,void F(ie)}G.returnPreloadCache?N(M._devicesFromInputSettings(M._inputSettings)):N(G)}))}))})),function(g){return Ve.apply(this,arguments)})},{key:"getInputDevices",value:(Ee=Ge((function*(){var g=this;return this._callObjectMode&&this.needsLoad()?this._devicesFromInputSettings(this._inputSettings):new Promise((function(M){g.sendMessageToCallMachine({action:"get-input-devices"},(function(C){C.returnPreloadCache?M(g._devicesFromInputSettings(g._inputSettings)):M({camera:C.camera,mic:C.mic,speaker:C.speaker})}))}))})),function(){return Ee.apply(this,arguments)})},{key:"nativeInCallAudioMode",value:function(){return Pc(),this._nativeInCallAudioMode}},{key:"setNativeInCallAudioMode",value:function(g){if(Pc(),[cy,Pk].includes(g)){if(g!==this._nativeInCallAudioMode)return this._nativeInCallAudioMode=g,!this.disableReactNativeAutoDeviceManagement("audio")&&Pu(this._callState,this._isPreparingToJoin)&&this.nativeUtils().setAudioMode(this._nativeInCallAudioMode),this}else console.error("invalid in-call audio mode specified: ",g)}},{key:"preAuth",value:(ye=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(zr(this._callObjectMode,"preAuth()"),Sh(this._callState,this._isPreparingToJoin,"preAuth()"),this.needsLoad()&&(yield this.load(M)),!M.url)throw new Error("preAuth() requires at least a url to be provided");return this.validateProperties(M),this.properties=Ne(Ne({},this.properties),M),new Promise((function(C,N){g._preloadCache.inputSettings=g._prepInputSettingsForSharing(g._inputSettings,!1),g.sendMessageToCallMachine({action:"daily-method-preauth",properties:ka(g.properties,g.callClientId),preloadCache:ka(g._preloadCache,g.callClientId)},(function(F){return F.error?N(F.error):F.access?(g._didPreAuth=!0,void C({access:F.access})):N(new Error("unknown error in preAuth()"))}))}))})),function(){return ye.apply(this,arguments)})},{key:"load",value:(ae=Ge((function*(g){var M=this;if(this.needsLoad()){if(this._destroyed&&(this._logUseAfterDestroy(),this.strictMode))throw new Error("Use after destroy");if(g&&(this.validateProperties(g),this.properties=Ne(Ne({},this.properties),g)),!this._callObjectMode&&!this.properties.url)throw new Error("can't load iframe meeting because url property isn't set");return this._updateCallState(gv),this.emitDailyJSEvent({action:dS}),this._callObjectMode?new Promise((function(C,N){M._callObjectLoader.cancel();var F=Date.now();M._callObjectLoader.load(M.properties.dailyConfig,(function(G){M._bundleLoadTime=G?"no-op":Date.now()-F,M._updateCallState(mv),G&&M.emitDailyJSEvent({action:yv}),C()}),(function(G,ie){if(M.emitDailyJSEvent({action:fS}),!ie){M._updateCallState(ps),M.resetMeetingDependentVars();var fe={action:kv,errorMsg:G.msg,error:{type:"connection-error",msg:"Failed to load call object bundle.",details:{on:"load",sourceError:G,bundleUrl:tu(M.properties.dailyConfig)}}};M._maybeSendToSentry(fe),M.emitDailyJSEvent(fe),N(G.msg)}}))})):(this._iframe.src=tm(this.assembleMeetingUrl(),this.properties.dailyConfig),new Promise((function(C,N){M._loadedCallback=function(F){M._callState!==ps?(M._updateCallState(mv),(M.properties.cssFile||M.properties.cssText)&&M.loadCss(M.properties),C()):N(F)}})))}})),function(g){return ae.apply(this,arguments)})},{key:"join",value:(H=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._testCallInProgress&&this.stopTestCallQuality();var C=!1;if(this.needsLoad()){this.updateIsPreparingToJoin(!0);try{yield this.load(M)}catch(N){return this.updateIsPreparingToJoin(!1),Promise.reject(N)}}else{if(C=!(!this.properties.cssFile&&!this.properties.cssText),this._didPreAuth){if(M.url&&M.url!==this.properties.url)return console.error("url in join() is different than the one used in preAuth()"),this.updateIsPreparingToJoin(!1),Promise.reject();if(M.token&&M.token!==this.properties.token)return console.error("token in join() is different than the one used in preAuth()"),this.updateIsPreparingToJoin(!1),Promise.reject()}if(M.url&&!this._callObjectMode&&M.url&&M.url!==this.properties.url)return console.error("url in join() is different than the one used in load() (".concat(this.properties.url," -> ").concat(M.url,")")),this.updateIsPreparingToJoin(!1),Promise.reject();this.validateProperties(M),this.properties=Ne(Ne({},this.properties),M)}return M.showLocalVideo!==void 0&&(this._callObjectMode?console.error("showLocalVideo is not available in callObject mode"):this._showLocalVideo=!!M.showLocalVideo),M.showParticipantsBar!==void 0&&(this._callObjectMode?console.error("showParticipantsBar is not available in callObject mode"):this._showParticipantsBar=!!M.showParticipantsBar),this._callState===bo||this._callState===ih?(console.warn("already joined meeting, call leave() before joining again"),void this.updateIsPreparingToJoin(!1)):(this._updateCallState(ih,!1),this.emitDailyJSEvent({action:gS}),this._preloadCache.inputSettings=this._prepInputSettingsForSharing(this._inputSettings||{},!1),this.sendMessageToCallMachine({action:"join-meeting",properties:ka(this.properties,this.callClientId),preloadCache:ka(this._preloadCache,this.callClientId)}),new Promise((function(N,F){g._joinedCallback=function(G,ie){if(g._callState!==ps){if(g._updateCallState(bo),G)for(var fe in G){if(g._callObjectMode){var Oe=g._callMachine().store;Gv(G[fe],Oe),Jv(G[fe],Oe),Qv(G[fe],g._participants[fe],Oe)}g._participants[fe]=Ne({},G[fe]),g.toggleParticipantAudioBasedOnNativeAudioFocus()}C&&g.loadCss(g.properties),N(G)}else F(ie)}})))})),function(){return H.apply(this,arguments)})},{key:"leave",value:(q=Ge((function*(){var g=this;return this._testCallInProgress&&this.stopTestCallQuality(),new Promise((function(M){g._callState===So||g._callState===ps?M():g._callObjectLoader&&!g._callObjectLoader.loaded?(g._callObjectLoader.cancel(),g._updateCallState(So),g.resetMeetingDependentVars(),g.emitDailyJSEvent({action:So}),M()):(g._resolveLeave=M,g.sendMessageToCallMachine({action:"leave-meeting"}))}))})),function(){return q.apply(this,arguments)})},{key:"startScreenShare",value:(L=Ge((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Iu(this._callMachineInitialized,"startScreenShare()"),M.screenVideoSendSettings&&this._validateVideoSendSettings("screenVideo",M.screenVideoSendSettings),M.mediaStream&&(this._sharedTracks.screenMediaStream=M.mediaStream,M.mediaStream=zi),typeof DailyNativeUtils<"u"&&DailyNativeUtils.isIOS!==void 0&&DailyNativeUtils.isIOS){var C=this.nativeUtils();if(yield C.isScreenBeingCaptured())return void this.emitDailyJSEvent({action:Sv,type:"screen-share-error",errorMsg:"Could not start the screen sharing. The screen is already been captured!"});C.setSystemScreenCaptureStartCallback((function(){C.setSystemScreenCaptureStartCallback(null),g.sendMessageToCallMachine({action:Ev,captureOptions:M})})),C.presentSystemScreenCapturePrompt()}else this.sendMessageToCallMachine({action:Ev,captureOptions:M})})),function(){return L.apply(this,arguments)})},{key:"stopScreenShare",value:function(){Iu(this._callMachineInitialized,"stopScreenShare()"),this.sendMessageToCallMachine({action:"local-screen-stop"})}},{key:"startRecording",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=g.type;if(M&&M!=="cloud"&&M!=="raw-tracks"&&M!=="local")throw new Error("invalid type: ".concat(M,", allowed values 'cloud', 'raw-tracks', or 'local'"));this.sendMessageToCallMachine(Ne({action:"local-recording-start"},g))}},{key:"updateRecording",value:function(g){var M=g.layout,C=M===void 0?{preset:"default"}:M,N=g.instanceId;this.sendMessageToCallMachine({action:"daily-method-update-recording",layout:C,instanceId:N})}},{key:"stopRecording",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(Ne({action:"local-recording-stop"},g))}},{key:"startLiveStreaming",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(Ne({action:"daily-method-start-live-streaming"},g))}},{key:"updateLiveStreaming",value:function(g){var M=g.layout,C=M===void 0?{preset:"default"}:M,N=g.instanceId;this.sendMessageToCallMachine({action:"daily-method-update-live-streaming",layout:C,instanceId:N})}},{key:"addLiveStreamingEndpoints",value:function(g){var M=g.endpoints,C=g.instanceId;this.sendMessageToCallMachine({action:Mv,endpointsOp:rk,endpoints:M,instanceId:C})}},{key:"removeLiveStreamingEndpoints",value:function(g){var M=g.endpoints,C=g.instanceId;this.sendMessageToCallMachine({action:Mv,endpointsOp:ik,endpoints:M,instanceId:C})}},{key:"stopLiveStreaming",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(Ne({action:"daily-method-stop-live-streaming"},g))}},{key:"validateDailyConfig",value:function(g){g.camSimulcastEncodings&&(console.warn("camSimulcastEncodings is deprecated. Use sendSettings, found in DailyCallOptions, to provide camera simulcast settings."),this.validateSimulcastEncodings(g.camSimulcastEncodings)),g.screenSimulcastEncodings&&console.warn("screenSimulcastEncodings is deprecated. Use sendSettings, found in DailyCallOptions, to provide screen simulcast settings."),xv()&&g.noAutoDefaultDeviceChange&&console.warn("noAutoDefaultDeviceChange is not supported on Android, and will be ignored.")}},{key:"validateSimulcastEncodings",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,C=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(g){if(!(g instanceof Array||Array.isArray(g)))throw new Error("encodings must be an Array");if(!Oy(g.length,1,3))throw new Error("encodings must be an Array with between 1 to ".concat(3," layers"));for(var N=0;N<g.length;N++){var F=g[N];for(var G in this._validateEncodingLayerHasValidProperties(F),F)if(wh.includes(G)){if(typeof F[G]!="number")throw new Error("".concat(G," must be a number"));if(M){var ie=M[G],fe=ie.min,Oe=ie.max;if(!Oy(F[G],fe,Oe))throw new Error("".concat(G," value not in range. valid range: ").concat(fe," to ").concat(Oe))}}else if(!["active","scalabilityMode"].includes(G))throw new Error("Invalid key ".concat(G,", valid keys are:")+Object.values(wh));if(C&&!F.hasOwnProperty("maxBitrate"))throw new Error("maxBitrate is not specified")}}}},{key:"startRemoteMediaPlayer",value:(ne=Ge((function*(g){var M=this,C=g.url,N=g.settings,F=N===void 0?{state:ch.PLAY}:N;try{(function(G){if(typeof G!="string")throw new Error('url parameter must be "string" type')})(C),My(F),(function(G){for(var ie in G)if(!fy.includes(ie))throw new Error("Invalid key ".concat(ie,", valid keys are: ").concat(fy));G.simulcastEncodings&&this.validateSimulcastEncodings(G.simulcastEncodings,dy,!0)})(F)}catch(G){throw console.error("invalid argument Error: ".concat(G)),console.error(`startRemoteMediaPlayer arguments must be of the form:
  { url: "playback url",
  settings?:
  {state: "play"|"pause", simulcastEncodings?: [{}] } }`),G}return new Promise((function(G,ie){M.sendMessageToCallMachine({action:"daily-method-start-remote-media-player",url:C,settings:F},(function(fe){fe.error?ie({error:fe.error,errorMsg:fe.errorMsg}):G({session_id:fe.session_id,remoteMediaPlayerState:{state:fe.state,settings:fe.settings}})}))}))})),function(g){return ne.apply(this,arguments)})},{key:"stopRemoteMediaPlayer",value:(Y=Ge((function*(g){var M=this;if(typeof g!="string")throw new Error(" remotePlayerID must be of type string");return new Promise((function(C,N){M.sendMessageToCallMachine({action:"daily-method-stop-remote-media-player",session_id:g},(function(F){F.error?N({error:F.error,errorMsg:F.errorMsg}):C()}))}))})),function(g){return Y.apply(this,arguments)})},{key:"updateRemoteMediaPlayer",value:(V=Ge((function*(g){var M=this,C=g.session_id,N=g.settings;try{My(N)}catch(F){throw console.error("invalid argument Error: ".concat(F)),console.error(`updateRemoteMediaPlayer arguments must be of the form:
  session_id: "participant session",
  { settings?: {state: "play"|"pause"} }`),F}return new Promise((function(F,G){M.sendMessageToCallMachine({action:"daily-method-update-remote-media-player",session_id:C,settings:N},(function(ie){ie.error?G({error:ie.error,errorMsg:ie.errorMsg}):F({session_id:ie.session_id,remoteMediaPlayerState:{state:ie.state,settings:ie.settings}})}))}))})),function(g){return V.apply(this,arguments)})},{key:"startTranscription",value:function(g){_t(this._callState,"startTranscription()"),this.sendMessageToCallMachine(Ne({action:"daily-method-start-transcription"},g))}},{key:"updateTranscription",value:function(g){if(_t(this._callState,"updateTranscription()"),!g)throw new Error("updateTranscription Error: options is mandatory");if(ut(g)!=="object")throw new Error("updateTranscription Error: options must be object type");if(g.participants&&!Array.isArray(g.participants))throw new Error("updateTranscription Error: participants must be an array");this.sendMessageToCallMachine(Ne({action:"daily-method-update-transcription"},g))}},{key:"stopTranscription",value:function(g){if(_t(this._callState,"stopTranscription()"),g&&ut(g)!=="object")throw new Error("stopTranscription Error: options must be object type");if(g&&!g.instanceId)throw new Error('"instanceId" not provided');this.sendMessageToCallMachine(Ne({action:"daily-method-stop-transcription"},g))}},{key:"startDialOut",value:(D=Ge((function*(g){var M=this;_t(this._callState,"startDialOut()");var C=function(ie){if(ie){if(!Array.isArray(ie))throw new Error("Error starting dial out: audio codec must be an array");if(ie.length<=0)throw new Error("Error starting dial out: audio codec array specified but empty");ie.forEach((function(fe){if(typeof fe!="string")throw new Error("Error starting dial out: audio codec must be a string");if(fe!=="OPUS"&&fe!=="PCMU"&&fe!=="PCMA"&&fe!=="G722")throw new Error("Error starting dial out: audio codec must be one of OPUS, PCMU, PCMA, G722")}))}};if(!g.sipUri&&!g.phoneNumber)throw new Error("Error starting dial out: either a sip uri or phone number must be provided");if(g.sipUri&&g.phoneNumber)throw new Error("Error starting dial out: only one of sip uri or phone number must be provided");if(g.sipUri){if(typeof g.sipUri!="string")throw new Error("Error starting dial out: sipUri must be a string");if(!g.sipUri.startsWith("sip:"))throw new Error("Error starting dial out: Invalid SIP URI, must start with 'sip:'");if(g.video&&typeof g.video!="boolean")throw new Error("Error starting dial out: video must be a boolean value");(function(ie){if(ie&&(C(ie.audio),ie.video)){if(!Array.isArray(ie.video))throw new Error("Error starting dial out: video codec must be an array");if(ie.video.length<=0)throw new Error("Error starting dial out: video codec array specified but empty");ie.video.forEach((function(fe){if(typeof fe!="string")throw new Error("Error starting dial out: video codec must be a string");if(fe!=="H264"&&fe!=="VP8")throw new Error("Error starting dial out: video codec must be H264 or VP8")}))}})(g.codecs)}if(g.phoneNumber){if(typeof g.phoneNumber!="string")throw new Error("Error starting dial out: phoneNumber must be a string");if(!/^\+\d{1,}$/.test(g.phoneNumber))throw new Error("Error starting dial out: Invalid phone number, must be valid phone number as per E.164");g.codecs&&C(g.codecs.audio)}if(g.callerId){if(typeof g.callerId!="string")throw new Error("Error starting dial out: callerId must be a string");if(g.sipUri)throw new Error("Error starting dial out: callerId not allowed with sipUri")}if(g.displayName){if(typeof g.displayName!="string")throw new Error("Error starting dial out: displayName must be a string");if(g.displayName.length>=200)throw new Error("Error starting dial out: displayName length must be less than 200")}if(g.userId){if(typeof g.userId!="string")throw new Error("Error starting dial out: userId must be a string");if(g.userId.length>36)throw new Error("Error starting dial out: userId length must be less than or equal to 36")}if(py(g),g.permissions&&g.permissions.canReceive){var N=mn(ry.validateJSONObject(g.permissions.canReceive),2),F=N[0],G=N[1];if(!F)throw new Error(G)}return new Promise((function(ie,fe){M.sendMessageToCallMachine(Ne({action:"dialout-start"},g),(function(Oe){Oe.error?fe(Oe.error):ie(Oe)}))}))})),function(g){return D.apply(this,arguments)})},{key:"stopDialOut",value:function(g){var M=this;return _t(this._callState,"stopDialOut()"),new Promise((function(C,N){M.sendMessageToCallMachine(Ne({action:"dialout-stop"},g),(function(F){F.error?N(F.error):C(F)}))}))}},{key:"sipCallTransfer",value:(R=Ge((function*(g){var M=this;if(_t(this._callState,"sipCallTransfer()"),!g)throw new Error("sipCallTransfer() requires a sessionId and toEndPoint");return g.useSipRefer=!1,Ey(g,"sipCallTransfer"),py(g),new Promise((function(C,N){M.sendMessageToCallMachine(Ne({action:Tv},g),(function(F){F.error?N(F.error):C(F)}))}))})),function(g){return R.apply(this,arguments)})},{key:"sipRefer",value:(A=Ge((function*(g){var M=this;if(_t(this._callState,"sipRefer()"),!g)throw new Error("sessionId and toEndPoint are mandatory parameter");return g.useSipRefer=!0,Ey(g,"sipRefer"),new Promise((function(C,N){M.sendMessageToCallMachine(Ne({action:Tv},g),(function(F){F.error?N(F.error):C(F)}))}))})),function(g){return A.apply(this,arguments)})},{key:"sendDTMF",value:(I=Ge((function*(g){var M=this;return _t(this._callState,"sendDTMF()"),(function(C){var N=C.sessionId,F=C.tones;if(!N||!F)throw new Error("sessionId and tones are mandatory parameter");if(typeof N!="string"||typeof F!="string")throw new Error("sessionId and tones should be of string type");if(F.length>20)throw new Error("tones string must be upto 20 characters");var G=/[^0-9A-D*#]/g,ie=F.match(G);if(ie&&ie[0])throw new Error("".concat(ie[0]," is not valid DTMF tone"))})(g),new Promise((function(C,N){M.sendMessageToCallMachine(Ne({action:"send-dtmf"},g),(function(F){F.error?N(F.error):C(F)}))}))})),function(g){return I.apply(this,arguments)})},{key:"getNetworkStats",value:function(){var g=this;return this._callState!==bo?Promise.resolve(Ne({stats:{latest:{}}},this._network)):new Promise((function(M){g.sendMessageToCallMachine({action:"get-calc-stats"},(function(C){M(Ne(Ne({},g._network),{},{stats:C.stats}))}))}))}},{key:"testWebsocketConnectivity",value:(j=Ge((function*(){var g=this;if(kh(this._testCallInProgress,"testWebsocketConnectivity()"),this.needsLoad())try{yield this.load()}catch(M){return Promise.reject(M)}return new Promise((function(M,C){g.sendMessageToCallMachine({action:"test-websocket-connectivity"},(function(N){N.error?C(N.error):M(N.results)}))}))})),function(){return j.apply(this,arguments)})},{key:"abortTestWebsocketConnectivity",value:function(){this.sendMessageToCallMachine({action:"abort-test-websocket-connectivity"})}},{key:"_validateVideoTrackForNetworkTests",value:function(g){return g?g instanceof MediaStreamTrack?!!Mk(g)||(console.error("Video track is not playable. This test needs a live video track."),!1):(console.error("Video track needs to be of type `MediaStreamTrack`."),!1):(console.error("Missing video track. You must provide a video track in order to run this test."),!1)}},{key:"testCallQuality",value:(O=Ge((function*(){var g=this;at(),zr(this._callObjectMode,"testCallQuality()"),Iu(this._callMachineInitialized,"testCallQuality()",null,!0),Sh(this._callState,this._isPreparingToJoin,"testCallQuality()");var M=this._testCallAlreadyInProgress,C=function(F){M||(g._testCallInProgress=F)};if(C(!0),this.needsLoad())try{var N=this._callState;yield this.load(),this._callState=N}catch(F){return C(!1),Promise.reject(F)}return new Promise((function(F){g.sendMessageToCallMachine({action:"test-call-quality",dailyJsVersion:g.properties.dailyJsVersion},(function(G){var ie=G.results,fe=ie.result,Oe=Wg(ie,Rk);if(fe==="failed"){var $e,Xe=Ne({},Oe);($e=Oe.error)!==null&&$e!==void 0&&$e.details?(Oe.error.details=JSON.parse(Oe.error.details),Xe.error=Ne(Ne({},Xe.error),{},{details:Ne({},Xe.error.details)}),Xe.error.details.duringTest="testCallQuality"):(Xe.error=Xe.error?Ne({},Xe.error):{},Xe.error.details={duringTest:"testCallQuality"}),g._maybeSendToSentry(Xe)}C(!1),F(Ne({result:fe},Oe))}))}))})),function(){return O.apply(this,arguments)})},{key:"stopTestCallQuality",value:function(){this.sendMessageToCallMachine({action:"stop-test-call-quality"})}},{key:"testConnectionQuality",value:(E=Ge((function*(g){var M;ot()?(console.warn("testConnectionQuality() is deprecated: use testPeerToPeerCallQuality() instead"),M=yield this.testPeerToPeerCallQuality(g)):(console.warn("testConnectionQuality() is deprecated: use testCallQuality() instead"),M=yield this.testCallQuality());var C={result:M.result,secondsElapsed:M.secondsElapsed};return M.data&&(C.data={maxRTT:M.data.maxRoundTripTime,packetLoss:M.data.avgRecvPacketLoss}),C})),function(g){return E.apply(this,arguments)})},{key:"testPeerToPeerCallQuality",value:(b=Ge((function*(g){var M=this;if(kh(this._testCallInProgress,"testPeerToPeerCallQuality()"),this.needsLoad())try{yield this.load()}catch(F){return Promise.reject(F)}var C=g.videoTrack,N=g.duration;if(!this._validateVideoTrackForNetworkTests(C))throw new Error("Video track error");return this._sharedTracks.videoTrackForConnectionQualityTest=C,new Promise((function(F,G){M.sendMessageToCallMachine({action:"test-p2p-call-quality",duration:N},(function(ie){ie.error?G(ie.error):F(ie.results)}))}))})),function(g){return b.apply(this,arguments)})},{key:"stopTestConnectionQuality",value:function(){ot()?(console.warn("stopTestConnectionQuality() is deprecated: use testPeerToPeerCallQuality() and stopTestPeerToPeerCallQuality() instead"),this.stopTestPeerToPeerCallQuality()):(console.warn("stopTestConnectionQuality() is deprecated: use testCallQuality() and stopTestCallQuality() instead"),this.stopTestCallQuality())}},{key:"stopTestPeerToPeerCallQuality",value:function(){this.sendMessageToCallMachine({action:"stop-test-p2p-call-quality"})}},{key:"testNetworkConnectivity",value:(y=Ge((function*(g){var M=this;if(kh(this._testCallInProgress,"testNetworkConnectivity()"),this.needsLoad())try{yield this.load()}catch(C){return Promise.reject(C)}if(!this._validateVideoTrackForNetworkTests(g))throw new Error("Video track error");return this._sharedTracks.videoTrackForNetworkConnectivityTest=g,new Promise((function(C,N){M.sendMessageToCallMachine({action:"test-network-connectivity"},(function(F){F.error?N(F.error):C(F.results)}))}))})),function(g){return y.apply(this,arguments)})},{key:"abortTestNetworkConnectivity",value:function(){this.sendMessageToCallMachine({action:"abort-test-network-connectivity"})}},{key:"getCpuLoadStats",value:function(){var g=this;return new Promise((function(M){g._callState===bo?g.sendMessageToCallMachine({action:"get-cpu-load-stats"},(function(C){M(C.cpuStats)})):M({cpuLoadState:void 0,cpuLoadStateReason:void 0,stats:{}})}))}},{key:"_validateEncodingLayerHasValidProperties",value:function(g){var M;if(!(((M=Object.keys(g))===null||M===void 0?void 0:M.length)>0))throw new Error("Empty encoding is not allowed. At least one of these valid keys should be specified:"+Object.values(wh))}},{key:"_validateVideoSendSettings",value:function(g,M){var C=g==="screenVideo"?["default-screen-video","detail-optimized","motion-optimized","motion-and-detail-balanced"]:["default-video","bandwidth-optimized","bandwidth-and-quality-balanced","quality-optimized","adaptive-2-layers","adaptive-3-layers"],N="Video send settings should be either an object or one of the supported presets: ".concat(C.join());if(typeof M=="string"){if(!C.includes(M))throw new Error(N)}else{if(ut(M)!=="object")throw new Error(N);if(!M.maxQuality&&!M.encodings&&M.allowAdaptiveLayers===void 0)throw new Error("Video send settings must contain at least maxQuality, allowAdaptiveLayers or encodings attribute");if(M.maxQuality&&["low","medium","high"].indexOf(M.maxQuality)===-1)throw new Error("maxQuality must be either low, medium or high");if(M.encodings){var F=!1;switch(Object.keys(M.encodings).length){case 1:F=!M.encodings.low;break;case 2:F=!M.encodings.low||!M.encodings.medium;break;case 3:F=!M.encodings.low||!M.encodings.medium||!M.encodings.high;break;default:F=!0}if(F)throw new Error("Encodings must be defined as: low, low and medium, or low, medium and high.");M.encodings.low&&this._validateEncodingLayerHasValidProperties(M.encodings.low),M.encodings.medium&&this._validateEncodingLayerHasValidProperties(M.encodings.medium),M.encodings.high&&this._validateEncodingLayerHasValidProperties(M.encodings.high)}}}},{key:"validateUpdateSendSettings",value:function(g){var M=this;if(!g||Object.keys(g).length===0)throw new Error("Send settings must contain at least information for one track!");Object.entries(g).forEach((function(C){var N=mn(C,2),F=N[0],G=N[1];M._validateVideoSendSettings(F,G)}))}},{key:"updateSendSettings",value:function(g){var M=this;return this.validateUpdateSendSettings(g),this.needsLoad()?(this._preloadCache.sendSettings=g,{sendSettings:this._preloadCache.sendSettings}):new Promise((function(C,N){M.sendMessageToCallMachine({action:"update-send-settings",sendSettings:g},(function(F){F.error?N(F.error):C(F.sendSettings)}))}))}},{key:"getSendSettings",value:function(){return this._sendSettings||this._preloadCache.sendSettings}},{key:"getLocalAudioLevel",value:function(){return this._localAudioLevel}},{key:"getRemoteParticipantsAudioLevel",value:function(){return this._remoteParticipantsAudioLevel}},{key:"getActiveSpeaker",value:function(){return at(),this._activeSpeaker}},{key:"setActiveSpeakerMode",value:function(g){return at(),this.sendMessageToCallMachine({action:"set-active-speaker-mode",enabled:g}),this}},{key:"activeSpeakerMode",value:function(){return at(),this._activeSpeakerMode}},{key:"subscribeToTracksAutomatically",value:function(){return this._preloadCache.subscribeToTracksAutomatically}},{key:"setSubscribeToTracksAutomatically",value:function(g){return _t(this._callState,"setSubscribeToTracksAutomatically()","Use the subscribeToTracksAutomatically configuration property."),this._preloadCache.subscribeToTracksAutomatically=g,this.sendMessageToCallMachine({action:"daily-method-subscribe-to-tracks-automatically",enabled:g}),this}},{key:"enumerateDevices",value:(v=Ge((function*(){var g=this;if(this._callObjectMode){var M=yield navigator.mediaDevices.enumerateDevices();return ko()==="Firefox"&&Eu().major>115&&Eu().major<123&&(M=M.filter((function(C){return C.kind!=="audiooutput"}))),{devices:M.map((function(C){var N=JSON.parse(JSON.stringify(C));if(!ot()&&C.kind==="videoinput"&&C.getCapabilities){var F,G=C.getCapabilities();N.facing=(G==null||(F=G.facingMode)===null||F===void 0?void 0:F.length)>=1?G.facingMode[0]:void 0}return N}))}}return new Promise((function(C){g.sendMessageToCallMachine({action:"enumerate-devices"},(function(N){C({devices:N.devices})}))}))})),function(){return v.apply(this,arguments)})},{key:"sendAppMessage",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"*";if(_t(this._callState,"sendAppMessage()"),JSON.stringify(g).length>this._maxAppMessageSize)throw new Error("Message data too large. Max size is "+this._maxAppMessageSize);return this.sendMessageToCallMachine({action:"app-msg",data:g,to:M}),this}},{key:"addFakeParticipant",value:function(g){return at(),_t(this._callState,"addFakeParticipant()"),this.sendMessageToCallMachine(Ne({action:"add-fake-participant"},g)),this}},{key:"setShowNamesMode",value:function(g){return dr(this._callObjectMode,"setShowNamesMode()"),at(),g&&g!=="always"&&g!=="never"?(console.error('setShowNamesMode argument should be "always", "never", or false'),this):(this.sendMessageToCallMachine({action:"set-show-names",mode:g}),this)}},{key:"setShowLocalVideo",value:function(){var g=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return dr(this._callObjectMode,"setShowLocalVideo()"),at(),_t(this._callState,"setShowLocalVideo()"),typeof g!="boolean"?(console.error("setShowLocalVideo only accepts a boolean value"),this):(this.sendMessageToCallMachine({action:"set-show-local-video",show:g}),this._showLocalVideo=g,this)}},{key:"showLocalVideo",value:function(){return dr(this._callObjectMode,"showLocalVideo()"),at(),this._showLocalVideo}},{key:"setShowParticipantsBar",value:function(){var g=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return dr(this._callObjectMode,"setShowParticipantsBar()"),at(),_t(this._callState,"setShowParticipantsBar()"),typeof g!="boolean"?(console.error("setShowParticipantsBar only accepts a boolean value"),this):(this.sendMessageToCallMachine({action:"set-show-participants-bar",show:g}),this._showParticipantsBar=g,this)}},{key:"showParticipantsBar",value:function(){return dr(this._callObjectMode,"showParticipantsBar()"),at(),this._showParticipantsBar}},{key:"customIntegrations",value:function(){return at(),dr(this._callObjectMode,"customIntegrations()"),this._customIntegrations}},{key:"setCustomIntegrations",value:function(g){return at(),dr(this._callObjectMode,"setCustomIntegrations()"),_t(this._callState,"setCustomIntegrations()"),ky(g)?(this.sendMessageToCallMachine({action:"set-custom-integrations",integrations:g}),this._customIntegrations=g,this):this}},{key:"startCustomIntegrations",value:function(g){var M=this;if(at(),dr(this._callObjectMode,"startCustomIntegrations()"),_t(this._callState,"startCustomIntegrations()"),Array.isArray(g)&&g.some((function(F){return typeof F!="string"}))||!Array.isArray(g)&&typeof g!="string")return console.error("startCustomIntegrations() only accepts string | string[]"),this;var C=typeof g=="string"?[g]:g,N=C.filter((function(F){return!(F in M._customIntegrations)}));return N.length?(console.error(`Can't find custom integration(s): "`.concat(N.join(", "),'"')),this):(this.sendMessageToCallMachine({action:"start-custom-integrations",ids:C}),this)}},{key:"stopCustomIntegrations",value:function(g){var M=this;if(at(),dr(this._callObjectMode,"stopCustomIntegrations()"),_t(this._callState,"stopCustomIntegrations()"),Array.isArray(g)&&g.some((function(F){return typeof F!="string"}))||!Array.isArray(g)&&typeof g!="string")return console.error("stopCustomIntegrations() only accepts string | string[]"),this;var C=typeof g=="string"?[g]:g,N=C.filter((function(F){return!(F in M._customIntegrations)}));return N.length?(console.error(`Can't find custom integration(s): "`.concat(N.join(", "),'"')),this):(this.sendMessageToCallMachine({action:"stop-custom-integrations",ids:C}),this)}},{key:"customTrayButtons",value:function(){return dr(this._callObjectMode,"customTrayButtons()"),at(),this._customTrayButtons}},{key:"updateCustomTrayButtons",value:function(g){return dr(this._callObjectMode,"updateCustomTrayButtons()"),at(),_t(this._callState,"updateCustomTrayButtons()"),Sy(g)?(this.sendMessageToCallMachine({action:"update-custom-tray-buttons",btns:g}),this._customTrayButtons=g,this):(console.error("updateCustomTrayButtons only accepts a dictionary of the type ".concat(JSON.stringify(Tu))),this)}},{key:"theme",value:function(){return dr(this._callObjectMode,"theme()"),this.properties.theme}},{key:"setTheme",value:function(g){var M=this;return dr(this._callObjectMode,"setTheme()"),new Promise((function(C,N){try{M.validateProperties({theme:g}),M.properties.theme=Ne({},g),M.sendMessageToCallMachine({action:"set-theme",theme:M.properties.theme});try{M.emitDailyJSEvent({action:uS,theme:M.properties.theme})}catch(F){console.log("could not emit 'theme-updated'",F)}C(M.properties.theme)}catch(F){N(F)}}))}},{key:"requestFullscreen",value:(h=Ge((function*(){if(at(),this._iframe&&!document.fullscreenElement&&Av())try{(yield this._iframe.requestFullscreen)?this._iframe.requestFullscreen():this._iframe.webkitRequestFullscreen()}catch(g){console.log("could not make video call fullscreen",g)}})),function(){return h.apply(this,arguments)})},{key:"exitFullscreen",value:function(){at(),document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement&&document.webkitExitFullscreen()}},{key:"getSidebarView",value:(f=Ge((function*(){var g=this;return this._callObjectMode?(console.error("getSidebarView is not available in callObject mode"),Promise.resolve(null)):new Promise((function(M){g.sendMessageToCallMachine({action:"get-sidebar-view"},(function(C){M(C.view)}))}))})),function(){return f.apply(this,arguments)})},{key:"setSidebarView",value:function(g){return this._callObjectMode?(console.error("setSidebarView is not available in callObject mode"),this):(this.sendMessageToCallMachine({action:"set-sidebar-view",view:g}),this)}},{key:"room",value:(l=Ge((function*(){var g=this,M=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).includeRoomConfigDefaults,C=M===void 0||M;return this._accessState.access===sh||this.needsLoad()?this.properties.url?{roomUrlPendingJoin:this.properties.url}:null:new Promise((function(N){g.sendMessageToCallMachine({action:"lib-room-info",includeRoomConfigDefaults:C},(function(F){delete F.action,delete F.callbackStamp,N(F)}))}))})),function(){return l.apply(this,arguments)})},{key:"geo",value:(a=Ge((function*(){try{var g=yield fetch("https://gs.daily.co/_ks_/x-swsl/:");return{current:(yield g.json()).geo}}catch(M){return console.error("geo lookup failed",M),{current:""}}})),function(){return a.apply(this,arguments)})},{key:"setNetworkTopology",value:(r=Ge((function*(g){var M=this;return at(),_t(this._callState,"setNetworkTopology()"),new Promise((function(C,N){M.sendMessageToCallMachine({action:"set-network-topology",opts:g},(function(F){F.error?N({error:F.error}):C({workerId:F.workerId})}))}))})),function(g){return r.apply(this,arguments)})},{key:"getNetworkTopology",value:(e=Ge((function*(){var g=this;return new Promise((function(M,C){g.needsLoad()&&M({topology:"none"}),g.sendMessageToCallMachine({action:"get-network-topology"},(function(N){N.error?C({error:N.error}):M({topology:N.topology})}))}))})),function(){return e.apply(this,arguments)})},{key:"setPlayNewParticipantSound",value:function(g){if(at(),typeof g!="number"&&g!==!0&&g!==!1)throw new Error("argument to setShouldPlayNewParticipantSound should be true, false, or a number, but is ".concat(g));this.sendMessageToCallMachine({action:"daily-method-set-play-ding",arg:g})}},{key:"on",value:function(g,M){return Zl.prototype.on.call(this,g,M)}},{key:"once",value:function(g,M){return Zl.prototype.once.call(this,g,M)}},{key:"off",value:function(g,M){return Zl.prototype.off.call(this,g,M)}},{key:"validateProperties",value:function(g){var M,C;if(g!=null&&(M=g.dailyConfig)!==null&&M!==void 0&&M.userMediaAudioConstraints){var N,F;ot()||console.warn("userMediaAudioConstraints is deprecated. You can override constraints with inputSettings.audio.settings, found in DailyCallOptions.");var G=g.inputSettings||{};G.audio=((N=g.inputSettings)===null||N===void 0?void 0:N.audio)||{},G.audio.settings=((F=g.inputSettings)===null||F===void 0||(F=F.audio)===null||F===void 0?void 0:F.settings)||{},G.audio.settings=Ne(Ne({},G.audio.settings),g.dailyConfig.userMediaAudioConstraints),g.inputSettings=G,delete g.dailyConfig.userMediaAudioConstraints}if(g!=null&&(C=g.dailyConfig)!==null&&C!==void 0&&C.userMediaVideoConstraints){var ie,fe;ot()||console.warn("userMediaVideoConstraints is deprecated. You can override constraints with inputSettings.video.settings, found in DailyCallOptions.");var Oe=g.inputSettings||{};Oe.video=((ie=g.inputSettings)===null||ie===void 0?void 0:ie.video)||{},Oe.video.settings=((fe=g.inputSettings)===null||fe===void 0||(fe=fe.video)===null||fe===void 0?void 0:fe.settings)||{},Oe.video.settings=Ne(Ne({},Oe.video.settings),g.dailyConfig.userMediaVideoConstraints),g.inputSettings=Oe,delete g.dailyConfig.userMediaVideoConstraints}for(var $e in g)if(Eo[$e]){if(Eo[$e].validate&&!Eo[$e].validate(g[$e],this))throw new Error("property '".concat($e,"': ").concat(Eo[$e].help))}else console.warn("Ignoring unrecognized property '".concat($e,"'")),delete g[$e]}},{key:"assembleMeetingUrl",value:function(){var g,M,C=Ne(Ne({},this.properties),{},{emb:this.callClientId,embHref:encodeURIComponent(window.location.href),proxy:(g=this.properties.dailyConfig)!==null&&g!==void 0&&g.proxyUrl?encodeURIComponent((M=this.properties.dailyConfig)===null||M===void 0?void 0:M.proxyUrl):void 0}),N=C.url.match(/\?/)?"&":"?";return C.url+N+Object.keys(Eo).filter((function(F){return Eo[F].queryString&&C[F]!==void 0})).map((function(F){return"".concat(Eo[F].queryString,"=").concat(C[F])})).join("&")}},{key:"needsLoad",value:function(){return[pv,gv,So,ps].includes(this._callState)}},{key:"sendMessageToCallMachine",value:function(g,M){if(this._destroyed&&(this._logUseAfterDestroy(),this.strictMode))throw new Error("Use after destroy");this._messageChannel.sendMessageToCallMachine(g,M,this.callClientId,this._iframe)}},{key:"forwardPackagedMessageToCallMachine",value:function(g){this._messageChannel.forwardPackagedMessageToCallMachine(g,this._iframe,this.callClientId)}},{key:"addListenerForPackagedMessagesFromCallMachine",value:function(g){return this._messageChannel.addListenerForPackagedMessagesFromCallMachine(g,this.callClientId)}},{key:"removeListenerForPackagedMessagesFromCallMachine",value:function(g){this._messageChannel.removeListenerForPackagedMessagesFromCallMachine(g)}},{key:"handleMessageFromCallMachine",value:function(g){switch(g.action){case cS:this.sendMessageToCallMachine(Ne({action:lS},this.properties));break;case"call-machine-initialized":this._callMachineInitialized=!0;var M={action:ku,level:"log",code:1011,stats:{event:"bundle load",time:this._bundleLoadTime==="no-op"?0:this._bundleLoadTime,preLoaded:this._bundleLoadTime==="no-op",url:tu(this.properties.dailyConfig)}};this.sendMessageToCallMachine(M),this._delayDuplicateInstanceLog&&this._logDuplicateInstanceAttempt();break;case yv:this._loadedCallback&&(this._loadedCallback(),this._loadedCallback=null),this.emitDailyJSEvent(g);break;case mS:var C,N=Ne({},g);delete N.internal,this._maxAppMessageSize=((C=g.internal)===null||C===void 0?void 0:C._maxAppMessageSize)||oh,this._joinedCallback&&(this._joinedCallback(g.participants),this._joinedCallback=null),this.emitDailyJSEvent(N);break;case yS:case _S:if(this._callState===So)return;if(g.participant&&g.participant.session_id){var F=g.participant.local?"local":g.participant.session_id;if(this._callObjectMode){var G=this._callMachine().store;Gv(g.participant,G),Jv(g.participant,G),Qv(g.participant,this._participants[F],G)}try{this.maybeParticipantTracksStopped(this._participants[F],g.participant),this.maybeParticipantTracksStarted(this._participants[F],g.participant),this.maybeEventRecordingStopped(this._participants[F],g.participant),this.maybeEventRecordingStarted(this._participants[F],g.participant)}catch(qi){console.error("track events error",qi)}this.compareEqualForParticipantUpdateEvent(g.participant,this._participants[F])||(this._participants[F]=Ne({},g.participant),this.toggleParticipantAudioBasedOnNativeAudioFocus(),this.emitDailyJSEvent(g))}break;case wS:if(g.participant&&g.participant.session_id){var ie=this._participants[g.participant.session_id];ie&&this.maybeParticipantTracksStopped(ie,null),delete this._participants[g.participant.session_id],this.emitDailyJSEvent(g)}break;case bS:Pn(this._participantCounts,g.participantCounts)||(this._participantCounts=g.participantCounts,this.emitDailyJSEvent(g));break;case SS:var fe={access:g.access};g.awaitingAccess&&(fe.awaitingAccess=g.awaitingAccess),Pn(this._accessState,fe)||(this._accessState=fe,this.emitDailyJSEvent(g));break;case kS:if(g.meetingSession){this._meetingSessionSummary=g.meetingSession,this.emitDailyJSEvent(g);var Oe=Ne(Ne({},g),{},{action:"meeting-session-updated"});this.emitDailyJSEvent(Oe)}break;case kv:var $e;this._iframe&&!g.preserveIframe&&(this._iframe.src=""),this._updateCallState(ps),this.resetMeetingDependentVars(),this._loadedCallback&&(this._loadedCallback(g.errorMsg),this._loadedCallback=null),g.preserveIframe;var Xe=Wg(g,Ak);Xe!=null&&($e=Xe.error)!==null&&$e!==void 0&&$e.details&&(Xe.error.details=JSON.parse(Xe.error.details)),this._maybeSendToSentry(g),this._joinedCallback&&(this._joinedCallback(null,Xe),this._joinedCallback=null),this.emitDailyJSEvent(Xe);break;case vS:this._callState!==ps&&this._updateCallState(So),this.resetMeetingDependentVars(),this._resolveLeave&&(this._resolveLeave(),this._resolveLeave=null),this.emitDailyJSEvent(g);break;case"selected-devices-updated":g.devices&&this.emitDailyJSEvent(g);break;case GS:var Vt=g.state,bn=g.threshold,Ln=g.quality,mt=Vt.state,At=Vt.reasons;mt===this._network.networkState&&Pn(At,this._network.networkStateReasons)&&bn===this._network.threshold&&Ln===this._network.quality||(this._network.networkState=mt,this._network.networkStateReasons=At,this._network.quality=Ln,this._network.threshold=bn,g.networkState=mt,At.length&&(g.networkStateReasons=At),delete g.state,this.emitDailyJSEvent(g));break;case QS:g&&g.cpuLoadState&&this.emitDailyJSEvent(g);break;case KS:g&&g.faceCounts!==void 0&&this.emitDailyJSEvent(g);break;case WS:var en=g.activeSpeaker;this._activeSpeaker.peerId!==en.peerId&&(this._activeSpeaker.peerId=en.peerId,this.emitDailyJSEvent({action:g.action,activeSpeaker:this._activeSpeaker}));break;case"show-local-video-changed":if(this._callObjectMode)return;var zt=g.show;this._showLocalVideo=zt,this.emitDailyJSEvent({action:g.action,show:zt});break;case HS:var Ze=g.enabled;this._activeSpeakerMode!==Ze&&(this._activeSpeakerMode=Ze,this.emitDailyJSEvent({action:g.action,enabled:this._activeSpeakerMode}));break;case ES:case MS:case OS:this._waitingParticipants=g.allWaitingParticipants,this.emitDailyJSEvent({action:g.action,participant:g.participant});break;case nk:Pn(this._receiveSettings,g.receiveSettings)||(this._receiveSettings=g.receiveSettings,this.emitDailyJSEvent({action:g.action,receiveSettings:g.receiveSettings}));break;case bv:this._maybeUpdateInputSettings(g.inputSettings);break;case"send-settings-updated":Pn(this._sendSettings,g.sendSettings)||(this._sendSettings=g.sendSettings,this._preloadCache.sendSettings=null,this.emitDailyJSEvent({action:g.action,sendSettings:g.sendSettings}));break;case"local-audio-level":this._localAudioLevel=g.audioLevel,this._preloadCache.localAudioLevelObserver=null,this.emitDailyJSEvent(g);break;case"remote-participants-audio-level":this._remoteParticipantsAudioLevel=g.participantsAudioLevel,this._preloadCache.remoteParticipantsAudioLevelObserver=null,this.emitDailyJSEvent(g);break;case BS:var jn=g.session_id;this._rmpPlayerState[jn]=g.playerState,this.emitDailyJSEvent(g);break;case VS:delete this._rmpPlayerState[g.session_id],this.emitDailyJSEvent(g);break;case FS:var Qn=g.session_id,Jt=this._rmpPlayerState[Qn];Jt&&this.compareEqualForRMPUpdateEvent(Jt,g.remoteMediaPlayerState)||(this._rmpPlayerState[Qn]=g.remoteMediaPlayerState,this.emitDailyJSEvent(g));break;case"custom-button-click":case"sidebar-view-changed":case"pip-started":case"pip-stopped":this.emitDailyJSEvent(g);break;case CS:var Mr=this._meetingSessionState.topology!==(g.meetingSessionState&&g.meetingSessionState.topology);this._meetingSessionState=Eh(g.meetingSessionState,this._callObjectMode),(this._callObjectMode||Mr)&&this.emitDailyJSEvent(g);break;case zS:this._isScreenSharing=!0,this.emitDailyJSEvent(g);break;case $S:case qS:this._isScreenSharing=!1,this.emitDailyJSEvent(g);break;case _v:case wv:case xS:case LS:case jS:case AS:case PS:case IS:case hS:case pS:case DS:case US:case"test-completed":case JS:case NS:case YS:case XS:case ZS:case ek:case Sv:case tk:case"dialin-ready":case"dialin-connected":case"dialin-error":case"dialin-stopped":case"dialin-warning":case"dialout-connected":case"dialout-answered":case"dialout-error":case"dialout-stopped":case"dialout-warning":this.emitDailyJSEvent(g);break;case"request-fullscreen":this.requestFullscreen();break;case"request-exit-fullscreen":this.exitFullscreen()}}},{key:"maybeEventRecordingStopped",value:function(g,M){var C="record";g&&(M.local||M[C]!==!1||g[C]===M[C]||this.emitDailyJSEvent({action:wv}))}},{key:"maybeEventRecordingStarted",value:function(g,M){var C="record";g&&(M.local||M[C]!==!0||g[C]===M[C]||this.emitDailyJSEvent({action:_v}))}},{key:"_trackStatePlayable",value:function(g){return!(!g||g.state!==rS)}},{key:"_trackChanged",value:function(g,M){return g?.id!==M?.id}},{key:"maybeEventTrackStopped",value:function(g,M,C){var N,F,G=(N=M?.tracks[g])!==null&&N!==void 0?N:null,ie=(F=C?.tracks[g])!==null&&F!==void 0?F:null,fe=G?.track;if(fe){var Oe=this._trackStatePlayable(G),$e=this._trackStatePlayable(ie),Xe=this._trackChanged(fe,ie?.track);Oe&&($e&&!Xe||this.emitDailyJSEvent({action:RS,track:fe,participant:C??M,type:g}))}}},{key:"maybeEventTrackStarted",value:function(g,M,C){var N,F,G=(N=M?.tracks[g])!==null&&N!==void 0?N:null,ie=(F=C?.tracks[g])!==null&&F!==void 0?F:null,fe=ie?.track;if(fe){var Oe=this._trackStatePlayable(G),$e=this._trackStatePlayable(ie),Xe=this._trackChanged(G?.track,fe);$e&&(Oe&&!Xe||this.emitDailyJSEvent({action:TS,track:fe,participant:C,type:g}))}}},{key:"maybeParticipantTracksStopped",value:function(g,M){if(g)for(var C in g.tracks)this.maybeEventTrackStopped(C,g,M)}},{key:"maybeParticipantTracksStarted",value:function(g,M){if(M)for(var C in M.tracks)this.maybeEventTrackStarted(C,g,M)}},{key:"compareEqualForRMPUpdateEvent",value:function(g,M){var C,N;return g.state===M.state&&((C=g.settings)===null||C===void 0?void 0:C.volume)===((N=M.settings)===null||N===void 0?void 0:N.volume)}},{key:"emitDailyJSEvent",value:function(g){try{g.callClientId=this.callClientId,this.emit(g.action,g)}catch(M){console.log("could not emit",g,M)}}},{key:"compareEqualForParticipantUpdateEvent",value:function(g,M){return!!Pn(g,M)&&(!g.videoTrack||!M.videoTrack||g.videoTrack.id===M.videoTrack.id&&g.videoTrack.muted===M.videoTrack.muted&&g.videoTrack.enabled===M.videoTrack.enabled)&&(!g.audioTrack||!M.audioTrack||g.audioTrack.id===M.audioTrack.id&&g.audioTrack.muted===M.audioTrack.muted&&g.audioTrack.enabled===M.audioTrack.enabled)}},{key:"nativeUtils",value:function(){return ot()?typeof DailyNativeUtils>"u"?(console.warn("in React Native, DailyNativeUtils is expected to be available"),null):DailyNativeUtils:null}},{key:"updateIsPreparingToJoin",value:function(g){this._updateCallState(this._callState,g)}},{key:"_updateCallState",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._isPreparingToJoin;if(g!==this._callState||M!==this._isPreparingToJoin){var C=this._callState,N=this._isPreparingToJoin;this._callState=g,this._isPreparingToJoin=M;var F=this._callState===bo;this.updateShowAndroidOngoingMeetingNotification(F);var G=Pu(C,N),ie=Pu(this._callState,this._isPreparingToJoin);G!==ie&&(this.updateKeepDeviceAwake(ie),this.updateDeviceAudioMode(ie),this.updateNoOpRecordingEnsuringBackgroundContinuity(ie))}}},{key:"resetMeetingDependentVars",value:function(){this._participants={},this._participantCounts=uy,this._waitingParticipants={},this._activeSpeaker={},this._activeSpeakerMode=!1,this._didPreAuth=!1,this._accessState={access:sh},this._finalSummaryOfPrevSession=this._meetingSessionSummary,this._meetingSessionSummary={},this._meetingSessionState=Eh(ly,this._callObjectMode),this._isScreenSharing=!1,this._receiveSettings={},this._inputSettings=void 0,this._sendSettings={},this._localAudioLevel=0,this._isLocalAudioLevelObserverRunning=!1,this._remoteParticipantsAudioLevel={},this._isRemoteParticipantsAudioLevelObserverRunning=!1,this._maxAppMessageSize=oh,this._callMachineInitialized=!1,this._bundleLoadTime=void 0,this._preloadCache}},{key:"updateKeepDeviceAwake",value:function(g){ot()&&this.nativeUtils().setKeepDeviceAwake(g,this.callClientId)}},{key:"updateDeviceAudioMode",value:function(g){if(ot()&&!this.disableReactNativeAutoDeviceManagement("audio")){var M=g?this._nativeInCallAudioMode:"idle";this.nativeUtils().setAudioMode(M)}}},{key:"updateShowAndroidOngoingMeetingNotification",value:function(g){if(ot()&&this.nativeUtils().setShowOngoingMeetingNotification){var M,C,N,F;if(this.properties.reactNativeConfig&&this.properties.reactNativeConfig.androidInCallNotification){var G=this.properties.reactNativeConfig.androidInCallNotification;M=G.title,C=G.subtitle,N=G.iconName,F=G.disableForCustomOverride}F&&(g=!1),this.nativeUtils().setShowOngoingMeetingNotification(g,M,C,N,this.callClientId)}}},{key:"updateNoOpRecordingEnsuringBackgroundContinuity",value:function(g){ot()&&this.nativeUtils().enableNoOpRecordingEnsuringBackgroundContinuity&&this.nativeUtils().enableNoOpRecordingEnsuringBackgroundContinuity(g)}},{key:"toggleParticipantAudioBasedOnNativeAudioFocus",value:function(){var g;if(ot()){var M=(g=this._callMachine())===null||g===void 0||(g=g.store)===null||g===void 0?void 0:g.getState();for(var C in M?.streams){var N=M.streams[C];N&&N.pendingTrack&&N.pendingTrack.kind==="audio"&&(N.pendingTrack.enabled=this._hasNativeAudioFocus)}}}},{key:"disableReactNativeAutoDeviceManagement",value:function(g){return this.properties.reactNativeConfig&&this.properties.reactNativeConfig.disableAutoDeviceManagement&&this.properties.reactNativeConfig.disableAutoDeviceManagement[g]}},{key:"absoluteUrl",value:function(g){if(g!==void 0){var M=document.createElement("a");return M.href=g,M.href}}},{key:"sayHello",value:function(){var g="hello, world.";return console.log(g),g}},{key:"_logUseAfterDestroy",value:function(){var g=Object.values(Co)[0];if(this.needsLoad())if(g&&!g.needsLoad()){var M={action:ku,level:"error",code:this.strictMode?9995:9997};g.sendMessageToCallMachine(M)}else this.strictMode||console.error("You are are attempting to use a call instance that was previously destroyed, which is unsupported. Please remove `strictMode: false` from your constructor properties to enable strict mode to track down and fix this unsupported usage.");else{var C={action:ku,level:"error",code:this.strictMode?9995:9997};this._messageChannel.sendMessageToCallMachine(C,null,this.callClientId,this._iframe)}}},{key:"_logDuplicateInstanceAttempt",value:function(){for(var g=0,M=Object.values(Co);g<M.length;g++){var C=M[g];C._callMachineInitialized?(C.sendMessageToCallMachine({action:ku,level:"warn",code:this.allowMultipleCallInstances?9993:9992}),C._delayDuplicateInstanceLog=!1):C._delayDuplicateInstanceLog=!0}}},{key:"_maybeSendToSentry",value:function(g){var M,C,N,F;if(!((M=g.error)!==null&&M!==void 0&&M.type&&(![aS,oS,vv].includes(g.error.type)||g.error.type===vv&&g.error.msg.includes("deleted")))){var G=(C=this.properties)!==null&&C!==void 0&&C.url?new URL(this.properties.url):void 0,ie="production";G&&G.host.includes(".staging.daily")&&(ie="staging");var fe,Oe,$e,Xe,Vt,bn=(function(jn){const Qn=[kb(),bb(),Qb(),Gb(),eS(),nS(),Ob(),tS()];return jn.autoSessionTracking!==!1&&Qn.push(Zb()),Qn})({}).filter((function(jn){return!["BrowserApiErrors","Breadcrumbs","GlobalHandlers"].includes(jn.name)})),Ln=new jb({dsn:"https://f10f1c81e5d44a4098416c0867a8b740@o77906.ingest.sentry.io/168844",transport:Fb,stackParser:Hb,integrations:bn,environment:ie}),mt=new hs;if(mt.setClient(Ln),Ln.init(),this.session_id&&mt.setExtra("sessionId",this.session_id),this.properties){var At=Ne({},this.properties);At.userName=At.userName?"[Filtered]":void 0,At.userData=At.userData?"[Filtered]":void 0,At.token=At.token?"[Filtered]":void 0,mt.setExtra("properties",At)}if(G){var en=G.searchParams.get("domain");if(!en){var zt=G.host.match(/(.*?)\./);en=zt&&zt[1]||""}en&&mt.setTag("domain",en)}g.error&&(mt.setTag("fatalErrorType",g.error.type),mt.setExtra("errorDetails",g.error.details),!((fe=g.error.details)===null||fe===void 0)&&fe.uri&&mt.setTag("serverAddress",g.error.details.uri),!((Oe=g.error.details)===null||Oe===void 0)&&Oe.workerGroup&&mt.setTag("workerGroup",g.error.details.workerGroup),!(($e=g.error.details)===null||$e===void 0)&&$e.geoGroup&&mt.setTag("geoGroup",g.error.details.geoGroup),!((Xe=g.error.details)===null||Xe===void 0)&&Xe.on&&mt.setTag("connectionAttempt",g.error.details.on),(Vt=g.error.details)!==null&&Vt!==void 0&&Vt.bundleUrl&&(mt.setTag("bundleUrl",g.error.details.bundleUrl),mt.setTag("bundleError",g.error.details.sourceError.type))),mt.setTags({callMode:this._callObjectMode?ot()?"reactNative":(N=this.properties)!==null&&N!==void 0&&(N=N.dailyConfig)!==null&&N!==void 0&&(N=N.callMode)!==null&&N!==void 0&&N.includes("prebuilt")?this.properties.dailyConfig.callMode:"custom":"prebuilt-frame",version:n.version()});var Ze=((F=g.error)===null||F===void 0?void 0:F.msg)||g.errorMsg;mt.captureException(new Error(Ze))}}},{key:"_callMachine",value:function(){var g;return(g=window._daily)===null||g===void 0||(g=g.instances)===null||g===void 0||(g=g[this.callClientId])===null||g===void 0?void 0:g.callMachine}},{key:"_maybeUpdateInputSettings",value:function(g){if(!Pn(this._inputSettings,g)){var M=this._getInputSettings();this._inputSettings=g;var C=this._getInputSettings();Pn(M,C)||this.emitDailyJSEvent({action:bv,inputSettings:C})}}}],[{key:"supportedBrowser",value:function(){if(ot())return{supported:!0,mobile:!0,name:"React Native",version:null,supportsScreenShare:!0,supportsSfu:!0,supportsVideoProcessing:!1,supportsAudioProcessing:!1};var g=$w.getParser(kr());return{supported:!!dh(),mobile:g.getPlatformType()==="mobile",name:g.getBrowserName(),version:g.getBrowserVersion(),supportsFullscreen:!!Av(),supportsScreenShare:!!sk(),supportsSfu:!!dh(),supportsVideoProcessing:Pv(),supportsAudioProcessing:Iv()}}},{key:"version",value:function(){return"0.84.0"}},{key:"createCallObject",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g.layout="none",new n(null,g)}},{key:"wrap",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(at(),!g||!g.contentWindow||typeof g.src!="string")throw new Error("DailyIframe::Wrap needs an iframe-like first argument");return M.layout||(M.customLayout?M.layout="custom-v1":M.layout="browser"),new n(g,M)}},{key:"createFrame",value:function(g,M){var C,N;at(),g&&M?(C=g,N=M):g&&g.append?(C=g,N={}):(C=document.body,N=g||{});var F=N.iframeStyle;F||(F=C===document.body?{position:"fixed",border:"1px solid black",backgroundColor:"white",width:"375px",height:"450px",right:"1em",bottom:"1em"}:{border:0,width:"100%",height:"100%"});var G=document.createElement("iframe");window.navigator&&window.navigator.userAgent.match(/Chrome\/61\./)?G.allow="microphone, camera":G.allow="microphone; camera; autoplay; display-capture; screen-wake-lock",G.style.visibility="hidden",C.appendChild(G),G.style.visibility=null,Object.keys(F).forEach((function(ie){return G.style[ie]=F[ie]})),N.layout||(N.customLayout?N.layout="custom-v1":N.layout="browser");try{return new n(G,N)}catch(ie){throw C.removeChild(G),ie}}},{key:"createTransparentFrame",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};at();var M=document.createElement("iframe");return M.allow="microphone; camera; autoplay",M.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
      pointer-events: none;
    `,document.body.appendChild(M),g.layout||(g.layout="custom-v1"),n.wrap(M,g)}},{key:"getCallInstance",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return g?Co[g]:Object.values(Co)[0]}}]);var e,r,a,l,f,h,v,y,b,E,O,j,I,A,R,D,V,Y,ne,L,q,H,ae,ye,Ee,Ve,k,ze,Me,K,Ue,it,be,he,Ce,oe,J,le})();function py(n){if(n.extension){if(typeof n.extension!="string")throw new Error("Error starting dial out: extension must be a string");if(n.extension.length>20)throw new Error("Error starting dial out: extension length must be less than or equal to 20")}if(n.waitBeforeExtensionDialSec){if(typeof n.waitBeforeExtensionDialSec!="number")throw new Error("Error starting dial out: waitBeforeExtensionDialSec must be a number");if(n.waitBeforeExtensionDialSec>60)throw new Error("Error starting dial out: waitBeforeExtensionDialSec must be less than or equal to 60");if(!n.extension)throw new Error("Error starting dial out: waitBeforeExtensionDialSec requires a phoneNumber and extension")}}function ka(n,e){var r={};for(var a in n)if(n[a]instanceof MediaStreamTrack)console.warn("MediaStreamTrack found in props or cache.",a),r[a]=zi;else if(a==="dailyConfig"){if(n[a].modifyLocalSdpHook){var l=window._daily.instances[e].customCallbacks||{};l.modifyLocalSdpHook=n[a].modifyLocalSdpHook,window._daily.instances[e].customCallbacks=l,delete n[a].modifyLocalSdpHook}if(n[a].modifyRemoteSdpHook){var f=window._daily.instances[e].customCallbacks||{};f.modifyRemoteSdpHook=n[a].modifyRemoteSdpHook,window._daily.instances[e].customCallbacks=f,delete n[a].modifyRemoteSdpHook}r[a]=n[a]}else r[a]=n[a];return r}function _t(n){var e=arguments.length>2?arguments[2]:void 0;if(n!==bo){var r="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," only supported after join.");throw e&&(r+=" ".concat(e)),console.error(r),new Error(r)}}function Pu(n,e){return[ih,bo].includes(n)||e}function Sh(n,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"This daily-js method",a=arguments.length>3?arguments[3]:void 0;if(Pu(n,e)){var l="".concat(r," not supported after joining a meeting.");throw a&&(l+=" ".concat(a)),console.error(l),new Error(l)}}function Iu(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method",r=arguments.length>2?arguments[2]:void 0;if(!n){var a="".concat(e,arguments.length>3&&arguments[3]!==void 0&&arguments[3]?" requires preAuth() or startCamera() to initialize call state.":" requires preAuth(), startCamera(), or join() to initialize call state.");throw r&&(a+=" ".concat(r)),console.error(a),new Error(a)}}function kh(n){if(n){var e="A pre-call quality test is in progress. Please try ".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," again once testing has completed. Use stopTestCallQuality() to end it early.");throw console.error(e),new Error(e)}}function zr(n){if(!n){var e="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," is only supported on custom callObject instances");throw console.error(e),new Error(e)}}function dr(n){if(n){var e="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," is only supported as part of Daily's Prebuilt");throw console.error(e),new Error(e)}}function at(){if(ot())throw new Error("This daily-js method is not currently supported in React Native")}function Pc(){if(!ot())throw new Error("This daily-js method is only supported in React Native")}function gy(n){if(n===void 0)return!0;var e;if(typeof n=="string")e=n;else try{e=JSON.stringify(n),Pn(JSON.parse(e),n)||console.warn("The userData provided will be modified when serialized.")}catch(r){throw Error("userData must be serializable to JSON: ".concat(r))}if(e.length>4096)throw Error("userData is too large (".concat(e.length," characters). Maximum size suppported is ").concat(4096,"."));return!0}function my(n,e){for(var r=e.allowAllParticipantsKey,a=function(O){var j=["local"];return r||j.push("*"),O&&!j.includes(O)},l=function(O){return!!(O.layer===void 0||Number.isInteger(O.layer)&&O.layer>=0||O.layer==="inherit")},f=function(O){return!!O&&!(O.video&&!l(O.video))&&!(O.screenVideo&&!l(O.screenVideo))},h=0,v=Object.entries(n);h<v.length;h++){var y=mn(v[h],2),b=y[0],E=y[1];if(!a(b)||!f(E))return!1}return!0}function vy(n){if(ut(n)!=="object")return!1;for(var e=0,r=Object.entries(n);e<r.length;e++){var a=mn(r[e],2),l=a[0],f=a[1];switch(l){case"video":if(ut(f)!=="object")return!1;for(var h=0,v=Object.entries(f);h<v.length;h++){var y=mn(v[h],2),b=y[0],E=y[1];switch(b){case"processor":if(!xk(E))return!1;break;case"settings":if(!_y(E))return!1;break;default:return!1}}break;case"audio":if(ut(f)!=="object")return!1;for(var O=0,j=Object.entries(f);O<j.length;O++){var I=mn(j[O],2),A=I[0],R=I[1];switch(A){case"processor":if(!Ik(R))return!1;break;case"settings":if(!_y(R))return!1;break;default:return!1}}break;default:return!1}}return!0}function yy(n,e,r){var a,l=[];n.video&&n.video.processor&&(Pv((a=e?.useLegacyVideoProcessor)!==null&&a!==void 0&&a)||(n.video.settings?delete n.video.processor:delete n.video,l.push("video"))),n.audio&&n.audio.processor&&(Iv()||(n.audio.settings?delete n.audio.processor:delete n.audio,l.push("audio"))),l.length>0&&console.error("Ignoring settings for browser- or platform-unsupported input processor(s): ".concat(l.join(", "))),n.audio&&n.audio.settings&&(n.audio.settings.customTrack?(r.audioTrack=n.audio.settings.customTrack,n.audio.settings={customTrack:zi}):delete r.audioTrack),n.video&&n.video.settings&&(n.video.settings.customTrack?(r.videoTrack=n.video.settings.customTrack,n.video.settings={customTrack:zi}):delete r.videoTrack)}function Ik(n){if(ot())return console.warn("Video processing is not yet supported in React Native"),!1;var e=["type"];return!!n&&ut(n)==="object"&&(Object.keys(n).filter((function(r){return!e.includes(r)})).forEach((function(r){console.warn("invalid key inputSettings -> audio -> processor : ".concat(r)),delete n[r]})),!!(function(r){return typeof r!="string"?!1:Object.values(Ov).includes(r)?!0:(console.error("inputSettings audio processor type invalid"),!1)})(n.type))}function xk(n){if(ot())return console.warn("Video processing is not yet supported in React Native"),!1;var e=["type","config"];return!n||ut(n)!=="object"||!(function(r){return typeof r!="string"?!1:Object.values(Cu).includes(r)?!0:(console.error("inputSettings video processor type invalid"),!1)})(n.type)||n.config&&(ut(n.config)!=="object"||!(function(r,a){var l=Object.keys(a);if(l.length===0)return!0;var f="invalid object in inputSettings -> video -> processor -> config";switch(r){case Cu.BGBLUR:return l.length>1||l[0]!=="strength"?(console.error(f),!1):!(typeof a.strength!="number"||a.strength<=0||a.strength>1||isNaN(a.strength))||(console.error("".concat(f,"; expected: {0 < strength <= 1}, got: ").concat(a.strength)),!1);case Cu.BGIMAGE:return!(a.source!==void 0&&!(function(h){if(h.source==="default")return h.type="default",!0;if(h.source instanceof ArrayBuffer)return!0;if(nu(h.source))return h.type="url",!!(function(b){var E=new URL(b),O=E.pathname;if(E.protocol==="data:")try{var j=O.substring(O.indexOf(":")+1,O.indexOf(";")).split("/")[1];return lh.includes(j)}catch(A){return console.error("failed to deduce blob content type",A),!1}var I=O.split(".").at(-1).toLowerCase().trim();return lh.includes(I)})(h.source)||(console.error("invalid image type; supported types: [".concat(lh.join(", "),"]")),!1);return v=h.source,y=Number(v),isNaN(y)||!Number.isInteger(y)||y<=0||y>10?(console.error("invalid image selection; must be an int, > 0, <= ".concat(10)),!1):(h.type="daily-preselect",!0);var v,y})(a));default:return!0}})(n.type,n.config))?!1:(Object.keys(n).filter((function(r){return!e.includes(r)})).forEach((function(r){console.warn("invalid key inputSettings -> video -> processor : ".concat(r)),delete n[r]})),!0)}function _y(n){return ut(n)==="object"&&(!n.customTrack||n.customTrack instanceof MediaStreamTrack)}function Ch(){var n=Object.values(Cu).join(" | "),e=Object.values(Ov).join(" | ");return"inputSettings must be of the form: { video?: { processor?: { type: [ ".concat(n," ], config?: {} } }, audio?: { processor: {type: [ ").concat(e," ] } } }")}function wy(n){var e=n.allowAllParticipantsKey;return"receiveSettings must be of the form { [<remote participant id> | ".concat(sS).concat(e?' | "'.concat("*",'"'):"","]: ")+'{ [video: [{ layer: [<non-negative integer> | "inherit"] } | "inherit"]], [screenVideo: [{ layer: [<non-negative integer> | "inherit"] } | "inherit"]] }}}'}function by(){return"customIntegrations should be an object of type ".concat(JSON.stringify(bh),".")}function Sy(n){if(n&&ut(n)!=="object"||Array.isArray(n))return console.error("customTrayButtons should be an Object of the type ".concat(JSON.stringify(Tu),".")),!1;if(n)for(var e=0,r=Object.entries(n);e<r.length;e++)for(var a=mn(r[e],1)[0],l=0,f=Object.entries(n[a]);l<f.length;l++){var h=mn(f[l],2),v=h[0],y=h[1],b=Tu.id[v];if(!b)return console.error("customTrayButton does not support key ".concat(v)),!1;switch(v){case"iconPath":case"iconPathDarkMode":if(!nu(y))return console.error("customTrayButton ".concat(v," should be a url.")),!1;break;case"visualState":if(!["default","sidebar-open","active"].includes(y))return console.error("customTrayButton ".concat(v," should be ").concat(b,". Got: ").concat(y)),!1;break;default:if(ut(y)!==b)return console.error("customTrayButton ".concat(v," should be a ").concat(b,".")),!1}}return!0}function ky(n){if(!n||n&&ut(n)!=="object"||Array.isArray(n))return console.error(by()),!1;for(var e=function(O){return"".concat(O," should be ").concat(bh.id[O])},r=function(O,j){return console.error("customIntegration ".concat(O,": ").concat(j))},a=0,l=Object.entries(n);a<l.length;a++){var f=mn(l[a],1)[0];if(!("label"in n[f]))return r(f,"label is required"),!1;if(!("location"in n[f]))return r(f,"location is required"),!1;if(!("src"in n[f])&&!("srcdoc"in n[f]))return r(f,"src or srcdoc is required"),!1;for(var h=0,v=Object.entries(n[f]);h<v.length;h++){var y=mn(v[h],2),b=y[0],E=y[1];switch(b){case"allow":case"csp":case"name":case"referrerPolicy":case"sandbox":if(typeof E!="string")return r(f,e(b)),!1;break;case"iconURL":if(!nu(E))return r(f,"".concat(b," should be a url")),!1;break;case"src":if("srcdoc"in n[f])return r(f,"cannot have both src and srcdoc"),!1;if(!nu(E))return r(f,'src "'.concat(E,'" is not a valid URL')),!1;break;case"srcdoc":if("src"in n[f])return r(f,"cannot have both src and srcdoc"),!1;if(typeof E!="string")return r(f,e(b)),!1;break;case"location":if(!["main","sidebar"].includes(E))return r(f,e(b)),!1;break;case"controlledBy":if(E!=="*"&&E!=="owners"&&(!Array.isArray(E)||E.some((function(O){return typeof O!="string"}))))return r(f,e(b)),!1;break;case"shared":if((!Array.isArray(E)||E.some((function(O){return typeof O!="string"})))&&E!=="owners"&&typeof E!="boolean")return r(f,e(b)),!1;break;default:if(!bh.id[b])return console.error("customIntegration does not support key ".concat(b)),!1}}}return!0}function Cy(n,e){if(e===void 0)return!1;switch(ut(e)){case"string":return ut(n)===e;case"object":if(ut(n)!=="object")return!1;for(var r in n)if(!Cy(n[r],e[r]))return!1;return!0;default:return!1}}function Ey(n,e){var r=n.sessionId,a=n.toEndPoint,l=n.callerId,f=n.useSipRefer;if(!r||!a)throw new Error("".concat(e,"() requires a sessionId and toEndPoint"));if(typeof r!="string"||typeof a!="string")throw new Error("Invalid paramater: sessionId and toEndPoint must be of type string");if(f&&!a.startsWith("sip:"))throw new Error('"toEndPoint" must be a "sip" address');if(!a.startsWith("sip:")&&!a.startsWith("+"))throw new Error("toEndPoint: ".concat(a,' must starts with either "sip:" or "+"'));if(l&&typeof l!="string")throw new Error("callerId must be of type string");if(l&&!a.startsWith("+"))throw new Error("callerId is only valid when transferring to a PSTN number")}function My(n){if(ut(n)!=="object")throw new Error('RemoteMediaPlayerSettings: must be "object" type');if(n.state&&!Object.values(ch).includes(n.state))throw new Error("Invalid value for RemoteMediaPlayerSettings.state, valid values are: "+JSON.stringify(ch));if(n.volume){if(typeof n.volume!="number")throw new Error('RemoteMediaPlayerSettings.volume: must be "number" type');if(n.volume<0||n.volume>2)throw new Error("RemoteMediaPlayerSettings.volume: must be between 0.0 - 2.0")}}function Oy(n,e,r){return!(typeof n!="number"||n<e||n>r)}function Eh(n,e){return n&&!e&&delete n.data,n}function fr(n){"@babel/helpers - typeof";return fr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},fr(n)}var tt=function(){return tt=Object.assign||function(r){for(var a,l=1,f=arguments.length;l<f;l++){a=arguments[l];for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(r[h]=a[h])}return r},tt.apply(this,arguments)};function Mh(n,e){var r={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(r[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(r[a[l]]=n[a[l]]);return r}function Ca(n,e,r,a){function l(f){return f instanceof r?f:new r(function(h){h(f)})}return new(r||(r=Promise))(function(f,h){function v(E){try{b(a.next(E))}catch(O){h(O)}}function y(E){try{b(a.throw(E))}catch(O){h(O)}}function b(E){E.done?f(E.value):l(E.value).then(v,y)}b((a=a.apply(n,[])).next())})}function Ea(n,e){var r={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},a,l,f,h;return h={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function v(b){return function(E){return y([b,E])}}function y(b){if(a)throw new TypeError("Generator is already executing.");for(;h&&(h=0,b[0]&&(r=0)),r;)try{if(a=1,l&&(f=b[0]&2?l.return:b[0]?l.throw||((f=l.return)&&f.call(l),0):l.next)&&!(f=f.call(l,b[1])).done)return f;switch(l=0,f&&(b=[b[0]&2,f.value]),b[0]){case 0:case 1:f=b;break;case 4:return r.label++,{value:b[1],done:!1};case 5:r.label++,l=b[1],b=[0];continue;case 7:b=r.ops.pop(),r.trys.pop();continue;default:if(f=r.trys,!(f=f.length>0&&f[f.length-1])&&(b[0]===6||b[0]===2)){r=0;continue}if(b[0]===3&&(!f||b[1]>f[0]&&b[1]<f[3])){r.label=b[1];break}if(b[0]===6&&r.label<f[1]){r.label=f[1],f=b;break}if(f&&r.label<f[2]){r.label=f[2],r.ops.push(b);break}f[2]&&r.ops.pop(),r.trys.pop();continue}b=e.call(n,r)}catch(E){b=[6,E],l=0}finally{a=f=0}if(b[0]&5)throw b[1];return{value:b[0]?b[1]:void 0,done:!0}}}function Ty(n){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&n[e],a=0;if(r)return r.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&a>=n.length&&(n=void 0),{value:n&&n[a++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function wt(n,e){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var a=r.call(n),l,f=[],h;try{for(;(e===void 0||e-- >0)&&!(l=a.next()).done;)f.push(l.value)}catch(v){h={error:v}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(h)throw h.error}}return f}function yn(n,e,r){if(arguments.length===2)for(var a=0,l=e.length,f;a<l;a++)(f||!(a in e))&&(f||(f=Array.prototype.slice.call(e,0,a)),f[a]=e[a]);return n.concat(f||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var Ry=z.createContext(null),$i=function(){var e=z.useContext(Ry);return z.useDebugValue(e),e},Oh=z.createContext({on:function(){},off:function(){}}),Lk=-1,Th=function(){return Lk--},jk=1,Rh=function(){return jk++},Qe=function(e,r,a){a===void 0&&(a=!1);var l=z.useContext(Oh),f=l.off,h=l.on,v=wt(z.useState(!1),2),y=v[0],b=v[1],E=z.useRef(0),O=z.useMemo(function(){return a?Th():Rh()},[a]);z.useEffect(function(){if(!(!e||y)){if(E.current>1e5){console.error(`useDailyEvent called with potentially non-memoized event callback or due to too many re-renders.
        Memoize using useCallback to avoid re-render loop or reduce the amount of state transitions the callback depends on.
        Passed callback for '`.concat(e,"' event is NOT registered."),r),b(!0);return}E.current++;var j=setTimeout(function(){E.current=0},50);return h(e,r,O),function(){clearTimeout(j),f(e,O)}}},[r,e,O,y,f,h]),z.useDebugValue({event:e,eventId:O,isBlocked:y,callback:r})};function $r(n,e){var r,a;if(n===e)return!0;if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;for(var l=0;l<n.length;l++)if(!$r(n[l],e[l]))return!1;return!0}if(MediaStream&&n instanceof MediaStream&&e instanceof MediaStream)return n.id===e.id&&n.active===e.active&&n.getTracks().length===e.getTracks().length&&n.getTracks().every(function(A,R){return $r(A,e.getTracks()[R])});if(MediaStreamTrack&&n instanceof MediaStreamTrack&&e instanceof MediaStreamTrack)return n.id===e.id&&n.kind===e.kind&&n.readyState===e.readyState;if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(n instanceof RegExp&&e instanceof RegExp)return n.source===e.source&&n.flags===e.flags;if(n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;var f=Array.from(n).sort(),h=Array.from(e).sort();return f.every(function(A,R){return $r(A,h[R])})}if(n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;try{for(var v=Ty(n.entries()),y=v.next();!y.done;y=v.next()){var b=wt(y.value,2),E=b[0],O=b[1];if(!e.has(E)||!$r(O,e.get(E)))return!1}}catch(A){r={error:A}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(r)throw r.error}}return!0}if(fr(n)!=="object"||n===null||fr(e)!=="object"||e===null)return!1;var j=Object.keys(n),I=Object.keys(e);if(j.length!==I.length)return!1;for(var l=0;l<j.length;l++){var E=j[l];if(!Object.prototype.hasOwnProperty.call(e,E)||!$r(n[E],e[E]))return!1}return!0}function Ah(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(var r=0;r<n.length;r++){var a=n[r],l=e[r],f=a!==null&&fr(a)==="object",h=l!==null&&fr(l)==="object";if(f||h){if(!$r(a,l))return!1}else if(a!==l)return!1}return!0}function gt(n){return"daily-react-"+n}function Ph(n){var e=new Map,r=new Map;return function(a){if(!e.has(a)){var l=st(function(f){var h=n.get(a)(f),v=r.get(a);return v!=null&&n.equals(h,v)?v:(r.set(a,h),h)});e.set(a,l)}return e.get(a)}}var Ih="::",Ay=";",xh=function(e,r){return e+Ih+r},Nk=function(e,r){return e+Ih+r.join(Ay)},_n=function(e,r){return Lh(xh(e,r))},Ma=wc(function(n){var e=st([]);return e.debugLabel=gt("participant-property-paths-".concat(n)),e}),Lh=wc(function(n){var e=st(null);return e.debugLabel=gt("participant-property-".concat(n)),e}),Dk=Ph({equals:Ah,get:function(e){return function(r){var a=wt(e.split(Ih),2),l=a[0],f=a[1],h=f.split(Ay);return h.map(function(v){return r(_n(l,v))})}}}),Py=function(e,r){var a,l=lo(Array.isArray(r)?Dk(Nk(e,r)):Lh(xh(e,r)));return z.useDebugValue(Array.isArray(r)?r.reduce(function(f,h,v){return f[h]=l[v],f},{}):(a={},a[r]=l,a)),l},xu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Uk(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var jh,Iy;function Bk(){if(Iy)return jh;Iy=1;var n="Expected a function",e=NaN,r="[object Symbol]",a=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,h=/^0o[0-7]+$/i,v=parseInt,y=fr(xu)=="object"&&xu&&xu.Object===Object&&xu,b=(typeof self>"u"?"undefined":fr(self))=="object"&&self&&self.Object===Object&&self,E=y||b||Function("return this")(),O=Object.prototype,j=O.toString,I=Math.max,A=Math.min,R=function(){return E.Date.now()};function D(H,ae,ye){var Ee,Ve,k,ze,Me,K,Ue=0,it=!1,be=!1,he=!0;if(typeof H!="function")throw new TypeError(n);ae=q(ae)||0,Y(ye)&&(it=!!ye.leading,be="maxWait"in ye,k=be?I(q(ye.maxWait)||0,ae):k,he="trailing"in ye?!!ye.trailing:he);function Ce(G){var ie=Ee,fe=Ve;return Ee=Ve=void 0,Ue=G,ze=H.apply(fe,ie),ze}function oe(G){return Ue=G,Me=setTimeout(g,ae),it?Ce(G):ze}function J(G){var ie=G-K,fe=G-Ue,Oe=ae-ie;return be?A(Oe,k-fe):Oe}function le(G){var ie=G-K,fe=G-Ue;return K===void 0||ie>=ae||ie<0||be&&fe>=k}function g(){var G=R();if(le(G))return M(G);Me=setTimeout(g,J(G))}function M(G){return Me=void 0,he&&Ee?Ce(G):(Ee=Ve=void 0,ze)}function C(){Me!==void 0&&clearTimeout(Me),Ue=0,Ee=K=Ve=Me=void 0}function N(){return Me===void 0?ze:M(R())}function F(){var G=R(),ie=le(G);if(Ee=arguments,Ve=this,K=G,ie){if(Me===void 0)return oe(K);if(be)return Me=setTimeout(g,ae),Ce(K)}return Me===void 0&&(Me=setTimeout(g,ae)),ze}return F.cancel=C,F.flush=N,F}function V(H,ae,ye){var Ee=!0,Ve=!0;if(typeof H!="function")throw new TypeError(n);return Y(ye)&&(Ee="leading"in ye?!!ye.leading:Ee,Ve="trailing"in ye?!!ye.trailing:Ve),D(H,ae,{leading:Ee,maxWait:ae,trailing:Ve})}function Y(H){var ae=fr(H);return!!H&&(ae=="object"||ae=="function")}function ne(H){return!!H&&fr(H)=="object"}function L(H){return fr(H)=="symbol"||ne(H)&&j.call(H)==r}function q(H){if(typeof H=="number")return H;if(L(H))return e;if(Y(H)){var ae=typeof H.valueOf=="function"?H.valueOf():H;H=Y(ae)?ae+"":ae}if(typeof H!="string")return H===0?H:+H;H=H.replace(a,"");var ye=f.test(H);return ye||h.test(H)?v(H.slice(2),ye?2:8):l.test(H)?e:+H}return jh=V,jh}var Fk=Bk(),Vk=Uk(Fk),Lu=function(e,r,a,l){a===void 0&&(a=500),l===void 0&&(l=!1);var f=z.useContext(Oh),h=f.off,v=f.on,y=z.useMemo(function(){var O;return Array.isArray(e)?e.reduce(function(j,I){return j[I]=l?Th():Rh(),j},{}):(O={},O[e]=l?Th():Rh(),O)},[e,l]),b=z.useRef([]);Qe("call-instance-destroyed",z.useCallback(function(){b.current.length=0},[]));var E=z.useMemo(function(){return Vk(function(){b.current.length!==0&&(r(b.current),b.current.length=0)},a,{trailing:!0})},[r,a]);z.useEffect(function(){if(e){var O=function(I){b.current.push(I),E()};return Array.isArray(e)?e.forEach(function(j){return v(j,O,y[j])}):v(e,O,y[e]),function(){Array.isArray(e)?e.forEach(function(j){return h(j,y[j])}):h(e,y[e])}}},[E,e,y,h,v]),z.useDebugValue({event:e,eventId:y})},xy=function(e,r,a){if(r===void 0&&(r=""),a===void 0&&(a=new Set),fr(e)!=="object"||e===null||a.has(e))return[r];a.add(e);var l=[];for(var f in e)if(Object.prototype.hasOwnProperty.call(e,f)){var h=r?"".concat(r,".").concat(f):f;l.push.apply(l,yn([h],wt(xy(e[f],h,a)),!1))}return a.delete(e),l},Nh=function(e){return xy(e)},zk=function(e,r){return String(r).split(".").filter(function(a){return a.length}).reduce(function(a,l){return a&&a[l]},e)},Dh=function(e,r){return r.map(function(a){return zk(e,a)})},ju=st(null);ju.debugLabel=gt("active-id");var Ic=st("");Ic.debugLabel=gt("local-id");var Ly=st(null);Ly.debugLabel=gt("local-join-date");var Mo=st([]);Mo.debugLabel=gt("participant-ids");var Oo=wc(function(n){var e=st(null);return e.debugLabel=gt("participant-".concat(n)),e}),Uh=st([]);Uh.debugLabel=gt("waiting-participants");var Bh=wc(function(n){var e=st({awaitingAccess:{level:"full"},id:n,name:""});return e.debugLabel=gt("waiting-participant-".concat(n)),e}),$k=function(e){var r=e.children,a=$i(),l=wt(z.useState(!1),2),f=l[0],h=l[1],v=rt(z.useCallback(function(E,O,j){O(Ic,j.local.session_id);var I=Object.values(j),A=I.map(function(R){return R.session_id});O(Mo,A),I.forEach(function(R){O(Oo(R.session_id),R);var D=Nh(R);O(Ma(R.session_id),D),D.forEach(function(V){var Y=wt(Dh(R,[V]),1),ne=Y[0];O(_n(R.session_id,V),ne)})}),h(!0)},[]));z.useEffect(function(){if(!(!a||f)){var E=setInterval(function(){var O=a.participants();"local"in O&&(v(O),clearInterval(E))},100);return function(){clearInterval(E)}}},[a,f,v]);var y=z.useCallback(function(){if(a){var E=a?.participants();E.local&&v(E)}},[a,v]);Qe("started-camera",y,!0),Qe("access-state-updated",y,!0),Qe("joining-meeting",rt(z.useCallback(function(E,O){O(Ly,new Date),y()},[y])),!0),Qe("joined-meeting",z.useCallback(function(E){v(E.participants)},[v]),!0);var b=rt(z.useCallback(function(E,O){O(Ic,""),O(ju,null);var j=E(Mo);j.forEach(function(I){return Oo.remove(I)}),O(Mo,[])},[]));return Qe("call-instance-destroyed",b,!0),Qe("left-meeting",b,!0),Lu(["active-speaker-change","participant-joined","participant-updated","participant-left"],rt(z.useCallback(function(E,O,j){j.length&&j.forEach(function(I){switch(I.action){case"active-speaker-change":{O(ju,I.activeSpeaker.peerId),O(Oo(I.activeSpeaker.peerId),function(L){return L?tt(tt({},L),{last_active:new Date}):null});break}case"participant-joined":{O(Mo,function(L){return L.includes(I.participant.session_id)?L:yn(yn([],wt(L),!1),[I.participant.session_id],!1)}),O(Oo(I.participant.session_id),I.participant);var A=Nh(I.participant);O(Ma(I.participant.session_id),A),A.forEach(function(L){var q=wt(Dh(I.participant,[L]),1),H=q[0];O(_n(I.participant.session_id,L),H)});break}case"participant-updated":{O(Oo(I.participant.session_id),I.participant),I.participant.local&&O(Ic,I.participant.session_id);var A=Nh(I.participant),R=E(Ma(I.participant.session_id)),D=A.length!==R.length||A.some(function(q){return!R.includes(q)});D&&O(Ma(I.participant.session_id),A);var V=new Set(R),Y=Dh(I.participant,A);A.forEach(function(q,H){var ae=Y[H];V.delete(q),O(_n(I.participant.session_id,q),function(ye){return $r(ye,ae)?ye:ae})}),V.forEach(function(q){O(_n(I.participant.session_id,q),null)});break}case"participant-left":{O(Mo,function(L){return L.includes(I.participant.session_id)?L.filter(function(q){return q!==I.participant.session_id}):L}),Oo.remove(I.participant.session_id);var ne=E(Ma(I.participant.session_id));ne.forEach(function(L){Lh.remove(xh(I.participant.session_id,L))}),Ma.remove(I.participant.session_id);break}}})},[])),100,!0),Lu(["waiting-participant-added","waiting-participant-updated","waiting-participant-removed"],rt(z.useCallback(function(E,O,j){j.forEach(function(I){switch(I.action){case"waiting-participant-added":O(Uh,function(A){return A.includes(I.participant.id)?A:yn(yn([],wt(A),!1),[I.participant.id],!1)}),O(Bh(I.participant.id),I.participant);break;case"waiting-participant-updated":O(Bh(I.participant.id),I.participant);break;case"waiting-participant-removed":O(Uh,function(A){return A.filter(function(R){return R!==I.participant.id})}),Bh.remove(I.participant.id);break}})},[])),100,!0),et.createElement(et.Fragment,null,r)},Nu=function(){var e=lo(Ic);return z.useDebugValue(e),e},qk=function(){return!0},Wk=function(e){var r=e===void 0?{}:e,a=r.filter,l=a===void 0?qk:a,f=r.ignoreLocal,h=f===void 0?!1:f,v=Nu(),y=lo(ju),b=h&&y===v,E=!l?.(y),O=!b&&!E,j=wt(z.useState(O?y:null),2),I=j[0],A=j[1];return z.useEffect(function(){b||E||A(y)},[E,b,y]),z.useDebugValue(I),I},Du=function(e){return["blocked","off"].includes(e)},jy=";",Ny=function(e,r){return"".concat(e).concat(jy).concat(r)},Dy=Ph({equals:$r,get:function(e){return function(r){var a=wt(e.split(jy),2),l=a[0],f=a[1],h=r(Mo);return h.filter(function(v){switch(l){case"local":case"owner":case"record":return r(_n(v,l));case"remote":return!r(_n(v,"local"));case"screen":{var y=r(_n(v,"tracks.screenAudio.state")),b=r(_n(v,"tracks.screenVideo.state"));return!Du(y)||!Du(b)}default:return!0}}).sort(function(v,y){switch(f){case"joined_at":case"session_id":case"user_id":case"user_name":{var b=r(_n(v,f)),E=r(_n(y,f));if(b!==void 0||E!==void 0){if(b===void 0)return-1;if(E===void 0||b>E)return 1;if(b<E)return-1}return 0}default:return 0}})}}}),Uy=function(e){var r=e===void 0?{}:e,a=r.filter,l=r.onActiveSpeakerChange,f=r.onParticipantJoined,h=r.onParticipantLeft,v=r.onParticipantUpdated,y=r.sort,b=lo(Dy(Ny(typeof a=="string"?a:null,typeof y=="string"?y:null))),E=typeof a=="function"||typeof y=="function",O=z.useCallback(function(V){if(typeof a!="function"&&typeof y!="function")return[];var Y=b.map(function(ne){return V(Oo(ne))});return Y.filter(function(ne){return!!ne}).filter(typeof a=="function"?a:function(){return!0}).sort(typeof y=="function"?y:function(){return 0}).map(function(ne){return ne.session_id}).filter(Boolean)},[a,b,y]),j=wt(z.useState([]),2),I=j[0],A=j[1],R=rt(z.useCallback(function(V){if(E){var Y=O(V);$r(Y,I)||A(Y)}},[I,O,E]));z.useEffect(function(){R()},[R]),Lu(["participant-joined","participant-updated","active-speaker-change","participant-left"],z.useCallback(function(V){V.length&&(V.forEach(function(Y){switch(Y.action){case"participant-joined":f?.(Y);break;case"participant-updated":v?.(Y);break;case"active-speaker-change":l?.(Y);break;case"participant-left":h?.(Y);break}}),R())},[R,l,f,h,v]));var D=typeof a=="function"||typeof y=="function"?I:b;return z.useDebugValue(D),D},Hk=Ph({equals:Ah,get:function(){return function(e){var r=e(Dy(Ny("screen",null)));return r.map(function(a){return{local:e(_n(a,"local")),screenAudio:e(_n(a,"tracks.screenAudio")),screenVideo:e(_n(a,"tracks.screenVideo")),screenId:"".concat(a,"-screen"),session_id:a}})}}}),Gk=function(e){var r={},a=r.onError,l=r.onLocalScreenShareStarted,f=r.onLocalScreenShareStopped,h=$i(),v=z.useCallback(function(){for(var O=[],j=0;j<arguments.length;j++)O[j]=arguments[j];h?.startScreenShare.apply(h,yn([],wt(O),!1))},[h]),y=z.useCallback(function(){for(var O=[],j=0;j<arguments.length;j++)O[j]=arguments[j];h?.stopScreenShare.apply(h,yn([],wt(O),!1))},[h]);Qe("local-screen-share-started",z.useCallback(function(){return l?.()},[l])),Qe("local-screen-share-stopped",z.useCallback(function(){return f?.()},[f])),Qe("nonfatal-error",z.useCallback(function(O){O.type==="screen-share-error"&&a?.(O)},[a]));var b=lo(Hk(void 0)),E={isSharingScreen:b.some(function(O){return O.local}),screens:b,startScreenShare:v,stopScreenShare:y};return z.useDebugValue(E),E},By=function(e,r){r===void 0&&(r="video");var a=Py(e,"tracks.".concat(r)),l=a?tt(tt({},a),{isOff:Du(a.state)}):{isOff:!0,persistentTrack:void 0,state:"off",subscribed:!1};return z.useDebugValue(l),l};function Fy(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return z.useCallback(function(r){for(var a=0;a<n.length;a++){var l=n[a];typeof l=="function"?l(r):l&&fr(l)==="object"&&(l.current=r)}},n)}var Uu=z.memo(z.forwardRef(function(n,e){var r=n.onPlayFailed,a=n.sessionId,l=n.type,f=l===void 0?"audio":l,h=Mh(n,["onPlayFailed","sessionId","type"]),v=z.useRef(null),y=By(a,f),b=Fy(v,e),E=y?.subscribed;return z.useEffect(function(){var O=v.current;if(!(!O||!y?.persistentTrack)){var j=function(){O.play().catch(function(A){r?.({sessionId:a,target:O,type:f,message:A.message,name:A.name})})};if(!MediaStream){console.warn("MediaStream API not available. Can't setup ".concat(f," for ").concat(a)),r?.({sessionId:a,target:O,type:f,message:"MediaStream API not available",name:"MediaStream API not available"});return}return O.addEventListener("canplay",j),O.srcObject=new MediaStream([y?.persistentTrack]),function(){O?.removeEventListener("canplay",j)}}},[y?.persistentTrack,r,a,f]),Qe("participant-left",z.useCallback(function(O){var j=v.current;O.participant.session_id!==a||!j||(j.srcObject=null)},[a])),et.createElement("audio",tt({autoPlay:!0,ref:b},h,{"data-session-id":a,"data-audio-type":f,"data-subscribed":E}))}));Uu.displayName="DailyAudioTrack";var Jk=z.memo(z.forwardRef(function(n,e){var r=n.autoSubscribeActiveSpeaker,a=r===void 0?!1:r,l=n.maxSpeakers,f=l===void 0?5:l,h=n.onPlayFailed,v=n.playLocalScreenAudio,y=v===void 0?!1:v,b=$i(),E=wt(z.useState(new Array(f).fill("")),2),O=E[0],j=E[1],I=Gk().screens,A=Nu(),R=Wk({ignoreLocal:!0}),D=z.useRef(null);z.useImperativeHandle(e,function(){return{getActiveSpeakerAudio:function(){var q,H;return(H=(q=D.current)===null||q===void 0?void 0:q.querySelector('audio[data-session-id="'.concat(R,'"][data-audio-type="audio"]')))!==null&&H!==void 0?H:null},getAllAudio:function(){var q,H;return Array.from((H=(q=D.current)===null||q===void 0?void 0:q.querySelectorAll("audio"))!==null&&H!==void 0?H:[])},getAudioBySessionId:function(q){var H,ae;return(ae=(H=D.current)===null||H===void 0?void 0:H.querySelector('audio[data-session-id="'.concat(q,'"][data-audio-type="audio"]')))!==null&&ae!==void 0?ae:null},getRmpAudio:function(){var q,H;return Array.from((H=(q=D.current)===null||q===void 0?void 0:q.querySelectorAll('audio[data-audio-type="rmpAudio"]'))!==null&&H!==void 0?H:[])},getScreenAudio:function(){var q,H;return Array.from((H=(q=D.current)===null||q===void 0?void 0:q.querySelectorAll('audio[data-audio-type="screenAudio"]'))!==null&&H!==void 0?H:[])},getRmpAudioBySessionId:function(q){var H,ae;return(ae=(H=D.current)===null||H===void 0?void 0:H.querySelector('audio[data-session-id="'.concat(q,'"][data-audio-type="rmpAudio"]')))!==null&&ae!==void 0?ae:null},getScreenAudioBySessionId:function(q){var H,ae;return(ae=(H=D.current)===null||H===void 0?void 0:H.querySelector('audio[data-session-id="'.concat(q,'"][data-audio-type="screenAudio"]')))!==null&&ae!==void 0?ae:null}}},[R]);var V=rt(z.useCallback(function(L,q,H){return Ca(void 0,void 0,void 0,function(){var ae,ye,Ee;return Ea(this,function(Ve){if(ae=Object.values((Ee=b?.participants())!==null&&Ee!==void 0?Ee:{}).filter(function(k){return!k.local&&!!k.tracks.audio.subscribed}),ye=function(ze){return ae.some(function(Me){return Me.session_id===ze})},!ye(H))if(b&&!b.isDestroyed()&&a&&!b.subscribeToTracksAutomatically())b.updateParticipant(H,{setSubscribedTracks:{audio:!0}});else return[2];return j(function(k){var ze;if(k.includes(H))return k;var Me=function(oe){return!oe||!ye(oe)};if(k.some(Me)){var K=k.findIndex(Me);return k[K]=H,yn([],wt(k),!1)}var Ue=k.findIndex(function(Ce){return ae.some(function(oe){return oe.session_id===Ce&&Du(oe.tracks.audio.state)})});if(Ue>=0)return k[Ue]=H,yn([],wt(k),!1);var it=ae.filter(function(Ce){return k.includes(Ce.session_id)&&Ce.session_id!==R}).sort(function(Ce,oe){var J,le,g=(J=L(_n(Ce.session_id,"last_active")))!==null&&J!==void 0?J:new Date("1970-01-01"),M=(le=L(_n(oe.session_id,"last_active")))!==null&&le!==void 0?le:new Date("1970-01-01");return g>M?1:g<M?-1:0});if(!it.length){var be=k.findIndex(function(Ce){return Ce!==R});return k[be]=H,yn([],wt(k),!1)}var he=k.indexOf((ze=it[0])===null||ze===void 0?void 0:ze.session_id);return k[he]=H,yn([],wt(k),!1)}),[2]})})},[R,a,b])),Y=z.useCallback(function(L){j(function(q){if(!q.includes(L))return q;var H=yn([],wt(q),!1),ae=H.indexOf(L);return H[ae]="",H})},[]);Lu(["active-speaker-change","track-started","participant-left"],z.useCallback(function(L){L.forEach(function(q){switch(q.action){case"active-speaker-change":if(q.activeSpeaker.peerId===A)return;V(q.activeSpeaker.peerId);break;case"track-started":q.track.kind==="audio"&&q.participant&&!q.participant.local&&V(q.participant.session_id);break;case"participant-left":Y(q.participant.session_id);break}})},[V,A,Y]),200);var ne=Uy({filter:z.useCallback(function(L){var q;return!!(!((q=L?.tracks)===null||q===void 0)&&q.rmpAudio)},[])});return et.createElement("div",{ref:D},O.map(function(L,q){return et.createElement(Uu,{key:"speaker-slot-".concat(q),onPlayFailed:h,sessionId:L,type:"audio"})}),I.filter(function(L){return y?!0:!L.local}).map(function(L){return et.createElement(Uu,{key:L.screenId,onPlayFailed:h,sessionId:L.session_id,type:"screenAudio"})}),ne.map(function(L){return et.createElement(Uu,{key:"".concat(L,"-rmp"),onPlayFailed:h,sessionId:L,type:"rmpAudio"})}))}));Jk.displayName="DailyAudio";var Qk=z.forwardRef(function(e,r){var a=e.automirror,l=e.fit,f=l===void 0?"contain":l,h=e.mirror,v=e.onResize,y=e.playableStyle,b=y===void 0?{}:y,E=e.sessionId,O=e.style,j=O===void 0?{}:O,I=e.type,A=I===void 0?"video":I,R=Mh(e,["automirror","fit","mirror","onResize","playableStyle","sessionId","style","type"]),D=Nu(),V=D===E,Y=A==="screenVideo",ne=V&&!Y,L=z.useRef(null),q=Fy(L,r),H=By(E,A),ae=H.persistentTrack,ye=ne||Y||!H.isOff,Ee=Py(E,"tracks.".concat(A)),Ve=Ee?.subscribed,k=z.useMemo(function(){if(typeof h=="boolean")return h;if(!a)return!1;if(!ae)return ne;var ze=ae.getSettings(),Me="facingMode"in ze?ne&&ze.facingMode==="user":ne;return Me},[a,ne,h,ae]);return z.useEffect(function(){var Me=L.current;if(Me){var K=function(){var oe=Me.play();oe!==void 0&&oe.then(function(){Me.controls=!1}).catch(function(J){Me.controls=!0,console.warn("Failed to play video",J)})},Ue=function(){Me.paused&&K()},it=function(){Me.style.transform="scale(1)"},be=function(){Me.style.transform="",setTimeout(function(){Me.paused&&K()},100)},he=function(){document.visibilityState!=="hidden"&&Me.paused&&K()};return Me.addEventListener("canplay",Ue),Me.addEventListener("enterpictureinpicture",it),Me.addEventListener("leavepictureinpicture",be),document.addEventListener("visibilitychange",he),function(){Me.removeEventListener("canplay",Ue),Me.removeEventListener("enterpictureinpicture",it),Me.removeEventListener("leavepictureinpicture",be),document.removeEventListener("visibilitychange",he)}}},[]),z.useEffect(function(){var Me=L.current;if(!(!Me||!ae)){if(!MediaStream){console.warn("MediaStream API not available. Can't setup ".concat(A," for ").concat(E));return}return Me.srcObject=new MediaStream([ae]),Me.load(),function(){Me.srcObject=null,Me.load()}}},[E,A,ae,ae?.id]),z.useEffect(function(){var Me=L.current;if(!v||!Me)return;var K;function Ue(){K&&cancelAnimationFrame(K),K=requestAnimationFrame(function(){var it=L.current;if(!(!it||document.hidden)){var be=it.videoWidth,he=it.videoHeight;be&&he&&v?.({aspectRatio:be/he,height:he,width:be})}})}return Ue(),Me.addEventListener("loadedmetadata",Ue),Me.addEventListener("resize",Ue),function(){K&&cancelAnimationFrame(K),Me.removeEventListener("loadedmetadata",Ue),Me.removeEventListener("resize",Ue)}},[v]),et.createElement("video",tt({autoPlay:!0,muted:!0,playsInline:!0,ref:q,"data-local":V,"data-mirrored":k||void 0,"data-playable":ye||void 0,"data-session-id":E,"data-subscribed":Ve,"data-video-type":A,style:tt(tt({objectFit:f,transform:k?"scale(-1, 1)":""},j),ye?b:{})},R))});Qk.displayName="DailyVideo";var Kk=z.createContext({refreshDevices:function(){return Promise.resolve()}}),Ht=st("idle");Ht.debugLabel=gt("camera-state");var Gt=st("idle");Gt.debugLabel=gt("microphone-state");var Bu=st([]);Bu.debugLabel=gt("camera-devices");var Fu=st([]);Fu.debugLabel=gt("microphone-devices");var Vy=st([]);Vy.debugLabel=gt("speaker-devices");var zy=st(null);zy.debugLabel=gt("last-camera-error");var Yk=function(e){var r=e.children,a=$i(),l=rt(z.useCallback(function(h,v){return Ca(void 0,void 0,void 0,function(){var y,b,E,O,j,I,A,R,D,V,Y,ne;return Ea(this,function(L){switch(L.label){case 0:if(typeof((Y=navigator?.mediaDevices)===null||Y===void 0?void 0:Y.getUserMedia)>"u"||typeof((ne=navigator?.mediaDevices)===null||ne===void 0?void 0:ne.enumerateDevices)>"u")return v(Ht,"not-supported"),v(Gt,"not-supported"),[2];if(!a)return[2];L.label=1;case 1:return L.trys.push([1,4,,5]),[4,a.enumerateDevices()];case 2:return y=L.sent().devices,b=y.filter(function(q){return q.kind==="videoinput"&&q.deviceId!==""}),E=y.filter(function(q){return q.kind==="audioinput"&&q.deviceId!==""}),O=y.filter(function(q){return q.kind==="audiooutput"&&q.deviceId!==""}),[4,a.getInputDevices()];case 3:return j=L.sent(),I=j.camera,A=j.mic,R=j.speaker,D=function(H,ae,ye){var Ee,Ve;return{device:ae,selected:"deviceId"in H&&ae.deviceId===H.deviceId,state:(Ve=(Ee=ye.find(function(k){return k.device.deviceId===ae.deviceId}))===null||Ee===void 0?void 0:Ee.state)!==null&&Ve!==void 0?Ve:"granted"}},V=function(H,ae){return H.device.deviceId==="default"?-1:ae.device.deviceId==="default"?1:H.device.label<ae.device.label?-1:H.device.label>ae.device.label?1:0},v(Bu,function(q){return b.filter(Boolean).map(function(H){return D(I,H,q)}).sort(V)}),v(Fu,function(q){return E.filter(Boolean).map(function(H){return D(A,H,q)}).sort(V)}),v(Vy,function(q){return O.filter(Boolean).map(function(H){return D(R,H,q)}).sort(V)}),[3,5];case 4:return L.sent(),v(Ht,"not-supported"),v(Gt,"not-supported"),[3,5];case 5:return[2]}})})},[a])),f=rt(z.useCallback(function(h,v){return Ca(void 0,void 0,void 0,function(){var y,b,E,O,j,I,A,R,D,V,Y,ne,L,q,H,ae,ye,Ee,Ve,k,ze,Me,K,Ue,it,be;return Ea(this,function(he){switch(he.label){case 0:if(!a)return[2];if(y=h(Ht),b=h(Gt),E=a.participants(),!E.local)return[2];if(O=E.local.tracks,j="prompt",I="prompt",!navigator.permissions)return[3,5];he.label=1;case 1:return he.trys.push([1,4,,5]),[4,navigator.permissions.query({name:"camera"})];case 2:return A=he.sent(),j=A.state,[4,navigator.permissions.query({name:"microphone"})];case 3:return R=he.sent(),I=R.state,[3,5];case 4:return he.sent(),[3,5];case 5:return D=j==="prompt"&&["idle","pending"].includes(y)&&O.video.state==="interrupted"&&!O.video.persistentTrack,V=["idle","pending"].includes(y)&&!O.video.persistentTrack&&!!(!((L=O.video.off)===null||L===void 0)&&L.byUser),Y=I==="prompt"&&["idle","pending"].includes(b)&&O.audio.state==="interrupted"&&!O.audio.persistentTrack,ne=["idle","pending"].includes(b)&&!O.audio.persistentTrack&&!!(!((q=O.audio.off)===null||q===void 0)&&q.byUser),!((ae=(H=O.audio)===null||H===void 0?void 0:H.blocked)===null||ae===void 0)&&ae.byDeviceInUse?(v(Gt,"in-use"),v(Fu,function(Ce){return Ce.map(function(oe){return oe.selected?tt(tt({},oe),{state:"in-use"}):oe})})):!((Ee=(ye=O.audio)===null||ye===void 0?void 0:ye.blocked)===null||Ee===void 0)&&Ee.byDeviceMissing?v(Gt,"not-found"):!((k=(Ve=O.audio)===null||Ve===void 0?void 0:Ve.blocked)===null||k===void 0)&&k.byPermissions||I==="denied"?v(Gt,"blocked"):Y?v(Gt,"pending"):ne?v(Gt,"idle"):(v(Gt,"granted"),v(Fu,function(Ce){return Ce.map(function(oe){return oe.selected?tt(tt({},oe),{state:"granted"}):oe})})),!((Me=(ze=O.video)===null||ze===void 0?void 0:ze.blocked)===null||Me===void 0)&&Me.byDeviceInUse?(v(Ht,"in-use"),v(Bu,function(Ce){return Ce.map(function(oe){return oe.selected?tt(tt({},oe),{state:"in-use"}):oe})})):!((Ue=(K=O.video)===null||K===void 0?void 0:K.blocked)===null||Ue===void 0)&&Ue.byDeviceMissing?v(Ht,"not-found"):!((be=(it=O.video)===null||it===void 0?void 0:it.blocked)===null||be===void 0)&&be.byPermissions||j==="denied"?v(Ht,"blocked"):D?v(Ht,"pending"):V?v(Ht,"idle"):(v(Ht,"granted"),v(Bu,function(Ce){return Ce.map(function(oe){return oe.selected?tt(tt({},oe),{state:"granted"}):oe})})),l(),[2]}})})},[a,l]));return Qe("participant-updated",z.useCallback(function(h){h.participant.local&&f()},[f])),Qe("available-devices-updated",l),Qe("selected-devices-updated",l),Qe("camera-error",rt(z.useCallback(function(h,v,y){var b,E,O,j,I,A,R;switch(v(zy,y.error),(b=y.error)===null||b===void 0?void 0:b.type){case"cam-in-use":v(Ht,"in-use");break;case"mic-in-use":v(Gt,"in-use");break;case"cam-mic-in-use":v(Ht,"in-use"),v(Gt,"in-use");break;case"not-found":!((E=y.error)===null||E===void 0)&&E.missingMedia.includes("video")&&v(Ht,"not-found"),!((O=y.error)===null||O===void 0)&&O.missingMedia.includes("audio")&&v(Gt,"not-found");break;case"permissions":!((j=y.error)===null||j===void 0)&&j.blockedMedia.includes("video")&&v(Ht,"blocked"),!((I=y.error)===null||I===void 0)&&I.blockedMedia.includes("audio")&&v(Gt,"blocked");break;case"constraints":((A=y.error)===null||A===void 0?void 0:A.reason)==="invalid"?(v(Ht,"constraints-invalid"),v(Gt,"constraints-invalid")):((R=y.error)===null||R===void 0?void 0:R.reason)==="none-specified"&&(v(Ht,"constraints-none-specified"),v(Gt,"constraints-none-specified"));break;case"undefined-mediadevices":v(Ht,"undefined-mediadevices"),v(Gt,"undefined-mediadevices");break;case"unknown":default:v(Ht,"unknown"),v(Gt,"unknown");break}},[]))),Qe("started-camera",rt(z.useCallback(function(h,v){v(Ht,"granted"),v(Gt,"granted"),f()},[f]))),et.createElement(Kk.Provider,{value:{refreshDevices:l}},r)},xc=st({errorMsg:void 0,isLiveStreaming:!1,layout:void 0});xc.debugLabel=gt("live-streaming");var Xk=function(e){var r=e.children;return Qe("live-streaming-started",rt(z.useCallback(function(a,l,f){l(xc,{isLiveStreaming:!0,layout:f?.layout})},[]))),Qe("live-streaming-stopped",rt(z.useCallback(function(a,l){l(xc,function(f){return tt(tt({},f),{isLiveStreaming:!1,layout:void 0})})},[]))),Qe("live-streaming-error",rt(z.useCallback(function(a,l,f){l(xc,function(h){return tt(tt({},h),{errorMsg:f.errorMsg})})},[]))),Qe("left-meeting",rt(z.useCallback(function(a,l){l(xc,{errorMsg:void 0,isLiveStreaming:!1,layout:void 0})},[]))),et.createElement(et.Fragment,null,r)},Vu=st("new");Vu.debugLabel=gt("meeting-state");var Fh=st(null);Fh.debugLabel=gt("meeting-error");var Vh=st(null);Vh.debugLabel=gt("non-fatal-error");var Lc=st({data:void 0,topology:"none"});Lc.debugLabel=gt("meeting-session-data");var Zk=function(e){var r=e.children,a=$i(),l=rt(z.useCallback(function(h,v){if(a){var y=a.meetingState();return v(Vu,y),y}},[a]));Qe("loading",l),Qe("loaded",l),Qe("joining-meeting",l),Qe("joined-meeting",l),Qe("left-meeting",l),Qe("error",rt(z.useCallback(function(h,v,y){v(Fh,y),l()},[l]))),Qe("nonfatal-error",rt(z.useCallback(function(h,v,y){v(Vh,y)},[])));var f=rt(z.useCallback(function(h,v){a&&v(Lc,a.meetingSessionState())},[a]));return Qe("joined-meeting",f),Qe("meeting-session-state-updated",rt(z.useCallback(function(h,v,y){v(Lc,y.meetingSessionState)},[]))),Qe("left-meeting",rt(z.useCallback(function(h,v){v(Lc,{data:void 0,topology:"none"})},[]))),Qe("call-instance-destroyed",rt(z.useCallback(function(h,v){v(Vu,"new"),v(Fh,null),v(Vh,null),v(Lc,{data:void 0,topology:"none"})},[]))),et.createElement(et.Fragment,null,r)},Oa=st("none");Oa.debugLabel=gt("topology");var $y=st("unknown"),qy=st([]),zh=st(100);zh.debugLabel=gt("network-quality");var $h=st("good");$h.debugLabel=gt("network-threshold");var eC=function(e){var r=e.children,a=$i(),l=lo(Oa),f=rt(z.useCallback(function(h,v){return Ca(void 0,void 0,void 0,function(){var y;return Ea(this,function(b){switch(b.label){case 0:return a?[4,a.getNetworkTopology()]:[2];case 1:return y=b.sent(),!y||y?.topology==="none"?[2]:(v(Oa,y.topology),[2])}})})},[a]));return Qe("joined-meeting",f),Qe("network-connection",rt(z.useCallback(function(h,v,y){switch(y.event){case"connected":y.type==="peer-to-peer"&&v(Oa,"peer"),y.type==="sfu"&&v(Oa,"sfu");break}},[]))),Qe("network-quality-change",rt(z.useCallback(function(h,v,y){v($y,function(b){return b!==y.networkState?y.networkState:b}),v(qy,function(b){var E,O=(E=y.networkStateReasons)!==null&&E!==void 0?E:[];return Ah(b,O)?b:O}),v(zh,function(b){return b!==y.quality?y.quality:b}),v($h,function(b){return b!==y.threshold?y.threshold:b})},[]))),Qe("left-meeting",rt(z.useCallback(function(h,v){v(Oa,"none"),v($y,"unknown"),v(qy,[]),v(zh,100),v($h,"good")},[]))),z.useEffect(function(){!a||l!=="none"||f()},[a,f,l]),et.createElement(et.Fragment,null,r)},To=st({isLocalParticipantRecorded:!1,isRecording:!1});To.debugLabel=gt("recording-state");var tC=function(e){var r=e.children,a=Nu(),l=Uy({filter:"record"}),f=rt(z.useCallback(function(h,v,y,b){var E=h(To),O={isLocalParticipantRecorded:E.isLocalParticipantRecorded,isRecording:E.isRecording,local:E.local,type:E.type},j={isLocalParticipantRecorded:O?.type==="local"||!O?.type?y:O.isLocalParticipantRecorded,isRecording:O?.type==="local"||!O?.type?y:O.isRecording,local:(O?.type==="local"||!O?.type)&&y?b:O?.local,type:y?"local":E?.type};$r(O,j)||v(To,tt(tt({},O),j))},[]));return z.useEffect(function(){var h=l.length>0,v=l.includes(a||"local");f(h,v)},[a,f,l]),Qe("recording-started",rt(z.useCallback(function(h,v,y){var b,E=!0;switch(y.type){case"cloud-beta":case"cloud":{a&&((b=y.layout)===null||b===void 0?void 0:b.preset)==="single-participant"&&y.layout.session_id!==a&&(E=!1);break}}v(To,{error:!1,isLocalParticipantRecorded:E,isRecording:!0,layout:y?.layout,local:y?.local,recordingId:y?.recordingId,recordingStartedDate:new Date,startedBy:y?.startedBy,type:y?.type})},[a]))),Qe("recording-stopped",rt(z.useCallback(function(h,v){v(To,function(y){return tt(tt({},y),{isLocalParticipantRecorded:!1,isRecording:!1})})},[]))),Qe("recording-error",rt(z.useCallback(function(h,v){v(To,function(y){return tt(tt({},y),{error:!0,isLocalParticipantRecorded:!1,isRecording:!1})})},[]))),Qe("left-meeting",rt(z.useCallback(function(h,v){v(To,{isLocalParticipantRecorded:!1,isRecording:!1})},[]))),et.createElement(et.Fragment,null,r)},nC=function(){var e=lo(Vu);return z.useDebugValue(e),e},qh=st(null);qh.debugLabel=gt("room-state");var rC=function(e){var r=e.children,a=$i(),l=nC(),f=rt(z.useCallback(function(h,v){return Ca(void 0,void 0,void 0,function(){var y;return Ea(this,function(b){switch(b.label){case 0:return!a||l==="left-meeting"?[2]:[4,a.room()];case 1:return y=b.sent(),y&&"id"in y&&v(qh,y),[2,y]}})})},[a,l]));return Qe("access-state-updated",f),Qe("left-meeting",rt(z.useCallback(function(h,v){return function(){v(qh,null)}},[]))),et.createElement(et.Fragment,null,r)},Ta=st({isTranscribing:!1,model:"general",language:"en",transcriptions:[]});Ta.debugLabel=gt("transcription-state");var iC=function(e){var r=e.children;return Qe("transcription-started",rt(z.useCallback(function(a,l,f){l(Ta,{error:!1,transcriptionStartDate:new Date,isTranscribing:!0,transcriptions:[],endpointing:f.endpointing,extra:f.extra,includeRawResponse:f.includeRawResponse,instanceId:f.instanceId,language:f.language,model:f.model,profanity_filter:f.profanity_filter,punctuate:f.punctuate,redact:f.redact,startedBy:f.startedBy,tier:f.tier})},[]))),Qe("transcription-stopped",rt(z.useCallback(function(a,l,f){l(Ta,function(h){return tt(tt({},h),{updatedBy:f.updatedBy,isTranscribing:!1})})},[]))),Qe("transcription-error",rt(z.useCallback(function(a,l){l(Ta,function(f){return tt(tt({},f),{error:!0,isTranscribing:!1})})},[]))),Qe("left-meeting",rt(z.useCallback(function(a,l){l(Ta,function(f){return tt(tt({},f),{isTranscribing:!1})})},[]))),Qe("app-message",rt(z.useCallback(function(a,l,f){f?.fromId==="transcription"&&l(Ta,function(h){return tt(tt({},h),{isTranscribing:!0,transcriptions:yn(yn([],wt(h.transcriptions),!1),[f.data],!1)})})},[]))),et.createElement(et.Fragment,null,r)},Wy={},Hy=function(){return!0},sC={options:Wy,shouldCreateInstance:Hy},oC=function(e,r){var a=r===void 0?sC:r,l=a.parentElRef,f=a.options,h=f===void 0?Wy:f,v=a.shouldCreateInstance,y=v===void 0?Hy:v,b=wt(z.useState(null),2),E=b[0],O=b[1],j=z.useRef();return z.useEffect(function(){if(!y())return;function I(D){return Ca(this,void 0,void 0,function(){return Ea(this,function(V){switch(V.label){case 0:return[4,D.destroy()];case 1:return V.sent(),[2]}})})}var A=function(){setTimeout(function(){return O(null)},0)},R=Au.getCallInstance();if(!E&&R&&!R.isDestroyed()){R.once("call-instance-destroyed",A),O(R);return}if(E){$r(j.current,h)||I(E);return}if(!R||R.isDestroyed()){switch(e){case"callFrame":R=l?.current?Au.createFrame(l.current,tt({},h)):Au.createFrame(tt({},h));break;case"callObject":R=Au.createCallObject(tt({},h));break}j.current=h}O(R),R.once("call-instance-destroyed",A)},[E,h,l,y,e]),E},aC=function(e){return oC("callObject",e)},cC=function(e){var r=e.children,a=e.jotaiStore,l=Mh(e,["children","jotaiStore"]),f=z.useRef({}),h=z.useCallback(function(A){var R,D,V,Y;if("action"in A){var ne=A.action,L=Array.from((Y=(V=f.current)===null||V===void 0?void 0:V[ne])!==null&&Y!==void 0?Y:[]),q=L.filter(function(ze){var Me=wt(ze,1),K=Me[0];return K<0}),H=L.filter(function(ze){var Me=wt(ze,1),K=Me[0];return K>0}),ae=yn(yn([],wt(q),!1),wt(H),!1);try{for(var ye=Ty(ae),Ee=ye.next();!Ee.done;Ee=ye.next()){var Ve=wt(Ee.value,2),k=Ve[1];k(A)}}catch(ze){R={error:ze}}finally{try{Ee&&!Ee.done&&(D=ye.return)&&D.call(ye)}finally{if(R)throw R.error}}}},[]),v=z.useCallback(function(A){A&&Object.keys(f.current).forEach(function(R){A.off(R,h),A.isDestroyed()||A.on(R,h)})},[h]),y="callObject"in l?l.callObject:null,b=z.useMemo(function(){return"callObject"in l?{}:l},[l]),E=aC({options:b,shouldCreateInstance:z.useCallback(function(){return!("callObject"in l)},[l])}),O=y??E;z.useEffect(function(){O&&v(O)},[O,v]);var j=z.useCallback(function(A,R,D){var V,Y;f.current[A]||(f.current[A]=new Map,O&&(O.off(A,h),O.isDestroyed()||O.on(A,h))),!((V=f.current[A])===null||V===void 0)&&V.has(D)||(Y=f.current[A])===null||Y===void 0||Y.set(D,R)},[O,h]),I=z.useCallback(function(A,R){var D,V;(D=f.current[A])===null||D===void 0||D.delete(R),((V=f.current[A])===null||V===void 0?void 0:V.size)===0&&(O?.off(A,h),delete f.current[A])},[O,h]);return et.createElement(Lw,{store:a},et.createElement(Ry.Provider,{value:O},et.createElement(Oh.Provider,{value:{on:j,off:I}},et.createElement(rC,null,et.createElement(Zk,null,et.createElement(eC,null,et.createElement($k,null,et.createElement(tC,null,et.createElement(Xk,null,et.createElement(iC,null,et.createElement(Yk,null,r)))))))))))},lC=st({state:"low",reason:"none"});lC.debugLabel=gt("cpu-load");var uC=st(null);uC.debugLabel=gt("input-settings");var dC=st({hidden:0,present:0});dC.debugLabel=gt("participant-counts");var fC=wc(function(n){var e=st({},function(r,a,l){a(fC(n),l)});return e.debugLabel=gt("participant-receive-settings-".concat(n)),e}),hC=st(null);hC.debugLabel=gt("send-settings");/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pC=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),gC=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,a)=>a?a.toUpperCase():r.toLowerCase()),Gy=n=>{const e=gC(n);return e.charAt(0).toUpperCase()+e.slice(1)},Jy=(...n)=>n.filter((e,r,a)=>!!e&&e.trim()!==""&&a.indexOf(e)===r).join(" ").trim(),mC=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var vC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yC=z.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:l="",children:f,iconNode:h,...v},y)=>z.createElement("svg",{ref:y,...vC,width:e,height:e,stroke:n,strokeWidth:a?Number(r)*24/Number(e):r,className:Jy("lucide",l),...!f&&!mC(v)&&{"aria-hidden":"true"},...v},[...h.map(([b,E])=>z.createElement(b,E)),...Array.isArray(f)?f:[f]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ms=(n,e)=>{const r=z.forwardRef(({className:a,...l},f)=>z.createElement(yC,{ref:f,iconNode:e,className:Jy(`lucide-${pC(Gy(n))}`,`lucide-${n}`,a),...l}));return r.displayName=Gy(n),r};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qy=ms("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _C=ms("mic-off",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wC=ms("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bC=ms("phone-off",[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SC=ms("phone",[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kC=ms("send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CC=ms("video-off",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ky=ms("video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function EC({currentFields:n,onJoined:e}){const[r,a]=z.useState(!1),[l,f]=z.useState(n.joined||!1),h=$i(),v=!!n.dailyRoomId&&!n.sessionEndedAt,y=!!n.joined;z.useEffect(()=>{if(v&&n.dailyRoomId&&h){const O=`https://n2o.daily.co/${n.dailyRoomId}`;console.log("Visitor: Joining room:",O),h.join({url:O,startVideoOff:!0,startAudioOff:!0})}else!v&&h&&h.leave()},[v,n.dailyRoomId,h]),z.useEffect(()=>{n.sessionEndedAt&&h&&(console.log("Visit completed, cleaning up camera/microphone"),h.setLocalAudio(!1),h.setLocalVideo(!1),h.leave(),a(!1),f(!1))},[n.sessionEndedAt,h]),z.useEffect(()=>{if(f(n.joined||!1),n.joined&&h)try{h.setLocalAudio(!0)}catch(O){console.error("Failed to enable local audio:",O)}},[n.joined,h]);const b=async()=>{if(h)try{l?(h.setLocalAudio(!1),f(!1)):((await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(j=>j.stop()),h.setLocalAudio(!0),f(!0),e())}catch(O){console.error("Microphone permission denied:",O)}},E=async()=>{if(h)try{const O=!r;O&&(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(I=>I.stop()),h.setLocalVideo(O),a(O)}catch(O){console.error("Camera permission denied:",O)}};return v?_e.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:_e.jsx(MC,{isVideoEnabled:r,isMicEnabled:l,onToggleMic:b,onToggleVideo:E,joined:y})}):null}function MC({isVideoEnabled:n,isMicEnabled:e,onToggleMic:r,onToggleVideo:a,joined:l}){const f=z.useRef(null),h=z.useRef(null),v=z.useRef(null),[y,b]=z.useState(null),[E,O]=z.useState(window.__embedDeclined||!1),j=$i();return z.useEffect(()=>{if(!j)return;const I=V=>{if(V.participant.local)V.participant.videoTrack&&h.current&&(h.current.srcObject=new MediaStream([V.participant.videoTrack]),h.current.muted=!0,h.current.playsInline=!0,h.current.play().catch(()=>{}));else{const Y=V.participant.user_name||V.participant.userName||V.participant.name||null;Y&&b(Y),V.participant.videoTrack&&f.current&&(f.current.srcObject=new MediaStream([V.participant.videoTrack]),f.current.muted=!0,f.current.playsInline=!0,f.current.play().catch(()=>{})),V.participant.audioTrack&&v.current&&(v.current.srcObject=new MediaStream([V.participant.audioTrack]),v.current.muted=!l,l&&v.current.play().catch(()=>{}))}},A=V=>{if(!V.participant.local){const Y=V.participant.user_name||V.participant.userName||V.participant.name||null;Y&&b(Y)}},R=V=>{V.participant.local&&V.track.kind==="video"&&h.current&&(h.current.srcObject=new MediaStream([V.track]),h.current.muted=!0,h.current.playsInline=!0,h.current.play().catch(()=>{})),!V.participant.local&&V.track.kind==="video"&&f.current&&(f.current.srcObject=new MediaStream([V.track]),f.current.muted=!0,f.current.playsInline=!0,f.current.play().catch(()=>{})),!V.participant.local&&V.track.kind==="audio"&&v.current&&(v.current.srcObject=new MediaStream([V.track]),v.current.muted=!l,l&&v.current.play().catch(()=>{}))},D=V=>{V.participant.local&&V.track.kind==="video"&&h.current&&(h.current.srcObject=null),!V.participant.local&&V.track.kind==="video"&&f.current&&(f.current.srcObject=null),!V.participant.local&&V.track.kind==="audio"&&v.current&&(v.current.srcObject=null)};return j.on("participant-joined",I),j.on("track-started",R),j.on("track-stopped",D),j.on("participant-updated",A),()=>{j.off("participant-joined",I),j.off("track-started",R),j.off("track-stopped",D),j.off("participant-updated",A)}},[j,l]),z.useEffect(()=>{const I=()=>O(!0);return window.addEventListener("embed-declined",I),()=>window.removeEventListener("embed-declined",I)},[]),z.useEffect(()=>{v.current&&(v.current.muted=!l,l&&v.current.play().catch(()=>{}))},[l]),E?null:_e.jsxs("div",{style:{width:"300px",height:"200px",background:"hsl(var(--background) / 0.7)",borderRadius:"8px",border:"1px solid hsl(var(--border) / 0.3)",overflow:"hidden",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)",position:"relative"},children:[_e.jsx("video",{ref:f,autoPlay:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}),!l&&_e.jsxs("div",{style:{position:"absolute",left:"8px",right:"8px",bottom:"12px",background:"hsl(var(--foreground) / 0.7)",color:"hsl(var(--background))",borderRadius:"16px",padding:"10px 14px",fontSize:"14px",fontWeight:600,zIndex:10002},children:[_e.jsx("span",{style:{fontWeight:800},children:y||"Someone"}),_e.jsx("span",{style:{fontWeight:500,opacity:.9},children:" is calling you..."})]}),_e.jsx("audio",{ref:v,autoPlay:!0,controls:!1,style:{display:"none"}}),n&&_e.jsx("video",{ref:h,autoPlay:!0,muted:!0,style:{position:"absolute",top:"10px",right:"10px",width:"80px",height:"60px",objectFit:"cover",borderRadius:"8px",border:"1px solid hsl(var(--border) / 0.3)",zIndex:10001}}),l&&_e.jsx(OC,{isVideoEnabled:n,isMicEnabled:e,onToggleMic:r,onToggleVideo:a})]})}function OC({isVideoEnabled:n,isMicEnabled:e,onToggleMic:r,onToggleVideo:a}){return _e.jsxs("div",{style:{position:"absolute",bottom:"10px",left:"50%",transform:"translateX(-50%)",display:"flex",gap:"8px",zIndex:10},children:[_e.jsx("button",{onClick:r,style:{width:"40px",height:"40px",borderRadius:"50%",border:"1px solid hsl(var(--border) / 0.3)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",backgroundColor:"hsl(var(--background))",color:e?"hsl(var(--foreground))":"hsl(var(--muted-foreground))",opacity:e?1:.6},onMouseEnter:l=>{l.currentTarget.style.transform="scale(1.1)"},onMouseLeave:l=>{l.currentTarget.style.transform="scale(1)"},children:e?_e.jsx(wC,{size:16}):_e.jsx(_C,{size:16})}),_e.jsx("button",{onClick:a,style:{width:"40px",height:"40px",borderRadius:"50%",border:"1px solid hsl(var(--border) / 0.3)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",backgroundColor:"hsl(var(--background))",color:n?"hsl(var(--foreground))":"hsl(var(--muted-foreground))",opacity:n?1:.6},onMouseEnter:l=>{l.currentTarget.style.transform="scale(1.1)"},onMouseLeave:l=>{l.currentTarget.style.transform="scale(1)"},children:n?_e.jsx(Ky,{size:16}):_e.jsx(CC,{size:16})})]})}var zu={exports:{}};/*@license Copyright 2015-2022 Ably Real-time Ltd (ably.com)

	Ably JavaScript Library v2.14.0
	https://github.com/ably/ably-js

	Released under the Apache Licence v2.0*/var TC=zu.exports,Yy;function RC(){return Yy||(Yy=1,(function(n,e){(function(r,a){n.exports=a()})(TC,()=>{var r={},a={exports:r},l=Object.defineProperty,f=Object.defineProperties,h=Object.getOwnPropertyDescriptor,v=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertyNames,b=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,j=(s,o,u)=>o in s?l(s,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[o]=u,I=(s,o)=>{for(var u in o||(o={}))E.call(o,u)&&j(s,u,o[u]);if(b)for(var u of b(o))O.call(o,u)&&j(s,u,o[u]);return s},A=(s,o)=>f(s,v(o)),R=(s,o)=>{var u={};for(var p in s)E.call(s,p)&&o.indexOf(p)<0&&(u[p]=s[p]);if(s!=null&&b)for(var p of b(s))o.indexOf(p)<0&&O.call(s,p)&&(u[p]=s[p]);return u},D=(s,o)=>{for(var u in o)l(s,u,{get:o[u],enumerable:!0})},V=(s,o,u,p)=>{if(o&&typeof o=="object"||typeof o=="function")for(let _ of y(o))!E.call(s,_)&&_!==u&&l(s,_,{get:()=>o[_],enumerable:!(p=h(o,_))||p.enumerable});return s},Y=s=>V(l({},"__esModule",{value:!0}),s),ne={};D(ne,{ErrorInfo:()=>K,Realtime:()=>wl,Rest:()=>dl,default:()=>Al,makeProtocolMessageFromDeserialized:()=>ol,msgpack:()=>aa}),a.exports=Y(ne);var L=class{},q=typeof ls<"u"?ls:typeof window<"u"?window:self;function H(s,o){return`${s}`.padStart(o?3:2,"0")}function ae(s){return L.Config.logTimestamps?function(o){const u=new Date;s(H(u.getHours())+":"+H(u.getMinutes())+":"+H(u.getSeconds())+"."+H(u.getMilliseconds(),1)+" "+o)}:function(o){s(o)}}var ye=()=>{var s;let o,u;return typeof((s=q?.console)==null?void 0:s.log)=="function"?(o=function(...p){console.log.apply(console,p)},u=console.warn?function(...p){console.warn.apply(console,p)}:o):o=u=function(){},[o,u].map(ae)},Ee=class Vl{constructor(){this.deprecated=(o,u)=>{this.deprecationWarning(`${o} is deprecated and will be removed in a future version. ${u}`)},this.shouldLog=o=>o<=this.logLevel,this.setLog=(o,u)=>{o!==void 0&&(this.logLevel=o),u!==void 0&&(this.logHandler=this.logErrorHandler=u)},this.logLevel=Vl.defaultLogLevel,this.logHandler=Vl.defaultLogHandler,this.logErrorHandler=Vl.defaultLogErrorHandler}static initLogHandlers(){const[o,u]=ye();this.defaultLogHandler=o,this.defaultLogErrorHandler=u,this.defaultLogger=new Vl}static logActionNoStrip(o,u,p,_){o.logAction(u,p,_)}logAction(o,u,p){this.shouldLog(o)&&(o===1?this.logErrorHandler:this.logHandler)("Ably: "+u+": "+p,o)}renamedClientOption(o,u){this.deprecationWarning(`The \`${o}\` client option has been renamed to \`${u}\`. Please update your code to use \`${u}\` instead. \`${o}\` will be removed in a future version.`)}renamedMethod(o,u,p){this.deprecationWarning(`\`${o}\`s \`${u}\` method has been renamed to \`${p}\`. Please update your code to use \`${p}\` instead. \`${u}\` will be removed in a future version.`)}deprecationWarning(o){this.shouldLog(1)&&this.logErrorHandler(`Ably: Deprecation warning - ${o}`,1)}};Ee.defaultLogLevel=1,Ee.LOG_NONE=0,Ee.LOG_ERROR=1,Ee.LOG_MAJOR=2,Ee.LOG_MINOR=3,Ee.LOG_MICRO=4,Ee.logAction=(s,o,u,p)=>{Ee.logActionNoStrip(s,o,u,p)};var Ve=Ee,k=Ve,ze={};D(ze,{Format:()=>Ln,allSame:()=>bn,allToLowerCase:()=>Hr,allToUpperCase:()=>gi,arrChooseN:()=>qi,arrDeleteValue:()=>fe,arrEquals:()=>vi,arrIntersect:()=>G,arrIntersectOb:()=>ie,arrPopRandomElement:()=>mt,arrWithoutValue:()=>Oe,cheapRandStr:()=>Jt,containsValue:()=>N,copy:()=>he,createMissingPluginError:()=>Or,dataSizeBytes:()=>Qn,decodeBody:()=>Dt,encodeBody:()=>cn,ensureArray:()=>Ce,forInOwnNonNullProperties:()=>Vt,getBackoffCoefficient:()=>Ia,getGlobalObject:()=>jo,getJitterCoefficient:()=>Lo,getRetryTime:()=>Wi,inherits:()=>C,inspectBody:()=>jn,inspectError:()=>Ze,intersect:()=>F,isEmpty:()=>J,isErrorInfoOrPartialErrorInfo:()=>zt,isNil:()=>le,isObject:()=>oe,keysArray:()=>$e,matchDerivedChannel:()=>mi,mixin:()=>be,parseQueryString:()=>en,prototypicalClone:()=>M,randomString:()=>Mr,shallowClone:()=>g,shallowEquals:()=>Ss,throwMissingPluginError:()=>bt,toBase64:()=>Kn,toQueryString:()=>At,valuesArray:()=>Xe,whenPromiseSettles:()=>Nt,withTimeoutAsync:()=>Nn});function Me(s){let o="["+s.constructor.name;return s.message&&(o+=": "+s.message),s.statusCode&&(o+="; statusCode="+s.statusCode),s.code&&(o+="; code="+s.code),s.cause&&(o+="; cause="+Ze(s.cause)),s.href&&!(s.message&&s.message.indexOf("help.ably.io")>-1)&&(o+="; see "+s.href+" "),o+="]",o}var K=class hg extends Error{constructor(o,u,p,_){super(o),typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(this,hg.prototype),this.code=u,this.statusCode=p,this.cause=_}toString(){return Me(this)}static fromValues(o){const{message:u,code:p,statusCode:_}=o;if(typeof u!="string"||typeof p!="number"||typeof _!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+L.Config.inspect(o));const S=Object.assign(new hg(u,p,_),o);return S.code&&!S.href&&(S.href="https://help.ably.io/error/"+S.code),S}},Ue=class pg extends Error{constructor(o,u,p,_){super(o),typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(this,pg.prototype),this.code=u,this.statusCode=p,this.cause=_}toString(){return Me(this)}static fromValues(o){const{message:u,code:p,statusCode:_}=o;if(typeof u!="string"||!le(p)&&typeof p!="number"||!le(_)&&typeof _!="number")throw new Error("PartialErrorInfo.fromValues(): invalid values: "+L.Config.inspect(o));const S=Object.assign(new pg(u,p,_),o);return S.code&&!S.href&&(S.href="https://help.ably.io/error/"+S.code),S}};function it(s){return Math.floor(Math.random()*s.length)}function be(s,...o){for(let u=0;u<o.length;u++){const p=o[u];if(!p)break;for(const _ in p)Object.prototype.hasOwnProperty.call(p,_)&&(s[_]=p[_])}return s}function he(s){return be({},s)}function Ce(s){return le(s)?[]:Array.isArray(s)?s:[s]}function oe(s){return Object.prototype.toString.call(s)=="[object Object]"}function J(s){for(const o in s)return!1;return!0}function le(s){return s==null}function g(s){const o=new Object;for(const u in s)o[u]=s[u];return o}function M(s,o){class u{}u.prototype=s;const p=new u;return o&&be(p,o),p}var C=function(s,o){if(L.Config.inherits){L.Config.inherits(s,o);return}s.super_=o,s.prototype=M(o.prototype,{constructor:s})};function N(s,o){for(const u in s)if(s[u]==o)return!0;return!1}function F(s,o){return Array.isArray(o)?G(s,o):ie(s,o)}function G(s,o){const u=[];for(let p=0;p<s.length;p++){const _=s[p];o.indexOf(_)!=-1&&u.push(_)}return u}function ie(s,o){const u=[];for(let p=0;p<s.length;p++){const _=s[p];_ in o&&u.push(_)}return u}function fe(s,o){const u=s.indexOf(o),p=u!=-1;return p&&s.splice(u,1),p}function Oe(s,o){const u=s.slice();return fe(u,o),u}function $e(s,o){const u=[];for(const p in s)o&&!Object.prototype.hasOwnProperty.call(s,p)||u.push(p);return u}function Xe(s,o){const u=[];for(const p in s)o&&!Object.prototype.hasOwnProperty.call(s,p)||u.push(s[p]);return u}function Vt(s,o){for(const u in s)Object.prototype.hasOwnProperty.call(s,u)&&s[u]&&o(u)}function bn(s,o){if(s.length===0)return!0;const u=s[0][o];return s.every(function(p){return p[o]===u})}var Ln=(s=>(s.msgpack="msgpack",s.json="json",s))(Ln||{});function mt(s){return s.splice(it(s),1)[0]}function At(s){const o=[];if(s)for(const u in s)o.push(encodeURIComponent(u)+"="+encodeURIComponent(s[u]));return o.length?"?"+o.join("&"):""}function en(s){let o;const u=/([^?&=]+)=?([^&]*)/g,p={};for(;o=u.exec(s);)p[decodeURIComponent(o[1])]=decodeURIComponent(o[2]);return p}function zt(s){return typeof s=="object"&&s!==null&&(s instanceof K||s instanceof Ue)}function Ze(s){var o,u;return s instanceof Error||((o=s?.constructor)==null?void 0:o.name)==="ErrorInfo"||((u=s?.constructor)==null?void 0:u.name)==="PartialErrorInfo"?s.toString():L.Config.inspect(s)}function jn(s){return L.BufferUtils.isBuffer(s)?s.toString():typeof s=="string"?s:L.Config.inspect(s)}function Qn(s){if(L.BufferUtils.isBuffer(s))return L.BufferUtils.byteLength(s);if(typeof s=="string")return L.Config.stringByteSize(s);if(typeof s=="number")return 8;if(typeof s=="boolean")return 1;throw new Error(`Expected input of Utils.dataSizeBytes to be a string, a number, a boolean or a buffer, but was: ${typeof s}`)}function Jt(){return String(Math.random()).substr(2)}var Mr=async s=>{const o=await L.Config.getRandomArrayBuffer(s);return L.BufferUtils.base64Encode(o)};function qi(s,o){const u=Math.min(o,s.length),p=s.slice(),_=[];for(let S=0;S<u;S++)_.push(mt(p));return _}function Nt(s,o){s.then(u=>{o?.(null,u)}).catch(u=>{o?.(u)})}function Dt(s,o,u){return u=="msgpack"?(o||bt("MsgPack"),o.decode(s)):JSON.parse(String(s))}function cn(s,o,u){return u=="msgpack"?(o||bt("MsgPack"),o.encode(s,!0)):JSON.stringify(s)}function Hr(s){return s.map(function(o){return o&&o.toLowerCase()})}function gi(s){return s.map(function(o){return o&&o.toUpperCase()})}function Ia(s){return Math.min((s+2)/3,2)}function Lo(){return 1-Math.random()*.2}function Wi(s,o){return s*Ia(o)*Lo()}function jo(){return typeof ls<"u"?ls:typeof window<"u"?window:self}function Ss(s,o){return Object.keys(s).every(u=>s[u]===o[u])&&Object.keys(o).every(u=>o[u]===s[u])}function mi(s){const o=/^(\[([^?]*)(?:(.*))\])?(.+)$/,u=s.match(o);if(!u||!u.length||u.length<5)throw new K("regex match failed",400,40010);if(u[2])throw new K(`cannot use a derived option with a ${u[2]} channel`,400,40010);return{qualifierParam:u[3]||"",channelName:u[4]}}function Kn(s){const o=L.BufferUtils,u=o.utf8Encode(s);return o.base64Encode(u)}function vi(s,o){return s.length===o.length&&s.every(function(u,p){return u===o[p]})}function Or(s){return new K(`${s} plugin not provided`,40019,400)}function bt(s){throw Or(s)}async function Nn(s,o=5e3,u="Timeout expired"){const p=new K(u,5e4,500);return Promise.race([s,new Promise((_,S)=>setTimeout(()=>S(p),o))])}var No="2.14.0",xa="ably-js/"+No,Sn={ENDPOINT:"main",ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["main.a.fallback.ably-realtime.com","main.b.fallback.ably-realtime.com","main.c.fallback.ably-realtime.com","main.d.fallback.ably-realtime.com","main.e.fallback.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:1e4,httpMaxRetryDuration:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,webSocketConnectTimeout:1e4,webSocketSlowTimeout:4e3},httpMaxRetryCount:3,maxMessageSize:65536,version:No,protocolVersion:4,agent:xa,getPort:La,getHttpScheme:ja,getPrimaryDomainFromEndpoint:ks,getEndpointFallbackHosts:kn,getFallbackHosts:yi,getHosts:Fc,checkHost:_i,objectifyOptions:Do,normaliseOptions:zc,defaultGetHeaders:Na,defaultPostHeaders:$c};function La(s,o){return o||s.tls?s.tlsPort:s.port}function ja(s){return s.tls?"https://":"http://"}function Hi(s){return s.includes(".")||s.includes("::")||s==="localhost"}function ks(s){return Hi(s)?s:s.startsWith("nonprod:")?`${s.replace("nonprod:","")}.realtime.ably-nonprod.net`:`${s}.realtime.ably.net`}function kn(s){if(Hi(s))return[];if(s.startsWith("nonprod:")){const o=s.replace("nonprod:","");return Cs(o,"ably-realtime-nonprod.com")}return Cs(s,"ably-realtime.com")}function Cs(s,o){return["a","b","c","d","e"].map(u=>`${s}.${u}.fallback.${o}`)}function yi(s){const o=s.fallbackHosts,u=typeof s.httpMaxRetryCount<"u"?s.httpMaxRetryCount:Sn.httpMaxRetryCount;return o?qi(o,u):[]}function Fc(s){return[s.primaryDomain].concat(yi(s))}function _i(s){if(typeof s!="string")throw new K("host must be a string; was a "+typeof s,4e4,400);if(!s.length)throw new K("host must not be zero-length",4e4,400)}function Es(s){const o={};for(const u in Sn.TIMEOUTS)o[u]=s[u]||Sn.TIMEOUTS[u];return o}function tn(s){let o=Sn.agent;if(s.agents)for(var u in s.agents)o+=" "+u+"/"+s.agents[u];return o}function Do(s,o,u,p,_){if(s===void 0){const P=o?`${u} must be initialized with either a client options object, an Ably API key, or an Ably Token`:`${u} must be initialized with a client options object`;throw k.logAction(p,k.LOG_ERROR,`${u}()`,P),new Error(P)}let S;if(typeof s=="string")if(s.indexOf(":")==-1){if(!o){const P=`${u} cannot be initialized with just an Ably Token; you must provide a client options object with a \`plugins\` property. (Set this Ably Token as the objects \`token\` property.)`;throw k.logAction(p,k.LOG_ERROR,`${u}()`,P),new Error(P)}S={token:s}}else{if(!o){const P=`${u} cannot be initialized with just an Ably API key; you must provide a client options object with a \`plugins\` property. (Set this Ably API key as the objects \`key\` property.)`;throw k.logAction(p,k.LOG_ERROR,`${u}()`,P),new Error(P)}S={key:s}}else S=s;return _&&(S=A(I({},S),{plugins:I(I({},_),S.plugins)})),S}function Vc(s){if(s.endpoint&&(s.environment||s.restHost||s.realtimeHost))throw new K("The `endpoint` option cannot be used in conjunction with the `environment`, `restHost`, or `realtimeHost` options.",40106,400);if(s.environment&&(s.restHost||s.realtimeHost))throw new K("The `environment` option cannot be used in conjunction with the `restHost`, or `realtimeHost` options.",40106,400)}function zc(s,o,u){const p=u??k.defaultLogger;s.environment&&p.deprecated("The `environment` client option","Use the `endpoint` client option instead."),s.restHost&&p.deprecated("The `restHost` client option","Use the `endpoint` client option instead."),s.realtimeHost&&p.deprecated("The `realtimeHost` client option","Use the `endpoint` client option instead."),Vc(s),typeof s.recover=="function"&&s.closeOnUnload===!0&&(k.logAction(p,k.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),s.recover=void 0),"closeOnUnload"in s||(s.closeOnUnload=!s.recover),"queueMessages"in s||(s.queueMessages=!0);const _=s.endpoint||Sn.ENDPOINT;!s.fallbackHosts&&!s.restHost&&!s.realtimeHost&&!s.port&&!s.tlsPort&&(s.fallbackHosts=kn(s.environment||_));const S=s.environment&&`${s.environment}.realtime.ably.net`,U=s.restHost||s.realtimeHost||S||ks(_);(s.fallbackHosts||[]).concat(U).forEach(_i),s.port=s.port||Sn.PORT,s.tlsPort=s.tlsPort||Sn.TLS_PORT,"tls"in s||(s.tls=!0);const X=Es(s);o?"useBinaryProtocol"in s?s.useBinaryProtocol=L.Config.supportsBinary&&s.useBinaryProtocol:s.useBinaryProtocol=L.Config.preferBinary:s.useBinaryProtocol=!1;const Q={};s.clientId&&(Q["X-Ably-ClientId"]=L.BufferUtils.base64Encode(L.BufferUtils.utf8Encode(s.clientId))),"idempotentRestPublishing"in s||(s.idempotentRestPublishing=!0);let de=null,ce=s.connectivityCheckUrl;if(s.connectivityCheckUrl){let[ue,Te]=s.connectivityCheckUrl.split("?");de=Te?en(Te):{},ue.indexOf("://")===-1&&(ue="https://"+ue),ce=ue}let Se=s.wsConnectivityCheckUrl;return Se&&Se.indexOf("://")===-1&&(Se="wss://"+Se),A(I({},s),{primaryDomain:U,maxMessageSize:s.maxMessageSize||Sn.maxMessageSize,timeouts:X,connectivityCheckParams:de,connectivityCheckUrl:ce,wsConnectivityCheckUrl:Se,headers:Q})}function Ms(s,o,u){const p=u||{};if(p.cipher){s||bt("Crypto");const _=s.getCipher(p.cipher,o);p.cipher=_.cipherParams,p.channelCipher=_.cipher}else"cipher"in p&&(p.cipher=void 0,p.channelCipher=null);return p}var Tr={json:"application/json",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack",text:"text/plain"},Yn={format:"json",protocolVersion:Sn.protocolVersion};function Na(s,{format:o=Yn.format,protocolVersion:u=Yn.protocolVersion}={}){return{accept:Tr[o],"X-Ably-Version":u.toString(),"Ably-Agent":tn(s)}}function $c(s,{format:o=Yn.format,protocolVersion:u=Yn.protocolVersion}={}){let p;return{accept:p=Tr[o],"content-type":p,"X-Ably-Version":u.toString(),"Ably-Agent":tn(s)}}var qe=Sn;function Da(s){return Object.assign(Sn,s)}var Ua=class G0{constructor(o,u){this.logger=o,this.members=u||[]}call(o,u){for(const p of this.members)if(p)try{p(o,u)}catch(_){k.logAction(this.logger,k.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+_+"; stack = "+_.stack)}}push(...o){this.members.push(...o)}createPromise(){return new Promise((o,u)=>{this.push((p,_)=>{p?u(p):o(_)})})}resolveAll(o){this.call(null,o)}rejectAll(o){this.call(o)}static create(o,u){const p=new G0(o,u);return Object.assign((_,S)=>p.call(_,S),{push:_=>p.push(_),createPromise:()=>p.createPromise(),resolveAll:_=>p.resolveAll(_),rejectAll:_=>p.rejectAll(_)})}},hr=Ua,Ba=(s=>(s.Get="get",s.Delete="delete",s.Post="post",s.Put="put",s.Patch="patch",s))(Ba||{}),Ot=Ba,Et=(s=>(s[s.Success=200]="Success",s[s.NoContent=204]="NoContent",s[s.BadRequest=400]="BadRequest",s[s.Unauthorized=401]="Unauthorized",s[s.Forbidden=403]="Forbidden",s[s.RequestTimeout=408]="RequestTimeout",s[s.InternalServerError=500]="InternalServerError",s))(Et||{});function qc(s){return s>=200&&s<400}var wi=Et,Os=Math.pow(2,17);function Gi(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function Ts(s){return!!s.connection}function Uo(s){return zt(s)?(s.code||(s.statusCode===403?s.code=40300:(s.code=40170,s.statusCode=401)),s):new K(Ze(s),s.code||40170,s.statusCode||401)}var bi=(s,o)=>{const u=L.BufferUtils,p=u.utf8Encode(s),_=u.utf8Encode(o),S=u.hmacSha256(p,_);return u.base64Encode(S)};function Dn(s){if(!s)return"";typeof s=="string"&&(s=JSON.parse(s));const o=Object.create(null),u=$e(s,!0);if(!u)return"";u.sort();for(let p=0;p<u.length;p++)o[u[p]]=s[u[p]].sort();return JSON.stringify(o)}function Fa(s,o){if(s.authCallback)k.logAction(o,k.LOG_MINOR,"Auth()","using token auth with authCallback");else if(s.authUrl)k.logAction(o,k.LOG_MINOR,"Auth()","using token auth with authUrl");else if(s.key)k.logAction(o,k.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(s.tokenDetails)k.logAction(o,k.LOG_MINOR,"Auth()","using token auth with supplied token only");else{const u="authOptions must include valid authentication parameters";throw k.logAction(o,k.LOG_ERROR,"Auth()",u),new Error(u)}}function Un(s){return"useTokenAuth"in s&&!s.useTokenAuth}function Va(s){return s.useTokenAuth||!Un(s)&&(s.authCallback||s.authUrl||s.token||s.tokenDetails)}function Wc(s){return!s.key&&!s.authCallback&&!s.authUrl}var Hc=0;function Si(){return Hc++}var Rs=class{constructor(s,o){if(this.authOptions={},this.client=s,this.tokenParams=o.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,Va(o))Wc(o)&&k.logAction(this.logger,k.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(o.defaultTokenParams,o),Fa(this.authOptions,this.logger);else{if(!o.key){const u="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw k.logAction(this.logger,k.LOG_ERROR,"Auth()",u),new K(u,40160,401)}k.logAction(this.logger,k.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(o)}}get logger(){return this.client.logger}async authorize(s,o){if(o&&o.key&&this.authOptions.key!==o.key)throw new K("Unable to update auth options with incompatible key",40102,401);try{let u=await this._forceNewToken(s??null,o??null);return Ts(this.client)?new Promise((p,_)=>{this.client.connection.connectionManager.onAuthUpdated(u,(S,P)=>S?_(S):p(P))}):u}catch(u){throw this.client.connection&&u.statusCode===wi.Forbidden&&this.client.connection.connectionManager.actOnErrorFromAuthorize(u),u}}async _forceNewToken(s,o){this.tokenDetails=null,this._saveTokenOptions(s,o),Fa(this.authOptions,this.logger);try{return this._ensureValidAuthCredentials(!0)}finally{delete this.tokenParams.timestamp,delete this.authOptions.queryTime}}async requestToken(s,o){const u=o||this.authOptions,p=s||he(this.tokenParams);let _,S=this.client;if(u.authCallback)k.logAction(this.logger,k.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),_=u.authCallback;else if(u.authUrl)k.logAction(this.logger,k.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),_=(U,X)=>{const Q=be({accept:"application/json, text/plain"},u.authHeaders),de=u.authMethod&&u.authMethod.toLowerCase()==="post";let ce;const Se=u.authUrl.indexOf("?");Se>-1&&(ce=en(u.authUrl.slice(Se)),u.authUrl=u.authUrl.slice(0,Se),de||(u.authParams=be(ce,u.authParams)));const ue=be({},u.authParams||{},U),Te=Re=>{var De,lt;let ft=(De=Re.body)!=null?De:null,We=null;if(Re.error)k.logAction(this.logger,k.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+Ze(Re.error));else{const qt=(lt=Re.headers["content-type"])!=null?lt:null;Array.isArray(qt)?We=qt.join(", "):We=qt,k.logAction(this.logger,k.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+We+"; body: "+jn(ft))}if(Re.error){X(Re.error,null);return}if(Re.unpacked){X(null,ft);return}if(L.BufferUtils.isBuffer(ft)&&(ft=ft.toString()),!We){X(new K("authUrl response is missing a content-type header",40170,401),null);return}const He=We.indexOf("application/json")>-1,fn=We.indexOf("text/plain")>-1||We.indexOf("application/jwt")>-1;if(!He&&!fn){X(new K("authUrl responded with unacceptable content-type "+We+", should be either text/plain, application/jwt or application/json",40170,401),null);return}if(He){if(ft.length>Os){X(new K("authUrl response exceeded max permitted length",40170,401),null);return}try{ft=JSON.parse(ft)}catch(qt){X(new K("Unexpected error processing authURL response; err = "+qt.message,40170,401),null);return}}X(null,ft,We)};if(k.logAction(this.logger,k.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+u.authUrl+"; Params: "+JSON.stringify(ue)+"; method: "+(de?"POST":"GET")),de){const Re=Q||{};Re["content-type"]="application/x-www-form-urlencoded";const De=At(ue).slice(1);Nt(this.client.http.doUri(Ot.Post,u.authUrl,Re,De,ce),(lt,ft)=>Te(lt||ft))}else Nt(this.client.http.doUri(Ot.Get,u.authUrl,Q||{},null,ue),(Re,De)=>Te(Re||De))};else if(u.key)k.logAction(this.logger,k.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),_=(U,X)=>{Nt(this.createTokenRequest(U,u),(Q,de)=>X(Q,de??null))};else{const U="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";throw k.logAction(this.logger,k.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),new K(U,40171,403)}"capability"in p&&(p.capability=Dn(p.capability));const P=(U,X)=>{const Q=U.keyName,de="/keys/"+Q+"/requestToken",ce=function(ue){return S.baseUri(ue)+de},Se=qe.defaultPostHeaders(this.client.options);u.requestHeaders&&be(Se,u.requestHeaders),k.logAction(this.logger,k.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+de+"; Token params: "+JSON.stringify(U)),Nt(this.client.http.do(Ot.Post,ce,Se,JSON.stringify(U),null),(ue,Te)=>ue?X(ue):X(Te.error,Te.body,Te.unpacked))};return new Promise((U,X)=>{let Q=!1,de=this.client.options.timeouts.realtimeRequestTimeout,ce=setTimeout(()=>{Q=!0;const Se="Token request callback timed out after "+de/1e3+" seconds";k.logAction(this.logger,k.LOG_ERROR,"Auth.requestToken()",Se),X(new K(Se,40170,401))},de);_(p,(Se,ue,Te)=>{if(Q)return;if(clearTimeout(ce),Se){k.logAction(this.logger,k.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+Ze(Se)),X(Uo(Se));return}if(typeof ue=="string"){ue.length===0?X(new K("Token string is empty",40170,401)):ue.length>Os?X(new K("Token string exceeded max permitted length (was "+ue.length+" bytes)",40170,401)):ue==="undefined"||ue==="null"?X(new K("Token string was literal null/undefined",40170,401)):ue[0]==="{"&&!(Te&&Te.indexOf("application/jwt")>-1)?X(new K("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):U({token:ue});return}if(typeof ue!="object"||ue===null){const De="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof ue;k.logAction(this.logger,k.LOG_ERROR,"Auth.requestToken()",De),X(new K(De,40170,401));return}const Re=JSON.stringify(ue).length;if(Re>Os&&!u.suppressMaxLengthCheck){X(new K("Token request/details object exceeded max permitted stringified size (was "+Re+" bytes)",40170,401));return}if("issued"in ue){U(ue);return}if(!("keyName"in ue)){const De="Expected token request callback to call back with a token string, token request object, or token details object";k.logAction(this.logger,k.LOG_ERROR,"Auth.requestToken()",De),X(new K(De,40170,401));return}P(ue,(De,lt,ft)=>{if(De){k.logAction(this.logger,k.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+Ze(De)),X(Uo(De));return}ft||(lt=JSON.parse(lt)),k.logAction(this.logger,k.LOG_MINOR,"Auth.getToken()","token received"),U(lt)})})})}async createTokenRequest(s,o){o=o||this.authOptions,s=s||he(this.tokenParams);const u=o.key;if(!u)throw new K("No key specified",40101,403);const p=u.split(":"),_=p[0],S=p[1];if(!S)throw new K("Invalid key specified",40101,403);if(s.clientId==="")throw new K("clientId cant be an empty string",40012,400);"capability"in s&&(s.capability=Dn(s.capability));const P=be({keyName:_},s),U=s.clientId||"",X=s.ttl||"",Q=s.capability||"";P.timestamp||(P.timestamp=await this._getTimestamp(o&&o.queryTime));const de=P.nonce||(P.nonce=Gi()),ce=P.timestamp,Se=P.keyName+`
`+X+`
`+Q+`
`+U+`
`+ce+`
`+de+`
`;return P.mac=P.mac||bi(Se,S),k.logAction(this.logger,k.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),P}async getAuthParams(){if(this.method=="basic")return{key:this.key};{let s=await this._ensureValidAuthCredentials(!1);if(!s)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");return{access_token:s.token}}}async getAuthHeaders(){if(this.method=="basic")return{authorization:"Basic "+this.basicKey};{const s=await this._ensureValidAuthCredentials(!1);if(!s)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");return{authorization:"Bearer "+Kn(s.token)}}}_saveBasicOptions(s){this.method="basic",this.key=s.key,this.basicKey=Kn(s.key),this.authOptions=s||{},"clientId"in s&&this._userSetClientId(s.clientId)}_saveTokenOptions(s,o){this.method="token",s&&(this.tokenParams=s),o&&(o.token&&(o.tokenDetails=typeof o.token=="string"?{token:o.token}:o.token),o.tokenDetails&&(this.tokenDetails=o.tokenDetails),"clientId"in o&&this._userSetClientId(o.clientId),this.authOptions=o)}async _ensureValidAuthCredentials(s){const o=this.tokenDetails;if(o){if(this._tokenClientIdMismatch(o.clientId))throw new K("Mismatch between clientId in token ("+o.clientId+") and current clientId ("+this.clientId+")",40102,403);if(!this.client.isTimeOffsetSet()||!o.expires||o.expires>=this.client.getTimestampUsingOffset())return k.logAction(this.logger,k.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+o.expires),o;k.logAction(this.logger,k.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}const u=(this.waitingForTokenRequest||(this.waitingForTokenRequest=hr.create(this.logger))).createPromise();if(this.currentTokenRequestId!==null&&!s)return u;const p=this.currentTokenRequestId=Si();let _,S=null;try{_=await this.requestToken(this.tokenParams,this.authOptions)}catch(U){S=U}if(this.currentTokenRequestId>p)return k.logAction(this.logger,k.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one"),u;this.currentTokenRequestId=null;const P=this.waitingForTokenRequest;return this.waitingForTokenRequest=null,S?(P?.rejectAll(S),u):(P?.resolveAll(this.tokenDetails=_),u)}_userSetClientId(s){if(typeof s=="string"||s===null){if(s==="*")throw new K('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);{const o=this._uncheckedSetClientId(s);if(o)throw o}}else throw new K("clientId must be either a string or null",40012,400)}_uncheckedSetClientId(s){if(this._tokenClientIdMismatch(s)){const o="Unexpected clientId mismatch: client has "+this.clientId+", requested "+s,u=new K(o,40102,401);return k.logAction(this.logger,k.LOG_ERROR,"Auth._uncheckedSetClientId()",o),u}else return this.clientId=this.tokenParams.clientId=s,null}_tokenClientIdMismatch(s){return!!(this.clientId&&this.clientId!=="*"&&s&&s!=="*"&&this.clientId!==s)}static isTokenErr(s){return s.code&&s.code>=40140&&s.code<40150}revokeTokens(s,o){return this.client.rest.revokeTokens(s,o)}async _getTimestamp(s){return this.client.getTimestamp(s||!!this.authOptions.queryTime)}},ln=Rs;function ki(s){const o=[];if(s)for(const u in s)o.push(u+"="+s[u]);return o.join("&")}function Ci(s,o){return s+(o?"?":"")+ki(o)}function Gc(s,o,u,p,_){s.error?k.logActionNoStrip(_,k.LOG_MICRO,"Http."+o+"()","Received Error; "+Ci(u,p)+"; Error: "+Ze(s.error)):k.logActionNoStrip(_,k.LOG_MICRO,"Http."+o+"()","Received; "+Ci(u,p)+"; Headers: "+ki(s.headers)+"; StatusCode: "+s.statusCode+"; Body"+(L.BufferUtils.isBuffer(s.body)?" (Base64): "+L.BufferUtils.base64Encode(s.body):": "+s.body))}function Bo(s,o,u,p,_){_.shouldLog(k.LOG_MICRO)&&k.logActionNoStrip(_,k.LOG_MICRO,"Http."+s+"()","Sending; "+Ci(o,p)+"; Body"+(L.BufferUtils.isBuffer(u)?" (Base64): "+L.BufferUtils.base64Encode(u):": "+u))}var As=class{constructor(s){this.client=s,this.platformHttp=new L.Http(s),this.checkConnectivity=this.platformHttp.checkConnectivity?()=>this.platformHttp.checkConnectivity():void 0}get logger(){var s,o;return(o=(s=this.client)==null?void 0:s.logger)!=null?o:k.defaultLogger}get supportsAuthHeaders(){return this.platformHttp.supportsAuthHeaders}get supportsLinkHeaders(){return this.platformHttp.supportsLinkHeaders}_getHosts(s){const o=s.connection,u=o&&o.connectionManager.host;return u?[u].concat(qe.getFallbackHosts(s.options)):qe.getHosts(s.options)}async do(s,o,u,p,_){try{const S=this.client;if(!S)return{error:new K("http.do called without client",5e4,500)};const P=typeof o=="function"?o:function(ce){return S.baseUri(ce)+o},U=S._currentFallback;if(U)if(U.validUntil>Date.now()){const ce=await this.doUri(s,P(U.host),u,p,_);return ce.error&&this.platformHttp.shouldFallback(ce.error)?(S._currentFallback=null,this.do(s,o,u,p,_)):ce}else S._currentFallback=null;const X=this._getHosts(S);if(X.length===1)return this.doUri(s,P(X[0]),u,p,_);let Q=null;const de=async(ce,Se)=>{const ue=ce.shift();Q=Q??new Date;const Te=await this.doUri(s,P(ue),u,p,_);return Te.error&&this.platformHttp.shouldFallback(Te.error)&&ce.length?Date.now()-Q.getTime()>S.options.timeouts.httpMaxRetryDuration?{error:new K(`Timeout for trying fallback hosts retries. Total elapsed time exceeded the ${S.options.timeouts.httpMaxRetryDuration}ms limit`,50003,500)}:de(ce,!0):(Se&&(S._currentFallback={host:ue,validUntil:Date.now()+S.options.timeouts.fallbackRetryTimeout}),Te)};return de(X)}catch(S){return{error:new K(`Unexpected error in Http.do: ${Ze(S)}`,500,5e4)}}}async doUri(s,o,u,p,_){try{Bo(s,o,p,_,this.logger);const S=await this.platformHttp.doUri(s,o,u,p,_);return this.logger.shouldLog(k.LOG_MICRO)&&Gc(S,s,o,_,this.logger),S}catch(S){return{error:new K(`Unexpected error in Http.doUri: ${Ze(S)}`,500,5e4)}}}};function Ps(s,o,u,p){try{u.apply(o,p)}catch(_){k.logAction(s,k.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+_+"; stack = "+(_&&_.stack))}}function Gr(s,o,u){let p,_,S;for(let P=0;P<s.length;P++)if(p=s[P],u&&(p=p[u]),Array.isArray(p)){for(;(_=p.indexOf(o))!==-1;)p.splice(_,1);u&&p.length===0&&delete s[P][u]}else if(oe(p))for(S in p)Object.prototype.hasOwnProperty.call(p,S)&&Array.isArray(p[S])&&Gr([p],o,S)}var Jc=class{constructor(s){this.logger=s,this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}on(...s){if(s.length===1){const o=s[0];if(typeof o=="function")this.any.push(o);else throw new Error("EventListener.on(): Invalid arguments: "+L.Config.inspect(s))}if(s.length===2){const[o,u]=s;if(typeof u!="function")throw new Error("EventListener.on(): Invalid arguments: "+L.Config.inspect(s));if(le(o))this.any.push(u);else if(Array.isArray(o))o.forEach(p=>{this.on(p,u)});else{if(typeof o!="string")throw new Error("EventListener.on(): Invalid arguments: "+L.Config.inspect(s));(this.events[o]||(this.events[o]=[])).push(u)}}}off(...s){if(s.length==0||le(s[0])&&le(s[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}const[o,u]=s;let p=null,_=null;if(s.length===1||!u)typeof o=="function"?p=o:_=o;else{if(typeof u!="function")throw new Error("EventEmitter.off(): invalid arguments:"+L.Config.inspect(s));[_,p]=[o,u]}if(p&&le(_)){Gr([this.any,this.events,this.anyOnce,this.eventsOnce],p);return}if(Array.isArray(_)){_.forEach(S=>{this.off(S,p)});return}if(typeof _!="string")throw new Error("EventEmitter.off(): invalid arguments:"+L.Config.inspect(s));p?Gr([this.events,this.eventsOnce],p,_):(delete this.events[_],delete this.eventsOnce[_])}listeners(s){if(s){const o=this.events[s]||[];return this.eventsOnce[s]&&Array.prototype.push.apply(o,this.eventsOnce[s]),o.length?o:null}return this.any.length?this.any:null}emit(s,...o){const u={event:s},p=[];this.anyOnce.length&&(Array.prototype.push.apply(p,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(p,this.any);const _=this.eventsOnce[s];_&&(Array.prototype.push.apply(p,_),delete this.eventsOnce[s]);const S=this.events[s];S&&Array.prototype.push.apply(p,S),p.forEach(P=>{Ps(this.logger,u,P,o)})}once(...s){const o=s.length;if(o===0||o===1&&typeof s[0]!="function"){const _=s[0];return new Promise(S=>{this.once(_,S)})}const[u,p]=s;if(s.length===1&&typeof u=="function")this.anyOnce.push(u);else if(le(u)){if(typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+L.Config.inspect(s));this.anyOnce.push(p)}else if(Array.isArray(u)){const _=this,S=function(){const P=Array.prototype.slice.call(arguments);if(u.forEach(function(U){_.off(U,S)}),typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+L.Config.inspect(s));p.apply(this,P)};u.forEach(function(P){_.on(P,S)})}else{if(typeof u!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+L.Config.inspect(s));const _=this.eventsOnce[u]||(this.eventsOnce[u]=[]);if(p){if(typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+L.Config.inspect(s));_.push(p)}}}async whenState(s,o){if(typeof s!="string"||typeof o!="string")throw new Error("whenState requires a valid state String argument");return s===o?null:this.once(s)}},St=Jc,we={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18,OBJECT:19,OBJECT_SYNC:20,ANNOTATION:21},Is=[];Object.keys(we).forEach(function(s){Is[we[s]]=s});var Tt={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,HAS_OBJECTS:128,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19,ANNOTATION_PUBLISH:1<<21,ANNOTATION_SUBSCRIBE:1<<22,OBJECT_SUBSCRIBE:1<<24,OBJECT_PUBLISH:1<<25},Fo=Object.keys(Tt);Tt.MODE_ALL=Tt.PRESENCE|Tt.PUBLISH|Tt.SUBSCRIBE|Tt.PRESENCE_SUBSCRIBE|Tt.ANNOTATION_PUBLISH|Tt.ANNOTATION_SUBSCRIBE|Tt.OBJECT_SUBSCRIBE|Tt.OBJECT_PUBLISH;var Vo=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE","ANNOTATION_PUBLISH","ANNOTATION_SUBSCRIBE","OBJECT_SUBSCRIBE","OBJECT_PUBLISH"];function za(s){return!s||!s.channelOptions?{channelOptions:s,plugins:{},baseEncodedPreviousPayload:void 0}:s}function zo(s,o,u){if(u&&u.cipher){s||bt("Crypto");const p=s.getCipher(u.cipher,o);return{cipher:p.cipherParams,channelCipher:p.cipher}}return u??{}}async function $o(s,o){const{data:u,encoding:p}=await Ji(s.data,s.encoding,o);return s.data=u,s.encoding=p,s}async function Ji(s,o,u){let p=u.channelCipher,_=s,S=o?o+"/":"";L.BufferUtils.isBuffer(_)||(_=L.BufferUtils.utf8Encode(String(_)),S=S+"utf-8/");const P=await p.encrypt(_);return S=S+"cipher+"+p.algorithm,{data:P,encoding:S}}async function Bn(s,o){const{data:u,encoding:p}=Qt(s.data,s.encoding);return s.data=u,s.encoding=p,o!=null&&o.cipher?$o(s,o):s}function Qt(s,o){if(typeof s=="string"||L.BufferUtils.isBuffer(s)||s===null||s===void 0)return{data:s,encoding:o};if(oe(s)||Array.isArray(s))return{data:JSON.stringify(s),encoding:o?o+"/json":"json"};throw new K("Data type is unsupported",40013,400)}async function Xn(s,o){const{data:u,encoding:p,error:_}=await Jr(s.data,s.encoding,o);if(s.data=u,s.encoding=p,_)throw _}async function Jr(s,o,u){const p=za(u);let _=s,S=s,P=o,U;if(o){const X=o.split("/");let Q,de=X.length,ce="";try{for(;(Q=de)>0;){const Se=X[--de].match(/([-\w]+)(\+([\w-]+))?/);if(!Se)break;switch(ce=Se[1],ce){case"base64":S=L.BufferUtils.base64Decode(String(S)),Q==X.length&&(_=S);continue;case"utf-8":S=L.BufferUtils.utf8Decode(S);continue;case"json":S=JSON.parse(S);continue;case"cipher":if(p.channelOptions!=null&&p.channelOptions.cipher&&p.channelOptions.channelCipher){const ue=Se[3],Te=p.channelOptions.channelCipher;if(ue!=Te.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");S=await Te.decrypt(S);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!p.plugins||!p.plugins.vcdiff)throw new K("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new K("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{let ue=p.baseEncodedPreviousPayload;typeof ue=="string"&&(ue=L.BufferUtils.utf8Encode(ue));const Te=L.BufferUtils.toBuffer(ue);S=L.BufferUtils.toBuffer(S),S=L.BufferUtils.arrayBufferViewToBuffer(p.plugins.vcdiff.decode(S,Te)),_=S}catch(ue){throw new K("Vcdiff delta decode failed with "+ue,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(Se){const ue=Se;U=new K(`Error processing the ${ce} encoding, decoder returned ${ue.message}`,ue.code||40013,400)}finally{P=Q<=0?null:X.slice(0,Q).join("/")}}return U?{error:U,data:S,encoding:P}:(p.baseEncodedPreviousPayload=_,{data:S,encoding:P})}function Qr(...s){const o=s.length>0?"json":"msgpack",{data:u,encoding:p}=Fn(this.data,this.encoding,o);return Object.assign({},this,{encoding:p,data:u})}function Fn(s,o,u){return!s||!L.BufferUtils.isBuffer(s)?{data:s,encoding:o}:u==="msgpack"?{data:L.BufferUtils.toBuffer(s),encoding:o}:{data:L.BufferUtils.base64Encode(s),encoding:o?o+"/base64":"base64"}}var Qi={encryptData:Ji,encodeData:Qt,encodeDataForWire:Fn,decodeData:Jr};function Ki(s){const{id:o,connectionId:u,timestamp:p}=s;let _;switch(s.action){case we.MESSAGE:{_=s.messages;break}case we.PRESENCE:case we.SYNC:_=s.presence;break;case we.ANNOTATION:_=s.annotations;break;case we.OBJECT:case we.OBJECT_SYNC:_=s.state;break;default:throw new K("Unexpected action "+s.action,4e4,400)}for(let S=0;S<_.length;S++){const P=_[S];P.connectionId||(P.connectionId=u),P.timestamp||(P.timestamp=p),o&&!P.id&&(P.id=o+":"+S)}}function Zn(s,o){let u="["+o;for(const p in s)p==="data"?typeof s.data=="string"?u+="; data="+s.data:L.BufferUtils.isBuffer(s.data)?u+="; data (buffer)="+L.BufferUtils.base64Encode(s.data):typeof s.data<"u"&&(u+="; data (json)="+JSON.stringify(s.data)):p&&(p==="extras"||p==="operation")?u+="; "+p+"="+JSON.stringify(s[p]):p==="version"?u+="; version="+JSON.stringify(s[p]):p==="annotations"?u+="; annotations="+JSON.stringify(s[p]):s[p]!==void 0&&(u+="; "+p+"="+s[p]);return u+="]",u}var Kr=class{},qo=class{constructor(s){this.Platform=L,this.ErrorInfo=K,this.Logger=k,this.Defaults=qe,this.Utils=ze,this.EventEmitter=St,this.MessageEncoding=Qi;var o,u,p,_,S,P,U,X,Q,de;this._additionalHTTPRequestImplementations=(o=s.plugins)!=null?o:null,this.logger=new k,this.logger.setLog(s.logLevel,s.logHandler),k.logAction(this.logger,k.LOG_MICRO,"BaseClient()","initialized with clientOptions "+L.Config.inspect(s)),this._MsgPack=(p=(u=s.plugins)==null?void 0:u.MsgPack)!=null?p:null;const ce=this.options=qe.normaliseOptions(s,this._MsgPack,this.logger);if(ce.key){const Se=ce.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!Se){const ue="invalid key parameter";throw k.logAction(this.logger,k.LOG_ERROR,"BaseClient()",ue),new K(ue,40400,404)}ce.keyName=Se[1],ce.keySecret=Se[2]}if("clientId"in ce)if(typeof ce.clientId=="string"||ce.clientId===null){if(ce.clientId==="*")throw new K('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new K("clientId must be either a string or null",40012,400);k.logAction(this.logger,k.LOG_MINOR,"BaseClient()","started; version = "+qe.version),this._currentFallback=null,this.serverTimeOffset=null,this.http=new As(this),this.auth=new ln(this,ce),this._rest=(_=s.plugins)!=null&&_.Rest?new s.plugins.Rest(this):null,this._Crypto=(P=(S=s.plugins)==null?void 0:S.Crypto)!=null?P:null,this.__FilteredSubscriptions=(X=(U=s.plugins)==null?void 0:U.MessageInteractions)!=null?X:null,this._Annotations=(de=(Q=s.plugins)==null?void 0:Q.Annotations)!=null?de:null}get rest(){return this._rest||bt("Rest"),this._rest}get _FilteredSubscriptions(){return this.__FilteredSubscriptions||bt("MessageInteractions"),this.__FilteredSubscriptions}get channels(){return this.rest.channels}get push(){return this.rest.push}device(){var s;return(!((s=this.options.plugins)!=null&&s.Push)||!this.push.LocalDevice)&&bt("Push"),this._device||(this._device=this.push.LocalDevice.load(this)),this._device}baseUri(s){return qe.getHttpScheme(this.options)+s+":"+qe.getPort(this.options,!1)}async stats(s){return this.rest.stats(s)}async time(s){return this.rest.time(s)}async request(s,o,u,p,_,S){return this.rest.request(s,o,u,p,_,S)}batchPublish(s){return this.rest.batchPublish(s)}batchPresence(s){return this.rest.batchPresence(s)}setLog(s){this.logger.setLog(s.level,s.handler)}async getTimestamp(s){return!this.isTimeOffsetSet()&&s?this.time():this.getTimestampUsingOffset()}getTimestampUsingOffset(){return Date.now()+(this.serverTimeOffset||0)}isTimeOffsetSet(){return this.serverTimeOffset!==null}};qo.Platform=L;var Rr=qo,$a=class mc{toJSON(){var o,u,p;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(o=this.push)==null?void 0:o.recipient,state:(u=this.push)==null?void 0:u.state,error:(p=this.push)==null?void 0:p.error}}}toString(){var o,u,p,_;let S="[DeviceDetails";return this.id&&(S+="; id="+this.id),this.platform&&(S+="; platform="+this.platform),this.formFactor&&(S+="; formFactor="+this.formFactor),this.clientId&&(S+="; clientId="+this.clientId),this.metadata&&(S+="; metadata="+this.metadata),this.deviceIdentityToken&&(S+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),(o=this.push)!=null&&o.recipient&&(S+="; push.recipient="+JSON.stringify(this.push.recipient)),(u=this.push)!=null&&u.state&&(S+="; push.state="+this.push.state),(p=this.push)!=null&&p.error&&(S+="; push.error="+JSON.stringify(this.push.error)),(_=this.push)!=null&&_.metadata&&(S+="; push.metadata="+this.push.metadata),S+="]",S}static toRequestBody(o,u,p){return cn(o,u,p)}static fromResponseBody(o,u,p){return p&&(o=Dt(o,u,p)),Array.isArray(o)?mc.fromValuesArray(o):mc.fromValues(o)}static fromValues(o){return o.error=o.error&&K.fromValues(o.error),Object.assign(new mc,o)}static fromLocalDevice(o){return Object.assign(new mc,o)}static fromValuesArray(o){const u=o.length,p=new Array(u);for(let _=0;_<u;_++)p[_]=mc.fromValues(o[_]);return p}},Ar=$a;async function Ei(s,o,u,p){if(s.http.supportsAuthHeaders){const _=await s.auth.getAuthHeaders();return p(be(_,o),u)}else{const _=await s.auth.getAuthParams();return p(o,be(_,u))}}function Yi(s,o,u){if(s.err&&!s.body)return{err:s.err};if(s.statusCode===wi.NoContent)return A(I({},s),{body:[],unpacked:!0});let p=s.body;if(!s.unpacked)try{p=Dt(p,o,u)}catch(U){return zt(U)?{err:U}:{err:new Ue(Ze(U),null)}}if(!p)return{err:new Ue("unenvelope(): Response body is missing",null)};const{statusCode:_,response:S,headers:P}=p;if(_===void 0)return A(I({},s),{body:p,unpacked:!0});if(_<200||_>=300){let U=S&&S.error||s.err;return U||(U=new Error("Error in unenveloping "+p),U.statusCode=_),{err:U,body:S,headers:P,unpacked:!0,statusCode:_}}return{err:s.err,body:S,headers:P,unpacked:!0,statusCode:_}}function x(s,o,u,p,_){s.err?k.logAction(_,k.LOG_MICRO,"Resource."+o+"()","Received Error; "+Ci(u,p)+"; Error: "+Ze(s.err)):k.logAction(_,k.LOG_MICRO,"Resource."+o+"()","Received; "+Ci(u,p)+"; Headers: "+ki(s.headers)+"; StatusCode: "+s.statusCode+"; Body: "+(L.BufferUtils.isBuffer(s.body)?" (Base64): "+L.BufferUtils.base64Encode(s.body):": "+L.Config.inspect(s.body)))}var te=class vc{static async get(o,u,p,_,S,P){return vc.do(Ot.Get,o,u,null,p,_,S,P??!1)}static async delete(o,u,p,_,S,P){return vc.do(Ot.Delete,o,u,null,p,_,S,P)}static async post(o,u,p,_,S,P,U){return vc.do(Ot.Post,o,u,p,_,S,P,U)}static async patch(o,u,p,_,S,P,U){return vc.do(Ot.Patch,o,u,p,_,S,P,U)}static async put(o,u,p,_,S,P,U){return vc.do(Ot.Put,o,u,p,_,S,P,U)}static async do(o,u,p,_,S,P,U,X){U&&((P=P||{}).envelope=U);const Q=u.logger;async function de(Se,ue){var Te;if(Q.shouldLog(k.LOG_MICRO)){let De=_;if(((Te=Se["content-type"])==null?void 0:Te.indexOf("msgpack"))>0)try{u._MsgPack||bt("MsgPack"),De=u._MsgPack.decode(_)}catch(lt){k.logAction(Q,k.LOG_MICRO,"Resource."+o+"()","Sending MsgPack Decoding Error: "+Ze(lt))}k.logAction(Q,k.LOG_MICRO,"Resource."+o+"()","Sending; "+Ci(p,ue)+"; Body: "+De)}const Re=await u.http.do(o,p,Se,_,ue);return Re.error&&ln.isTokenErr(Re.error)?(await u.auth.authorize(null,null),Ei(u,Se,ue,de)):{err:Re.error,body:Re.body,headers:Re.headers,unpacked:Re.unpacked,statusCode:Re.statusCode}}let ce=await Ei(u,S,P,de);if(U&&(ce=Yi(ce,u._MsgPack,U)),Q.shouldLog(k.LOG_MICRO)&&x(ce,o,p,P,Q),X){if(ce.err)throw ce.err;{const Se=I({},ce);return delete Se.err,Se}}return ce}},se=te;function xe(s){const o=s.match(/^\.\/(\w+)\?(.*)$/);return o&&o[2]&&en(o[2])}function Pt(s){typeof s=="string"&&(s=s.split(","));const o={};for(let u=0;u<s.length;u++){const p=s[u].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(p){const _=xe(p[1]);_&&(o[p[2]]=_)}}return o}function Ut(s,o,u){return!(u&&(o||typeof s.code=="number"))}var Vn=class{constructor(s,o,u,p,_,S){this.client=s,this.path=o,this.headers=u,this.envelope=p??null,this.bodyHandler=_,this.useHttpPaginatedResponse=S||!1}get logger(){return this.client.logger}async get(s){const o=await se.get(this.client,this.path,this.headers,s,this.envelope,!1);return this.handlePage(o)}async delete(s){const o=await se.delete(this.client,this.path,this.headers,s,this.envelope,!1);return this.handlePage(o)}async post(s,o){const u=await se.post(this.client,this.path,o,this.headers,s,this.envelope,!1);return this.handlePage(u)}async put(s,o){const u=await se.put(this.client,this.path,o,this.headers,s,this.envelope,!1);return this.handlePage(u)}async patch(s,o){const u=await se.patch(this.client,this.path,o,this.headers,s,this.envelope,!1);return this.handlePage(u)}async handlePage(s){if(s.err&&Ut(s.err,s.body,this.useHttpPaginatedResponse))throw k.logAction(this.logger,k.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+Ze(s.err)),s.err;let o,u,p;try{o=s.statusCode==wi.NoContent?[]:await this.bodyHandler(s.body,s.headers||{},s.unpacked)}catch(_){throw s.err||_}return s.headers&&(u=s.headers.Link||s.headers.link)&&(p=Pt(u)),this.useHttpPaginatedResponse?new pr(this,o,s.headers||{},s.statusCode,p,s.err):new $t(this,o,p)}},$t=class{constructor(s,o,u){this.resource=s,this.items=o,this._relParams=u}async first(){if(this.hasFirst())return this.get(this._relParams.first);throw new K("No link to the first page of results",40400,404)}async current(){if(this.hasCurrent())return this.get(this._relParams.current);throw new K("No link to the current page of results",40400,404)}async next(){return this.hasNext()?this.get(this._relParams.next):null}hasFirst(){return this._relParams!=null&&"first"in this._relParams}hasCurrent(){return this._relParams!=null&&"current"in this._relParams}hasNext(){return this._relParams!=null&&"next"in this._relParams}isLast(){return!this.hasNext()}async get(s){const o=this.resource,u=await se.get(o.client,o.path,o.headers,s,o.envelope,!1);return o.handlePage(u)}},pr=class extends $t{constructor(s,o,u,p,_,S){super(s,o,_),this.statusCode=p,this.success=p<300&&p>=200,this.headers=u,this.errorCode=S&&S.code,this.errorMessage=S&&S.message}toJSON(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}}},Bt=Vn,Mi=class zl{toJSON(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}}toString(){let o="[PushChannelSubscription";return this.channel&&(o+="; channel="+this.channel),this.deviceId&&(o+="; deviceId="+this.deviceId),this.clientId&&(o+="; clientId="+this.clientId),o+="]",o}static fromResponseBody(o,u,p){return p&&(o=Dt(o,u,p)),Array.isArray(o)?zl.fromValuesArray(o):zl.fromValues(o)}static fromValues(o){return Object.assign(new zl,o)}static fromValuesArray(o){const u=o.length,p=new Array(u);for(let _=0;_<u;_++)p[_]=zl.fromValues(o[_]);return p}};Mi.toRequestBody=cn;var Wo=Mi,Pr=Wo,Oi=class{constructor(s){var o;this.client=s,this.admin=new Xi(s),L.Config.push&&((o=s.options.plugins)!=null&&o.Push)&&(this.stateMachine=new s.options.plugins.Push.ActivationStateMachine(s),this.LocalDevice=s.options.plugins.Push.localDeviceFactory(Ar))}async activate(s,o){await new Promise((u,p)=>{var _;if(!((_=this.client.options.plugins)!=null&&_.Push)){p(Or("Push"));return}if(!this.stateMachine){p(new K("This platform is not supported as a target of push notifications",4e4,400));return}if(this.stateMachine.activatedCallback){p(new K("Activation already in progress",4e4,400));return}this.stateMachine.activatedCallback=S=>{if(S){p(S);return}u()},this.stateMachine.updateFailedCallback=o,this.stateMachine.handleEvent(new this.client.options.plugins.Push.CalledActivate(this.stateMachine,s))})}async deactivate(s){await new Promise((o,u)=>{var p;if(!((p=this.client.options.plugins)!=null&&p.Push)){u(Or("Push"));return}if(!this.stateMachine){u(new K("This platform is not supported as a target of push notifications",4e4,400));return}if(this.stateMachine.deactivatedCallback){u(new K("Deactivation already in progress",4e4,400));return}this.stateMachine.deactivatedCallback=_=>{if(_){u(_);return}o()},this.stateMachine.handleEvent(new this.client.options.plugins.Push.CalledDeactivate(this.stateMachine,s))})}},Xi=class{constructor(s){this.client=s,this.deviceRegistrations=new zn(s),this.channelSubscriptions=new xs(s)}async publish(s,o){const u=this.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=qe.defaultPostHeaders(u.options,{format:p}),S={},P=be({recipient:s},o);be(_,u.options.headers),u.options.pushFullWait&&be(S,{fullWait:"true"});const U=cn(P,u._MsgPack,p);await se.post(u,"/push/publish",U,_,S,null,!0)}},zn=class{constructor(s){this.client=s}async save(s){const o=this.client,u=Ar.fromValues(s),p=o.options.useBinaryProtocol?"msgpack":"json",_=qe.defaultPostHeaders(o.options,{format:p}),S={};be(_,o.options.headers),o.options.pushFullWait&&be(S,{fullWait:"true"});const P=cn(u,o._MsgPack,p),U=await se.put(o,"/push/deviceRegistrations/"+encodeURIComponent(s.id),P,_,S,null,!0);return Ar.fromResponseBody(U.body,o._MsgPack,U.unpacked?void 0:p)}async get(s){const o=this.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=qe.defaultGetHeaders(o.options,{format:u}),_=s.id||s;if(typeof _!="string"||!_.length)throw new K("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400);be(p,o.options.headers);const S=await se.get(o,"/push/deviceRegistrations/"+encodeURIComponent(_),p,{},null,!0);return Ar.fromResponseBody(S.body,o._MsgPack,S.unpacked?void 0:u)}async list(s){const o=this.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=this.client.http.supportsLinkHeaders?void 0:u,_=qe.defaultGetHeaders(o.options,{format:u});return be(_,o.options.headers),new Bt(o,"/push/deviceRegistrations",_,p,async function(S,P,U){return Ar.fromResponseBody(S,o._MsgPack,U?void 0:u)}).get(s)}async remove(s){const o=this.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=qe.defaultGetHeaders(o.options,{format:u}),_={},S=s.id||s;if(typeof S!="string"||!S.length)throw new K("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400);be(p,o.options.headers),o.options.pushFullWait&&be(_,{fullWait:"true"}),await se.delete(o,"/push/deviceRegistrations/"+encodeURIComponent(S),p,_,null,!0)}async removeWhere(s){const o=this.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=qe.defaultGetHeaders(o.options,{format:u});be(p,o.options.headers),o.options.pushFullWait&&be(s,{fullWait:"true"}),await se.delete(o,"/push/deviceRegistrations",p,s,null,!0)}},xs=class J0{constructor(o){this.remove=J0.prototype.removeWhere,this.client=o}async save(o){const u=this.client,p=Pr.fromValues(o),_=u.options.useBinaryProtocol?"msgpack":"json",S=qe.defaultPostHeaders(u.options,{format:_}),P={};be(S,u.options.headers),u.options.pushFullWait&&be(P,{fullWait:"true"});const U=cn(p,u._MsgPack,_),X=await se.post(u,"/push/channelSubscriptions",U,S,P,null,!0);return Pr.fromResponseBody(X.body,u._MsgPack,X.unpacked?void 0:_)}async list(o){const u=this.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=this.client.http.supportsLinkHeaders?void 0:p,S=qe.defaultGetHeaders(u.options,{format:p});return be(S,u.options.headers),new Bt(u,"/push/channelSubscriptions",S,_,async function(P,U,X){return Pr.fromResponseBody(P,u._MsgPack,X?void 0:p)}).get(o)}async removeWhere(o){const u=this.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=qe.defaultGetHeaders(u.options,{format:p});be(_,u.options.headers),u.options.pushFullWait&&be(o,{fullWait:"true"}),await se.delete(u,"/push/channelSubscriptions",_,o,null,!0)}async listChannels(o){const u=this.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=this.client.http.supportsLinkHeaders?void 0:p,S=qe.defaultGetHeaders(u.options,{format:p});return be(S,u.options.headers),u.options.pushFullWait&&be(o,{fullWait:"true"}),new Bt(u,"/push/channels",S,_,async function(P,U,X){const Q=!X&&p?Dt(P,u._MsgPack,p):P;for(let de=0;de<Q.length;de++)Q[de]=String(Q[de]);return Q}).get(o)}},Qc=Oi,Ls=["absent","present","enter","leave","update"];async function id(s,o,u,p){const _=zo(o,s,p??null);return Ns.fromValues(u).decode(_,s)}async function Kc(s,o,u,p){return Promise.all(u.map(function(_){return id(s,o,_,p)}))}async function Yc(s,o){return Ns.fromValues(s).decode(o.channelOptions,o.logger)}async function js(s,o){return Promise.all(s.map(function(u){return Yc(u,o)}))}var Ho=class $l extends Kr{isSynthesized(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId}parseId(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");const o=this.id.split(":");return{connectionId:o[0],msgSerial:parseInt(o[1],10),index:parseInt(o[2],10)}}async encode(o){const u=Object.assign(new Ns,this,{action:Ls.indexOf(this.action||"present")});return Bn(u,o)}static fromValues(o){return Object.assign(new $l,o)}static fromValuesArray(o){return o.map(u=>$l.fromValues(u))}static fromData(o){return o instanceof $l?o:$l.fromValues({data:o})}toString(){return Zn(this,"PresenceMessage")}},Ns=class gg extends Kr{toJSON(...o){return Qr.call(this,...o)}static fromValues(o){return Object.assign(new gg,o)}static fromValuesArray(o){return o.map(u=>gg.fromValues(u))}async decode(o,u){const p=Object.assign(new Ho,A(I({},this),{action:Ls[this.action]}));try{await Xn(p,o)}catch(_){k.logAction(u,k.LOG_ERROR,"WirePresenceMessage.decode()",Ze(_))}return p}toString(){return Zn(this,"WirePresenceMessage")}},Ti=Ho,rp=class{constructor(s){this.channel=s}get logger(){return this.channel.logger}async get(s){k.logAction(this.logger,k.LOG_MICRO,"RestPresence.get()","channel = "+this.channel.name);const o=this.channel.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=this.channel.client.http.supportsLinkHeaders?void 0:u,_=qe.defaultGetHeaders(o.options,{format:u});return be(_,o.options.headers),new Bt(o,this.channel.client.rest.presenceMixin.basePath(this),_,p,async(S,P,U)=>{const X=U?S:Dt(S,o._MsgPack,u);return js(X,this.channel)}).get(s)}async history(s){return k.logAction(this.logger,k.LOG_MICRO,"RestPresence.history()","channel = "+this.channel.name),this.channel.client.rest.presenceMixin.history(this,s)}},ip=rp,qa=["message.create","message.update","message.delete","meta","message.summary"];function sp(s){return qa[s||0]||"unknown"}function op(s){let o=0;return s.name&&(o+=s.name.length),s.clientId&&(o+=s.clientId.length),s.extras&&(o+=JSON.stringify(s.extras).length),s.data&&(o+=Qn(s.data)),o}async function sd(s,o,u,p){const _=zo(o,s,p??null);return Zi.fromValues(u).decode(_,s)}async function ap(s,o,u,p){return Promise.all(u.map(function(_){return sd(s,o,_,p)}))}async function cp(s,o){return Zi.fromValues(s).decode(o.channelOptions,o.logger)}async function od(s,o){return Promise.all(s.map(function(u){return cp(u,o)}))}async function ad(s,o){return Promise.all(s.map(u=>u.encode(o)))}var lp=cn;function Xc(s){let o,u=0;for(let p=0;p<s.length;p++)o=s[p],u+=o.size||(o.size=op(o));return u}var cd=class mg extends Kr{expandFields(){if(this.version||(this.version={}),!this.version.serial&&this.serial&&(this.version.serial=this.serial),!this.version.timestamp&&this.timestamp&&(this.version.timestamp=this.timestamp),this.annotations?this.annotations.summary||(this.annotations.summary={}):this.annotations={summary:{}},this.annotations&&this.annotations.summary)for(const[o,u]of Object.entries(this.annotations.summary))if(o.endsWith(":distinct.v1")||o.endsWith(":unique.v1")||o.endsWith(":multiple.v1"))for(const[,p]of Object.entries(u))p.clipped||(p.clipped=!1);else o.endsWith(":flag.v1")&&(u.clipped||(u.clipped=!1))}async encode(o){const u=Object.assign(new Zi,this,{action:qa.indexOf(this.action||"message.create")});return Bn(u,o)}static fromValues(o){return Object.assign(new mg,o)}static fromValuesArray(o){return o.map(u=>mg.fromValues(u))}toString(){return Zn(this,"Message")}},Zi=class vg extends Kr{toJSON(...o){return Qr.call(this,...o)}static fromValues(o){return Object.assign(new vg,o)}static fromValuesArray(o){return o.map(u=>vg.fromValues(u))}async decodeWithErr(o,u){const p=Object.assign(new cd,A(I({},this),{action:sp(this.action)}));let _;try{await Xn(p,o)}catch(S){k.logAction(u,k.LOG_ERROR,"WireMessage.decode()",Ze(S)),_=S}return p.expandFields(),{decoded:p,err:_}}async decode(o,u){const{decoded:p}=await this.decodeWithErr(o,u);return p}toString(){return Zn(this,"WireMessage")}},Ri=cd,up=9;function dp(s){return s.every(function(o){return!o.id})}var ld=class{constructor(s,o,u){this._annotations=null;var p,_;k.logAction(s.logger,k.LOG_MINOR,"RestChannel()","started; name = "+o),this.name=o,this.client=s,this.presence=new ip(this),this.channelOptions=Ms((p=s._Crypto)!=null?p:null,this.logger,u),(_=s.options.plugins)!=null&&_.Push&&(this._push=new s.options.plugins.Push.PushChannel(this)),s._Annotations&&(this._annotations=new s._Annotations.RestAnnotations(this))}get annotations(){return this._annotations||bt("Annotations"),this._annotations}get push(){return this._push||bt("Push"),this._push}get logger(){return this.client.logger}setOptions(s){var o;this.channelOptions=Ms((o=this.client._Crypto)!=null?o:null,this.logger,s)}async history(s){return k.logAction(this.logger,k.LOG_MICRO,"RestChannel.history()","channel = "+this.name),this.client.rest.channelMixin.history(this,s)}async publish(...s){const o=s[0],u=s[1];let p,_;if(typeof o=="string"||o===null)p=[Ri.fromValues({name:o,data:u})],_=s[2];else if(oe(o))p=[Ri.fromValues(o)],_=s[1];else if(Array.isArray(o))p=Ri.fromValuesArray(o),_=s[1];else throw new K("The single-argument form of publish() expects a message object or an array of message objects",40013,400);_||(_={});const S=this.client,P=S.options,U=P.useBinaryProtocol?"msgpack":"json",X=S.options.idempotentRestPublishing,Q=qe.defaultPostHeaders(S.options,{format:U});if(be(Q,P.headers),X&&dp(p)){const ue=await Mr(up);p.forEach(function(Te,Re){Te.id=ue+":"+Re.toString()})}const de=await ad(p,this.channelOptions),ce=Xc(de),Se=P.maxMessageSize;if(ce>Se)throw new K(`Maximum size of messages that can be published at once exceeded (was ${ce} bytes; limit is ${Se} bytes)`,40009,400);await this._publish(lp(de,S._MsgPack,U),Q,_)}async _publish(s,o,u){await se.post(this.client,this.client.rest.channelMixin.basePath(this)+"/messages",s,o,u,null,!0)}async status(){return this.client.rest.channelMixin.status(this)}},fp=ld,hp=class Q0{constructor(o){this.entries=o&&o.entries||void 0,this.schema=o&&o.schema||void 0,this.appId=o&&o.appId||void 0,this.inProgress=o&&o.inProgress||void 0,this.unit=o&&o.unit||void 0,this.intervalId=o&&o.intervalId||void 0}static fromValues(o){return new Q0(o)}},pp=hp,ud=class{static basePath(s){return"/channels/"+encodeURIComponent(s.name)}static history(s,o){const u=s.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=s.client.http.supportsLinkHeaders?void 0:p,S=qe.defaultGetHeaders(u.options,{format:p});return be(S,u.options.headers),new Bt(u,this.basePath(s)+"/messages",S,_,async function(P,U,X){const Q=X?P:Dt(P,u._MsgPack,p);return od(Q,s)}).get(o)}static async status(s){const o=s.client.options.useBinaryProtocol?"msgpack":"json",u=qe.defaultPostHeaders(s.client.options,{format:o});return(await se.get(s.client,this.basePath(s),u,{},o,!0)).body}},gp=class{static basePath(s){return ud.basePath(s.channel)+"/presence"}static async history(s,o){const u=s.channel.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=s.channel.client.http.supportsLinkHeaders?void 0:p,S=qe.defaultGetHeaders(u.options,{format:p});return be(S,u.options.headers),new Bt(u,this.basePath(s)+"/history",S,_,async(P,U,X)=>{const Q=X?P:Dt(P,u._MsgPack,p);return js(Q,s.channel)}).get(o)}},dd=class{constructor(s){this.channelMixin=ud,this.presenceMixin=gp,this.Resource=se,this.PaginatedResource=Bt,this.DeviceDetails=Ar,this.PushChannelSubscription=Pr,this.client=s,this.channels=new mp(this.client),this.push=new Qc(this.client)}async stats(s){const o=qe.defaultGetHeaders(this.client.options),u=this.client.options.useBinaryProtocol?"msgpack":"json",p=this.client.http.supportsLinkHeaders?void 0:u;return be(o,this.client.options.headers),new Bt(this.client,"/stats",o,p,function(_,S,P){const U=P?_:JSON.parse(_);for(let X=0;X<U.length;X++)U[X]=pp.fromValues(U[X]);return U}).get(s)}async time(s){const o=qe.defaultGetHeaders(this.client.options);this.client.options.headers&&be(o,this.client.options.headers);const u=U=>this.client.baseUri(U)+"/time";let{error:p,body:_,unpacked:S}=await this.client.http.do(Ot.Get,u,o,null,s);if(p)throw p;S||(_=JSON.parse(_));const P=_[0];if(!P)throw new K("Internal error (unexpected result type from GET /time)",5e4,500);return this.client.serverTimeOffset=P-Date.now(),P}async request(s,o,u,p,_,S){var P;const[U,X,Q]=this.client.options.useBinaryProtocol?(this.client._MsgPack||bt("MsgPack"),[this.client._MsgPack.encode,this.client._MsgPack.decode,"msgpack"]):[JSON.stringify,JSON.parse,"json"],de=this.client.http.supportsLinkHeaders?void 0:Q;p=p||{};const ce=s.toLowerCase(),Se=ce=="get"?qe.defaultGetHeaders(this.client.options,{format:Q,protocolVersion:u}):qe.defaultPostHeaders(this.client.options,{format:Q,protocolVersion:u});typeof _!="string"&&(_=(P=U(_))!=null?P:null),be(Se,this.client.options.headers),S&&be(Se,S);const ue=new Bt(this.client,o,Se,de,async function(Te,Re,De){return Ce(De?Te:X(Te))},!0);if(!L.Http.methods.includes(ce))throw new K("Unsupported method "+ce,40500,405);return L.Http.methodsWithBody.includes(ce)?ue[ce](p,_):ue[ce](p)}async batchPublish(s){let o,u;Array.isArray(s)?(o=s,u=!1):(o=[s],u=!0);const p=this.client.options.useBinaryProtocol?"msgpack":"json",_=qe.defaultPostHeaders(this.client.options,{format:p});this.client.options.headers&&be(_,this.client.options.headers);const S=cn(o,this.client._MsgPack,p),P=await se.post(this.client,"/messages",S,_,{},null,!0),U=P.unpacked?P.body:Dt(P.body,this.client._MsgPack,p);return u?U[0]:U}async batchPresence(s){const o=this.client.options.useBinaryProtocol?"msgpack":"json",u=qe.defaultPostHeaders(this.client.options,{format:o});this.client.options.headers&&be(u,this.client.options.headers);const p=s.join(","),_=await se.get(this.client,"/presence",u,{channels:p},null,!0);return _.unpacked?_.body:Dt(_.body,this.client._MsgPack,o)}async revokeTokens(s,o){if(Va(this.client.options))throw new K("Cannot revoke tokens when using token auth",40162,401);const u=this.client.options.keyName;let p=o??{};const _=I({targets:s.map(Q=>`${Q.type}:${Q.value}`)},p),S=this.client.options.useBinaryProtocol?"msgpack":"json",P=qe.defaultPostHeaders(this.client.options,{format:S});this.client.options.headers&&be(P,this.client.options.headers);const U=cn(_,this.client._MsgPack,S),X=await se.post(this.client,`/keys/${u}/revokeTokens`,U,P,{},null,!0);return X.unpacked?X.body:Dt(X.body,this.client._MsgPack,S)}},mp=class{constructor(s){this.client=s,this.all=Object.create(null)}get(s,o){s=String(s);let u=this.all[s];return u?o&&u.setOptions(o):this.all[s]=u=new fp(this.client,s,o),u}release(s){delete this.all[String(s)]}},Zc=class extends Rr{constructor(s){super(qe.objectifyOptions(s,!1,"BaseRest",k.defaultLogger,{Rest:dd}))}},Ds={Rest:dd},fd=class extends Ri{static async fromEncoded(s,o){return sd(k.defaultLogger,L.Crypto,s,o)}static async fromEncodedArray(s,o){return ap(k.defaultLogger,L.Crypto,s,o)}static fromValues(s){return Ri.fromValues(s)}},el=class extends Ti{static async fromEncoded(s,o){return id(k.defaultLogger,L.Crypto,s,o)}static async fromEncodedArray(s,o){return Kc(k.defaultLogger,L.Crypto,s,o)}static fromValues(s){return Ti.fromValues(s)}},tl=["annotation.create","annotation.delete"];async function nl(s,o,u){return Bs.fromValues(o).decode(u||{},s)}async function hd(s,o,u){return Promise.all(o.map(function(p){return nl(s,p,u)}))}async function pd(s,o){return Bs.fromValues(s).decode(o.channelOptions,o.logger)}async function Us(s,o){return Promise.all(s.map(function(u){return pd(u,o)}))}var gd=class yg extends Kr{async encode(){const o=Object.assign(new Bs,this,{action:tl.indexOf(this.action||"annotation.create")});return Bn(o,{})}static fromValues(o){return Object.assign(new yg,o)}static fromValuesArray(o){return o.map(u=>yg.fromValues(u))}toString(){return Zn(this,"Annotation")}},Bs=class _g extends Kr{toJSON(...o){return Qr.call(this,...o)}static fromValues(o){return Object.assign(new _g,o)}static fromValuesArray(o){return o.map(u=>_g.fromValues(u))}async decode(o,u){const p=Object.assign(new gd,A(I({},this),{action:tl[this.action]}));try{await Xn(p,o)}catch(_){k.logAction(u,k.LOG_ERROR,"WireAnnotation.decode()",Ze(_))}return p}toString(){return Zn(this,"WireAnnotation")}},Go=gd,rl=class extends Go{static async fromEncoded(s,o){return nl(k.defaultLogger,s,o)}static async fromEncodedArray(s,o){return hd(k.defaultLogger,s,o)}static fromValues(s){return Go.fromValues(s)}};function il(s){let o;switch(typeof s){case"string":o=s;break;case"object":o=s.serial;break}if(!o||typeof o!="string")throw new K("First argument of annotations.publish() must be either a Message (or at least an object with a string `serial` property) or a message serial (string)",40003,400);return o}function Fs(s,o){const u=il(s);if(!o||typeof o!="object")throw new K("Second argument of annotations.publish() must be an object (the intended annotation to publish)",40003,400);const p=Go.fromValues(o);return p.messageSerial=u,p.action||(p.action="annotation.create"),p}function Vs(s,o){return s.client.rest.channelMixin.basePath(s)+"/messages/"+encodeURIComponent(o)+"/annotations"}var vp=class{constructor(s){this.channel=s}async publish(s,o){const u=Fs(s,o),p=await u.encode(),_=this.channel.client,S=_.options,P=S.useBinaryProtocol?"msgpack":"json",U=qe.defaultPostHeaders(_.options,{format:P}),X={};be(U,_.options.headers);const Q=cn([p],_._MsgPack,P);await se.post(_,Vs(this.channel,u.messageSerial),Q,U,X,null,!0)}async delete(s,o){return o.action="annotation.delete",this.publish(s,o)}async get(s,o){const u=this.channel.client,p=il(s),_=u.options.useBinaryProtocol?"msgpack":"json",S=u.http.supportsLinkHeaders?void 0:_,P=qe.defaultGetHeaders(u.options,{format:_});return be(P,u.options.headers),new Bt(u,Vs(this.channel,p),P,S,async(U,X,Q)=>{const de=Q?U:Dt(U,u._MsgPack,_);return Us(de,this.channel)}).get(o)}},zs=vp,yp=cn;function Jo(s){const o=[];if(s)for(let u=0;u<s.length;u++)o.push(s[u].toString());return"[ "+o.join(", ")+" ]"}function sl(s,o,u,p,_,S){const P=Dt(s,o,S);return Qo(P,u,p,_)}function Qo(s,o,u,p){let _;s.error&&(_=K.fromValues(s.error));let S;s.messages&&(S=Zi.fromValuesArray(s.messages));let P;o&&s.presence&&(P=o.WirePresenceMessage.fromValuesArray(s.presence));let U;u&&s.annotations&&(U=u.WireAnnotation.fromValuesArray(s.annotations));let X;return p&&s.state&&(X=p.WireObjectMessage.fromValuesArray(s.state,ze,Qi)),Object.assign(new al,A(I({},s),{presence:P,messages:S,annotations:U,state:X,error:_}))}function ol(s){return o=>{var u;return Qo(o,{WirePresenceMessage:Ns},{WireAnnotation:Bs},(u=s?.ObjectsPlugin)!=null?u:null)}}function Cn(s){return Object.assign(new al,s)}function Wa(s,o,u,p){let _="[ProtocolMessage";s.action!==void 0&&(_+="; action="+Is[s.action]||s.action);const S=["id","channel","channelSerial","connectionId","count","msgSerial","timestamp"];let P;for(let U=0;U<S.length;U++)P=S[U],s[P]!==void 0&&(_+="; "+P+"="+s[P]);if(s.messages&&(_+="; messages="+Jo(Zi.fromValuesArray(s.messages))),s.presence&&o&&(_+="; presence="+Jo(o.WirePresenceMessage.fromValuesArray(s.presence))),s.annotations&&u&&(_+="; annotations="+Jo(u.WireAnnotation.fromValuesArray(s.annotations))),s.state&&p&&(_+="; state="+Jo(p.WireObjectMessage.fromValuesArray(s.state,ze,Qi))),s.error&&(_+="; error="+K.fromValues(s.error).toString()),s.auth&&s.auth.accessToken&&(_+="; token="+s.auth.accessToken),s.flags&&(_+="; flags="+Fo.filter(s.hasFlag).join(",")),s.params){let U="";Vt(s.params,function(X){U.length>0&&(U+="; "),U+=X+"="+s.params[X]}),U.length>0&&(_+="; params=["+U+"]")}return _+="]",_}var al=class{constructor(){this.hasFlag=s=>(this.flags&Tt[s])>0}setFlag(s){return this.flags=this.flags|Tt[s]}getMode(){return(this.flags||0)&Tt.MODE_ALL}encodeModesToFlags(s){s.forEach(o=>this.setFlag(o))}decodeModesFromFlags(){const s=[];return Vo.forEach(o=>{this.hasFlag(o)&&s.push(o)}),s.length>0?s:void 0}},_p=al,wp=class{constructor(s,o,u,p,_){this.previous=s,this.current=o,o==="attached"&&(this.resumed=u,this.hasBacklog=p),_&&(this.reason=_)}},cl=wp,md=function(){};function gr(s){if(s&&"params"in s&&!oe(s.params))return new K("options.params must be an object",4e4,400);if(s&&"modes"in s){if(!Array.isArray(s.modes))return new K("options.modes must be an array",4e4,400);for(let o=0;o<s.modes.length;o++){const u=s.modes[o];if(!u||typeof u!="string"||!Vo.includes(String.prototype.toUpperCase.call(u)))return new K("Invalid channel mode: "+u,4e4,400)}}}var Ko=class wg extends St{constructor(o,u,p){var _,S,P;super(o.logger),this._annotations=null,this._mode=0,this.retryCount=0,this.history=async function(U){k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name);const X=this.client.rest.channelMixin;if(U&&U.untilAttach){if(this.state!=="attached")throw new K("option untilAttach requires the channel to be attached",4e4,400);if(!this.properties.attachSerial)throw new K("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400);delete U.untilAttach,U.from_serial=this.properties.attachSerial}return X.history(this,U)},this.whenState=U=>St.prototype.whenState.call(this,U,this.state),k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel()","started; name = "+u),this.name=u,this.channelOptions=Ms((_=o._Crypto)!=null?_:null,this.logger,p),this.client=o,this._presence=o._RealtimePresence?new o._RealtimePresence.RealtimePresence(this):null,o._Annotations&&(this._annotations=new o._Annotations.RealtimeAnnotations(this)),this.connectionManager=o.connection.connectionManager,this.state="initialized",this.subscriptions=new St(this.logger),this.syncChannelSerial=void 0,this.properties={attachSerial:void 0,channelSerial:void 0},this.setOptions(p),this.errorReason=null,this._attachResume=!1,this._decodingContext={channelOptions:this.channelOptions,plugins:o.options.plugins||{},baseEncodedPreviousPayload:void 0},this._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},this._allChannelChanges=new St(this.logger),(S=o.options.plugins)!=null&&S.Push&&(this._push=new o.options.plugins.Push.PushChannel(this)),(P=o.options.plugins)!=null&&P.Objects&&(this._objects=new o.options.plugins.Objects.Objects(this))}get presence(){return this._presence||bt("RealtimePresence"),this._presence}get annotations(){return this._annotations||bt("Annotations"),this._annotations}get push(){return this._push||bt("Push"),this._push}get objects(){return this._objects||bt("Objects"),this._objects}invalidStateError(){return new K("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)}static processListenerArgs(o){return o=Array.prototype.slice.call(o),typeof o[0]=="function"&&o.unshift(null),o}async setOptions(o){var u;const p=this.channelOptions,_=gr(o);if(_)throw _;if(this.channelOptions=Ms((u=this.client._Crypto)!=null?u:null,this.logger,o),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(o,p))return this.attachImpl(),new Promise((S,P)=>{this._allChannelChanges.once(["attached","update","detached","failed"],function(U){switch(this.event){case"update":case"attached":S();break;default:P(U.reason)}})})}_shouldReattachToSetOptions(o,u){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(o?.params){const p=ll(o.params),_=ll(u.params);if(Object.keys(p).length!==Object.keys(_).length||!Ss(_,p))return!0}return!!(o?.modes&&(!u.modes||!vi(o.modes,u.modes)))}async publish(...o){let u;if(o.length==1)if(oe(o[0]))u=[Ri.fromValues(o[0])];else if(Array.isArray(o[0]))u=Ri.fromValuesArray(o[0]);else throw new K("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else u=[Ri.fromValues({name:o[0],data:o[1]})];const _=this.client.options.maxMessageSize,S=await ad(u,this.channelOptions),P=Xc(S);if(P>_)throw new K(`Maximum size of messages that can be published at once exceeded (was ${P} bytes; limit is ${_} bytes)`,40009,400);this.throwIfUnpublishableState(),k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+this.state+", message count = "+S.length);const U=Cn({action:we.MESSAGE,channel:this.name,messages:S});return this.sendMessage(U)}throwIfUnpublishableState(){if(!this.connectionManager.activeState())throw this.connectionManager.getError();if(this.state==="failed"||this.state==="suspended")throw this.invalidStateError()}onEvent(o){k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.onEvent()","received message");const u=this.subscriptions;for(let p=0;p<o.length;p++){const _=o[p];u.emit(_.name,_)}}async attach(){return this.state==="attached"?null:new Promise((o,u)=>{this._attach(!1,null,(p,_)=>p?u(p):o(_))})}_attach(o,u,p){p||(p=S=>{S&&k.logAction(this.logger,k.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+S.toString())});const _=this.connectionManager;if(!_.activeState()){p(_.getError());return}(this.state!=="attaching"||o)&&this.requestState("attaching",u),this.once(function(S){switch(this.event){case"attached":p?.(null,S);break;case"detached":case"suspended":case"failed":p?.(S.reason||_.getError()||new K("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":p?.(new K("Attach request superseded by a subsequent detach request",9e4,409));break}})}attachImpl(){k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");const o=Cn({action:we.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this.channelOptions.modes&&o.encodeModesToFlags(gi(this.channelOptions.modes)),this._attachResume&&o.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(o.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(o).catch(md)}async detach(){const o=this.connectionManager;if(!o.activeState())throw o.getError();switch(this.state){case"suspended":this.notifyState("detached");return;case"detached":return;case"failed":throw new K("Unable to detach; channel state = failed",90001,400);default:this.requestState("detaching");case"detaching":return new Promise((u,p)=>{this.once(function(_){switch(this.event){case"detached":u();break;case"attached":case"suspended":case"failed":p(_.reason||o.getError()||new K("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":p(new K("Detach request superseded by a subsequent attach request",9e4,409));break}})})}}detachImpl(){k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");const o=Cn({action:we.DETACH,channel:this.name});this.sendMessage(o).catch(md)}async subscribe(...o){const[u,p]=wg.processListenerArgs(o);if(this.state==="failed")throw K.fromValues(this.invalidStateError());return u&&typeof u=="object"&&!Array.isArray(u)?this.client._FilteredSubscriptions.subscribeFilter(this,u,p):this.subscriptions.on(u,p),this.channelOptions.attachOnSubscribe!==!1?this.attach():null}unsubscribe(...o){var u;const[p,_]=wg.processListenerArgs(o);if(typeof p=="object"&&!_||(u=this.filteredSubscriptions)!=null&&u.has(_)){this.client._FilteredSubscriptions.getAndDeleteFilteredSubscriptions(this,p,_).forEach(S=>this.subscriptions.off(S));return}this.subscriptions.off(p,_)}sync(){switch(this.state){case"initialized":case"detaching":case"detached":throw new Ue("Unable to sync to channel; not attached",4e4)}const o=this.connectionManager;if(!o.activeState())throw o.getError();const u=Cn({action:we.SYNC,channel:this.name});this.syncChannelSerial&&(u.channelSerial=this.syncChannelSerial),o.send(u)}async sendMessage(o){return new Promise((u,p)=>{this.connectionManager.send(o,this.client.options.queueMessages,_=>{_?p(_):u()})})}async sendPresence(o){const u=Cn({action:we.PRESENCE,channel:this.name,presence:o});return this.sendMessage(u)}sendState(o){const u=Cn({action:we.OBJECT,channel:this.name,state:o});return this.sendMessage(u)}async processMessage(o){(o.action===we.ATTACHED||o.action===we.MESSAGE||o.action===we.PRESENCE||o.action===we.OBJECT||o.action===we.ANNOTATION)&&this.setChannelSerial(o.channelSerial);let u,p=!1;switch(o.action){case we.ATTACHED:{this.properties.attachSerial=o.channelSerial,this._mode=o.getMode(),this.params=o.params||{};const _=o.decodeModesFromFlags();this.modes=_&&Hr(_)||void 0;const S=o.hasFlag("RESUMED"),P=o.hasFlag("HAS_PRESENCE"),U=o.hasFlag("HAS_BACKLOG"),X=o.hasFlag("HAS_OBJECTS");if(this.state==="attached"){S||(this._presence&&this._presence.onAttached(P),this._objects&&this._objects.onAttached(X));const Q=new cl(this.state,this.state,S,U,o.error);this._allChannelChanges.emit("update",Q),(!S||this.channelOptions.updateOnAttached)&&this.emit("update",Q)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",o.error,S,P,U,X);break}case we.DETACHED:{const _=o.error?K.fromValues(o.error):new K("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",_):this.state==="attaching"?this.notifyState("suspended",_):(this.state==="attached"||this.state==="suspended")&&this.requestState("attaching",_);break}case we.SYNC:if(p=!0,u=this.syncChannelSerial=o.channelSerial,!o.presence)break;case we.PRESENCE:{if(!o.presence)break;Ki(o);const _=this.channelOptions;if(this._presence){const S=await Promise.all(o.presence.map(P=>P.decode(_,this.logger)));this._presence.setPresence(S,p,u)}break}case we.OBJECT:case we.OBJECT_SYNC:{if(!this._objects||!o.state)return;Ki(o);const _=this.client.connection.connectionManager.getActiveTransportFormat(),S=o.state.map(P=>P.decode(this.client,_));o.action===we.OBJECT?this._objects.handleObjectMessages(S):this._objects.handleObjectSyncMessages(S,o.channelSerial);break}case we.MESSAGE:{if(this.state!=="attached"){k.logAction(this.logger,k.LOG_MAJOR,"RealtimeChannel.processMessage()",'Message "'+o.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}Ki(o);const _=o.messages,S=_[0],P=_[_.length-1];if(S.extras&&S.extras.delta&&S.extras.delta.from!==this._lastPayload.messageId){const X='Delta message decode failure - previous message not available for message "'+o.id+'" on this channel "'+this.name+'".';k.logAction(this.logger,k.LOG_ERROR,"RealtimeChannel.processMessage()",X),this._startDecodeFailureRecovery(new K(X,40018,400));break}let U=[];for(let X=0;X<_.length;X++){const{decoded:Q,err:de}=await _[X].decodeWithErr(this._decodingContext,this.logger);if(U[X]=Q,de)switch(de.code){case 40018:this._startDecodeFailureRecovery(de);return;case 40019:case 40021:this.notifyState("failed",de);return}}this._lastPayload.messageId=P.id,this._lastPayload.protocolMessageChannelSerial=o.channelSerial,this.onEvent(U);break}case we.ANNOTATION:{Ki(o);const _=this.channelOptions;if(this._annotations){const S=await Promise.all((o.annotations||[]).map(P=>P.decode(_,this.logger)));this._annotations._processIncoming(S)}break}case we.ERROR:{const _=o.error;_&&_.code==80016?this.checkPendingState():this.notifyState("failed",K.fromValues(_));break}default:k.logAction(this.logger,k.LOG_MAJOR,"RealtimeChannel.processMessage()","Protocol error: unrecognised message action ("+o.action+")")}}_startDecodeFailureRecovery(o){this._lastPayload.decodeFailureRecoveryInProgress||(k.logAction(this.logger,k.LOG_MAJOR,"RealtimeChannel.processMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,o,()=>{this._lastPayload.decodeFailureRecoveryInProgress=!1}))}onAttached(){k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)}notifyState(o,u,p,_,S,P){if(k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+o),this.clearStateTimer(),["detached","suspended","failed"].includes(o)&&(this.properties.channelSerial=null),o===this.state)return;this._presence&&this._presence.actOnChannelState(o,_,u),this._objects&&this._objects.actOnChannelState(o,P),o==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),u&&(this.errorReason=u);const U=new cl(this.state,o,p,S,u),X='Channel state for channel "'+this.name+'"',Q=o+(u?"; reason: "+u:"");o==="failed"?k.logAction(this.logger,k.LOG_ERROR,X,Q):k.logAction(this.logger,k.LOG_MAJOR,X,Q),o!=="attaching"&&o!=="suspended"&&(this.retryCount=0),o==="attached"&&this.onAttached(),o==="attached"?this._attachResume=!0:(o==="detaching"||o==="failed")&&(this._attachResume=!1),this.state=o,this._allChannelChanges.emit(o,U),this.emit(o,U)}requestState(o,u){k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+o),this.notifyState(o,u),this.checkPendingState()}checkPendingState(){if(!this.connectionManager.state.sendEvents){k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}}timeoutPendingState(){switch(this.state){case"attaching":{const o=new K("Channel attach timed out",90007,408);this.notifyState("suspended",o);break}case"detaching":{const o=new K("Channel detach timed out",90007,408);this.notifyState("attached",o);break}default:this.checkPendingState();break}}startStateTimerIfNotRunning(){this.stateTimer||(this.stateTimer=setTimeout(()=>{k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),this.stateTimer=null,this.timeoutPendingState()},this.client.options.timeouts.realtimeRequestTimeout))}clearStateTimer(){const o=this.stateTimer;o&&(clearTimeout(o),this.stateTimer=null)}startRetryTimer(){if(this.retryTimer)return;this.retryCount++;const o=Wi(this.client.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(()=>{this.state==="suspended"&&this.connectionManager.state.sendEvents&&(this.retryTimer=null,k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),this.requestState("attaching"))},o)}cancelRetryTimer(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}getReleaseErr(){const o=this.state;return o==="initialized"||o==="detached"||o==="failed"?null:new K("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+o,90001,400)}setChannelSerial(o){k.logAction(this.logger,k.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+o+"; previous = "+this.properties.channelSerial),o&&(this.properties.channelSerial=o)}async status(){return this.client.rest.channelMixin.status(this)}};function ll(s){const o=s||{},{agent:u}=o;return R(o,["agent"])}var $s=Ko,vd=class{constructor(s){this.channel=s,this.logger=s.logger,this.subscriptions=new St(this.logger)}async publish(s,o){const u=this.channel.name,p=Fs(s,o),_=await p.encode();this.channel.throwIfUnpublishableState(),k.logAction(this.logger,k.LOG_MICRO,"RealtimeAnnotations.publish()","channelName = "+u+", sending annotation with messageSerial = "+p.messageSerial+", type = "+p.type);const S=Cn({action:we.ANNOTATION,channel:u,annotations:[_]});return this.channel.sendMessage(S)}async delete(s,o){return o.action="annotation.delete",this.publish(s,o)}async subscribe(...s){const o=$s.processListenerArgs(s),u=o[0],p=o[1],_=this.channel;if(_.state==="failed")throw K.fromValues(_.invalidStateError());if(this.subscriptions.on(u,p),this.channel.channelOptions.attachOnSubscribe!==!1&&await _.attach(),(this.channel.state==="attached"&&this.channel._mode&Tt.ANNOTATION_SUBSCRIBE)===0)throw new K("You are trying to add an annotation listener, but you haven't requested the annotation_subscribe channel mode in ChannelOptions, so this won't do anything (we only deliver annotations to clients who have explicitly requested them)",93001,400)}unsubscribe(...s){const o=$s.processListenerArgs(s),u=o[0],p=o[1];this.subscriptions.off(u,p)}_processIncoming(s){for(const o of s)this.subscriptions.emit(o.type||"",o)}async get(s,o){return zs.prototype.get.call(this,s,o)}},ul=vd,Yr=class lf extends Zc{constructor(o){var u,p;if(!lf._MsgPack)throw new Error("Expected DefaultRest._MsgPack to have been set");super(qe.objectifyOptions(o,!0,"Rest",k.defaultLogger,A(I({},Ds),{Crypto:(u=lf.Crypto)!=null?u:void 0,MsgPack:(p=lf._MsgPack)!=null?p:void 0,Annotations:{Annotation:Go,WireAnnotation:Bs,RealtimeAnnotations:ul,RestAnnotations:zs}})))}static get Crypto(){if(this._Crypto===null)throw new Error("Encryption not enabled; use ably.encryption.js instead");return this._Crypto}static set Crypto(o){this._Crypto=o}};Yr._Crypto=null,Yr.Message=fd,Yr.PresenceMessage=el,Yr.Annotation=rl,Yr._MsgPack=null,Yr._Http=As;var dl=Yr,bp=class extends St{constructor(s){super(s),this.messages=[]}count(){return this.messages.length}push(s){this.messages.push(s)}shift(){return this.messages.shift()}last(){return this.messages[this.messages.length-1]}copyAll(){return this.messages.slice()}append(s){this.messages.push.apply(this.messages,s)}prepend(s){this.messages.unshift.apply(this.messages,s)}completeMessages(s,o,u){k.logAction(this.logger,k.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+s+"; count = "+o),u=u||null;const p=this.messages;if(p.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");const _=p[0];if(_){const S=_.message.msgSerial,P=s+o;if(P>S){const U=p.splice(0,P-S);for(const X of U)X.callback(u)}p.length==0&&this.emit("idle")}}completeAllMessages(s){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,s)}resetSendAttempted(){for(let s of this.messages)s.sendAttempted=!1}clear(){k.logAction(this.logger,k.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")}},es=bp,Ha=class{constructor(s,o){this.message=s,this.callback=o,this.merged=!1;const u=s.action;this.sendAttempted=!1,this.ackRequired=typeof u=="number"&&[we.MESSAGE,we.PRESENCE,we.ANNOTATION,we.OBJECT].includes(u)}},Yo=class extends St{constructor(s){super(s.logger),this.transport=s,this.messageQueue=new es(this.logger),s.on("ack",(o,u)=>{this.onAck(o,u)}),s.on("nack",(o,u,p)=>{this.onNack(o,u,p)})}onAck(s,o){k.logAction(this.logger,k.LOG_MICRO,"Protocol.onAck()","serial = "+s+"; count = "+o),this.messageQueue.completeMessages(s,o)}onNack(s,o,u){k.logAction(this.logger,k.LOG_ERROR,"Protocol.onNack()","serial = "+s+"; count = "+o+"; err = "+Ze(u)),u||(u=new K("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(s,o,u)}onceIdle(s){const o=this.messageQueue;if(o.count()===0){s();return}o.once("idle",s)}send(s){s.ackRequired&&this.messageQueue.push(s),this.logger.shouldLog(k.LOG_MICRO)&&k.logActionNoStrip(this.logger,k.LOG_MICRO,"Protocol.send()","sending msg; "+Wa(s.message,this.transport.connectionManager.realtime._RealtimePresence,this.transport.connectionManager.realtime._Annotations,this.transport.connectionManager.realtime._objectsPlugin)),s.sendAttempted=!0,this.transport.send(s.message)}getTransport(){return this.transport}getPendingMessages(){return this.messageQueue.copyAll()}clearPendingMessages(){return this.messageQueue.clear()}finish(){const s=this.transport;this.onceIdle(function(){s.disconnect()})}},fl=Yo,yd=class{constructor(s,o,u,p){this.previous=s,this.current=o,u&&(this.retryIn=u),p&&(this.reason=p)}},ts=yd,$n={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},hl={disconnected:()=>K.fromValues({statusCode:400,code:$n.DISCONNECTED,message:"Connection to server temporarily unavailable"}),suspended:()=>K.fromValues({statusCode:400,code:$n.SUSPENDED,message:"Connection to server unavailable"}),failed:()=>K.fromValues({statusCode:400,code:$n.FAILED,message:"Connection failed or disconnected by server"}),closing:()=>K.fromValues({statusCode:400,code:$n.CLOSING,message:"Connection closing"}),closed:()=>K.fromValues({statusCode:400,code:$n.CLOSED,message:"Connection closed"}),unknownConnectionErr:()=>K.fromValues({statusCode:500,code:$n.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"}),unknownChannelErr:()=>K.fromValues({statusCode:500,code:$n.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})};function _d(s){return!s.statusCode||!s.code||s.statusCode>=500?!0:Object.values($n).includes(s.code)}var Ir=hl,wd=Cn({action:we.CLOSE}),bd=Cn({action:we.DISCONNECT}),Sd=class extends St{constructor(s,o,u,p){super(s.logger),p&&(u.format=void 0,u.heartbeats=!0),this.connectionManager=s,this.auth=o,this.params=u,this.timeouts=u.options.timeouts,this.format=u.format,this.isConnected=!1,this.isFinished=!1,this.isDisposed=!1,this.maxIdleInterval=null,this.idleTimer=null,this.lastActivity=null}connect(){}close(){this.isConnected&&this.requestClose(),this.finish("closed",Ir.closed())}disconnect(s){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",s||Ir.disconnected())}fail(s){this.isConnected&&this.requestDisconnect(),this.finish("failed",s||Ir.failed())}finish(s,o){var u;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((u=this.idleTimer)!=null?u:void 0),this.idleTimer=null,this.emit(s,o),this.dispose())}onProtocolMessage(s){switch(this.logger.shouldLog(k.LOG_MICRO)&&k.logActionNoStrip(this.logger,k.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+Wa(s,this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),s.action){case we.HEARTBEAT:k.logActionNoStrip(this.logger,k.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",s.id);break;case we.CONNECTED:this.onConnect(s),this.emit("connected",s.error,s.connectionId,s.connectionDetails,s);break;case we.CLOSED:this.onClose(s);break;case we.DISCONNECTED:this.onDisconnect(s);break;case we.ACK:this.emit("ack",s.msgSerial,s.count);break;case we.NACK:this.emit("nack",s.msgSerial,s.count,s.error);break;case we.SYNC:this.connectionManager.onChannelMessage(s,this);break;case we.ACTIVATE:break;case we.AUTH:Nt(this.auth.authorize(),o=>{o&&k.logAction(this.logger,k.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+Ze(o))});break;case we.ERROR:if(k.logAction(this.logger,k.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+L.Config.inspect(s.error)+(s.channel?", channel: "+s.channel:"")),s.channel===void 0){this.onFatalError(s);break}this.connectionManager.onChannelMessage(s,this);break;default:this.connectionManager.onChannelMessage(s,this)}}onConnect(s){if(this.isConnected=!0,!s.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");const o=s.connectionDetails.maxIdleInterval;o&&(this.maxIdleInterval=o+this.timeouts.realtimeRequestTimeout,this.onActivity())}onDisconnect(s){const o=s&&s.error;k.logAction(this.logger,k.LOG_MINOR,"Transport.onDisconnect()","err = "+Ze(o)),this.finish("disconnected",o)}onFatalError(s){const o=s&&s.error;k.logAction(this.logger,k.LOG_MINOR,"Transport.onFatalError()","err = "+Ze(o)),this.finish("failed",o)}onClose(s){const o=s&&s.error;k.logAction(this.logger,k.LOG_MINOR,"Transport.onClose()","err = "+Ze(o)),this.finish("closed",o)}requestClose(){k.logAction(this.logger,k.LOG_MINOR,"Transport.requestClose()",""),this.send(wd)}requestDisconnect(){k.logAction(this.logger,k.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(bd)}ping(s){const o={action:we.HEARTBEAT};s&&(o.id=s),this.send(Cn(o))}dispose(){k.logAction(this.logger,k.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()}onActivity(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=Date.now(),this.setIdleTimer(this.maxIdleInterval+100))}setIdleTimer(s){this.idleTimer||(this.idleTimer=setTimeout(()=>{this.onIdleTimerExpire()},s))}onIdleTimerExpire(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;const s=Date.now()-this.lastActivity,o=this.maxIdleInterval-s;if(o<=0){const u="No activity seen from realtime in "+s+"ms; assuming connection has dropped";k.logAction(this.logger,k.LOG_ERROR,"Transport.onIdleTimerExpire()",u),this.disconnect(new K(u,80003,408))}else this.setIdleTimer(o+100)}static tryConnect(s,o,u,p,_){const S=new s(o,u,p);let P;const U=function(Q){clearTimeout(P),_({event:this.event,error:Q})},X=o.options.timeouts.realtimeRequestTimeout;return P=setTimeout(()=>{S.off(["preconnect","disconnected","failed"]),S.dispose(),U.call({event:"disconnected"},new K("Timeout waiting for transport to indicate itself viable",5e4,500))},X),S.on(["failed","disconnected"],U),S.on("preconnect",function(){k.logAction(o.logger,k.LOG_MINOR,"Transport.tryConnect()","viable transport "+S),clearTimeout(P),S.off(["failed","disconnected"],U),_(null,S)}),S.connect(),S}static isAvailable(){throw new K("isAvailable not implemented for transport",5e4,500)}},ns=Sd,un;(s=>{s.WebSocket="web_socket",s.Comet="comet",s.XhrPolling="xhr_polling"})(un||(un={}));var kd=typeof ls<"u"?ls:typeof window<"u"?window:self,xr=()=>{var s;return typeof L.WebStorage<"u"&&((s=L.WebStorage)==null?void 0:s.localSupported)},rs=()=>{var s;return typeof L.WebStorage<"u"&&((s=L.WebStorage)==null?void 0:s.sessionSupported)},Ga=function(){},pl="ably-transport-preference";function Sp(s,o,u){let p;if(s.channel!==o.channel||(p=s.action)!==we.PRESENCE&&p!==we.MESSAGE||p!==o.action)return!1;const _=p===we.PRESENCE?"presence":"messages",S=s[_].concat(o[_]);return Xc(S)>u||!bn(S,"clientId")||!S.every(function(U){return!U.id})?!1:(s[_]=S,!0)}function is(s){try{return JSON.parse(s)}catch{return null}}var kp=class{constructor(s,o,u,p){this.options=s,this.host=o,this.mode=u,this.connectionKey=p,this.format=s.useBinaryProtocol?"msgpack":"json"}getConnectParams(s){const o=s?he(s):{},u=this.options;switch(this.mode){case"resume":o.resume=this.connectionKey;break;case"recover":{const p=is(u.recover);p&&(o.recover=p.connectionKey);break}}return u.clientId!==void 0&&(o.clientId=u.clientId),u.echoMessages===!1&&(o.echo="false"),this.format!==void 0&&(o.format=this.format),this.stream!==void 0&&(o.stream=this.stream),this.heartbeats!==void 0&&(o.heartbeats=this.heartbeats),o.v=qe.protocolVersion,o.agent=tn(this.options),u.transportParams!==void 0&&be(o,u.transportParams),o}toString(){let s="[mode="+this.mode;return this.host&&(s+=",host="+this.host),this.connectionKey&&(s+=",connectionKey="+this.connectionKey),this.format&&(s+=",format="+this.format),s+="]",s}},Cd=class K0 extends St{constructor(o,u){super(o.logger),this.supportedTransports={},this.disconnectedRetryCount=0,this.pendingChannelMessagesState={isProcessing:!1,queue:[]},this.realtime=o,this.initTransports(),this.options=u;const p=u.timeouts,_=p.webSocketConnectTimeout+p.realtimeRequestTimeout;if(this.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:_,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:p.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:p.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:p.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},this.state=this.states.initialized,this.errorReason=null,this.queuedMessages=new es(this.logger),this.msgSerial=0,this.connectionDetails=void 0,this.connectionId=void 0,this.connectionKey=void 0,this.connectionStateTtl=p.connectionStateTtl,this.maxIdleInterval=null,this.transports=F(u.transports||qe.defaultTransports,this.supportedTransports),this.transportPreference=null,this.transports.includes(un.WebSocket)&&(this.webSocketTransportAvailable=!0),this.transports.includes(un.XhrPolling)?this.baseTransport=un.XhrPolling:this.transports.includes(un.Comet)&&(this.baseTransport=un.Comet),this.domains=qe.getHosts(u),this.activeProtocol=null,this.host=null,this.lastAutoReconnectAttempt=null,this.lastActivity=null,this.forceFallbackHost=!1,this.connectCounter=0,this.wsCheckResult=null,this.webSocketSlowTimer=null,this.webSocketGiveUpTimer=null,this.abandonedWebSocket=!1,k.logAction(this.logger,k.LOG_MINOR,"Realtime.ConnectionManager()","started"),k.logAction(this.logger,k.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(u.transports||qe.defaultTransports)+"]"),k.logAction(this.logger,k.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+this.transports+"]"),k.logAction(this.logger,k.LOG_MICRO,"Realtime.ConnectionManager()","http domains = ["+this.domains+"]"),!this.transports.length){const P="no requested transports available";throw k.logAction(this.logger,k.LOG_ERROR,"realtime.ConnectionManager()",P),new Error(P)}const S=L.Config.addEventListener;S&&(rs()&&typeof u.recover=="function"&&S("beforeunload",this.persistConnection.bind(this)),u.closeOnUnload===!0&&S("beforeunload",()=>{k.logAction(this.logger,k.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),this.requestState({state:"closing"})}),S("online",()=>{var P;this.state==this.states.disconnected||this.state==this.states.suspended?(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager caught browser online event","reattempting connection"),this.requestState({state:"connecting"})):this.state==this.states.connecting&&((P=this.pendingTransport)==null||P.off(),this.disconnectAllTransports(),this.startConnect())}),S("offline",()=>{this.state==this.states.connected&&(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager caught browser offline event","disconnecting active transport"),this.disconnectAllTransports())}))}static supportedTransports(o){const u={supportedTransports:{}};return this.initTransports(o,u),u.supportedTransports}static initTransports(o,u){const p=I(I({},L.Transports.bundledImplementations),o);[un.WebSocket,...L.Transports.order].forEach(_=>{const S=p[_];S&&S.isAvailable()&&(u.supportedTransports[_]=S)})}initTransports(){K0.initTransports(this.realtime._additionalTransportImplementations,this)}createTransportParams(o,u){return new kp(this.options,o,u,this.connectionKey)}getTransportParams(o){(p=>{if(this.connectionKey){p("resume");return}if(typeof this.options.recover=="string"){p("recover");return}const _=this.options.recover,S=this.getSessionRecoverData(),P=this.sessionRecoveryName();if(S&&typeof _=="function"){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data (recovery scope: "+P+")"),_(S,U=>{U?(this.options.recover=S.recoveryKey,p("recover")):p("clean")});return}p("clean")})(p=>{const _=this.createTransportParams(null,p);if(p==="recover"){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+this.options.recover);const S=is(this.options.recover);S&&(this.msgSerial=S.msgSerial)}else k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+_.toString());o(_)})}tryATransport(o,u,p){k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+u),this.proposedTransport=ns.tryConnect(this.supportedTransports[u],this,this.realtime.auth,o,(_,S)=>{const P=this.state;if(P==this.states.closing||P==this.states.closed||P==this.states.failed){S&&(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+P.state+" while we were attempting the transport; closing "+S),S.close()),p(!0);return}if(_){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+u+" "+_.event+", err: "+_.error.toString()),ln.isTokenErr(_.error)&&!(this.errorReason&&ln.isTokenErr(this.errorReason))?(this.errorReason=_.error,Nt(this.realtime.auth._forceNewToken(null,null),U=>{if(U){this.actOnErrorFromAuthorize(U);return}this.tryATransport(o,u,p)})):_.event==="failed"?(this.notifyState({state:"failed",error:_.error}),p(!0)):_.event==="disconnected"&&(_d(_.error)?p(!1):(this.notifyState({state:this.states.connecting.failState,error:_.error}),p(!0)));return}k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+u+"; setting pending"),this.setTransportPending(S,o),p(null,S)})}setTransportPending(o,u){const p=u.mode;k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+o+"; mode = "+p),this.pendingTransport=o,this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),o.once("connected",(S,P,U)=>{this.activateTransport(S,o,P,U),p==="recover"&&this.options.recover&&(delete this.options.recover,this.unpersistConnection())});const _=this;o.on(["disconnected","closed","failed"],function(S){_.deactivateTransport(o,this.event,S)}),this.emit("transport.pending",o)}activateTransport(o,u,p,_){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+u),o&&k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+o),p&&k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+p),_&&k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(_)),this.persistTransportPreference(u);const S=this.state,P=this.states.connected.state;if(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+S.state),S.state==this.states.closing.state||S.state==this.states.closed.state||S.state==this.states.failed.state)return k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),u.disconnect(),!1;if(delete this.pendingTransport,!u.isConnected)return k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+u+" since it appears to no longer be connected"),!1;const U=this.activeProtocol;this.activeProtocol=new fl(u),this.host=u.params.host;const X=_.connectionKey;if(X&&this.connectionKey!=X&&this.setConnection(p,_,!!o),this.onConnectionDetailsUpdate(_,u),L.Config.nextTick(()=>{u.on("connected",(Q,de,ce)=>{this.onConnectionDetailsUpdate(ce,u),this.emit("update",new ts(P,P,null,Q))})}),S.state===this.states.connected.state?o&&(this.errorReason=this.realtime.connection.errorReason=o,this.emit("update",new ts(P,P,null,o))):(this.notifyState({state:"connected",error:o}),this.errorReason=this.realtime.connection.errorReason=o||null),this.emit("transport.active",u),U)if(U.messageQueue.count()>0&&k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+U.transport.shortName+", new one is "+u.shortName+") finishing with "+U.messageQueue.count()+" messages still pending"),U.transport===u){const Q="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+u.shortName+"; stack = "+new Error().stack;k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.activateTransport()",Q)}else U.finish();return!0}deactivateTransport(o,u,p){const _=this.activeProtocol,S=_&&_.getTransport()===o,P=o===this.pendingTransport,U=this.noTransportsScheduledForActivation();if(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+o),k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+u+(S?"; was active":P?"; was pending":"")+(U?"":"; another transport is scheduled for activation")),p&&p.message&&k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+p.message),S&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(_.getPendingMessages()),_.clearPendingMessages(),this.activeProtocol=this.host=null),this.emit("transport.inactive",o),S&&U||S&&u==="failed"||u==="closed"||_===null&&P){if(u==="disconnected"&&p&&p.statusCode>500&&this.domains.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:u,error:p,retryImmediately:!0});return}const X=u==="failed"&&ln.isTokenErr(p)?"disconnected":u;this.notifyState({state:X,error:p});return}}noTransportsScheduledForActivation(){return!this.pendingTransport||!this.pendingTransport.isConnected}setConnection(o,u,p){const _=this.connectionId;(_&&_!==o||!_&&p)&&(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==o&&k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=o,this.realtime.connection.key=this.connectionKey=u.connectionKey}clearConnection(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()}createRecoveryKey(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null}checkConnectionStateFreshness(){if(!this.lastActivity||!this.connectionId)return;const o=Date.now()-this.lastActivity;o>this.connectionStateTtl+this.maxIdleInterval&&(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+o+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}persistConnection(){if(rs()){const o=this.createRecoveryKey();o&&this.setSessionRecoverData({recoveryKey:o,disconnectedAt:Date.now(),location:kd.location,clientId:this.realtime.auth.clientId})}}unpersistConnection(){this.clearSessionRecoverData()}getActiveTransportFormat(){var o;return(o=this.activeProtocol)==null?void 0:o.getTransport().format}getError(){if(this.errorReason){const o=Ue.fromValues(this.errorReason);return o.cause=this.errorReason,o}return this.getStateError()}getStateError(){var o,u;return(u=(o=Ir)[this.state.state])==null?void 0:u.call(o)}activeState(){return this.state.queueEvents||this.state.sendEvents}enactStateChange(o){const u="Connection state",p=o.current+(o.reason?"; reason: "+o.reason:"");o.current==="failed"?k.logAction(this.logger,k.LOG_ERROR,u,p):k.logAction(this.logger,k.LOG_MAJOR,u,p),k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+o.current+"; reason = "+(o.reason&&o.reason.message));const _=this.state=this.states[o.current];o.reason&&(this.errorReason=o.reason,this.realtime.connection.errorReason=o.reason),(_.terminal||_.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",o)}startTransitionTimer(o){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+o.state),this.transitionTimer&&(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(()=>{this.transitionTimer&&(this.transitionTimer=null,k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager "+o.state+" timer expired","requesting new state: "+o.failState),this.notifyState({state:o.failState}))},o.retryDelay)}cancelTransitionTimer(){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)}startSuspendTimer(){this.suspendTimer||(this.suspendTimer=setTimeout(()=>{this.suspendTimer&&(this.suspendTimer=null,k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),this.states.connecting.failState="suspended",this.notifyState({state:"suspended"}))},this.connectionStateTtl))}checkSuspendTimer(o){o!=="disconnected"&&o!=="suspended"&&o!=="connecting"&&this.cancelSuspendTimer()}cancelSuspendTimer(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)}startRetryTimer(o){this.retryTimer=setTimeout(()=>{k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),this.retryTimer=null,this.requestState({state:"connecting"})},o)}cancelRetryTimer(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}startWebSocketSlowTimer(){this.webSocketSlowTimer=setTimeout(()=>{k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager WebSocket slow timer","checking connectivity"),this.checkWsConnectivity().then(()=>{k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager WebSocket slow timer","ws connectivity check succeeded"),this.wsCheckResult=!0}).catch(()=>{k.logAction(this.logger,k.LOG_MAJOR,"ConnectionManager WebSocket slow timer","ws connectivity check failed"),this.wsCheckResult=!1}),this.realtime.http.checkConnectivity&&Nt(this.realtime.http.checkConnectivity(),(o,u)=>{o||!u?(k.logAction(this.logger,k.LOG_MAJOR,"ConnectionManager WebSocket slow timer","http connectivity check failed"),this.cancelWebSocketGiveUpTimer(),this.notifyState({state:"disconnected",error:new K("Unable to connect (network unreachable)",80003,404)})):k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager WebSocket slow timer","http connectivity check succeeded")})},this.options.timeouts.webSocketSlowTimeout)}cancelWebSocketSlowTimer(){this.webSocketSlowTimer&&(clearTimeout(this.webSocketSlowTimer),this.webSocketSlowTimer=null)}startWebSocketGiveUpTimer(o){this.webSocketGiveUpTimer=setTimeout(()=>{var u,p;this.wsCheckResult||(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager WebSocket give up timer","websocket connection took more than 10s; "+(this.baseTransport?"trying base transport":"")),this.baseTransport?(this.abandonedWebSocket=!0,(u=this.proposedTransport)==null||u.dispose(),(p=this.pendingTransport)==null||p.dispose(),this.connectBase(o,++this.connectCounter)):k.logAction(this.logger,k.LOG_MAJOR,"ConnectionManager WebSocket give up timer","websocket connectivity appears to be unavailable but no other transports to try"))},this.options.timeouts.webSocketConnectTimeout)}cancelWebSocketGiveUpTimer(){this.webSocketGiveUpTimer&&(clearTimeout(this.webSocketGiveUpTimer),this.webSocketGiveUpTimer=null)}notifyState(o){var u,p;const _=o.state,S=_==="disconnected"&&(this.state===this.states.connected||o.retryImmediately||this.state===this.states.connecting&&o.error&&ln.isTokenErr(o.error)&&!(this.errorReason&&ln.isTokenErr(this.errorReason)));if(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+_+(S?"; will retry connection immediately":"")),_==this.state.state||(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),this.checkSuspendTimer(o.state),(_==="suspended"||_==="connected")&&(this.disconnectedRetryCount=0),this.state.terminal))return;const P=this.states[o.state];let U=P.retryDelay;P.state==="disconnected"&&(this.disconnectedRetryCount++,U=Wi(P.retryDelay,this.disconnectedRetryCount));const X=new ts(this.state.state,P.state,U,o.error||((p=(u=Ir)[P.state])==null?void 0:p.call(u)));if(S){const Q=()=>{this.state===this.states.disconnected&&(this.lastAutoReconnectAttempt=Date.now(),this.requestState({state:"connecting"}))},de=this.lastAutoReconnectAttempt&&Date.now()-this.lastAutoReconnectAttempt+1;de&&de<1e3?(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+de+"ms ago, waiting another "+(1e3-de)+"ms before trying again"),setTimeout(Q,1e3-de)):L.Config.nextTick(Q)}else(_==="disconnected"||_==="suspended")&&this.startRetryTimer(U);(_==="disconnected"&&!S||_==="suspended"||P.terminal)&&L.Config.nextTick(()=>{this.disconnectAllTransports()}),_=="connected"&&!this.activeProtocol&&k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(X),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(_,X.reason),this.failQueuedMessages(X.reason))}requestState(o){var u,p;const _=o.state;if(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+_+"; current state: "+this.state.state),_==this.state.state||(this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(_),_=="connecting"&&this.state.state=="connected")||_=="closing"&&this.state.state=="closed")return;const S=this.states[_],P=new ts(this.state.state,S.state,null,o.error||((p=(u=Ir)[S.state])==null?void 0:p.call(u)));this.enactStateChange(P),_=="connecting"&&L.Config.nextTick(()=>{this.startConnect()}),_=="closing"&&this.closeImpl()}startConnect(){if(this.state!==this.states.connecting){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}const o=this.realtime.auth,u=++this.connectCounter,p=()=>{this.checkConnectionStateFreshness(),this.getTransportParams(_=>{if(_.mode==="recover"&&_.options.recover){const S=is(_.options.recover);S&&this.realtime.channels.recoverChannels(S.channelSerials)}u===this.connectCounter&&this.connectImpl(_,u)})};if(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),o.method==="basic")p();else{const _=S=>{u===this.connectCounter&&(S?this.actOnErrorFromAuthorize(S):p())};this.errorReason&&ln.isTokenErr(this.errorReason)?Nt(o._forceNewToken(null,null),_):Nt(o._ensureValidAuthCredentials(!1),_)}}connectImpl(o,u){const p=this.state.state;if(p!==this.states.connecting.state){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect, but was "+p);return}const _=this.getTransportPreference();_&&_===this.baseTransport&&this.webSocketTransportAvailable&&this.checkWsConnectivity().then(()=>{this.unpersistTransportPreference(),this.state===this.states.connecting&&(k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.connectImpl():","web socket connectivity available, cancelling connection attempt with "+this.baseTransport),this.disconnectAllTransports(),this.connectWs(o,++this.connectCounter))}).catch(Ga),_&&_===this.baseTransport||this.baseTransport&&!this.webSocketTransportAvailable?this.connectBase(o,u):this.connectWs(o,u)}connectWs(o,u){k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.connectWs()"),this.wsCheckResult=null,this.abandonedWebSocket=!1,this.startWebSocketSlowTimer(),this.startWebSocketGiveUpTimer(o),this.tryTransportWithFallbacks("web_socket",o,!0,u,()=>this.wsCheckResult!==!1&&!this.abandonedWebSocket)}connectBase(o,u){k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.connectBase()"),this.baseTransport?this.tryTransportWithFallbacks(this.baseTransport,o,!1,u,()=>!0):this.notifyState({state:"disconnected",error:new K("No transports left to try",8e4,404)})}tryTransportWithFallbacks(o,u,p,_,S){k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.tryTransportWithFallbacks()",o);const P=ce=>{this.notifyState({state:this.states.connecting.failState,error:ce})},U=this.domains.slice(),X=(ce,Se)=>{if(_===this.connectCounter){if(!S()){Se&&Se.dispose();return}!Se&&!ce&&de()}},Q=U.shift();if(!Q){P(new K("Unable to connect (no available host)",80003,404));return}u.host=Q;const de=()=>{if(!U.length){P(new K("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!this.realtime.http.checkConnectivity){P(new Ue("Internal error: Http.checkConnectivity not set",null,500));return}Nt(this.realtime.http.checkConnectivity(),(ce,Se)=>{if(_===this.connectCounter&&S()){if(ce){P(ce);return}if(!Se){P(new K("Unable to connect (network unreachable)",80003,404));return}u.host=mt(U),this.tryATransport(u,o,X)}})};if(this.forceFallbackHost&&U.length){this.forceFallbackHost=!1,de();return}this.tryATransport(u,o,X)}closeImpl(){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),this.pendingTransport&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+this.pendingTransport),this.pendingTransport.close()),this.activeProtocol&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})}onAuthUpdated(o,u){var p;switch(this.state.state){case"connected":{k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport");const _=(p=this.activeProtocol)==null?void 0:p.getTransport();_&&_.onAuthUpdated&&_.onAuthUpdated(o);const S=Cn({action:we.AUTH,auth:{accessToken:o.token}});this.send(S);const P=()=>{this.off(U),u(null,o)},U=X=>{X.current==="failed"&&(this.off(P),this.off(U),u(X.reason||this.getStateError()))};this.once("connectiondetails",P),this.on("connectionstate",U);break}case"connecting":k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");const _=S=>{switch(S.current){case"connected":this.off(_),u(null,o);break;case"failed":case"closed":case"suspended":this.off(_),u(S.reason||this.getStateError());break}};this.on("connectionstate",_),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}}disconnectAllTransports(){k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"),this.connectCounter++,this.pendingTransport&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+this.pendingTransport),this.pendingTransport.disconnect()),delete this.pendingTransport,this.proposedTransport&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting proposed transport: "+this.pendingTransport),this.proposedTransport.disconnect()),delete this.pendingTransport,this.activeProtocol&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())}send(o,u,p){p=p||Ga;const _=this.state;if(_.sendEvents){k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new Ha(o,p));return}if(!(u&&_.queueEvents)){const P="rejecting event, queueEvent was "+u+", state was "+_.state;k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.send()",P),p(this.errorReason||new K(P,9e4,400));return}this.logger.shouldLog(k.LOG_MICRO)&&k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+Wa(o,this.realtime._RealtimePresence,this.realtime._Annotations,this.realtime._objectsPlugin)),this.queue(o,p)}sendImpl(o){const u=o.message;o.ackRequired&&!o.sendAttempted&&(u.msgSerial=this.msgSerial++);try{this.activeProtocol.send(o)}catch(p){k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+p.stack)}}queue(o,u){k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.queue()","queueing event");const p=this.queuedMessages.last(),_=this.options.maxMessageSize;p&&!p.sendAttempted&&Sp(p.message,o,_)?(p.merged||(p.callback=hr.create(this.logger,[p.callback]),p.merged=!0),p.callback.push(u)):this.queuedMessages.push(new Ha(o,u))}sendQueuedMessages(){k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");let o;for(;o=this.queuedMessages.shift();)this.sendImpl(o)}queuePendingMessages(o){o&&o.length&&(k.logAction(this.logger,k.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+o.length+" pending messages"),this.queuedMessages.prepend(o))}failQueuedMessages(o){const u=this.queuedMessages.count();u>0&&(k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+u+" queued messages, err = "+Ze(o)),this.queuedMessages.completeAllMessages(o))}onChannelMessage(o,u){this.pendingChannelMessagesState.queue.push({message:o,transport:u}),this.pendingChannelMessagesState.isProcessing||this.processNextPendingChannelMessage()}processNextPendingChannelMessage(){if(this.pendingChannelMessagesState.queue.length>0){this.pendingChannelMessagesState.isProcessing=!0;const o=this.pendingChannelMessagesState.queue.shift();this.processChannelMessage(o.message).catch(u=>{k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.processNextPendingChannelMessage() received error ",u)}).finally(()=>{this.pendingChannelMessagesState.isProcessing=!1,this.processNextPendingChannelMessage()})}}async processChannelMessage(o){await this.realtime.channels.processChannelMessage(o)}async ping(){var o;if(this.state.state!=="connected")throw new K("Unable to ping service; not connected",4e4,400);const u=(o=this.activeProtocol)==null?void 0:o.getTransport();if(!u)throw this.getStateError();k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.ping()","transport = "+u);const p=Date.now(),_=Jt();return Nn(new Promise(S=>{const P=U=>{U===_&&(u.off("heartbeat",P),S(Date.now()-p))};u.on("heartbeat",P),u.ping(_)}),this.options.timeouts.realtimeRequestTimeout,"Timeout waiting for heartbeat response")}abort(o){this.activeProtocol.getTransport().fail(o)}getTransportPreference(){var o,u;return this.transportPreference||xr()&&((u=(o=L.WebStorage)==null?void 0:o.get)==null?void 0:u.call(o,pl))}persistTransportPreference(o){var u,p;this.transportPreference=o.shortName,xr()&&((p=(u=L.WebStorage)==null?void 0:u.set)==null||p.call(u,pl,o.shortName))}unpersistTransportPreference(){var o,u;this.transportPreference=null,xr()&&((u=(o=L.WebStorage)==null?void 0:o.remove)==null||u.call(o,pl))}actOnErrorFromAuthorize(o){if(o.code===40171)this.notifyState({state:"failed",error:o});else if(o.code===40102)this.notifyState({state:"failed",error:o});else if(o.statusCode===wi.Forbidden){const u="Client configured authentication provider returned 403; failing the connection";k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",u),this.notifyState({state:"failed",error:new K(u,80019,403,o)})}else{const u="Client configured authentication provider request failed";k.logAction(this.logger,k.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",u),this.notifyState({state:this.state.failState,error:new K(u,80019,401,o)})}}onConnectionDetailsUpdate(o,u){if(!o)return;this.connectionDetails=o,o.maxMessageSize&&(this.options.maxMessageSize=o.maxMessageSize);const p=o.clientId;if(p){const S=this.realtime.auth._uncheckedSetClientId(p);if(S){k.logAction(this.logger,k.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",S.message),u.fail(S);return}}const _=o.connectionStateTtl;_&&(this.connectionStateTtl=_),this.maxIdleInterval=o.maxIdleInterval,this.emit("connectiondetails",o)}checkWsConnectivity(){const o=this.options.wsConnectivityCheckUrl||qe.wsConnectivityCheckUrl,u=new L.Config.WebSocket(o);return new Promise((p,_)=>{let S=!1;u.onopen=()=>{S||(S=!0,p(),u.close())},u.onclose=u.onerror=()=>{S||(S=!0,_())}})}sessionRecoveryName(){return this.options.recoveryKeyStorageName||"ably-connection-recovery"}getSessionRecoverData(){var o,u;return rs()&&((u=(o=L.WebStorage)==null?void 0:o.getSession)==null?void 0:u.call(o,this.sessionRecoveryName()))}setSessionRecoverData(o){var u,p;return rs()&&((p=(u=L.WebStorage)==null?void 0:u.setSession)==null?void 0:p.call(u,this.sessionRecoveryName(),o))}clearSessionRecoverData(){var o,u;return rs()&&((u=(o=L.WebStorage)==null?void 0:o.removeSession)==null?void 0:u.call(o,this.sessionRecoveryName()))}},gl=Cd,kt=class extends St{constructor(s,o){super(s.logger),this.whenState=u=>St.prototype.whenState.call(this,u,this.state),this.ably=s,this.connectionManager=new gl(s,o),this.state=this.connectionManager.state.state,this.key=void 0,this.id=void 0,this.errorReason=null,this.connectionManager.on("connectionstate",u=>{const p=this.state=u.current;L.Config.nextTick(()=>{this.emit(p,u)})}),this.connectionManager.on("update",u=>{L.Config.nextTick(()=>{this.emit("update",u)})})}connect(){k.logAction(this.logger,k.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})}async ping(){return k.logAction(this.logger,k.LOG_MINOR,"Connection.ping()",""),this.connectionManager.ping()}close(){k.logAction(this.logger,k.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})}get recoveryKey(){return this.logger.deprecationWarning("The `Connection.recoveryKey` attribute has been replaced by the `Connection.createRecoveryKey()` method. Replace your usage of `recoveryKey` with the return value of `createRecoveryKey()`. `recoveryKey` will be removed in a future version."),this.createRecoveryKey()}createRecoveryKey(){return this.connectionManager.createRecoveryKey()}},ml=kt,Xo=class Y0 extends Rr{constructor(o){var u,p,_,S;if(super(qe.objectifyOptions(o,!1,"BaseRealtime",k.defaultLogger)),k.logAction(this.logger,k.LOG_MINOR,"Realtime()",""),typeof EdgeRuntime=="string")throw new K(`Ably.Realtime instance cannot be used in Vercel Edge runtime. If you are running Vercel Edge functions, please replace your "new Ably.Realtime()" with "new Ably.Rest()" and use Ably Rest API instead of the Realtime API. If you are server-rendering your application in the Vercel Edge runtime, please use the condition "if (typeof EdgeRuntime === 'string')" to prevent instantiating Ably.Realtime instance during SSR in the Vercel Edge runtime.`,4e4,400);this._additionalTransportImplementations=Y0.transportImplementationsFromPlugins(this.options.plugins),this._RealtimePresence=(p=(u=this.options.plugins)==null?void 0:u.RealtimePresence)!=null?p:null,this._objectsPlugin=(S=(_=this.options.plugins)==null?void 0:_.Objects)!=null?S:null,this.connection=new ml(this,this.options),this._channels=new Ed(this),this.options.autoConnect!==!1&&this.connect()}static transportImplementationsFromPlugins(o){const u={};return o?.WebSocketTransport&&(u[un.WebSocket]=o.WebSocketTransport),o?.XHRPolling&&(u[un.XhrPolling]=o.XHRPolling),u}get channels(){return this._channels}connect(){k.logAction(this.logger,k.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()}close(){k.logAction(this.logger,k.LOG_MINOR,"Realtime.close()",""),this.connection.close()}};Xo.EventEmitter=St;var Zo=Xo,Ed=class extends St{constructor(s){super(s.logger),this.realtime=s,this.all=Object.create(null),s.connection.connectionManager.on("transport.active",()=>{this.onTransportActive()})}channelSerials(){let s={};for(const o of $e(this.all,!0)){const u=this.all[o];u.properties.channelSerial&&(s[o]=u.properties.channelSerial)}return s}recoverChannels(s){for(const o of $e(s,!0)){const u=this.get(o);u.properties.channelSerial=s[o]}}async processChannelMessage(s){const o=s.channel;if(o===void 0){k.logAction(this.logger,k.LOG_ERROR,"Channels.processChannelMessage()","received event unspecified channel, action = "+s.action);return}const u=this.all[o];if(!u){k.logAction(this.logger,k.LOG_ERROR,"Channels.processChannelMessage()","received event for non-existent channel: "+o);return}await u.processMessage(s)}onTransportActive(){for(const s in this.all){const o=this.all[s];o.state==="attaching"||o.state==="detaching"?o.checkPendingState():o.state==="suspended"?o._attach(!1,null):o.state==="attached"&&o.requestState("attaching")}}propogateConnectionInterruption(s,o){const u={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},p=["attaching","attached","detaching","suspended"],_=u[s];for(const S in this.all){const P=this.all[S];p.includes(P.state)&&P.notifyState(_,o)}}get(s,o){s=String(s);let u=this.all[s];if(!u)u=this.all[s]=new $s(this.realtime,s,o);else if(o){if(u._shouldReattachToSetOptions(o,u.channelOptions))throw new K("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);u.setOptions(o)}return u}getDerived(s,o,u){if(o.filter){const p=Kn(o.filter),_=mi(s);s=`[filter=${p}${_.qualifierParam}]${_.channelName}`}return this.get(s,u)}release(s){s=String(s);const o=this.all[s];if(!o)return;const u=o.getReleaseErr();if(u)throw u;delete this.all[s]}},vl=Zo;function ea(s,o){if(s.isSynthesized()||o.isSynthesized())return s.timestamp>=o.timestamp;const u=s.parseId(),p=o.parseId();return u.msgSerial===p.msgSerial?u.index>p.index:u.msgSerial>p.msgSerial}var qs=class extends St{constructor(s,o,u=ea){super(s.logger),this.presence=s,this.map=Object.create(null),this.syncInProgress=!1,this.residualMembers=null,this.memberKey=o,this.newerThan=u}get(s){return this.map[s]}getClient(s){const o=this.map,u=[];for(const p in o){const _=o[p];_.clientId==s&&_.action!="absent"&&u.push(_)}return u}list(s){const o=this.map,u=s&&s.clientId,p=s&&s.connectionId,_=[];for(const S in o){const P=o[S];P.action!=="absent"&&(u&&u!=P.clientId||p&&p!=P.connectionId||_.push(P))}return _}put(s){(s.action==="enter"||s.action==="update")&&(s=Ti.fromValues(s),s.action="present");const o=this.map,u=this.memberKey(s);this.residualMembers&&delete this.residualMembers[u];const p=o[u];return p&&!this.newerThan(s,p)?!1:(o[u]=s,!0)}values(){const s=this.map,o=[];for(const u in s){const p=s[u];p.action!="absent"&&o.push(p)}return o}remove(s){const o=this.map,u=this.memberKey(s),p=o[u];return p&&!this.newerThan(s,p)?!1:(this.syncInProgress?(s=Ti.fromValues(s),s.action="absent",o[u]=s):delete o[u],!!p)}startSync(){const s=this.map,o=this.syncInProgress;k.logAction(this.logger,k.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+o),this.syncInProgress||(this.residualMembers=he(s),this.setInProgress(!0))}endSync(){const s=this.map,o=this.syncInProgress;if(k.logAction(this.logger,k.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+o),o){for(const u in s)s[u].action==="absent"&&delete s[u];this.presence._synthesizeLeaves(Xe(this.residualMembers));for(const u in this.residualMembers)delete s[u];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")}waitSync(s){const o=this.syncInProgress;if(k.logAction(this.logger,k.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+o),!o){s();return}this.once("sync",s)}clear(){this.map={},this.setInProgress(!1),this.residualMembers=null}setInProgress(s){k.logAction(this.logger,k.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+s),this.syncInProgress=s,this.presence.syncComplete=!s}};function Ws(s){return s.channel.client.auth.clientId}function Ja(s){const o=s.channel.client,u=o.auth.clientId;return(!u||u==="*")&&o.connection.state==="connected"}function Cp(s,o,u){switch(s.state){case"attached":case"suspended":u();break;case"initialized":case"detached":case"detaching":case"attaching":Nt(s.attach(),function(p){p?o(p):u()});break;default:o(K.fromValues(s.invalidStateError()))}}var Ep=class extends St{constructor(s){super(s.logger),this.channel=s,this.syncComplete=!1,this.members=new qs(this,o=>o.clientId+":"+o.connectionId),this._myMembers=new qs(this,o=>o.clientId),this.subscriptions=new St(this.logger),this.pendingPresence=[]}async enter(s){if(Ja(this))throw new K("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,s,"enter")}async update(s){if(Ja(this))throw new K("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,s,"update")}async enterClient(s,o){return this._enterOrUpdateClient(void 0,s,o,"enter")}async updateClient(s,o){return this._enterOrUpdateClient(void 0,s,o,"update")}async _enterOrUpdateClient(s,o,u,p){const _=this.channel;if(!_.connectionManager.activeState())throw _.connectionManager.getError();k.logAction(this.logger,k.LOG_MICRO,"RealtimePresence."+p+"Client()","channel = "+_.name+", id = "+s+", client = "+(o||"(implicit) "+Ws(this)));const S=Ti.fromData(u);S.action=p,s&&(S.id=s),o&&(S.clientId=o);const P=await S.encode(_.channelOptions);switch(_.state){case"attached":return _.sendPresence([P]);case"initialized":case"detached":_.attach();case"attaching":return new Promise((U,X)=>{this.pendingPresence.push({presence:P,callback:Q=>Q?X(Q):U()})});default:{const U=new Ue("Unable to "+p+" presence channel while in "+_.state+" state",90001);throw U.code=90001,U}}}async leave(s){if(Ja(this))throw new K("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,s)}async leaveClient(s,o){const u=this.channel;if(!u.connectionManager.activeState())throw u.connectionManager.getError();k.logAction(this.logger,k.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+s);const p=Ti.fromData(o);p.action="leave",s&&(p.clientId=s);const _=await p.encode(u.channelOptions);switch(u.state){case"attached":return u.sendPresence([_]);case"attaching":return new Promise((S,P)=>{this.pendingPresence.push({presence:_,callback:U=>U?P(U):S()})});case"initialized":case"failed":throw new Ue("Unable to leave presence channel (incompatible state)",90001);default:throw u.invalidStateError()}}async get(s){const o=!s||("waitForSync"in s?s.waitForSync:!0);return new Promise((u,p)=>{function _(S){u(s?S.list(s):S.values())}if(this.channel.state==="suspended"){o?p(K.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):_(this.members);return}Cp(this.channel,S=>p(S),()=>{const S=this.members;o?S.waitSync(function(){_(S)}):_(S)})})}async history(s){k.logAction(this.logger,k.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name);const o=this.channel.client.rest.presenceMixin;if(s&&s.untilAttach)if(this.channel.state==="attached")delete s.untilAttach,s.from_serial=this.channel.properties.attachSerial;else throw new K("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400);return o.history(this,s)}setPresence(s,o,u){k.logAction(this.logger,k.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+s.length+" participants; syncChannelSerial = "+u);let p,_;const S=this.members,P=this._myMembers,U=[],X=this.channel.connectionManager.connectionId;o&&(this.members.startSync(),u&&(_=u.match(/^[\w-]+:(.*)$/))&&(p=_[1]));for(let Q of s)switch(Q.action){case"leave":S.remove(Q)&&U.push(Q),Q.connectionId===X&&!Q.isSynthesized()&&P.remove(Q);break;case"enter":case"present":case"update":S.put(Q)&&U.push(Q),Q.connectionId===X&&P.put(Q);break}o&&!p&&(S.endSync(),this.channel.syncChannelSerial=null);for(let Q=0;Q<U.length;Q++){const de=U[Q];this.subscriptions.emit(de.action,de)}}onAttached(s){k.logAction(this.logger,k.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+s),s?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();const o=this.pendingPresence,u=o.length;if(u){this.pendingPresence=[];const p=[],_=hr.create(this.logger);k.logAction(this.logger,k.LOG_MICRO,"RealtimePresence.onAttached","sending "+u+" queued presence messages");for(let S=0;S<u;S++){const P=o[S];p.push(P.presence),_.push(P.callback)}this.channel.sendPresence(p).then(()=>_()).catch(S=>_(S))}}actOnChannelState(s,o,u){switch(s){case"attached":this.onAttached(o);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(u);break}}failPendingPresence(s){if(this.pendingPresence.length){k.logAction(this.logger,k.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+Ze(s));for(let o=0;o<this.pendingPresence.length;o++)try{this.pendingPresence[o].callback(s)}catch{}this.pendingPresence=[]}}_clearMyMembers(){this._myMembers.clear()}_ensureMyMembersPresent(){const s=this._myMembers,o=this.channel.connectionManager.connectionId;for(const u in s.map){const p=s.map[u];k.logAction(this.logger,k.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+p.clientId+'" into the presence set');const _=p.connectionId===o?p.id:void 0;this._enterOrUpdateClient(_,p.clientId,p.data,"enter").catch(S=>{const P=new K("Presence auto re-enter failed",91004,400,S);k.logAction(this.logger,k.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()","Presence auto re-enter failed; reason = "+Ze(S));const U=new cl(this.channel.state,this.channel.state,!0,!1,P);this.channel.emit("update",U)})}}_synthesizeLeaves(s){const o=this.subscriptions;s.forEach(function(u){const p=Ti.fromValues({action:"leave",connectionId:u.connectionId,clientId:u.clientId,data:u.data,encoding:u.encoding,timestamp:Date.now()});o.emit("leave",p)})}async subscribe(...s){const o=$s.processListenerArgs(s),u=o[0],p=o[1],_=this.channel;if(_.state==="failed")throw K.fromValues(_.invalidStateError());this.subscriptions.on(u,p),_.channelOptions.attachOnSubscribe!==!1&&await _.attach()}unsubscribe(...s){const o=$s.processListenerArgs(s),u=o[0],p=o[1];this.subscriptions.off(u,p)}},Md=Ep,Qa=un.WebSocket;function Ka(s){return!!s.on}var yl=class extends ns{constructor(s,o,u){super(s,o,u),this.shortName=Qa,u.heartbeats=L.Config.useProtocolHeartbeats,this.wsHost=u.host}static isAvailable(){return!!L.Config.WebSocket}createWebSocket(s,o){return this.uri=s+At(o),new L.Config.WebSocket(this.uri)}toString(){return"WebSocketTransport; uri="+this.uri}connect(){k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.connect()","starting"),ns.prototype.connect.call(this);const s=this,o=this.params,u=o.options,_=(u.tls?"wss://":"ws://")+this.wsHost+":"+qe.getPort(u)+"/";k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.connect()","uri: "+_),Nt(this.auth.getAuthParams(),function(S,P){if(s.isDisposed)return;let U="";for(const Q in P)U+=" "+Q+": "+P[Q]+";";if(k.logAction(s.logger,k.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+U+" err: "+S),S){s.disconnect(S);return}const X=o.getConnectParams(P);try{const Q=s.wsConnection=s.createWebSocket(_,X);Q.binaryType=L.Config.binaryType,Q.onopen=function(){s.onWsOpen()},Q.onclose=function(de){s.onWsClose(de)},Q.onmessage=function(de){s.onWsData(de.data)},Q.onerror=function(de){s.onWsError(de)},Ka(Q)&&Q.on("ping",function(){s.onActivity()})}catch(Q){k.logAction(s.logger,k.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(Q.stack||Q.message)),s.disconnect(Q)}})}send(s){const o=this.wsConnection;if(!o){k.logAction(this.logger,k.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{o.send(yp(s,this.connectionManager.realtime._MsgPack,this.params.format))}catch(u){const p="Exception from ws connection when trying to send: "+Ze(u);k.logAction(this.logger,k.LOG_ERROR,"WebSocketTransport.send()",p),this.finish("disconnected",new K(p,5e4,500))}}onWsData(s){k.logAction(this.logger,k.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+s.length+"; type = "+typeof s);try{this.onProtocolMessage(sl(s,this.connectionManager.realtime._MsgPack,this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin,this.format))}catch(o){k.logAction(this.logger,k.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+o.stack)}}onWsOpen(){k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")}onWsClose(s){let o,u;if(typeof s=="object"?(u=s.code,o=s.wasClean||u===1e3):(u=s,o=u==1e3),delete this.wsConnection,o){k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");const p=new K("Websocket closed",80003,400);this.finish("disconnected",p)}else{const p="Unclean disconnection of WebSocket ; code = "+u,_=new K(p,80003,400);k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.onWsClose()",p),this.finish("disconnected",_)}this.emit("disposed")}onWsError(s){k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+s.message),L.Config.nextTick(()=>{this.disconnect(Error(s.message))})}dispose(){k.logAction(this.logger,k.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;const s=this.wsConnection;s&&(s.onmessage=function(){},delete this.wsConnection,L.Config.nextTick(()=>{if(k.logAction(this.logger,k.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!s)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");s.close()}))}},Ya=yl,_l=class{static subscribeFilter(s,o,u){const p=_=>{var S,P,U,X,Q,de;const ce={name:_.name,refTimeserial:(P=(S=_.extras)==null?void 0:S.ref)==null?void 0:P.timeserial,refType:(X=(U=_.extras)==null?void 0:U.ref)==null?void 0:X.type,isRef:!!((de=(Q=_.extras)==null?void 0:Q.ref)!=null&&de.timeserial),clientId:_.clientId};Object.entries(o).find(([Se,ue])=>ue!==void 0?ce[Se]!==ue:!1)||u(_)};this.addFilteredSubscription(s,o,u,p),s.subscriptions.on(p)}static addFilteredSubscription(s,o,u,p){var _;if(s.filteredSubscriptions||(s.filteredSubscriptions=new Map),s.filteredSubscriptions.has(u)){const S=s.filteredSubscriptions.get(u);S.set(o,((_=S?.get(o))==null?void 0:_.concat(p))||[p])}else s.filteredSubscriptions.set(u,new Map([[o,[p]]]))}static getAndDeleteFilteredSubscriptions(s,o,u){if(!s.filteredSubscriptions)return[];if(!u&&o)return Array.from(s.filteredSubscriptions.entries()).map(([S,P])=>{var U;let X=P.get(o);return P.delete(o),P.size===0&&((U=s.filteredSubscriptions)==null||U.delete(S)),X}).reduce((S,P)=>P?S.concat(...P):S,[]);if(!u||!s.filteredSubscriptions.has(u))return[];const p=s.filteredSubscriptions.get(u);if(!o){const S=Array.from(p.values()).reduce((P,U)=>P.concat(...U),[]);return s.filteredSubscriptions.delete(u),S}let _=p.get(o);return p.delete(o),_||[]}},En=class bg extends vl{constructor(o){var u;const p=bg._MsgPack;if(!p)throw new Error("Expected DefaultRealtime._MsgPack to have been set");super(qe.objectifyOptions(o,!0,"Realtime",k.defaultLogger,A(I({},Ds),{Crypto:(u=bg.Crypto)!=null?u:void 0,MsgPack:p,RealtimePresence:{RealtimePresence:Md,PresenceMessage:Ti,WirePresenceMessage:Ns},Annotations:{Annotation:Go,WireAnnotation:Bs,RealtimeAnnotations:ul,RestAnnotations:zs},WebSocketTransport:Ya,MessageInteractions:_l})))}static get Crypto(){if(this._Crypto===null)throw new Error("Encryption not enabled; use ably.encryption.js instead");return this._Crypto}static set Crypto(o){this._Crypto=o}};En.Utils=ze,En.ConnectionManager=gl,En.ProtocolMessage=_p,En._Crypto=null,En.Message=fd,En.PresenceMessage=el,En.Annotation=rl,En._MsgPack=null,En._Http=As,En._PresenceMap=qs,En._MessageEncoding=Qi;var wl=En,Xa=Uint8Array,ta=Uint32Array,bl=Math.pow,Za=new ta(8),Xr=[],Hs=new ta(64);function ss(s){return(s-(s|0))*bl(2,32)|0}for(var Mn=2,Zr=0;Zr<64;){for(mr=!0,Gs=2;Gs<=Mn/2;Gs++)Mn%Gs===0&&(mr=!1);mr&&(Zr<8&&(Za[Zr]=ss(bl(Mn,1/2))),Xr[Zr]=ss(bl(Mn,1/3)),Zr++),Mn++}var mr,Gs,Mp=!!new Xa(new ta([1]).buffer)[0];function Sl(s){return Mp?s>>>24|(s>>>16&255)<<8|(s&65280)<<8|s<<24:s}function nn(s,o){return s>>>o|s<<32-o}function Ai(s){var o=Za.slice(),u=s.length,p=u*8,_=512-(p+64)%512-1+p+65,S=new Xa(_/8),P=new ta(S.buffer);S.set(s,0),S[u]=128,P[P.length-1]=Sl(p);for(var U,X=0;X<_/32;X+=16){var Q=o.slice();for(U=0;U<64;U++){var de;if(U<16)de=Sl(P[X+U]);else{var ce=Hs[U-15],Se=Hs[U-2];de=Hs[U-7]+Hs[U-16]+(nn(ce,7)^nn(ce,18)^ce>>>3)+(nn(Se,17)^nn(Se,19)^Se>>>10)}Hs[U]=de|=0;for(var ue=(nn(Q[4],6)^nn(Q[4],11)^nn(Q[4],25))+(Q[4]&Q[5]^~Q[4]&Q[6])+Q[7]+de+Xr[U],Te=(nn(Q[0],2)^nn(Q[0],13)^nn(Q[0],22))+(Q[0]&Q[1]^Q[2]&(Q[0]^Q[1])),Re=7;Re>0;Re--)Q[Re]=Q[Re-1];Q[0]=ue+Te|0,Q[4]=Q[4]+ue|0}for(U=0;U<8;U++)o[U]=o[U]+Q[U]|0}return new Xa(new ta(o.map(function(De){return Sl(De)})).buffer)}function Js(s,o){if(s.length>64&&(s=Ai(s)),s.length<64){const U=new Uint8Array(64);U.set(s,0),s=U}for(var u=new Uint8Array(64),p=new Uint8Array(64),_=0;_<64;_++)u[_]=54^s[_],p[_]=92^s[_];var S=new Uint8Array(o.length+64);S.set(u,0),S.set(o,64);var P=new Uint8Array(96);return P.set(p,0),P.set(Ai(S),64),Ai(P)}var ec=class{constructor(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}uint8ViewToBase64(s){let o="";const u=this.base64CharSet,p=s.byteLength,_=p%3,S=p-_;let P,U,X,Q,de;for(let ce=0;ce<S;ce=ce+3)de=s[ce]<<16|s[ce+1]<<8|s[ce+2],P=(de&16515072)>>18,U=(de&258048)>>12,X=(de&4032)>>6,Q=de&63,o+=u[P]+u[U]+u[X]+u[Q];return _==1?(de=s[S],P=(de&252)>>2,U=(de&3)<<4,o+=u[P]+u[U]+"=="):_==2&&(de=s[S]<<8|s[S+1],P=(de&64512)>>10,U=(de&1008)>>4,X=(de&15)<<2,o+=u[P]+u[U]+u[X]+"="),o}base64ToArrayBuffer(s){const o=atob?.(s),u=o.length,p=new Uint8Array(u);for(let _=0;_<u;_++){const S=o.charCodeAt(_);p[_]=S}return this.toArrayBuffer(p)}isBuffer(s){return s instanceof ArrayBuffer||ArrayBuffer.isView(s)}toBuffer(s){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(this.toArrayBuffer(s));throw new Error("BufferUtils.toBuffer expected an ArrayBuffer or a view onto one")}toArrayBuffer(s){if(!ArrayBuffer)throw new Error("Can't convert to ArrayBuffer: browser does not support the necessary types");if(s instanceof ArrayBuffer)return s;if(ArrayBuffer.isView(s))return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength);throw new Error("BufferUtils.toArrayBuffer expected an ArrayBuffer or a view onto one")}base64Encode(s){return this.uint8ViewToBase64(this.toBuffer(s))}base64UrlEncode(s){return this.base64Encode(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}base64Decode(s){if(ArrayBuffer&&L.Config.atob)return this.base64ToArrayBuffer(s);throw new Error("Expected ArrayBuffer to exist and Platform.Config.atob to be configured")}hexEncode(s){return this.toBuffer(s).reduce((u,p)=>u+p.toString(16).padStart(2,"0"),"")}hexDecode(s){if(s.length%2!==0)throw new Error("Can't create a byte array from a hex string of odd length");const o=new Uint8Array(s.length/2);for(let u=0;u<o.length;u++)o[u]=parseInt(s.slice(2*u,2*(u+1)),16);return this.toArrayBuffer(o)}utf8Encode(s){if(L.Config.TextEncoder){const o=new L.Config.TextEncoder().encode(s);return this.toArrayBuffer(o)}else throw new Error("Expected TextEncoder to be configured")}utf8Decode(s){if(!this.isBuffer(s))throw new Error("Expected input of utf8decode to be an arraybuffer or typed array");if(TextDecoder)return new TextDecoder().decode(s);throw new Error("Expected TextDecoder to be configured")}areBuffersEqual(s,o){if(!s||!o)return!1;const u=this.toArrayBuffer(s),p=this.toArrayBuffer(o);if(u.byteLength!=p.byteLength)return!1;const _=new Uint8Array(u),S=new Uint8Array(p);for(var P=0;P<_.length;P++)if(_[P]!=S[P])return!1;return!0}byteLength(s){return s instanceof ArrayBuffer||ArrayBuffer.isView(s)?s.byteLength:-1}arrayBufferViewToBuffer(s){return this.toArrayBuffer(s)}concat(s){const o=s.reduce((_,S)=>_+S.byteLength,0),u=new Uint8Array(o);let p=0;for(const _ of s){const S=this.toBuffer(_);u.set(S,p),p+=S.byteLength}return u.buffer}sha256(s){const o=Ai(this.toBuffer(s));return this.toArrayBuffer(o)}hmacSha256(s,o){const u=Js(this.toBuffer(o),this.toBuffer(s));return this.toArrayBuffer(u)}},tc=new ec,Qs=function(s,o){var u="aes",p=256,_="cbc",S=16;function P(Se){if(Se.algorithm==="aes"&&Se.mode==="cbc"){if(Se.keyLength===128||Se.keyLength===256)return;throw new Error("Unsupported key length "+Se.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function U(Se){return Se.replace("_","/").replace("-","+")}function X(Se){return Se instanceof Q}class Q{constructor(ue,Te,Re,De){this.algorithm=ue,this.keyLength=Te,this.mode=Re,this.key=De}}class de{static getDefaultParams(ue){var Te;if(!ue.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof ue.key=="string"?Te=o.toArrayBuffer(o.base64Decode(U(ue.key))):ue.key instanceof ArrayBuffer?Te=ue.key:Te=o.toArrayBuffer(ue.key);var Re=ue.algorithm||u,De=Te.byteLength*8,lt=ue.mode||_,ft=new Q(Re,De,lt,Te);if(ue.keyLength&&ue.keyLength!==ft.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+ue.keyLength+" was specified, but the key actually has length "+ft.keyLength);return P(ft),ft}static async generateRandomKey(ue){try{return s.getRandomArrayBuffer((ue||p)/8)}catch(Te){throw new K("Failed to generate random key: "+Te.message,400,5e4,Te)}}static getCipher(ue,Te){var Re,De=X(ue)?ue:this.getDefaultParams(ue);return{cipherParams:De,cipher:new ce(De,(Re=ue.iv)!=null?Re:null,Te)}}}de.CipherParams=Q;class ce{constructor(ue,Te,Re){if(this.logger=Re,!crypto.subtle)throw isSecureContext?new Error("Crypto operations are not possible since the browsers SubtleCrypto class is unavailable (reason unknown)."):new Error("Crypto operations are is not possible since the current environment is a non-secure context and hence the browsers SubtleCrypto class is not available.");this.algorithm=ue.algorithm+"-"+String(ue.keyLength)+"-"+ue.mode,this.webCryptoAlgorithm=ue.algorithm+"-"+ue.mode,this.key=o.toArrayBuffer(ue.key),this.iv=Te?o.toArrayBuffer(Te):null}concat(ue,Te){const Re=new ArrayBuffer(ue.byteLength+Te.byteLength),De=new DataView(Re),lt=new DataView(o.toArrayBuffer(ue));for(let We=0;We<lt.byteLength;We++)De.setInt8(We,lt.getInt8(We));const ft=new DataView(o.toArrayBuffer(Te));for(let We=0;We<ft.byteLength;We++)De.setInt8(lt.byteLength+We,ft.getInt8(We));return Re}async encrypt(ue){k.logAction(this.logger,k.LOG_MICRO,"CBCCipher.encrypt()","");const Te=await this.getIv(),Re=await crypto.subtle.importKey("raw",this.key,this.webCryptoAlgorithm,!1,["encrypt"]),De=await crypto.subtle.encrypt({name:this.webCryptoAlgorithm,iv:Te},Re,ue);return this.concat(Te,De)}async decrypt(ue){k.logAction(this.logger,k.LOG_MICRO,"CBCCipher.decrypt()","");const Te=o.toArrayBuffer(ue),Re=Te.slice(0,S),De=Te.slice(S),lt=await crypto.subtle.importKey("raw",this.key,this.webCryptoAlgorithm,!1,["decrypt"]);return crypto.subtle.decrypt({name:this.webCryptoAlgorithm,iv:Re},lt,De)}async getIv(){if(this.iv){var ue=this.iv;return this.iv=null,ue}const Te=await s.getRandomArrayBuffer(S);return o.toArrayBuffer(Te)}}return de},ei=(s=>(s[s.REQ_SEND=0]="REQ_SEND",s[s.REQ_RECV=1]="REQ_RECV",s[s.REQ_RECV_POLL=2]="REQ_RECV_POLL",s[s.REQ_RECV_STREAM=3]="REQ_RECV_STREAM",s))(ei||{}),ct=ei;function vt(){return new K("No HTTP request plugin provided. Provide at least one of the FetchRequest or XHRRequest plugins.",400,4e4)}var er,Kt=(er=class{constructor(s){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1;var o;this.client=s??null;const u=s?.options.connectivityCheckUrl||qe.connectivityCheckUrl,p=(o=s?.options.connectivityCheckParams)!=null?o:null,_=!s?.options.connectivityCheckUrl,S=I(I({},Kt.bundledRequestImplementations),s?._additionalHTTPRequestImplementations),P=S.XHRRequest,U=S.FetchRequest,X=!!(P||U);if(!X)throw vt();L.Config.xhrSupported&&P?(this.supportsAuthHeaders=!0,this.Request=async function(Q,de,ce,Se,ue){return new Promise(Te=>{var Re;const De=P.createRequest(de,ce,Se,ue,ct.REQ_SEND,(Re=s&&s.options.timeouts)!=null?Re:null,this.logger,Q);De.once("complete",(lt,ft,We,He,fn)=>Te({error:lt,body:ft,headers:We,unpacked:He,statusCode:fn})),De.exec()})},s?.options.disableConnectivityCheck?this.checkConnectivity=async function(){return!0}:this.checkConnectivity=async function(){var Q;k.logAction(this.logger,k.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+u);const de=await this.doUri(Ot.Get,u,null,null,p);let ce=!1;return _?ce=!de.error&&((Q=de.body)==null?void 0:Q.replace(/\n/,""))=="yes":ce=!de.error&&qc(de.statusCode),k.logAction(this.logger,k.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+ce),ce}):L.Config.fetchSupported&&U?(this.supportsAuthHeaders=!0,this.Request=async(Q,de,ce,Se,ue)=>U(Q,s??null,de,ce,Se,ue),s?.options.disableConnectivityCheck?this.checkConnectivity=async function(){return!0}:this.checkConnectivity=async function(){var Q;k.logAction(this.logger,k.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+u);const de=await this.doUri(Ot.Get,u,null,null,null),ce=!de.error&&((Q=de.body)==null?void 0:Q.replace(/\n/,""))=="yes";return k.logAction(this.logger,k.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+ce),ce}):this.Request=async()=>({error:X?new Ue("no supported HTTP transports available",null,400):vt()})}get logger(){var s,o;return(o=(s=this.client)==null?void 0:s.logger)!=null?o:k.defaultLogger}async doUri(s,o,u,p,_){return this.Request?this.Request(s,o,u,_,p):{error:new Ue("Request invoked before assigned to",null,500)}}shouldFallback(s){const o=s.statusCode;return o===408&&!s.code||o===400&&!s.code||o>=500&&o<=504}},er.methods=[Ot.Get,Ot.Delete,Ot.Post,Ot.Put,Ot.Patch],er.methodsWithoutBody=[Ot.Get,Ot.Delete],er.methodsWithBody=[Ot.Post,Ot.Put,Ot.Patch],er),dn=Kt,tr="ablyjs-storage-test",vr=typeof ls<"u"?ls:typeof window<"u"?window:self,On=class{constructor(){try{vr.sessionStorage.setItem(tr,tr),vr.sessionStorage.removeItem(tr),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{vr.localStorage.setItem(tr,tr),vr.localStorage.removeItem(tr),this.localSupported=!0}catch{this.localSupported=!1}}get(s){return this._get(s,!1)}getSession(s){return this._get(s,!0)}remove(s){return this._remove(s,!1)}removeSession(s){return this._remove(s,!0)}set(s,o,u){return this._set(s,o,u,!1)}setSession(s,o,u){return this._set(s,o,u,!0)}_set(s,o,u,p){const _={value:o};return u&&(_.expires=Date.now()+u),this.storageInterface(p).setItem(s,JSON.stringify(_))}_get(s,o){if(o&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!o&&!this.localSupported)throw new Error("Local Storage not supported");const u=this.storageInterface(o).getItem(s);if(!u)return null;const p=JSON.parse(u);return p.expires&&p.expires<Date.now()?(this.storageInterface(o).removeItem(s),null):p.value}_remove(s,o){return this.storageInterface(o).removeItem(s)}storageInterface(s){return s?vr.sessionStorage:vr.localStorage}},na=new On,It=jo(),Od=typeof EdgeRuntime=="string";typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&!Od&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function nc(){const s=It.location;return!It.WebSocket||!s||!s.origin||s.origin.indexOf("http")>-1}function Td(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}var ti=It.navigator&&It.navigator.userAgent.toString(),rc=It.location&&It.location.href,kl={agent:"browser",logTimestamps:!0,userAgent:ti,currentUrl:rc,binaryType:"arraybuffer",WebSocket:It.WebSocket,fetchSupported:!!It.fetch,xhrSupported:It.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,allowComet:nc(),useProtocolHeartbeats:!0,supportsBinary:!!It.TextDecoder,preferBinary:!1,ArrayBuffer:It.ArrayBuffer,atob:It.atob,nextTick:typeof It.queueMicrotask=="function"?s=>It.queueMicrotask(s):s=>Promise.resolve().then(s),addEventListener:It.addEventListener,inspect:JSON.stringify,stringByteSize:function(s){return It.TextDecoder&&new It.TextEncoder().encode(s).length||s.length},TextEncoder:It.TextEncoder,TextDecoder:It.TextDecoder,getRandomArrayBuffer:async function(s){const o=new Uint8Array(s);return It.crypto.getRandomValues(o),o.buffer},isWebworker:Td(),push:{platform:"browser",formFactor:"desktop",storage:na}},Cl=kl;function Op(s){const o=[80015,80017,80030];return s.code?ln.isTokenErr(s)?!1:o.includes(s.code)?!0:s.code>=4e4&&s.code<5e4:!1}function Lr(s){return Op(s)?[Cn({action:we.ERROR,error:s})]:[Cn({action:we.DISCONNECTED,error:s})]}var Ks=class extends ns{constructor(s,o,u){super(s,o,u,!0),this.onAuthUpdated=p=>{this.authParams={access_token:p.token}},this.stream="stream"in u?u.stream:!0,this.sendRequest=null,this.recvRequest=null,this.pendingCallback=null,this.pendingItems=null}connect(){k.logAction(this.logger,k.LOG_MINOR,"CometTransport.connect()","starting"),ns.prototype.connect.call(this);const s=this.params,o=s.options,u=s.host||o.primaryDomain,p=qe.getPort(o),_=o.tls?"https://":"http://";this.baseUri=_+u+":"+p+"/comet/";const S=this.baseUri+"connect";k.logAction(this.logger,k.LOG_MINOR,"CometTransport.connect()","uri: "+S),Nt(this.auth.getAuthParams(),(P,U)=>{if(P){this.disconnect(P);return}if(this.isDisposed)return;this.authParams=U;const X=this.params.getConnectParams(U);"stream"in X&&(this.stream=X.stream),k.logAction(this.logger,k.LOG_MINOR,"CometTransport.connect()","connectParams:"+At(X));let Q=!1;const de=this.recvRequest=this.createRequest(S,null,X,null,this.stream?ct.REQ_RECV_STREAM:ct.REQ_RECV);de.on("data",ce=>{this.recvRequest&&(Q||(Q=!0,this.emit("preconnect")),this.onData(ce))}),de.on("complete",ce=>{if(this.recvRequest||(ce=ce||new K("Request cancelled",80003,400)),this.recvRequest=null,!Q&&!ce&&(Q=!0,this.emit("preconnect")),this.onActivity(),ce){ce.code?this.onData(Lr(ce)):this.disconnect(ce);return}L.Config.nextTick(()=>{this.recv()})}),de.exec()})}requestClose(){k.logAction(this.logger,k.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)}requestDisconnect(){k.logAction(this.logger,k.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)}_requestCloseOrDisconnect(s){const o=s?this.closeUri:this.disconnectUri;if(o){const u=this.createRequest(o,null,this.authParams,null,ct.REQ_SEND);u.on("complete",p=>{p&&(k.logAction(this.logger,k.LOG_ERROR,"CometTransport.request"+(s?"Close()":"Disconnect()"),"request returned err = "+Ze(p)),this.finish("disconnected",p))}),u.exec()}}dispose(){k.logAction(this.logger,k.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(k.logAction(this.logger,k.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",Ir.disconnected()),L.Config.nextTick(()=>{this.emit("disposed")}))}onConnect(s){var o;if(this.isDisposed)return;const u=(o=s.connectionDetails)==null?void 0:o.connectionKey;ns.prototype.onConnect.call(this,s);const p=this.baseUri+u;k.logAction(this.logger,k.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+p),this.sendUri=p+"/send",this.recvUri=p+"/recv",this.closeUri=p+"/close",this.disconnectUri=p+"/disconnect"}send(s){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(s);return}const o=this.pendingItems||[];o.push(s),this.pendingItems=null,this.sendItems(o)}sendAnyPending(){const s=this.pendingItems;s&&(this.pendingItems=null,this.sendItems(s))}sendItems(s){const o=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(s),ct.REQ_SEND);o.on("complete",(u,p)=>{if(u&&k.logAction(this.logger,k.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+Ze(u)),this.sendRequest=null,u){u.code?this.onData(Lr(u)):this.disconnect(u);return}p&&this.onData(p),this.pendingItems&&L.Config.nextTick(()=>{this.sendRequest||this.sendAnyPending()})}),o.exec()}recv(){if(this.recvRequest||!this.isConnected)return;const s=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?ct.REQ_RECV_STREAM:ct.REQ_RECV_POLL);s.on("data",o=>{this.onData(o)}),s.on("complete",o=>{if(this.recvRequest=null,this.onActivity(),o){o.code?this.onData(Lr(o)):this.disconnect(o);return}L.Config.nextTick(()=>{this.recv()})}),s.exec()}onData(s){try{const o=this.decodeResponse(s);if(o&&o.length)for(let u=0;u<o.length;u++)this.onProtocolMessage(Qo(o[u],this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin))}catch(o){k.logAction(this.logger,k.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+o.stack)}}encodeRequest(s){return JSON.stringify(s)}decodeResponse(s){return typeof s=="string"?JSON.parse(s):s}},Ys=Ks;function ic(s,o){return Hr($e(o)).includes("x-ably-errorcode")}function sc(s,o){if(ic(s,o))return s.error&&K.fromValues(s.error)}var nr=function(){},rr=0,Pi={};function ni(s,o){return s.getResponseHeader&&s.getResponseHeader(o)}function ri(s){return s.getResponseHeader&&(s.getResponseHeader("transfer-encoding")||!s.getResponseHeader("content-length"))}function os(s){const o=s.getAllResponseHeaders().trim().split(`\r
`),u={};for(let p=0;p<o.length;p++){const _=o[p].split(":").map(S=>S.trim());u[_[0].toLowerCase()]=_[1]}return u}var Rd=class X0 extends St{constructor(o,u,p,_,S,P,U,X){super(U),p=p||{},p.rnd=Jt(),this.uri=o+At(p),this.headers=u||{},this.body=_,this.method=X?X.toUpperCase():le(_)?"GET":"POST",this.requestMode=S,this.timeouts=P,this.timedOut=!1,this.requestComplete=!1,this.id=String(++rr),Pi[this.id]=this}static createRequest(o,u,p,_,S,P,U,X){const Q=P||qe.TIMEOUTS;return new X0(o,u,he(p),_,S,Q,U,X)}complete(o,u,p,_,S){this.requestComplete||(this.requestComplete=!0,!o&&u&&this.emit("data",u),this.emit("complete",o,u,p,_,S),this.dispose())}abort(){this.dispose()}exec(){let o=this.headers;const u=this.requestMode==ct.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,p=this.timer=setTimeout(()=>{this.timedOut=!0,S.abort()},u),_=this.method,S=this.xhr=new XMLHttpRequest,P=o.accept;let U=this.body,X="text";P?P.indexOf("application/x-msgpack")===0&&(X="arraybuffer"):o.accept="application/json",U&&(o["content-type"]||(o["content-type"]="application/json")).indexOf("application/json")>-1&&typeof U!="string"&&(U=JSON.stringify(U)),S.open(_,this.uri,!0),S.responseType=X,"authorization"in o&&(S.withCredentials=!0);for(const He in o)S.setRequestHeader(He,o[He]);const Q=(He,fn,qt,Li)=>{var ji;let ii=fn+" (event type: "+He.type+")";(ji=this==null?void 0:this.xhr)!=null&&ji.statusText&&(ii+=", current statusText is "+this.xhr.statusText),k.logAction(this.logger,k.LOG_ERROR,"Request.on"+He.type+"()",ii),this.complete(new Ue(ii,qt,Li))};S.onerror=He=>{Q(He,"XHR error occurred",null,400)},S.onabort=He=>{this.timedOut?Q(He,"Request aborted due to request timeout expiring",null,408):Q(He,"Request cancelled",null,400)},S.ontimeout=He=>{Q(He,"Request timed out",null,408)};let de,ce,Se,ue=0,Te=!1;const Re=()=>{if(clearTimeout(p),Se=ce<400,ce==204){this.complete(null,null,null,null,ce);return}de=this.requestMode==ct.REQ_RECV_STREAM&&Se&&ri(S)},De=()=>{let He;try{const qt=ni(S,"content-type");if(qt?qt.indexOf("application/json")>=0:S.responseType=="text"){const ji=S.responseType==="arraybuffer"?L.BufferUtils.utf8Decode(S.response):String(S.responseText);ji.length?He=JSON.parse(ji):He=ji,Te=!0}else He=S.response;He.response!==void 0?(ce=He.statusCode,Se=ce<400,o=He.headers,He=He.response):o=os(S)}catch(qt){this.complete(new Ue("Malformed response body from server: "+qt.message,null,400));return}if(Se||Array.isArray(He)){this.complete(null,He,o,Te,ce);return}let fn=sc(He,o);fn||(fn=new Ue("Error response received from server: "+ce+" body was: "+L.Config.inspect(He),null,ce)),this.complete(fn,He,o,Te,ce)};function lt(){const He=S.responseText,fn=He.length-1;let qt,Li;for(;ue<fn&&(qt=He.indexOf(`
`,ue))>-1;)Li=He.slice(ue,qt),ue=qt+1,ft(Li)}const ft=He=>{try{He=JSON.parse(He)}catch(fn){this.complete(new Ue("Malformed response body from server: "+fn.message,null,400));return}this.emit("data",He)},We=()=>{lt(),this.streamComplete=!0,L.Config.nextTick(()=>{this.complete()})};S.onreadystatechange=()=>{const He=S.readyState;He<3||S.status!==0&&(ce===void 0&&(ce=S.status,Re()),He==3&&de?lt():He==4&&(de?We():De()))},S.send(U)}dispose(){const o=this.xhr;if(o){o.onreadystatechange=o.onerror=o.onabort=o.ontimeout=nr,this.xhr=null;const u=this.timer;u&&(clearTimeout(u),this.timer=null),this.requestComplete||o.abort()}delete Pi[this.id]}},oc=Rd,ac=un.XhrPolling,qn=class extends Ys{constructor(s,o,u){super(s,o,u),this.shortName=ac,u.stream=!1,this.shortName=ac}static isAvailable(){return!!(L.Config.xhrSupported&&L.Config.allowComet)}toString(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected}createRequest(s,o,u,p,_){return oc.createRequest(s,o,u,p,_,this.timeouts,this.logger)}},Wn=qn,Mt=["xhr_polling"],yr={order:Mt,bundledImplementations:{web_socket:Ya,xhr_polling:Wn}},Ad=yr,Pd={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",wsConnectivityCheckUrl:"wss://ws-up.ably-realtime.com",defaultTransports:[un.XhrPolling,un.WebSocket]},El=Pd;function Ml(s){if(s===void 0)return"undefined";let o,u;if(s instanceof ArrayBuffer?(u="ArrayBuffer",o=new DataView(s)):s instanceof DataView&&(u="DataView",o=s),!o)return JSON.stringify(s);const p=[];for(let _=0;_<s.byteLength;_++){if(_>20){p.push("...");break}let S=o.getUint8(_).toString(16);S.length===1&&(S="0"+S),p.push(S)}return"<"+u+" "+p.join(" ")+">"}function Xs(s,o,u){for(let p=0,_=u.length;p<_;p++){const S=u.charCodeAt(p);if(S<128){s.setUint8(o++,S>>>0&127|0);continue}if(S<2048){s.setUint8(o++,S>>>6&31|192),s.setUint8(o++,S>>>0&63|128);continue}if(S<65536){s.setUint8(o++,S>>>12&15|224),s.setUint8(o++,S>>>6&63|128),s.setUint8(o++,S>>>0&63|128);continue}if(S<1114112){s.setUint8(o++,S>>>18&7|240),s.setUint8(o++,S>>>12&63|128),s.setUint8(o++,S>>>6&63|128),s.setUint8(o++,S>>>0&63|128);continue}throw new Error("bad codepoint "+S)}}function ra(s,o,u){let p="";for(let _=o,S=o+u;_<S;_++){const P=s.getUint8(_);if((P&128)===0){p+=String.fromCharCode(P);continue}if((P&224)===192){p+=String.fromCharCode((P&15)<<6|s.getUint8(++_)&63);continue}if((P&240)===224){p+=String.fromCharCode((P&15)<<12|(s.getUint8(++_)&63)<<6|(s.getUint8(++_)&63)<<0);continue}if((P&248)===240){p+=String.fromCharCode((P&7)<<18|(s.getUint8(++_)&63)<<12|(s.getUint8(++_)&63)<<6|(s.getUint8(++_)&63)<<0);continue}throw new Error("Invalid byte "+P.toString(16))}return p}function cc(s){let o=0;for(let u=0,p=s.length;u<p;u++){const _=s.charCodeAt(u);if(_<128){o+=1;continue}if(_<2048){o+=2;continue}if(_<65536){o+=3;continue}if(_<1114112){o+=4;continue}throw new Error("bad codepoint "+_)}return o}function Zs(s,o){const u=jr(s,o);if(u===0)return;const p=new ArrayBuffer(u),_=new DataView(p);return Ii(s,_,0,o),p}var ia=65536*65536,Id=1/ia;function sa(s,o){return o=o||0,s.getInt32(o)*ia+s.getUint32(o+4)}function lc(s,o){return o=o||0,s.getUint32(o)*ia+s.getUint32(o+4)}function xd(s,o,u){u<9223372036854776e3?(s.setInt32(o,Math.floor(u*Id)),s.setInt32(o+4,u&-1)):(s.setUint32(o,2147483647),s.setUint32(o+4,2147483647))}function Ld(s,o,u){u<18446744073709552e3?(s.setUint32(o,Math.floor(u*Id)),s.setInt32(o+4,u&-1)):(s.setUint32(o,4294967295),s.setUint32(o+4,4294967295))}var eo=class{constructor(s,o){this.map=u=>{const p={};for(let _=0;_<u;_++){const S=this.parse();p[S]=this.parse()}return p},this.bin=u=>{const p=new ArrayBuffer(u);return new Uint8Array(p).set(new Uint8Array(this.view.buffer,this.offset,u),0),this.offset+=u,p},this.buf=this.bin,this.str=u=>{const p=ra(this.view,this.offset,u);return this.offset+=u,p},this.array=u=>{const p=new Array(u);for(let _=0;_<u;_++)p[_]=this.parse();return p},this.ext=u=>(this.offset+=u,{type:this.view.getInt8(this.offset),data:this.buf(u)}),this.parse=()=>{const u=this.view.getUint8(this.offset);let p,_;if((u&128)===0)return this.offset++,u;if((u&240)===128)return _=u&15,this.offset++,this.map(_);if((u&240)===144)return _=u&15,this.offset++,this.array(_);if((u&224)===160)return _=u&31,this.offset++,this.str(_);if((u&224)===224)return p=this.view.getInt8(this.offset),this.offset++,p;switch(u){case 192:return this.offset++,null;case 193:this.offset++;return;case 194:return this.offset++,!1;case 195:return this.offset++,!0;case 196:return _=this.view.getUint8(this.offset+1),this.offset+=2,this.bin(_);case 197:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.bin(_);case 198:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.bin(_);case 199:return _=this.view.getUint8(this.offset+1),this.offset+=2,this.ext(_);case 200:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.ext(_);case 201:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.ext(_);case 202:return p=this.view.getFloat32(this.offset+1),this.offset+=5,p;case 203:return p=this.view.getFloat64(this.offset+1),this.offset+=9,p;case 204:return p=this.view.getUint8(this.offset+1),this.offset+=2,p;case 205:return p=this.view.getUint16(this.offset+1),this.offset+=3,p;case 206:return p=this.view.getUint32(this.offset+1),this.offset+=5,p;case 207:return p=lc(this.view,this.offset+1),this.offset+=9,p;case 208:return p=this.view.getInt8(this.offset+1),this.offset+=2,p;case 209:return p=this.view.getInt16(this.offset+1),this.offset+=3,p;case 210:return p=this.view.getInt32(this.offset+1),this.offset+=5,p;case 211:return p=sa(this.view,this.offset+1),this.offset+=9,p;case 212:return _=1,this.offset++,this.ext(_);case 213:return _=2,this.offset++,this.ext(_);case 214:return _=4,this.offset++,this.ext(_);case 215:return _=8,this.offset++,this.ext(_);case 216:return _=16,this.offset++,this.ext(_);case 217:return _=this.view.getUint8(this.offset+1),this.offset+=2,this.str(_);case 218:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.str(_);case 219:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.str(_);case 220:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.array(_);case 221:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.array(_);case 222:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.map(_);case 223:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.map(_)}throw new Error("Unknown type 0x"+u.toString(16))},this.offset=o||0,this.view=s}};function jd(s){const o=new DataView(s),u=new eo(o),p=u.parse();if(u.offset!==s.byteLength)throw new Error(s.byteLength-u.offset+" trailing bytes");return p}function oa(s,o){return Object.keys(s).filter(function(u){const p=s[u],_=typeof p;return(!o||p!=null)&&(_!=="function"||!!p.toJSON)})}function Ii(s,o,u,p){const _=typeof s;if(typeof s=="string"){const S=cc(s);if(S<32)return o.setUint8(u,S|160),Xs(o,u+1,s),1+S;if(S<256)return o.setUint8(u,217),o.setUint8(u+1,S),Xs(o,u+2,s),2+S;if(S<65536)return o.setUint8(u,218),o.setUint16(u+1,S),Xs(o,u+3,s),3+S;if(S<4294967296)return o.setUint8(u,219),o.setUint32(u+1,S),Xs(o,u+5,s),5+S}if(ArrayBuffer.isView&&ArrayBuffer.isView(s)&&(s=s.buffer),s instanceof ArrayBuffer){const S=s.byteLength;if(S<256)return o.setUint8(u,196),o.setUint8(u+1,S),new Uint8Array(o.buffer).set(new Uint8Array(s),u+2),2+S;if(S<65536)return o.setUint8(u,197),o.setUint16(u+1,S),new Uint8Array(o.buffer).set(new Uint8Array(s),u+3),3+S;if(S<4294967296)return o.setUint8(u,198),o.setUint32(u+1,S),new Uint8Array(o.buffer).set(new Uint8Array(s),u+5),5+S}if(typeof s=="number"){if(Math.floor(s)!==s)return o.setUint8(u,203),o.setFloat64(u+1,s),9;if(s>=0){if(s<128)return o.setUint8(u,s),1;if(s<256)return o.setUint8(u,204),o.setUint8(u+1,s),2;if(s<65536)return o.setUint8(u,205),o.setUint16(u+1,s),3;if(s<4294967296)return o.setUint8(u,206),o.setUint32(u+1,s),5;if(s<18446744073709552e3)return o.setUint8(u,207),Ld(o,u+1,s),9;throw new Error("Number too big 0x"+s.toString(16))}if(s>=-32)return o.setInt8(u,s),1;if(s>=-128)return o.setUint8(u,208),o.setInt8(u+1,s),2;if(s>=-32768)return o.setUint8(u,209),o.setInt16(u+1,s),3;if(s>=-2147483648)return o.setUint8(u,210),o.setInt32(u+1,s),5;if(s>=-9223372036854776e3)return o.setUint8(u,211),xd(o,u+1,s),9;throw new Error("Number too small -0x"+(-s).toString(16).substr(1))}if(_==="undefined")return p?0:(o.setUint8(u,212),o.setUint8(u+1,0),o.setUint8(u+2,0),3);if(s===null)return p?0:(o.setUint8(u,192),1);if(_==="boolean")return o.setUint8(u,s?195:194),1;if(typeof s.toJSON=="function")return Ii(s.toJSON(),o,u,p);if(_==="object"){let S,P=0,U;const X=Array.isArray(s);if(X?S=s.length:(U=oa(s,p),S=U.length),S<16?(o.setUint8(u,S|(X?144:128)),P=1):S<65536?(o.setUint8(u,X?220:222),o.setUint16(u+1,S),P=3):S<4294967296&&(o.setUint8(u,X?221:223),o.setUint32(u+1,S),P=5),X)for(let Q=0;Q<S;Q++)P+=Ii(s[Q],o,u+P,p);else if(U)for(let Q=0;Q<S;Q++){const de=U[Q];P+=Ii(de,o,u+P),P+=Ii(s[de],o,u+P,p)}return P}if(_==="function")return 0;throw new Error("Unknown type "+_)}function jr(s,o){const u=typeof s;if(u==="string"){const p=cc(s);if(p<32)return 1+p;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(s)&&(s=s.buffer),s instanceof ArrayBuffer){const p=s.byteLength;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(typeof s=="number"){if(Math.floor(s)!==s)return 9;if(s>=0){if(s<128)return 1;if(s<256)return 2;if(s<65536)return 3;if(s<4294967296)return 5;if(s<18446744073709552e3)return 9;throw new Error("Number too big 0x"+s.toString(16))}if(s>=-32)return 1;if(s>=-128)return 2;if(s>=-32768)return 3;if(s>=-2147483648)return 5;if(s>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+s.toString(16).substr(1))}if(u==="boolean")return 1;if(s===null)return o?0:1;if(s===void 0)return o?0:3;if(typeof s.toJSON=="function")return jr(s.toJSON(),o);if(u==="object"){let p,_=0;if(Array.isArray(s)){p=s.length;for(let S=0;S<p;S++)_+=jr(s[S],o)}else{const S=oa(s,o);p=S.length;for(let P=0;P<p;P++){const U=S[P];_+=jr(U)+jr(s[U],o)}}if(p<16)return 1+_;if(p<65536)return 3+_;if(p<4294967296)return 5+_;throw new Error("Array or object too long 0x"+p.toString(16))}if(u==="function")return 0;throw new Error("Unknown type "+u)}var aa={encode:Zs,decode:jd,inspect:Ml,utf8Write:Xs,utf8Read:ra,utf8ByteCount:cc};function Ol(s,o){return!!o.get("x-ably-errorcode")}function Tl(s,o){if(Ol(s,o))return s.error&&K.fromValues(s.error)}function Rl(s){const o={};return s.forEach((u,p)=>{o[p]=u}),o}async function to(s,o,u,p,_,S){const P=new Headers(p||{}),U=s?s.toUpperCase():le(S)?"GET":"POST",X=new AbortController;let Q;const de=new Promise(ue=>{Q=setTimeout(()=>{X.abort(),ue({error:new Ue("Request timed out",null,408)})},o?o.options.timeouts.httpRequestTimeout:qe.TIMEOUTS.httpRequestTimeout)}),ce={method:U,headers:P,body:S,signal:X.signal};L.Config.isWebworker||(ce.credentials=P.has("authorization")?"include":"same-origin");const Se=(async()=>{try{const ue=new URLSearchParams(_||{});ue.set("rnd",Jt());const Te=u+"?"+ue,Re=await jo().fetch(Te,ce);if(clearTimeout(Q),Re.status==204)return{error:null,statusCode:Re.status};const De=Re.headers.get("Content-Type");let lt;De&&De.indexOf("application/x-msgpack")>-1?lt=await Re.arrayBuffer():De&&De.indexOf("application/json")>-1?lt=await Re.json():lt=await Re.text();const ft=!!De&&De.indexOf("application/x-msgpack")===-1,We=Rl(Re.headers);return Re.ok?{error:null,body:lt,headers:We,unpacked:ft,statusCode:Re.status}:{error:Tl(lt,Re.headers)||new Ue("Error response received from server: "+Re.status+" body was: "+L.Config.inspect(lt),null,Re.status),body:lt,headers:We,unpacked:ft,statusCode:Re.status}}catch(ue){return clearTimeout(Q),{error:ue}}})();return Promise.race([de,Se])}var ir={XHRRequest:oc,FetchRequest:to},xi=Qs(Cl,tc);L.Crypto=xi,L.BufferUtils=tc,L.Http=dn,L.Config=Cl,L.Transports=Ad,L.WebStorage=na;for(const s of[dl,wl])s.Crypto=xi,s._MsgPack=aa;dn.bundledRequestImplementations=ir,k.initLogHandlers(),L.Defaults=Da(El),L.Config.agent&&(L.Defaults.agent+=" "+L.Config.agent);var Al={ErrorInfo:K,Rest:dl,Realtime:wl,msgpack:aa,makeProtocolMessageFromDeserialized:ol};if(typeof a.exports=="object"&&typeof r=="object"){var Nd=(s,o,u,p)=>{if(o&&typeof o=="object"||typeof o=="function")for(let _ of Object.getOwnPropertyNames(o))!Object.prototype.hasOwnProperty.call(s,_)&&_!==u&&Object.defineProperty(s,_,{get:()=>o[_],enumerable:!(p=Object.getOwnPropertyDescriptor(o,_))||p.enumerable});return s};a.exports=Nd(a.exports,r)}return a.exports})})(zu)),zu.exports}var Ke=RC(),Wh=(n=>(n.Trace="trace",n.Debug="debug",n.Info="info",n.Warn="warn",n.Error="error",n.Silent="silent",n))(Wh||{});const AC=(n,e,r)=>{const a=r?`, context: ${JSON.stringify(r)}`:"",l=`[${new Date().toISOString()}] ${e.valueOf().toUpperCase()} ably-chat: ${n}${a}`;switch(e){case"trace":case"debug":{console.log(l);break}case"info":{console.info(l);break}case"warn":{console.warn(l);break}case"error":{console.error(l);break}}},PC=n=>{const e=n.logHandler??AC;return new Hh(e,n.logLevel)},Xy=new Map([["trace",0],["debug",1],["info",2],["warn",3],["error",4],["silent",5]]);class Hh{constructor(e,r,a){this._handler=e,this._context=a;const l=Xy.get(r);if(l===void 0)throw new Ke.ErrorInfo(`Invalid log level: ${r}`,5e4,500);this._levelNumber=l}trace(e,r){this._write(e,"trace",0,r)}debug(e,r){this._write(e,"debug",1,r)}info(e,r){this._write(e,"info",2,r)}warn(e,r){this._write(e,"warn",3,r)}error(e,r){this._write(e,"error",4,r)}withContext(e){const r=[...Xy.entries()].find(([,a])=>a===this._levelNumber)?.[0]??"error";return new Hh(this._handler,r,this._mergeContext(e))}_write(e,r,a,l){a>=this._levelNumber&&this._handler(e,r,this._mergeContext(l))}_mergeContext(e){return this._context?e?{...this._context,...e}:this._context:e??void 0}}const IC={logLevel:Wh.Error},xC=n=>(n=n??{},{...n,logLevel:n.logLevel??IC.logLevel});function vs(n,e,r){if((Array.isArray(e)||typeof e=="string")&&r)return n.on(e,r),()=>{n.off(r)};if(typeof e=="function")return n.on(e),()=>{n.off(e)};throw new TypeError("Invalid arguments passed to on()")}function LC(n,e,r){if(r)return n.once(e,r),()=>{n.off(r)};throw new TypeError("Invalid arguments passed to once()")}function Ro(n,e,r){if((Array.isArray(e)||typeof e=="string")&&r){const a=n.subscribe(e,r);return()=>{a.then(()=>{n.unsubscribe(r)}).catch(l=>{console.error("Error subscribing to events:",l)})}}else if(typeof e=="function"){const a=n.subscribe(e);return()=>{a.then(()=>{n.unsubscribe(e)}).catch(l=>{console.error("Error subscribing to events:",l)})}}else throw new TypeError("Invalid arguments passed to subscribe()")}const jC=Ke.Realtime.EventEmitter;class fi extends jC{}const Cr=n=>(...e)=>n(...e),ys=n=>{const e=n,r=Object.values(e.events).flat().length+e.any.length+Object.values(e.eventsOnce).flat().length+e.anyOnce.length;return r?r>0:!1};class NC{constructor(e,r){this._status="initialized",this._emitter=new fi,this._logger=r,this._status=this._mapAblyStatusToChat(e.connection.state),this._error=e.connection.errorReason;const a=l=>{const f=this._mapAblyStatusToChat(l.current);if(f===this._status)return;const h={current:f,previous:this._status,error:l.reason,retryIn:l.retryIn};this._applyStatusChange(h)};this._clearAblyConnectionListener=vs(e.connection,a)}get status(){return this._status}get error(){return this._error}onStatusChange(e){const r=Cr(e);return this._emitter.on(r),{off:()=>{this._emitter.off(r)}}}dispose(){this._logger.trace("DefaultConnection.dispose();"),this._clearAblyConnectionListener(),this._emitter.off()}hasListeners(){return ys(this._emitter)}_applyStatusChange(e){this._status=e.current,this._error=e.error,this._logger.info("Connection state changed",e),this._emitter.emit(e.current,e)}_mapAblyStatusToChat(e){switch(e){case"closing":case"closed":return"failed";default:return e}}}const Zy=()=>Math.random().toString(36).slice(2);var e_=Object.prototype.hasOwnProperty;function t_(n,e,r){for(r of n.keys())if(jc(r,e))return r}function jc(n,e){var r,a,l;if(n===e)return!0;if(n&&e&&(r=n.constructor)===e.constructor){if(r===Date)return n.getTime()===e.getTime();if(r===RegExp)return n.toString()===e.toString();if(r===Array){if((a=n.length)===e.length)for(;a--&&jc(n[a],e[a]););return a===-1}if(r===Set){if(n.size!==e.size)return!1;for(a of n)if(l=a,l&&typeof l=="object"&&(l=t_(e,l),!l)||!e.has(l))return!1;return!0}if(r===Map){if(n.size!==e.size)return!1;for(a of n)if(l=a[0],l&&typeof l=="object"&&(l=t_(e,l),!l)||!jc(a[1],e.get(l)))return!1;return!0}if(r===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(r===DataView){if((a=n.byteLength)===e.byteLength)for(;a--&&n.getInt8(a)===e.getInt8(a););return a===-1}if(ArrayBuffer.isView(n)){if((a=n.byteLength)===e.byteLength)for(;a--&&n[a]===e[a];);return a===-1}if(!r||typeof n=="object"){a=0;for(r in n)if(e_.call(n,r)&&++a&&!e_.call(e,r)||!(r in e)||!jc(n[r],e[r]))return!1;return Object.keys(e).length===a}}return n!==n&&e!==e}var _s=(n=>(n.Created="message.created",n.Updated="message.updated",n.Deleted="message.deleted",n))(_s||{}),n_=(n=>(n.ChatMessage="chat.message",n))(n_||{}),r_=(n=>(n.Occupancy="[meta]occupancy",n))(r_||{}),Er=(n=>(n.MessageCreate="message.create",n.MessageUpdate="message.update",n.MessageDelete="message.delete",n.MessageAnnotationSummary="message.summary",n.MessageMetaOccupancy="meta.occupancy",n))(Er||{}),qr=(n=>(n.Started="typing.started",n.Stopped="typing.stopped",n))(qr||{}),Ao=(n=>(n.SetChanged="typing.set.changed",n))(Ao||{}),Gh=(n=>(n.Reaction="roomReaction",n))(Gh||{}),Jh=(n=>(n.Reaction="reaction",n))(Jh||{}),Po=(n=>(n.Unique="unique",n.Distinct="distinct",n.Multiple="multiple",n))(Po||{}),$u=(n=>(n.Unique="reaction:unique.v1",n.Distinct="reaction:distinct.v1",n.Multiple="reaction:multiple.v1",n))($u||{});const DC={"reaction:unique.v1":"unique","reaction:distinct.v1":"distinct","reaction:multiple.v1":"multiple"};var hi=(n=>(n.Create="reaction.create",n.Delete="reaction.delete",n.Summary="reaction.summary",n))(hi||{}),Qh=(n=>(n.Updated="occupancy.updated",n))(Qh||{}),Nc=(n=>(n.Discontinuity="room.discontinuity",n))(Nc||{}),qu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function UC(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Wu={exports:{}};Wu.exports;var i_;function BC(){return i_||(i_=1,(function(n,e){var r=200,a="__lodash_hash_undefined__",l=9007199254740991,f="[object Arguments]",h="[object Array]",v="[object Boolean]",y="[object Date]",b="[object Error]",E="[object Function]",O="[object GeneratorFunction]",j="[object Map]",I="[object Number]",A="[object Object]",R="[object Promise]",D="[object RegExp]",V="[object Set]",Y="[object String]",ne="[object Symbol]",L="[object WeakMap]",q="[object ArrayBuffer]",H="[object DataView]",ae="[object Float32Array]",ye="[object Float64Array]",Ee="[object Int8Array]",Ve="[object Int16Array]",k="[object Int32Array]",ze="[object Uint8Array]",Me="[object Uint8ClampedArray]",K="[object Uint16Array]",Ue="[object Uint32Array]",it=/[\\^$.*+?()[\]{}|]/g,be=/\w*$/,he=/^\[object .+?Constructor\]$/,Ce=/^(?:0|[1-9]\d*)$/,oe={};oe[f]=oe[h]=oe[q]=oe[H]=oe[v]=oe[y]=oe[ae]=oe[ye]=oe[Ee]=oe[Ve]=oe[k]=oe[j]=oe[I]=oe[A]=oe[D]=oe[V]=oe[Y]=oe[ne]=oe[ze]=oe[Me]=oe[K]=oe[Ue]=!0,oe[b]=oe[E]=oe[L]=!1;var J=typeof qu=="object"&&qu&&qu.Object===Object&&qu,le=typeof self=="object"&&self&&self.Object===Object&&self,g=J||le||Function("return this")(),M=e&&!e.nodeType&&e,C=M&&!0&&n&&!n.nodeType&&n,N=C&&C.exports===M;function F(x,te){return x.set(te[0],te[1]),x}function G(x,te){return x.add(te),x}function ie(x,te){for(var se=-1,xe=x?x.length:0;++se<xe&&te(x[se],se,x)!==!1;);return x}function fe(x,te){for(var se=-1,xe=te.length,Pt=x.length;++se<xe;)x[Pt+se]=te[se];return x}function Oe(x,te,se,xe){for(var Pt=-1,Ut=x?x.length:0;++Pt<Ut;)se=te(se,x[Pt],Pt,x);return se}function $e(x,te){for(var se=-1,xe=Array(x);++se<x;)xe[se]=te(se);return xe}function Xe(x,te){return x?.[te]}function Vt(x){var te=!1;if(x!=null&&typeof x.toString!="function")try{te=!!(x+"")}catch{}return te}function bn(x){var te=-1,se=Array(x.size);return x.forEach(function(xe,Pt){se[++te]=[Pt,xe]}),se}function Ln(x,te){return function(se){return x(te(se))}}function mt(x){var te=-1,se=Array(x.size);return x.forEach(function(xe){se[++te]=xe}),se}var At=Array.prototype,en=Function.prototype,zt=Object.prototype,Ze=g["__core-js_shared__"],jn=(function(){var x=/[^.]+$/.exec(Ze&&Ze.keys&&Ze.keys.IE_PROTO||"");return x?"Symbol(src)_1."+x:""})(),Qn=en.toString,Jt=zt.hasOwnProperty,Mr=zt.toString,qi=RegExp("^"+Qn.call(Jt).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Nt=N?g.Buffer:void 0,Dt=g.Symbol,cn=g.Uint8Array,Hr=Ln(Object.getPrototypeOf,Object),gi=Object.create,Ia=zt.propertyIsEnumerable,Lo=At.splice,Wi=Object.getOwnPropertySymbols,jo=Nt?Nt.isBuffer:void 0,Ss=Ln(Object.keys,Object),mi=we(g,"DataView"),Kn=we(g,"Map"),vi=we(g,"Promise"),Or=we(g,"Set"),bt=we(g,"WeakMap"),Nn=we(Object,"create"),No=Qt(mi),xa=Qt(Kn),Sn=Qt(vi),La=Qt(Or),ja=Qt(bt),Hi=Dt?Dt.prototype:void 0,ks=Hi?Hi.valueOf:void 0;function kn(x){var te=-1,se=x?x.length:0;for(this.clear();++te<se;){var xe=x[te];this.set(xe[0],xe[1])}}function Cs(){this.__data__=Nn?Nn(null):{}}function yi(x){return this.has(x)&&delete this.__data__[x]}function Fc(x){var te=this.__data__;if(Nn){var se=te[x];return se===a?void 0:se}return Jt.call(te,x)?te[x]:void 0}function _i(x){var te=this.__data__;return Nn?te[x]!==void 0:Jt.call(te,x)}function Es(x,te){var se=this.__data__;return se[x]=Nn&&te===void 0?a:te,this}kn.prototype.clear=Cs,kn.prototype.delete=yi,kn.prototype.get=Fc,kn.prototype.has=_i,kn.prototype.set=Es;function tn(x){var te=-1,se=x?x.length:0;for(this.clear();++te<se;){var xe=x[te];this.set(xe[0],xe[1])}}function Do(){this.__data__=[]}function Vc(x){var te=this.__data__,se=Ts(te,x);if(se<0)return!1;var xe=te.length-1;return se==xe?te.pop():Lo.call(te,se,1),!0}function zc(x){var te=this.__data__,se=Ts(te,x);return se<0?void 0:te[se][1]}function Ms(x){return Ts(this.__data__,x)>-1}function Tr(x,te){var se=this.__data__,xe=Ts(se,x);return xe<0?se.push([x,te]):se[xe][1]=te,this}tn.prototype.clear=Do,tn.prototype.delete=Vc,tn.prototype.get=zc,tn.prototype.has=Ms,tn.prototype.set=Tr;function Yn(x){var te=-1,se=x?x.length:0;for(this.clear();++te<se;){var xe=x[te];this.set(xe[0],xe[1])}}function Na(){this.__data__={hash:new kn,map:new(Kn||tn),string:new kn}}function $c(x){return St(this,x).delete(x)}function qe(x){return St(this,x).get(x)}function Da(x){return St(this,x).has(x)}function Ua(x,te){return St(this,x).set(x,te),this}Yn.prototype.clear=Na,Yn.prototype.delete=$c,Yn.prototype.get=qe,Yn.prototype.has=Da,Yn.prototype.set=Ua;function hr(x){this.__data__=new tn(x)}function Ba(){this.__data__=new tn}function Ot(x){return this.__data__.delete(x)}function Et(x){return this.__data__.get(x)}function qc(x){return this.__data__.has(x)}function wi(x,te){var se=this.__data__;if(se instanceof tn){var xe=se.__data__;if(!Kn||xe.length<r-1)return xe.push([x,te]),this;se=this.__data__=new Yn(xe)}return se.set(x,te),this}hr.prototype.clear=Ba,hr.prototype.delete=Ot,hr.prototype.get=Et,hr.prototype.has=qc,hr.prototype.set=wi;function Os(x,te){var se=Fn(x)||Qr(x)?$e(x.length,String):[],xe=se.length,Pt=!!xe;for(var Ut in x)Jt.call(x,Ut)&&!(Pt&&(Ut=="length"||zo(Ut,xe)))&&se.push(Ut);return se}function Gi(x,te,se){var xe=x[te];(!(Jt.call(x,te)&&Jr(xe,se))||se===void 0&&!(te in x))&&(x[te]=se)}function Ts(x,te){for(var se=x.length;se--;)if(Jr(x[se][0],te))return se;return-1}function Uo(x,te){return x&&Ps(te,Ar(te),x)}function bi(x,te,se,xe,Pt,Ut,Vn){var $t;if(xe&&($t=Ut?xe(x,Pt,Ut,Vn):xe(x)),$t!==void 0)return $t;if(!Rr(x))return x;var pr=Fn(x);if(pr){if($t=Fo(x),!te)return As(x,$t)}else{var Bt=Tt(x),Mi=Bt==E||Bt==O;if(Zn(x))return Hc(x,te);if(Bt==A||Bt==f||Mi&&!Ut){if(Vt(x))return Ut?x:{};if($t=Vo(Mi?{}:x),!te)return Gr(x,Uo($t,x))}else{if(!oe[Bt])return Ut?x:{};$t=za(x,Bt,bi,te)}}Vn||(Vn=new hr);var Wo=Vn.get(x);if(Wo)return Wo;if(Vn.set(x,$t),!pr)var Pr=se?Jc(x):Ar(x);return ie(Pr||x,function(Oi,Xi){Pr&&(Xi=Oi,Oi=x[Xi]),Gi($t,Xi,bi(Oi,te,se,xe,Xi,x,Vn))}),$t}function Dn(x){return Rr(x)?gi(x):{}}function Fa(x,te,se){var xe=te(x);return Fn(x)?xe:fe(xe,se(x))}function Un(x){return Mr.call(x)}function Va(x){if(!Rr(x)||Ji(x))return!1;var te=Kr(x)||Vt(x)?qi:he;return te.test(Qt(x))}function Wc(x){if(!Bn(x))return Ss(x);var te=[];for(var se in Object(x))Jt.call(x,se)&&se!="constructor"&&te.push(se);return te}function Hc(x,te){if(te)return x.slice();var se=new x.constructor(x.length);return x.copy(se),se}function Si(x){var te=new x.constructor(x.byteLength);return new cn(te).set(new cn(x)),te}function Rs(x,te){var se=te?Si(x.buffer):x.buffer;return new x.constructor(se,x.byteOffset,x.byteLength)}function ln(x,te,se){var xe=te?se(bn(x),!0):bn(x);return Oe(xe,F,new x.constructor)}function ki(x){var te=new x.constructor(x.source,be.exec(x));return te.lastIndex=x.lastIndex,te}function Ci(x,te,se){var xe=te?se(mt(x),!0):mt(x);return Oe(xe,G,new x.constructor)}function Gc(x){return ks?Object(ks.call(x)):{}}function Bo(x,te){var se=te?Si(x.buffer):x.buffer;return new x.constructor(se,x.byteOffset,x.length)}function As(x,te){var se=-1,xe=x.length;for(te||(te=Array(xe));++se<xe;)te[se]=x[se];return te}function Ps(x,te,se,xe){se||(se={});for(var Pt=-1,Ut=te.length;++Pt<Ut;){var Vn=te[Pt],$t=void 0;Gi(se,Vn,$t===void 0?x[Vn]:$t)}return se}function Gr(x,te){return Ps(x,Is(x),te)}function Jc(x){return Fa(x,Ar,Is)}function St(x,te){var se=x.__data__;return $o(te)?se[typeof te=="string"?"string":"hash"]:se.map}function we(x,te){var se=Xe(x,te);return Va(se)?se:void 0}var Is=Wi?Ln(Wi,Object):Ei,Tt=Un;(mi&&Tt(new mi(new ArrayBuffer(1)))!=H||Kn&&Tt(new Kn)!=j||vi&&Tt(vi.resolve())!=R||Or&&Tt(new Or)!=V||bt&&Tt(new bt)!=L)&&(Tt=function(x){var te=Mr.call(x),se=te==A?x.constructor:void 0,xe=se?Qt(se):void 0;if(xe)switch(xe){case No:return H;case xa:return j;case Sn:return R;case La:return V;case ja:return L}return te});function Fo(x){var te=x.length,se=x.constructor(te);return te&&typeof x[0]=="string"&&Jt.call(x,"index")&&(se.index=x.index,se.input=x.input),se}function Vo(x){return typeof x.constructor=="function"&&!Bn(x)?Dn(Hr(x)):{}}function za(x,te,se,xe){var Pt=x.constructor;switch(te){case q:return Si(x);case v:case y:return new Pt(+x);case H:return Rs(x,xe);case ae:case ye:case Ee:case Ve:case k:case ze:case Me:case K:case Ue:return Bo(x,xe);case j:return ln(x,xe,se);case I:case Y:return new Pt(x);case D:return ki(x);case V:return Ci(x,xe,se);case ne:return Gc(x)}}function zo(x,te){return te=te??l,!!te&&(typeof x=="number"||Ce.test(x))&&x>-1&&x%1==0&&x<te}function $o(x){var te=typeof x;return te=="string"||te=="number"||te=="symbol"||te=="boolean"?x!=="__proto__":x===null}function Ji(x){return!!jn&&jn in x}function Bn(x){var te=x&&x.constructor,se=typeof te=="function"&&te.prototype||zt;return x===se}function Qt(x){if(x!=null){try{return Qn.call(x)}catch{}try{return x+""}catch{}}return""}function Xn(x){return bi(x,!0,!0)}function Jr(x,te){return x===te||x!==x&&te!==te}function Qr(x){return Ki(x)&&Jt.call(x,"callee")&&(!Ia.call(x,"callee")||Mr.call(x)==f)}var Fn=Array.isArray;function Qi(x){return x!=null&&qo(x.length)&&!Kr(x)}function Ki(x){return $a(x)&&Qi(x)}var Zn=jo||Yi;function Kr(x){var te=Rr(x)?Mr.call(x):"";return te==E||te==O}function qo(x){return typeof x=="number"&&x>-1&&x%1==0&&x<=l}function Rr(x){var te=typeof x;return!!x&&(te=="object"||te=="function")}function $a(x){return!!x&&typeof x=="object"}function Ar(x){return Qi(x)?Os(x):Wc(x)}function Ei(){return[]}function Yi(){return!1}n.exports=Xn})(Wu,Wu.exports)),Wu.exports}var FC=BC();const ws=UC(FC);let Kh=class ql{constructor({serial:e,clientId:r,text:a,metadata:l,headers:f,action:h,version:v,timestamp:y,reactions:b}){this.serial=e,this.clientId=r,this.text=a,this.metadata=l,this.headers=f,this.action=h,this.version=v,this.timestamp=y,this.reactions=b,Object.freeze(this.version),Object.freeze(this.reactions),Object.freeze(this.reactions.multiple),Object.freeze(this.reactions.distinct),Object.freeze(this.reactions.unique),Object.freeze(this)}get isUpdated(){return this.action===Er.MessageUpdate}get isDeleted(){return this.action===Er.MessageDelete}get updatedBy(){return this.isUpdated?this.version.clientId:void 0}get deletedBy(){return this.isDeleted?this.version.clientId:void 0}get updatedAt(){return this.isUpdated?this.version.timestamp:void 0}get deletedAt(){return this.isDeleted?this.version.timestamp:void 0}isOlderVersionOf(e){return this._compareVersions(this,e,(r,a)=>r.serial<a.serial)}isNewerVersionOf(e){return this._compareVersions(this,e,(r,a)=>r.serial>a.serial)}isSameVersionAs(e){return this._compareVersions(this,e,(r,a)=>r.serial===a.serial)}_isNewerOrSameVersionOf(e){return this._compareVersions(this,e,(r,a)=>r.serial>=a.serial)}before(e){return this.serial<e.serial}after(e){return this.serial>e.serial}equal(e){return this.serial===e.serial}isSameAs(e){return this.equal(e)}with(e){if("serial"in e)return this._getLatestMessageVersion(e);if(e.type===_s.Created)throw new Ke.ErrorInfo("cannot apply a created event to a message",4e4,400);if(e.type===hi.Summary){if(e.summary.messageSerial!==this.serial)throw new Ke.ErrorInfo("cannot apply event for a different message",4e4,400);const r={unique:ws(e.summary.unique),distinct:ws(e.summary.distinct),multiple:ws(e.summary.multiple)};return ql._clone(this,{reactions:r})}return this._getLatestMessageVersion(e.message)}_compareVersions(e,r,a){return e.equal(r)?e.equal(r)&&a(e.version,r.version):!1}_getLatestMessageVersion(e){if(e.serial!==this.serial)throw new Ke.ErrorInfo("cannot apply event for a different message",4e4,400);return this._isNewerOrSameVersionOf(e)?this:ql._clone(e,{reactions:this.reactions})}static _clone(e,r){return new ql({serial:r?.serial??e.serial,clientId:r?.clientId??e.clientId,text:r?.text??e.text,metadata:r?.metadata??ws(e.metadata),headers:r?.headers??ws(e.headers),action:r?.action??e.action,version:r?.version??ws(e.version),timestamp:r?.timestamp??e.timestamp,reactions:r?.reactions??ws(e.reactions)})}copy(e={}){return ql._clone(this,e)}};const Yh=()=>({unique:{},distinct:{},multiple:{}}),VC=n=>{const e=n,r=e.data&&typeof e.data=="object"?e.data:{},a=e.extras&&typeof e.extras=="object"?e.extras:{},l=e.clientId||"",f=r.text||"",h=new Date(e.timestamp||0),v=e.serial||"",y=r.metadata&&typeof r.metadata=="object"?r.metadata:{},b=a.headers||{},E={...e.version,serial:e.version.serial||v,timestamp:new Date(e.version.timestamp||h)},O=Object.values(Er).includes(e.action)?e.action:Er.MessageCreate;return new Kh({serial:v,clientId:l,text:f,metadata:y,headers:b,action:O,version:E,timestamp:h,reactions:Yh()})},Ra=n=>{let e="";if(typeof n=="string")e=n;else try{"serial"in n&&(e=n.serial)}catch{}if(e==="")throw new Ke.ErrorInfo("invalid serial; must be string or object with serial property",4e4,400);return e},zC={"annotation.create":hi.Create,"annotation.delete":hi.Delete};class s_{constructor(e,r,a,l,f){this._logger=e,this._options=r,this._api=a,this._roomName=l,this._channel=f,this._emitter=new fi,this._unsubscribeMessageEvents=Ro(f,this._processMessageEvent.bind(this)),this._options?.rawMessageReactions&&(this._unsubscribeAnnotationEvents=Ro(f.annotations,this._processAnnotationEvent.bind(this))),this._defaultType=this._options?.defaultMessageReactionType??Po.Distinct}_processAnnotationEvent(e){this._logger.trace("MessagesReactions._processAnnotationEvent();",{event:e});const r=DC[e.type];if(!r){this._logger.info("MessagesReactions._processAnnotationEvent(); ignoring unknown reaction type",{event:e});return}const a=zC[e.action];if(!a){this._logger.info("MessagesReactions._processAnnotationEvent(); ignoring unknown reaction event type",{event:e});return}const l=e.name??"",f={type:a,timestamp:new Date(e.timestamp),reaction:{messageSerial:e.messageSerial,type:r,name:l,clientId:e.clientId??""}};e.count?f.reaction.count=e.count:a===hi.Create&&r===Po.Multiple&&(f.reaction.count=1),this._emitter.emit(a,f)}_processMessageEvent(e){if(this._logger.trace("MessagesReactions._processMessageEvent();",{event:e}),e.action!==Er.MessageAnnotationSummary.valueOf())return;const r=e.serial,a=e.annotations.summary,l=a[$u.Unique]??{},f=a[$u.Distinct]??{},h=a[$u.Multiple]??{};this._emitter.emit(hi.Summary,{type:hi.Summary,summary:{messageSerial:r,unique:l,distinct:f,multiple:h}})}send(e,r){this._logger.trace("MessagesReactions.send();",{messageSerial:e,params:r});const a=Ra(e);let{type:l,count:f}=r;l||(l=this._defaultType),l===Po.Multiple&&!f&&(f=1);const h={type:l,name:r.name};return f&&(h.count=f),this._api.sendMessageReaction(this._roomName,a,h)}delete(e,r){this._logger.trace("MessagesReactions.delete();",{messageSerial:e,params:r});const a=Ra(e);let l=r?.type;if(l||(l=this._defaultType),l!==Po.Unique&&!r?.name)throw new Ke.ErrorInfo(`cannot delete reaction of type ${l} without a name`,40001,400);const f={type:l};return l!==Po.Unique&&(f.name=r?.name),this._api.deleteMessageReaction(this._roomName,a,f)}subscribe(e){this._logger.trace("MessagesReactions.subscribe();");const r=Cr(e);return this._emitter.on(hi.Summary,r),{unsubscribe:()=>{this._emitter.off(r)}}}subscribeRaw(e){if(this._logger.trace("MessagesReactions.subscribeRaw();"),!this._options?.rawMessageReactions)throw new Ke.ErrorInfo("Raw message reactions are not enabled",40001,400);const r=Cr(e);return this._emitter.on([hi.Create,hi.Delete],r),{unsubscribe:()=>{this._emitter.off(r)}}}static channelOptionMerger(e){return r=>(r.modes.includes("ANNOTATION_PUBLISH")||r.modes.push("ANNOTATION_PUBLISH"),e.messages.rawMessageReactions&&!r.modes.includes("ANNOTATION_SUBSCRIBE")&&r.modes.push("ANNOTATION_SUBSCRIBE"),r)}clientReactions(e,r){this._logger.trace("MessagesReactions.clientReactions();",{messageSerial:e,clientId:r});const a=Ra(e);return this._api.getClientReactions(this._roomName,a,r)}dispose(){this._logger.trace("DefaultMessageReactions.dispose();"),this._emitter.off(),this._unsubscribeMessageEvents(),this._unsubscribeAnnotationEvents?.(),this._logger.debug("DefaultMessageReactions.dispose(); disposed successfully")}hasListeners(){return ys(this._emitter)}}const Hu=n=>{const e={...Yh(),...n.reactions},r=Object.values(Er).includes(n.action)?n.action:Er.MessageCreate,a={serial:n.version.serial,timestamp:new Date(n.version.timestamp),clientId:n.version.clientId,description:n.version.description,metadata:n.version.metadata};return new Kh({serial:n.serial,clientId:n.clientId,text:n.text,metadata:n.metadata,headers:n.headers,action:r,version:a,timestamp:new Date(n.timestamp),reactions:e})},$C=new Map([[Er.MessageCreate,_s.Created],[Er.MessageUpdate,_s.Updated],[Er.MessageDelete,_s.Deleted]]);var Xh=(n=>(n.OldestFirst="oldestFirst",n.NewestFirst="newestFirst",n))(Xh||{});class qC{constructor(e,r,a,l,f,h){this._pendingPromiseRejecters=new Set,this._pendingAttachListeners=new Set,this._emitter=new fi,this._roomName=e,this._options=r,this._channel=a,this._chatApi=l,this._clientId=f,this._logger=h,this._listenerSubscriptionPoints=new Map,this._reactions=new s_(this._logger,r,this._chatApi,this._roomName,this._channel);const v=this._processEvent.bind(this),y=E=>{this._handleAttach(E.resumed)},b=E=>{E.current==="attached"&&E.previous==="attached"&&this._handleAttach(E.resumed)};this._unsubscribeMessageEvents=Ro(this._channel,[n_.ChatMessage],v),this._offChannelAttached=vs(this._channel,"attached",y),this._offChannelUpdate=vs(this._channel,"update",b)}get reactions(){return this._reactions}async _getBeforeSubscriptionStart(e,r){this._logger.trace("DefaultSubscriptionManager.getBeforeSubscriptionStart();");const a=this._listenerSubscriptionPoints.get(e);if(a===void 0)throw this._logger.error("DefaultSubscriptionManager.getBeforeSubscriptionStart(); listener has not been subscribed yet"),new Ke.ErrorInfo("cannot query history; listener has not been subscribed yet",4e4,400);const l=await a;return this._chatApi.history(this._roomName,{...r,orderBy:"newestFirst",...l})}_handleAttach(e){if(this._logger.trace("DefaultSubscriptionManager.handleAttach();"),e)return;const r=this._subscribeAtChannelAttach();for(const[a]of this._listenerSubscriptionPoints.entries())this._listenerSubscriptionPoints.set(a,r)}async _resolveSubscriptionStart(){const e=this._getChannelProperties();if(e.state==="attached"){if(e.properties.channelSerial)return{fromSerial:e.properties.channelSerial};throw this._logger.error("DefaultSubscriptionManager.handleAttach(); channelSerial is undefined"),new Ke.ErrorInfo("channel is attached, but channelSerial is not defined",4e4,400)}return this._subscribeAtChannelAttach()}_getChannelProperties(){return this._channel}async _subscribeAtChannelAttach(){const e=this._getChannelProperties();return new Promise((r,a)=>{this._pendingPromiseRejecters.add(a);const l=()=>{this._pendingPromiseRejecters.delete(a)};if(e.state==="attached"){this._logger.debug("Messages._subscribeAtChannelAttach(); channel is attached already, using attachSerial",{attachSerial:e.properties.attachSerial}),l(),e.properties.attachSerial?r({fromSerial:e.properties.attachSerial}):(this._logger.error("DefaultSubscriptionManager.handleAttach(); attachSerial is undefined"),l(),a(new Ke.ErrorInfo("channel is attached, but attachSerial is not defined",4e4,400)));return}const f=LC(e,"attached",()=>{this._logger.debug("Messages._subscribeAtChannelAttach(); channel is now attached, using attachSerial",{attachSerial:e.properties.attachSerial}),l(),this._pendingAttachListeners.delete(f),e.properties.attachSerial?r({fromSerial:e.properties.attachSerial}):(this._logger.error("DefaultSubscriptionManager.handleAttach(); attachSerial is undefined"),a(new Ke.ErrorInfo("channel is attached, but attachSerial is not defined",4e4,400)))});this._pendingAttachListeners.add(f)})}async history(e){return this._logger.trace("Messages.query();"),this._chatApi.history(this._roomName,e)}get(e){return this._logger.trace("Messages.get();",{serial:e}),this._chatApi.getMessage(this._roomName,Ra(e))}async send(e){this._logger.trace("Messages.send();",{params:e});const{text:r,metadata:a,headers:l}=e,f=await this._chatApi.sendMessage(this._roomName,{text:r,headers:l,metadata:a}),h=new Date(f.timestamp);return new Kh({serial:f.serial,clientId:this._clientId,text:r,metadata:a??{},headers:l??{},action:Er.MessageCreate,version:{serial:f.serial,timestamp:h},timestamp:h,reactions:Yh()})}async delete(e,r){this._logger.trace("Messages.delete();",{params:r}),e=Ra(e),this._logger.debug("Messages.delete(); serial",{serial:e});const a=await this._chatApi.deleteMessage(this._roomName,e,r);return Hu(a)}async update(e,r,a){this._logger.trace("Messages.update();",{updateParams:r,details:a}),e=Ra(e),this._logger.debug("Messages.update(); serial",{serial:e});const l=await this._chatApi.updateMessage(this._roomName,e,{message:{text:r.text,metadata:r.metadata,headers:r.headers},...a});return this._logger.debug("Messages.update(); message update successfully",{updateParams:r}),Hu(l)}subscribe(e){this._logger.trace("Messages.subscribe();");const r=Cr(e);this._emitter.on([_s.Created,_s.Updated,_s.Deleted],r);const a=this._resolveSubscriptionStart();return a.catch(()=>{this._logger.debug("Messages.subscribe(); subscription point was not resolved before the room was released")}),this._listenerSubscriptionPoints.set(r,a),{unsubscribe:()=>{this._listenerSubscriptionPoints.delete(r),this._logger.trace("Messages.unsubscribe();"),this._emitter.off(r)},historyBeforeSubscribe:l=>this._getBeforeSubscriptionStart(r,l)}}_processEvent(e){this._logger.trace("Messages._processEvent();",{channelEventMessage:e});const{action:r}=e,a=$C.get(r);if(!a){this._logger.debug("Messages._processEvent(); received unknown message action",{action:r});return}const l=VC(e);this._emitter.emit(a,{type:a,message:l})}dispose(){this._logger.trace("DefaultMessages.dispose();"),this._emitter.off();const e=new Ke.ErrorInfo("room has been disposed",4e4,400);for(const r of this._pendingPromiseRejecters)try{r(e)}catch{}this._pendingPromiseRejecters.clear(),this._listenerSubscriptionPoints.clear();for(const r of this._pendingAttachListeners)r();this._pendingAttachListeners.clear(),this._unsubscribeMessageEvents(),this._offChannelAttached(),this._offChannelUpdate(),this._reactions.dispose(),this._logger.debug("DefaultMessages.dispose(); disposed successfully")}hasListeners(){return ys(this._emitter)}}class WC{constructor(e,r){this._apiProtocolVersion=4,this._realtime=e,this._logger=r}async history(e,r){const a={...r};if(r.orderBy)switch(r.orderBy){case Xh.NewestFirst:{a.direction="backwards";break}case Xh.OldestFirst:{a.direction="forwards";break}default:throw new Ke.ErrorInfo(`invalid orderBy value: ${r.orderBy}`,4e4,400)}const l=await this._makeAuthorizedPaginatedRequest(this._roomUrl(e,"/messages"),a);return this._recursivePaginateMessages(l)}_recursivePaginateMessages(e){const r={};return r.items=e.items.map(a=>Hu(a)),r.next=()=>e.next().then(a=>a?this._recursivePaginateMessages(a):null),r.first=()=>e.first().then(a=>this._recursivePaginateMessages(a)),r.current=()=>e.current().then(a=>this._recursivePaginateMessages(a)),r.hasNext=()=>e.hasNext(),r.isLast=()=>e.isLast(),{...e,...r}}async getMessage(e,r){const a=await this._makeAuthorizedRequest(this._messageUrl(e,r),"GET");return Hu(a)}deleteMessage(e,r,a){const l={...a?.description&&{description:a.description},...a?.metadata&&{metadata:a.metadata}};return this._makeAuthorizedRequest(this._messageUrl(e,r,"/delete"),"POST",l,{})}sendMessage(e,r){const a={text:r.text,...r.metadata&&{metadata:r.metadata},...r.headers&&{headers:r.headers}};return this._makeAuthorizedRequest(this._roomUrl(e,"/messages"),"POST",a)}updateMessage(e,r,a){return this._makeAuthorizedRequest(this._messageUrl(e,r),"PUT",a)}sendMessageReaction(e,r,a){return this._makeAuthorizedRequest(this._messageUrl(e,r,"/reactions"),"POST",a)}deleteMessageReaction(e,r,a){return this._makeAuthorizedRequest(this._messageUrl(e,r,"/reactions"),"DELETE",void 0,a)}getClientReactions(e,r,a){const l=a?{forClientId:a}:{};return this._makeAuthorizedRequest(this._messageUrl(e,r,"/client-reactions"),"GET",void 0,l)}getOccupancy(e){return this._makeAuthorizedRequest(this._roomUrl(e,"/occupancy"),"GET")}async _makeAuthorizedRequest(e,r,a,l){return(await this._doRequest(e,r,l,a)).items[0]}async _makeAuthorizedPaginatedRequest(e,r,a){return this._doRequest(e,"GET",r,a)}async _doRequest(e,r,a,l){const f=await this._realtime.request(r,e,this._apiProtocolVersion,a,l);if(!f.success)throw this._logger.error("ChatApi._doRequest(); failed to make request",{url:e,method:r,statusCode:f.statusCode,errorCode:f.errorCode,errorMessage:f.errorMessage}),new Ke.ErrorInfo(f.errorMessage,f.errorCode,f.statusCode);return f}_roomUrl(e,r=""){return`/chat/v4/rooms/${encodeURIComponent(e)}${r}`}_messageUrl(e,r,a=""){return`${this._roomUrl(e,"/messages")}/${encodeURIComponent(r)}${a}`}}var Io=(n=>(n[n.BadRequest=4e4]="BadRequest",n[n.MessageRejectedByBeforePublishRule=42211]="MessageRejectedByBeforePublishRule",n[n.MessageRejectedByModeration=42213]="MessageRejectedByModeration",n[n.PresenceAutoReentryFailed=91004]="PresenceAutoReentryFailed",n[n.RoomDiscontinuity=102100]="RoomDiscontinuity",n[n.RoomInFailedState=102101]="RoomInFailedState",n[n.RoomIsReleasing=102102]="RoomIsReleasing",n[n.RoomIsReleased=102103]="RoomIsReleased",n[n.RoomReleasedBeforeOperationCompleted=102106]="RoomReleasedBeforeOperationCompleted",n))(Io||{});const HC=n=>`${n}::$chat`,Gu="0.14.1",o_=`chat-js/${Gu}`,GC=`chat-react/${Gu}`,a_=["PUBLISH","SUBSCRIBE"],JC={params:{agent:o_},attachOnSubscribe:!1,modes:a_},QC={params:{agent:`${o_} ${GC}`},attachOnSubscribe:!1,modes:a_};class KC{constructor(e,r,a,l){a.trace("ChannelManager();",{isReact:l}),this._realtime=r,this._logger=a,this._isReact=l,this._registeredOptions=this._defaultChannelOptions(),this._channelId=HC(e)}mergeOptions(e){if(this._logger.trace("ChannelManager.mergeOptions();"),this._resolvedChannel)throw this._logger.error("channel options cannot be modified after the channel has been requested"),new Ke.ErrorInfo("channel options cannot be modified after the channel has been requested",4e4,400);this._registeredOptions=e(this._registeredOptions)}get(){return this._logger.trace("ChannelManager.get();"),this._resolvedChannel??=this._realtime.channels.get(this._channelId,this._registeredOptions),this._resolvedChannel}release(){this._logger.trace("ChannelManager.release();",{channelId:this._channelId}),this._resolvedChannel&&this._realtime.channels.release(this._channelId)}_defaultChannelOptions(){this._logger.trace("ChannelManager._defaultChannelOptions();");const e=this._isReact?QC:JC;return this._logger.trace(this._isReact?"using react channel options":"using default channel options"),{...e,modes:[...e.modes??[]]}}}const YC=n=>{const e=n;let r=0,a=0;if(!e.data||typeof e.data!="object")return{connections:r,presenceMembers:a};const{metrics:l}=e.data;return!l||typeof l!="object"?{connections:r,presenceMembers:a}:(typeof l.connections=="number"&&Number.isInteger(l.connections)&&(r=l.connections),typeof l.presenceMembers=="number"&&Number.isInteger(l.presenceMembers)&&(a=l.presenceMembers),{connections:r,presenceMembers:a})};class c_{constructor(e,r,a,l,f){this._emitter=new fi,this._roomName=e,this._channel=r,this._chatApi=a,this._logger=l,this._roomOptions=f;const h=this._internalOccupancyListener.bind(this);this._roomOptions.occupancy.enableEvents?(this._logger.debug("DefaultOccupancy(); subscribing to occupancy events"),this._unsubscribeOccupancyEvents=Ro(this._channel,[r_.Occupancy],h)):this._unsubscribeOccupancyEvents=()=>{}}subscribe(e){if(this._logger.trace("Occupancy.subscribe();"),!this._roomOptions.occupancy.enableEvents)throw new Ke.ErrorInfo("cannot subscribe to occupancy; occupancy events are not enabled in room options",4e4,400);const r=Cr(e);return this._emitter.on(r),{unsubscribe:()=>{this._logger.trace("Occupancy.unsubscribe();"),this._emitter.off(r)}}}async get(){return this._logger.trace("Occupancy.get();"),this._chatApi.getOccupancy(this._roomName)}current(){if(this._logger.trace("Occupancy.current();"),!this._roomOptions.occupancy.enableEvents)throw new Ke.ErrorInfo("cannot get current occupancy; occupancy events are not enabled in room options",4e4,400);return this._latestOccupancyData}_internalOccupancyListener(e){this._logger.trace("Occupancy._internalOccupancyListener();",e),this._latestOccupancyData=YC(e),this._emitter.emit(Qh.Updated,{type:Qh.Updated,occupancy:this._latestOccupancyData})}static channelOptionMerger(e){return r=>e.occupancy.enableEvents?{...r,params:{...r.params,occupancy:"metrics"}}:r}dispose(){this._logger.trace("DefaultOccupancy.dispose();"),this._unsubscribeOccupancyEvents(),this._emitter.off(),this._logger.debug("DefaultOccupancy.dispose(); disposed successfully")}hasListeners(){return ys(this._emitter)}}class l_{constructor(e,r,a,l){this._emitter=new fi,this._stateEmitter=new fi,this._presenceState={present:!1},this.subscribeToEvents=y=>{this._emitter.emit(y.action,{type:y.action,member:this._realtimeMemberToPresenceMember(y)})},this._channel=e,this._clientId=r,this._logger=a,this._options=l;const f=this.subscribeToEvents.bind(this),h=y=>{if(y.reason?.code===91004){this._logger.debug("Presence auto-reentry failed",{reason:y.reason}),this._emitPresenceStateChange(!1,y.reason);return}if(y.current==="detached"){this._emitPresenceStateChange(!1);return}},v=y=>{this._emitPresenceStateChange(!1,y.reason)};this._offChannelUpdate=vs(this._channel,"update",h),this._offChannelDetach=vs(this._channel,["detached","failed"],v),this._unsubscribePresenceEvents=Ro(this._channel.presence,f)}async get(e){return this._logger.trace("Presence.get()",{params:e}),this._assertChannelState(),(await this._channel.presence.get(e)).map(r=>this._realtimeMemberToPresenceMember(r))}async isUserPresent(e){return this._logger.trace("Presence.isUserPresent()",{clientId:e}),this._assertChannelState(),(await this._channel.presence.get({clientId:e})).length>0}async enter(e){this._logger.trace("Presence.enter()",{data:e}),this._assertChannelState();try{await this._channel.presence.enterClient(this._clientId,e),this._emitPresenceStateChange(!0)}catch(r){throw this._emitPresenceStateChange(!1,r),r}}async update(e){this._logger.trace("Presence.update()",{data:e}),this._assertChannelState();try{await this._channel.presence.updateClient(this._clientId,e),this._emitPresenceStateChange(!0)}catch(r){throw this._emitPresenceStateChange(!1,r),r}}async leave(e){this._logger.trace("Presence.leave()",{data:e}),this._assertChannelState();try{await this._channel.presence.leaveClient(this._clientId,e),this._emitPresenceStateChange(!1)}catch(r){throw this._emitPresenceStateChange(!1,r),r}}subscribe(e,r){if(this._logger.trace("Presence.subscribe(); listenerOrEvents",{listenerOrEvents:e}),!this._options.presence.enableEvents)throw this._logger.error("could not subscribe to presence; presence events are not enabled"),new Ke.ErrorInfo("could not subscribe to presence; presence events are not enabled",4e4,400);if(!e&&!r)throw this._logger.error("could not subscribe to presence; invalid arguments"),new Ke.ErrorInfo("could not subscribe listener: invalid arguments",4e4,400);if(r){const a=Cr(r);return this._emitter.on(e,a),{unsubscribe:()=>{this._logger.trace("Presence.unsubscribe();",{events:e}),this._emitter.off(a)}}}else{const a=Cr(e);return this._emitter.on(a),{unsubscribe:()=>{this._logger.trace("Presence.unsubscribe();"),this._emitter.off(a)}}}}static channelOptionMerger(e){return r=>(r.modes.includes("PRESENCE")||r.modes.push("PRESENCE"),e.presence.enableEvents&&!r.modes.includes("PRESENCE_SUBSCRIBE")&&r.modes.push("PRESENCE_SUBSCRIBE"),r)}dispose(){this._logger.trace("DefaultPresence.dispose();"),this._emitter.off(),this._unsubscribePresenceEvents(),this._offChannelUpdate(),this._offChannelDetach(),this._logger.debug("DefaultPresence.dispose(); disposed successfully")}hasListeners(){return ys(this._emitter)}_realtimeMemberToPresenceMember(e){return{...e,data:e.data,updatedAt:new Date(e.timestamp)}}_assertChannelState(){if(this._channel.state!=="attaching"&&this._channel.state!=="attached")throw this._logger.error("could not perform presence operation; room is not attached"),new Ke.ErrorInfo("could not perform presence operation; room is not attached",4e4,400)}_emitPresenceStateChange(e,r){this._logger.trace("Presence._emitPresenceStateChange()",{present:e,error:r});const a={...this._presenceState};this._presenceState={present:e};const l={previous:a,current:this._presenceState,error:r};this._stateEmitter.emit("presence.state.change",l)}onPresenceStateChange(e){this._logger.trace("Presence.onPresenceStateChange()");const r=Cr(e);return this._stateEmitter.on("presence.state.change",r),{unsubscribe:()=>{this._logger.trace("Presence.unsubscribeFromPresenceStateChanges()"),this._stateEmitter.off(r)}}}}const Ju=new Error("request for lock canceled");var XC=function(n,e,r,a){function l(f){return f instanceof r?f:new r(function(h){h(f)})}return new(r||(r=Promise))(function(f,h){function v(E){try{b(a.next(E))}catch(O){h(O)}}function y(E){try{b(a.throw(E))}catch(O){h(O)}}function b(E){E.done?f(E.value):l(E.value).then(v,y)}b((a=a.apply(n,e||[])).next())})};class ZC{constructor(e,r=Ju){this._value=e,this._cancelError=r,this._queue=[],this._weightedWaiters=[]}acquire(e=1,r=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((a,l)=>{const f={resolve:a,reject:l,weight:e,priority:r},h=u_(this._queue,v=>r<=v.priority);h===-1&&e<=this._value?this._dispatchItem(f):this._queue.splice(h+1,0,f)})}runExclusive(e){return XC(this,arguments,void 0,function*(r,a=1,l=0){const[f,h]=yield this.acquire(a,l);try{return yield r(f)}finally{h()}})}waitForUnlock(e=1,r=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,r)?Promise.resolve():new Promise(a=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),e1(this._weightedWaiters[e-1],{resolve:a,priority:r})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){const r=this._value;this._value-=e.weight,e.resolve([r,this._newReleaser(e.weight)])}_newReleaser(e){let r=!1;return()=>{r||(r=!0,this.release(e))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let e=this._value;e>0;e--){const r=this._weightedWaiters[e-1];r&&(r.forEach(a=>a.resolve()),this._weightedWaiters[e-1]=[])}else{const e=this._queue[0].priority;for(let r=this._value;r>0;r--){const a=this._weightedWaiters[r-1];if(!a)continue;const l=a.findIndex(f=>f.priority<=e);(l===-1?a:a.splice(0,l)).forEach(f=>f.resolve())}}}_couldLockImmediately(e,r){return(this._queue.length===0||this._queue[0].priority<r)&&e<=this._value}}function e1(n,e){const r=u_(n,a=>e.priority<=a.priority);n.splice(r+1,0,e)}function u_(n,e){for(let r=n.length-1;r>=0;r--)if(e(n[r]))return r;return-1}var t1=function(n,e,r,a){function l(f){return f instanceof r?f:new r(function(h){h(f)})}return new(r||(r=Promise))(function(f,h){function v(E){try{b(a.next(E))}catch(O){h(O)}}function y(E){try{b(a.throw(E))}catch(O){h(O)}}function b(E){E.done?f(E.value):l(E.value).then(v,y)}b((a=a.apply(n,e||[])).next())})};class d_{constructor(e){this._semaphore=new ZC(1,e)}acquire(){return t1(this,arguments,void 0,function*(e=0){const[,r]=yield this._semaphore.acquire(1,e);return r})}runExclusive(e,r=0){return this._semaphore.runExclusive(()=>e(),1,r)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}var Rt=(n=>(n.Initializing="initializing",n.Initialized="initialized",n.Attaching="attaching",n.Attached="attached",n.Detaching="detaching",n.Detached="detached",n.Suspended="suspended",n.Failed="failed",n.Releasing="releasing",n.Released="released",n))(Rt||{});class n1{constructor(e){this._status="initialized",this._emitter=new fi,this._logger=e}get status(){return this._status}get error(){return this._error}onChange(e){const r=Cr(e);return this._emitter.on(r),{off:()=>{this._emitter.off(r)}}}setStatus(e){const r={current:e.status,error:e.error,previous:this._status};this._status=r.current,this._error=r.error,this._logger.info("room status changed",{...r}),this._emitter.emit(r.current,r)}dispose(){this._logger.trace("DefaultRoomLifecycle.dispose();"),this._emitter.off(),this._logger.debug("DefaultRoomLifecycle.dispose(); disposed successfully")}hasListeners(){return ys(this._emitter)}}class r1{constructor(e,r,a){this._channelManager=e,this._roomLifecycle=r,this._logger=a,this._eventEmitter=new fi,this._hasAttachedOnce=!1,this._isExplicitlyDetached=!1,this._mutex=new d_;const l=this._channelStateListener.bind(this),f=this._discontinuityOnAttachedListener.bind(this),h=this._discontinuityOnUpdateListener.bind(this),v=this._channelManager.get();this._unsubscribeChannelStateListener=vs(v,l),this._offDiscontinuityAttached=vs(v,"attached",f),this._offDiscontinuityUpdate=vs(v,"update",h)}onDiscontinuity(e){this._logger.trace("RoomLifecycleManager.onDiscontinuity()");const r=Cr(e);return this._eventEmitter.on(Nc.Discontinuity,r),{off:()=>{this._eventEmitter.off(Nc.Discontinuity,r)}}}async attach(){await this._mutex.runExclusive(async()=>{if(this._logger.trace("RoomLifecycleManager.attach();"),this._checkRoomNotReleasing("attach"),this._roomStatusIs(Rt.Attached)){this._logger.debug("RoomLifecycleManager.attach(); room already attached, no-op");return}const e=this._channelManager.get();this._logger.debug("RoomLifecycleManager.attach(); attaching room",{channelState:e.state});try{this._setStatus(Rt.Attaching),await e.attach(),this._setStatus(Rt.Attached),this._isExplicitlyDetached=!1,this._hasAttachedOnce=!0,this._logger.debug("RoomLifecycleManager.attach(); room attached successfully")}catch(r){const a=r,l=new Ke.ErrorInfo(`failed to attach room: ${a.message}`,a.code,a.statusCode,a),f=this._mapChannelStateToRoomStatus(e.state);throw this._setStatus(f,l),l}},1)}async detach(){await this._mutex.runExclusive(async()=>{if(this._logger.trace("RoomLifecycleManager.detach();"),this._roomStatusIs(Rt.Failed))throw new Ke.ErrorInfo("cannot detach room, room is in failed state",Io.RoomInFailedState,400);if(this._checkRoomNotReleasing("detach"),this._roomStatusIs(Rt.Detached)){this._logger.debug("RoomLifecycleManager.detach(); room already detached, no-op");return}const e=this._channelManager.get();this._logger.debug("RoomLifecycleManager.detach(); detaching room",{channelState:e.state});try{this._setStatus(Rt.Detaching),await e.detach(),this._isExplicitlyDetached=!0,this._setStatus(Rt.Detached),this._logger.debug("RoomLifecycleManager.detach(); room detached successfully")}catch(r){const a=r,l=new Ke.ErrorInfo(`failed to detach room: ${a.message}`,a.code,a.statusCode,a),f=this._mapChannelStateToRoomStatus(e.state);throw this._setStatus(f,l),l}},1)}async release(){await this._mutex.runExclusive(async()=>{if(this._logger.trace("RoomLifecycleManager.release();"),this._roomStatusIs(Rt.Released)){this._logger.debug("RoomLifecycleManager.release(); room already released, no-op");return}if(this._roomStatusIs(Rt.Initialized)||this._roomStatusIs(Rt.Detached)){this._logger.debug("RoomLifecycleManager.release(); room is initialized or detached, releasing immediately",{status:this._roomLifecycle.status}),this._releaseChannel();return}this._setStatus(Rt.Releasing);const e=this._channelManager.get();this._logger.debug("RoomLifecycleManager.release(); attempting channel detach before release",{channelState:e.state}),await this._channelDetachLoop(e),this._releaseChannel()},0)}_mapChannelStateToRoomStatus(e){switch(e){case"initialized":return Rt.Initialized;case"attaching":return Rt.Attaching;case"attached":return Rt.Attached;case"detaching":return Rt.Detaching;case"detached":return Rt.Detached;case"suspended":return Rt.Suspended;case"failed":return Rt.Failed;default:return this._logger.error("RoomLifecycleManager._mapChannelStateToRoomStatus(); unknown channel state",{channelState:e}),Rt.Failed}}_checkRoomNotReleasing(e){switch(this._roomLifecycle.status){case Rt.Released:throw new Ke.ErrorInfo(`cannot ${e} room, room is released`,Io.RoomIsReleased,400);case Rt.Releasing:throw new Ke.ErrorInfo(`cannot ${e} room, room is currently releasing`,Io.RoomIsReleasing,400)}}_roomStatusIs(e){return this._roomLifecycle.status===e}dispose(){this._unsubscribeChannelStateListener(),this._offDiscontinuityAttached(),this._offDiscontinuityUpdate(),this._eventEmitter.off()}hasListeners(){return ys(this._eventEmitter)}_channelStateListener(e){if(this._logger.debug("RoomLifecycleManager.channel state changed",{oldState:e.previous,newState:e.current,reason:e.reason,resumed:e.resumed}),this._operationInProgress()){this._logger.debug("RoomLifecycleManager._startMonitoringChannelState(); ignoring channel state change - operation in progress",{status:this._roomLifecycle.status});return}const r=this._mapChannelStateToRoomStatus(e.current);this._setStatus(r,e.reason)}_discontinuityOnAttachedListener(e){if(!e.resumed&&this._hasAttachedOnce&&!this._isExplicitlyDetached){const r=new Ke.ErrorInfo("discontinuity detected",Io.RoomDiscontinuity,e.reason?.statusCode??0,e.reason);this._logger.warn("RoomLifecycleManager._startMonitoringDiscontinuity(); discontinuity detected",{error:r}),this._eventEmitter.emit(Nc.Discontinuity,r)}}_discontinuityOnUpdateListener(e){if(!e.resumed&&this._hasAttachedOnce&&!this._isExplicitlyDetached&&e.current==="attached"&&e.previous==="attached"){const r=new Ke.ErrorInfo("discontinuity detected",Io.RoomDiscontinuity,e.reason?.statusCode??0,e.reason);this._logger.warn("RoomLifecycleManager._startMonitoringDiscontinuity(); discontinuity detected",{error:r}),this._eventEmitter.emit(Nc.Discontinuity,r)}}async _channelDetachLoop(e){for(;;){if(e.state==="failed"){this._logger.debug("RoomLifecycleManager._channelDetachLoop(); channel is failed, skipping detach");break}try{await e.detach();break}catch(r){this._logger.error("RoomLifecycleManager._channelDetachLoop(); failed to detach channel during release",{error:r}),await new Promise(a=>setTimeout(a,250))}}}_setStatus(e,r){this._logger.debug("RoomLifecycleManager._setStatus(); updating room status",{oldStatus:this._roomLifecycle.status,newStatus:e,hasError:!!r}),this._roomLifecycle.setStatus({status:e,error:r})}_releaseChannel(){this._channelManager.release(),this._setStatus(Rt.Released),this._logger.debug("RoomLifecycleManager._releaseChannel(); room released successfully")}_operationInProgress(){return this._mutex.isLocked()}testForceHasAttachedOnce(e){this._logger.trace("RoomLifecycleManager.testForceHasAttachedOnce();",{firstAttach:e}),this._hasAttachedOnce=e}}const Qu={typing:{heartbeatThrottleMs:1e4},occupancy:{enableEvents:!1},presence:{enableEvents:!0},messages:{rawMessageReactions:!1,defaultMessageReactionType:Po.Distinct}},i1=n=>new Ke.ErrorInfo(`invalid room configuration: ${n}`,40001,400),s1=n=>{o1(n.typing)},o1=n=>{if(n.heartbeatThrottleMs<=0)throw i1("typing heartbeat interval must be greater than 0")},a1=n=>({...Qu.typing,...n?.typing}),c1=n=>({...Qu.occupancy,...n?.occupancy}),l1=n=>({...Qu.presence,...n?.presence}),u1=n=>({...Qu.messages,...n?.messages}),d1=(n,e)=>({typing:a1(n),occupancy:c1(n),presence:l1(n),messages:u1(n),isReactClient:e}),f_=(n,e)=>({name:n,data:e,extras:{ephemeral:!0}}),f1=n=>{const e=n.extras?n.extras:{};return{...n,extras:{...e,ephemeral:!0}}};class h1{constructor(e,r,a,l,f,h){this.name=e,this.clientId=r,this.createdAt=a,this.isSelf=l,this.metadata=f,this.headers=h,Object.freeze(this)}}const p1=(n,e)=>{const r=n,a=r.data?.name&&typeof r.data.name=="string"?r.data.name:"",l=r.clientId??"",f=r.timestamp?new Date(r.timestamp):new Date;return new h1(a,l,f,e?e===l:!1,r.data?.metadata??{},r.extras?.headers??{})};class g1{constructor(e,r,a,l){this._emitter=new fi,this._forwarder=h=>{const v=p1(h,this._clientId);this._emitter.emit(Jh.Reaction,{type:Jh.Reaction,reaction:v})},this._channel=e,this._connection=r,this._clientId=a,this._logger=l;const f=this._forwarder.bind(this);this._unsubscribeRoomReactionEvents=Ro(this._channel,[Gh.Reaction],f)}send(e){this._logger.trace("RoomReactions.send();",e);const{name:r,metadata:a,headers:l}=e;if(!r)return Promise.reject(new Ke.ErrorInfo("unable to send reaction; name not set and it is required",40001,400));if(this._connection.state!=="connected")return Promise.reject(new Ke.ErrorInfo("unable to send reaction; not connected to Ably",4e4,400));const f={name:r,metadata:a??{}},h={name:Gh.Reaction,data:f,extras:{headers:l??{}}};return this._channel.publish(f1(h))}subscribe(e){this._logger.trace("RoomReactions.subscribe();");const r=Cr(e);return this._emitter.on(r),{unsubscribe:()=>{this._logger.trace("RoomReactions.unsubscribe();"),this._emitter.off(r)}}}dispose(){this._unsubscribeRoomReactionEvents(),this._emitter.off()}hasListeners(){return ys(this._emitter)}}class m1 extends fi{constructor(e,r,a,l,f){super(),this._timeoutMs=2e3,this._mutex=new d_,this._internalSubscribeToEvents=h=>{const{name:v,clientId:y}=h;if(this._logger.trace("DefaultTyping._internalSubscribeToEvents(); received event",{name:v,clientId:y}),!y){this._logger.error("DefaultTyping._internalSubscribeToEvents(); invalid clientId in received event",{inbound:h});return}v===qr.Started||v===qr.Stopped?this._updateCurrentlyTyping(y,v):this._logger.warn("DefaultTyping._internalSubscribeToEvents(); unrecognized event",{name:v})},this._clientId=l,this._channel=a,this._connection=r,this._heartbeatThrottleMs=e.heartbeatThrottleMs,this._currentlyTyping=new Map,this._logger=f,this._unsubscribeTypingEvents=Ro(this._channel,[qr.Started,qr.Stopped],this._internalSubscribeToEvents.bind(this))}_clearAllTypingStates(){this._logger.debug("DefaultTyping._clearAllTypingStates(); clearing all typing states"),this._clearHeartbeatTimer(),this._clearCurrentlyTyping()}_clearHeartbeatTimer(){this._logger.trace("DefaultTyping._clearHeartbeatTimer(); clearing heartbeat timer"),this._heartbeatTimerId&&(clearTimeout(this._heartbeatTimerId),this._heartbeatTimerId=void 0)}_clearCurrentlyTyping(){this._logger.trace("DefaultTyping._clearCurrentlyTyping(); clearing current store and timeouts");for(const[,e]of this._currentlyTyping.entries())clearTimeout(e);this._currentlyTyping.clear()}current(){return this._logger.trace("DefaultTyping.current();"),new Set(this._currentlyTyping.keys())}get channel(){return this._channel}_startHeartbeatTimer(){if(!this._heartbeatTimerId){this._logger.trace("DefaultTyping.startHeartbeatTimer();");const e=this._heartbeatTimerId=setTimeout(()=>{this._logger.debug("DefaultTyping.startHeartbeatTimer(); heartbeat timer expired"),e===this._heartbeatTimerId&&(this._heartbeatTimerId=void 0)},this._heartbeatThrottleMs)}}async keystroke(){this._logger.trace("DefaultTyping.keystroke();"),this._mutex.cancel();try{await this._mutex.acquire()}catch(e){if(e===Ju){this._logger.debug("DefaultTyping.keystroke(); mutex was canceled by a later operation");return}throw new Ke.ErrorInfo("mutex acquisition failed",5e4,500)}try{if(this._connection.state!=="connected")throw this._logger.error("DefaultTyping.keystroke(); connection is not connected",{status:this._connection.state}),new Ke.ErrorInfo("cannot type, connection is not connected",4e4,400);if(this._heartbeatTimerId){this._logger.debug("DefaultTyping.keystroke(); no-op, already typing and heartbeat timer has not expired");return}await this._channel.publish(f_(qr.Started)),this._startHeartbeatTimer(),this._logger.trace("DefaultTyping.keystroke(); starting timers")}finally{this._logger.trace("DefaultTyping.keystroke(); releasing mutex"),this._mutex.release()}}async stop(){this._logger.trace("DefaultTyping.stop();"),this._mutex.cancel();try{await this._mutex.acquire()}catch(e){if(e===Ju){this._logger.debug("DefaultTyping.stop(); mutex was canceled by a later operation");return}throw new Ke.ErrorInfo("mutex acquisition failed",5e4,500)}try{if(this._connection.state!=="connected")throw this._logger.error("DefaultTyping.stop(); connection is not connected",{status:this._connection.state}),new Ke.ErrorInfo("cannot stop typing, connection is not connected",4e4,400);if(!this._heartbeatTimerId){this._logger.debug("DefaultTyping.stop(); no-op, not currently typing");return}await this._channel.publish(f_(qr.Stopped)),this._logger.trace("DefaultTyping.stop(); clearing timers"),clearTimeout(this._heartbeatTimerId),this._heartbeatTimerId=void 0}finally{this._logger.trace("DefaultTyping.stop(); releasing mutex"),this._mutex.release()}}subscribe(e){this._logger.trace("DefaultTyping.subscribe();");const r=Cr(e);return this.on(r),{unsubscribe:()=>{this._logger.trace("DefaultTyping.unsubscribe();"),this.off(r)}}}async dispose(){for(this._logger.trace("DefaultTyping.dispose();");;)try{this._mutex.cancel(),await this._mutex.acquire();break}catch(e){if(e===Ju)this._logger.debug("DefaultTyping.dispose(); mutex was canceled"),await new Promise(r=>setTimeout(r,200)),this._logger.debug("DefaultTyping.dispose(); retrying mutex acquisition");else{this._logger.error("DefaultTyping.dispose(); failed to acquire mutex; could not complete resource disposal",{error:e});return}}this._clearAllTypingStates(),this._unsubscribeTypingEvents(),this.off(),this._mutex.release()}_updateCurrentlyTyping(e,r){this._logger.trace("DefaultTyping._updateCurrentlyTyping();",{clientId:e,event:r}),r===qr.Started?this._handleTypingStart(e):this._handleTypingStop(e)}_startNewClientInactivityTimer(e){this._logger.trace("DefaultTyping._startNewClientInactivityTimer(); starting new inactivity timer",{clientId:e});const r=setTimeout(()=>{if(this._logger.trace("DefaultTyping._startNewClientInactivityTimer(); client typing timeout expired",{clientId:e}),this._currentlyTyping.get(e)!==r){this._logger.debug("DefaultTyping._startNewClientInactivityTimer(); timeout already cleared; ignoring",{clientId:e});return}this._currentlyTyping.delete(e),this.emit(Ao.SetChanged,{type:Ao.SetChanged,currentlyTyping:new Set(this._currentlyTyping.keys()),change:{clientId:e,type:qr.Stopped}})},this._heartbeatThrottleMs+this._timeoutMs);return r}_handleTypingStart(e){this._logger.debug("DefaultTyping._handleTypingStart();",{clientId:e});const r=this._startNewClientInactivityTimer(e),a=this._currentlyTyping.get(e);this._currentlyTyping.set(e,r),a?(this._logger.debug("DefaultTyping._handleTypingStart(); received heartbeat for currently typing client",{clientId:e}),clearTimeout(a)):(this._logger.debug("DefaultTyping._handleTypingStart(); new client started typing",{clientId:e}),this.emit(Ao.SetChanged,{type:Ao.SetChanged,currentlyTyping:new Set(this._currentlyTyping.keys()),change:{clientId:e,type:qr.Started}}))}_handleTypingStop(e){const r=this._currentlyTyping.get(e);if(!r){this._logger.trace('DefaultTyping._handleTypingStop(); received "Stop" event for client not in currentlyTyping list',{clientId:e});return}this._logger.debug("DefaultTyping._handleTypingStop(); client stopped typing",{clientId:e}),clearTimeout(r),this._currentlyTyping.delete(e),this.emit(Ao.SetChanged,{type:Ao.SetChanged,currentlyTyping:new Set(this._currentlyTyping.keys()),change:{clientId:e,type:qr.Stopped}})}get heartbeatThrottleMs(){return this._heartbeatThrottleMs}get hasHeartbeatTimer(){return!!this._heartbeatTimerId}}class v1{constructor(e,r,a,l,f,h){s1(a),this._nonce=r,this._logger=h.withContext({roomName:e,roomNonce:r}),this._logger.debug("Room();",{options:a}),this._name=e,this._options=a,this._chatApi=f,this._lifecycle=new n1(this._logger);const v=this._channelManager=this._getChannelManager(a,l,this._logger),y=v.get();this._messages=new qC(e,a.messages,y,this._chatApi,l.auth.clientId,this._logger),this._presence=new l_(y,l.auth.clientId,this._logger,a),this._typing=new m1(a.typing,l.connection,y,l.auth.clientId,this._logger),this._reactions=new g1(y,l.connection,l.auth.clientId,this._logger),this._occupancy=new c_(e,y,this._chatApi,this._logger,a),this._lifecycleManager=new r1(v,this._lifecycle,this._logger);let b=!1;this._finalizer=async()=>{if(b){this._logger.debug("Room.finalizer(); already finalized");return}await this._lifecycleManager.release(),this._lifecycleManager.dispose(),this._messages.dispose(),this._presence.dispose(),this._reactions.dispose(),this._occupancy.dispose(),await this._typing.dispose(),this._lifecycle.dispose(),b=!0}}_getChannelManager(e,r,a){const l=new KC(this._name,r,a,e.isReactClient);return l.mergeOptions(c_.channelOptionMerger(e)),l.mergeOptions(l_.channelOptionMerger(e)),l.mergeOptions(s_.channelOptionMerger(e)),l}get name(){return this._name}options(){return ws(this._options)}get messages(){return this._messages}get presence(){return this._presence}get reactions(){return this._reactions}get typing(){return this._typing}get occupancy(){return this._occupancy}get status(){return this._lifecycle.status}get error(){return this._lifecycle.error}onStatusChange(e){return this._lifecycle.onChange(e)}async attach(){return this._logger.trace("Room.attach();"),this._lifecycleManager.attach()}async detach(){return this._logger.trace("Room.detach();"),this._lifecycleManager.detach()}release(){return this._logger.trace("Room.release();"),this._finalizer()}get nonce(){return this._nonce}get lifecycle(){return this._lifecycle}get lifecycleManager(){return this._lifecycleManager}onDiscontinuity(e){return this._logger.trace("Room.onDiscontinuity();"),this._lifecycleManager.onDiscontinuity(e)}get channel(){return this._channelManager.get()}}class y1{constructor(e,r,a){this._rooms=new Map,this._releasing=new Map,this._isReact=!1,this._disposed=!1,this._realtime=e,this._chatApi=new WC(e,a),this._clientOptions=r,this._logger=a}async get(e,r){this._logger.trace("Rooms.get();",{roomName:e}),this._ensureNotDisposed();const a=this._rooms.get(e);if(a)return this._handleExistingRoom(a,e,r);const l=this._releasing.get(e),f=Zy();return l?this._waitForReleaseAndCreateRoom(e,f,r,l):this._createNewRoom(e,f,r)}async release(e){this._logger.trace("Rooms.release();",{roomName:e});const r=this._rooms.get(e),a=this._releasing.get(e);return r?a?this._handleConcurrentRelease(e,r,a):this._performRoomRelease(e,r):this._handleNonExistentRoomRelease(e,a)}async dispose(){this._logger.trace("Rooms.dispose();"),this._disposed=!0;const e=[...this._rooms.keys()];if(e.length===0){this._logger.debug("Rooms.dispose(); no rooms to release");return}const r=e.map(f=>this.release(f)),a=[...this._releasing.values()],l=[...r,...a];this._logger.debug("Rooms.dispose(); releasing rooms",{roomCount:e.length,roomNames:e}),await Promise.all(l),this._logger.debug("Rooms.dispose(); all rooms released successfully")}get clientOptions(){return this._clientOptions}get count(){return this._rooms.size}_ensureNotDisposed(){if(this._disposed)throw new Ke.ErrorInfo("cannot get room, rooms instance has been disposed",4e4,400)}async _handleExistingRoom(e,r,a){if(!jc(e.options,a))throw new Ke.ErrorInfo("room already exists with different options",4e4,400);return this._logger.debug("Rooms.get(); returning existing room",{roomName:r,nonce:e.nonce,options:a}),await e.promise}_createNewRoom(e,r,a){const l=this._makeRoom(e,r,a),f={promise:Promise.resolve(l),nonce:r,options:a};return this._rooms.set(e,f),this._logger.debug("Rooms.get(); returning new room",{roomName:e,nonce:l.nonce}),l}async _waitForReleaseAndCreateRoom(e,r,a,l){const f=new AbortController,h=this._createAbortableRoomPromise(e,r,a,l,f);return this._rooms.set(e,{promise:h,options:a,nonce:r,abort:f}),this._logger.debug("Rooms.get(); creating new promise dependent on previous release",{roomName:e}),await h}_createAbortableRoomPromise(e,r,a,l,f){return new Promise((h,v)=>{const y=()=>{this._logger.debug("Rooms.get(); aborted before init",{roomName:e}),v(new Ke.ErrorInfo("room released before get operation could complete",Io.RoomReleasedBeforeOperationCompleted,400))};f.signal.addEventListener("abort",y),l.then(()=>{if(f.signal.aborted){this._logger.debug("Rooms.get(); aborted before releasing promise resolved",{roomName:e});return}this._logger.debug("Rooms.get(); releasing finished",{roomName:e});const b=this._makeRoom(e,r,a);f.signal.removeEventListener("abort",y),h(b)}).catch(b=>{f.signal.removeEventListener("abort",y),v(b)})})}async _handleNonExistentRoomRelease(e,r){if(r){this._logger.debug("Rooms.release(); waiting for previous release call",{roomName:e}),await r;return}this._logger.debug("Rooms.release(); room does not exist",{roomName:e})}async _handleConcurrentRelease(e,r,a){r.abort&&(this._logger.debug("Rooms.release(); aborting get call",{roomName:e,existingNonce:r.nonce}),r.abort.abort(),this._rooms.delete(e)),await a}async _performRoomRelease(e,r){this._rooms.delete(e);const a=this._executeRoomRelease(e,r);this._releasing.set(e,a),this._logger.debug("Rooms.release(); creating new release promise",{roomName:e,nonce:r.nonce}),await a}async _executeRoomRelease(e,r){const a=await r.promise;this._logger.debug("Rooms.release(); releasing room",{roomName:e,nonce:r.nonce}),await a.release(),this._logger.debug("Rooms.release(); room released",{roomName:e,nonce:r.nonce}),this._releasing.delete(e)}_makeRoom(e,r,a){return new v1(e,r,d1(a,this._isReact),this._realtime,this._chatApi,this._logger)}useReact(){this._logger.trace("Rooms.useReact();"),this._isReact=!0}}class _1{constructor(e,r){this._realtime=e,this._clientOptions=xC(r),this._nonce=Zy(),this._logger=PC(this._clientOptions).withContext({chatClientNonce:this._nonce}),this._connection=new NC(e,this._logger),this._rooms=new y1(e,this._clientOptions,this._logger),this._addAgent("chat-js"),this._logger.trace(`ably chat client version ${Gu}; initialized`)}get rooms(){return this._rooms}get connection(){return this._connection}get clientId(){return this._realtime.auth.clientId}get realtime(){return this._realtime}get clientOptions(){return this._clientOptions}get logger(){return this._logger}addReactAgent(){this._addAgent("chat-react"),this._rooms.useReact()}addAgentWithVersion(e,r){this._addAgent(e,r),this._logger.trace(`Added agent ${e} with version ${r}`)}async dispose(){this._logger.trace("ChatClient.dispose();"),await this._rooms.dispose(),this._connection.dispose(),this._logger.debug("ChatClient.dispose(); client disposed successfully")}_addAgent(e,r){const a=this._realtime;a.options.agents={...a.options.agents??a.options.agents,[e]:r??Gu}}}const h_=Symbol.for("__ABLY_CONTEXT__"),p_=typeof globalThis<"u"?globalThis:{};function w1(){let n=p_[h_];return n||(n=p_[h_]=et.createContext({})),n}const g_=w1(),b1=({client:n,children:e,ablyId:r="default"})=>{if(!n)throw new Error("AblyProvider: the `client` prop is required");const a=et.useContext(g_),l=z.useMemo(()=>Object.assign(Object.assign({},a),{[r]:{client:n,_channelNameToChannelContext:{}}}),[a,n,r]);return _e.jsx(g_.Provider,Object.assign({value:l},{children:e}))},m_=z.createContext(void 0);Ke.Realtime.EventEmitter;var Zh=(n=>(n.Initialized="initialized",n.Connecting="connecting",n.Connected="connected",n.Disconnected="disconnected",n.Suspended="suspended",n.Failed="failed",n))(Zh||{});const v_=Symbol.for("__ABLY_CHAT_CLIENT_CONTEXT__"),y_=typeof globalThis>"u"?{}:globalThis,S1=()=>{let n=y_[v_];return n??=y_[v_]=et.createContext({}),n},Ku=S1();var __=Object.prototype.hasOwnProperty;function w_(n,e,r){for(r of n.keys())if(Dc(r,e))return r}function Dc(n,e){var r,a,l;if(n===e)return!0;if(n&&e&&(r=n.constructor)===e.constructor){if(r===Date)return n.getTime()===e.getTime();if(r===RegExp)return n.toString()===e.toString();if(r===Array){if((a=n.length)===e.length)for(;a--&&Dc(n[a],e[a]););return a===-1}if(r===Set){if(n.size!==e.size)return!1;for(a of n)if(l=a,l&&typeof l=="object"&&(l=w_(e,l),!l)||!e.has(l))return!1;return!0}if(r===Map){if(n.size!==e.size)return!1;for(a of n)if(l=a[0],l&&typeof l=="object"&&(l=w_(e,l),!l)||!Dc(a[1],e.get(l)))return!1;return!0}if(r===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(r===DataView){if((a=n.byteLength)===e.byteLength)for(;a--&&n.getInt8(a)===e.getInt8(a););return a===-1}if(ArrayBuffer.isView(n)){if((a=n.byteLength)===e.byteLength)for(;a--&&n[a]===e[a];);return a===-1}if(!r||typeof n=="object"){a=0;for(r in n)if(__.call(n,r)&&++a&&!__.call(e,r)||!(r in e)||!Dc(n[r],e[r]))return!1;return Object.keys(e).length===a}}return n!==n&&e!==e}var ep=(n=>(n[n.BadRequest=4e4]="BadRequest",n[n.MessageRejectedByBeforePublishRule=42211]="MessageRejectedByBeforePublishRule",n[n.MessageRejectedByModeration=42213]="MessageRejectedByModeration",n[n.PresenceAutoReentryFailed=91004]="PresenceAutoReentryFailed",n[n.RoomDiscontinuity=102100]="RoomDiscontinuity",n[n.RoomInFailedState=102101]="RoomInFailedState",n[n.RoomIsReleasing=102102]="RoomIsReleasing",n[n.RoomIsReleased=102103]="RoomIsReleased",n[n.RoomReleasedBeforeOperationCompleted=102106]="RoomReleasedBeforeOperationCompleted",n))(ep||{});const k1=(n,e)=>n.code===e,tp=n=>{if(n===null||typeof n!="object")return n;if(Array.isArray(n))return n.sort().map(a=>tp(a));const e={},r=Object.keys(n).sort();for(const a of r)e[a]=tp(n[a]);return e},C1=(n,e)=>{if(e===void 0)return;if(e===null||typeof e!="object")return e;if(Array.isArray(e))return e.sort().map(l=>tp(l));const r={},a=Object.keys(e).sort();for(const l of a)r[l]=e[l];return r},Yu=(n,e)=>JSON.stringify({roomName:n,options:e},C1);class E1{constructor(e,r){this._refCounts=new Map,this._releaseDelayMs=100,this._pendingReleases=new Map,this._client=e,this._logger=r}get client(){return this._client}async addReference(e,r){this._logger.trace("RoomReferenceManager.addReference();");const a=Yu(e,r),l=this._refCounts.get(a);if(l)return l.pendingRelease&&(clearTimeout(l.pendingRelease),l.pendingRelease=void 0,this._logger.debug("RoomReferenceManager.addReference(); aborted pending release",{roomName:e,options:r})),l.count++,this._logger.debug("RoomReferenceManager.addReference(); incremented ref count",{roomName:e,options:r,count:l.count}),l.resolvedRoom?l.resolvedRoom:new Promise((y,b)=>{const E=setInterval(()=>{l.resolvedRoom?(clearInterval(E),y(l.resolvedRoom)):l.resolutionError&&(clearInterval(E),b(l.resolutionError))},100)});const f=this._pendingReleases.get(e);if(f){this._logger.debug("RoomReferenceManager.addReference(); waiting for pending release to complete",{roomName:e,options:r});try{await f}catch(y){this._logger.debug("RoomReferenceManager.addReference(); pending release failed, continuing",{roomName:e,options:r,error:y})}}const h=[...this._refCounts.values()].find(y=>y.roomName===e&&!Dc(y.options,r));if(h){const y=h.pendingRelease!==void 0,b=h.count<=0;if(!y&&!b)throw new Ke.ErrorInfo(`cannot get room with different options; room "${e}" is already in use with different options`,ep.BadRequest,400);this._logger.debug("RoomReferenceManager.addReference(); found existing room with different options, releasing it first",{roomName:e,newOptions:r,existingOptions:h.options,hasPendingRelease:y,hasZeroRefCount:b}),h.pendingRelease&&(clearTimeout(h.pendingRelease),h.pendingRelease=void 0);const E=Yu(e,h.options);this._refCounts.delete(E);const O=this._client.rooms.release(e).catch(j=>{this._logger.debug("RoomReferenceManager.addReference(); release of existing room failed",{roomName:e,error:j})}).finally(()=>{this._pendingReleases.delete(e)});this._pendingReleases.set(e,O);try{await O}catch(j){this._logger.debug("RoomReferenceManager.addReference(); release of existing room failed, continuing",{roomName:e,error:j})}}const v={count:1,roomName:e,options:r};this._refCounts.set(a,v),this._logger.debug("RoomReferenceManager.addReference(); first reference, attaching room",{roomName:e,options:r});try{const y=await this._client.rooms.get(e,r);return v.resolvedRoom=y,y.attach().catch(b=>{this._logger.error("RoomReferenceManager.addReference(); error attaching room",{roomName:e,options:r,error:b})}),y}catch(y){throw v.resolutionError=y,this._refCounts.delete(a),this._logger.error("RoomReferenceManager.addReference(); error creating room",{roomName:e,options:r,error:y}),y}}removeReference(e,r){this._logger.trace("RoomReferenceManager.removeReference();");const a=Yu(e,r),l=this._refCounts.get(a);if(!l){this._logger.debug("RoomReferenceManager.removeReference(); no existing reference found",{roomName:e,options:r});return}l.count--,this._logger.debug("RoomReferenceManager.removeReference(); decremented ref count",{roomName:e,options:r,count:l.count}),l.count<=0&&(this._logger.debug("RoomReferenceManager.removeReference(); scheduling delayed release",{roomName:e,options:r,delayMs:this._releaseDelayMs}),l.pendingRelease=setTimeout(()=>{const f=this._refCounts.get(a);if(f&&f.count<=0){this._refCounts.delete(a),this._logger.debug("RoomReferenceManager.removeReference(); executing delayed release",{roomName:e,options:r});const h=this._client.rooms.release(e).catch(v=>{this._logger.debug("RoomReferenceManager.removeReference(); release failed",{roomName:e,options:r,error:v})}).finally(()=>{this._pendingReleases.delete(e)});this._pendingReleases.set(e,h)}},this._releaseDelayMs))}getReferenceCount(e,r){this._logger.trace("RoomReferenceManager.getReferenceCount();");const a=Yu(e,r);return this._refCounts.get(a)?.count??0}}const b_=Symbol("roomReferenceManager"),M1=()=>{const n=z.useContext(Ku)[b_];if(!n)throw new Ke.ErrorInfo("useRoomReferenceManager must be used within a ChatClientProvider",4e4,400);return n},S_="default",O1=({children:n,client:e})=>{const r=z.useContext(Ku),a=z.useRef(void 0),l=z.useMemo(()=>{if(e.addReactAgent(),!a.current||a.current.client!==e){const h=e.logger;a.current=new E1(e,h)}const f=globalThis.__ABLY_CHAT_REACT_UI_COMPONENTS_VERSION__;return typeof f=="string"&&e.addAgentWithVersion("chat-react-ui-components",f),{...r,[S_]:{client:e},[b_]:a.current}},[e,r]);return _e.jsx(Ku.Provider,{value:l,children:n})},Xu=()=>{const n=et.useContext(Ku)[S_];if(!n)throw new Ke.ErrorInfo("useChatClient hook must be used within a chat client provider",4e4,400);return n.client},Aa=n=>{const e=z.useContext(m_);if(!e)throw new Ke.ErrorInfo(`${n} hook must be used within a <ChatRoomProvider>`,4e4,400);return e},k_=()=>{const n=Xu();return z.useMemo(()=>n.logger,[n])},Uc=()=>{const n=Aa("useRoomLogger"),e=Xu();return z.useMemo(()=>e.logger.withContext({roomName:n.roomName}),[e,n])},Wr=n=>{const e=z.useRef(n);z.useEffect(()=>{e.current=n});const r=z.useCallback((...a)=>{e.current&&e.current(...a)},[]);return n?r:void 0},Zu=n=>{const e=Xu(),r=k_();r.trace("useChatConnection();",n);const[a,l]=z.useState(e.connection.status),[f,h]=z.useState(e.connection.error);z.useEffect(()=>{h(e.connection.error),l(e.connection.status)},[e]);const v=Wr(n?.onStatusChange);return z.useEffect(()=>{r.debug("useChatConnection(); applying internal listener");const{off:y}=e.connection.onStatusChange(b=>{l(b.current),h(b.error)});return()=>{r.debug("useChatConnection(); cleaning up listener"),y()}},[e.connection,r]),z.useEffect(()=>{if(!v)return;r.debug("useChatConnection(); applying client listener");const{off:y}=e.connection.onStatusChange(v);return()=>{r.debug("useChatConnection(); cleaning up client listener"),y()}},[e.connection,r,v]),{currentStatus:a,error:f}};class T1{constructor(e,r,a){this._unmounted=!1,this._onResolve=r,this._logger=a,this.mount(e).catch(l=>{this._logger.trace("DefaultRoomPromise(); mount error",{error:l})})}async mount(e){this._logger.debug("DefaultRoomPromise(); mount");try{const r=await e;if(this._unmounted)return;this._logger.debug("DefaultRoomPromise(); mount resolved"),this._onUnmount=this._onResolve(r)}catch(r){this._logger.error("DefaultRoomPromise(); mount error",{error:r})}}unmount(){return this._unmounted?()=>{}:()=>{this._logger.debug("DefaultRoomPromise(); unmount"),this._unmounted=!0,this._onUnmount?.()}}}const wn=(n,e,r)=>new T1(n,e,r);var bs=(n=>(n.Initializing="initializing",n.Initialized="initialized",n.Attaching="attaching",n.Attached="attached",n.Detaching="detaching",n.Detached="detached",n.Suspended="suspended",n.Failed="failed",n.Releasing="releasing",n.Released="released",n))(bs||{});const ed=n=>{const e=Aa("useRoomStatus"),[r,a]=z.useState(bs.Initializing),[l,f]=z.useState(),h=Uc(),v=Wr(n?.onRoomStatusChange);return z.useEffect(()=>wn(e.room,y=>{h.debug("useRoomStatus(); subscribing internal listener"),a(y.status),f(y.error);const{off:b}=y.onStatusChange(E=>{h.debug("useRoomStatus(); status change",E),a(E.current),f(E.error)});return()=>{h.debug("useRoomStatus(); unsubscribing internal listener"),b()}},h).unmount(),[e,h]),z.useEffect(()=>wn(e.room,y=>{let b;return v&&(h.debug("useRoomStatus(); subscribing to status changes"),b=y.onStatusChange(v).off),h.debug("useRoomStatus(); setting initial status",{status:y.status}),v&&(h.debug("useRoomStatus(); sending initial status event"),v({current:y.status,previous:bs.Initializing,error:y.error})),()=>{h.debug("useRoomStatus(); unmounting"),b&&(h.debug("useRoomStatus(); unsubscribing from status changes"),b())}},h).unmount(),[e,h,v]),{status:r,error:l}},C_=n=>{const{currentStatus:e,error:r}=Zu({onStatusChange:n?.onConnectionStatusChange}),a=Aa("useMessages"),{status:l,error:f}=ed(n),h=Uc();h.trace("useMessages();",{params:n});const v=Wr(n?.listener),y=Wr(n?.reactionsListener),b=Wr(n?.rawReactionsListener),E=Wr(n?.onDiscontinuity),O=z.useCallback(L=>a.room.then(q=>q.messages.send(L)),[a]),j=z.useCallback(L=>a.room.then(q=>q.messages.get(L)),[a]),I=z.useCallback((L,q)=>a.room.then(H=>H.messages.delete(L,q)),[a]),A=z.useCallback(L=>a.room.then(q=>q.messages.history(L)),[a]),R=z.useCallback((L,q,H)=>a.room.then(ae=>ae.messages.update(L,q,H)),[a]),D=z.useCallback((L,q)=>a.room.then(H=>H.messages.reactions.send(L,q)),[a]),V=z.useCallback((L,q)=>a.room.then(H=>H.messages.reactions.delete(L,q)),[a]),[Y,ne]=z.useState();return z.useEffect(()=>{if(v)return wn(a.room,L=>{let q=!1;h.debug("useMessages(); applying listener");const H=L.messages.subscribe(v);return ne(()=>{if(h.debug("useMessages(); setting historyBeforeSubscribe state",{status:L.status,unmounted:q}),!q)return ae=>(h.debug("useMessages(); historyBeforeSubscribe called"),q?Promise.reject(new Ke.ErrorInfo("component unmounted",4e4,400)):H.historyBeforeSubscribe(ae))}),()=>{h.debug("useMessages(); removing listener and historyBeforeSubscribe state"),q=!0,H.unsubscribe(),ne(void 0)}},h).unmount()},[a,h,v]),z.useEffect(()=>{if(E)return wn(a.room,L=>{h.debug("useMessages(); applying onDiscontinuity listener");const{off:q}=L.onDiscontinuity(E);return()=>{h.debug("useMessages(); removing onDiscontinuity listener"),q()}},h).unmount()},[a,h,E]),z.useEffect(()=>{if(y)return wn(a.room,L=>{h.debug("useMessages(); applying reactions listener");const{unsubscribe:q}=L.messages.reactions.subscribe(y);return()=>{h.debug("useMessages(); removing reactions listener"),q()}},h).unmount()},[a,h,y]),z.useEffect(()=>{if(b)return wn(a.room,L=>{h.debug("useMessages(); applying raw reactions listener");const{unsubscribe:q}=L.messages.reactions.subscribeRaw(b);return()=>{h.debug("useMessages(); removing raw reactions listener"),q()}},h).unmount()},[a,h,b]),{connectionStatus:e,connectionError:r,roomStatus:l,roomError:f,sendMessage:O,getMessage:j,updateMessage:R,history:A,deleteMessage:I,sendReaction:D,deleteReaction:V,historyBeforeSubscribe:Y}},E_=new Set([Zh.Suspended,Zh.Failed]),R1=n=>{const{currentStatus:e,error:r}=Zu({onStatusChange:n?.onConnectionStatusChange}),a=Aa("usePresence"),{status:l,error:f}=ed(n),h=Uc();h.trace("usePresence();",{params:n});const v=z.useMemo(()=>n?.autoEnterLeave!==!1,[n?.autoEnterLeave]),[y,b]=z.useState({present:!1,error:void 0}),E=z.useRef({roomStatus:l,connectionStatus:e}),O=Wr(n?.onDiscontinuity),j=z.useRef(n?.initialData),I=z.useRef(!1),A=z.useRef(!1),R=z.useRef(!1);z.useEffect(()=>{A.current=!1,R.current=!1},[a]),z.useEffect(()=>{E.current={roomStatus:l,connectionStatus:e},l===bs.Detached&&(R.current=!0)},[l,e]),z.useEffect(()=>(h.debug("usePresence(); subscribing to presence state changes"),wn(a.room,ne=>{const L=ne.presence.onPresenceStateChange(q=>{h.debug("usePresence(); presence state changed",{stateChange:q}),b({...q.current,error:q.error})});return()=>{h.debug("usePresence(); unsubscribing from presence state changes"),L.unsubscribe()}},h).unmount()),[a,h]),z.useEffect(()=>(h.debug("usePresence(); running auto-enter hook"),v?wn(a.room,ne=>{const L=ne.status===bs.Attached&&!E_.has(e),q=!A.current||R.current;return!L||I.current||!q?(h.debug("usePresence(); skipping enter room",{roomStatus:l,connectionStatus:e,hasExplicitlyLeft:I.current,shouldAutoEnter:q,hasAutoEntered:A.current,roomWasDetached:R.current}),()=>{}):(h.debug("usePresence(); entering room"),ne.presence.enter(j.current).then(()=>{h.debug("usePresence(); entered room"),A.current=!0,R.current=!1}).catch(H=>{h.error("usePresence(); error entering room",{error:H})}),()=>{const H=ne.status===bs.Attached&&!E_.has(E.current.connectionStatus);h.debug("usePresence(); unmounting",{canLeavePresence:H,roomStatus:l,connectionStatus:e}),H&&!I.current&&ne.presence.leave().then(()=>{h.debug("usePresence(); left room")}).catch(ae=>{h.error("usePresence(); error leaving room",{error:ae})})})},h).unmount():(h.debug("usePresence(); auto enter/leave disabled"),()=>{})),[a,e,l,h,v]),z.useEffect(()=>{if(O)return wn(a.room,ne=>{const{off:L}=ne.onDiscontinuity(O);return()=>{h.debug("usePresence(); removing onDiscontinuity listener"),L()}},h).unmount()},[a,O,h]);const D=z.useCallback(async ne=>{j.current=ne,I.current=!1,await(await a.room).presence.update(ne)},[a]),V=z.useCallback(async ne=>{j.current=ne,I.current=!1,await(await a.room).presence.enter(ne)},[a]),Y=z.useCallback(async ne=>{I.current=!0,await(await a.room).presence.leave(ne)},[a]);return{connectionStatus:e,connectionError:r,roomStatus:l,roomError:f,update:D,enter:V,leave:Y,myPresenceState:y}},A1=1500,P1=3e4,I1=5,x1=n=>{const{currentStatus:e,error:r}=Zu({onStatusChange:n?.onConnectionStatusChange}),a=Aa("usePresenceListener"),{status:l,error:f}=ed(n),h=Uc();h.trace("usePresenceListener();");const v=z.useRef(0),y=z.useRef(0),b=z.useRef(void 0),E=z.useRef(0),O=z.useRef([]),[j,I]=z.useState([]),A=z.useRef(void 0),[R,D]=z.useState(),V=Wr(n?.listener),Y=Wr(n?.onDiscontinuity),ne=z.useCallback(q=>{h.debug("usePresenceListener(); setting error state",{error:q}),A.current=q,D(q)},[h]),L=z.useCallback(()=>{h.debug("usePresenceListener(); clearing error state"),A.current=void 0,D(void 0)},[h]);return z.useEffect(()=>{const q=()=>{v.current+=1,b.current&&(clearTimeout(b.current),b.current=void 0,E.current=0),H(v.current)},H=ae=>{wn(a.room,ye=>(ye.presence.get({waitForSync:!0}).then(Ee=>{h.debug("usePresenceListener(); fetched presence data",{presenceMembers:Ee}),b.current&&(clearTimeout(b.current),b.current=void 0,E.current=0),!(y.current>=ae)&&(y.current=ae,O.current=Ee,I(Ee),A.current&&L())}).catch(()=>{if(!(E.current<I1)){h.error("usePresenceListener(); failed to fetch presence data after max retries"),ne(new Ke.ErrorInfo("failed to fetch presence data after max retries",5e4,500));return}if(b.current){h.debug("usePresenceListener(); waiting for retry but new event received");return}const Ee=Math.min(P1,A1*Math.pow(2,E.current));E.current+=1,h.debug("usePresenceListener(); retrying to fetch presence data",{numRetries:E.current}),b.current=setTimeout(()=>{b.current=void 0,v.current+=1,H(v.current)},Ee)}),()=>{}),h)};return wn(a.room,ae=>{let ye;return ae.status===bs.Attached?ae.presence.get({waitForSync:!0}).then(Ee=>{h.debug("usePresenceListener(); fetched initial presence data",{presenceMembers:Ee}),O.current=Ee,I(Ee),L()}).catch(Ee=>{const Ve=Ee;k1(Ve,ep.RoomIsReleased)||(h.error("usePresenceListener(); error fetching initial presence data",{error:Ee}),ne(Ve))}).finally(()=>{h.debug("usePresenceListener(); subscribing internal listener to presence events"),ye=ae.presence.subscribe(()=>{q()}).unsubscribe}):(h.debug("usePresenceListener(); not yet attached, subscribing internal listener to presence events"),ye=ae.presence.subscribe(()=>{q()}).unsubscribe),()=>{ye&&(h.debug("usePresenceListener(); cleaning up internal listener"),ye())}},h).unmount()},[a,ne,L,h]),z.useEffect(()=>{if(V)return wn(a.room,q=>{h.debug("usePresenceListener(); applying external listener");const{unsubscribe:H}=q.presence.subscribe(V);return()=>{h.debug("usePresenceListener(); cleaning up external listener"),H()}},h).unmount()},[a,V,h]),z.useEffect(()=>{if(Y)return wn(a.room,q=>{h.debug("usePresenceListener(); applying onDiscontinuity listener");const{off:H}=q.onDiscontinuity(Y);return()=>{h.debug("usePresenceListener(); removing onDiscontinuity listener"),H()}},h).unmount()},[a,Y,h]),{connectionStatus:e,connectionError:r,roomStatus:l,roomError:f,error:R,presenceData:j}},M_=n=>{const{currentStatus:e,error:r}=Zu({onStatusChange:n?.onConnectionStatusChange}),a=Aa("useTyping"),{status:l,error:f}=ed(n),h=Uc();h.trace("useTyping();");const[v,y]=z.useState(new Set),b=Wr(n?.listener),E=Wr(n?.onDiscontinuity);z.useEffect(()=>(y(I=>I.size===0?I:new Set),wn(a.room,I=>{h.debug("useTyping(); subscribing to typing events");const{unsubscribe:A}=I.typing.subscribe(R=>{y(R.currentlyTyping)});if(I.status===bs.Attached){const R=I.typing.current();h.debug("useTyping(); room attached, getting initial typers",{typing:R}),y(R)}return()=>{h.debug("useTyping(); unsubscribing from typing events"),A()}},h).unmount()),[a,h]),z.useEffect(()=>{if(E)return wn(a.room,I=>{h.debug("useTyping(); applying onDiscontinuity listener");const{off:A}=I.onDiscontinuity(E);return()=>{h.debug("useTyping(); removing onDiscontinuity listener"),A()}},h).unmount()},[a,E,h]),z.useEffect(()=>{if(b)return wn(a.room,I=>{h.debug("useTyping(); applying listener");const{unsubscribe:A}=I.typing.subscribe(b);return()=>{h.debug("useTyping(); removing listener"),A()}},h).unmount()},[a,b,h]);const O=z.useCallback(()=>a.room.then(I=>I.typing.keystroke()),[a]),j=z.useCallback(()=>a.room.then(I=>I.typing.stop()),[a]);return{connectionStatus:e,connectionError:r,roomStatus:l,roomError:f,keystroke:O,stop:j,currentlyTyping:v}},L1=({name:n,options:e,children:r})=>{const a=Xu(),l=k_(),f=z.useMemo(()=>l.withContext({roomName:n}),[l,n]),h=M1();f.debug("ChatRoomProvider();",{options:e});const[v,y]=z.useState(()=>{f.debug("ChatRoomProvider(); initializing value",{options:e});const b=a.rooms.get(n,e);return b.catch(()=>{}),{room:b,roomName:n,options:e,client:a}});return z.useEffect(()=>{f.debug("ChatRoomProvider(); running lifecycle useEffect");let b=!1;const E=h.addReference(n,e);return y(O=>O.client===a&&O.roomName===n&&O.options===e?(f.debug("ChatRoomProvider(); no change in room id or options",{options:e}),O):(f.debug("ChatRoomProvider(); updating value",{options:e}),{room:E,roomName:n,options:e,client:a})),E.then(()=>{if(b){f.debug("ChatRoomProvider(); unmounted before room resolved");return}f.debug("ChatRoomProvider(); room resolved")}).catch(()=>{}),()=>{b=!0,f.debug("ChatRoomProvider(); cleaning up lifecycle useEffect"),h.removeReference(n,e)}},[n,e,f,a,h]),_e.jsx(m_.Provider,{value:v,children:r})},td={DOMAIN:"demoservice.app",get API_BASE(){return"https://demoservice.app"}};function j1(){R1();const n=x1();return z.useEffect(()=>{if(n&&typeof n.enterPresence=="function")return n.enterPresence(),()=>{n&&typeof n.leavePresence=="function"&&n.leavePresence()}},[n]),null}function O_({userName:n,userImage:e}){const[r,a]=z.useState(!1),[l,f]=z.useState(!1);z.useEffect(()=>{e&&(a(!1),f(!1))},[e]);const h=e&&e.trim()&&!r;return _e.jsx("div",{style:{width:"32px",height:"32px",borderRadius:"50%",overflow:"hidden",flexShrink:0,boxShadow:"0 2px 4px rgba(0,0,0,0.1)",backgroundColor:"hsl(var(--muted))",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:h?_e.jsxs(_e.Fragment,{children:[!l&&_e.jsx("div",{style:{position:"absolute",width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:600,color:"hsl(var(--muted-foreground))",backgroundColor:"hsl(var(--muted))"},children:n.charAt(0).toUpperCase()}),_e.jsx("img",{src:e,alt:n,onLoad:()=>f(!0),onError:()=>{a(!0),f(!1)},style:{width:"100%",height:"100%",objectFit:"cover",display:l?"block":"none"}})]}):_e.jsx("div",{style:{width:"100%",height:"100%",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:600,color:"hsl(var(--muted-foreground))",backgroundColor:"hsl(var(--muted))"},children:n.charAt(0).toUpperCase()})})}const pi={container:n=>({flex:1,overflowY:"auto",padding:"12px",paddingTop:n>0?`${12+n}px`:"12px",display:"flex",flexDirection:"column",gap:"8px",minHeight:0}),systemMessageWrapper:{display:"flex",alignItems:"center",gap:"8px",padding:"8px 0",width:"100%"},systemMessageText:{backgroundColor:"transparent",color:"hsl(var(--foreground))",padding:"8px 12px",borderRadius:"16px",fontSize:"13px",fontWeight:500,flex:1},messageWrapper:n=>({display:"flex",flexDirection:"column",alignItems:n?"flex-end":"flex-start"}),messageBubble:{backgroundColor:"hsl(var(--background))",color:"hsl(var(--foreground))",padding:"6px 12px",borderRadius:"16px",maxWidth:"80%",wordWrap:"break-word",border:"1px solid hsl(var(--border) / 0.3)",fontSize:"13px"},typingContainer:{display:"flex",alignItems:"center",gap:"8px",padding:"4px 0"},typingBubble:{backgroundColor:"hsl(var(--muted) / 0.8)",color:"hsl(var(--foreground))",padding:"6px 16px",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",border:"1px solid hsl(var(--border) / 0.2)",minHeight:"32px",minWidth:"68px"},typingDot:n=>({width:"6px",height:"6px",borderRadius:"50%",backgroundColor:"hsl(var(--foreground) / 0.6)",opacity:.5,animation:"typingDots 1.2s ease-in-out infinite",animationDelay:`${n}s`}),completionWrapper:{display:"flex",flexDirection:"column",alignItems:"center",marginTop:"8px"},completionText:{textAlign:"center",color:"hsl(var(--foreground))",fontSize:"13px",padding:"8px 0",fontWeight:500}},N1=`
@keyframes typingDots {
  0%, 80%, 100% { transform: translateY(0); opacity: 0.4; }
  40% { transform: translateY(-2px); opacity: 1; }
}
`;function D1({userName:n,userImage:e}){return _e.jsxs("div",{style:pi.typingContainer,children:[_e.jsx(O_,{userName:n,userImage:e}),_e.jsx("div",{style:pi.typingBubble,children:[0,.15,.3].map(r=>_e.jsx("div",{style:pi.typingDot(r)},r))}),_e.jsx("style",{children:N1})]})}function U1({currentFields:n,headerHeight:e=0,visitorClientId:r}){const[a,l]=z.useState([]),[f,h]=z.useState(null),v=z.useRef(null),y=!!n.sessionEndedAt,b=z.useCallback(A=>{const R=A?.metadata;R?.userName&&h(D=>D?D.userName!==R.userName||(R.userImage??null)!==D.userImage?{userName:R.userName,userImage:R.userImage??null}:D:{userName:R.userName,userImage:R.userImage??null})},[]),{currentlyTyping:E}=M_(),O=E?Array.from(E).filter(A=>!(!A||A===r||A.startsWith("system-"))):[],j=C_({listener:A=>{const R=A.message;b(R),l(D=>[...D,R])}}),I=()=>{v.current?.scrollIntoView({behavior:"smooth"})};return z.useEffect(()=>{j.roomStatus==="attached"&&j.history({direction:"backwards",limit:50}).then(A=>{if(A&&A.items){const R=A.items.reverse();R.forEach(b),l(R)}}).catch(A=>{console.error("Error getting message history:",A)})},[j.roomStatus,b]),z.useEffect(()=>{I()},[a,O.length]),_e.jsxs("div",{style:pi.container(e),children:[a&&a.length>0&&a.map(A=>{if(A.metadata?.type==="system"||A.metadata?.eventType==="user_joined"){const V=A.metadata?.userName||"Someone",Y=A.metadata?.userImage;return _e.jsxs("div",{style:pi.systemMessageWrapper,children:[_e.jsx(O_,{userName:V,userImage:Y}),_e.jsx("div",{style:pi.systemMessageText,children:A.text||`${V} joined the chat`})]},A.id)}const D=A.clientId?.startsWith("embed-");return _e.jsx("div",{style:pi.messageWrapper(D),children:_e.jsx("div",{style:pi.messageBubble,children:A.text||A.data})},A.id)}),O.length>0&&!y&&_e.jsx(D1,{userName:f?.userName||"Agent",userImage:f?.userImage||null}),y&&_e.jsx("div",{style:pi.completionWrapper,children:_e.jsx("div",{style:pi.completionText,children:"Visit ended"})}),_e.jsx("div",{ref:v})]})}const nd={wrapper:{padding:"4px 12px 12px",display:"flex",flexDirection:"column",gap:"8px",backgroundColor:"transparent",flexShrink:0},inputRow:{display:"flex",gap:"8px",alignItems:"center"},textarea:n=>({flex:1,padding:"6px 12px",border:"1px solid hsl(var(--border) / 0.3)",borderRadius:"16px",resize:"none",fontSize:"13px",fontFamily:"inherit",outline:"none",backgroundColor:n?"hsl(var(--muted))":"hsl(var(--background))",color:n?"hsl(var(--muted-foreground))":"hsl(var(--foreground))",cursor:n?"not-allowed":"text"}),sendButton:n=>({padding:"6px 12px",backgroundColor:n?"hsl(var(--muted))":"hsl(var(--foreground))",color:"hsl(var(--background))",border:"1px solid hsl(var(--border) / 0.3)",borderRadius:"16px",cursor:n?"not-allowed":"pointer",fontSize:"13px",fontWeight:"500",display:"flex",alignItems:"center",justifyContent:"center"})},xo={container:{padding:"4px 0px 0",backgroundColor:"transparent",display:"flex",justifyContent:"space-between",alignItems:"center",gap:"12px",flexShrink:0},ghostButton:{display:"flex",alignItems:"center",gap:"4px",padding:"6px 10px",borderRadius:"16px",background:"transparent",color:"hsl(var(--foreground))",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.15s ease",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',whiteSpace:"nowrap",minHeight:"32px"},primaryButton:{display:"flex",alignItems:"center",gap:"8px",padding:"6px 12px",borderRadius:"16px",background:"hsl(var(--constructive))",color:"hsl(var(--constructive-foreground))",border:"none",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.15s ease",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',whiteSpace:"nowrap",minHeight:"32px"},spinner:{width:"10px",height:"10px",border:"2px solid hsl(var(--constructive-foreground) / 0.4)",borderTop:"2px solid hsl(var(--constructive-foreground))",borderRadius:"50%",animation:"spin 1s linear infinite"}},B1=`
@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}
`;function F1({currentFields:n,onCallClick:e,onCancelClick:r,onCloseClick:a}){const l=!!n.sessionEndedAt,f=!!n.dailyRoomId&&!l,h=!!n.joined;return l||f?null:h&&!f?_e.jsxs(_e.Fragment,{children:[_e.jsxs("div",{style:xo.container,children:[_e.jsxs("button",{onClick:a,style:xo.ghostButton,children:[_e.jsx(Qy,{size:13}),_e.jsx("span",{children:"End chat"})]}),_e.jsxs("button",{onClick:r,style:xo.primaryButton,children:[_e.jsx("div",{style:xo.spinner}),_e.jsx("span",{children:"Calling"})]})]}),_e.jsx("style",{children:B1})]}):_e.jsxs("div",{style:xo.container,children:[_e.jsxs("button",{onClick:a,style:xo.ghostButton,children:[_e.jsx(Qy,{size:13}),_e.jsx("span",{children:"End chat"})]}),_e.jsxs("button",{onClick:e,style:xo.primaryButton,children:[_e.jsx(Ky,{size:13}),_e.jsx("span",{children:"Start a call"})]})]})}function V1({currentFields:n,onCallClick:e,onCancelClick:r,onCloseClick:a}){const[l,f]=z.useState(""),h=C_(),{keystroke:v,stop:y}=M_(),b=!!n.sessionEndedAt,E=z.useCallback(async()=>{if(l.trim()&&!b)try{const A=await h.sendMessage({text:l.trim()});f("");try{await y()}catch(R){console.error("Error stopping typing indicator:",R)}}catch(A){console.error("Error sending message:",A)}},[l,h,b,y]),O=A=>{A.key==="Enter"&&!A.shiftKey&&(A.preventDefault(),E())},j=A=>{f(A.target.value),b||v().catch(R=>{console.error("Error sending typing indicator:",R)})},I=()=>{b||y().catch(A=>{console.error("Error stopping typing indicator on blur:",A)})};return z.useEffect(()=>{b&&y().catch(()=>{})},[b,y]),z.useEffect(()=>()=>{y().catch(()=>{})},[y]),_e.jsxs("div",{style:nd.wrapper,children:[_e.jsx(F1,{currentFields:n,onCallClick:e,onCancelClick:r,onCloseClick:a}),_e.jsxs("div",{style:nd.inputRow,children:[_e.jsx("textarea",{value:l,onChange:j,onKeyPress:O,onBlur:I,placeholder:"Send a message...",disabled:b,style:nd.textarea(b),rows:1}),_e.jsx("button",{onClick:E,disabled:b,style:nd.sendButton(b),children:_e.jsx(kC,{size:13})})]})]})}const rd={root:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden",position:"relative"},overlay:{position:"absolute",top:0,left:0,right:0,display:"flex",alignItems:"center",justifyContent:"center",gap:"14px",padding:"12px 16px",background:"hsl(var(--background))",borderBottom:"1px solid hsl(var(--border) / 0.3)",zIndex:20},overlayButton:n=>({display:"flex",alignItems:"center",gap:"10px",padding:"12px 18px",borderRadius:"20px",background:n?"hsl(var(--constructive))":"hsl(var(--background))",color:n?"hsl(var(--constructive-foreground))":"hsl(var(--foreground))",border:n?"1px solid hsl(var(--foreground) / 0.06)":"1px solid hsl(var(--border) / 0.6)",cursor:"pointer",fontSize:"15px",fontWeight:700,boxShadow:n?"0 2px 8px hsl(var(--foreground) / 0.15)":void 0})};function z1({currentFields:n,onCallClick:e,onCancelClick:r,onCloseClick:a,visitorData:l}){const f=!!n.dailyRoomId&&!n.sessionEndedAt,h=!!n.joined,[v,y]=z.useState(window.__embedDeclined||!1),b=l?`embed-${l.visitorId}`:void 0;return _e.jsxs("div",{style:rd.root,children:[f&&!h&&!v&&_e.jsxs("div",{style:rd.overlay,children:[_e.jsx("button",{onClick:e,style:rd.overlayButton(!0),onMouseEnter:E=>{E.currentTarget.style.transform="scale(1.02)"},onMouseLeave:E=>{E.currentTarget.style.transform="scale(1)"},children:_e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[_e.jsx(SC,{className:"w-4 h-4"}),"Accept"]})}),_e.jsx("button",{onClick:()=>{window.__embedDeclined=!0,window.dispatchEvent(new CustomEvent("embed-declined")),y(!0)},style:rd.overlayButton(!1),onMouseEnter:E=>{E.currentTarget.style.transform="scale(1.02)"},onMouseLeave:E=>{E.currentTarget.style.transform="scale(1)"},children:_e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[_e.jsx(bC,{className:"w-4 h-4"}),"Decline"]})})]}),_e.jsx(j1,{}),_e.jsx(U1,{currentFields:n,headerHeight:f&&!h&&!v?56:0,visitorClientId:b}),_e.jsx(V1,{currentFields:n,onCallClick:e,onCancelClick:r,onCloseClick:a})]})}function $1({chatRoomId:n,visitorData:e,currentFields:r,onCallClick:a,onCancelClick:l,onCloseClick:f}){const[h,v]=z.useState(null);return z.useEffect(()=>{if(!n||!e)return;const y=new Ke.Realtime({authCallback:async(E,O)=>{try{console.log("Requesting Ably token for visitor:",e.visitorId);const j=await fetch(`${td.API_BASE}/api/ably/token`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitorId:e.visitorId,sessionId:e.sessionId,companyId:e.companyId})});if(!j.ok)throw new Error("Failed to get token");const I=await j.json();console.log("Received Ably token request:",!!I),O(null,I)}catch(j){console.error("Token auth error:",j),O(String(j),null)}},clientId:`embed-${e.visitorId}`}),b=new _1(y,{logLevel:Wh.Info});return v({realtimeClient:y,chatClient:b}),()=>{y.connection.close()}},[n,e]),!n||!e||!h?_e.jsx("div",{style:{width:"100%",height:"250px",backgroundColor:"hsl(var(--background) / 0.7)",border:"1px solid hsl(var(--border))",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08)",display:"flex",flexDirection:"column",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:_e.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",textAlign:"center",color:"hsl(var(--muted-foreground))"},children:_e.jsx("div",{children:_e.jsx("p",{style:{margin:0,fontSize:"14px"},children:!n||!e?"Initializing...":"Connecting to chat..."})})})}):_e.jsx("div",{style:{width:"100%",height:"250px",backgroundColor:"hsl(var(--background) / 0.7)",border:"1px solid hsl(var(--border) / 0.3)",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08)",display:"flex",flexDirection:"column",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',overflow:"hidden",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:_e.jsx(b1,{client:h.realtimeClient,children:_e.jsx(O1,{client:h.chatClient,children:_e.jsx(L1,{name:n,children:_e.jsx(z1,{currentFields:r,onCallClick:a,onCancelClick:l,onCloseClick:f,visitorData:e})})})})})}function q1(){const[n,e]=z.useState(null),[r,a]=z.useState({active:!1,joined:!1,dailyRoomId:null,chatRoomId:null,sessionEndedAt:null}),[l,f]=z.useState(!1),[h,v]=z.useState(null),y=z.useCallback(()=>{const j=document.getElementsByTagName("script");for(let I=0;I<j.length;I++){const A=j[I];if(A.src&&A.src.includes("embed.js")){const D=new URL(A.src).searchParams.get("token");if(D)return D}if(A.dataset.token)return A.dataset.token}return null},[]),b=z.useCallback(async j=>{let I=localStorage.getItem("service_visitor_id");I||(I=mf(),localStorage.setItem("service_visitor_id",I));let A=localStorage.getItem("current_session_id");A||(A=mf(),localStorage.setItem("current_session_id",A));const R=`chat-${I}-${A}`;try{const D=await fetch(`${td.API_BASE}/api/visitors/initialize`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitorId:I,sessionId:A,token:j,chatRoomId:R})});if(!D.ok)throw new Error(`HTTP ${D.status}: ${D.statusText}`);const V=await D.json();return V.success?(e({visitorId:I,sessionId:A,companyId:V.companyId,token:j}),f(!0),{visitorId:I,sessionId:A,companyId:V.companyId,token:j,visitData:V}):null}catch(D){return console.error("Error initializing visitor with token:",D),null}},[]),E=z.useCallback(async j=>{if(!n)return;const I=JSON.stringify({visitorId:n.visitorId,sessionId:n.sessionId,companyId:n.companyId,...j});try{const A=await fetch(`${td.API_BASE}/api/visitors/status`,{method:"POST",headers:{"Content-Type":"application/json"},body:I});if(!A.ok)throw new Error(`HTTP error! status: ${A.status}`);await A.json()}catch(A){console.error("Error updating visit status:",A)}},[n]),O=z.useCallback(j=>{const I=j||n;if(!I||h)return;const A=`${td.API_BASE}/api/visitors/events?visitorId=${encodeURIComponent(I.visitorId)}`,R=new EventSource(A);R.onmessage=function(D){try{const V=JSON.parse(D.data);V.type==="visit_update"&&a(Y=>{const ne={active:"active"in V?!!V.active:Y.active,joined:"joined"in V?!!V.joined:Y.joined,dailyRoomId:"dailyRoomId"in V?V.dailyRoomId||null:Y.dailyRoomId,chatRoomId:"chatRoomId"in V?V.chatRoomId||null:Y.chatRoomId,sessionEndedAt:"sessionEndedAt"in V?V.sessionEndedAt||null:Y.sessionEndedAt};return ne.sessionEndedAt,ne})}catch(V){console.error("EventSource message error:",V)}},R.onerror=function(){setTimeout(()=>{R.readyState===EventSource.CLOSED&&(v(null),O())},3e3)},v(R)},[n,h]);return z.useEffect(()=>{const j=y();if(!j||l)return;(async()=>{try{const A=await b(j);if(A){const R=A.visitData;if(R){const D=R.chatRoomId||`chat-${A.visitorId}-${A.sessionId}`;a({active:!!R.active,joined:!!R.joined,dailyRoomId:R.dailyRoomId||null,chatRoomId:D,sessionEndedAt:R.sessionEndedAt||null})}else{const D=`chat-${A.visitorId}-${A.sessionId}`;a({active:!0,joined:!1,dailyRoomId:null,chatRoomId:D,sessionEndedAt:null})}O(A)}}catch{}})()},[y,b,O,l]),z.useEffect(()=>()=>{h&&h.close()},[h]),{visitorData:n,currentFields:r,isInitialized:l,updateVisitFields:E}}function W1({visitorData:n,currentFields:e,updateVisitFields:r}){z.useEffect(()=>{const a=()=>{const h=!!e.dailyRoomId;if(h)return;const v=!h&&e.joined;document.hidden&&e.active&&!v?r({active:!1}):!document.hidden&&!e.active&&!e.joined&&r({active:!0})},l=()=>{n&&r({endedAt:new Date().toISOString(),active:!1})},f=()=>{n&&r({endedAt:new Date().toISOString(),active:!1})};return document.addEventListener("visibilitychange",a),window.addEventListener("pagehide",l),window.addEventListener("beforeunload",f),()=>{document.removeEventListener("visibilitychange",a),window.removeEventListener("pagehide",l),window.removeEventListener("beforeunload",f)}},[n,e,r])}function T_(){const{visitorData:n,currentFields:e,isInitialized:r,updateVisitFields:a}=q1();W1({visitorData:n,currentFields:e,updateVisitFields:a});const l=()=>{const b=!!e.dailyRoomId;console.log("Call button clicked - inCall:",b,"joined:",e.joined),e.joined||(console.log("Setting joined to true"),a({joined:!0}))},f=()=>{!!!e.dailyRoomId&&e.joined&&a({joined:!1})},h=()=>{e.dailyRoomId&&!e.joined&&a({joined:!0})},v=()=>{if(!n)return;a({endedAt:new Date().toISOString(),active:!1});const b=document.querySelector('[id^="embed-widget-"]');b&&(b.style.display="none")};if(!r||!n)return null;const y=!e.sessionEndedAt;return _e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:"8px",width:"100%",position:"relative"},children:[y&&_e.jsx("button",{onClick:v,style:{position:"absolute",top:"-12px",right:"-12px",zIndex:1e3,padding:"6px 8px",borderRadius:"50%",background:"hsl(var(--background))",color:"hsl(var(--foreground))",border:"1px solid hsl(var(--border) / 0.3)",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.2s ease",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:"0 2px 8px rgba(0, 0, 0, 0.15)"},onMouseEnter:b=>{b.currentTarget.style.transform="scale(1.05)"},onMouseLeave:b=>{b.currentTarget.style.transform="scale(1)"},children:""}),_e.jsxs(cC,{children:[_e.jsx(EC,{currentFields:e,visitorData:n,onJoined:h}),_e.jsx($1,{chatRoomId:e.chatRoomId,visitorData:n,currentFields:e,onCallClick:l,onCancelClick:f,onCloseClick:v})]})]})}const R_=document.currentScript?.getAttribute("data-theme")||"light",np=mf(),A_=`embed-widget-${np}`,Bc=`embed-widget-${np}`,P_=document.createElement("style");P_.textContent=`
  /* Embed widget CSS variables - theme: ${R_} - ID: ${np} */
  .${Bc} {
    ${R_==="dark"?`
    /* Dark theme colors for embed */
    --background: 202 7% 3%;
    --foreground: 202 7% 93%;
    --muted: 202 7% 12%;
    --muted-foreground: 202 7% 83%;
    --primary: 202 7% 17%;
    --primary-foreground: 202 7% 93%;
    --destructive: 4 75% 25%;
    --destructive-foreground: 202 7% 93%;
    --border: 202 7% 50%;
    --ring: 202 7% 93%;
    `:`
    /* Light theme colors for embed */
    --background: 202 7% 93%;
    --foreground: 202 7% 7%;
    --muted: 202 7% 88%;
    --muted-foreground: 202 7% 17%;
    --primary: 202 7% 83%;
    --primary-foreground: 202 7% 7%;
    --destructive: 4 75% 25%;
    --destructive-foreground: 202 7% 7%;
    --border: 202 7% 50%;
    --ring: 202 7% 7%;
    `}
    --radius: 0.5rem;
  }

  /* Spinner animation with unique name */
  @keyframes ${Bc}-spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }

  /* Completely isolated styles for embed */
  .${Bc} {
    position: fixed;
    bottom: 20px;
    right: 20px;
    width: 300px;
    z-index: 10000;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }

  .${Bc} * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }
`,document.head.appendChild(P_);let Pa=document.getElementById(A_);Pa||(Pa=document.createElement("div"),Pa.id=A_,Pa.className=Bc,document.body.appendChild(Pa)),cw.createRoot(Pa).render(_e.jsx(et.StrictMode,{children:_e.jsx(T_,{})})),window.EmbedWidget=T_})();
