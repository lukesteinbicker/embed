(function(){"use strict";var cs=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gg(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var nf={exports:{}},pc={},rf={exports:{}},nt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mg;function z0(){if(mg)return nt;mg=1;var n=Symbol.for("react.element"),e=Symbol.for("react.portal"),r=Symbol.for("react.fragment"),a=Symbol.for("react.strict_mode"),l=Symbol.for("react.profiler"),f=Symbol.for("react.provider"),h=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),y=Symbol.for("react.suspense"),k=Symbol.for("react.memo"),E=Symbol.for("react.lazy"),O=Symbol.iterator;function D(J){return J===null||typeof J!="object"?null:(J=O&&J[O]||J["@@iterator"],typeof J=="function"?J:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},L=Object.assign,R={};function N(J,le,g){this.props=J,this.context=le,this.refs=R,this.updater=g||x}N.prototype.isReactComponent={},N.prototype.setState=function(J,le){if(typeof J!="object"&&typeof J!="function"&&J!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,J,le,"setState")},N.prototype.forceUpdate=function(J){this.updater.enqueueForceUpdate(this,J,"forceUpdate")};function q(){}q.prototype=N.prototype;function Q(J,le,g){this.props=J,this.context=le,this.refs=R,this.updater=g||x}var ee=Q.prototype=new q;ee.constructor=Q,L(ee,N.prototype),ee.isPureReactComponent=!0;var P=Array.isArray,$=Object.prototype.hasOwnProperty,G={current:null},ae={key:!0,ref:!0,__self:!0,__source:!0};function ye(J,le,g){var M,C={},j=null,F=null;if(le!=null)for(M in le.ref!==void 0&&(F=le.ref),le.key!==void 0&&(j=""+le.key),le)$.call(le,M)&&!ae.hasOwnProperty(M)&&(C[M]=le[M]);var H=arguments.length-2;if(H===1)C.children=g;else if(1<H){for(var ie=Array(H),fe=0;fe<H;fe++)ie[fe]=arguments[fe+2];C.children=ie}if(J&&J.defaultProps)for(M in H=J.defaultProps,H)C[M]===void 0&&(C[M]=H[M]);return{$$typeof:n,type:J,key:j,ref:F,props:C,_owner:G.current}}function Ce(J,le){return{$$typeof:n,type:J.type,key:le,ref:J.ref,props:J.props,_owner:J._owner}}function Ve(J){return typeof J=="object"&&J!==null&&J.$$typeof===n}function S(J){var le={"=":"=0",":":"=2"};return"$"+J.replace(/[=:]/g,function(g){return le[g]})}var ze=/\/+/g;function Ee(J,le){return typeof J=="object"&&J!==null&&J.key!=null?S(""+J.key):le.toString(36)}function Y(J,le,g,M,C){var j=typeof J;(j==="undefined"||j==="boolean")&&(J=null);var F=!1;if(J===null)F=!0;else switch(j){case"string":case"number":F=!0;break;case"object":switch(J.$$typeof){case n:case e:F=!0}}if(F)return F=J,C=C(F),J=M===""?"."+Ee(F,0):M,P(C)?(g="",J!=null&&(g=J.replace(ze,"$&/")+"/"),Y(C,le,g,"",function(fe){return fe})):C!=null&&(Ve(C)&&(C=Ce(C,g+(!C.key||F&&F.key===C.key?"":(""+C.key).replace(ze,"$&/")+"/")+J)),le.push(C)),1;if(F=0,M=M===""?".":M+":",P(J))for(var H=0;H<J.length;H++){j=J[H];var ie=M+Ee(j,H);F+=Y(j,le,g,ie,C)}else if(ie=D(J),typeof ie=="function")for(J=ie.call(J),H=0;!(j=J.next()).done;)j=j.value,ie=M+Ee(j,H++),F+=Y(j,le,g,ie,C);else if(j==="object")throw le=String(J),Error("Objects are not valid as a React child (found: "+(le==="[object Object]"?"object with keys {"+Object.keys(J).join(", ")+"}":le)+"). If you meant to render a collection of children, use an array instead.");return F}function De(J,le,g){if(J==null)return J;var M=[],C=0;return Y(J,M,"","",function(j){return le.call(g,j,C++)}),M}function it(J){if(J._status===-1){var le=J._result;le=le(),le.then(function(g){(J._status===0||J._status===-1)&&(J._status=1,J._result=g)},function(g){(J._status===0||J._status===-1)&&(J._status=2,J._result=g)}),J._status===-1&&(J._status=0,J._result=le)}if(J._status===1)return J._result.default;throw J._result}var we={current:null},he={transition:null},ke={ReactCurrentDispatcher:we,ReactCurrentBatchConfig:he,ReactCurrentOwner:G};function oe(){throw Error("act(...) is not supported in production builds of React.")}return nt.Children={map:De,forEach:function(J,le,g){De(J,function(){le.apply(this,arguments)},g)},count:function(J){var le=0;return De(J,function(){le++}),le},toArray:function(J){return De(J,function(le){return le})||[]},only:function(J){if(!Ve(J))throw Error("React.Children.only expected to receive a single React element child.");return J}},nt.Component=N,nt.Fragment=r,nt.Profiler=l,nt.PureComponent=Q,nt.StrictMode=a,nt.Suspense=y,nt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ke,nt.act=oe,nt.cloneElement=function(J,le,g){if(J==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+J+".");var M=L({},J.props),C=J.key,j=J.ref,F=J._owner;if(le!=null){if(le.ref!==void 0&&(j=le.ref,F=G.current),le.key!==void 0&&(C=""+le.key),J.type&&J.type.defaultProps)var H=J.type.defaultProps;for(ie in le)$.call(le,ie)&&!ae.hasOwnProperty(ie)&&(M[ie]=le[ie]===void 0&&H!==void 0?H[ie]:le[ie])}var ie=arguments.length-2;if(ie===1)M.children=g;else if(1<ie){H=Array(ie);for(var fe=0;fe<ie;fe++)H[fe]=arguments[fe+2];M.children=H}return{$$typeof:n,type:J.type,key:C,ref:j,props:M,_owner:F}},nt.createContext=function(J){return J={$$typeof:h,_currentValue:J,_currentValue2:J,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},J.Provider={$$typeof:f,_context:J},J.Consumer=J},nt.createElement=ye,nt.createFactory=function(J){var le=ye.bind(null,J);return le.type=J,le},nt.createRef=function(){return{current:null}},nt.forwardRef=function(J){return{$$typeof:v,render:J}},nt.isValidElement=Ve,nt.lazy=function(J){return{$$typeof:E,_payload:{_status:-1,_result:J},_init:it}},nt.memo=function(J,le){return{$$typeof:k,type:J,compare:le===void 0?null:le}},nt.startTransition=function(J){var le=he.transition;he.transition={};try{J()}finally{he.transition=le}},nt.unstable_act=oe,nt.useCallback=function(J,le){return we.current.useCallback(J,le)},nt.useContext=function(J){return we.current.useContext(J)},nt.useDebugValue=function(){},nt.useDeferredValue=function(J){return we.current.useDeferredValue(J)},nt.useEffect=function(J,le){return we.current.useEffect(J,le)},nt.useId=function(){return we.current.useId()},nt.useImperativeHandle=function(J,le,g){return we.current.useImperativeHandle(J,le,g)},nt.useInsertionEffect=function(J,le){return we.current.useInsertionEffect(J,le)},nt.useLayoutEffect=function(J,le){return we.current.useLayoutEffect(J,le)},nt.useMemo=function(J,le){return we.current.useMemo(J,le)},nt.useReducer=function(J,le,g){return we.current.useReducer(J,le,g)},nt.useRef=function(J){return we.current.useRef(J)},nt.useState=function(J){return we.current.useState(J)},nt.useSyncExternalStore=function(J,le,g){return we.current.useSyncExternalStore(J,le,g)},nt.useTransition=function(){return we.current.useTransition()},nt.version="18.3.1",nt}var vg;function sf(){return vg||(vg=1,rf.exports=z0()),rf.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yg;function q0(){if(yg)return pc;yg=1;var n=sf(),e=Symbol.for("react.element"),r=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,f={key:!0,ref:!0,__self:!0,__source:!0};function h(v,y,k){var E,O={},D=null,x=null;k!==void 0&&(D=""+k),y.key!==void 0&&(D=""+y.key),y.ref!==void 0&&(x=y.ref);for(E in y)a.call(y,E)&&!f.hasOwnProperty(E)&&(O[E]=y[E]);if(v&&v.defaultProps)for(E in y=v.defaultProps,y)O[E]===void 0&&(O[E]=y[E]);return{$$typeof:e,type:v,key:D,ref:x,props:O,_owner:l.current}}return pc.Fragment=r,pc.jsx=h,pc.jsxs=h,pc}var _g;function $0(){return _g||(_g=1,nf.exports=q0()),nf.exports}var Ue=$0(),V=sf();const et=gg(V);var Vl={},of={exports:{}},Hn={},af={exports:{}},cf={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wg;function W0(){return wg||(wg=1,(function(n){function e(he,ke){var oe=he.length;he.push(ke);e:for(;0<oe;){var J=oe-1>>>1,le=he[J];if(0<l(le,ke))he[J]=ke,he[oe]=le,oe=J;else break e}}function r(he){return he.length===0?null:he[0]}function a(he){if(he.length===0)return null;var ke=he[0],oe=he.pop();if(oe!==ke){he[0]=oe;e:for(var J=0,le=he.length,g=le>>>1;J<g;){var M=2*(J+1)-1,C=he[M],j=M+1,F=he[j];if(0>l(C,oe))j<le&&0>l(F,C)?(he[J]=F,he[j]=oe,J=j):(he[J]=C,he[M]=oe,J=M);else if(j<le&&0>l(F,oe))he[J]=F,he[j]=oe,J=j;else break e}}return ke}function l(he,ke){var oe=he.sortIndex-ke.sortIndex;return oe!==0?oe:he.id-ke.id}if(typeof performance=="object"&&typeof performance.now=="function"){var f=performance;n.unstable_now=function(){return f.now()}}else{var h=Date,v=h.now();n.unstable_now=function(){return h.now()-v}}var y=[],k=[],E=1,O=null,D=3,x=!1,L=!1,R=!1,N=typeof setTimeout=="function"?setTimeout:null,q=typeof clearTimeout=="function"?clearTimeout:null,Q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ee(he){for(var ke=r(k);ke!==null;){if(ke.callback===null)a(k);else if(ke.startTime<=he)a(k),ke.sortIndex=ke.expirationTime,e(y,ke);else break;ke=r(k)}}function P(he){if(R=!1,ee(he),!L)if(r(y)!==null)L=!0,it($);else{var ke=r(k);ke!==null&&we(P,ke.startTime-he)}}function $(he,ke){L=!1,R&&(R=!1,q(ye),ye=-1),x=!0;var oe=D;try{for(ee(ke),O=r(y);O!==null&&(!(O.expirationTime>ke)||he&&!S());){var J=O.callback;if(typeof J=="function"){O.callback=null,D=O.priorityLevel;var le=J(O.expirationTime<=ke);ke=n.unstable_now(),typeof le=="function"?O.callback=le:O===r(y)&&a(y),ee(ke)}else a(y);O=r(y)}if(O!==null)var g=!0;else{var M=r(k);M!==null&&we(P,M.startTime-ke),g=!1}return g}finally{O=null,D=oe,x=!1}}var G=!1,ae=null,ye=-1,Ce=5,Ve=-1;function S(){return!(n.unstable_now()-Ve<Ce)}function ze(){if(ae!==null){var he=n.unstable_now();Ve=he;var ke=!0;try{ke=ae(!0,he)}finally{ke?Ee():(G=!1,ae=null)}}else G=!1}var Ee;if(typeof Q=="function")Ee=function(){Q(ze)};else if(typeof MessageChannel<"u"){var Y=new MessageChannel,De=Y.port2;Y.port1.onmessage=ze,Ee=function(){De.postMessage(null)}}else Ee=function(){N(ze,0)};function it(he){ae=he,G||(G=!0,Ee())}function we(he,ke){ye=N(function(){he(n.unstable_now())},ke)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(he){he.callback=null},n.unstable_continueExecution=function(){L||x||(L=!0,it($))},n.unstable_forceFrameRate=function(he){0>he||125<he?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ce=0<he?Math.floor(1e3/he):5},n.unstable_getCurrentPriorityLevel=function(){return D},n.unstable_getFirstCallbackNode=function(){return r(y)},n.unstable_next=function(he){switch(D){case 1:case 2:case 3:var ke=3;break;default:ke=D}var oe=D;D=ke;try{return he()}finally{D=oe}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(he,ke){switch(he){case 1:case 2:case 3:case 4:case 5:break;default:he=3}var oe=D;D=he;try{return ke()}finally{D=oe}},n.unstable_scheduleCallback=function(he,ke,oe){var J=n.unstable_now();switch(typeof oe=="object"&&oe!==null?(oe=oe.delay,oe=typeof oe=="number"&&0<oe?J+oe:J):oe=J,he){case 1:var le=-1;break;case 2:le=250;break;case 5:le=1073741823;break;case 4:le=1e4;break;default:le=5e3}return le=oe+le,he={id:E++,callback:ke,priorityLevel:he,startTime:oe,expirationTime:le,sortIndex:-1},oe>J?(he.sortIndex=oe,e(k,he),r(y)===null&&he===r(k)&&(R?(q(ye),ye=-1):R=!0,we(P,oe-J))):(he.sortIndex=le,e(y,he),L||x||(L=!0,it($))),he},n.unstable_shouldYield=S,n.unstable_wrapCallback=function(he){var ke=D;return function(){var oe=D;D=ke;try{return he.apply(this,arguments)}finally{D=oe}}}})(cf)),cf}var bg;function G0(){return bg||(bg=1,af.exports=W0()),af.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Sg;function H0(){if(Sg)return Hn;Sg=1;var n=sf(),e=G0();function r(t){for(var i="https://reactjs.org/docs/error-decoder.html?invariant="+t,c=1;c<arguments.length;c++)i+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+t+"; visit "+i+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var a=new Set,l={};function f(t,i){h(t,i),h(t+"Capture",i)}function h(t,i){for(l[t]=i,t=0;t<i.length;t++)a.add(i[t])}var v=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),y=Object.prototype.hasOwnProperty,k=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,E={},O={};function D(t){return y.call(O,t)?!0:y.call(E,t)?!1:k.test(t)?O[t]=!0:(E[t]=!0,!1)}function x(t,i,c,d){if(c!==null&&c.type===0)return!1;switch(typeof i){case"function":case"symbol":return!0;case"boolean":return d?!1:c!==null?!c.acceptsBooleans:(t=t.toLowerCase().slice(0,5),t!=="data-"&&t!=="aria-");default:return!1}}function L(t,i,c,d){if(i===null||typeof i>"u"||x(t,i,c,d))return!0;if(d)return!1;if(c!==null)switch(c.type){case 3:return!i;case 4:return i===!1;case 5:return isNaN(i);case 6:return isNaN(i)||1>i}return!1}function R(t,i,c,d,m,w,T){this.acceptsBooleans=i===2||i===3||i===4,this.attributeName=d,this.attributeNamespace=m,this.mustUseProperty=c,this.propertyName=t,this.type=i,this.sanitizeURL=w,this.removeEmptyString=T}var N={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(t){N[t]=new R(t,0,!1,t,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(t){var i=t[0];N[i]=new R(i,1,!1,t[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(t){N[t]=new R(t,2,!1,t.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(t){N[t]=new R(t,2,!1,t,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(t){N[t]=new R(t,3,!1,t.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(t){N[t]=new R(t,3,!0,t,null,!1,!1)}),["capture","download"].forEach(function(t){N[t]=new R(t,4,!1,t,null,!1,!1)}),["cols","rows","size","span"].forEach(function(t){N[t]=new R(t,6,!1,t,null,!1,!1)}),["rowSpan","start"].forEach(function(t){N[t]=new R(t,5,!1,t.toLowerCase(),null,!1,!1)});var q=/[\-:]([a-z])/g;function Q(t){return t[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(t){var i=t.replace(q,Q);N[i]=new R(i,1,!1,t,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(t){var i=t.replace(q,Q);N[i]=new R(i,1,!1,t,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(t){var i=t.replace(q,Q);N[i]=new R(i,1,!1,t,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(t){N[t]=new R(t,1,!1,t.toLowerCase(),null,!1,!1)}),N.xlinkHref=new R("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(t){N[t]=new R(t,1,!1,t.toLowerCase(),null,!0,!0)});function ee(t,i,c,d){var m=N.hasOwnProperty(i)?N[i]:null;(m!==null?m.type!==0:d||!(2<i.length)||i[0]!=="o"&&i[0]!=="O"||i[1]!=="n"&&i[1]!=="N")&&(L(i,c,m,d)&&(c=null),d||m===null?D(i)&&(c===null?t.removeAttribute(i):t.setAttribute(i,""+c)):m.mustUseProperty?t[m.propertyName]=c===null?m.type===3?!1:"":c:(i=m.attributeName,d=m.attributeNamespace,c===null?t.removeAttribute(i):(m=m.type,c=m===3||m===4&&c===!0?"":""+c,d?t.setAttributeNS(d,i,c):t.setAttribute(i,c))))}var P=n.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$=Symbol.for("react.element"),G=Symbol.for("react.portal"),ae=Symbol.for("react.fragment"),ye=Symbol.for("react.strict_mode"),Ce=Symbol.for("react.profiler"),Ve=Symbol.for("react.provider"),S=Symbol.for("react.context"),ze=Symbol.for("react.forward_ref"),Ee=Symbol.for("react.suspense"),Y=Symbol.for("react.suspense_list"),De=Symbol.for("react.memo"),it=Symbol.for("react.lazy"),we=Symbol.for("react.offscreen"),he=Symbol.iterator;function ke(t){return t===null||typeof t!="object"?null:(t=he&&t[he]||t["@@iterator"],typeof t=="function"?t:null)}var oe=Object.assign,J;function le(t){if(J===void 0)try{throw Error()}catch(c){var i=c.stack.trim().match(/\n( *(at )?)/);J=i&&i[1]||""}return`
`+J+t}var g=!1;function M(t,i){if(!t||g)return"";g=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(i)if(i=function(){throw Error()},Object.defineProperty(i.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(i,[])}catch(re){var d=re}Reflect.construct(t,[],i)}else{try{i.call()}catch(re){d=re}t.call(i.prototype)}else{try{throw Error()}catch(re){d=re}t()}}catch(re){if(re&&d&&typeof re.stack=="string"){for(var m=re.stack.split(`
`),w=d.stack.split(`
`),T=m.length-1,B=w.length-1;1<=T&&0<=B&&m[T]!==w[B];)B--;for(;1<=T&&0<=B;T--,B--)if(m[T]!==w[B]){if(T!==1||B!==1)do if(T--,B--,0>B||m[T]!==w[B]){var z=`
`+m[T].replace(" at new "," at ");return t.displayName&&z.includes("<anonymous>")&&(z=z.replace("<anonymous>",t.displayName)),z}while(1<=T&&0<=B);break}}}finally{g=!1,Error.prepareStackTrace=c}return(t=t?t.displayName||t.name:"")?le(t):""}function C(t){switch(t.tag){case 5:return le(t.type);case 16:return le("Lazy");case 13:return le("Suspense");case 19:return le("SuspenseList");case 0:case 2:case 15:return t=M(t.type,!1),t;case 11:return t=M(t.type.render,!1),t;case 1:return t=M(t.type,!0),t;default:return""}}function j(t){if(t==null)return null;if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t;switch(t){case ae:return"Fragment";case G:return"Portal";case Ce:return"Profiler";case ye:return"StrictMode";case Ee:return"Suspense";case Y:return"SuspenseList"}if(typeof t=="object")switch(t.$$typeof){case S:return(t.displayName||"Context")+".Consumer";case Ve:return(t._context.displayName||"Context")+".Provider";case ze:var i=t.render;return t=t.displayName,t||(t=i.displayName||i.name||"",t=t!==""?"ForwardRef("+t+")":"ForwardRef"),t;case De:return i=t.displayName||null,i!==null?i:j(t.type)||"Memo";case it:i=t._payload,t=t._init;try{return j(t(i))}catch{}}return null}function F(t){var i=t.type;switch(t.tag){case 24:return"Cache";case 9:return(i.displayName||"Context")+".Consumer";case 10:return(i._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return t=i.render,t=t.displayName||t.name||"",i.displayName||(t!==""?"ForwardRef("+t+")":"ForwardRef");case 7:return"Fragment";case 5:return i;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return j(i);case 8:return i===ye?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i}return null}function H(t){switch(typeof t){case"boolean":case"number":case"string":case"undefined":return t;case"object":return t;default:return""}}function ie(t){var i=t.type;return(t=t.nodeName)&&t.toLowerCase()==="input"&&(i==="checkbox"||i==="radio")}function fe(t){var i=ie(t)?"checked":"value",c=Object.getOwnPropertyDescriptor(t.constructor.prototype,i),d=""+t[i];if(!t.hasOwnProperty(i)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var m=c.get,w=c.set;return Object.defineProperty(t,i,{configurable:!0,get:function(){return m.call(this)},set:function(T){d=""+T,w.call(this,T)}}),Object.defineProperty(t,i,{enumerable:c.enumerable}),{getValue:function(){return d},setValue:function(T){d=""+T},stopTracking:function(){t._valueTracker=null,delete t[i]}}}}function Me(t){t._valueTracker||(t._valueTracker=fe(t))}function qe(t){if(!t)return!1;var i=t._valueTracker;if(!i)return!0;var c=i.getValue(),d="";return t&&(d=ie(t)?t.checked?"true":"false":t.value),t=d,t!==c?(i.setValue(t),!0):!1}function Xe(t){if(t=t||(typeof document<"u"?document:void 0),typeof t>"u")return null;try{return t.activeElement||t.body}catch{return t.body}}function Vt(t,i){var c=i.checked;return oe({},i,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??t._wrapperState.initialChecked})}function wn(t,i){var c=i.defaultValue==null?"":i.defaultValue,d=i.checked!=null?i.checked:i.defaultChecked;c=H(i.value!=null?i.value:c),t._wrapperState={initialChecked:d,initialValue:c,controlled:i.type==="checkbox"||i.type==="radio"?i.checked!=null:i.value!=null}}function xn(t,i){i=i.checked,i!=null&&ee(t,"checked",i,!1)}function mt(t,i){xn(t,i);var c=H(i.value),d=i.type;if(c!=null)d==="number"?(c===0&&t.value===""||t.value!=c)&&(t.value=""+c):t.value!==""+c&&(t.value=""+c);else if(d==="submit"||d==="reset"){t.removeAttribute("value");return}i.hasOwnProperty("value")?en(t,i.type,c):i.hasOwnProperty("defaultValue")&&en(t,i.type,H(i.defaultValue)),i.checked==null&&i.defaultChecked!=null&&(t.defaultChecked=!!i.defaultChecked)}function At(t,i,c){if(i.hasOwnProperty("value")||i.hasOwnProperty("defaultValue")){var d=i.type;if(!(d!=="submit"&&d!=="reset"||i.value!==void 0&&i.value!==null))return;i=""+t._wrapperState.initialValue,c||i===t.value||(t.value=i),t.defaultValue=i}c=t.name,c!==""&&(t.name=""),t.defaultChecked=!!t._wrapperState.initialChecked,c!==""&&(t.name=c)}function en(t,i,c){(i!=="number"||Xe(t.ownerDocument)!==t)&&(c==null?t.defaultValue=""+t._wrapperState.initialValue:t.defaultValue!==""+c&&(t.defaultValue=""+c))}var zt=Array.isArray;function Ze(t,i,c,d){if(t=t.options,i){i={};for(var m=0;m<c.length;m++)i["$"+c[m]]=!0;for(c=0;c<t.length;c++)m=i.hasOwnProperty("$"+t[c].value),t[c].selected!==m&&(t[c].selected=m),m&&d&&(t[c].defaultSelected=!0)}else{for(c=""+H(c),i=null,m=0;m<t.length;m++){if(t[m].value===c){t[m].selected=!0,d&&(t[m].defaultSelected=!0);return}i!==null||t[m].disabled||(i=t[m])}i!==null&&(i.selected=!0)}}function Ln(t,i){if(i.dangerouslySetInnerHTML!=null)throw Error(r(91));return oe({},i,{value:void 0,defaultValue:void 0,children:""+t._wrapperState.initialValue})}function Jn(t,i){var c=i.value;if(c==null){if(c=i.children,i=i.defaultValue,c!=null){if(i!=null)throw Error(r(92));if(zt(c)){if(1<c.length)throw Error(r(93));c=c[0]}i=c}i==null&&(i=""),c=i}t._wrapperState={initialValue:H(c)}}function Jt(t,i){var c=H(i.value),d=H(i.defaultValue);c!=null&&(c=""+c,c!==t.value&&(t.value=c),i.defaultValue==null&&t.defaultValue!==c&&(t.defaultValue=c)),d!=null&&(t.defaultValue=""+d)}function Mr(t){var i=t.textContent;i===t._wrapperState.initialValue&&i!==""&&i!==null&&(t.value=i)}function qi(t){switch(t){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Nt(t,i){return t==null||t==="http://www.w3.org/1999/xhtml"?qi(i):t==="http://www.w3.org/2000/svg"&&i==="foreignObject"?"http://www.w3.org/1999/xhtml":t}var Dt,cn=(function(t){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(i,c,d,m){MSApp.execUnsafeLocalFunction(function(){return t(i,c,d,m)})}:t})(function(t,i){if(t.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in t)t.innerHTML=i;else{for(Dt=Dt||document.createElement("div"),Dt.innerHTML="<svg>"+i.valueOf().toString()+"</svg>",i=Dt.firstChild;t.firstChild;)t.removeChild(t.firstChild);for(;i.firstChild;)t.appendChild(i.firstChild)}});function Wr(t,i){if(i){var c=t.firstChild;if(c&&c===t.lastChild&&c.nodeType===3){c.nodeValue=i;return}}t.textContent=i}var hi={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ta=["Webkit","ms","Moz","O"];Object.keys(hi).forEach(function(t){Ta.forEach(function(i){i=i+t.charAt(0).toUpperCase()+t.substring(1),hi[i]=hi[t]})});function Io(t,i,c){return i==null||typeof i=="boolean"||i===""?"":c||typeof i!="number"||i===0||hi.hasOwnProperty(t)&&hi[t]?(""+i).trim():i+"px"}function $i(t,i){t=t.style;for(var c in i)if(i.hasOwnProperty(c)){var d=c.indexOf("--")===0,m=Io(c,i[c],d);c==="float"&&(c="cssFloat"),d?t.setProperty(c,m):t[c]=m}}var xo=oe({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ws(t,i){if(i){if(xo[t]&&(i.children!=null||i.dangerouslySetInnerHTML!=null))throw Error(r(137,t));if(i.dangerouslySetInnerHTML!=null){if(i.children!=null)throw Error(r(60));if(typeof i.dangerouslySetInnerHTML!="object"||!("__html"in i.dangerouslySetInnerHTML))throw Error(r(61))}if(i.style!=null&&typeof i.style!="object")throw Error(r(62))}}function pi(t,i){if(t.indexOf("-")===-1)return typeof i.is=="string";switch(t){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Qn=null;function gi(t){return t=t.target||t.srcElement||window,t.correspondingUseElement&&(t=t.correspondingUseElement),t.nodeType===3?t.parentNode:t}var Or=null,bt=null,jn=null;function Lo(t){if(t=Ti(t)){if(typeof Or!="function")throw Error(r(280));var i=t.stateNode;i&&(i=Ka(i),Or(t.stateNode,t.type,i))}}function Ra(t){bt?jn?jn.push(t):jn=[t]:bt=t}function bn(){if(bt){var t=bt,i=jn;if(jn=bt=null,Lo(t),i)for(t=0;t<i.length;t++)Lo(i[t])}}function Aa(t,i){return t(i)}function Pa(){}var Wi=!1;function bs(t,i,c){if(Wi)return t(i,c);Wi=!0;try{return Aa(t,i,c)}finally{Wi=!1,(bt!==null||jn!==null)&&(Pa(),bn())}}function Sn(t,i){var c=t.stateNode;if(c===null)return null;var d=Ka(c);if(d===null)return null;c=d[i];e:switch(i){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(t=t.type,d=!(t==="button"||t==="input"||t==="select"||t==="textarea")),t=!d;break e;default:t=!1}if(t)return null;if(c&&typeof c!="function")throw Error(r(231,i,typeof c));return c}var Ss=!1;if(v)try{var mi={};Object.defineProperty(mi,"passive",{get:function(){Ss=!0}}),window.addEventListener("test",mi,mi),window.removeEventListener("test",mi,mi)}catch{Ss=!1}function Nc(t,i,c,d,m,w,T,B,z){var re=Array.prototype.slice.call(arguments,3);try{i.apply(c,re)}catch(me){this.onError(me)}}var vi=!1,ks=null,tn=!1,jo=null,Dc={onError:function(t){vi=!0,ks=t}};function Uc(t,i,c,d,m,w,T,B,z){vi=!1,ks=null,Nc.apply(Dc,arguments)}function Cs(t,i,c,d,m,w,T,B,z){if(Uc.apply(this,arguments),vi){if(vi){var re=ks;vi=!1,ks=null}else throw Error(r(198));tn||(tn=!0,jo=re)}}function Tr(t){var i=t,c=t;if(t.alternate)for(;i.return;)i=i.return;else{t=i;do i=t,(i.flags&4098)!==0&&(c=i.return),t=i.return;while(t)}return i.tag===3?c:null}function Kn(t){if(t.tag===13){var i=t.memoizedState;if(i===null&&(t=t.alternate,t!==null&&(i=t.memoizedState)),i!==null)return i.dehydrated}return null}function Ia(t){if(Tr(t)!==t)throw Error(r(188))}function Bc(t){var i=t.alternate;if(!i){if(i=Tr(t),i===null)throw Error(r(188));return i!==t?null:t}for(var c=t,d=i;;){var m=c.return;if(m===null)break;var w=m.alternate;if(w===null){if(d=m.return,d!==null){c=d;continue}break}if(m.child===w.child){for(w=m.child;w;){if(w===c)return Ia(m),t;if(w===d)return Ia(m),i;w=w.sibling}throw Error(r(188))}if(c.return!==d.return)c=m,d=w;else{for(var T=!1,B=m.child;B;){if(B===c){T=!0,c=m,d=w;break}if(B===d){T=!0,d=m,c=w;break}B=B.sibling}if(!T){for(B=w.child;B;){if(B===c){T=!0,c=w,d=m;break}if(B===d){T=!0,d=w,c=m;break}B=B.sibling}if(!T)throw Error(r(189))}}if(c.alternate!==d)throw Error(r(190))}if(c.tag!==3)throw Error(r(188));return c.stateNode.current===c?t:i}function $e(t){return t=Bc(t),t!==null?xa(t):null}function xa(t){if(t.tag===5||t.tag===6)return t;for(t=t.child;t!==null;){var i=xa(t);if(i!==null)return i;t=t.sibling}return null}var La=e.unstable_scheduleCallback,hr=e.unstable_cancelCallback,ja=e.unstable_shouldYield,Ot=e.unstable_requestPaint,Et=e.unstable_now,Fc=e.unstable_getCurrentPriorityLevel,yi=e.unstable_ImmediatePriority,Es=e.unstable_UserBlockingPriority,Gi=e.unstable_NormalPriority,Ms=e.unstable_LowPriority,No=e.unstable_IdlePriority,_i=null,Nn=null;function Na(t){if(Nn&&typeof Nn.onCommitFiberRoot=="function")try{Nn.onCommitFiberRoot(_i,t,void 0,(t.current.flags&128)===128)}catch{}}var Dn=Math.clz32?Math.clz32:zc,Da=Math.log,Vc=Math.LN2;function zc(t){return t>>>=0,t===0?32:31-(Da(t)/Vc|0)|0}var wi=64,Os=4194304;function ln(t){switch(t&-t){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return t&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return t}}function bi(t,i){var c=t.pendingLanes;if(c===0)return 0;var d=0,m=t.suspendedLanes,w=t.pingedLanes,T=c&268435455;if(T!==0){var B=T&~m;B!==0?d=ln(B):(w&=T,w!==0&&(d=ln(w)))}else T=c&~m,T!==0?d=ln(T):w!==0&&(d=ln(w));if(d===0)return 0;if(i!==0&&i!==d&&(i&m)===0&&(m=d&-d,w=i&-i,m>=w||m===16&&(w&4194240)!==0))return i;if((d&4)!==0&&(d|=c&16),i=t.entangledLanes,i!==0)for(t=t.entanglements,i&=d;0<i;)c=31-Dn(i),m=1<<c,d|=t[c],i&=~m;return d}function Si(t,i){switch(t){case 1:case 2:case 4:return i+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function qc(t,i){for(var c=t.suspendedLanes,d=t.pingedLanes,m=t.expirationTimes,w=t.pendingLanes;0<w;){var T=31-Dn(w),B=1<<T,z=m[T];z===-1?((B&c)===0||(B&d)!==0)&&(m[T]=Si(B,i)):z<=i&&(t.expiredLanes|=B),w&=~B}}function Do(t){return t=t.pendingLanes&-1073741825,t!==0?t:t&1073741824?1073741824:0}function Ts(){var t=wi;return wi<<=1,(wi&4194240)===0&&(wi=64),t}function Rs(t){for(var i=[],c=0;31>c;c++)i.push(t);return i}function Gr(t,i,c){t.pendingLanes|=i,i!==536870912&&(t.suspendedLanes=0,t.pingedLanes=0),t=t.eventTimes,i=31-Dn(i),t[i]=c}function $c(t,i){var c=t.pendingLanes&~i;t.pendingLanes=i,t.suspendedLanes=0,t.pingedLanes=0,t.expiredLanes&=i,t.mutableReadLanes&=i,t.entangledLanes&=i,i=t.entanglements;var d=t.eventTimes;for(t=t.expirationTimes;0<c;){var m=31-Dn(c),w=1<<m;i[m]=0,d[m]=-1,t[m]=-1,c&=~w}}function St(t,i){var c=t.entangledLanes|=i;for(t=t.entanglements;c;){var d=31-Dn(c),m=1<<d;m&i|t[d]&i&&(t[d]|=i),c&=~m}}var _e=0;function As(t){return t&=-t,1<t?4<t?(t&268435455)!==0?16:536870912:4:1}var Tt,Uo,Bo,Ua,Fo,Vo=!1,Hi=[],Un=null,Qt=null,Yn=null,Hr=new Map,Jr=new Map,Bn=[],Ji="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Qi(t,i){switch(t){case"focusin":case"focusout":Un=null;break;case"dragenter":case"dragleave":Qt=null;break;case"mouseover":case"mouseout":Yn=null;break;case"pointerover":case"pointerout":Hr.delete(i.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jr.delete(i.pointerId)}}function Xn(t,i,c,d,m,w){return t===null||t.nativeEvent!==w?(t={blockedOn:i,domEventName:c,eventSystemFlags:d,nativeEvent:w,targetContainers:[m]},i!==null&&(i=Ti(i),i!==null&&Uo(i)),t):(t.eventSystemFlags|=d,i=t.targetContainers,m!==null&&i.indexOf(m)===-1&&i.push(m),t)}function Qr(t,i,c,d,m){switch(i){case"focusin":return Un=Xn(Un,t,i,c,d,m),!0;case"dragenter":return Qt=Xn(Qt,t,i,c,d,m),!0;case"mouseover":return Yn=Xn(Yn,t,i,c,d,m),!0;case"pointerover":var w=m.pointerId;return Hr.set(w,Xn(Hr.get(w)||null,t,i,c,d,m)),!0;case"gotpointercapture":return w=m.pointerId,Jr.set(w,Xn(Jr.get(w)||null,t,i,c,d,m)),!0}return!1}function zo(t){var i=nn(t.target);if(i!==null){var c=Tr(i);if(c!==null){if(i=c.tag,i===13){if(i=Kn(c),i!==null){t.blockedOn=i,Fo(t.priority,function(){Bo(c)});return}}else if(i===3&&c.stateNode.current.memoizedState.isDehydrated){t.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}t.blockedOn=null}function Rr(t){if(t.blockedOn!==null)return!1;for(var i=t.targetContainers;0<i.length;){var c=Fn(t.domEventName,t.eventSystemFlags,i[0],t.nativeEvent);if(c===null){c=t.nativeEvent;var d=new c.constructor(c.type,c);Qn=d,c.target.dispatchEvent(d),Qn=null}else return i=Ti(c),i!==null&&Uo(i),t.blockedOn=c,!1;i.shift()}return!0}function Ba(t,i,c){Rr(t)&&c.delete(i)}function Ar(){Vo=!1,Un!==null&&Rr(Un)&&(Un=null),Qt!==null&&Rr(Qt)&&(Qt=null),Yn!==null&&Rr(Yn)&&(Yn=null),Hr.forEach(Ba),Jr.forEach(Ba)}function ki(t,i){t.blockedOn===i&&(t.blockedOn=null,Vo||(Vo=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,Ar)))}function Ki(t){function i(m){return ki(m,t)}if(0<Hi.length){ki(Hi[0],t);for(var c=1;c<Hi.length;c++){var d=Hi[c];d.blockedOn===t&&(d.blockedOn=null)}}for(Un!==null&&ki(Un,t),Qt!==null&&ki(Qt,t),Yn!==null&&ki(Yn,t),Hr.forEach(i),Jr.forEach(i),c=0;c<Bn.length;c++)d=Bn[c],d.blockedOn===t&&(d.blockedOn=null);for(;0<Bn.length&&(c=Bn[0],c.blockedOn===null);)zo(c),c.blockedOn===null&&Bn.shift()}var I=P.ReactCurrentBatchConfig,ne=!0;function se(t,i,c,d){var m=_e,w=I.transition;I.transition=null;try{_e=1,Pt(t,i,c,d)}finally{_e=m,I.transition=w}}function Ie(t,i,c,d){var m=_e,w=I.transition;I.transition=null;try{_e=4,Pt(t,i,c,d)}finally{_e=m,I.transition=w}}function Pt(t,i,c,d){if(ne){var m=Fn(t,i,c,d);if(m===null)hl(t,i,d,Ut,c),Qi(t,d);else if(Qr(m,t,i,c,d))d.stopPropagation();else if(Qi(t,d),i&4&&-1<Ji.indexOf(t)){for(;m!==null;){var w=Ti(m);if(w!==null&&Tt(w),w=Fn(t,i,c,d),w===null&&hl(t,i,d,Ut,c),w===m)break;m=w}m!==null&&d.stopPropagation()}else hl(t,i,d,null,c)}}var Ut=null;function Fn(t,i,c,d){if(Ut=null,t=gi(d),t=nn(t),t!==null)if(i=Tr(t),i===null)t=null;else if(c=i.tag,c===13){if(t=Kn(i),t!==null)return t;t=null}else if(c===3){if(i.stateNode.current.memoizedState.isDehydrated)return i.tag===3?i.stateNode.containerInfo:null;t=null}else i!==t&&(t=null);return Ut=t,null}function qt(t){switch(t){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Fc()){case yi:return 1;case Es:return 4;case Gi:case Ms:return 16;case No:return 536870912;default:return 16}default:return 16}}var pr=null,Bt=null,Ci=null;function qo(){if(Ci)return Ci;var t,i=Bt,c=i.length,d,m="value"in pr?pr.value:pr.textContent,w=m.length;for(t=0;t<c&&i[t]===m[t];t++);var T=c-t;for(d=1;d<=T&&i[c-d]===m[w-d];d++);return Ci=m.slice(t,1<d?1-d:void 0)}function Pr(t){var i=t.keyCode;return"charCode"in t?(t=t.charCode,t===0&&i===13&&(t=13)):t=i,t===10&&(t=13),32<=t||t===13?t:0}function Ei(){return!0}function Yi(){return!1}function Vn(t){function i(c,d,m,w,T){this._reactName=c,this._targetInst=m,this.type=d,this.nativeEvent=w,this.target=T,this.currentTarget=null;for(var B in t)t.hasOwnProperty(B)&&(c=t[B],this[B]=c?c(w):w[B]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?Ei:Yi,this.isPropagationStopped=Yi,this}return oe(i.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=Ei)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=Ei)},persist:function(){},isPersistent:Ei}),i}var Ps={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(t){return t.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wc=Vn(Ps),Is=oe({},Ps,{view:0,detail:0}),Yu=Vn(Is),Gc,Hc,xs,$o=oe({},Is,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Xi,button:0,buttons:0,relatedTarget:function(t){return t.relatedTarget===void 0?t.fromElement===t.srcElement?t.toElement:t.fromElement:t.relatedTarget},movementX:function(t){return"movementX"in t?t.movementX:(t!==xs&&(xs&&t.type==="mousemove"?(Gc=t.screenX-xs.screenX,Hc=t.screenY-xs.screenY):Hc=Gc=0,xs=t),Gc)},movementY:function(t){return"movementY"in t?t.movementY:Hc}}),Ls=Vn($o),Mi=oe({},$o,{dataTransfer:0}),Kh=Vn(Mi),Yh=oe({},Is,{relatedTarget:0}),Fa=Vn(Yh),Xh=oe({},Ps,{animationName:0,elapsedTime:0,pseudoElement:0}),Zh=Vn(Xh),Xu=oe({},Ps,{clipboardData:function(t){return"clipboardData"in t?t.clipboardData:window.clipboardData}}),ep=Vn(Xu),tp=oe({},Ps,{data:0}),Zu=Vn(tp),ed={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},np={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Jc={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function td(t){var i=this.nativeEvent;return i.getModifierState?i.getModifierState(t):(t=Jc[t])?!!i[t]:!1}function Xi(){return td}var Oi=oe({},Is,{key:function(t){if(t.key){var i=ed[t.key]||t.key;if(i!=="Unidentified")return i}return t.type==="keypress"?(t=Pr(t),t===13?"Enter":String.fromCharCode(t)):t.type==="keydown"||t.type==="keyup"?np[t.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Xi,charCode:function(t){return t.type==="keypress"?Pr(t):0},keyCode:function(t){return t.type==="keydown"||t.type==="keyup"?t.keyCode:0},which:function(t){return t.type==="keypress"?Pr(t):t.type==="keydown"||t.type==="keyup"?t.keyCode:0}}),rp=Vn(Oi),ip=oe({},$o,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nd=Vn(ip),sp=oe({},Is,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Xi}),op=Vn(sp),ap=oe({},Ps,{propertyName:0,elapsedTime:0,pseudoElement:0}),rd=Vn(ap),cp=oe({},$o,{deltaX:function(t){return"deltaX"in t?t.deltaX:"wheelDeltaX"in t?-t.wheelDeltaX:0},deltaY:function(t){return"deltaY"in t?t.deltaY:"wheelDeltaY"in t?-t.wheelDeltaY:"wheelDelta"in t?-t.wheelDelta:0},deltaZ:0,deltaMode:0}),id=Vn(cp),lp=[9,13,27,32],Qc=v&&"CompositionEvent"in window,js=null;v&&"documentMode"in document&&(js=document.documentMode);var sd=v&&"TextEvent"in window&&!js,Kc=v&&(!Qc||js&&8<js&&11>=js),Yc=" ",Xc=!1;function od(t,i){switch(t){case"keyup":return lp.indexOf(i.keyCode)!==-1;case"keydown":return i.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ad(t){return t=t.detail,typeof t=="object"&&"data"in t?t.data:null}var Ns=!1;function cd(t,i){switch(t){case"compositionend":return ad(i);case"keypress":return i.which!==32?null:(Xc=!0,Yc);case"textInput":return t=i.data,t===Yc&&Xc?null:t;default:return null}}function Ds(t,i){if(Ns)return t==="compositionend"||!Qc&&od(t,i)?(t=qo(),Ci=Bt=pr=null,Ns=!1,t):null;switch(t){case"paste":return null;case"keypress":if(!(i.ctrlKey||i.altKey||i.metaKey)||i.ctrlKey&&i.altKey){if(i.char&&1<i.char.length)return i.char;if(i.which)return String.fromCharCode(i.which)}return null;case"compositionend":return Kc&&i.locale!=="ko"?null:i.data;default:return null}}var Wo={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Zc(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i==="input"?!!Wo[t.type]:i==="textarea"}function el(t,i,c,d){Ra(d),i=zs(i,"onChange"),0<i.length&&(c=new Wc("onChange","change",null,c,d),t.push({event:c,listeners:i}))}var Us=null,Bs=null;function up(t){dl(t,0)}function Fs(t){var i=Gs(t);if(qe(i))return t}function dp(t,i){if(t==="change")return i}var Go=!1;if(v){var tl;if(v){var Ho="oninput"in document;if(!Ho){var nl=document.createElement("div");nl.setAttribute("oninput","return;"),Ho=typeof nl.oninput=="function"}tl=Ho}else tl=!1;Go=tl&&(!document.documentMode||9<document.documentMode)}function kn(){Us&&(Us.detachEvent("onpropertychange",Va),Bs=Us=null)}function Va(t){if(t.propertyName==="value"&&Fs(Bs)){var i=[];el(i,Bs,t,gi(t)),bs(up,i)}}function rl(t,i,c){t==="focusin"?(kn(),Us=i,Bs=c,Us.attachEvent("onpropertychange",Va)):t==="focusout"&&kn()}function fp(t){if(t==="selectionchange"||t==="keyup"||t==="keydown")return Fs(Bs)}function hp(t,i){if(t==="click")return Fs(i)}function il(t,i){if(t==="input"||t==="change")return Fs(i)}function ld(t,i){return t===i&&(t!==0||1/t===1/i)||t!==t&&i!==i}var gr=typeof Object.is=="function"?Object.is:ld;function Jo(t,i){if(gr(t,i))return!0;if(typeof t!="object"||t===null||typeof i!="object"||i===null)return!1;var c=Object.keys(t),d=Object.keys(i);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++){var m=c[d];if(!y.call(i,m)||!gr(t[m],i[m]))return!1}return!0}function sl(t){for(;t&&t.firstChild;)t=t.firstChild;return t}function Vs(t,i){var c=sl(t);t=0;for(var d;c;){if(c.nodeType===3){if(d=t+c.textContent.length,t<=i&&d>=i)return{node:c,offset:i-t};t=d}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=sl(c)}}function ud(t,i){return t&&i?t===i?!0:t&&t.nodeType===3?!1:i&&i.nodeType===3?ud(t,i.parentNode):"contains"in t?t.contains(i):t.compareDocumentPosition?!!(t.compareDocumentPosition(i)&16):!1:!1}function ol(){for(var t=window,i=Xe();i instanceof t.HTMLIFrameElement;){try{var c=typeof i.contentWindow.location.href=="string"}catch{c=!1}if(c)t=i.contentWindow;else break;i=Xe(t.document)}return i}function Kr(t){var i=t&&t.nodeName&&t.nodeName.toLowerCase();return i&&(i==="input"&&(t.type==="text"||t.type==="search"||t.type==="tel"||t.type==="url"||t.type==="password")||i==="textarea"||t.contentEditable==="true")}function al(t){var i=ol(),c=t.focusedElem,d=t.selectionRange;if(i!==c&&c&&c.ownerDocument&&ud(c.ownerDocument.documentElement,c)){if(d!==null&&Kr(c)){if(i=d.start,t=d.end,t===void 0&&(t=i),"selectionStart"in c)c.selectionStart=i,c.selectionEnd=Math.min(t,c.value.length);else if(t=(i=c.ownerDocument||document)&&i.defaultView||window,t.getSelection){t=t.getSelection();var m=c.textContent.length,w=Math.min(d.start,m);d=d.end===void 0?w:Math.min(d.end,m),!t.extend&&w>d&&(m=d,d=w,w=m),m=Vs(c,w);var T=Vs(c,d);m&&T&&(t.rangeCount!==1||t.anchorNode!==m.node||t.anchorOffset!==m.offset||t.focusNode!==T.node||t.focusOffset!==T.offset)&&(i=i.createRange(),i.setStart(m.node,m.offset),t.removeAllRanges(),w>d?(t.addRange(i),t.extend(T.node,T.offset)):(i.setEnd(T.node,T.offset),t.addRange(i)))}}for(i=[],t=c;t=t.parentNode;)t.nodeType===1&&i.push({element:t,left:t.scrollLeft,top:t.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<i.length;c++)t=i[c],t.element.scrollLeft=t.left,t.element.scrollTop=t.top}}var pp=v&&"documentMode"in document&&11>=document.documentMode,Zi=null,za=null,Qo=null,cl=!1;function dd(t,i,c){var d=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;cl||Zi==null||Zi!==Xe(d)||(d=Zi,"selectionStart"in d&&Kr(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Qo&&Jo(Qo,d)||(Qo=d,d=zs(za,"onSelect"),0<d.length&&(i=new Wc("onSelect","select",null,i,c),t.push({event:i,listeners:d}),i.target=Zi)))}function es(t,i){var c={};return c[t.toLowerCase()]=i.toLowerCase(),c["Webkit"+t]="webkit"+i,c["Moz"+t]="moz"+i,c}var zn={animationend:es("Animation","AnimationEnd"),animationiteration:es("Animation","AnimationIteration"),animationstart:es("Animation","AnimationStart"),transitionend:es("Transition","TransitionEnd")},ll={},fd={};v&&(fd=document.createElement("div").style,"AnimationEvent"in window||(delete zn.animationend.animation,delete zn.animationiteration.animation,delete zn.animationstart.animation),"TransitionEvent"in window||delete zn.transitionend.transition);function Ir(t){if(ll[t])return ll[t];if(!zn[t])return t;var i=zn[t],c;for(c in i)if(i.hasOwnProperty(c)&&c in fd)return ll[t]=i[c];return t}var hd=Ir("animationend"),pd=Ir("animationiteration"),gd=Ir("animationstart"),ts=Ir("transitionend"),un=new Map,md="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function xr(t,i){un.set(t,i),f(i,[t])}for(var ns=0;ns<md.length;ns++){var qa=md[ns],ul=qa.toLowerCase(),gp=qa[0].toUpperCase()+qa.slice(1);xr(ul,"on"+gp)}xr(hd,"onAnimationEnd"),xr(pd,"onAnimationIteration"),xr(gd,"onAnimationStart"),xr("dblclick","onDoubleClick"),xr("focusin","onFocus"),xr("focusout","onBlur"),xr(ts,"onTransitionEnd"),h("onMouseEnter",["mouseout","mouseover"]),h("onMouseLeave",["mouseout","mouseover"]),h("onPointerEnter",["pointerout","pointerover"]),h("onPointerLeave",["pointerout","pointerover"]),f("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),f("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),f("onBeforeInput",["compositionend","keypress","textInput","paste"]),f("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),f("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),f("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var rs="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),mp=new Set("cancel close invalid load scroll toggle".split(" ").concat(rs));function vd(t,i,c){var d=t.type||"unknown-event";t.currentTarget=c,Cs(d,i,void 0,t),t.currentTarget=null}function dl(t,i){i=(i&4)!==0;for(var c=0;c<t.length;c++){var d=t[c],m=d.event;d=d.listeners;e:{var w=void 0;if(i)for(var T=d.length-1;0<=T;T--){var B=d[T],z=B.instance,re=B.currentTarget;if(B=B.listener,z!==w&&m.isPropagationStopped())break e;vd(m,B,re),w=z}else for(T=0;T<d.length;T++){if(B=d[T],z=B.instance,re=B.currentTarget,B=B.listener,z!==w&&m.isPropagationStopped())break e;vd(m,B,re),w=z}}}if(tn)throw t=jo,tn=!1,jo=null,t}function kt(t,i){var c=i[Ws];c===void 0&&(c=i[Ws]=new Set);var d=t+"__bubble";c.has(d)||(yd(i,t,2,!1),c.add(d))}function fl(t,i,c){var d=0;i&&(d|=4),yd(c,t,d,i)}var Ko="_reactListening"+Math.random().toString(36).slice(2);function Yo(t){if(!t[Ko]){t[Ko]=!0,a.forEach(function(c){c!=="selectionchange"&&(mp.has(c)||fl(c,!1,t),fl(c,!0,t))});var i=t.nodeType===9?t:t.ownerDocument;i===null||i[Ko]||(i[Ko]=!0,fl("selectionchange",!1,i))}}function yd(t,i,c,d){switch(qt(i)){case 1:var m=se;break;case 4:m=Ie;break;default:m=Pt}c=m.bind(null,i,c,t),m=void 0,!Ss||i!=="touchstart"&&i!=="touchmove"&&i!=="wheel"||(m=!0),d?m!==void 0?t.addEventListener(i,c,{capture:!0,passive:m}):t.addEventListener(i,c,!0):m!==void 0?t.addEventListener(i,c,{passive:m}):t.addEventListener(i,c,!1)}function hl(t,i,c,d,m){var w=d;if((i&1)===0&&(i&2)===0&&d!==null)e:for(;;){if(d===null)return;var T=d.tag;if(T===3||T===4){var B=d.stateNode.containerInfo;if(B===m||B.nodeType===8&&B.parentNode===m)break;if(T===4)for(T=d.return;T!==null;){var z=T.tag;if((z===3||z===4)&&(z=T.stateNode.containerInfo,z===m||z.nodeType===8&&z.parentNode===m))return;T=T.return}for(;B!==null;){if(T=nn(B),T===null)return;if(z=T.tag,z===5||z===6){d=w=T;continue e}B=B.parentNode}}d=d.return}bs(function(){var re=w,me=gi(c),ve=[];e:{var pe=un.get(t);if(pe!==void 0){var Re=Wc,Pe=t;switch(t){case"keypress":if(Pr(c)===0)break e;case"keydown":case"keyup":Re=rp;break;case"focusin":Pe="focus",Re=Fa;break;case"focusout":Pe="blur",Re=Fa;break;case"beforeblur":case"afterblur":Re=Fa;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Re=Ls;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Re=Kh;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Re=op;break;case hd:case pd:case gd:Re=Zh;break;case ts:Re=rd;break;case"scroll":Re=Yu;break;case"wheel":Re=id;break;case"copy":case"cut":case"paste":Re=ep;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Re=nd}var xe=(i&4)!==0,Ft=!xe&&t==="scroll",Z=xe?pe!==null?pe+"Capture":null:pe;xe=[];for(var W=re,te;W!==null;){te=W;var Se=te.stateNode;if(te.tag===5&&Se!==null&&(te=Se,Z!==null&&(Se=Sn(W,Z),Se!=null&&xe.push(Xo(W,Se,te)))),Ft)break;W=W.return}0<xe.length&&(pe=new Re(pe,Pe,null,c,me),ve.push({event:pe,listeners:xe}))}}if((i&7)===0){e:{if(pe=t==="mouseover"||t==="pointerover",Re=t==="mouseout"||t==="pointerout",pe&&c!==Qn&&(Pe=c.relatedTarget||c.fromElement)&&(nn(Pe)||Pe[mr]))break e;if((Re||pe)&&(pe=me.window===me?me:(pe=me.ownerDocument)?pe.defaultView||pe.parentWindow:window,Re?(Pe=c.relatedTarget||c.toElement,Re=re,Pe=Pe?nn(Pe):null,Pe!==null&&(Ft=Tr(Pe),Pe!==Ft||Pe.tag!==5&&Pe.tag!==6)&&(Pe=null)):(Re=null,Pe=re),Re!==Pe)){if(xe=Ls,Se="onMouseLeave",Z="onMouseEnter",W="mouse",(t==="pointerout"||t==="pointerover")&&(xe=nd,Se="onPointerLeave",Z="onPointerEnter",W="pointer"),Ft=Re==null?pe:Gs(Re),te=Pe==null?pe:Gs(Pe),pe=new xe(Se,W+"leave",Re,c,me),pe.target=Ft,pe.relatedTarget=te,Se=null,nn(me)===re&&(xe=new xe(Z,W+"enter",Pe,c,me),xe.target=te,xe.relatedTarget=Ft,Se=xe),Ft=Se,Re&&Pe)t:{for(xe=Re,Z=Pe,W=0,te=xe;te;te=qs(te))W++;for(te=0,Se=Z;Se;Se=qs(Se))te++;for(;0<W-te;)xe=qs(xe),W--;for(;0<te-W;)Z=qs(Z),te--;for(;W--;){if(xe===Z||Z!==null&&xe===Z.alternate)break t;xe=qs(xe),Z=qs(Z)}xe=null}else xe=null;Re!==null&&$a(ve,pe,Re,xe,!1),Pe!==null&&Ft!==null&&$a(ve,Ft,Pe,xe,!0)}}e:{if(pe=re?Gs(re):window,Re=pe.nodeName&&pe.nodeName.toLowerCase(),Re==="select"||Re==="input"&&pe.type==="file")var Le=dp;else if(Zc(pe))if(Go)Le=il;else{Le=fp;var Be=rl}else(Re=pe.nodeName)&&Re.toLowerCase()==="input"&&(pe.type==="checkbox"||pe.type==="radio")&&(Le=hp);if(Le&&(Le=Le(t,re))){el(ve,Le,c,me);break e}Be&&Be(t,pe,re),t==="focusout"&&(Be=pe._wrapperState)&&Be.controlled&&pe.type==="number"&&en(pe,"number",pe.value)}switch(Be=re?Gs(re):window,t){case"focusin":(Zc(Be)||Be.contentEditable==="true")&&(Zi=Be,za=re,Qo=null);break;case"focusout":Qo=za=Zi=null;break;case"mousedown":cl=!0;break;case"contextmenu":case"mouseup":case"dragend":cl=!1,dd(ve,c,me);break;case"selectionchange":if(pp)break;case"keydown":case"keyup":dd(ve,c,me)}var Fe;if(Qc)e:{switch(t){case"compositionstart":var Je="onCompositionStart";break e;case"compositionend":Je="onCompositionEnd";break e;case"compositionupdate":Je="onCompositionUpdate";break e}Je=void 0}else Ns?od(t,c)&&(Je="onCompositionEnd"):t==="keydown"&&c.keyCode===229&&(Je="onCompositionStart");Je&&(Kc&&c.locale!=="ko"&&(Ns||Je!=="onCompositionStart"?Je==="onCompositionEnd"&&Ns&&(Fe=qo()):(pr=me,Bt="value"in pr?pr.value:pr.textContent,Ns=!0)),Be=zs(re,Je),0<Be.length&&(Je=new Zu(Je,t,null,c,me),ve.push({event:Je,listeners:Be}),Fe?Je.data=Fe:(Fe=ad(c),Fe!==null&&(Je.data=Fe)))),(Fe=sd?cd(t,c):Ds(t,c))&&(re=zs(re,"onBeforeInput"),0<re.length&&(me=new Zu("onBeforeInput","beforeinput",null,c,me),ve.push({event:me,listeners:re}),me.data=Fe))}dl(ve,i)})}function Xo(t,i,c){return{instance:t,listener:i,currentTarget:c}}function zs(t,i){for(var c=i+"Capture",d=[];t!==null;){var m=t,w=m.stateNode;m.tag===5&&w!==null&&(m=w,w=Sn(t,c),w!=null&&d.unshift(Xo(t,w,m)),w=Sn(t,i),w!=null&&d.push(Xo(t,w,m))),t=t.return}return d}function qs(t){if(t===null)return null;do t=t.return;while(t&&t.tag!==5);return t||null}function $a(t,i,c,d,m){for(var w=i._reactName,T=[];c!==null&&c!==d;){var B=c,z=B.alternate,re=B.stateNode;if(z!==null&&z===d)break;B.tag===5&&re!==null&&(B=re,m?(z=Sn(c,w),z!=null&&T.unshift(Xo(c,z,B))):m||(z=Sn(c,w),z!=null&&T.push(Xo(c,z,B)))),c=c.return}T.length!==0&&t.push({event:i,listeners:T})}var vp=/\r\n?/g,yp=/\u0000|\uFFFD/g;function _d(t){return(typeof t=="string"?t:""+t).replace(vp,`
`).replace(yp,"")}function Wa(t,i,c){if(i=_d(i),_d(t)!==i&&c)throw Error(r(425))}function Ga(){}var pl=null,Ha=null;function gl(t,i){return t==="textarea"||t==="noscript"||typeof i.children=="string"||typeof i.children=="number"||typeof i.dangerouslySetInnerHTML=="object"&&i.dangerouslySetInnerHTML!==null&&i.dangerouslySetInnerHTML.__html!=null}var Cn=typeof setTimeout=="function"?setTimeout:void 0,ml=typeof clearTimeout=="function"?clearTimeout:void 0,Ja=typeof Promise=="function"?Promise:void 0,Zo=typeof queueMicrotask=="function"?queueMicrotask:typeof Ja<"u"?function(t){return Ja.resolve(null).then(t).catch(vl)}:Cn;function vl(t){setTimeout(function(){throw t})}function Qa(t,i){var c=i,d=0;do{var m=c.nextSibling;if(t.removeChild(c),m&&m.nodeType===8)if(c=m.data,c==="/$"){if(d===0){t.removeChild(m),Ki(i);return}d--}else c!=="$"&&c!=="$?"&&c!=="$!"||d++;c=m}while(c);Ki(i)}function Yr(t){for(;t!=null;t=t.nextSibling){var i=t.nodeType;if(i===1||i===3)break;if(i===8){if(i=t.data,i==="$"||i==="$!"||i==="$?")break;if(i==="/$")return null}}return t}function $s(t){t=t.previousSibling;for(var i=0;t;){if(t.nodeType===8){var c=t.data;if(c==="$"||c==="$!"||c==="$?"){if(i===0)return t;i--}else c==="/$"&&i++}t=t.previousSibling}return null}var is=Math.random().toString(36).slice(2),En="__reactFiber$"+is,Xr="__reactProps$"+is,mr="__reactContainer$"+is,Ws="__reactEvents$"+is,_p="__reactListeners$"+is,yl="__reactHandles$"+is;function nn(t){var i=t[En];if(i)return i;for(var c=t.parentNode;c;){if(i=c[mr]||c[En]){if(c=i.alternate,i.child!==null||c!==null&&c.child!==null)for(t=$s(t);t!==null;){if(c=t[En])return c;t=$s(t)}return i}t=c,c=t.parentNode}return null}function Ti(t){return t=t[En]||t[mr],!t||t.tag!==5&&t.tag!==6&&t.tag!==13&&t.tag!==3?null:t}function Gs(t){if(t.tag===5||t.tag===6)return t.stateNode;throw Error(r(33))}function Ka(t){return t[Xr]||null}var Ya=[],Hs=-1;function Zr(t){return{current:t}}function ct(t){0>Hs||(t.current=Ya[Hs],Ya[Hs]=null,Hs--)}function vt(t,i){Hs++,Ya[Hs]=t.current,t.current=i}var Zn={},Kt=Zr(Zn),dn=Zr(!1),er=Zn;function vr(t,i){var c=t.type.contextTypes;if(!c)return Zn;var d=t.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===i)return d.__reactInternalMemoizedMaskedChildContext;var m={},w;for(w in c)m[w]=i[w];return d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=i,t.__reactInternalMemoizedMaskedChildContext=m),m}function Mn(t){return t=t.childContextTypes,t!=null}function ea(){ct(dn),ct(Kt)}function It(t,i,c){if(Kt.current!==Zn)throw Error(r(168));vt(Kt,i),vt(dn,c)}function wd(t,i,c){var d=t.stateNode;if(i=i.childContextTypes,typeof d.getChildContext!="function")return c;d=d.getChildContext();for(var m in d)if(!(m in i))throw Error(r(108,F(t)||"Unknown",m));return oe({},c,d)}function Xa(t){return t=(t=t.stateNode)&&t.__reactInternalMemoizedMergedChildContext||Zn,er=Kt.current,vt(Kt,t),vt(dn,dn.current),!0}function bd(t,i,c){var d=t.stateNode;if(!d)throw Error(r(169));c?(t=wd(t,i,er),d.__reactInternalMemoizedMergedChildContext=t,ct(dn),ct(Kt),vt(Kt,t)):ct(dn),vt(dn,c)}var ei=null,Za=!1,_l=!1;function wl(t){ei===null?ei=[t]:ei.push(t)}function wp(t){Za=!0,wl(t)}function Lr(){if(!_l&&ei!==null){_l=!0;var t=0,i=_e;try{var c=ei;for(_e=1;t<c.length;t++){var d=c[t];do d=d(!0);while(d!==null)}ei=null,Za=!1}catch(m){throw ei!==null&&(ei=ei.slice(t+1)),La(yi,Lr),m}finally{_e=i,_l=!1}}return null}var Js=[],Qs=0,ec=null,tc=0,tr=[],nr=0,Ri=null,ti=1,ni="";function ss(t,i){Js[Qs++]=tc,Js[Qs++]=ec,ec=t,tc=i}function Sd(t,i,c){tr[nr++]=ti,tr[nr++]=ni,tr[nr++]=Ri,Ri=t;var d=ti;t=ni;var m=32-Dn(d)-1;d&=~(1<<m),c+=1;var w=32-Dn(i)+m;if(30<w){var T=m-m%5;w=(d&(1<<T)-1).toString(32),d>>=T,m-=T,ti=1<<32-Dn(i)+m|c<<m|d,ni=w+t}else ti=1<<w|c<<m|d,ni=t}function nc(t){t.return!==null&&(ss(t,1),Sd(t,1,0))}function rc(t){for(;t===ec;)ec=Js[--Qs],Js[Qs]=null,tc=Js[--Qs],Js[Qs]=null;for(;t===Ri;)Ri=tr[--nr],tr[nr]=null,ni=tr[--nr],tr[nr]=null,ti=tr[--nr],tr[nr]=null}var qn=null,$n=null,Mt=!1,yr=null;function kd(t,i){var c=Ur(5,null,null,0);c.elementType="DELETED",c.stateNode=i,c.return=t,i=t.deletions,i===null?(t.deletions=[c],t.flags|=16):i.push(c)}function Cd(t,i){switch(t.tag){case 5:var c=t.type;return i=i.nodeType!==1||c.toLowerCase()!==i.nodeName.toLowerCase()?null:i,i!==null?(t.stateNode=i,qn=t,$n=Yr(i.firstChild),!0):!1;case 6:return i=t.pendingProps===""||i.nodeType!==3?null:i,i!==null?(t.stateNode=i,qn=t,$n=null,!0):!1;case 13:return i=i.nodeType!==8?null:i,i!==null?(c=Ri!==null?{id:ti,overflow:ni}:null,t.memoizedState={dehydrated:i,treeContext:c,retryLane:1073741824},c=Ur(18,null,null,0),c.stateNode=i,c.return=t,t.child=c,qn=t,$n=null,!0):!1;default:return!1}}function bl(t){return(t.mode&1)!==0&&(t.flags&128)===0}function Sl(t){if(Mt){var i=$n;if(i){var c=i;if(!Cd(t,i)){if(bl(t))throw Error(r(418));i=Yr(c.nextSibling);var d=qn;i&&Cd(t,i)?kd(d,c):(t.flags=t.flags&-4097|2,Mt=!1,qn=t)}}else{if(bl(t))throw Error(r(418));t.flags=t.flags&-4097|2,Mt=!1,qn=t}}}function Ks(t){for(t=t.return;t!==null&&t.tag!==5&&t.tag!==3&&t.tag!==13;)t=t.return;qn=t}function ta(t){if(t!==qn)return!1;if(!Mt)return Ks(t),Mt=!0,!1;var i;if((i=t.tag!==3)&&!(i=t.tag!==5)&&(i=t.type,i=i!=="head"&&i!=="body"&&!gl(t.type,t.memoizedProps)),i&&(i=$n)){if(bl(t))throw ic(),Error(r(418));for(;i;)kd(t,i),i=Yr(i.nextSibling)}if(Ks(t),t.tag===13){if(t=t.memoizedState,t=t!==null?t.dehydrated:null,!t)throw Error(r(317));e:{for(t=t.nextSibling,i=0;t;){if(t.nodeType===8){var c=t.data;if(c==="/$"){if(i===0){$n=Yr(t.nextSibling);break e}i--}else c!=="$"&&c!=="$!"&&c!=="$?"||i++}t=t.nextSibling}$n=null}}else $n=qn?Yr(t.stateNode.nextSibling):null;return!0}function ic(){for(var t=$n;t;)t=Yr(t.nextSibling)}function Ys(){$n=qn=null,Mt=!1}function na(t){yr===null?yr=[t]:yr.push(t)}var Ed=P.ReactCurrentBatchConfig;function ra(t,i,c){if(t=c.ref,t!==null&&typeof t!="function"&&typeof t!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(r(309));var d=c.stateNode}if(!d)throw Error(r(147,t));var m=d,w=""+t;return i!==null&&i.ref!==null&&typeof i.ref=="function"&&i.ref._stringRef===w?i.ref:(i=function(T){var B=m.refs;T===null?delete B[w]:B[w]=T},i._stringRef=w,i)}if(typeof t!="string")throw Error(r(284));if(!c._owner)throw Error(r(290,t))}return t}function sc(t,i){throw t=Object.prototype.toString.call(i),Error(r(31,t==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":t))}function Md(t){var i=t._init;return i(t._payload)}function Od(t){function i(Z,W){if(t){var te=Z.deletions;te===null?(Z.deletions=[W],Z.flags|=16):te.push(W)}}function c(Z,W){if(!t)return null;for(;W!==null;)i(Z,W),W=W.sibling;return null}function d(Z,W){for(Z=new Map;W!==null;)W.key!==null?Z.set(W.key,W):Z.set(W.index,W),W=W.sibling;return Z}function m(Z,W){return Z=so(Z,W),Z.index=0,Z.sibling=null,Z}function w(Z,W,te){return Z.index=te,t?(te=Z.alternate,te!==null?(te=te.index,te<W?(Z.flags|=2,W):te):(Z.flags|=2,W)):(Z.flags|=1048576,W)}function T(Z){return t&&Z.alternate===null&&(Z.flags|=2),Z}function B(Z,W,te,Se){return W===null||W.tag!==6?(W=eg(te,Z.mode,Se),W.return=Z,W):(W=m(W,te),W.return=Z,W)}function z(Z,W,te,Se){var Le=te.type;return Le===ae?me(Z,W,te.props.children,Se,te.key):W!==null&&(W.elementType===Le||typeof Le=="object"&&Le!==null&&Le.$$typeof===it&&Md(Le)===W.type)?(Se=m(W,te.props),Se.ref=ra(Z,W,te),Se.return=Z,Se):(Se=Hd(te.type,te.key,te.props,null,Z.mode,Se),Se.ref=ra(Z,W,te),Se.return=Z,Se)}function re(Z,W,te,Se){return W===null||W.tag!==4||W.stateNode.containerInfo!==te.containerInfo||W.stateNode.implementation!==te.implementation?(W=tg(te,Z.mode,Se),W.return=Z,W):(W=m(W,te.children||[]),W.return=Z,W)}function me(Z,W,te,Se,Le){return W===null||W.tag!==7?(W=ua(te,Z.mode,Se,Le),W.return=Z,W):(W=m(W,te),W.return=Z,W)}function ve(Z,W,te){if(typeof W=="string"&&W!==""||typeof W=="number")return W=eg(""+W,Z.mode,te),W.return=Z,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case $:return te=Hd(W.type,W.key,W.props,null,Z.mode,te),te.ref=ra(Z,null,W),te.return=Z,te;case G:return W=tg(W,Z.mode,te),W.return=Z,W;case it:var Se=W._init;return ve(Z,Se(W._payload),te)}if(zt(W)||ke(W))return W=ua(W,Z.mode,te,null),W.return=Z,W;sc(Z,W)}return null}function pe(Z,W,te,Se){var Le=W!==null?W.key:null;if(typeof te=="string"&&te!==""||typeof te=="number")return Le!==null?null:B(Z,W,""+te,Se);if(typeof te=="object"&&te!==null){switch(te.$$typeof){case $:return te.key===Le?z(Z,W,te,Se):null;case G:return te.key===Le?re(Z,W,te,Se):null;case it:return Le=te._init,pe(Z,W,Le(te._payload),Se)}if(zt(te)||ke(te))return Le!==null?null:me(Z,W,te,Se,null);sc(Z,te)}return null}function Re(Z,W,te,Se,Le){if(typeof Se=="string"&&Se!==""||typeof Se=="number")return Z=Z.get(te)||null,B(W,Z,""+Se,Le);if(typeof Se=="object"&&Se!==null){switch(Se.$$typeof){case $:return Z=Z.get(Se.key===null?te:Se.key)||null,z(W,Z,Se,Le);case G:return Z=Z.get(Se.key===null?te:Se.key)||null,re(W,Z,Se,Le);case it:var Be=Se._init;return Re(Z,W,te,Be(Se._payload),Le)}if(zt(Se)||ke(Se))return Z=Z.get(te)||null,me(W,Z,Se,Le,null);sc(W,Se)}return null}function Pe(Z,W,te,Se){for(var Le=null,Be=null,Fe=W,Je=W=0,on=null;Fe!==null&&Je<te.length;Je++){Fe.index>Je?(on=Fe,Fe=null):on=Fe.sibling;var ht=pe(Z,Fe,te[Je],Se);if(ht===null){Fe===null&&(Fe=on);break}t&&Fe&&ht.alternate===null&&i(Z,Fe),W=w(ht,W,Je),Be===null?Le=ht:Be.sibling=ht,Be=ht,Fe=on}if(Je===te.length)return c(Z,Fe),Mt&&ss(Z,Je),Le;if(Fe===null){for(;Je<te.length;Je++)Fe=ve(Z,te[Je],Se),Fe!==null&&(W=w(Fe,W,Je),Be===null?Le=Fe:Be.sibling=Fe,Be=Fe);return Mt&&ss(Z,Je),Le}for(Fe=d(Z,Fe);Je<te.length;Je++)on=Re(Fe,Z,Je,te[Je],Se),on!==null&&(t&&on.alternate!==null&&Fe.delete(on.key===null?Je:on.key),W=w(on,W,Je),Be===null?Le=on:Be.sibling=on,Be=on);return t&&Fe.forEach(function(oo){return i(Z,oo)}),Mt&&ss(Z,Je),Le}function xe(Z,W,te,Se){var Le=ke(te);if(typeof Le!="function")throw Error(r(150));if(te=Le.call(te),te==null)throw Error(r(151));for(var Be=Le=null,Fe=W,Je=W=0,on=null,ht=te.next();Fe!==null&&!ht.done;Je++,ht=te.next()){Fe.index>Je?(on=Fe,Fe=null):on=Fe.sibling;var oo=pe(Z,Fe,ht.value,Se);if(oo===null){Fe===null&&(Fe=on);break}t&&Fe&&oo.alternate===null&&i(Z,Fe),W=w(oo,W,Je),Be===null?Le=oo:Be.sibling=oo,Be=oo,Fe=on}if(ht.done)return c(Z,Fe),Mt&&ss(Z,Je),Le;if(Fe===null){for(;!ht.done;Je++,ht=te.next())ht=ve(Z,ht.value,Se),ht!==null&&(W=w(ht,W,Je),Be===null?Le=ht:Be.sibling=ht,Be=ht);return Mt&&ss(Z,Je),Le}for(Fe=d(Z,Fe);!ht.done;Je++,ht=te.next())ht=Re(Fe,Z,Je,ht.value,Se),ht!==null&&(t&&ht.alternate!==null&&Fe.delete(ht.key===null?Je:ht.key),W=w(ht,W,Je),Be===null?Le=ht:Be.sibling=ht,Be=ht);return t&&Fe.forEach(function(c1){return i(Z,c1)}),Mt&&ss(Z,Je),Le}function Ft(Z,W,te,Se){if(typeof te=="object"&&te!==null&&te.type===ae&&te.key===null&&(te=te.props.children),typeof te=="object"&&te!==null){switch(te.$$typeof){case $:e:{for(var Le=te.key,Be=W;Be!==null;){if(Be.key===Le){if(Le=te.type,Le===ae){if(Be.tag===7){c(Z,Be.sibling),W=m(Be,te.props.children),W.return=Z,Z=W;break e}}else if(Be.elementType===Le||typeof Le=="object"&&Le!==null&&Le.$$typeof===it&&Md(Le)===Be.type){c(Z,Be.sibling),W=m(Be,te.props),W.ref=ra(Z,Be,te),W.return=Z,Z=W;break e}c(Z,Be);break}else i(Z,Be);Be=Be.sibling}te.type===ae?(W=ua(te.props.children,Z.mode,Se,te.key),W.return=Z,Z=W):(Se=Hd(te.type,te.key,te.props,null,Z.mode,Se),Se.ref=ra(Z,W,te),Se.return=Z,Z=Se)}return T(Z);case G:e:{for(Be=te.key;W!==null;){if(W.key===Be)if(W.tag===4&&W.stateNode.containerInfo===te.containerInfo&&W.stateNode.implementation===te.implementation){c(Z,W.sibling),W=m(W,te.children||[]),W.return=Z,Z=W;break e}else{c(Z,W);break}else i(Z,W);W=W.sibling}W=tg(te,Z.mode,Se),W.return=Z,Z=W}return T(Z);case it:return Be=te._init,Ft(Z,W,Be(te._payload),Se)}if(zt(te))return Pe(Z,W,te,Se);if(ke(te))return xe(Z,W,te,Se);sc(Z,te)}return typeof te=="string"&&te!==""||typeof te=="number"?(te=""+te,W!==null&&W.tag===6?(c(Z,W.sibling),W=m(W,te),W.return=Z,Z=W):(c(Z,W),W=eg(te,Z.mode,Se),W.return=Z,Z=W),T(Z)):c(Z,W)}return Ft}var Xs=Od(!0),Td=Od(!1),ia=Zr(null),Ai=null,jr=null,sa=null;function kl(){sa=jr=Ai=null}function Cl(t){var i=ia.current;ct(ia),t._currentValue=i}function El(t,i,c){for(;t!==null;){var d=t.alternate;if((t.childLanes&i)!==i?(t.childLanes|=i,d!==null&&(d.childLanes|=i)):d!==null&&(d.childLanes&i)!==i&&(d.childLanes|=i),t===c)break;t=t.return}}function Zs(t,i){Ai=t,sa=jr=null,t=t.dependencies,t!==null&&t.firstContext!==null&&((t.lanes&i)!==0&&(ir=!0),t.firstContext=null)}function rr(t){var i=t._currentValue;if(sa!==t)if(t={context:t,memoizedValue:i,next:null},jr===null){if(Ai===null)throw Error(r(308));jr=t,Ai.dependencies={lanes:0,firstContext:t}}else jr=jr.next=t;return i}var Pi=null;function Ml(t){Pi===null?Pi=[t]:Pi.push(t)}function Rd(t,i,c,d){var m=i.interleaved;return m===null?(c.next=c,Ml(i)):(c.next=m.next,m.next=c),i.interleaved=c,s(t,d)}function s(t,i){t.lanes|=i;var c=t.alternate;for(c!==null&&(c.lanes|=i),c=t,t=t.return;t!==null;)t.childLanes|=i,c=t.alternate,c!==null&&(c.childLanes|=i),c=t,t=t.return;return c.tag===3?c.stateNode:null}var o=!1;function u(t){t.updateQueue={baseState:t.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function p(t,i){t=t.updateQueue,i.updateQueue===t&&(i.updateQueue={baseState:t.baseState,firstBaseUpdate:t.firstBaseUpdate,lastBaseUpdate:t.lastBaseUpdate,shared:t.shared,effects:t.effects})}function _(t,i){return{eventTime:t,lane:i,tag:0,payload:null,callback:null,next:null}}function b(t,i,c){var d=t.updateQueue;if(d===null)return null;if(d=d.shared,(dt&2)!==0){var m=d.pending;return m===null?i.next=i:(i.next=m.next,m.next=i),d.pending=i,s(t,c)}return m=d.interleaved,m===null?(i.next=i,Ml(d)):(i.next=m.next,m.next=i),d.interleaved=i,s(t,c)}function A(t,i,c){if(i=i.updateQueue,i!==null&&(i=i.shared,(c&4194240)!==0)){var d=i.lanes;d&=t.pendingLanes,c|=d,i.lanes=c,St(t,c)}}function U(t,i){var c=t.updateQueue,d=t.alternate;if(d!==null&&(d=d.updateQueue,c===d)){var m=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var T={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};w===null?m=w=T:w=w.next=T,c=c.next}while(c!==null);w===null?m=w=i:w=w.next=i}else m=w=i;c={baseState:d.baseState,firstBaseUpdate:m,lastBaseUpdate:w,shared:d.shared,effects:d.effects},t.updateQueue=c;return}t=c.lastBaseUpdate,t===null?c.firstBaseUpdate=i:t.next=i,c.lastBaseUpdate=i}function X(t,i,c,d){var m=t.updateQueue;o=!1;var w=m.firstBaseUpdate,T=m.lastBaseUpdate,B=m.shared.pending;if(B!==null){m.shared.pending=null;var z=B,re=z.next;z.next=null,T===null?w=re:T.next=re,T=z;var me=t.alternate;me!==null&&(me=me.updateQueue,B=me.lastBaseUpdate,B!==T&&(B===null?me.firstBaseUpdate=re:B.next=re,me.lastBaseUpdate=z))}if(w!==null){var ve=m.baseState;T=0,me=re=z=null,B=w;do{var pe=B.lane,Re=B.eventTime;if((d&pe)===pe){me!==null&&(me=me.next={eventTime:Re,lane:0,tag:B.tag,payload:B.payload,callback:B.callback,next:null});e:{var Pe=t,xe=B;switch(pe=i,Re=c,xe.tag){case 1:if(Pe=xe.payload,typeof Pe=="function"){ve=Pe.call(Re,ve,pe);break e}ve=Pe;break e;case 3:Pe.flags=Pe.flags&-65537|128;case 0:if(Pe=xe.payload,pe=typeof Pe=="function"?Pe.call(Re,ve,pe):Pe,pe==null)break e;ve=oe({},ve,pe);break e;case 2:o=!0}}B.callback!==null&&B.lane!==0&&(t.flags|=64,pe=m.effects,pe===null?m.effects=[B]:pe.push(B))}else Re={eventTime:Re,lane:pe,tag:B.tag,payload:B.payload,callback:B.callback,next:null},me===null?(re=me=Re,z=ve):me=me.next=Re,T|=pe;if(B=B.next,B===null){if(B=m.shared.pending,B===null)break;pe=B,B=pe.next,pe.next=null,m.lastBaseUpdate=pe,m.shared.pending=null}}while(!0);if(me===null&&(z=ve),m.baseState=z,m.firstBaseUpdate=re,m.lastBaseUpdate=me,i=m.shared.interleaved,i!==null){m=i;do T|=m.lane,m=m.next;while(m!==i)}else w===null&&(m.shared.lanes=0);oa|=T,t.lanes=T,t.memoizedState=ve}}function K(t,i,c){if(t=i.effects,i.effects=null,t!==null)for(i=0;i<t.length;i++){var d=t[i],m=d.callback;if(m!==null){if(d.callback=null,d=c,typeof m!="function")throw Error(r(191,m));m.call(d)}}}var de={},ce=Zr(de),be=Zr(de),ue=Zr(de);function Oe(t){if(t===de)throw Error(r(174));return t}function Te(t,i){switch(vt(ue,i),vt(be,t),vt(ce,de),t=i.nodeType,t){case 9:case 11:i=(i=i.documentElement)?i.namespaceURI:Nt(null,"");break;default:t=t===8?i.parentNode:i,i=t.namespaceURI||null,t=t.tagName,i=Nt(i,t)}ct(ce),vt(ce,i)}function Ne(){ct(ce),ct(be),ct(ue)}function lt(t){Oe(ue.current);var i=Oe(ce.current),c=Nt(i,t.type);i!==c&&(vt(be,t),vt(ce,c))}function ft(t){be.current===t&&(ct(ce),ct(be))}var We=Zr(0);function Ge(t){for(var i=t;i!==null;){if(i.tag===13){var c=i.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return i}else if(i.tag===19&&i.memoizedProps.revealOrder!==void 0){if((i.flags&128)!==0)return i}else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return null;i=i.return}i.sibling.return=i.return,i=i.sibling}return null}var fn=[];function $t(){for(var t=0;t<fn.length;t++)fn[t]._workInProgressVersionPrimary=null;fn.length=0}var Ii=P.ReactCurrentDispatcher,xi=P.ReactCurrentBatchConfig,ri=0,xt=null,Yt=null,rn=null,Ad=!1,Ol=!1,Tl=0,AE=0;function On(){throw Error(r(321))}function bp(t,i){if(i===null)return!1;for(var c=0;c<i.length&&c<t.length;c++)if(!gr(t[c],i[c]))return!1;return!0}function Sp(t,i,c,d,m,w){if(ri=w,xt=i,i.memoizedState=null,i.updateQueue=null,i.lanes=0,Ii.current=t===null||t.memoizedState===null?LE:jE,t=c(d,m),Ol){w=0;do{if(Ol=!1,Tl=0,25<=w)throw Error(r(301));w+=1,rn=Yt=null,i.updateQueue=null,Ii.current=NE,t=c(d,m)}while(Ol)}if(Ii.current=xd,i=Yt!==null&&Yt.next!==null,ri=0,rn=Yt=xt=null,Ad=!1,i)throw Error(r(300));return t}function kp(){var t=Tl!==0;return Tl=0,t}function Li(){var t={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rn===null?xt.memoizedState=rn=t:rn=rn.next=t,rn}function Nr(){if(Yt===null){var t=xt.alternate;t=t!==null?t.memoizedState:null}else t=Yt.next;var i=rn===null?xt.memoizedState:rn.next;if(i!==null)rn=i,Yt=t;else{if(t===null)throw Error(r(310));Yt=t,t={memoizedState:Yt.memoizedState,baseState:Yt.baseState,baseQueue:Yt.baseQueue,queue:Yt.queue,next:null},rn===null?xt.memoizedState=rn=t:rn=rn.next=t}return rn}function Rl(t,i){return typeof i=="function"?i(t):i}function Cp(t){var i=Nr(),c=i.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=t;var d=Yt,m=d.baseQueue,w=c.pending;if(w!==null){if(m!==null){var T=m.next;m.next=w.next,w.next=T}d.baseQueue=m=w,c.pending=null}if(m!==null){w=m.next,d=d.baseState;var B=T=null,z=null,re=w;do{var me=re.lane;if((ri&me)===me)z!==null&&(z=z.next={lane:0,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null}),d=re.hasEagerState?re.eagerState:t(d,re.action);else{var ve={lane:me,action:re.action,hasEagerState:re.hasEagerState,eagerState:re.eagerState,next:null};z===null?(B=z=ve,T=d):z=z.next=ve,xt.lanes|=me,oa|=me}re=re.next}while(re!==null&&re!==w);z===null?T=d:z.next=B,gr(d,i.memoizedState)||(ir=!0),i.memoizedState=d,i.baseState=T,i.baseQueue=z,c.lastRenderedState=d}if(t=c.interleaved,t!==null){m=t;do w=m.lane,xt.lanes|=w,oa|=w,m=m.next;while(m!==t)}else m===null&&(c.lanes=0);return[i.memoizedState,c.dispatch]}function Ep(t){var i=Nr(),c=i.queue;if(c===null)throw Error(r(311));c.lastRenderedReducer=t;var d=c.dispatch,m=c.pending,w=i.memoizedState;if(m!==null){c.pending=null;var T=m=m.next;do w=t(w,T.action),T=T.next;while(T!==m);gr(w,i.memoizedState)||(ir=!0),i.memoizedState=w,i.baseQueue===null&&(i.baseState=w),c.lastRenderedState=w}return[w,d]}function b_(){}function S_(t,i){var c=xt,d=Nr(),m=i(),w=!gr(d.memoizedState,m);if(w&&(d.memoizedState=m,ir=!0),d=d.queue,Mp(E_.bind(null,c,d,t),[t]),d.getSnapshot!==i||w||rn!==null&&rn.memoizedState.tag&1){if(c.flags|=2048,Al(9,C_.bind(null,c,d,m,i),void 0,null),sn===null)throw Error(r(349));(ri&30)!==0||k_(c,i,m)}return m}function k_(t,i,c){t.flags|=16384,t={getSnapshot:i,value:c},i=xt.updateQueue,i===null?(i={lastEffect:null,stores:null},xt.updateQueue=i,i.stores=[t]):(c=i.stores,c===null?i.stores=[t]:c.push(t))}function C_(t,i,c,d){i.value=c,i.getSnapshot=d,M_(i)&&O_(t)}function E_(t,i,c){return c(function(){M_(i)&&O_(t)})}function M_(t){var i=t.getSnapshot;t=t.value;try{var c=i();return!gr(t,c)}catch{return!0}}function O_(t){var i=s(t,1);i!==null&&ai(i,t,1,-1)}function T_(t){var i=Li();return typeof t=="function"&&(t=t()),i.memoizedState=i.baseState=t,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Rl,lastRenderedState:t},i.queue=t,t=t.dispatch=xE.bind(null,xt,t),[i.memoizedState,t]}function Al(t,i,c,d){return t={tag:t,create:i,destroy:c,deps:d,next:null},i=xt.updateQueue,i===null?(i={lastEffect:null,stores:null},xt.updateQueue=i,i.lastEffect=t.next=t):(c=i.lastEffect,c===null?i.lastEffect=t.next=t:(d=c.next,c.next=t,t.next=d,i.lastEffect=t)),t}function R_(){return Nr().memoizedState}function Pd(t,i,c,d){var m=Li();xt.flags|=t,m.memoizedState=Al(1|i,c,void 0,d===void 0?null:d)}function Id(t,i,c,d){var m=Nr();d=d===void 0?null:d;var w=void 0;if(Yt!==null){var T=Yt.memoizedState;if(w=T.destroy,d!==null&&bp(d,T.deps)){m.memoizedState=Al(i,c,w,d);return}}xt.flags|=t,m.memoizedState=Al(1|i,c,w,d)}function A_(t,i){return Pd(8390656,8,t,i)}function Mp(t,i){return Id(2048,8,t,i)}function P_(t,i){return Id(4,2,t,i)}function I_(t,i){return Id(4,4,t,i)}function x_(t,i){if(typeof i=="function")return t=t(),i(t),function(){i(null)};if(i!=null)return t=t(),i.current=t,function(){i.current=null}}function L_(t,i,c){return c=c!=null?c.concat([t]):null,Id(4,4,x_.bind(null,i,t),c)}function Op(){}function j_(t,i){var c=Nr();i=i===void 0?null:i;var d=c.memoizedState;return d!==null&&i!==null&&bp(i,d[1])?d[0]:(c.memoizedState=[t,i],t)}function N_(t,i){var c=Nr();i=i===void 0?null:i;var d=c.memoizedState;return d!==null&&i!==null&&bp(i,d[1])?d[0]:(t=t(),c.memoizedState=[t,i],t)}function D_(t,i,c){return(ri&21)===0?(t.baseState&&(t.baseState=!1,ir=!0),t.memoizedState=c):(gr(c,i)||(c=Ts(),xt.lanes|=c,oa|=c,t.baseState=!0),i)}function PE(t,i){var c=_e;_e=c!==0&&4>c?c:4,t(!0);var d=xi.transition;xi.transition={};try{t(!1),i()}finally{_e=c,xi.transition=d}}function U_(){return Nr().memoizedState}function IE(t,i,c){var d=ro(t);if(c={lane:d,action:c,hasEagerState:!1,eagerState:null,next:null},B_(t))F_(i,c);else if(c=Rd(t,i,c,d),c!==null){var m=Gn();ai(c,t,d,m),V_(c,i,d)}}function xE(t,i,c){var d=ro(t),m={lane:d,action:c,hasEagerState:!1,eagerState:null,next:null};if(B_(t))F_(i,m);else{var w=t.alternate;if(t.lanes===0&&(w===null||w.lanes===0)&&(w=i.lastRenderedReducer,w!==null))try{var T=i.lastRenderedState,B=w(T,c);if(m.hasEagerState=!0,m.eagerState=B,gr(B,T)){var z=i.interleaved;z===null?(m.next=m,Ml(i)):(m.next=z.next,z.next=m),i.interleaved=m;return}}catch{}finally{}c=Rd(t,i,m,d),c!==null&&(m=Gn(),ai(c,t,d,m),V_(c,i,d))}}function B_(t){var i=t.alternate;return t===xt||i!==null&&i===xt}function F_(t,i){Ol=Ad=!0;var c=t.pending;c===null?i.next=i:(i.next=c.next,c.next=i),t.pending=i}function V_(t,i,c){if((c&4194240)!==0){var d=i.lanes;d&=t.pendingLanes,c|=d,i.lanes=c,St(t,c)}}var xd={readContext:rr,useCallback:On,useContext:On,useEffect:On,useImperativeHandle:On,useInsertionEffect:On,useLayoutEffect:On,useMemo:On,useReducer:On,useRef:On,useState:On,useDebugValue:On,useDeferredValue:On,useTransition:On,useMutableSource:On,useSyncExternalStore:On,useId:On,unstable_isNewReconciler:!1},LE={readContext:rr,useCallback:function(t,i){return Li().memoizedState=[t,i===void 0?null:i],t},useContext:rr,useEffect:A_,useImperativeHandle:function(t,i,c){return c=c!=null?c.concat([t]):null,Pd(4194308,4,x_.bind(null,i,t),c)},useLayoutEffect:function(t,i){return Pd(4194308,4,t,i)},useInsertionEffect:function(t,i){return Pd(4,2,t,i)},useMemo:function(t,i){var c=Li();return i=i===void 0?null:i,t=t(),c.memoizedState=[t,i],t},useReducer:function(t,i,c){var d=Li();return i=c!==void 0?c(i):i,d.memoizedState=d.baseState=i,t={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:t,lastRenderedState:i},d.queue=t,t=t.dispatch=IE.bind(null,xt,t),[d.memoizedState,t]},useRef:function(t){var i=Li();return t={current:t},i.memoizedState=t},useState:T_,useDebugValue:Op,useDeferredValue:function(t){return Li().memoizedState=t},useTransition:function(){var t=T_(!1),i=t[0];return t=PE.bind(null,t[1]),Li().memoizedState=t,[i,t]},useMutableSource:function(){},useSyncExternalStore:function(t,i,c){var d=xt,m=Li();if(Mt){if(c===void 0)throw Error(r(407));c=c()}else{if(c=i(),sn===null)throw Error(r(349));(ri&30)!==0||k_(d,i,c)}m.memoizedState=c;var w={value:c,getSnapshot:i};return m.queue=w,A_(E_.bind(null,d,w,t),[t]),d.flags|=2048,Al(9,C_.bind(null,d,w,c,i),void 0,null),c},useId:function(){var t=Li(),i=sn.identifierPrefix;if(Mt){var c=ni,d=ti;c=(d&~(1<<32-Dn(d)-1)).toString(32)+c,i=":"+i+"R"+c,c=Tl++,0<c&&(i+="H"+c.toString(32)),i+=":"}else c=AE++,i=":"+i+"r"+c.toString(32)+":";return t.memoizedState=i},unstable_isNewReconciler:!1},jE={readContext:rr,useCallback:j_,useContext:rr,useEffect:Mp,useImperativeHandle:L_,useInsertionEffect:P_,useLayoutEffect:I_,useMemo:N_,useReducer:Cp,useRef:R_,useState:function(){return Cp(Rl)},useDebugValue:Op,useDeferredValue:function(t){var i=Nr();return D_(i,Yt.memoizedState,t)},useTransition:function(){var t=Cp(Rl)[0],i=Nr().memoizedState;return[t,i]},useMutableSource:b_,useSyncExternalStore:S_,useId:U_,unstable_isNewReconciler:!1},NE={readContext:rr,useCallback:j_,useContext:rr,useEffect:Mp,useImperativeHandle:L_,useInsertionEffect:P_,useLayoutEffect:I_,useMemo:N_,useReducer:Ep,useRef:R_,useState:function(){return Ep(Rl)},useDebugValue:Op,useDeferredValue:function(t){var i=Nr();return Yt===null?i.memoizedState=t:D_(i,Yt.memoizedState,t)},useTransition:function(){var t=Ep(Rl)[0],i=Nr().memoizedState;return[t,i]},useMutableSource:b_,useSyncExternalStore:S_,useId:U_,unstable_isNewReconciler:!1};function ii(t,i){if(t&&t.defaultProps){i=oe({},i),t=t.defaultProps;for(var c in t)i[c]===void 0&&(i[c]=t[c]);return i}return i}function Tp(t,i,c,d){i=t.memoizedState,c=c(d,i),c=c==null?i:oe({},i,c),t.memoizedState=c,t.lanes===0&&(t.updateQueue.baseState=c)}var Ld={isMounted:function(t){return(t=t._reactInternals)?Tr(t)===t:!1},enqueueSetState:function(t,i,c){t=t._reactInternals;var d=Gn(),m=ro(t),w=_(d,m);w.payload=i,c!=null&&(w.callback=c),i=b(t,w,m),i!==null&&(ai(i,t,m,d),A(i,t,m))},enqueueReplaceState:function(t,i,c){t=t._reactInternals;var d=Gn(),m=ro(t),w=_(d,m);w.tag=1,w.payload=i,c!=null&&(w.callback=c),i=b(t,w,m),i!==null&&(ai(i,t,m,d),A(i,t,m))},enqueueForceUpdate:function(t,i){t=t._reactInternals;var c=Gn(),d=ro(t),m=_(c,d);m.tag=2,i!=null&&(m.callback=i),i=b(t,m,d),i!==null&&(ai(i,t,d,c),A(i,t,d))}};function z_(t,i,c,d,m,w,T){return t=t.stateNode,typeof t.shouldComponentUpdate=="function"?t.shouldComponentUpdate(d,w,T):i.prototype&&i.prototype.isPureReactComponent?!Jo(c,d)||!Jo(m,w):!0}function q_(t,i,c){var d=!1,m=Zn,w=i.contextType;return typeof w=="object"&&w!==null?w=rr(w):(m=Mn(i)?er:Kt.current,d=i.contextTypes,w=(d=d!=null)?vr(t,m):Zn),i=new i(c,w),t.memoizedState=i.state!==null&&i.state!==void 0?i.state:null,i.updater=Ld,t.stateNode=i,i._reactInternals=t,d&&(t=t.stateNode,t.__reactInternalMemoizedUnmaskedChildContext=m,t.__reactInternalMemoizedMaskedChildContext=w),i}function $_(t,i,c,d){t=i.state,typeof i.componentWillReceiveProps=="function"&&i.componentWillReceiveProps(c,d),typeof i.UNSAFE_componentWillReceiveProps=="function"&&i.UNSAFE_componentWillReceiveProps(c,d),i.state!==t&&Ld.enqueueReplaceState(i,i.state,null)}function Rp(t,i,c,d){var m=t.stateNode;m.props=c,m.state=t.memoizedState,m.refs={},u(t);var w=i.contextType;typeof w=="object"&&w!==null?m.context=rr(w):(w=Mn(i)?er:Kt.current,m.context=vr(t,w)),m.state=t.memoizedState,w=i.getDerivedStateFromProps,typeof w=="function"&&(Tp(t,i,w,c),m.state=t.memoizedState),typeof i.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(i=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),i!==m.state&&Ld.enqueueReplaceState(m,m.state,null),X(t,c,m,d),m.state=t.memoizedState),typeof m.componentDidMount=="function"&&(t.flags|=4194308)}function oc(t,i){try{var c="",d=i;do c+=C(d),d=d.return;while(d);var m=c}catch(w){m=`
Error generating stack: `+w.message+`
`+w.stack}return{value:t,source:i,stack:m,digest:null}}function Ap(t,i,c){return{value:t,source:null,stack:c??null,digest:i??null}}function Pp(t,i){try{console.error(i.value)}catch(c){setTimeout(function(){throw c})}}var DE=typeof WeakMap=="function"?WeakMap:Map;function W_(t,i,c){c=_(-1,c),c.tag=3,c.payload={element:null};var d=i.value;return c.callback=function(){Vd||(Vd=!0,Gp=d),Pp(t,i)},c}function G_(t,i,c){c=_(-1,c),c.tag=3;var d=t.type.getDerivedStateFromError;if(typeof d=="function"){var m=i.value;c.payload=function(){return d(m)},c.callback=function(){Pp(t,i)}}var w=t.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(c.callback=function(){Pp(t,i),typeof d!="function"&&(to===null?to=new Set([this]):to.add(this));var T=i.stack;this.componentDidCatch(i.value,{componentStack:T!==null?T:""})}),c}function H_(t,i,c){var d=t.pingCache;if(d===null){d=t.pingCache=new DE;var m=new Set;d.set(i,m)}else m=d.get(i),m===void 0&&(m=new Set,d.set(i,m));m.has(c)||(m.add(c),t=YE.bind(null,t,i,c),i.then(t,t))}function J_(t){do{var i;if((i=t.tag===13)&&(i=t.memoizedState,i=i!==null?i.dehydrated!==null:!0),i)return t;t=t.return}while(t!==null);return null}function Q_(t,i,c,d,m){return(t.mode&1)===0?(t===i?t.flags|=65536:(t.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(i=_(-1,1),i.tag=2,b(c,i,1))),c.lanes|=1),t):(t.flags|=65536,t.lanes=m,t)}var UE=P.ReactCurrentOwner,ir=!1;function Wn(t,i,c,d){i.child=t===null?Td(i,null,c,d):Xs(i,t.child,c,d)}function K_(t,i,c,d,m){c=c.render;var w=i.ref;return Zs(i,m),d=Sp(t,i,c,d,w,m),c=kp(),t!==null&&!ir?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~m,os(t,i,m)):(Mt&&c&&nc(i),i.flags|=1,Wn(t,i,d,m),i.child)}function Y_(t,i,c,d,m){if(t===null){var w=c.type;return typeof w=="function"&&!Zp(w)&&w.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(i.tag=15,i.type=w,X_(t,i,w,d,m)):(t=Hd(c.type,null,d,i,i.mode,m),t.ref=i.ref,t.return=i,i.child=t)}if(w=t.child,(t.lanes&m)===0){var T=w.memoizedProps;if(c=c.compare,c=c!==null?c:Jo,c(T,d)&&t.ref===i.ref)return os(t,i,m)}return i.flags|=1,t=so(w,d),t.ref=i.ref,t.return=i,i.child=t}function X_(t,i,c,d,m){if(t!==null){var w=t.memoizedProps;if(Jo(w,d)&&t.ref===i.ref)if(ir=!1,i.pendingProps=d=w,(t.lanes&m)!==0)(t.flags&131072)!==0&&(ir=!0);else return i.lanes=t.lanes,os(t,i,m)}return Ip(t,i,c,d,m)}function Z_(t,i,c){var d=i.pendingProps,m=d.children,w=t!==null?t.memoizedState:null;if(d.mode==="hidden")if((i.mode&1)===0)i.memoizedState={baseLanes:0,cachePool:null,transitions:null},vt(cc,_r),_r|=c;else{if((c&1073741824)===0)return t=w!==null?w.baseLanes|c:c,i.lanes=i.childLanes=1073741824,i.memoizedState={baseLanes:t,cachePool:null,transitions:null},i.updateQueue=null,vt(cc,_r),_r|=t,null;i.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=w!==null?w.baseLanes:c,vt(cc,_r),_r|=d}else w!==null?(d=w.baseLanes|c,i.memoizedState=null):d=c,vt(cc,_r),_r|=d;return Wn(t,i,m,c),i.child}function e0(t,i){var c=i.ref;(t===null&&c!==null||t!==null&&t.ref!==c)&&(i.flags|=512,i.flags|=2097152)}function Ip(t,i,c,d,m){var w=Mn(c)?er:Kt.current;return w=vr(i,w),Zs(i,m),c=Sp(t,i,c,d,w,m),d=kp(),t!==null&&!ir?(i.updateQueue=t.updateQueue,i.flags&=-2053,t.lanes&=~m,os(t,i,m)):(Mt&&d&&nc(i),i.flags|=1,Wn(t,i,c,m),i.child)}function t0(t,i,c,d,m){if(Mn(c)){var w=!0;Xa(i)}else w=!1;if(Zs(i,m),i.stateNode===null)Nd(t,i),q_(i,c,d),Rp(i,c,d,m),d=!0;else if(t===null){var T=i.stateNode,B=i.memoizedProps;T.props=B;var z=T.context,re=c.contextType;typeof re=="object"&&re!==null?re=rr(re):(re=Mn(c)?er:Kt.current,re=vr(i,re));var me=c.getDerivedStateFromProps,ve=typeof me=="function"||typeof T.getSnapshotBeforeUpdate=="function";ve||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(B!==d||z!==re)&&$_(i,T,d,re),o=!1;var pe=i.memoizedState;T.state=pe,X(i,d,T,m),z=i.memoizedState,B!==d||pe!==z||dn.current||o?(typeof me=="function"&&(Tp(i,c,me,d),z=i.memoizedState),(B=o||z_(i,c,B,d,pe,z,re))?(ve||typeof T.UNSAFE_componentWillMount!="function"&&typeof T.componentWillMount!="function"||(typeof T.componentWillMount=="function"&&T.componentWillMount(),typeof T.UNSAFE_componentWillMount=="function"&&T.UNSAFE_componentWillMount()),typeof T.componentDidMount=="function"&&(i.flags|=4194308)):(typeof T.componentDidMount=="function"&&(i.flags|=4194308),i.memoizedProps=d,i.memoizedState=z),T.props=d,T.state=z,T.context=re,d=B):(typeof T.componentDidMount=="function"&&(i.flags|=4194308),d=!1)}else{T=i.stateNode,p(t,i),B=i.memoizedProps,re=i.type===i.elementType?B:ii(i.type,B),T.props=re,ve=i.pendingProps,pe=T.context,z=c.contextType,typeof z=="object"&&z!==null?z=rr(z):(z=Mn(c)?er:Kt.current,z=vr(i,z));var Re=c.getDerivedStateFromProps;(me=typeof Re=="function"||typeof T.getSnapshotBeforeUpdate=="function")||typeof T.UNSAFE_componentWillReceiveProps!="function"&&typeof T.componentWillReceiveProps!="function"||(B!==ve||pe!==z)&&$_(i,T,d,z),o=!1,pe=i.memoizedState,T.state=pe,X(i,d,T,m);var Pe=i.memoizedState;B!==ve||pe!==Pe||dn.current||o?(typeof Re=="function"&&(Tp(i,c,Re,d),Pe=i.memoizedState),(re=o||z_(i,c,re,d,pe,Pe,z)||!1)?(me||typeof T.UNSAFE_componentWillUpdate!="function"&&typeof T.componentWillUpdate!="function"||(typeof T.componentWillUpdate=="function"&&T.componentWillUpdate(d,Pe,z),typeof T.UNSAFE_componentWillUpdate=="function"&&T.UNSAFE_componentWillUpdate(d,Pe,z)),typeof T.componentDidUpdate=="function"&&(i.flags|=4),typeof T.getSnapshotBeforeUpdate=="function"&&(i.flags|=1024)):(typeof T.componentDidUpdate!="function"||B===t.memoizedProps&&pe===t.memoizedState||(i.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||B===t.memoizedProps&&pe===t.memoizedState||(i.flags|=1024),i.memoizedProps=d,i.memoizedState=Pe),T.props=d,T.state=Pe,T.context=z,d=re):(typeof T.componentDidUpdate!="function"||B===t.memoizedProps&&pe===t.memoizedState||(i.flags|=4),typeof T.getSnapshotBeforeUpdate!="function"||B===t.memoizedProps&&pe===t.memoizedState||(i.flags|=1024),d=!1)}return xp(t,i,c,d,w,m)}function xp(t,i,c,d,m,w){e0(t,i);var T=(i.flags&128)!==0;if(!d&&!T)return m&&bd(i,c,!1),os(t,i,w);d=i.stateNode,UE.current=i;var B=T&&typeof c.getDerivedStateFromError!="function"?null:d.render();return i.flags|=1,t!==null&&T?(i.child=Xs(i,t.child,null,w),i.child=Xs(i,null,B,w)):Wn(t,i,B,w),i.memoizedState=d.state,m&&bd(i,c,!0),i.child}function n0(t){var i=t.stateNode;i.pendingContext?It(t,i.pendingContext,i.pendingContext!==i.context):i.context&&It(t,i.context,!1),Te(t,i.containerInfo)}function r0(t,i,c,d,m){return Ys(),na(m),i.flags|=256,Wn(t,i,c,d),i.child}var Lp={dehydrated:null,treeContext:null,retryLane:0};function jp(t){return{baseLanes:t,cachePool:null,transitions:null}}function i0(t,i,c){var d=i.pendingProps,m=We.current,w=!1,T=(i.flags&128)!==0,B;if((B=T)||(B=t!==null&&t.memoizedState===null?!1:(m&2)!==0),B?(w=!0,i.flags&=-129):(t===null||t.memoizedState!==null)&&(m|=1),vt(We,m&1),t===null)return Sl(i),t=i.memoizedState,t!==null&&(t=t.dehydrated,t!==null)?((i.mode&1)===0?i.lanes=1:t.data==="$!"?i.lanes=8:i.lanes=1073741824,null):(T=d.children,t=d.fallback,w?(d=i.mode,w=i.child,T={mode:"hidden",children:T},(d&1)===0&&w!==null?(w.childLanes=0,w.pendingProps=T):w=Jd(T,d,0,null),t=ua(t,d,c,null),w.return=i,t.return=i,w.sibling=t,i.child=w,i.child.memoizedState=jp(c),i.memoizedState=Lp,t):Np(i,T));if(m=t.memoizedState,m!==null&&(B=m.dehydrated,B!==null))return BE(t,i,T,d,B,m,c);if(w){w=d.fallback,T=i.mode,m=t.child,B=m.sibling;var z={mode:"hidden",children:d.children};return(T&1)===0&&i.child!==m?(d=i.child,d.childLanes=0,d.pendingProps=z,i.deletions=null):(d=so(m,z),d.subtreeFlags=m.subtreeFlags&14680064),B!==null?w=so(B,w):(w=ua(w,T,c,null),w.flags|=2),w.return=i,d.return=i,d.sibling=w,i.child=d,d=w,w=i.child,T=t.child.memoizedState,T=T===null?jp(c):{baseLanes:T.baseLanes|c,cachePool:null,transitions:T.transitions},w.memoizedState=T,w.childLanes=t.childLanes&~c,i.memoizedState=Lp,d}return w=t.child,t=w.sibling,d=so(w,{mode:"visible",children:d.children}),(i.mode&1)===0&&(d.lanes=c),d.return=i,d.sibling=null,t!==null&&(c=i.deletions,c===null?(i.deletions=[t],i.flags|=16):c.push(t)),i.child=d,i.memoizedState=null,d}function Np(t,i){return i=Jd({mode:"visible",children:i},t.mode,0,null),i.return=t,t.child=i}function jd(t,i,c,d){return d!==null&&na(d),Xs(i,t.child,null,c),t=Np(i,i.pendingProps.children),t.flags|=2,i.memoizedState=null,t}function BE(t,i,c,d,m,w,T){if(c)return i.flags&256?(i.flags&=-257,d=Ap(Error(r(422))),jd(t,i,T,d)):i.memoizedState!==null?(i.child=t.child,i.flags|=128,null):(w=d.fallback,m=i.mode,d=Jd({mode:"visible",children:d.children},m,0,null),w=ua(w,m,T,null),w.flags|=2,d.return=i,w.return=i,d.sibling=w,i.child=d,(i.mode&1)!==0&&Xs(i,t.child,null,T),i.child.memoizedState=jp(T),i.memoizedState=Lp,w);if((i.mode&1)===0)return jd(t,i,T,null);if(m.data==="$!"){if(d=m.nextSibling&&m.nextSibling.dataset,d)var B=d.dgst;return d=B,w=Error(r(419)),d=Ap(w,d,void 0),jd(t,i,T,d)}if(B=(T&t.childLanes)!==0,ir||B){if(d=sn,d!==null){switch(T&-T){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=(m&(d.suspendedLanes|T))!==0?0:m,m!==0&&m!==w.retryLane&&(w.retryLane=m,s(t,m),ai(d,t,m,-1))}return Xp(),d=Ap(Error(r(421))),jd(t,i,T,d)}return m.data==="$?"?(i.flags|=128,i.child=t.child,i=XE.bind(null,t),m._reactRetry=i,null):(t=w.treeContext,$n=Yr(m.nextSibling),qn=i,Mt=!0,yr=null,t!==null&&(tr[nr++]=ti,tr[nr++]=ni,tr[nr++]=Ri,ti=t.id,ni=t.overflow,Ri=i),i=Np(i,d.children),i.flags|=4096,i)}function s0(t,i,c){t.lanes|=i;var d=t.alternate;d!==null&&(d.lanes|=i),El(t.return,i,c)}function Dp(t,i,c,d,m){var w=t.memoizedState;w===null?t.memoizedState={isBackwards:i,rendering:null,renderingStartTime:0,last:d,tail:c,tailMode:m}:(w.isBackwards=i,w.rendering=null,w.renderingStartTime=0,w.last=d,w.tail=c,w.tailMode=m)}function o0(t,i,c){var d=i.pendingProps,m=d.revealOrder,w=d.tail;if(Wn(t,i,d.children,c),d=We.current,(d&2)!==0)d=d&1|2,i.flags|=128;else{if(t!==null&&(t.flags&128)!==0)e:for(t=i.child;t!==null;){if(t.tag===13)t.memoizedState!==null&&s0(t,c,i);else if(t.tag===19)s0(t,c,i);else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===i)break e;for(;t.sibling===null;){if(t.return===null||t.return===i)break e;t=t.return}t.sibling.return=t.return,t=t.sibling}d&=1}if(vt(We,d),(i.mode&1)===0)i.memoizedState=null;else switch(m){case"forwards":for(c=i.child,m=null;c!==null;)t=c.alternate,t!==null&&Ge(t)===null&&(m=c),c=c.sibling;c=m,c===null?(m=i.child,i.child=null):(m=c.sibling,c.sibling=null),Dp(i,!1,m,c,w);break;case"backwards":for(c=null,m=i.child,i.child=null;m!==null;){if(t=m.alternate,t!==null&&Ge(t)===null){i.child=m;break}t=m.sibling,m.sibling=c,c=m,m=t}Dp(i,!0,c,null,w);break;case"together":Dp(i,!1,null,null,void 0);break;default:i.memoizedState=null}return i.child}function Nd(t,i){(i.mode&1)===0&&t!==null&&(t.alternate=null,i.alternate=null,i.flags|=2)}function os(t,i,c){if(t!==null&&(i.dependencies=t.dependencies),oa|=i.lanes,(c&i.childLanes)===0)return null;if(t!==null&&i.child!==t.child)throw Error(r(153));if(i.child!==null){for(t=i.child,c=so(t,t.pendingProps),i.child=c,c.return=i;t.sibling!==null;)t=t.sibling,c=c.sibling=so(t,t.pendingProps),c.return=i;c.sibling=null}return i.child}function FE(t,i,c){switch(i.tag){case 3:n0(i),Ys();break;case 5:lt(i);break;case 1:Mn(i.type)&&Xa(i);break;case 4:Te(i,i.stateNode.containerInfo);break;case 10:var d=i.type._context,m=i.memoizedProps.value;vt(ia,d._currentValue),d._currentValue=m;break;case 13:if(d=i.memoizedState,d!==null)return d.dehydrated!==null?(vt(We,We.current&1),i.flags|=128,null):(c&i.child.childLanes)!==0?i0(t,i,c):(vt(We,We.current&1),t=os(t,i,c),t!==null?t.sibling:null);vt(We,We.current&1);break;case 19:if(d=(c&i.childLanes)!==0,(t.flags&128)!==0){if(d)return o0(t,i,c);i.flags|=128}if(m=i.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),vt(We,We.current),d)break;return null;case 22:case 23:return i.lanes=0,Z_(t,i,c)}return os(t,i,c)}var a0,Up,c0,l0;a0=function(t,i){for(var c=i.child;c!==null;){if(c.tag===5||c.tag===6)t.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===i)break;for(;c.sibling===null;){if(c.return===null||c.return===i)return;c=c.return}c.sibling.return=c.return,c=c.sibling}},Up=function(){},c0=function(t,i,c,d){var m=t.memoizedProps;if(m!==d){t=i.stateNode,Oe(ce.current);var w=null;switch(c){case"input":m=Vt(t,m),d=Vt(t,d),w=[];break;case"select":m=oe({},m,{value:void 0}),d=oe({},d,{value:void 0}),w=[];break;case"textarea":m=Ln(t,m),d=Ln(t,d),w=[];break;default:typeof m.onClick!="function"&&typeof d.onClick=="function"&&(t.onclick=Ga)}ws(c,d);var T;c=null;for(re in m)if(!d.hasOwnProperty(re)&&m.hasOwnProperty(re)&&m[re]!=null)if(re==="style"){var B=m[re];for(T in B)B.hasOwnProperty(T)&&(c||(c={}),c[T]="")}else re!=="dangerouslySetInnerHTML"&&re!=="children"&&re!=="suppressContentEditableWarning"&&re!=="suppressHydrationWarning"&&re!=="autoFocus"&&(l.hasOwnProperty(re)?w||(w=[]):(w=w||[]).push(re,null));for(re in d){var z=d[re];if(B=m?.[re],d.hasOwnProperty(re)&&z!==B&&(z!=null||B!=null))if(re==="style")if(B){for(T in B)!B.hasOwnProperty(T)||z&&z.hasOwnProperty(T)||(c||(c={}),c[T]="");for(T in z)z.hasOwnProperty(T)&&B[T]!==z[T]&&(c||(c={}),c[T]=z[T])}else c||(w||(w=[]),w.push(re,c)),c=z;else re==="dangerouslySetInnerHTML"?(z=z?z.__html:void 0,B=B?B.__html:void 0,z!=null&&B!==z&&(w=w||[]).push(re,z)):re==="children"?typeof z!="string"&&typeof z!="number"||(w=w||[]).push(re,""+z):re!=="suppressContentEditableWarning"&&re!=="suppressHydrationWarning"&&(l.hasOwnProperty(re)?(z!=null&&re==="onScroll"&&kt("scroll",t),w||B===z||(w=[])):(w=w||[]).push(re,z))}c&&(w=w||[]).push("style",c);var re=w;(i.updateQueue=re)&&(i.flags|=4)}},l0=function(t,i,c,d){c!==d&&(i.flags|=4)};function Pl(t,i){if(!Mt)switch(t.tailMode){case"hidden":i=t.tail;for(var c=null;i!==null;)i.alternate!==null&&(c=i),i=i.sibling;c===null?t.tail=null:c.sibling=null;break;case"collapsed":c=t.tail;for(var d=null;c!==null;)c.alternate!==null&&(d=c),c=c.sibling;d===null?i||t.tail===null?t.tail=null:t.tail.sibling=null:d.sibling=null}}function Tn(t){var i=t.alternate!==null&&t.alternate.child===t.child,c=0,d=0;if(i)for(var m=t.child;m!==null;)c|=m.lanes|m.childLanes,d|=m.subtreeFlags&14680064,d|=m.flags&14680064,m.return=t,m=m.sibling;else for(m=t.child;m!==null;)c|=m.lanes|m.childLanes,d|=m.subtreeFlags,d|=m.flags,m.return=t,m=m.sibling;return t.subtreeFlags|=d,t.childLanes=c,i}function VE(t,i,c){var d=i.pendingProps;switch(rc(i),i.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Tn(i),null;case 1:return Mn(i.type)&&ea(),Tn(i),null;case 3:return d=i.stateNode,Ne(),ct(dn),ct(Kt),$t(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(t===null||t.child===null)&&(ta(i)?i.flags|=4:t===null||t.memoizedState.isDehydrated&&(i.flags&256)===0||(i.flags|=1024,yr!==null&&(Qp(yr),yr=null))),Up(t,i),Tn(i),null;case 5:ft(i);var m=Oe(ue.current);if(c=i.type,t!==null&&i.stateNode!=null)c0(t,i,c,d,m),t.ref!==i.ref&&(i.flags|=512,i.flags|=2097152);else{if(!d){if(i.stateNode===null)throw Error(r(166));return Tn(i),null}if(t=Oe(ce.current),ta(i)){d=i.stateNode,c=i.type;var w=i.memoizedProps;switch(d[En]=i,d[Xr]=w,t=(i.mode&1)!==0,c){case"dialog":kt("cancel",d),kt("close",d);break;case"iframe":case"object":case"embed":kt("load",d);break;case"video":case"audio":for(m=0;m<rs.length;m++)kt(rs[m],d);break;case"source":kt("error",d);break;case"img":case"image":case"link":kt("error",d),kt("load",d);break;case"details":kt("toggle",d);break;case"input":wn(d,w),kt("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!w.multiple},kt("invalid",d);break;case"textarea":Jn(d,w),kt("invalid",d)}ws(c,w),m=null;for(var T in w)if(w.hasOwnProperty(T)){var B=w[T];T==="children"?typeof B=="string"?d.textContent!==B&&(w.suppressHydrationWarning!==!0&&Wa(d.textContent,B,t),m=["children",B]):typeof B=="number"&&d.textContent!==""+B&&(w.suppressHydrationWarning!==!0&&Wa(d.textContent,B,t),m=["children",""+B]):l.hasOwnProperty(T)&&B!=null&&T==="onScroll"&&kt("scroll",d)}switch(c){case"input":Me(d),At(d,w,!0);break;case"textarea":Me(d),Mr(d);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(d.onclick=Ga)}d=m,i.updateQueue=d,d!==null&&(i.flags|=4)}else{T=m.nodeType===9?m:m.ownerDocument,t==="http://www.w3.org/1999/xhtml"&&(t=qi(c)),t==="http://www.w3.org/1999/xhtml"?c==="script"?(t=T.createElement("div"),t.innerHTML="<script><\/script>",t=t.removeChild(t.firstChild)):typeof d.is=="string"?t=T.createElement(c,{is:d.is}):(t=T.createElement(c),c==="select"&&(T=t,d.multiple?T.multiple=!0:d.size&&(T.size=d.size))):t=T.createElementNS(t,c),t[En]=i,t[Xr]=d,a0(t,i,!1,!1),i.stateNode=t;e:{switch(T=pi(c,d),c){case"dialog":kt("cancel",t),kt("close",t),m=d;break;case"iframe":case"object":case"embed":kt("load",t),m=d;break;case"video":case"audio":for(m=0;m<rs.length;m++)kt(rs[m],t);m=d;break;case"source":kt("error",t),m=d;break;case"img":case"image":case"link":kt("error",t),kt("load",t),m=d;break;case"details":kt("toggle",t),m=d;break;case"input":wn(t,d),m=Vt(t,d),kt("invalid",t);break;case"option":m=d;break;case"select":t._wrapperState={wasMultiple:!!d.multiple},m=oe({},d,{value:void 0}),kt("invalid",t);break;case"textarea":Jn(t,d),m=Ln(t,d),kt("invalid",t);break;default:m=d}ws(c,m),B=m;for(w in B)if(B.hasOwnProperty(w)){var z=B[w];w==="style"?$i(t,z):w==="dangerouslySetInnerHTML"?(z=z?z.__html:void 0,z!=null&&cn(t,z)):w==="children"?typeof z=="string"?(c!=="textarea"||z!=="")&&Wr(t,z):typeof z=="number"&&Wr(t,""+z):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(l.hasOwnProperty(w)?z!=null&&w==="onScroll"&&kt("scroll",t):z!=null&&ee(t,w,z,T))}switch(c){case"input":Me(t),At(t,d,!1);break;case"textarea":Me(t),Mr(t);break;case"option":d.value!=null&&t.setAttribute("value",""+H(d.value));break;case"select":t.multiple=!!d.multiple,w=d.value,w!=null?Ze(t,!!d.multiple,w,!1):d.defaultValue!=null&&Ze(t,!!d.multiple,d.defaultValue,!0);break;default:typeof m.onClick=="function"&&(t.onclick=Ga)}switch(c){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(i.flags|=4)}i.ref!==null&&(i.flags|=512,i.flags|=2097152)}return Tn(i),null;case 6:if(t&&i.stateNode!=null)l0(t,i,t.memoizedProps,d);else{if(typeof d!="string"&&i.stateNode===null)throw Error(r(166));if(c=Oe(ue.current),Oe(ce.current),ta(i)){if(d=i.stateNode,c=i.memoizedProps,d[En]=i,(w=d.nodeValue!==c)&&(t=qn,t!==null))switch(t.tag){case 3:Wa(d.nodeValue,c,(t.mode&1)!==0);break;case 5:t.memoizedProps.suppressHydrationWarning!==!0&&Wa(d.nodeValue,c,(t.mode&1)!==0)}w&&(i.flags|=4)}else d=(c.nodeType===9?c:c.ownerDocument).createTextNode(d),d[En]=i,i.stateNode=d}return Tn(i),null;case 13:if(ct(We),d=i.memoizedState,t===null||t.memoizedState!==null&&t.memoizedState.dehydrated!==null){if(Mt&&$n!==null&&(i.mode&1)!==0&&(i.flags&128)===0)ic(),Ys(),i.flags|=98560,w=!1;else if(w=ta(i),d!==null&&d.dehydrated!==null){if(t===null){if(!w)throw Error(r(318));if(w=i.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error(r(317));w[En]=i}else Ys(),(i.flags&128)===0&&(i.memoizedState=null),i.flags|=4;Tn(i),w=!1}else yr!==null&&(Qp(yr),yr=null),w=!0;if(!w)return i.flags&65536?i:null}return(i.flags&128)!==0?(i.lanes=c,i):(d=d!==null,d!==(t!==null&&t.memoizedState!==null)&&d&&(i.child.flags|=8192,(i.mode&1)!==0&&(t===null||(We.current&1)!==0?Xt===0&&(Xt=3):Xp())),i.updateQueue!==null&&(i.flags|=4),Tn(i),null);case 4:return Ne(),Up(t,i),t===null&&Yo(i.stateNode.containerInfo),Tn(i),null;case 10:return Cl(i.type._context),Tn(i),null;case 17:return Mn(i.type)&&ea(),Tn(i),null;case 19:if(ct(We),w=i.memoizedState,w===null)return Tn(i),null;if(d=(i.flags&128)!==0,T=w.rendering,T===null)if(d)Pl(w,!1);else{if(Xt!==0||t!==null&&(t.flags&128)!==0)for(t=i.child;t!==null;){if(T=Ge(t),T!==null){for(i.flags|=128,Pl(w,!1),d=T.updateQueue,d!==null&&(i.updateQueue=d,i.flags|=4),i.subtreeFlags=0,d=c,c=i.child;c!==null;)w=c,t=d,w.flags&=14680066,T=w.alternate,T===null?(w.childLanes=0,w.lanes=t,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=T.childLanes,w.lanes=T.lanes,w.child=T.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=T.memoizedProps,w.memoizedState=T.memoizedState,w.updateQueue=T.updateQueue,w.type=T.type,t=T.dependencies,w.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext}),c=c.sibling;return vt(We,We.current&1|2),i.child}t=t.sibling}w.tail!==null&&Et()>lc&&(i.flags|=128,d=!0,Pl(w,!1),i.lanes=4194304)}else{if(!d)if(t=Ge(T),t!==null){if(i.flags|=128,d=!0,c=t.updateQueue,c!==null&&(i.updateQueue=c,i.flags|=4),Pl(w,!0),w.tail===null&&w.tailMode==="hidden"&&!T.alternate&&!Mt)return Tn(i),null}else 2*Et()-w.renderingStartTime>lc&&c!==1073741824&&(i.flags|=128,d=!0,Pl(w,!1),i.lanes=4194304);w.isBackwards?(T.sibling=i.child,i.child=T):(c=w.last,c!==null?c.sibling=T:i.child=T,w.last=T)}return w.tail!==null?(i=w.tail,w.rendering=i,w.tail=i.sibling,w.renderingStartTime=Et(),i.sibling=null,c=We.current,vt(We,d?c&1|2:c&1),i):(Tn(i),null);case 22:case 23:return Yp(),d=i.memoizedState!==null,t!==null&&t.memoizedState!==null!==d&&(i.flags|=8192),d&&(i.mode&1)!==0?(_r&1073741824)!==0&&(Tn(i),i.subtreeFlags&6&&(i.flags|=8192)):Tn(i),null;case 24:return null;case 25:return null}throw Error(r(156,i.tag))}function zE(t,i){switch(rc(i),i.tag){case 1:return Mn(i.type)&&ea(),t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 3:return Ne(),ct(dn),ct(Kt),$t(),t=i.flags,(t&65536)!==0&&(t&128)===0?(i.flags=t&-65537|128,i):null;case 5:return ft(i),null;case 13:if(ct(We),t=i.memoizedState,t!==null&&t.dehydrated!==null){if(i.alternate===null)throw Error(r(340));Ys()}return t=i.flags,t&65536?(i.flags=t&-65537|128,i):null;case 19:return ct(We),null;case 4:return Ne(),null;case 10:return Cl(i.type._context),null;case 22:case 23:return Yp(),null;case 24:return null;default:return null}}var Dd=!1,Rn=!1,qE=typeof WeakSet=="function"?WeakSet:Set,Ae=null;function ac(t,i){var c=t.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(d){Lt(t,i,d)}else c.current=null}function Bp(t,i,c){try{c()}catch(d){Lt(t,i,d)}}var u0=!1;function $E(t,i){if(pl=ne,t=ol(),Kr(t)){if("selectionStart"in t)var c={start:t.selectionStart,end:t.selectionEnd};else e:{c=(c=t.ownerDocument)&&c.defaultView||window;var d=c.getSelection&&c.getSelection();if(d&&d.rangeCount!==0){c=d.anchorNode;var m=d.anchorOffset,w=d.focusNode;d=d.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var T=0,B=-1,z=-1,re=0,me=0,ve=t,pe=null;t:for(;;){for(var Re;ve!==c||m!==0&&ve.nodeType!==3||(B=T+m),ve!==w||d!==0&&ve.nodeType!==3||(z=T+d),ve.nodeType===3&&(T+=ve.nodeValue.length),(Re=ve.firstChild)!==null;)pe=ve,ve=Re;for(;;){if(ve===t)break t;if(pe===c&&++re===m&&(B=T),pe===w&&++me===d&&(z=T),(Re=ve.nextSibling)!==null)break;ve=pe,pe=ve.parentNode}ve=Re}c=B===-1||z===-1?null:{start:B,end:z}}else c=null}c=c||{start:0,end:0}}else c=null;for(Ha={focusedElem:t,selectionRange:c},ne=!1,Ae=i;Ae!==null;)if(i=Ae,t=i.child,(i.subtreeFlags&1028)!==0&&t!==null)t.return=i,Ae=t;else for(;Ae!==null;){i=Ae;try{var Pe=i.alternate;if((i.flags&1024)!==0)switch(i.tag){case 0:case 11:case 15:break;case 1:if(Pe!==null){var xe=Pe.memoizedProps,Ft=Pe.memoizedState,Z=i.stateNode,W=Z.getSnapshotBeforeUpdate(i.elementType===i.type?xe:ii(i.type,xe),Ft);Z.__reactInternalSnapshotBeforeUpdate=W}break;case 3:var te=i.stateNode.containerInfo;te.nodeType===1?te.textContent="":te.nodeType===9&&te.documentElement&&te.removeChild(te.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(r(163))}}catch(Se){Lt(i,i.return,Se)}if(t=i.sibling,t!==null){t.return=i.return,Ae=t;break}Ae=i.return}return Pe=u0,u0=!1,Pe}function Il(t,i,c){var d=i.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var m=d=d.next;do{if((m.tag&t)===t){var w=m.destroy;m.destroy=void 0,w!==void 0&&Bp(i,c,w)}m=m.next}while(m!==d)}}function Ud(t,i){if(i=i.updateQueue,i=i!==null?i.lastEffect:null,i!==null){var c=i=i.next;do{if((c.tag&t)===t){var d=c.create;c.destroy=d()}c=c.next}while(c!==i)}}function Fp(t){var i=t.ref;if(i!==null){var c=t.stateNode;switch(t.tag){case 5:t=c;break;default:t=c}typeof i=="function"?i(t):i.current=t}}function d0(t){var i=t.alternate;i!==null&&(t.alternate=null,d0(i)),t.child=null,t.deletions=null,t.sibling=null,t.tag===5&&(i=t.stateNode,i!==null&&(delete i[En],delete i[Xr],delete i[Ws],delete i[_p],delete i[yl])),t.stateNode=null,t.return=null,t.dependencies=null,t.memoizedProps=null,t.memoizedState=null,t.pendingProps=null,t.stateNode=null,t.updateQueue=null}function f0(t){return t.tag===5||t.tag===3||t.tag===4}function h0(t){e:for(;;){for(;t.sibling===null;){if(t.return===null||f0(t.return))return null;t=t.return}for(t.sibling.return=t.return,t=t.sibling;t.tag!==5&&t.tag!==6&&t.tag!==18;){if(t.flags&2||t.child===null||t.tag===4)continue e;t.child.return=t,t=t.child}if(!(t.flags&2))return t.stateNode}}function Vp(t,i,c){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?c.nodeType===8?c.parentNode.insertBefore(t,i):c.insertBefore(t,i):(c.nodeType===8?(i=c.parentNode,i.insertBefore(t,c)):(i=c,i.appendChild(t)),c=c._reactRootContainer,c!=null||i.onclick!==null||(i.onclick=Ga));else if(d!==4&&(t=t.child,t!==null))for(Vp(t,i,c),t=t.sibling;t!==null;)Vp(t,i,c),t=t.sibling}function zp(t,i,c){var d=t.tag;if(d===5||d===6)t=t.stateNode,i?c.insertBefore(t,i):c.appendChild(t);else if(d!==4&&(t=t.child,t!==null))for(zp(t,i,c),t=t.sibling;t!==null;)zp(t,i,c),t=t.sibling}var hn=null,si=!1;function eo(t,i,c){for(c=c.child;c!==null;)p0(t,i,c),c=c.sibling}function p0(t,i,c){if(Nn&&typeof Nn.onCommitFiberUnmount=="function")try{Nn.onCommitFiberUnmount(_i,c)}catch{}switch(c.tag){case 5:Rn||ac(c,i);case 6:var d=hn,m=si;hn=null,eo(t,i,c),hn=d,si=m,hn!==null&&(si?(t=hn,c=c.stateNode,t.nodeType===8?t.parentNode.removeChild(c):t.removeChild(c)):hn.removeChild(c.stateNode));break;case 18:hn!==null&&(si?(t=hn,c=c.stateNode,t.nodeType===8?Qa(t.parentNode,c):t.nodeType===1&&Qa(t,c),Ki(t)):Qa(hn,c.stateNode));break;case 4:d=hn,m=si,hn=c.stateNode.containerInfo,si=!0,eo(t,i,c),hn=d,si=m;break;case 0:case 11:case 14:case 15:if(!Rn&&(d=c.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){m=d=d.next;do{var w=m,T=w.destroy;w=w.tag,T!==void 0&&((w&2)!==0||(w&4)!==0)&&Bp(c,i,T),m=m.next}while(m!==d)}eo(t,i,c);break;case 1:if(!Rn&&(ac(c,i),d=c.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=c.memoizedProps,d.state=c.memoizedState,d.componentWillUnmount()}catch(B){Lt(c,i,B)}eo(t,i,c);break;case 21:eo(t,i,c);break;case 22:c.mode&1?(Rn=(d=Rn)||c.memoizedState!==null,eo(t,i,c),Rn=d):eo(t,i,c);break;default:eo(t,i,c)}}function g0(t){var i=t.updateQueue;if(i!==null){t.updateQueue=null;var c=t.stateNode;c===null&&(c=t.stateNode=new qE),i.forEach(function(d){var m=ZE.bind(null,t,d);c.has(d)||(c.add(d),d.then(m,m))})}}function oi(t,i){var c=i.deletions;if(c!==null)for(var d=0;d<c.length;d++){var m=c[d];try{var w=t,T=i,B=T;e:for(;B!==null;){switch(B.tag){case 5:hn=B.stateNode,si=!1;break e;case 3:hn=B.stateNode.containerInfo,si=!0;break e;case 4:hn=B.stateNode.containerInfo,si=!0;break e}B=B.return}if(hn===null)throw Error(r(160));p0(w,T,m),hn=null,si=!1;var z=m.alternate;z!==null&&(z.return=null),m.return=null}catch(re){Lt(m,i,re)}}if(i.subtreeFlags&12854)for(i=i.child;i!==null;)m0(i,t),i=i.sibling}function m0(t,i){var c=t.alternate,d=t.flags;switch(t.tag){case 0:case 11:case 14:case 15:if(oi(i,t),ji(t),d&4){try{Il(3,t,t.return),Ud(3,t)}catch(xe){Lt(t,t.return,xe)}try{Il(5,t,t.return)}catch(xe){Lt(t,t.return,xe)}}break;case 1:oi(i,t),ji(t),d&512&&c!==null&&ac(c,c.return);break;case 5:if(oi(i,t),ji(t),d&512&&c!==null&&ac(c,c.return),t.flags&32){var m=t.stateNode;try{Wr(m,"")}catch(xe){Lt(t,t.return,xe)}}if(d&4&&(m=t.stateNode,m!=null)){var w=t.memoizedProps,T=c!==null?c.memoizedProps:w,B=t.type,z=t.updateQueue;if(t.updateQueue=null,z!==null)try{B==="input"&&w.type==="radio"&&w.name!=null&&xn(m,w),pi(B,T);var re=pi(B,w);for(T=0;T<z.length;T+=2){var me=z[T],ve=z[T+1];me==="style"?$i(m,ve):me==="dangerouslySetInnerHTML"?cn(m,ve):me==="children"?Wr(m,ve):ee(m,me,ve,re)}switch(B){case"input":mt(m,w);break;case"textarea":Jt(m,w);break;case"select":var pe=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!w.multiple;var Re=w.value;Re!=null?Ze(m,!!w.multiple,Re,!1):pe!==!!w.multiple&&(w.defaultValue!=null?Ze(m,!!w.multiple,w.defaultValue,!0):Ze(m,!!w.multiple,w.multiple?[]:"",!1))}m[Xr]=w}catch(xe){Lt(t,t.return,xe)}}break;case 6:if(oi(i,t),ji(t),d&4){if(t.stateNode===null)throw Error(r(162));m=t.stateNode,w=t.memoizedProps;try{m.nodeValue=w}catch(xe){Lt(t,t.return,xe)}}break;case 3:if(oi(i,t),ji(t),d&4&&c!==null&&c.memoizedState.isDehydrated)try{Ki(i.containerInfo)}catch(xe){Lt(t,t.return,xe)}break;case 4:oi(i,t),ji(t);break;case 13:oi(i,t),ji(t),m=t.child,m.flags&8192&&(w=m.memoizedState!==null,m.stateNode.isHidden=w,!w||m.alternate!==null&&m.alternate.memoizedState!==null||(Wp=Et())),d&4&&g0(t);break;case 22:if(me=c!==null&&c.memoizedState!==null,t.mode&1?(Rn=(re=Rn)||me,oi(i,t),Rn=re):oi(i,t),ji(t),d&8192){if(re=t.memoizedState!==null,(t.stateNode.isHidden=re)&&!me&&(t.mode&1)!==0)for(Ae=t,me=t.child;me!==null;){for(ve=Ae=me;Ae!==null;){switch(pe=Ae,Re=pe.child,pe.tag){case 0:case 11:case 14:case 15:Il(4,pe,pe.return);break;case 1:ac(pe,pe.return);var Pe=pe.stateNode;if(typeof Pe.componentWillUnmount=="function"){d=pe,c=pe.return;try{i=d,Pe.props=i.memoizedProps,Pe.state=i.memoizedState,Pe.componentWillUnmount()}catch(xe){Lt(d,c,xe)}}break;case 5:ac(pe,pe.return);break;case 22:if(pe.memoizedState!==null){_0(ve);continue}}Re!==null?(Re.return=pe,Ae=Re):_0(ve)}me=me.sibling}e:for(me=null,ve=t;;){if(ve.tag===5){if(me===null){me=ve;try{m=ve.stateNode,re?(w=m.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(B=ve.stateNode,z=ve.memoizedProps.style,T=z!=null&&z.hasOwnProperty("display")?z.display:null,B.style.display=Io("display",T))}catch(xe){Lt(t,t.return,xe)}}}else if(ve.tag===6){if(me===null)try{ve.stateNode.nodeValue=re?"":ve.memoizedProps}catch(xe){Lt(t,t.return,xe)}}else if((ve.tag!==22&&ve.tag!==23||ve.memoizedState===null||ve===t)&&ve.child!==null){ve.child.return=ve,ve=ve.child;continue}if(ve===t)break e;for(;ve.sibling===null;){if(ve.return===null||ve.return===t)break e;me===ve&&(me=null),ve=ve.return}me===ve&&(me=null),ve.sibling.return=ve.return,ve=ve.sibling}}break;case 19:oi(i,t),ji(t),d&4&&g0(t);break;case 21:break;default:oi(i,t),ji(t)}}function ji(t){var i=t.flags;if(i&2){try{e:{for(var c=t.return;c!==null;){if(f0(c)){var d=c;break e}c=c.return}throw Error(r(160))}switch(d.tag){case 5:var m=d.stateNode;d.flags&32&&(Wr(m,""),d.flags&=-33);var w=h0(t);zp(t,w,m);break;case 3:case 4:var T=d.stateNode.containerInfo,B=h0(t);Vp(t,B,T);break;default:throw Error(r(161))}}catch(z){Lt(t,t.return,z)}t.flags&=-3}i&4096&&(t.flags&=-4097)}function WE(t,i,c){Ae=t,v0(t)}function v0(t,i,c){for(var d=(t.mode&1)!==0;Ae!==null;){var m=Ae,w=m.child;if(m.tag===22&&d){var T=m.memoizedState!==null||Dd;if(!T){var B=m.alternate,z=B!==null&&B.memoizedState!==null||Rn;B=Dd;var re=Rn;if(Dd=T,(Rn=z)&&!re)for(Ae=m;Ae!==null;)T=Ae,z=T.child,T.tag===22&&T.memoizedState!==null?w0(m):z!==null?(z.return=T,Ae=z):w0(m);for(;w!==null;)Ae=w,v0(w),w=w.sibling;Ae=m,Dd=B,Rn=re}y0(t)}else(m.subtreeFlags&8772)!==0&&w!==null?(w.return=m,Ae=w):y0(t)}}function y0(t){for(;Ae!==null;){var i=Ae;if((i.flags&8772)!==0){var c=i.alternate;try{if((i.flags&8772)!==0)switch(i.tag){case 0:case 11:case 15:Rn||Ud(5,i);break;case 1:var d=i.stateNode;if(i.flags&4&&!Rn)if(c===null)d.componentDidMount();else{var m=i.elementType===i.type?c.memoizedProps:ii(i.type,c.memoizedProps);d.componentDidUpdate(m,c.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var w=i.updateQueue;w!==null&&K(i,w,d);break;case 3:var T=i.updateQueue;if(T!==null){if(c=null,i.child!==null)switch(i.child.tag){case 5:c=i.child.stateNode;break;case 1:c=i.child.stateNode}K(i,T,c)}break;case 5:var B=i.stateNode;if(c===null&&i.flags&4){c=B;var z=i.memoizedProps;switch(i.type){case"button":case"input":case"select":case"textarea":z.autoFocus&&c.focus();break;case"img":z.src&&(c.src=z.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(i.memoizedState===null){var re=i.alternate;if(re!==null){var me=re.memoizedState;if(me!==null){var ve=me.dehydrated;ve!==null&&Ki(ve)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(r(163))}Rn||i.flags&512&&Fp(i)}catch(pe){Lt(i,i.return,pe)}}if(i===t){Ae=null;break}if(c=i.sibling,c!==null){c.return=i.return,Ae=c;break}Ae=i.return}}function _0(t){for(;Ae!==null;){var i=Ae;if(i===t){Ae=null;break}var c=i.sibling;if(c!==null){c.return=i.return,Ae=c;break}Ae=i.return}}function w0(t){for(;Ae!==null;){var i=Ae;try{switch(i.tag){case 0:case 11:case 15:var c=i.return;try{Ud(4,i)}catch(z){Lt(i,c,z)}break;case 1:var d=i.stateNode;if(typeof d.componentDidMount=="function"){var m=i.return;try{d.componentDidMount()}catch(z){Lt(i,m,z)}}var w=i.return;try{Fp(i)}catch(z){Lt(i,w,z)}break;case 5:var T=i.return;try{Fp(i)}catch(z){Lt(i,T,z)}}}catch(z){Lt(i,i.return,z)}if(i===t){Ae=null;break}var B=i.sibling;if(B!==null){B.return=i.return,Ae=B;break}Ae=i.return}}var GE=Math.ceil,Bd=P.ReactCurrentDispatcher,qp=P.ReactCurrentOwner,Dr=P.ReactCurrentBatchConfig,dt=0,sn=null,Wt=null,pn=0,_r=0,cc=Zr(0),Xt=0,xl=null,oa=0,Fd=0,$p=0,Ll=null,sr=null,Wp=0,lc=1/0,as=null,Vd=!1,Gp=null,to=null,zd=!1,no=null,qd=0,jl=0,Hp=null,$d=-1,Wd=0;function Gn(){return(dt&6)!==0?Et():$d!==-1?$d:$d=Et()}function ro(t){return(t.mode&1)===0?1:(dt&2)!==0&&pn!==0?pn&-pn:Ed.transition!==null?(Wd===0&&(Wd=Ts()),Wd):(t=_e,t!==0||(t=window.event,t=t===void 0?16:qt(t.type)),t)}function ai(t,i,c,d){if(50<jl)throw jl=0,Hp=null,Error(r(185));Gr(t,c,d),((dt&2)===0||t!==sn)&&(t===sn&&((dt&2)===0&&(Fd|=c),Xt===4&&io(t,pn)),or(t,d),c===1&&dt===0&&(i.mode&1)===0&&(lc=Et()+500,Za&&Lr()))}function or(t,i){var c=t.callbackNode;qc(t,i);var d=bi(t,t===sn?pn:0);if(d===0)c!==null&&hr(c),t.callbackNode=null,t.callbackPriority=0;else if(i=d&-d,t.callbackPriority!==i){if(c!=null&&hr(c),i===1)t.tag===0?wp(S0.bind(null,t)):wl(S0.bind(null,t)),Zo(function(){(dt&6)===0&&Lr()}),c=null;else{switch(As(d)){case 1:c=yi;break;case 4:c=Es;break;case 16:c=Gi;break;case 536870912:c=No;break;default:c=Gi}c=A0(c,b0.bind(null,t))}t.callbackPriority=i,t.callbackNode=c}}function b0(t,i){if($d=-1,Wd=0,(dt&6)!==0)throw Error(r(327));var c=t.callbackNode;if(uc()&&t.callbackNode!==c)return null;var d=bi(t,t===sn?pn:0);if(d===0)return null;if((d&30)!==0||(d&t.expiredLanes)!==0||i)i=Gd(t,d);else{i=d;var m=dt;dt|=2;var w=C0();(sn!==t||pn!==i)&&(as=null,lc=Et()+500,ca(t,i));do try{QE();break}catch(B){k0(t,B)}while(!0);kl(),Bd.current=w,dt=m,Wt!==null?i=0:(sn=null,pn=0,i=Xt)}if(i!==0){if(i===2&&(m=Do(t),m!==0&&(d=m,i=Jp(t,m))),i===1)throw c=xl,ca(t,0),io(t,d),or(t,Et()),c;if(i===6)io(t,d);else{if(m=t.current.alternate,(d&30)===0&&!HE(m)&&(i=Gd(t,d),i===2&&(w=Do(t),w!==0&&(d=w,i=Jp(t,w))),i===1))throw c=xl,ca(t,0),io(t,d),or(t,Et()),c;switch(t.finishedWork=m,t.finishedLanes=d,i){case 0:case 1:throw Error(r(345));case 2:la(t,sr,as);break;case 3:if(io(t,d),(d&130023424)===d&&(i=Wp+500-Et(),10<i)){if(bi(t,0)!==0)break;if(m=t.suspendedLanes,(m&d)!==d){Gn(),t.pingedLanes|=t.suspendedLanes&m;break}t.timeoutHandle=Cn(la.bind(null,t,sr,as),i);break}la(t,sr,as);break;case 4:if(io(t,d),(d&4194240)===d)break;for(i=t.eventTimes,m=-1;0<d;){var T=31-Dn(d);w=1<<T,T=i[T],T>m&&(m=T),d&=~w}if(d=m,d=Et()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*GE(d/1960))-d,10<d){t.timeoutHandle=Cn(la.bind(null,t,sr,as),d);break}la(t,sr,as);break;case 5:la(t,sr,as);break;default:throw Error(r(329))}}}return or(t,Et()),t.callbackNode===c?b0.bind(null,t):null}function Jp(t,i){var c=Ll;return t.current.memoizedState.isDehydrated&&(ca(t,i).flags|=256),t=Gd(t,i),t!==2&&(i=sr,sr=c,i!==null&&Qp(i)),t}function Qp(t){sr===null?sr=t:sr.push.apply(sr,t)}function HE(t){for(var i=t;;){if(i.flags&16384){var c=i.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var d=0;d<c.length;d++){var m=c[d],w=m.getSnapshot;m=m.value;try{if(!gr(w(),m))return!1}catch{return!1}}}if(c=i.child,i.subtreeFlags&16384&&c!==null)c.return=i,i=c;else{if(i===t)break;for(;i.sibling===null;){if(i.return===null||i.return===t)return!0;i=i.return}i.sibling.return=i.return,i=i.sibling}}return!0}function io(t,i){for(i&=~$p,i&=~Fd,t.suspendedLanes|=i,t.pingedLanes&=~i,t=t.expirationTimes;0<i;){var c=31-Dn(i),d=1<<c;t[c]=-1,i&=~d}}function S0(t){if((dt&6)!==0)throw Error(r(327));uc();var i=bi(t,0);if((i&1)===0)return or(t,Et()),null;var c=Gd(t,i);if(t.tag!==0&&c===2){var d=Do(t);d!==0&&(i=d,c=Jp(t,d))}if(c===1)throw c=xl,ca(t,0),io(t,i),or(t,Et()),c;if(c===6)throw Error(r(345));return t.finishedWork=t.current.alternate,t.finishedLanes=i,la(t,sr,as),or(t,Et()),null}function Kp(t,i){var c=dt;dt|=1;try{return t(i)}finally{dt=c,dt===0&&(lc=Et()+500,Za&&Lr())}}function aa(t){no!==null&&no.tag===0&&(dt&6)===0&&uc();var i=dt;dt|=1;var c=Dr.transition,d=_e;try{if(Dr.transition=null,_e=1,t)return t()}finally{_e=d,Dr.transition=c,dt=i,(dt&6)===0&&Lr()}}function Yp(){_r=cc.current,ct(cc)}function ca(t,i){t.finishedWork=null,t.finishedLanes=0;var c=t.timeoutHandle;if(c!==-1&&(t.timeoutHandle=-1,ml(c)),Wt!==null)for(c=Wt.return;c!==null;){var d=c;switch(rc(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&ea();break;case 3:Ne(),ct(dn),ct(Kt),$t();break;case 5:ft(d);break;case 4:Ne();break;case 13:ct(We);break;case 19:ct(We);break;case 10:Cl(d.type._context);break;case 22:case 23:Yp()}c=c.return}if(sn=t,Wt=t=so(t.current,null),pn=_r=i,Xt=0,xl=null,$p=Fd=oa=0,sr=Ll=null,Pi!==null){for(i=0;i<Pi.length;i++)if(c=Pi[i],d=c.interleaved,d!==null){c.interleaved=null;var m=d.next,w=c.pending;if(w!==null){var T=w.next;w.next=m,d.next=T}c.pending=d}Pi=null}return t}function k0(t,i){do{var c=Wt;try{if(kl(),Ii.current=xd,Ad){for(var d=xt.memoizedState;d!==null;){var m=d.queue;m!==null&&(m.pending=null),d=d.next}Ad=!1}if(ri=0,rn=Yt=xt=null,Ol=!1,Tl=0,qp.current=null,c===null||c.return===null){Xt=1,xl=i,Wt=null;break}e:{var w=t,T=c.return,B=c,z=i;if(i=pn,B.flags|=32768,z!==null&&typeof z=="object"&&typeof z.then=="function"){var re=z,me=B,ve=me.tag;if((me.mode&1)===0&&(ve===0||ve===11||ve===15)){var pe=me.alternate;pe?(me.updateQueue=pe.updateQueue,me.memoizedState=pe.memoizedState,me.lanes=pe.lanes):(me.updateQueue=null,me.memoizedState=null)}var Re=J_(T);if(Re!==null){Re.flags&=-257,Q_(Re,T,B,w,i),Re.mode&1&&H_(w,re,i),i=Re,z=re;var Pe=i.updateQueue;if(Pe===null){var xe=new Set;xe.add(z),i.updateQueue=xe}else Pe.add(z);break e}else{if((i&1)===0){H_(w,re,i),Xp();break e}z=Error(r(426))}}else if(Mt&&B.mode&1){var Ft=J_(T);if(Ft!==null){(Ft.flags&65536)===0&&(Ft.flags|=256),Q_(Ft,T,B,w,i),na(oc(z,B));break e}}w=z=oc(z,B),Xt!==4&&(Xt=2),Ll===null?Ll=[w]:Ll.push(w),w=T;do{switch(w.tag){case 3:w.flags|=65536,i&=-i,w.lanes|=i;var Z=W_(w,z,i);U(w,Z);break e;case 1:B=z;var W=w.type,te=w.stateNode;if((w.flags&128)===0&&(typeof W.getDerivedStateFromError=="function"||te!==null&&typeof te.componentDidCatch=="function"&&(to===null||!to.has(te)))){w.flags|=65536,i&=-i,w.lanes|=i;var Se=G_(w,B,i);U(w,Se);break e}}w=w.return}while(w!==null)}M0(c)}catch(Le){i=Le,Wt===c&&c!==null&&(Wt=c=c.return);continue}break}while(!0)}function C0(){var t=Bd.current;return Bd.current=xd,t===null?xd:t}function Xp(){(Xt===0||Xt===3||Xt===2)&&(Xt=4),sn===null||(oa&268435455)===0&&(Fd&268435455)===0||io(sn,pn)}function Gd(t,i){var c=dt;dt|=2;var d=C0();(sn!==t||pn!==i)&&(as=null,ca(t,i));do try{JE();break}catch(m){k0(t,m)}while(!0);if(kl(),dt=c,Bd.current=d,Wt!==null)throw Error(r(261));return sn=null,pn=0,Xt}function JE(){for(;Wt!==null;)E0(Wt)}function QE(){for(;Wt!==null&&!ja();)E0(Wt)}function E0(t){var i=R0(t.alternate,t,_r);t.memoizedProps=t.pendingProps,i===null?M0(t):Wt=i,qp.current=null}function M0(t){var i=t;do{var c=i.alternate;if(t=i.return,(i.flags&32768)===0){if(c=VE(c,i,_r),c!==null){Wt=c;return}}else{if(c=zE(c,i),c!==null){c.flags&=32767,Wt=c;return}if(t!==null)t.flags|=32768,t.subtreeFlags=0,t.deletions=null;else{Xt=6,Wt=null;return}}if(i=i.sibling,i!==null){Wt=i;return}Wt=i=t}while(i!==null);Xt===0&&(Xt=5)}function la(t,i,c){var d=_e,m=Dr.transition;try{Dr.transition=null,_e=1,KE(t,i,c,d)}finally{Dr.transition=m,_e=d}return null}function KE(t,i,c,d){do uc();while(no!==null);if((dt&6)!==0)throw Error(r(327));c=t.finishedWork;var m=t.finishedLanes;if(c===null)return null;if(t.finishedWork=null,t.finishedLanes=0,c===t.current)throw Error(r(177));t.callbackNode=null,t.callbackPriority=0;var w=c.lanes|c.childLanes;if($c(t,w),t===sn&&(Wt=sn=null,pn=0),(c.subtreeFlags&2064)===0&&(c.flags&2064)===0||zd||(zd=!0,A0(Gi,function(){return uc(),null})),w=(c.flags&15990)!==0,(c.subtreeFlags&15990)!==0||w){w=Dr.transition,Dr.transition=null;var T=_e;_e=1;var B=dt;dt|=4,qp.current=null,$E(t,c),m0(c,t),al(Ha),ne=!!pl,Ha=pl=null,t.current=c,WE(c),Ot(),dt=B,_e=T,Dr.transition=w}else t.current=c;if(zd&&(zd=!1,no=t,qd=m),w=t.pendingLanes,w===0&&(to=null),Na(c.stateNode),or(t,Et()),i!==null)for(d=t.onRecoverableError,c=0;c<i.length;c++)m=i[c],d(m.value,{componentStack:m.stack,digest:m.digest});if(Vd)throw Vd=!1,t=Gp,Gp=null,t;return(qd&1)!==0&&t.tag!==0&&uc(),w=t.pendingLanes,(w&1)!==0?t===Hp?jl++:(jl=0,Hp=t):jl=0,Lr(),null}function uc(){if(no!==null){var t=As(qd),i=Dr.transition,c=_e;try{if(Dr.transition=null,_e=16>t?16:t,no===null)var d=!1;else{if(t=no,no=null,qd=0,(dt&6)!==0)throw Error(r(331));var m=dt;for(dt|=4,Ae=t.current;Ae!==null;){var w=Ae,T=w.child;if((Ae.flags&16)!==0){var B=w.deletions;if(B!==null){for(var z=0;z<B.length;z++){var re=B[z];for(Ae=re;Ae!==null;){var me=Ae;switch(me.tag){case 0:case 11:case 15:Il(8,me,w)}var ve=me.child;if(ve!==null)ve.return=me,Ae=ve;else for(;Ae!==null;){me=Ae;var pe=me.sibling,Re=me.return;if(d0(me),me===re){Ae=null;break}if(pe!==null){pe.return=Re,Ae=pe;break}Ae=Re}}}var Pe=w.alternate;if(Pe!==null){var xe=Pe.child;if(xe!==null){Pe.child=null;do{var Ft=xe.sibling;xe.sibling=null,xe=Ft}while(xe!==null)}}Ae=w}}if((w.subtreeFlags&2064)!==0&&T!==null)T.return=w,Ae=T;else e:for(;Ae!==null;){if(w=Ae,(w.flags&2048)!==0)switch(w.tag){case 0:case 11:case 15:Il(9,w,w.return)}var Z=w.sibling;if(Z!==null){Z.return=w.return,Ae=Z;break e}Ae=w.return}}var W=t.current;for(Ae=W;Ae!==null;){T=Ae;var te=T.child;if((T.subtreeFlags&2064)!==0&&te!==null)te.return=T,Ae=te;else e:for(T=W;Ae!==null;){if(B=Ae,(B.flags&2048)!==0)try{switch(B.tag){case 0:case 11:case 15:Ud(9,B)}}catch(Le){Lt(B,B.return,Le)}if(B===T){Ae=null;break e}var Se=B.sibling;if(Se!==null){Se.return=B.return,Ae=Se;break e}Ae=B.return}}if(dt=m,Lr(),Nn&&typeof Nn.onPostCommitFiberRoot=="function")try{Nn.onPostCommitFiberRoot(_i,t)}catch{}d=!0}return d}finally{_e=c,Dr.transition=i}}return!1}function O0(t,i,c){i=oc(c,i),i=W_(t,i,1),t=b(t,i,1),i=Gn(),t!==null&&(Gr(t,1,i),or(t,i))}function Lt(t,i,c){if(t.tag===3)O0(t,t,c);else for(;i!==null;){if(i.tag===3){O0(i,t,c);break}else if(i.tag===1){var d=i.stateNode;if(typeof i.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(to===null||!to.has(d))){t=oc(c,t),t=G_(i,t,1),i=b(i,t,1),t=Gn(),i!==null&&(Gr(i,1,t),or(i,t));break}}i=i.return}}function YE(t,i,c){var d=t.pingCache;d!==null&&d.delete(i),i=Gn(),t.pingedLanes|=t.suspendedLanes&c,sn===t&&(pn&c)===c&&(Xt===4||Xt===3&&(pn&130023424)===pn&&500>Et()-Wp?ca(t,0):$p|=c),or(t,i)}function T0(t,i){i===0&&((t.mode&1)===0?i=1:(i=Os,Os<<=1,(Os&130023424)===0&&(Os=4194304)));var c=Gn();t=s(t,i),t!==null&&(Gr(t,i,c),or(t,c))}function XE(t){var i=t.memoizedState,c=0;i!==null&&(c=i.retryLane),T0(t,c)}function ZE(t,i){var c=0;switch(t.tag){case 13:var d=t.stateNode,m=t.memoizedState;m!==null&&(c=m.retryLane);break;case 19:d=t.stateNode;break;default:throw Error(r(314))}d!==null&&d.delete(i),T0(t,c)}var R0;R0=function(t,i,c){if(t!==null)if(t.memoizedProps!==i.pendingProps||dn.current)ir=!0;else{if((t.lanes&c)===0&&(i.flags&128)===0)return ir=!1,FE(t,i,c);ir=(t.flags&131072)!==0}else ir=!1,Mt&&(i.flags&1048576)!==0&&Sd(i,tc,i.index);switch(i.lanes=0,i.tag){case 2:var d=i.type;Nd(t,i),t=i.pendingProps;var m=vr(i,Kt.current);Zs(i,c),m=Sp(null,i,d,t,m,c);var w=kp();return i.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(i.tag=1,i.memoizedState=null,i.updateQueue=null,Mn(d)?(w=!0,Xa(i)):w=!1,i.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,u(i),m.updater=Ld,i.stateNode=m,m._reactInternals=i,Rp(i,d,t,c),i=xp(null,i,d,!0,w,c)):(i.tag=0,Mt&&w&&nc(i),Wn(null,i,m,c),i=i.child),i;case 16:d=i.elementType;e:{switch(Nd(t,i),t=i.pendingProps,m=d._init,d=m(d._payload),i.type=d,m=i.tag=t1(d),t=ii(d,t),m){case 0:i=Ip(null,i,d,t,c);break e;case 1:i=t0(null,i,d,t,c);break e;case 11:i=K_(null,i,d,t,c);break e;case 14:i=Y_(null,i,d,ii(d.type,t),c);break e}throw Error(r(306,d,""))}return i;case 0:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:ii(d,m),Ip(t,i,d,m,c);case 1:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:ii(d,m),t0(t,i,d,m,c);case 3:e:{if(n0(i),t===null)throw Error(r(387));d=i.pendingProps,w=i.memoizedState,m=w.element,p(t,i),X(i,d,null,c);var T=i.memoizedState;if(d=T.element,w.isDehydrated)if(w={element:d,isDehydrated:!1,cache:T.cache,pendingSuspenseBoundaries:T.pendingSuspenseBoundaries,transitions:T.transitions},i.updateQueue.baseState=w,i.memoizedState=w,i.flags&256){m=oc(Error(r(423)),i),i=r0(t,i,d,c,m);break e}else if(d!==m){m=oc(Error(r(424)),i),i=r0(t,i,d,c,m);break e}else for($n=Yr(i.stateNode.containerInfo.firstChild),qn=i,Mt=!0,yr=null,c=Td(i,null,d,c),i.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Ys(),d===m){i=os(t,i,c);break e}Wn(t,i,d,c)}i=i.child}return i;case 5:return lt(i),t===null&&Sl(i),d=i.type,m=i.pendingProps,w=t!==null?t.memoizedProps:null,T=m.children,gl(d,m)?T=null:w!==null&&gl(d,w)&&(i.flags|=32),e0(t,i),Wn(t,i,T,c),i.child;case 6:return t===null&&Sl(i),null;case 13:return i0(t,i,c);case 4:return Te(i,i.stateNode.containerInfo),d=i.pendingProps,t===null?i.child=Xs(i,null,d,c):Wn(t,i,d,c),i.child;case 11:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:ii(d,m),K_(t,i,d,m,c);case 7:return Wn(t,i,i.pendingProps,c),i.child;case 8:return Wn(t,i,i.pendingProps.children,c),i.child;case 12:return Wn(t,i,i.pendingProps.children,c),i.child;case 10:e:{if(d=i.type._context,m=i.pendingProps,w=i.memoizedProps,T=m.value,vt(ia,d._currentValue),d._currentValue=T,w!==null)if(gr(w.value,T)){if(w.children===m.children&&!dn.current){i=os(t,i,c);break e}}else for(w=i.child,w!==null&&(w.return=i);w!==null;){var B=w.dependencies;if(B!==null){T=w.child;for(var z=B.firstContext;z!==null;){if(z.context===d){if(w.tag===1){z=_(-1,c&-c),z.tag=2;var re=w.updateQueue;if(re!==null){re=re.shared;var me=re.pending;me===null?z.next=z:(z.next=me.next,me.next=z),re.pending=z}}w.lanes|=c,z=w.alternate,z!==null&&(z.lanes|=c),El(w.return,c,i),B.lanes|=c;break}z=z.next}}else if(w.tag===10)T=w.type===i.type?null:w.child;else if(w.tag===18){if(T=w.return,T===null)throw Error(r(341));T.lanes|=c,B=T.alternate,B!==null&&(B.lanes|=c),El(T,c,i),T=w.sibling}else T=w.child;if(T!==null)T.return=w;else for(T=w;T!==null;){if(T===i){T=null;break}if(w=T.sibling,w!==null){w.return=T.return,T=w;break}T=T.return}w=T}Wn(t,i,m.children,c),i=i.child}return i;case 9:return m=i.type,d=i.pendingProps.children,Zs(i,c),m=rr(m),d=d(m),i.flags|=1,Wn(t,i,d,c),i.child;case 14:return d=i.type,m=ii(d,i.pendingProps),m=ii(d.type,m),Y_(t,i,d,m,c);case 15:return X_(t,i,i.type,i.pendingProps,c);case 17:return d=i.type,m=i.pendingProps,m=i.elementType===d?m:ii(d,m),Nd(t,i),i.tag=1,Mn(d)?(t=!0,Xa(i)):t=!1,Zs(i,c),q_(i,d,m),Rp(i,d,m,c),xp(null,i,d,!0,t,c);case 19:return o0(t,i,c);case 22:return Z_(t,i,c)}throw Error(r(156,i.tag))};function A0(t,i){return La(t,i)}function e1(t,i,c,d){this.tag=t,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=i,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Ur(t,i,c,d){return new e1(t,i,c,d)}function Zp(t){return t=t.prototype,!(!t||!t.isReactComponent)}function t1(t){if(typeof t=="function")return Zp(t)?1:0;if(t!=null){if(t=t.$$typeof,t===ze)return 11;if(t===De)return 14}return 2}function so(t,i){var c=t.alternate;return c===null?(c=Ur(t.tag,i,t.key,t.mode),c.elementType=t.elementType,c.type=t.type,c.stateNode=t.stateNode,c.alternate=t,t.alternate=c):(c.pendingProps=i,c.type=t.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=t.flags&14680064,c.childLanes=t.childLanes,c.lanes=t.lanes,c.child=t.child,c.memoizedProps=t.memoizedProps,c.memoizedState=t.memoizedState,c.updateQueue=t.updateQueue,i=t.dependencies,c.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext},c.sibling=t.sibling,c.index=t.index,c.ref=t.ref,c}function Hd(t,i,c,d,m,w){var T=2;if(d=t,typeof t=="function")Zp(t)&&(T=1);else if(typeof t=="string")T=5;else e:switch(t){case ae:return ua(c.children,m,w,i);case ye:T=8,m|=8;break;case Ce:return t=Ur(12,c,i,m|2),t.elementType=Ce,t.lanes=w,t;case Ee:return t=Ur(13,c,i,m),t.elementType=Ee,t.lanes=w,t;case Y:return t=Ur(19,c,i,m),t.elementType=Y,t.lanes=w,t;case we:return Jd(c,m,w,i);default:if(typeof t=="object"&&t!==null)switch(t.$$typeof){case Ve:T=10;break e;case S:T=9;break e;case ze:T=11;break e;case De:T=14;break e;case it:T=16,d=null;break e}throw Error(r(130,t==null?t:typeof t,""))}return i=Ur(T,c,i,m),i.elementType=t,i.type=d,i.lanes=w,i}function ua(t,i,c,d){return t=Ur(7,t,d,i),t.lanes=c,t}function Jd(t,i,c,d){return t=Ur(22,t,d,i),t.elementType=we,t.lanes=c,t.stateNode={isHidden:!1},t}function eg(t,i,c){return t=Ur(6,t,null,i),t.lanes=c,t}function tg(t,i,c){return i=Ur(4,t.children!==null?t.children:[],t.key,i),i.lanes=c,i.stateNode={containerInfo:t.containerInfo,pendingChildren:null,implementation:t.implementation},i}function n1(t,i,c,d,m){this.tag=i,this.containerInfo=t,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Rs(0),this.expirationTimes=Rs(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Rs(0),this.identifierPrefix=d,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function ng(t,i,c,d,m,w,T,B,z){return t=new n1(t,i,c,B,z),i===1?(i=1,w===!0&&(i|=8)):i=0,w=Ur(3,null,null,i),t.current=w,w.stateNode=t,w.memoizedState={element:d,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},u(w),t}function r1(t,i,c){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:G,key:d==null?null:""+d,children:t,containerInfo:i,implementation:c}}function P0(t){if(!t)return Zn;t=t._reactInternals;e:{if(Tr(t)!==t||t.tag!==1)throw Error(r(170));var i=t;do{switch(i.tag){case 3:i=i.stateNode.context;break e;case 1:if(Mn(i.type)){i=i.stateNode.__reactInternalMemoizedMergedChildContext;break e}}i=i.return}while(i!==null);throw Error(r(171))}if(t.tag===1){var c=t.type;if(Mn(c))return wd(t,c,i)}return i}function I0(t,i,c,d,m,w,T,B,z){return t=ng(c,d,!0,t,m,w,T,B,z),t.context=P0(null),c=t.current,d=Gn(),m=ro(c),w=_(d,m),w.callback=i??null,b(c,w,m),t.current.lanes=m,Gr(t,m,d),or(t,d),t}function Qd(t,i,c,d){var m=i.current,w=Gn(),T=ro(m);return c=P0(c),i.context===null?i.context=c:i.pendingContext=c,i=_(w,T),i.payload={element:t},d=d===void 0?null:d,d!==null&&(i.callback=d),t=b(m,i,T),t!==null&&(ai(t,m,T,w),A(t,m,T)),T}function Kd(t){if(t=t.current,!t.child)return null;switch(t.child.tag){case 5:return t.child.stateNode;default:return t.child.stateNode}}function x0(t,i){if(t=t.memoizedState,t!==null&&t.dehydrated!==null){var c=t.retryLane;t.retryLane=c!==0&&c<i?c:i}}function rg(t,i){x0(t,i),(t=t.alternate)&&x0(t,i)}function i1(){return null}var L0=typeof reportError=="function"?reportError:function(t){console.error(t)};function ig(t){this._internalRoot=t}Yd.prototype.render=ig.prototype.render=function(t){var i=this._internalRoot;if(i===null)throw Error(r(409));Qd(t,i,null,null)},Yd.prototype.unmount=ig.prototype.unmount=function(){var t=this._internalRoot;if(t!==null){this._internalRoot=null;var i=t.containerInfo;aa(function(){Qd(null,t,null,null)}),i[mr]=null}};function Yd(t){this._internalRoot=t}Yd.prototype.unstable_scheduleHydration=function(t){if(t){var i=Ua();t={blockedOn:null,target:t,priority:i};for(var c=0;c<Bn.length&&i!==0&&i<Bn[c].priority;c++);Bn.splice(c,0,t),c===0&&zo(t)}};function sg(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11)}function Xd(t){return!(!t||t.nodeType!==1&&t.nodeType!==9&&t.nodeType!==11&&(t.nodeType!==8||t.nodeValue!==" react-mount-point-unstable "))}function j0(){}function s1(t,i,c,d,m){if(m){if(typeof d=="function"){var w=d;d=function(){var re=Kd(T);w.call(re)}}var T=I0(i,d,t,0,null,!1,!1,"",j0);return t._reactRootContainer=T,t[mr]=T.current,Yo(t.nodeType===8?t.parentNode:t),aa(),T}for(;m=t.lastChild;)t.removeChild(m);if(typeof d=="function"){var B=d;d=function(){var re=Kd(z);B.call(re)}}var z=ng(t,0,!1,null,null,!1,!1,"",j0);return t._reactRootContainer=z,t[mr]=z.current,Yo(t.nodeType===8?t.parentNode:t),aa(function(){Qd(i,z,c,d)}),z}function Zd(t,i,c,d,m){var w=c._reactRootContainer;if(w){var T=w;if(typeof m=="function"){var B=m;m=function(){var z=Kd(T);B.call(z)}}Qd(i,T,t,m)}else T=s1(c,i,t,m,d);return Kd(T)}Tt=function(t){switch(t.tag){case 3:var i=t.stateNode;if(i.current.memoizedState.isDehydrated){var c=ln(i.pendingLanes);c!==0&&(St(i,c|1),or(i,Et()),(dt&6)===0&&(lc=Et()+500,Lr()))}break;case 13:aa(function(){var d=s(t,1);if(d!==null){var m=Gn();ai(d,t,1,m)}}),rg(t,1)}},Uo=function(t){if(t.tag===13){var i=s(t,134217728);if(i!==null){var c=Gn();ai(i,t,134217728,c)}rg(t,134217728)}},Bo=function(t){if(t.tag===13){var i=ro(t),c=s(t,i);if(c!==null){var d=Gn();ai(c,t,i,d)}rg(t,i)}},Ua=function(){return _e},Fo=function(t,i){var c=_e;try{return _e=t,i()}finally{_e=c}},Or=function(t,i,c){switch(i){case"input":if(mt(t,c),i=c.name,c.type==="radio"&&i!=null){for(c=t;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+i)+'][type="radio"]'),i=0;i<c.length;i++){var d=c[i];if(d!==t&&d.form===t.form){var m=Ka(d);if(!m)throw Error(r(90));qe(d),mt(d,m)}}}break;case"textarea":Jt(t,c);break;case"select":i=c.value,i!=null&&Ze(t,!!c.multiple,i,!1)}},Aa=Kp,Pa=aa;var o1={usingClientEntryPoint:!1,Events:[Ti,Gs,Ka,Ra,bn,Kp]},Nl={findFiberByHostInstance:nn,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},a1={bundleType:Nl.bundleType,version:Nl.version,rendererPackageName:Nl.rendererPackageName,rendererConfig:Nl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:P.ReactCurrentDispatcher,findHostInstanceByFiber:function(t){return t=$e(t),t===null?null:t.stateNode},findFiberByHostInstance:Nl.findFiberByHostInstance||i1,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ef=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ef.isDisabled&&ef.supportsFiber)try{_i=ef.inject(a1),Nn=ef}catch{}}return Hn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=o1,Hn.createPortal=function(t,i){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!sg(i))throw Error(r(200));return r1(t,i,null,c)},Hn.createRoot=function(t,i){if(!sg(t))throw Error(r(299));var c=!1,d="",m=L0;return i!=null&&(i.unstable_strictMode===!0&&(c=!0),i.identifierPrefix!==void 0&&(d=i.identifierPrefix),i.onRecoverableError!==void 0&&(m=i.onRecoverableError)),i=ng(t,1,!1,null,null,c,!1,d,m),t[mr]=i.current,Yo(t.nodeType===8?t.parentNode:t),new ig(i)},Hn.findDOMNode=function(t){if(t==null)return null;if(t.nodeType===1)return t;var i=t._reactInternals;if(i===void 0)throw typeof t.render=="function"?Error(r(188)):(t=Object.keys(t).join(","),Error(r(268,t)));return t=$e(i),t=t===null?null:t.stateNode,t},Hn.flushSync=function(t){return aa(t)},Hn.hydrate=function(t,i,c){if(!Xd(i))throw Error(r(200));return Zd(null,t,i,!0,c)},Hn.hydrateRoot=function(t,i,c){if(!sg(t))throw Error(r(405));var d=c!=null&&c.hydratedSources||null,m=!1,w="",T=L0;if(c!=null&&(c.unstable_strictMode===!0&&(m=!0),c.identifierPrefix!==void 0&&(w=c.identifierPrefix),c.onRecoverableError!==void 0&&(T=c.onRecoverableError)),i=I0(i,null,t,1,c??null,m,!1,w,T),t[mr]=i.current,Yo(t),d)for(t=0;t<d.length;t++)c=d[t],m=c._getVersion,m=m(c._source),i.mutableSourceEagerHydrationData==null?i.mutableSourceEagerHydrationData=[c,m]:i.mutableSourceEagerHydrationData.push(c,m);return new Yd(i)},Hn.render=function(t,i,c){if(!Xd(i))throw Error(r(200));return Zd(null,t,i,!1,c)},Hn.unmountComponentAtNode=function(t){if(!Xd(t))throw Error(r(40));return t._reactRootContainer?(aa(function(){Zd(null,null,t,!1,function(){t._reactRootContainer=null,t[mr]=null})}),!0):!1},Hn.unstable_batchedUpdates=Kp,Hn.unstable_renderSubtreeIntoContainer=function(t,i,c,d){if(!Xd(c))throw Error(r(200));if(t==null||t._reactInternals===void 0)throw Error(r(38));return Zd(t,i,c,!1,d)},Hn.version="18.3.1-next-f1338f8080-20240426",Hn}var kg;function J0(){if(kg)return of.exports;kg=1;function n(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(n)}catch(e){console.error(e)}}return n(),of.exports=H0(),of.exports}var Cg;function Q0(){if(Cg)return Vl;Cg=1;var n=J0();return Vl.createRoot=n.createRoot,Vl.hydrateRoot=n.hydrateRoot,Vl}var K0=Q0();const Y0=gg(K0),da={};function Eg(n){return"init"in n}function lf(n){return!!n.write}function Mg(n){return"v"in n||"e"in n}function zl(n){if("e"in n)throw n.e;if((da?"production":void 0)!=="production"&&!("v"in n))throw new Error("[Bug] atom state is not initialized");return n.v}const ql=new WeakMap;function Og(n){var e;return $l(n)&&!!((e=ql.get(n))!=null&&e[0])}function X0(n){const e=ql.get(n);e?.[0]&&(e[0]=!1,e[1].forEach(r=>r()))}function uf(n,e){let r=ql.get(n);if(!r){r=[!0,new Set],ql.set(n,r);const a=()=>{r[0]=!1};n.then(a,a)}r[1].add(e)}function $l(n){return typeof n?.then=="function"}function Tg(n,e,r){if(!r.p.has(n)){r.p.add(n);const a=()=>r.p.delete(n);e.then(a,a)}}function Rg(n,e,r){var a;const l=new Set;for(const f of((a=r.get(n))==null?void 0:a.t)||[])r.has(f)&&l.add(f);for(const f of e.p)l.add(f);return l}const Z0=(n,e,...r)=>e.read(...r),ew=(n,e,...r)=>e.write(...r),tw=(n,e)=>{var r;return(r=e.unstable_onInit)==null?void 0:r.call(e,n)},nw=(n,e,r)=>{var a;return(a=e.onMount)==null?void 0:a.call(e,r)},rw=(n,e)=>{const r=gn(n),a=r[0],l=r[9];if((da?"production":void 0)!=="production"&&!e)throw new Error("Atom is undefined or null");let f=a.get(e);return f||(f={d:new Map,p:new Set,n:0},a.set(e,f),l?.(n,e)),f},iw=n=>{const e=gn(n),r=e[1],a=e[3],l=e[4],f=e[5],h=e[6],v=e[13],y=[],k=E=>{try{E()}catch(O){y.push(O)}};do{h.f&&k(h.f);const E=new Set,O=E.add.bind(E);a.forEach(D=>{var x;return(x=r.get(D))==null?void 0:x.l.forEach(O)}),a.clear(),f.forEach(O),f.clear(),l.forEach(O),l.clear(),E.forEach(k),a.size&&v(n)}while(a.size||f.size||l.size);if(y.length)throw new AggregateError(y)},sw=n=>{const e=gn(n),r=e[1],a=e[2],l=e[3],f=e[11],h=e[14],v=e[17],y=[],k=new WeakSet,E=new WeakSet,O=Array.from(l);for(;O.length;){const D=O[O.length-1],x=f(n,D);if(E.has(D)){O.pop();continue}if(k.has(D)){if(a.get(D)===x.n)y.push([D,x]);else if((da?"production":void 0)!=="production"&&a.has(D))throw new Error("[Bug] invalidated atom exists");E.add(D),O.pop();continue}k.add(D);for(const L of Rg(D,x,r))k.has(L)||O.push(L)}for(let D=y.length-1;D>=0;--D){const[x,L]=y[D];let R=!1;for(const N of L.d.keys())if(N!==x&&l.has(N)){R=!0;break}R&&(h(n,x),v(n,x)),a.delete(x)}},ow=(n,e)=>{var r,a;const l=gn(n),f=l[1],h=l[2],v=l[3],y=l[6],k=l[7],E=l[11],O=l[12],D=l[13],x=l[14],L=l[16],R=l[17],N=E(n,e);if(Mg(N)&&(f.has(e)&&h.get(e)!==N.n||Array.from(N.d).every(([ye,Ce])=>x(n,ye).n===Ce)))return N;N.d.clear();let q=!0;function Q(){f.has(e)&&(R(n,e),D(n),O(n))}function ee(ye){var Ce;if(ye===e){const S=E(n,ye);if(!Mg(S))if(Eg(ye))Wl(n,ye,ye.init);else throw new Error("no atom init");return zl(S)}const Ve=x(n,ye);try{return zl(Ve)}finally{N.d.set(ye,Ve.n),Og(N.v)&&Tg(e,N.v,Ve),(Ce=f.get(ye))==null||Ce.t.add(e),q||Q()}}let P,$;const G={get signal(){return P||(P=new AbortController),P.signal},get setSelf(){return(da?"production":void 0)!=="production"&&!lf(e)&&console.warn("setSelf function cannot be used with read-only atom"),!$&&lf(e)&&($=(...ye)=>{if((da?"production":void 0)!=="production"&&q&&console.warn("setSelf function cannot be called in sync"),!q)try{return L(n,e,...ye)}finally{D(n),O(n)}}),$}},ae=N.n;try{const ye=k(n,e,ee,G);return Wl(n,e,ye),$l(ye)&&(uf(ye,()=>P?.abort()),ye.then(Q,Q)),(r=y.r)==null||r.call(y,e),N}catch(ye){return delete N.v,N.e=ye,++N.n,N}finally{q=!1,ae!==N.n&&h.get(e)===ae&&(h.set(e,N.n),v.add(e),(a=y.c)==null||a.call(y,e))}},aw=(n,e)=>{const r=gn(n),a=r[1],l=r[2],f=r[11],h=[e];for(;h.length;){const v=h.pop(),y=f(n,v);for(const k of Rg(v,y,a)){const E=f(n,k);l.set(k,E.n),h.push(k)}}},Ag=(n,e,...r)=>{const a=gn(n),l=a[3],f=a[6],h=a[8],v=a[11],y=a[12],k=a[13],E=a[14],O=a[15],D=a[17];let x=!0;const L=N=>zl(E(n,N)),R=(N,...q)=>{var Q;const ee=v(n,N);try{if(N===e){if(!Eg(N))throw new Error("atom not writable");const P=ee.n,$=q[0];Wl(n,N,$),D(n,N),P!==ee.n&&(l.add(N),(Q=f.c)==null||Q.call(f,N),O(n,N));return}else return Ag(n,N,...q)}finally{x||(k(n),y(n))}};try{return h(n,e,L,R,...r)}finally{x=!1}},cw=(n,e)=>{var r;const a=gn(n),l=a[1],f=a[3],h=a[6],v=a[11],y=a[15],k=a[18],E=a[19],O=v(n,e),D=l.get(e);if(D&&!Og(O.v)){for(const[x,L]of O.d)if(!D.d.has(x)){const R=v(n,x);k(n,x).t.add(e),D.d.add(x),L!==R.n&&(f.add(x),(r=h.c)==null||r.call(h,x),y(n,x))}for(const x of D.d||[])if(!O.d.has(x)){D.d.delete(x);const L=E(n,x);L?.t.delete(e)}}},Pg=(n,e)=>{var r;const a=gn(n),l=a[1],f=a[4],h=a[6],v=a[10],y=a[11],k=a[12],E=a[13],O=a[14],D=a[16],x=y(n,e);let L=l.get(e);if(!L){O(n,e);for(const R of x.d.keys())Pg(n,R).t.add(e);if(L={l:new Set,d:new Set(x.d.keys()),t:new Set},l.set(e,L),(r=h.m)==null||r.call(h,e),lf(e)){const R=()=>{let N=!0;const q=(...Q)=>{try{return D(n,e,...Q)}finally{N||(E(n),k(n))}};try{const Q=v(n,e,q);Q&&(L.u=()=>{N=!0;try{Q()}finally{N=!1}})}finally{N=!1}};f.add(R)}}return L},lw=(n,e)=>{var r;const a=gn(n),l=a[1],f=a[5],h=a[6],v=a[11],y=a[19],k=v(n,e);let E=l.get(e);if(E&&!E.l.size&&!Array.from(E.t).some(O=>{var D;return(D=l.get(O))==null?void 0:D.d.has(e)})){E.u&&f.add(E.u),E=void 0,l.delete(e),(r=h.u)==null||r.call(h,e);for(const O of k.d.keys()){const D=y(n,O);D?.t.delete(e)}return}return E},Wl=(n,e,r)=>{const a=gn(n)[11],l=a(n,e),f="v"in l,h=l.v;if($l(r))for(const v of l.d.keys())Tg(e,r,a(n,v));l.v=r,delete l.e,(!f||!Object.is(h,l.v))&&(++l.n,$l(h)&&X0(h))},uw=(n,e)=>{const r=gn(n)[14];return zl(r(n,e))},dw=(n,e,...r)=>{const a=gn(n),l=a[12],f=a[13],h=a[16];try{return h(n,e,...r)}finally{f(n),l(n)}},fw=(n,e,r)=>{const a=gn(n),l=a[12],f=a[18],h=a[19],y=f(n,e).l;return y.add(r),l(n),()=>{y.delete(r),h(n,e),l(n)}},Ig=new WeakMap,gn=n=>{const e=Ig.get(n);if((da?"production":void 0)!=="production"&&!e)throw new Error("Store must be created by buildStore to read its building blocks");return e};function hw(...n){const e={get(a){const l=gn(e)[21];return l(e,a)},set(a,...l){const f=gn(e)[22];return f(e,a,...l)},sub(a,l){const f=gn(e)[23];return f(e,a,l)}},r=[new WeakMap,new WeakMap,new WeakMap,new Set,new Set,new Set,{},Z0,ew,tw,nw,rw,iw,sw,ow,aw,Ag,cw,Pg,lw,Wl,uw,dw,fw,void 0].map((a,l)=>n[l]||a);return Ig.set(e,Object.freeze(r)),e}const xg={};let pw=0;function st(n,e){const r=`atom${++pw}`,a={toString(){return(xg?"production":void 0)!=="production"&&this.debugLabel?r+":"+this.debugLabel:r}};return typeof n=="function"?a.read=n:(a.init=n,a.read=gw,a.write=mw),e&&(a.write=e),a}function gw(n){return n(this)}function mw(n,e,r){return e(this,typeof r=="function"?r(n(this)):r)}function Lg(){return hw()}let gc;function vw(){return gc||(gc=Lg(),(xg?"production":void 0)!=="production"&&(globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=gc),globalThis.__JOTAI_DEFAULT_STORE__!==gc&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044"))),gc}const yw={};function mc(n,e){let r=null;const a=new Map,l=new Set,f=v=>{let y;if(y=a.get(v),y!==void 0)if(r?.(y[1],v))f.remove(v);else return y[0];const k=n(v);return a.set(v,[k,Date.now()]),h("CREATE",v,k),k},h=(v,y,k)=>{for(const E of l)E({type:v,param:y,atom:k})};return f.unstable_listen=v=>(l.add(v),()=>{l.delete(v)}),f.getParams=()=>a.keys(),f.remove=v=>{{if(!a.has(v))return;const[y]=a.get(v);a.delete(v),h("REMOVE",v,y)}},f.setShouldRemove=v=>{if(r=v,!!r)for(const[y,[k,E]]of a)r(E,y)&&(a.delete(y),h("REMOVE",y,k))},f}const _w=n=>typeof n?.then=="function";function ww(n=()=>{try{return window.localStorage}catch(r){(yw?"production":void 0)!=="production"&&typeof window<"u"&&console.warn(r);return}},e){var r;let a,l;const f={getItem:(y,k)=>{var E,O;const D=L=>{if(L=L||"",a!==L){try{l=JSON.parse(L,e?.reviver)}catch{return k}a=L}return l},x=(O=(E=n())==null?void 0:E.getItem(y))!=null?O:null;return _w(x)?x.then(D):D(x)},setItem:(y,k)=>{var E;return(E=n())==null?void 0:E.setItem(y,JSON.stringify(k,void 0))},removeItem:y=>{var k;return(k=n())==null?void 0:k.removeItem(y)}},h=y=>(k,E,O)=>y(k,D=>{let x;try{x=JSON.parse(D||"")}catch{x=O}E(x)});let v;try{v=(r=n())==null?void 0:r.subscribe}catch{}return!v&&typeof window<"u"&&typeof window.addEventListener=="function"&&window.Storage&&(v=(y,k)=>{if(!(n()instanceof window.Storage))return()=>{};const E=O=>{O.storageArea===n()&&O.key===y&&k(O.newValue)};return window.addEventListener("storage",E),()=>{window.removeEventListener("storage",E)}}),v&&(f.subscribe=h(v)),f}ww();const bw={},jg=V.createContext(void 0);function Ng(n){return V.useContext(jg)||vw()}function Sw({children:n,store:e}){const r=V.useRef(void 0);return!e&&!r.current&&(r.current=Lg()),V.createElement(jg.Provider,{value:e||r.current},n)}const df=n=>typeof n?.then=="function",ff=n=>{n.status||(n.status="pending",n.then(e=>{n.status="fulfilled",n.value=e},e=>{n.status="rejected",n.reason=e}))},kw=et.use||(n=>{if(n.status==="pending")throw n;if(n.status==="fulfilled")return n.value;throw n.status==="rejected"?n.reason:(ff(n),n)}),hf=new WeakMap,Dg=(n,e)=>{let r=hf.get(n);return r||(r=new Promise((a,l)=>{let f=n;const h=k=>E=>{f===k&&a(E)},v=k=>E=>{f===k&&l(E)},y=()=>{try{const k=e();df(k)?(hf.set(k,r),f=k,k.then(h(k),v(k)),uf(k,y)):a(k)}catch(k){l(k)}};n.then(h(n),v(n)),uf(n,y)}),hf.set(n,r)),r};function ao(n,e){const{delay:r,unstable_promiseStatus:a=!et.use}={},l=Ng(),[[f,h,v],y]=V.useReducer(E=>{const O=l.get(n);return Object.is(E[0],O)&&E[1]===l&&E[2]===n?E:[O,l,n]},void 0,()=>[l.get(n),l,n]);let k=f;if((h!==l||v!==n)&&(y(),k=l.get(n)),V.useEffect(()=>{const E=l.sub(n,()=>{if(a)try{const O=l.get(n);df(O)&&ff(Dg(O,()=>l.get(n)))}catch{}if(typeof r=="number"){setTimeout(y,r);return}y()});return y(),E},[l,n,r,a]),V.useDebugValue(k),df(k)){const E=Dg(k,()=>l.get(n));return a&&ff(E),kw(E)}return k}function Cw(n,e){const r=Ng();return V.useCallback((...l)=>{if((bw?"production":void 0)!=="production"&&!("write"in n))throw new Error("not writable atom");return r.set(n,...l)},[r,n])}function rt(n,e){const r=V.useMemo(()=>st(null,(a,l,...f)=>n(a,l,...f)),[n]);return Cw(r)}function Ug(n,e){if(n==null)return{};var r,a,l=(function(h,v){if(h==null)return{};var y={};for(var k in h)if({}.hasOwnProperty.call(h,k)){if(v.indexOf(k)!==-1)continue;y[k]=h[k]}return y})(n,e);if(Object.getOwnPropertySymbols){var f=Object.getOwnPropertySymbols(n);for(a=0;a<f.length;a++)r=f[a],e.indexOf(r)===-1&&{}.propertyIsEnumerable.call(n,r)&&(l[r]=n[r])}return l}function ar(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}function ut(n){return ut=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ut(n)}function Bg(n){var e=(function(r,a){if(ut(r)!="object"||!r)return r;var l=r[Symbol.toPrimitive];if(l!==void 0){var f=l.call(r,a);if(ut(f)!="object")return f;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(r)})(n,"string");return ut(e)=="symbol"?e:e+""}function Fg(n,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(n,Bg(a.key),a)}}function cr(n,e,r){return e&&Fg(n.prototype,e),r&&Fg(n,r),Object.defineProperty(n,"prototype",{writable:!1}),n}function Gl(n,e){if(e&&(ut(e)=="object"||typeof e=="function"))return e;if(e!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return(function(r){if(r===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r})(n)}function Br(n){return Br=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Br(n)}function vc(n,e){return vc=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,a){return r.__proto__=a,r},vc(n,e)}function Hl(n,e){if(typeof e!="function"&&e!==null)throw new TypeError("Super expression must either be null or a function");n.prototype=Object.create(e&&e.prototype,{constructor:{value:n,writable:!0,configurable:!0}}),Object.defineProperty(n,"prototype",{writable:!1}),e&&vc(n,e)}function ci(n,e,r){return(e=Bg(e))in n?Object.defineProperty(n,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[e]=r,n}function Vg(n,e,r,a,l,f,h){try{var v=n[f](h),y=v.value}catch(k){return void r(k)}v.done?e(y):Promise.resolve(y).then(a,l)}function He(n){return function(){var e=this,r=arguments;return new Promise((function(a,l){var f=n.apply(e,r);function h(y){Vg(f,a,l,h,v,"next",y)}function v(y){Vg(f,a,l,h,v,"throw",y)}h(void 0)}))}}function zg(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,a=Array(e);r<e;r++)a[r]=n[r];return a}function mn(n,e){return(function(r){if(Array.isArray(r))return r})(n)||(function(r,a){var l=r==null?null:typeof Symbol<"u"&&r[Symbol.iterator]||r["@@iterator"];if(l!=null){var f,h,v,y,k=[],E=!0,O=!1;try{if(v=(l=l.call(r)).next,a===0){if(Object(l)!==l)return;E=!1}else for(;!(E=(f=v.call(l)).done)&&(k.push(f.value),k.length!==a);E=!0);}catch(D){O=!0,h=D}finally{try{if(!E&&l.return!=null&&(y=l.return(),Object(y)!==y))return}finally{if(O)throw h}}return k}})(n,e)||(function(r,a){if(r){if(typeof r=="string")return zg(r,a);var l={}.toString.call(r).slice(8,-1);return l==="Object"&&r.constructor&&(l=r.constructor.name),l==="Map"||l==="Set"?Array.from(r):l==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(l)?zg(r,a):void 0}})(n,e)||(function(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)})()}function Ew(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var qg,Jl={exports:{}},pf=(function(){if(qg)return Jl.exports;qg=1;var n,e=typeof Reflect=="object"?Reflect:null,r=e&&typeof e.apply=="function"?e.apply:function(R,N,q){return Function.prototype.apply.call(R,N,q)};n=e&&typeof e.ownKeys=="function"?e.ownKeys:Object.getOwnPropertySymbols?function(R){return Object.getOwnPropertyNames(R).concat(Object.getOwnPropertySymbols(R))}:function(R){return Object.getOwnPropertyNames(R)};var a=Number.isNaN||function(R){return R!=R};function l(){l.init.call(this)}Jl.exports=l,Jl.exports.once=function(R,N){return new Promise((function(q,Q){function ee($){R.removeListener(N,P),Q($)}function P(){typeof R.removeListener=="function"&&R.removeListener("error",ee),q([].slice.call(arguments))}L(R,N,P,{once:!0}),N!=="error"&&(function($,G,ae){typeof $.on=="function"&&L($,"error",G,ae)})(R,ee,{once:!0})}))},l.EventEmitter=l,l.prototype._events=void 0,l.prototype._eventsCount=0,l.prototype._maxListeners=void 0;var f=10;function h(R){if(typeof R!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof R)}function v(R){return R._maxListeners===void 0?l.defaultMaxListeners:R._maxListeners}function y(R,N,q,Q){var ee,P,$,G;if(h(q),(P=R._events)===void 0?(P=R._events=Object.create(null),R._eventsCount=0):(P.newListener!==void 0&&(R.emit("newListener",N,q.listener?q.listener:q),P=R._events),$=P[N]),$===void 0)$=P[N]=q,++R._eventsCount;else if(typeof $=="function"?$=P[N]=Q?[q,$]:[$,q]:Q?$.unshift(q):$.push(q),(ee=v(R))>0&&$.length>ee&&!$.warned){$.warned=!0;var ae=new Error("Possible EventEmitter memory leak detected. "+$.length+" "+String(N)+" listeners added. Use emitter.setMaxListeners() to increase limit");ae.name="MaxListenersExceededWarning",ae.emitter=R,ae.type=N,ae.count=$.length,G=ae,console&&console.warn&&console.warn(G)}return R}function k(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function E(R,N,q){var Q={fired:!1,wrapFn:void 0,target:R,type:N,listener:q},ee=k.bind(Q);return ee.listener=q,Q.wrapFn=ee,ee}function O(R,N,q){var Q=R._events;if(Q===void 0)return[];var ee=Q[N];return ee===void 0?[]:typeof ee=="function"?q?[ee.listener||ee]:[ee]:q?(function(P){for(var $=new Array(P.length),G=0;G<$.length;++G)$[G]=P[G].listener||P[G];return $})(ee):x(ee,ee.length)}function D(R){var N=this._events;if(N!==void 0){var q=N[R];if(typeof q=="function")return 1;if(q!==void 0)return q.length}return 0}function x(R,N){for(var q=new Array(N),Q=0;Q<N;++Q)q[Q]=R[Q];return q}function L(R,N,q,Q){if(typeof R.on=="function")Q.once?R.once(N,q):R.on(N,q);else{if(typeof R.addEventListener!="function")throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof R);R.addEventListener(N,(function ee(P){Q.once&&R.removeEventListener(N,ee),q(P)}))}}return Object.defineProperty(l,"defaultMaxListeners",{enumerable:!0,get:function(){return f},set:function(R){if(typeof R!="number"||R<0||a(R))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+R+".");f=R}}),l.init=function(){this._events!==void 0&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},l.prototype.setMaxListeners=function(R){if(typeof R!="number"||R<0||a(R))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+R+".");return this._maxListeners=R,this},l.prototype.getMaxListeners=function(){return v(this)},l.prototype.emit=function(R){for(var N=[],q=1;q<arguments.length;q++)N.push(arguments[q]);var Q=R==="error",ee=this._events;if(ee!==void 0)Q=Q&&ee.error===void 0;else if(!Q)return!1;if(Q){var P;if(N.length>0&&(P=N[0]),P instanceof Error)throw P;var $=new Error("Unhandled error."+(P?" ("+P.message+")":""));throw $.context=P,$}var G=ee[R];if(G===void 0)return!1;if(typeof G=="function")r(G,this,N);else{var ae=G.length,ye=x(G,ae);for(q=0;q<ae;++q)r(ye[q],this,N)}return!0},l.prototype.addListener=function(R,N){return y(this,R,N,!1)},l.prototype.on=l.prototype.addListener,l.prototype.prependListener=function(R,N){return y(this,R,N,!0)},l.prototype.once=function(R,N){return h(N),this.on(R,E(this,R,N)),this},l.prototype.prependOnceListener=function(R,N){return h(N),this.prependListener(R,E(this,R,N)),this},l.prototype.removeListener=function(R,N){var q,Q,ee,P,$;if(h(N),(Q=this._events)===void 0)return this;if((q=Q[R])===void 0)return this;if(q===N||q.listener===N)--this._eventsCount==0?this._events=Object.create(null):(delete Q[R],Q.removeListener&&this.emit("removeListener",R,q.listener||N));else if(typeof q!="function"){for(ee=-1,P=q.length-1;P>=0;P--)if(q[P]===N||q[P].listener===N){$=q[P].listener,ee=P;break}if(ee<0)return this;ee===0?q.shift():(function(G,ae){for(;ae+1<G.length;ae++)G[ae]=G[ae+1];G.pop()})(q,ee),q.length===1&&(Q[R]=q[0]),Q.removeListener!==void 0&&this.emit("removeListener",R,$||N)}return this},l.prototype.off=l.prototype.removeListener,l.prototype.removeAllListeners=function(R){var N,q,Q;if((q=this._events)===void 0)return this;if(q.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):q[R]!==void 0&&(--this._eventsCount==0?this._events=Object.create(null):delete q[R]),this;if(arguments.length===0){var ee,P=Object.keys(q);for(Q=0;Q<P.length;++Q)(ee=P[Q])!=="removeListener"&&this.removeAllListeners(ee);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(typeof(N=q[R])=="function")this.removeListener(R,N);else if(N!==void 0)for(Q=N.length-1;Q>=0;Q--)this.removeListener(R,N[Q]);return this},l.prototype.listeners=function(R){return O(this,R,!0)},l.prototype.rawListeners=function(R){return O(this,R,!1)},l.listenerCount=function(R,N){return typeof R.listenerCount=="function"?R.listenerCount(N):D.call(R,N)},l.prototype.listenerCount=D,l.prototype.eventNames=function(){return this._eventsCount>0?n(this._events):[]},Jl.exports})(),Ql=Ew(pf),$g=Object.prototype.hasOwnProperty;function Wg(n,e,r){for(r of n.keys())if(An(r,e))return r}function An(n,e){var r,a,l;if(n===e)return!0;if(n&&e&&(r=n.constructor)===e.constructor){if(r===Date)return n.getTime()===e.getTime();if(r===RegExp)return n.toString()===e.toString();if(r===Array){if((a=n.length)===e.length)for(;a--&&An(n[a],e[a]););return a===-1}if(r===Set){if(n.size!==e.size)return!1;for(a of n)if((l=a)&&typeof l=="object"&&!(l=Wg(e,l))||!e.has(l))return!1;return!0}if(r===Map){if(n.size!==e.size)return!1;for(a of n)if((l=a[0])&&typeof l=="object"&&!(l=Wg(e,l))||!An(a[1],e.get(l)))return!1;return!0}if(r===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(r===DataView){if((a=n.byteLength)===e.byteLength)for(;a--&&n.getInt8(a)===e.getInt8(a););return a===-1}if(ArrayBuffer.isView(n)){if((a=n.byteLength)===e.byteLength)for(;a--&&n[a]===e[a];);return a===-1}if(!r||typeof n=="object"){for(r in a=0,n)if($g.call(n,r)&&++a&&!$g.call(e,r)||!(r in e)||!An(n[r],e[r]))return!1;return Object.keys(e).length===a}}return n!=n&&e!=e}const Mw={"Amazon Silk":"amazon_silk","Android Browser":"android",Bada:"bada",BlackBerry:"blackberry",Chrome:"chrome",Chromium:"chromium",Electron:"electron",Epiphany:"epiphany",Firefox:"firefox",Focus:"focus",Generic:"generic","Google Search":"google_search",Googlebot:"googlebot","Internet Explorer":"ie","K-Meleon":"k_meleon",Maxthon:"maxthon","Microsoft Edge":"edge","MZ Browser":"mz","NAVER Whale Browser":"naver",Opera:"opera","Opera Coast":"opera_coast",PhantomJS:"phantomjs",Puffin:"puffin",QupZilla:"qupzilla",QQ:"qq",QQLite:"qqlite",Safari:"safari",Sailfish:"sailfish","Samsung Internet for Android":"samsung_internet",SeaMonkey:"seamonkey",Sleipnir:"sleipnir",Swing:"swing",Tizen:"tizen","UC Browser":"uc",Vivaldi:"vivaldi","WebOS Browser":"webos",WeChat:"wechat","Yandex Browser":"yandex",Roku:"roku"},Gg={amazon_silk:"Amazon Silk",android:"Android Browser",bada:"Bada",blackberry:"BlackBerry",chrome:"Chrome",chromium:"Chromium",electron:"Electron",epiphany:"Epiphany",firefox:"Firefox",focus:"Focus",generic:"Generic",googlebot:"Googlebot",google_search:"Google Search",ie:"Internet Explorer",k_meleon:"K-Meleon",maxthon:"Maxthon",edge:"Microsoft Edge",mz:"MZ Browser",naver:"NAVER Whale Browser",opera:"Opera",opera_coast:"Opera Coast",phantomjs:"PhantomJS",puffin:"Puffin",qupzilla:"QupZilla",qq:"QQ Browser",qqlite:"QQ Browser Lite",safari:"Safari",sailfish:"Sailfish",samsung_internet:"Samsung Internet for Android",seamonkey:"SeaMonkey",sleipnir:"Sleipnir",swing:"Swing",tizen:"Tizen",uc:"UC Browser",vivaldi:"Vivaldi",webos:"WebOS Browser",wechat:"WeChat",yandex:"Yandex Browser"},jt={tablet:"tablet",mobile:"mobile",desktop:"desktop",tv:"tv"},Pn={WindowsPhone:"Windows Phone",Windows:"Windows",MacOS:"macOS",iOS:"iOS",Android:"Android",WebOS:"WebOS",BlackBerry:"BlackBerry",Bada:"Bada",Tizen:"Tizen",Linux:"Linux",ChromeOS:"Chrome OS",PlayStation4:"PlayStation 4",Roku:"Roku"},ls={EdgeHTML:"EdgeHTML",Blink:"Blink",Trident:"Trident",Presto:"Presto",Gecko:"Gecko",WebKit:"WebKit"};let ge=class dc{static getFirstMatch(e,r){const a=r.match(e);return a&&a.length>0&&a[1]||""}static getSecondMatch(e,r){const a=r.match(e);return a&&a.length>1&&a[2]||""}static matchAndReturnConst(e,r,a){if(e.test(r))return a}static getWindowsVersionName(e){switch(e){case"NT":return"NT";case"XP":case"NT 5.1":return"XP";case"NT 5.0":return"2000";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}static getMacOSVersionName(e){const r=e.split(".").splice(0,2).map((a=>parseInt(a,10)||0));if(r.push(0),r[0]===10)switch(r[1]){case 5:return"Leopard";case 6:return"Snow Leopard";case 7:return"Lion";case 8:return"Mountain Lion";case 9:return"Mavericks";case 10:return"Yosemite";case 11:return"El Capitan";case 12:return"Sierra";case 13:return"High Sierra";case 14:return"Mojave";case 15:return"Catalina";default:return}}static getAndroidVersionName(e){const r=e.split(".").splice(0,2).map((a=>parseInt(a,10)||0));if(r.push(0),!(r[0]===1&&r[1]<5))return r[0]===1&&r[1]<6?"Cupcake":r[0]===1&&r[1]>=6?"Donut":r[0]===2&&r[1]<2?"Eclair":r[0]===2&&r[1]===2?"Froyo":r[0]===2&&r[1]>2?"Gingerbread":r[0]===3?"Honeycomb":r[0]===4&&r[1]<1?"Ice Cream Sandwich":r[0]===4&&r[1]<4?"Jelly Bean":r[0]===4&&r[1]>=4?"KitKat":r[0]===5?"Lollipop":r[0]===6?"Marshmallow":r[0]===7?"Nougat":r[0]===8?"Oreo":r[0]===9?"Pie":void 0}static getVersionPrecision(e){return e.split(".").length}static compareVersions(e,r,a=!1){const l=dc.getVersionPrecision(e),f=dc.getVersionPrecision(r);let h=Math.max(l,f),v=0;const y=dc.map([e,r],(k=>{const E=h-dc.getVersionPrecision(k),O=k+new Array(E+1).join(".0");return dc.map(O.split("."),(D=>new Array(20-D.length).join("0")+D)).reverse()}));for(a&&(v=h-Math.min(l,f)),h-=1;h>=v;){if(y[0][h]>y[1][h])return 1;if(y[0][h]===y[1][h]){if(h===v)return 0;h-=1}else if(y[0][h]<y[1][h])return-1}}static map(e,r){const a=[];let l;if(Array.prototype.map)return Array.prototype.map.call(e,r);for(l=0;l<e.length;l+=1)a.push(r(e[l]));return a}static find(e,r){let a,l;if(Array.prototype.find)return Array.prototype.find.call(e,r);for(a=0,l=e.length;a<l;a+=1){const f=e[a];if(r(f,a))return f}}static assign(e,...r){const a=e;let l,f;if(Object.assign)return Object.assign(e,...r);for(l=0,f=r.length;l<f;l+=1){const h=r[l];typeof h=="object"&&h!==null&&Object.keys(h).forEach((v=>{a[v]=h[v]}))}return e}static getBrowserAlias(e){return Mw[e]}static getBrowserTypeByAlias(e){return Gg[e]||""}};const yt=/version\/(\d+(\.?_?\d+)+)/i,Ow=[{test:[/googlebot/i],describe(n){const e={name:"Googlebot"},r=ge.getFirstMatch(/googlebot\/(\d+(\.\d+))/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/opera/i],describe(n){const e={name:"Opera"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:opera)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/opr\/|opios/i],describe(n){const e={name:"Opera"},r=ge.getFirstMatch(/(?:opr|opios)[\s/](\S+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/SamsungBrowser/i],describe(n){const e={name:"Samsung Internet for Android"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:SamsungBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/Whale/i],describe(n){const e={name:"NAVER Whale Browser"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:whale)[\s/](\d+(?:\.\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/MZBrowser/i],describe(n){const e={name:"MZ Browser"},r=ge.getFirstMatch(/(?:MZBrowser)[\s/](\d+(?:\.\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/focus/i],describe(n){const e={name:"Focus"},r=ge.getFirstMatch(/(?:focus)[\s/](\d+(?:\.\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/swing/i],describe(n){const e={name:"Swing"},r=ge.getFirstMatch(/(?:swing)[\s/](\d+(?:\.\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/coast/i],describe(n){const e={name:"Opera Coast"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:coast)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/opt\/\d+(?:.?_?\d+)+/i],describe(n){const e={name:"Opera Touch"},r=ge.getFirstMatch(/(?:opt)[\s/](\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/yabrowser/i],describe(n){const e={name:"Yandex Browser"},r=ge.getFirstMatch(/(?:yabrowser)[\s/](\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/ucbrowser/i],describe(n){const e={name:"UC Browser"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:ucbrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/Maxthon|mxios/i],describe(n){const e={name:"Maxthon"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:Maxthon|mxios)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/epiphany/i],describe(n){const e={name:"Epiphany"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:epiphany)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/puffin/i],describe(n){const e={name:"Puffin"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:puffin)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/sleipnir/i],describe(n){const e={name:"Sleipnir"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:sleipnir)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/k-meleon/i],describe(n){const e={name:"K-Meleon"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/(?:k-meleon)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/micromessenger/i],describe(n){const e={name:"WeChat"},r=ge.getFirstMatch(/(?:micromessenger)[\s/](\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/qqbrowser/i],describe(n){const e={name:/qqbrowserlite/i.test(n)?"QQ Browser Lite":"QQ Browser"},r=ge.getFirstMatch(/(?:qqbrowserlite|qqbrowser)[/](\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/msie|trident/i],describe(n){const e={name:"Internet Explorer"},r=ge.getFirstMatch(/(?:msie |rv:)(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/\sedg\//i],describe(n){const e={name:"Microsoft Edge"},r=ge.getFirstMatch(/\sedg\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/edg([ea]|ios)/i],describe(n){const e={name:"Microsoft Edge"},r=ge.getSecondMatch(/edg([ea]|ios)\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/vivaldi/i],describe(n){const e={name:"Vivaldi"},r=ge.getFirstMatch(/vivaldi\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/seamonkey/i],describe(n){const e={name:"SeaMonkey"},r=ge.getFirstMatch(/seamonkey\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/sailfish/i],describe(n){const e={name:"Sailfish"},r=ge.getFirstMatch(/sailfish\s?browser\/(\d+(\.\d+)?)/i,n);return r&&(e.version=r),e}},{test:[/silk/i],describe(n){const e={name:"Amazon Silk"},r=ge.getFirstMatch(/silk\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/phantom/i],describe(n){const e={name:"PhantomJS"},r=ge.getFirstMatch(/phantomjs\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/slimerjs/i],describe(n){const e={name:"SlimerJS"},r=ge.getFirstMatch(/slimerjs\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const e={name:"BlackBerry"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/blackberry[\d]+\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/(web|hpw)[o0]s/i],describe(n){const e={name:"WebOS Browser"},r=ge.getFirstMatch(yt,n)||ge.getFirstMatch(/w(?:eb)?[o0]sbrowser\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/bada/i],describe(n){const e={name:"Bada"},r=ge.getFirstMatch(/dolfin\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/tizen/i],describe(n){const e={name:"Tizen"},r=ge.getFirstMatch(/(?:tizen\s?)?browser\/(\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/qupzilla/i],describe(n){const e={name:"QupZilla"},r=ge.getFirstMatch(/(?:qupzilla)[\s/](\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/firefox|iceweasel|fxios/i],describe(n){const e={name:"Firefox"},r=ge.getFirstMatch(/(?:firefox|iceweasel|fxios)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/electron/i],describe(n){const e={name:"Electron"},r=ge.getFirstMatch(/(?:electron)\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/MiuiBrowser/i],describe(n){const e={name:"Miui"},r=ge.getFirstMatch(/(?:MiuiBrowser)[\s/](\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/chromium/i],describe(n){const e={name:"Chromium"},r=ge.getFirstMatch(/(?:chromium)[\s/](\d+(\.?_?\d+)+)/i,n)||ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/chrome|crios|crmo/i],describe(n){const e={name:"Chrome"},r=ge.getFirstMatch(/(?:chrome|crios|crmo)\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/GSA/i],describe(n){const e={name:"Google Search"},r=ge.getFirstMatch(/(?:GSA)\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test(n){const e=!n.test(/like android/i),r=n.test(/android/i);return e&&r},describe(n){const e={name:"Android Browser"},r=ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/playstation 4/i],describe(n){const e={name:"PlayStation 4"},r=ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/safari|applewebkit/i],describe(n){const e={name:"Safari"},r=ge.getFirstMatch(yt,n);return r&&(e.version=r),e}},{test:[/.*/i],describe(n){const e=n.search("\\(")!==-1?/^(.*)\/(.*)[ \t]\((.*)/:/^(.*)\/(.*) /;return{name:ge.getFirstMatch(e,n),version:ge.getSecondMatch(e,n)}}}];var Tw=[{test:[/Roku\/DVP/],describe(n){const e=ge.getFirstMatch(/Roku\/DVP-(\d+\.\d+)/i,n);return{name:Pn.Roku,version:e}}},{test:[/windows phone/i],describe(n){const e=ge.getFirstMatch(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i,n);return{name:Pn.WindowsPhone,version:e}}},{test:[/windows /i],describe(n){const e=ge.getFirstMatch(/Windows ((NT|XP)( \d\d?.\d)?)/i,n),r=ge.getWindowsVersionName(e);return{name:Pn.Windows,version:e,versionName:r}}},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe(n){const e={name:Pn.iOS},r=ge.getSecondMatch(/(Version\/)(\d[\d.]+)/,n);return r&&(e.version=r),e}},{test:[/macintosh/i],describe(n){const e=ge.getFirstMatch(/mac os x (\d+(\.?_?\d+)+)/i,n).replace(/[_\s]/g,"."),r=ge.getMacOSVersionName(e),a={name:Pn.MacOS,version:e};return r&&(a.versionName=r),a}},{test:[/(ipod|iphone|ipad)/i],describe(n){const e=ge.getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i,n).replace(/[_\s]/g,".");return{name:Pn.iOS,version:e}}},{test(n){const e=!n.test(/like android/i),r=n.test(/android/i);return e&&r},describe(n){const e=ge.getFirstMatch(/android[\s/-](\d+(\.\d+)*)/i,n),r=ge.getAndroidVersionName(e),a={name:Pn.Android,version:e};return r&&(a.versionName=r),a}},{test:[/(web|hpw)[o0]s/i],describe(n){const e=ge.getFirstMatch(/(?:web|hpw)[o0]s\/(\d+(\.\d+)*)/i,n),r={name:Pn.WebOS};return e&&e.length&&(r.version=e),r}},{test:[/blackberry|\bbb\d+/i,/rim\stablet/i],describe(n){const e=ge.getFirstMatch(/rim\stablet\sos\s(\d+(\.\d+)*)/i,n)||ge.getFirstMatch(/blackberry\d+\/(\d+([_\s]\d+)*)/i,n)||ge.getFirstMatch(/\bbb(\d+)/i,n);return{name:Pn.BlackBerry,version:e}}},{test:[/bada/i],describe(n){const e=ge.getFirstMatch(/bada\/(\d+(\.\d+)*)/i,n);return{name:Pn.Bada,version:e}}},{test:[/tizen/i],describe(n){const e=ge.getFirstMatch(/tizen[/\s](\d+(\.\d+)*)/i,n);return{name:Pn.Tizen,version:e}}},{test:[/linux/i],describe:()=>({name:Pn.Linux})},{test:[/CrOS/],describe:()=>({name:Pn.ChromeOS})},{test:[/PlayStation 4/],describe(n){const e=ge.getFirstMatch(/PlayStation 4[/\s](\d+(\.\d+)*)/i,n);return{name:Pn.PlayStation4,version:e}}}],Rw=[{test:[/googlebot/i],describe:()=>({type:"bot",vendor:"Google"})},{test:[/huawei/i],describe(n){const e=ge.getFirstMatch(/(can-l01)/i,n)&&"Nova",r={type:jt.mobile,vendor:"Huawei"};return e&&(r.model=e),r}},{test:[/nexus\s*(?:7|8|9|10).*/i],describe:()=>({type:jt.tablet,vendor:"Nexus"})},{test:[/ipad/i],describe:()=>({type:jt.tablet,vendor:"Apple",model:"iPad"})},{test:[/Macintosh(.*?) FxiOS(.*?)\//],describe:()=>({type:jt.tablet,vendor:"Apple",model:"iPad"})},{test:[/kftt build/i],describe:()=>({type:jt.tablet,vendor:"Amazon",model:"Kindle Fire HD 7"})},{test:[/silk/i],describe:()=>({type:jt.tablet,vendor:"Amazon"})},{test:[/tablet(?! pc)/i],describe:()=>({type:jt.tablet})},{test(n){const e=n.test(/ipod|iphone/i),r=n.test(/like (ipod|iphone)/i);return e&&!r},describe(n){const e=ge.getFirstMatch(/(ipod|iphone)/i,n);return{type:jt.mobile,vendor:"Apple",model:e}}},{test:[/nexus\s*[0-6].*/i,/galaxy nexus/i],describe:()=>({type:jt.mobile,vendor:"Nexus"})},{test:[/[^-]mobi/i],describe:()=>({type:jt.mobile})},{test:n=>n.getBrowserName(!0)==="blackberry",describe:()=>({type:jt.mobile,vendor:"BlackBerry"})},{test:n=>n.getBrowserName(!0)==="bada",describe:()=>({type:jt.mobile})},{test:n=>n.getBrowserName()==="windows phone",describe:()=>({type:jt.mobile,vendor:"Microsoft"})},{test(n){const e=Number(String(n.getOSVersion()).split(".")[0]);return n.getOSName(!0)==="android"&&e>=3},describe:()=>({type:jt.tablet})},{test:n=>n.getOSName(!0)==="android",describe:()=>({type:jt.mobile})},{test:n=>n.getOSName(!0)==="macos",describe:()=>({type:jt.desktop,vendor:"Apple"})},{test:n=>n.getOSName(!0)==="windows",describe:()=>({type:jt.desktop})},{test:n=>n.getOSName(!0)==="linux",describe:()=>({type:jt.desktop})},{test:n=>n.getOSName(!0)==="playstation 4",describe:()=>({type:jt.tv})},{test:n=>n.getOSName(!0)==="roku",describe:()=>({type:jt.tv})}],Aw=[{test:n=>n.getBrowserName(!0)==="microsoft edge",describe(n){if(/\sedg\//i.test(n))return{name:ls.Blink};const e=ge.getFirstMatch(/edge\/(\d+(\.?_?\d+)+)/i,n);return{name:ls.EdgeHTML,version:e}}},{test:[/trident/i],describe(n){const e={name:ls.Trident},r=ge.getFirstMatch(/trident\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:n=>n.test(/presto/i),describe(n){const e={name:ls.Presto},r=ge.getFirstMatch(/presto\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test(n){const e=n.test(/gecko/i),r=n.test(/like gecko/i);return e&&!r},describe(n){const e={name:ls.Gecko},r=ge.getFirstMatch(/gecko\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}},{test:[/(apple)?webkit\/537\.36/i],describe:()=>({name:ls.Blink})},{test:[/(apple)?webkit/i],describe(n){const e={name:ls.WebKit},r=ge.getFirstMatch(/webkit\/(\d+(\.?_?\d+)+)/i,n);return r&&(e.version=r),e}}];let Hg=class{constructor(e,r=!1){if(e==null||e==="")throw new Error("UserAgent parameter can't be empty");this._ua=e,this.parsedResult={},r!==!0&&this.parse()}getUA(){return this._ua}test(e){return e.test(this._ua)}parseBrowser(){this.parsedResult.browser={};const e=ge.find(Ow,(r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some((a=>this.test(a)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.browser=e.describe(this.getUA())),this.parsedResult.browser}getBrowser(){return this.parsedResult.browser?this.parsedResult.browser:this.parseBrowser()}getBrowserName(e){return e?String(this.getBrowser().name).toLowerCase()||"":this.getBrowser().name||""}getBrowserVersion(){return this.getBrowser().version}getOS(){return this.parsedResult.os?this.parsedResult.os:this.parseOS()}parseOS(){this.parsedResult.os={};const e=ge.find(Tw,(r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some((a=>this.test(a)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.os=e.describe(this.getUA())),this.parsedResult.os}getOSName(e){const{name:r}=this.getOS();return e?String(r).toLowerCase()||"":r||""}getOSVersion(){return this.getOS().version}getPlatform(){return this.parsedResult.platform?this.parsedResult.platform:this.parsePlatform()}getPlatformType(e=!1){const{type:r}=this.getPlatform();return e?String(r).toLowerCase()||"":r||""}parsePlatform(){this.parsedResult.platform={};const e=ge.find(Rw,(r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some((a=>this.test(a)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.platform=e.describe(this.getUA())),this.parsedResult.platform}getEngine(){return this.parsedResult.engine?this.parsedResult.engine:this.parseEngine()}getEngineName(e){return e?String(this.getEngine().name).toLowerCase()||"":this.getEngine().name||""}parseEngine(){this.parsedResult.engine={};const e=ge.find(Aw,(r=>{if(typeof r.test=="function")return r.test(this);if(r.test instanceof Array)return r.test.some((a=>this.test(a)));throw new Error("Browser's test function is not valid")}));return e&&(this.parsedResult.engine=e.describe(this.getUA())),this.parsedResult.engine}parse(){return this.parseBrowser(),this.parseOS(),this.parsePlatform(),this.parseEngine(),this}getResult(){return ge.assign({},this.parsedResult)}satisfies(e){const r={};let a=0;const l={};let f=0;if(Object.keys(e).forEach((h=>{const v=e[h];typeof v=="string"?(l[h]=v,f+=1):typeof v=="object"&&(r[h]=v,a+=1)})),a>0){const h=Object.keys(r),v=ge.find(h,(k=>this.isOS(k)));if(v){const k=this.satisfies(r[v]);if(k!==void 0)return k}const y=ge.find(h,(k=>this.isPlatform(k)));if(y){const k=this.satisfies(r[y]);if(k!==void 0)return k}}if(f>0){const h=Object.keys(l),v=ge.find(h,(y=>this.isBrowser(y,!0)));if(v!==void 0)return this.compareVersion(l[v])}}isBrowser(e,r=!1){const a=this.getBrowserName().toLowerCase();let l=e.toLowerCase();const f=ge.getBrowserTypeByAlias(l);return r&&f&&(l=f.toLowerCase()),l===a}compareVersion(e){let r=[0],a=e,l=!1;const f=this.getBrowserVersion();if(typeof f=="string")return e[0]===">"||e[0]==="<"?(a=e.substr(1),e[1]==="="?(l=!0,a=e.substr(2)):r=[],e[0]===">"?r.push(1):r.push(-1)):e[0]==="="?a=e.substr(1):e[0]==="~"&&(l=!0,a=e.substr(1)),r.indexOf(ge.compareVersions(f,a,l))>-1}isOS(e){return this.getOSName(!0)===String(e).toLowerCase()}isPlatform(e){return this.getPlatformType(!0)===String(e).toLowerCase()}isEngine(e){return this.getEngineName(!0)===String(e).toLowerCase()}is(e,r=!1){return this.isBrowser(e,r)||this.isOS(e)||this.isPlatform(e)}some(e=[]){return e.some((r=>this.is(r)))}};/*!
 * Bowser - a browser detector
 * https://github.com/lancedikson/bowser
 * MIT License | (c) Dustin Diaz 2012-2015
 * MIT License | (c) Denis Demchenko 2015-2019
 */let Pw=class{static getParser(e,r=!1){if(typeof e!="string")throw new Error("UserAgent should be a string");return new Hg(e,r)}static parse(e){return new Hg(e).getResult()}static get BROWSER_MAP(){return Gg}static get ENGINE_MAP(){return ls}static get OS_MAP(){return Pn}static get PLATFORMS_MAP(){return jt}};function Kl(){return Date.now()+Math.random().toString()}function yc(){throw new Error("Method must be implemented in subclass")}function Jg(n,e){return e!=null&&e.proxyUrl?e.proxyUrl+(e.proxyUrl.slice(-1)==="/"?"":"/")+n.substring(8):n}function Yl(n){return n!=null&&n.callObjectBundleUrlOverride?n.callObjectBundleUrlOverride:Jg("https://c.daily.co/call-machine/versioned/".concat("0.84.0","/static/call-machine-object-bundle.js"),n)}function Xl(n){try{new URL(n)}catch{return!1}return!0}const Ct=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,co="8.55.0",pt=globalThis;function Zl(n,e,r){const a=pt,l=a.__SENTRY__=a.__SENTRY__||{},f=l[co]=l[co]||{};return f[n]||(f[n]=e())}const lo=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,gf=["debug","info","warn","error","log","assert","trace"],eu={};function _c(n){if(!("console"in pt))return n();const e=pt.console,r={},a=Object.keys(eu);a.forEach((l=>{const f=eu[l];r[l]=e[l],e[l]=f}));try{return n()}finally{a.forEach((l=>{e[l]=r[l]}))}}const Ye=Zl("logger",(function(){let n=!1;const e={enable:()=>{n=!0},disable:()=>{n=!1},isEnabled:()=>n};return lo?gf.forEach((r=>{e[r]=(...a)=>{n&&_c((()=>{pt.console[r](`Sentry Logger [${r}]:`,...a)}))}})):gf.forEach((r=>{e[r]=()=>{}})),e})),uo="?",Qg=/\(error: (.*)\)/,Kg=/captureMessage|captureException/;function tu(n){return n[n.length-1]||{}}const Yg="<anonymous>";function us(n){try{return n&&typeof n=="function"&&n.name||Yg}catch{return Yg}}function Xg(n){const e=n.exception;if(e){const r=[];try{return e.values.forEach((a=>{a.stacktrace.frames&&r.push(...a.stacktrace.frames)})),r}catch{return}}}const nu={},Zg={};function fo(n,e){nu[n]=nu[n]||[],nu[n].push(e)}function ho(n,e){if(!Zg[n]){Zg[n]=!0;try{e()}catch(r){lo&&Ye.error(`Error while instrumenting ${n}`,r)}}}function Fr(n,e){const r=n&&nu[n];if(r)for(const a of r)try{a(e)}catch(l){lo&&Ye.error(`Error while triggering instrumentation handler.
Type: ${n}
Name: ${us(a)}
Error:`,l)}}let mf=null;function Iw(){mf=pt.onerror,pt.onerror=function(n,e,r,a,l){return Fr("error",{column:a,error:l,line:r,msg:n,url:e}),!!mf&&mf.apply(this,arguments)},pt.onerror.__SENTRY_INSTRUMENTED__=!0}let vf=null;function xw(){vf=pt.onunhandledrejection,pt.onunhandledrejection=function(n){return Fr("unhandledrejection",n),!vf||vf.apply(this,arguments)},pt.onunhandledrejection.__SENTRY_INSTRUMENTED__=!0}function ru(){return yf(pt),pt}function yf(n){const e=n.__SENTRY__=n.__SENTRY__||{};return e.version=e.version||co,e[co]=e[co]||{}}const em=Object.prototype.toString;function _f(n){switch(em.call(n)){case"[object Error]":case"[object Exception]":case"[object DOMException]":case"[object WebAssembly.Exception]":return!0;default:return po(n,Error)}}function fa(n,e){return em.call(n)===`[object ${e}]`}function tm(n){return fa(n,"ErrorEvent")}function nm(n){return fa(n,"DOMError")}function Ni(n){return fa(n,"String")}function wf(n){return typeof n=="object"&&n!==null&&"__sentry_template_string__"in n&&"__sentry_template_values__"in n}function bf(n){return n===null||wf(n)||typeof n!="object"&&typeof n!="function"}function ha(n){return fa(n,"Object")}function iu(n){return typeof Event<"u"&&po(n,Event)}function su(n){return!!(n&&n.then&&typeof n.then=="function")}function po(n,e){try{return n instanceof e}catch{return!1}}function rm(n){return!(typeof n!="object"||n===null||!n.__isVue&&!n._isVue)}const Sf=pt;function im(n,e={}){if(!n)return"<unknown>";try{let r=n;const a=5,l=[];let f=0,h=0;const v=" > ",y=v.length;let k;const E=Array.isArray(e)?e:e.keyAttrs,O=!Array.isArray(e)&&e.maxStringLength||80;for(;r&&f++<a&&(k=Lw(r,E),!(k==="html"||f>1&&h+l.length*y+k.length>=O));)l.push(k),h+=k.length,r=r.parentNode;return l.reverse().join(v)}catch{return"<unknown>"}}function Lw(n,e){const r=n,a=[];if(!r||!r.tagName)return"";if(Sf.HTMLElement&&r instanceof HTMLElement&&r.dataset){if(r.dataset.sentryComponent)return r.dataset.sentryComponent;if(r.dataset.sentryElement)return r.dataset.sentryElement}a.push(r.tagName.toLowerCase());const l=e&&e.length?e.filter((h=>r.getAttribute(h))).map((h=>[h,r.getAttribute(h)])):null;if(l&&l.length)l.forEach((h=>{a.push(`[${h[0]}="${h[1]}"]`)}));else{r.id&&a.push(`#${r.id}`);const h=r.className;if(h&&Ni(h)){const v=h.split(/\s+/);for(const y of v)a.push(`.${y}`)}}const f=["aria-label","type","name","title","alt"];for(const h of f){const v=r.getAttribute(h);v&&a.push(`[${h}="${v}"]`)}return a.join("")}function pa(n,e=0){return typeof n!="string"||e===0||n.length<=e?n:`${n.slice(0,e)}...`}function sm(n,e){if(!Array.isArray(n))return"";const r=[];for(let a=0;a<n.length;a++){const l=n[a];try{rm(l)?r.push("[VueViewModel]"):r.push(String(l))}catch{r.push("[value cannot be serialized]")}}return r.join(e)}function jw(n,e,r=!1){return!!Ni(n)&&(fa(e,"RegExp")?e.test(n):!!Ni(e)&&(r?n===e:n.includes(e)))}function ou(n,e=[],r=!1){return e.some((a=>jw(n,a,r)))}function lr(n,e,r){if(!(e in n))return;const a=n[e],l=r(a);typeof l=="function"&&om(l,a);try{n[e]=l}catch{lo&&Ye.log(`Failed to replace method "${e}" in object`,n)}}function go(n,e,r){try{Object.defineProperty(n,e,{value:r,writable:!0,configurable:!0})}catch{lo&&Ye.log(`Failed to add non-enumerable property "${e}" to object`,n)}}function om(n,e){try{const r=e.prototype||{};n.prototype=e.prototype=r,go(n,"__sentry_original__",e)}catch{}}function kf(n){return n.__sentry_original__}function am(n){if(_f(n))return{message:n.message,name:n.name,stack:n.stack,...lm(n)};if(iu(n)){const e={type:n.type,target:cm(n.target),currentTarget:cm(n.currentTarget),...lm(n)};return typeof CustomEvent<"u"&&po(n,CustomEvent)&&(e.detail=n.detail),e}return n}function cm(n){try{return e=n,typeof Element<"u"&&po(e,Element)?im(n):Object.prototype.toString.call(n)}catch{return"<unknown>"}var e}function lm(n){if(typeof n=="object"&&n!==null){const e={};for(const r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r]);return e}return{}}function wr(n){return Cf(n,new Map)}function Cf(n,e){if((function(r){if(!ha(r))return!1;try{const a=Object.getPrototypeOf(r).constructor.name;return!a||a==="Object"}catch{return!0}})(n)){const r=e.get(n);if(r!==void 0)return r;const a={};e.set(n,a);for(const l of Object.getOwnPropertyNames(n))n[l]!==void 0&&(a[l]=Cf(n[l],e));return a}if(Array.isArray(n)){const r=e.get(n);if(r!==void 0)return r;const a=[];return e.set(n,a),n.forEach((l=>{a.push(Cf(l,e))})),a}return n}function wc(){return Date.now()/1e3}const Di=(function(){const{performance:n}=pt;if(!n||!n.now)return wc;const e=Date.now()-n.now(),r=n.timeOrigin==null?e:n.timeOrigin;return()=>(r+n.now())/1e3})();function br(){const n=pt,e=n.crypto||n.msCrypto;let r=()=>16*Math.random();try{if(e&&e.randomUUID)return e.randomUUID().replace(/-/g,"");e&&e.getRandomValues&&(r=()=>{const a=new Uint8Array(1);return e.getRandomValues(a),a[0]})}catch{}return("10000000100040008000"+1e11).replace(/[018]/g,(a=>(a^(15&r())>>a/4).toString(16)))}function um(n){return n.exception&&n.exception.values?n.exception.values[0]:void 0}function ds(n){const{message:e,event_id:r}=n;if(e)return e;const a=um(n);return a?a.type&&a.value?`${a.type}: ${a.value}`:a.type||a.value||r||"<unknown>":r||"<unknown>"}function Ef(n,e,r){const a=n.exception=n.exception||{},l=a.values=a.values||[],f=l[0]=l[0]||{};f.value||(f.value=e||""),f.type||(f.type="Error")}function ga(n,e){const r=um(n);if(!r)return;const a=r.mechanism;if(r.mechanism={type:"generic",handled:!0,...a,...e},e&&"data"in e){const l={...a&&a.data,...e.data};r.mechanism.data=l}}function dm(n){if((function(e){try{return e.__sentry_captured__}catch{}})(n))return!0;try{go(n,"__sentry_captured__",!0)}catch{}return!1}var Ui;function mo(n){return new Sr((e=>{e(n)}))}function au(n){return new Sr(((e,r)=>{r(n)}))}(()=>{const{performance:n}=pt;!n||!n.now||(n.now(),n.timing&&n.timing.navigationStart)})(),(function(n){n[n.PENDING=0]="PENDING",n[n.RESOLVED=1]="RESOLVED",n[n.REJECTED=2]="REJECTED"})(Ui||(Ui={}));class Sr{constructor(e){Sr.prototype.__init.call(this),Sr.prototype.__init2.call(this),Sr.prototype.__init3.call(this),Sr.prototype.__init4.call(this),this._state=Ui.PENDING,this._handlers=[];try{e(this._resolve,this._reject)}catch(r){this._reject(r)}}then(e,r){return new Sr(((a,l)=>{this._handlers.push([!1,f=>{if(e)try{a(e(f))}catch(h){l(h)}else a(f)},f=>{if(r)try{a(r(f))}catch(h){l(h)}else l(f)}]),this._executeHandlers()}))}catch(e){return this.then((r=>r),e)}finally(e){return new Sr(((r,a)=>{let l,f;return this.then((h=>{f=!1,l=h,e&&e()}),(h=>{f=!0,l=h,e&&e()})).then((()=>{f?a(l):r(l)}))}))}__init(){this._resolve=e=>{this._setResult(Ui.RESOLVED,e)}}__init2(){this._reject=e=>{this._setResult(Ui.REJECTED,e)}}__init3(){this._setResult=(e,r)=>{this._state===Ui.PENDING&&(su(r)?r.then(this._resolve,this._reject):(this._state=e,this._value=r,this._executeHandlers()))}}__init4(){this._executeHandlers=()=>{if(this._state===Ui.PENDING)return;const e=this._handlers.slice();this._handlers=[],e.forEach((r=>{r[0]||(this._state===Ui.RESOLVED&&r[1](this._value),this._state===Ui.REJECTED&&r[2](this._value),r[0]=!0)}))}}}function Nw(n){const e=Di(),r={sid:br(),init:!0,timestamp:e,started:e,duration:0,status:"ok",errors:0,ignoreDuration:!1,toJSON:()=>(function(a){return wr({sid:`${a.sid}`,init:a.init,started:new Date(1e3*a.started).toISOString(),timestamp:new Date(1e3*a.timestamp).toISOString(),status:a.status,errors:a.errors,did:typeof a.did=="number"||typeof a.did=="string"?`${a.did}`:void 0,duration:a.duration,abnormal_mechanism:a.abnormal_mechanism,attrs:{release:a.release,environment:a.environment,ip_address:a.ipAddress,user_agent:a.userAgent}})})(r)};return n&&ma(r,n),r}function ma(n,e={}){if(e.user&&(!n.ipAddress&&e.user.ip_address&&(n.ipAddress=e.user.ip_address),n.did||e.did||(n.did=e.user.id||e.user.email||e.user.username)),n.timestamp=e.timestamp||Di(),e.abnormal_mechanism&&(n.abnormal_mechanism=e.abnormal_mechanism),e.ignoreDuration&&(n.ignoreDuration=e.ignoreDuration),e.sid&&(n.sid=e.sid.length===32?e.sid:br()),e.init!==void 0&&(n.init=e.init),!n.did&&e.did&&(n.did=`${e.did}`),typeof e.started=="number"&&(n.started=e.started),n.ignoreDuration)n.duration=void 0;else if(typeof e.duration=="number")n.duration=e.duration;else{const r=n.timestamp-n.started;n.duration=r>=0?r:0}e.release&&(n.release=e.release),e.environment&&(n.environment=e.environment),!n.ipAddress&&e.ipAddress&&(n.ipAddress=e.ipAddress),!n.userAgent&&e.userAgent&&(n.userAgent=e.userAgent),typeof e.errors=="number"&&(n.errors=e.errors),e.status&&(n.status=e.status)}function fm(){return br()}function Mf(){return br().substring(16)}function cu(n,e,r=2){if(!e||typeof e!="object"||r<=0)return e;if(n&&e&&Object.keys(e).length===0)return n;const a={...n};for(const l in e)Object.prototype.hasOwnProperty.call(e,l)&&(a[l]=cu(a[l],e[l],r-1));return a}const Of="_sentrySpan";function hm(n,e){e?go(n,Of,e):delete n[Of]}function pm(n){return n[Of]}class Tf{constructor(){this._notifyingListeners=!1,this._scopeListeners=[],this._eventProcessors=[],this._breadcrumbs=[],this._attachments=[],this._user={},this._tags={},this._extra={},this._contexts={},this._sdkProcessingMetadata={},this._propagationContext={traceId:fm(),spanId:Mf()}}clone(){const e=new Tf;return e._breadcrumbs=[...this._breadcrumbs],e._tags={...this._tags},e._extra={...this._extra},e._contexts={...this._contexts},this._contexts.flags&&(e._contexts.flags={values:[...this._contexts.flags.values]}),e._user=this._user,e._level=this._level,e._session=this._session,e._transactionName=this._transactionName,e._fingerprint=this._fingerprint,e._eventProcessors=[...this._eventProcessors],e._requestSession=this._requestSession,e._attachments=[...this._attachments],e._sdkProcessingMetadata={...this._sdkProcessingMetadata},e._propagationContext={...this._propagationContext},e._client=this._client,e._lastEventId=this._lastEventId,hm(e,pm(this)),e}setClient(e){this._client=e}setLastEventId(e){this._lastEventId=e}getClient(){return this._client}lastEventId(){return this._lastEventId}addScopeListener(e){this._scopeListeners.push(e)}addEventProcessor(e){return this._eventProcessors.push(e),this}setUser(e){return this._user=e||{email:void 0,id:void 0,ip_address:void 0,username:void 0},this._session&&ma(this._session,{user:e}),this._notifyScopeListeners(),this}getUser(){return this._user}getRequestSession(){return this._requestSession}setRequestSession(e){return this._requestSession=e,this}setTags(e){return this._tags={...this._tags,...e},this._notifyScopeListeners(),this}setTag(e,r){return this._tags={...this._tags,[e]:r},this._notifyScopeListeners(),this}setExtras(e){return this._extra={...this._extra,...e},this._notifyScopeListeners(),this}setExtra(e,r){return this._extra={...this._extra,[e]:r},this._notifyScopeListeners(),this}setFingerprint(e){return this._fingerprint=e,this._notifyScopeListeners(),this}setLevel(e){return this._level=e,this._notifyScopeListeners(),this}setTransactionName(e){return this._transactionName=e,this._notifyScopeListeners(),this}setContext(e,r){return r===null?delete this._contexts[e]:this._contexts[e]=r,this._notifyScopeListeners(),this}setSession(e){return e?this._session=e:delete this._session,this._notifyScopeListeners(),this}getSession(){return this._session}update(e){if(!e)return this;const r=typeof e=="function"?e(this):e,[a,l]=r instanceof fs?[r.getScopeData(),r.getRequestSession()]:ha(r)?[e,e.requestSession]:[],{tags:f,extra:h,user:v,contexts:y,level:k,fingerprint:E=[],propagationContext:O}=a||{};return this._tags={...this._tags,...f},this._extra={...this._extra,...h},this._contexts={...this._contexts,...y},v&&Object.keys(v).length&&(this._user=v),k&&(this._level=k),E.length&&(this._fingerprint=E),O&&(this._propagationContext=O),l&&(this._requestSession=l),this}clear(){return this._breadcrumbs=[],this._tags={},this._extra={},this._user={},this._contexts={},this._level=void 0,this._transactionName=void 0,this._fingerprint=void 0,this._requestSession=void 0,this._session=void 0,hm(this,void 0),this._attachments=[],this.setPropagationContext({traceId:fm()}),this._notifyScopeListeners(),this}addBreadcrumb(e,r){const a=typeof r=="number"?r:100;if(a<=0)return this;const l={timestamp:wc(),...e};return this._breadcrumbs.push(l),this._breadcrumbs.length>a&&(this._breadcrumbs=this._breadcrumbs.slice(-a),this._client&&this._client.recordDroppedEvent("buffer_overflow","log_item")),this._notifyScopeListeners(),this}getLastBreadcrumb(){return this._breadcrumbs[this._breadcrumbs.length-1]}clearBreadcrumbs(){return this._breadcrumbs=[],this._notifyScopeListeners(),this}addAttachment(e){return this._attachments.push(e),this}clearAttachments(){return this._attachments=[],this}getScopeData(){return{breadcrumbs:this._breadcrumbs,attachments:this._attachments,contexts:this._contexts,tags:this._tags,extra:this._extra,user:this._user,level:this._level,fingerprint:this._fingerprint||[],eventProcessors:this._eventProcessors,propagationContext:this._propagationContext,sdkProcessingMetadata:this._sdkProcessingMetadata,transactionName:this._transactionName,span:pm(this)}}setSDKProcessingMetadata(e){return this._sdkProcessingMetadata=cu(this._sdkProcessingMetadata,e,2),this}setPropagationContext(e){return this._propagationContext={spanId:Mf(),...e},this}getPropagationContext(){return this._propagationContext}captureException(e,r){const a=r&&r.event_id?r.event_id:br();if(!this._client)return Ye.warn("No client configured on scope - will not capture exception!"),a;const l=new Error("Sentry syntheticException");return this._client.captureException(e,{originalException:e,syntheticException:l,...r,event_id:a},this),a}captureMessage(e,r,a){const l=a&&a.event_id?a.event_id:br();if(!this._client)return Ye.warn("No client configured on scope - will not capture message!"),l;const f=new Error(e);return this._client.captureMessage(e,r,{originalException:e,syntheticException:f,...a,event_id:l},this),l}captureEvent(e,r){const a=r&&r.event_id?r.event_id:br();return this._client?(this._client.captureEvent(e,{...r,event_id:a},this),a):(Ye.warn("No client configured on scope - will not capture event!"),a)}_notifyScopeListeners(){this._notifyingListeners||(this._notifyingListeners=!0,this._scopeListeners.forEach((e=>{e(this)})),this._notifyingListeners=!1)}}const fs=Tf;class Dw{constructor(e,r){let a,l;a=e||new fs,l=r||new fs,this._stack=[{scope:a}],this._isolationScope=l}withScope(e){const r=this._pushScope();let a;try{a=e(r)}catch(l){throw this._popScope(),l}return su(a)?a.then((l=>(this._popScope(),l)),(l=>{throw this._popScope(),l})):(this._popScope(),a)}getClient(){return this.getStackTop().client}getScope(){return this.getStackTop().scope}getIsolationScope(){return this._isolationScope}getStackTop(){return this._stack[this._stack.length-1]}_pushScope(){const e=this.getScope().clone();return this._stack.push({client:this.getClient(),scope:e}),e}_popScope(){return!(this._stack.length<=1)&&!!this._stack.pop()}}function va(){const n=yf(ru());return n.stack=n.stack||new Dw(Zl("defaultCurrentScope",(()=>new fs)),Zl("defaultIsolationScope",(()=>new fs)))}function Uw(n){return va().withScope(n)}function Bw(n,e){const r=va();return r.withScope((()=>(r.getStackTop().scope=n,e(n))))}function gm(n){return va().withScope((()=>n(va().getIsolationScope())))}function Rf(n){const e=yf(n);return e.acs?e.acs:{withIsolationScope:gm,withScope:Uw,withSetScope:Bw,withSetIsolationScope:(r,a)=>gm(a),getCurrentScope:()=>va().getScope(),getIsolationScope:()=>va().getIsolationScope()}}function vo(){return Rf(ru()).getCurrentScope()}function bc(){return Rf(ru()).getIsolationScope()}function vn(){return vo().getClient()}function Fw(n){const e=n.getPropagationContext(),{traceId:r,spanId:a,parentSpanId:l}=e;return wr({trace_id:r,span_id:a,parent_span_id:l})}function Vw(n){const e=n._sentryMetrics;if(!e)return;const r={};for(const[,[a,l]]of e)(r[a]||(r[a]=[])).push(wr(l));return r}const zw=/^sentry-/;function qw(n){const e=(function(a){if(!(!a||!Ni(a)&&!Array.isArray(a)))return Array.isArray(a)?a.reduce(((l,f)=>{const h=mm(f);return Object.entries(h).forEach((([v,y])=>{l[v]=y})),l}),{}):mm(a)})(n);if(!e)return;const r=Object.entries(e).reduce(((a,[l,f])=>(l.match(zw)&&(a[l.slice(7)]=f),a)),{});return Object.keys(r).length>0?r:void 0}function mm(n){return n.split(",").map((e=>e.split("=").map((r=>decodeURIComponent(r.trim()))))).reduce(((e,[r,a])=>(r&&a&&(e[r]=a),e)),{})}let vm=!1;function $w(n){const{spanId:e,traceId:r,isRemote:a}=n.spanContext();return wr({parent_span_id:a?e:Af(n).parent_span_id,span_id:a?Mf():e,trace_id:r})}function ym(n){return typeof n=="number"?_m(n):Array.isArray(n)?n[0]+n[1]/1e9:n instanceof Date?_m(n.getTime()):Di()}function _m(n){return n>9999999999?n/1e3:n}function Af(n){if((function(e){return typeof e.getSpanJSON=="function"})(n))return n.getSpanJSON();try{const{spanId:e,traceId:r}=n.spanContext();if((function(a){const l=a;return!!(l.attributes&&l.startTime&&l.name&&l.endTime&&l.status)})(n)){const{attributes:a,startTime:l,name:f,endTime:h,parentSpanId:v,status:y}=n;return wr({span_id:e,trace_id:r,data:a,description:f,parent_span_id:v,start_timestamp:ym(l),timestamp:ym(h)||void 0,status:Ww(y),op:a["sentry.op"],origin:a["sentry.origin"],_metrics_summary:Vw(n)})}return{span_id:e,trace_id:r}}catch{return{}}}function Ww(n){if(n&&n.code!==0)return n.code===1?"ok":n.message||"unknown_error"}function wm(n){return n._sentryRootSpan||n}function Gw(){vm||(_c((()=>{console.warn("[Sentry] Deprecation warning: Returning null from `beforeSendSpan` will be disallowed from SDK version 9.0.0 onwards. The callback will only support mutating spans. To drop certain spans, configure the respective integrations directly.")})),vm=!0)}const Pf="production";function bm(n,e){const r=e.getOptions(),{publicKey:a}=e.getDsn()||{},l=wr({environment:r.environment||Pf,release:r.release,public_key:a,trace_id:n});return e.emit("createDsc",l),l}function Hw(n){const e=vn();if(!e)return{};const r=wm(n),a=r._frozenDsc;if(a)return a;const l=r.spanContext().traceState,f=l&&l.get("sentry.dsc"),h=f&&qw(f);if(h)return h;const v=bm(n.spanContext().traceId,e),y=Af(r),k=y.data||{},E=k["sentry.sample_rate"];E!=null&&(v.sample_rate=`${E}`);const O=k["sentry.source"],D=y.description;return O!=="url"&&D&&(v.transaction=D),(function(x){if(typeof __SENTRY_TRACING__=="boolean"&&!__SENTRY_TRACING__)return!1;const L=vn(),R=L&&L.getOptions();return!!R&&(R.enableTracing||"tracesSampleRate"in R||"tracesSampler"in R)})()&&(v.sampled=String((function(x){const{traceFlags:L}=x.spanContext();return L===1})(r))),e.emit("createDsc",v,r),v}const Jw=/^(?:(\w+):)\/\/(?:(\w+)(?::(\w+)?)?@)([\w.-]+)(?::(\d+))?\/(.+)/;function lu(n,e=!1){const{host:r,path:a,pass:l,port:f,projectId:h,protocol:v,publicKey:y}=n;return`${v}://${y}${e&&l?`:${l}`:""}@${r}${f?`:${f}`:""}/${a&&`${a}/`}${h}`}function Sm(n){return{protocol:n.protocol,publicKey:n.publicKey||"",pass:n.pass||"",host:n.host,port:n.port||"",path:n.path||"",projectId:n.projectId}}function Qw(n){const e=typeof n=="string"?(function(r){const a=Jw.exec(r);if(!a)return void _c((()=>{console.error(`Invalid Sentry Dsn: ${r}`)}));const[l,f,h="",v="",y="",k=""]=a.slice(1);let E="",O=k;const D=O.split("/");if(D.length>1&&(E=D.slice(0,-1).join("/"),O=D.pop()),O){const x=O.match(/^\d+/);x&&(O=x[0])}return Sm({host:v,pass:h,path:E,projectId:O,port:y,protocol:l,publicKey:f})})(n):Sm(n);if(e&&(function(r){if(!lo)return!0;const{port:a,projectId:l,protocol:f}=r;return!(["protocol","publicKey","host","projectId"].find((h=>!r[h]&&(Ye.error(`Invalid Sentry Dsn: ${h} missing`),!0)))||(l.match(/^\d+$/)?(function(h){return h==="http"||h==="https"})(f)?a&&isNaN(parseInt(a,10))&&(Ye.error(`Invalid Sentry Dsn: Invalid port ${a}`),1):(Ye.error(`Invalid Sentry Dsn: Invalid protocol ${f}`),1):(Ye.error(`Invalid Sentry Dsn: Invalid projectId ${l}`),1)))})(e))return e}function Bi(n,e=100,r=1/0){try{return If("",n,e,r)}catch(a){return{ERROR:`**non-serializable** (${a})`}}}function km(n,e=3,r=102400){const a=Bi(n,e);return l=a,(function(f){return~-encodeURI(f).split(/%..|./).length})(JSON.stringify(l))>r?km(n,e-1,r):a;var l}function If(n,e,r=1/0,a=1/0,l=(function(){const f=typeof WeakSet=="function",h=f?new WeakSet:[];return[function(v){if(f)return!!h.has(v)||(h.add(v),!1);for(let y=0;y<h.length;y++)if(h[y]===v)return!0;return h.push(v),!1},function(v){if(f)h.delete(v);else for(let y=0;y<h.length;y++)if(h[y]===v){h.splice(y,1);break}}]})()){const[f,h]=l;if(e==null||["boolean","string"].includes(typeof e)||typeof e=="number"&&Number.isFinite(e))return e;const v=(function(x,L){try{if(x==="domain"&&L&&typeof L=="object"&&L._events)return"[Domain]";if(x==="domainEmitter")return"[DomainEmitter]";if(typeof global<"u"&&L===global)return"[Global]";if(typeof window<"u"&&L===window)return"[Window]";if(typeof document<"u"&&L===document)return"[Document]";if(rm(L))return"[VueViewModel]";if(ha(R=L)&&"nativeEvent"in R&&"preventDefault"in R&&"stopPropagation"in R)return"[SyntheticEvent]";if(typeof L=="number"&&!Number.isFinite(L))return`[${L}]`;if(typeof L=="function")return`[Function: ${us(L)}]`;if(typeof L=="symbol")return`[${String(L)}]`;if(typeof L=="bigint")return`[BigInt: ${String(L)}]`;const N=(function(q){const Q=Object.getPrototypeOf(q);return Q?Q.constructor.name:"null prototype"})(L);return/^HTML(\w*)Element$/.test(N)?`[HTMLElement: ${N}]`:`[object ${N}]`}catch(N){return`**non-serializable** (${N})`}var R})(n,e);if(!v.startsWith("[object "))return v;if(e.__sentry_skip_normalization__)return e;const y=typeof e.__sentry_override_normalization_depth__=="number"?e.__sentry_override_normalization_depth__:r;if(y===0)return v.replace("object ","");if(f(e))return"[Circular ~]";const k=e;if(k&&typeof k.toJSON=="function")try{return If("",k.toJSON(),y-1,a,l)}catch{}const E=Array.isArray(e)?[]:{};let O=0;const D=am(e);for(const x in D){if(!Object.prototype.hasOwnProperty.call(D,x))continue;if(O>=a){E[x]="[MaxProperties ~]";break}const L=D[x];E[x]=If(x,L,y-1,a,l),O++}return h(e),E}function Sc(n,e=[]){return[n,e]}function Kw(n,e){const[r,a]=n;return[r,[...a,e]]}function Cm(n,e){const r=n[1];for(const a of r)if(e(a,a[0].type))return!0;return!1}function xf(n){return pt.__SENTRY__&&pt.__SENTRY__.encodePolyfill?pt.__SENTRY__.encodePolyfill(n):new TextEncoder().encode(n)}function Yw(n){const[e,r]=n;let a=JSON.stringify(e);function l(f){typeof a=="string"?a=typeof f=="string"?a+f:[xf(a),f]:a.push(typeof f=="string"?xf(f):f)}for(const f of r){const[h,v]=f;if(l(`
${JSON.stringify(h)}
`),typeof v=="string"||v instanceof Uint8Array)l(v);else{let y;try{y=JSON.stringify(v)}catch{y=JSON.stringify(Bi(v))}l(y)}}return typeof a=="string"?a:(function(f){const h=f.reduce(((k,E)=>k+E.length),0),v=new Uint8Array(h);let y=0;for(const k of f)v.set(k,y),y+=k.length;return v})(a)}function Xw(n){const e=typeof n.data=="string"?xf(n.data):n.data;return[wr({type:"attachment",length:e.length,filename:n.filename,content_type:n.contentType,attachment_type:n.attachmentType}),e]}const Zw={session:"session",sessions:"session",attachment:"attachment",transaction:"transaction",event:"error",client_report:"internal",user_report:"default",profile:"profile",profile_chunk:"profile",replay_event:"replay",replay_recording:"replay",check_in:"monitor",feedback:"feedback",span:"span",statsd:"metric_bucket",raw_security:"security"};function Em(n){return Zw[n]}function Mm(n){if(!n||!n.sdk)return;const{name:e,version:r}=n.sdk;return{name:e,version:r}}function eb(n,e,r,a){const l=Mm(r),f=n.type&&n.type!=="replay_event"?n.type:"event";(function(v,y){y&&(v.sdk=v.sdk||{},v.sdk.name=v.sdk.name||y.name,v.sdk.version=v.sdk.version||y.version,v.sdk.integrations=[...v.sdk.integrations||[],...y.integrations||[]],v.sdk.packages=[...v.sdk.packages||[],...y.packages||[]])})(n,r&&r.sdk);const h=(function(v,y,k,E){const O=v.sdkProcessingMetadata&&v.sdkProcessingMetadata.dynamicSamplingContext;return{event_id:v.event_id,sent_at:new Date().toISOString(),...y&&{sdk:y},...!!k&&E&&{dsn:lu(E)},...O&&{trace:wr({...O})}}})(n,l,a,e);return delete n.sdkProcessingMetadata,Sc(h,[[{type:f},n]])}function Lf(n,e,r,a=0){return new Sr(((l,f)=>{const h=n[a];if(e===null||typeof h!="function")l(e);else{const v=h({...e},r);Ct&&h.id&&v===null&&Ye.log(`Event processor "${h.id}" dropped event`),su(v)?v.then((y=>Lf(n,y,r,a+1).then(l))).then(null,f):Lf(n,v,r,a+1).then(l).then(null,f)}}))}let uu,Om,jf;function tb(n,e){const{fingerprint:r,span:a,breadcrumbs:l,sdkProcessingMetadata:f}=e;(function(h,v){const{extra:y,tags:k,user:E,contexts:O,level:D,transactionName:x}=v,L=wr(y);L&&Object.keys(L).length&&(h.extra={...L,...h.extra});const R=wr(k);R&&Object.keys(R).length&&(h.tags={...R,...h.tags});const N=wr(E);N&&Object.keys(N).length&&(h.user={...N,...h.user});const q=wr(O);q&&Object.keys(q).length&&(h.contexts={...q,...h.contexts}),D&&(h.level=D),x&&h.type!=="transaction"&&(h.transaction=x)})(n,e),a&&(function(h,v){h.contexts={trace:$w(v),...h.contexts},h.sdkProcessingMetadata={dynamicSamplingContext:Hw(v),...h.sdkProcessingMetadata};const y=wm(v),k=Af(y).description;k&&!h.transaction&&h.type==="transaction"&&(h.transaction=k)})(n,a),(function(h,v){h.fingerprint=h.fingerprint?Array.isArray(h.fingerprint)?h.fingerprint:[h.fingerprint]:[],v&&(h.fingerprint=h.fingerprint.concat(v)),h.fingerprint&&!h.fingerprint.length&&delete h.fingerprint})(n,r),(function(h,v){const y=[...h.breadcrumbs||[],...v];h.breadcrumbs=y.length?y:void 0})(n,l),(function(h,v){h.sdkProcessingMetadata={...h.sdkProcessingMetadata,...v}})(n,f)}function Tm(n,e){const{extra:r,tags:a,user:l,contexts:f,level:h,sdkProcessingMetadata:v,breadcrumbs:y,fingerprint:k,eventProcessors:E,attachments:O,propagationContext:D,transactionName:x,span:L}=e;du(n,"extra",r),du(n,"tags",a),du(n,"user",l),du(n,"contexts",f),n.sdkProcessingMetadata=cu(n.sdkProcessingMetadata,v,2),h&&(n.level=h),x&&(n.transactionName=x),L&&(n.span=L),y.length&&(n.breadcrumbs=[...n.breadcrumbs,...y]),k.length&&(n.fingerprint=[...n.fingerprint,...k]),E.length&&(n.eventProcessors=[...n.eventProcessors,...E]),O.length&&(n.attachments=[...n.attachments,...O]),n.propagationContext={...n.propagationContext,...D}}function du(n,e,r){n[e]=cu(n[e],r,1)}function nb(n,e,r,a,l,f){const{normalizeDepth:h=3,normalizeMaxBreadth:v=1e3}=n,y={...e,event_id:e.event_id||r.event_id||br(),timestamp:e.timestamp||wc()},k=r.integrations||n.integrations.map((L=>L.name));(function(L,R){const{environment:N,release:q,dist:Q,maxValueLength:ee=250}=R;L.environment=L.environment||N||Pf,!L.release&&q&&(L.release=q),!L.dist&&Q&&(L.dist=Q),L.message&&(L.message=pa(L.message,ee));const P=L.exception&&L.exception.values&&L.exception.values[0];P&&P.value&&(P.value=pa(P.value,ee));const $=L.request;$&&$.url&&($.url=pa($.url,ee))})(y,n),(function(L,R){R.length>0&&(L.sdk=L.sdk||{},L.sdk.integrations=[...L.sdk.integrations||[],...R])})(y,k),l&&l.emit("applyFrameMetadata",e),e.type===void 0&&(function(L,R){const N=(function(q){const Q=pt._sentryDebugIds;if(!Q)return{};const ee=Object.keys(Q);return jf&&ee.length===Om||(Om=ee.length,jf=ee.reduce(((P,$)=>{uu||(uu={});const G=uu[$];if(G)P[G[0]]=G[1];else{const ae=q($);for(let ye=ae.length-1;ye>=0;ye--){const Ce=ae[ye],Ve=Ce&&Ce.filename,S=Q[$];if(Ve&&S){P[Ve]=S,uu[$]=[Ve,S];break}}}return P}),{})),jf})(R);try{L.exception.values.forEach((q=>{q.stacktrace.frames.forEach((Q=>{N&&Q.filename&&(Q.debug_id=N[Q.filename])}))}))}catch{}})(y,n.stackParser);const E=(function(L,R){if(!R)return L;const N=L?L.clone():new fs;return N.update(R),N})(a,r.captureContext);r.mechanism&&ga(y,r.mechanism);const O=l?l.getEventProcessors():[],D=Zl("globalScope",(()=>new fs)).getScopeData();f&&Tm(D,f.getScopeData()),E&&Tm(D,E.getScopeData());const x=[...r.attachments||[],...D.attachments];return x.length&&(r.attachments=x),tb(y,D),Lf([...O,...D.eventProcessors],y,r).then((L=>(L&&(function(R){const N={};try{R.exception.values.forEach((Q=>{Q.stacktrace.frames.forEach((ee=>{ee.debug_id&&(ee.abs_path?N[ee.abs_path]=ee.debug_id:ee.filename&&(N[ee.filename]=ee.debug_id),delete ee.debug_id)}))}))}catch{}if(Object.keys(N).length===0)return;R.debug_meta=R.debug_meta||{},R.debug_meta.images=R.debug_meta.images||[];const q=R.debug_meta.images;Object.entries(N).forEach((([Q,ee])=>{q.push({type:"sourcemap",code_file:Q,debug_id:ee})}))})(L),typeof h=="number"&&h>0?(function(R,N,q){if(!R)return null;const Q={...R,...R.breadcrumbs&&{breadcrumbs:R.breadcrumbs.map((ee=>({...ee,...ee.data&&{data:Bi(ee.data,N,q)}})))},...R.user&&{user:Bi(R.user,N,q)},...R.contexts&&{contexts:Bi(R.contexts,N,q)},...R.extra&&{extra:Bi(R.extra,N,q)}};return R.contexts&&R.contexts.trace&&Q.contexts&&(Q.contexts.trace=R.contexts.trace,R.contexts.trace.data&&(Q.contexts.trace.data=Bi(R.contexts.trace.data,N,q))),R.spans&&(Q.spans=R.spans.map((ee=>({...ee,...ee.data&&{data:Bi(ee.data,N,q)}})))),R.contexts&&R.contexts.flags&&Q.contexts&&(Q.contexts.flags=Bi(R.contexts.flags,3,q)),Q})(L,h,v):L)))}function l1(n){}function Rm(n,e){return vo().captureEvent(n,e)}function Am(n){const e=vn(),r=bc(),a=vo(),{release:l,environment:f=Pf}=e&&e.getOptions()||{},{userAgent:h}=pt.navigator||{},v=Nw({release:l,environment:f,user:a.getUser()||r.getUser(),...h&&{userAgent:h},...n}),y=r.getSession();return y&&y.status==="ok"&&ma(y,{status:"exited"}),Pm(),r.setSession(v),a.setSession(v),v}function Pm(){const n=bc(),e=vo(),r=e.getSession()||n.getSession();r&&(function(a,l){let f={};a.status==="ok"&&(f={status:"exited"}),ma(a,f)})(r),Im(),n.setSession(),e.setSession()}function Im(){const n=bc(),e=vo(),r=vn(),a=e.getSession()||n.getSession();a&&r&&r.captureSession(a)}function xm(n=!1){n?Pm():Im()}function rb(n,e,r){return e||`${(function(a){return`${(function(l){const f=l.protocol?`${l.protocol}:`:"",h=l.port?`:${l.port}`:"";return`${f}//${l.host}${h}${l.path?`/${l.path}`:""}/api/`})(a)}${a.projectId}/envelope/`})(n)}?${(function(a,l){const f={sentry_version:"7"};return a.publicKey&&(f.sentry_key=a.publicKey),l&&(f.sentry_client=`${l.name}/${l.version}`),new URLSearchParams(f).toString()})(n,r)}`}const Lm=[];function jm(n,e){for(const r of e)r&&r.afterAllSetup&&r.afterAllSetup(n)}function Nm(n,e,r){if(r[e.name])Ct&&Ye.log(`Integration skipped because it was already installed: ${e.name}`);else{if(r[e.name]=e,Lm.indexOf(e.name)===-1&&typeof e.setupOnce=="function"&&(e.setupOnce(),Lm.push(e.name)),e.setup&&typeof e.setup=="function"&&e.setup(n),typeof e.preprocessEvent=="function"){const a=e.preprocessEvent.bind(e);n.on("preprocessEvent",((l,f)=>a(l,f,n)))}if(typeof e.processEvent=="function"){const a=e.processEvent.bind(e),l=Object.assign(((f,h)=>a(f,h,n)),{id:e.name});n.addEventProcessor(l)}Ct&&Ye.log(`Integration installed: ${e.name}`)}}class Vr extends Error{constructor(e,r="warn"){super(e),this.message=e,this.logLevel=r}}const Dm="Not capturing exception because it's already been captured.";class ib{constructor(e){if(this._options=e,this._integrations={},this._numProcessing=0,this._outcomes={},this._hooks={},this._eventProcessors=[],e.dsn?this._dsn=Qw(e.dsn):Ct&&Ye.warn("No DSN provided, client will not send events."),this._dsn){const a=rb(this._dsn,e.tunnel,e._metadata?e._metadata.sdk:void 0);this._transport=e.transport({tunnel:this._options.tunnel,recordDroppedEvent:this.recordDroppedEvent.bind(this),...e.transportOptions,url:a})}const r=["enableTracing","tracesSampleRate","tracesSampler"].find((a=>a in e&&e[a]==null));r&&_c((()=>{console.warn(`[Sentry] Deprecation warning: \`${r}\` is set to undefined, which leads to tracing being enabled. In v9, a value of \`undefined\` will result in tracing being disabled.`)}))}captureException(e,r,a){const l=br();if(dm(e))return Ct&&Ye.log(Dm),l;const f={event_id:l,...r};return this._process(this.eventFromException(e,f).then((h=>this._captureEvent(h,f,a)))),f.event_id}captureMessage(e,r,a,l){const f={event_id:br(),...a},h=wf(e)?e:String(e),v=bf(e)?this.eventFromMessage(h,r,f):this.eventFromException(e,f);return this._process(v.then((y=>this._captureEvent(y,f,l)))),f.event_id}captureEvent(e,r,a){const l=br();if(r&&r.originalException&&dm(r.originalException))return Ct&&Ye.log(Dm),l;const f={event_id:l,...r},h=(e.sdkProcessingMetadata||{}).capturedSpanScope;return this._process(this._captureEvent(e,f,h||a)),f.event_id}captureSession(e){typeof e.release!="string"?Ct&&Ye.warn("Discarded session because of missing or non-string release"):(this.sendSession(e),ma(e,{init:!1}))}getDsn(){return this._dsn}getOptions(){return this._options}getSdkMetadata(){return this._options._metadata}getTransport(){return this._transport}flush(e){const r=this._transport;return r?(this.emit("flush"),this._isClientDoneProcessing(e).then((a=>r.flush(e).then((l=>a&&l))))):mo(!0)}close(e){return this.flush(e).then((r=>(this.getOptions().enabled=!1,this.emit("close"),r)))}getEventProcessors(){return this._eventProcessors}addEventProcessor(e){this._eventProcessors.push(e)}init(){(this._isEnabled()||this._options.integrations.some((({name:e})=>e.startsWith("Spotlight"))))&&this._setupIntegrations()}getIntegrationByName(e){return this._integrations[e]}addIntegration(e){const r=this._integrations[e.name];Nm(this,e,this._integrations),r||jm(this,[e])}sendEvent(e,r={}){this.emit("beforeSendEvent",e,r);let a=eb(e,this._dsn,this._options._metadata,this._options.tunnel);for(const f of r.attachments||[])a=Kw(a,Xw(f));const l=this.sendEnvelope(a);l&&l.then((f=>this.emit("afterSendEvent",e,f)),null)}sendSession(e){const r=(function(a,l,f,h){const v=Mm(f);return Sc({sent_at:new Date().toISOString(),...v&&{sdk:v},...!!h&&l&&{dsn:lu(l)}},["aggregates"in a?[{type:"sessions"},a]:[{type:"session"},a.toJSON()]])})(e,this._dsn,this._options._metadata,this._options.tunnel);this.sendEnvelope(r)}recordDroppedEvent(e,r,a){if(this._options.sendClientReports){const l=typeof a=="number"?a:1,f=`${e}:${r}`;Ct&&Ye.log(`Recording outcome: "${f}"${l>1?` (${l} times)`:""}`),this._outcomes[f]=(this._outcomes[f]||0)+l}}on(e,r){const a=this._hooks[e]=this._hooks[e]||[];return a.push(r),()=>{const l=a.indexOf(r);l>-1&&a.splice(l,1)}}emit(e,...r){const a=this._hooks[e];a&&a.forEach((l=>l(...r)))}sendEnvelope(e){return this.emit("beforeEnvelope",e),this._isEnabled()&&this._transport?this._transport.send(e).then(null,(r=>(Ct&&Ye.error("Error while sending envelope:",r),r))):(Ct&&Ye.error("Transport disabled"),mo({}))}_setupIntegrations(){const{integrations:e}=this._options;this._integrations=(function(r,a){const l={};return a.forEach((f=>{f&&Nm(r,f,l)})),l})(this,e),jm(this,e)}_updateSessionFromEvent(e,r){let a=r.level==="fatal",l=!1;const f=r.exception&&r.exception.values;if(f){l=!0;for(const v of f){const y=v.mechanism;if(y&&y.handled===!1){a=!0;break}}}const h=e.status==="ok";(h&&e.errors===0||h&&a)&&(ma(e,{...a&&{status:"crashed"},errors:e.errors||Number(l||a)}),this.captureSession(e))}_isClientDoneProcessing(e){return new Sr((r=>{let a=0;const l=setInterval((()=>{this._numProcessing==0?(clearInterval(l),r(!0)):(a+=1,e&&a>=e&&(clearInterval(l),r(!1)))}),1)}))}_isEnabled(){return this.getOptions().enabled!==!1&&this._transport!==void 0}_prepareEvent(e,r,a=vo(),l=bc()){const f=this.getOptions(),h=Object.keys(this._integrations);return!r.integrations&&h.length>0&&(r.integrations=h),this.emit("preprocessEvent",e,r),e.type||l.setLastEventId(e.event_id||r.event_id),nb(f,e,r,a,this,l).then((v=>{if(v===null)return v;v.contexts={trace:Fw(a),...v.contexts};const y=(function(k,E){const O=E.getPropagationContext();return O.dsc||bm(O.traceId,k)})(this,a);return v.sdkProcessingMetadata={dynamicSamplingContext:y,...v.sdkProcessingMetadata},v}))}_captureEvent(e,r={},a){return this._processEvent(e,r,a).then((l=>l.event_id),(l=>{Ct&&(l instanceof Vr&&l.logLevel==="log"?Ye.log(l.message):Ye.warn(l))}))}_processEvent(e,r,a){const l=this.getOptions(),{sampleRate:f}=l,h=Bm(e),v=Um(e),y=e.type||"error",k=`before send for type \`${y}\``,E=f===void 0?void 0:(function(x){if(typeof x=="boolean")return Number(x);const L=typeof x=="string"?parseFloat(x):x;if(!(typeof L!="number"||isNaN(L)||L<0||L>1))return L;Ct&&Ye.warn(`[Tracing] Given sample rate is invalid. Sample rate must be a boolean or a number between 0 and 1. Got ${JSON.stringify(x)} of type ${JSON.stringify(typeof x)}.`)})(f);if(v&&typeof E=="number"&&Math.random()>E)return this.recordDroppedEvent("sample_rate","error",e),au(new Vr(`Discarding event because it's not included in the random sample (sampling rate = ${f})`,"log"));const O=y==="replay_event"?"replay":y,D=(e.sdkProcessingMetadata||{}).capturedSpanIsolationScope;return this._prepareEvent(e,r,a,D).then((x=>{if(x===null)throw this.recordDroppedEvent("event_processor",O,e),new Vr("An event processor returned `null`, will not send event.","log");if(r.data&&r.data.__sentry__===!0)return x;const L=(function(R,N,q,Q){const{beforeSend:ee,beforeSendTransaction:P,beforeSendSpan:$}=N;if(Um(q)&&ee)return ee(q,Q);if(Bm(q)){if(q.spans&&$){const G=[];for(const ae of q.spans){const ye=$(ae);ye?G.push(ye):(Gw(),R.recordDroppedEvent("before_send","span"))}q.spans=G}if(P){if(q.spans){const G=q.spans.length;q.sdkProcessingMetadata={...q.sdkProcessingMetadata,spanCountBeforeProcessing:G}}return P(q,Q)}}return q})(this,l,x,r);return(function(R,N){const q=`${N} must return \`null\` or a valid event.`;if(su(R))return R.then((Q=>{if(!ha(Q)&&Q!==null)throw new Vr(q);return Q}),(Q=>{throw new Vr(`${N} rejected with ${Q}`)}));if(!ha(R)&&R!==null)throw new Vr(q);return R})(L,k)})).then((x=>{if(x===null){if(this.recordDroppedEvent("before_send",O,e),h){const N=1+(e.spans||[]).length;this.recordDroppedEvent("before_send","span",N)}throw new Vr(`${k} returned \`null\`, will not send event.`,"log")}const L=a&&a.getSession();if(!h&&L&&this._updateSessionFromEvent(L,x),h){const N=(x.sdkProcessingMetadata&&x.sdkProcessingMetadata.spanCountBeforeProcessing||0)-(x.spans?x.spans.length:0);N>0&&this.recordDroppedEvent("before_send","span",N)}const R=x.transaction_info;if(h&&R&&x.transaction!==e.transaction){const N="custom";x.transaction_info={...R,source:N}}return this.sendEvent(x,r),x})).then(null,(x=>{throw x instanceof Vr?x:(this.captureException(x,{data:{__sentry__:!0},originalException:x}),new Vr(`Event processing pipeline threw an error, original event will not be sent. Details have been sent as a new event.
Reason: ${x}`))}))}_process(e){this._numProcessing++,e.then((r=>(this._numProcessing--,r)),(r=>(this._numProcessing--,r)))}_clearOutcomes(){const e=this._outcomes;return this._outcomes={},Object.entries(e).map((([r,a])=>{const[l,f]=r.split(":");return{reason:l,category:f,quantity:a}}))}_flushOutcomes(){Ct&&Ye.log("Flushing outcomes...");const e=this._clearOutcomes();if(e.length===0)return void(Ct&&Ye.log("No outcomes to send"));if(!this._dsn)return void(Ct&&Ye.log("No dsn provided, will not send outcomes"));Ct&&Ye.log("Sending outcomes:",e);const r=(a=e,Sc((l=this._options.tunnel&&lu(this._dsn))?{dsn:l}:{},[[{type:"client_report"},{timestamp:f||wc(),discarded_events:a}]]));var a,l,f;this.sendEnvelope(r)}}function Um(n){return n.type===void 0}function Bm(n){return n.type==="transaction"}function sb(n){const e=[];function r(a){return e.splice(e.indexOf(a),1)[0]||Promise.resolve(void 0)}return{$:e,add:function(a){if(!(n===void 0||e.length<n))return au(new Vr("Not adding Promise because buffer limit was reached."));const l=a();return e.indexOf(l)===-1&&e.push(l),l.then((()=>r(l))).then(null,(()=>r(l).then(null,(()=>{})))),l},drain:function(a){return new Sr(((l,f)=>{let h=e.length;if(!h)return l(!0);const v=setTimeout((()=>{a&&a>0&&l(!1)}),a);e.forEach((y=>{mo(y).then((()=>{--h||(clearTimeout(v),l(!0))}),f)}))}))}}}function ob(n,{statusCode:e,headers:r},a=Date.now()){const l={...n},f=r&&r["x-sentry-rate-limits"],h=r&&r["retry-after"];if(f)for(const v of f.trim().split(",")){const[y,k,,,E]=v.split(":",5),O=parseInt(y,10),D=1e3*(isNaN(O)?60:O);if(k)for(const x of k.split(";"))x==="metric_bucket"&&E&&!E.split(";").includes("custom")||(l[x]=a+D);else l.all=a+D}else h?l.all=a+(function(v,y=Date.now()){const k=parseInt(`${v}`,10);if(!isNaN(k))return 1e3*k;const E=Date.parse(`${v}`);return isNaN(E)?6e4:E-y})(h,a):e===429&&(l.all=a+6e4);return l}function ab(n,e,r=sb(n.bufferSize||64)){let a={};return{send:function(l){const f=[];if(Cm(l,((y,k)=>{const E=Em(k);if((function(O,D,x=Date.now()){return(function(L,R){return L[R]||L.all||0})(O,D)>x})(a,E)){const O=Fm(y,k);n.recordDroppedEvent("ratelimit_backoff",E,O)}else f.push(y)})),f.length===0)return mo({});const h=Sc(l[0],f),v=y=>{Cm(h,((k,E)=>{const O=Fm(k,E);n.recordDroppedEvent(y,Em(E),O)}))};return r.add((()=>e({body:Yw(h)}).then((y=>(y.statusCode!==void 0&&(y.statusCode<200||y.statusCode>=300)&&Ct&&Ye.warn(`Sentry responded with status code ${y.statusCode} to sent event.`),a=ob(a,y),y)),(y=>{throw v("network_error"),y})))).then((y=>y),(y=>{if(y instanceof Vr)return Ct&&Ye.error("Skipped sending event because buffer is full."),v("queue_overflow"),mo({});throw y}))},flush:l=>r.drain(l)}}function Fm(n,e){if(e==="event"||e==="transaction")return Array.isArray(n)?n[1]:void 0}const cb=100;function yo(n,e){const r=vn(),a=bc();if(!r)return;const{beforeBreadcrumb:l=null,maxBreadcrumbs:f=cb}=r.getOptions();if(f<=0)return;const h={timestamp:wc(),...n},v=l?_c((()=>l(h,e))):h;v!==null&&(r.emit&&r.emit("beforeAddBreadcrumb",v,e),a.addBreadcrumb(v,f))}let Vm;const zm=new WeakMap,lb=()=>({name:"FunctionToString",setupOnce(){Vm=Function.prototype.toString;try{Function.prototype.toString=function(...n){const e=kf(this),r=zm.has(vn())&&e!==void 0?e:this;return Vm.apply(r,n)}}catch{}},setup(n){zm.set(n,!0)}}),ub=[/^Script error\.?$/,/^Javascript error: Script error\.? on line 0$/,/^ResizeObserver loop completed with undelivered notifications.$/,/^Cannot redefine property: googletag$/,"undefined is not an object (evaluating 'a.L')",`can't redefine non-configurable property "solana"`,"vv().getRestrictions is not a function. (In 'vv().getRestrictions(1,a)', 'vv().getRestrictions' is undefined)","Can't find variable: _AutofillCallbackHandler",/^Non-Error promise rejection captured with value: Object Not Found Matching Id:\d+, MethodName:simulateEvent, ParamCount:\d+$/],db=(n={})=>({name:"InboundFilters",processEvent(e,r,a){const l=a.getOptions(),f=(function(h={},v={}){return{allowUrls:[...h.allowUrls||[],...v.allowUrls||[]],denyUrls:[...h.denyUrls||[],...v.denyUrls||[]],ignoreErrors:[...h.ignoreErrors||[],...v.ignoreErrors||[],...h.disableErrorDefaults?[]:ub],ignoreTransactions:[...h.ignoreTransactions||[],...v.ignoreTransactions||[]],ignoreInternal:h.ignoreInternal===void 0||h.ignoreInternal}})(n,l);return(function(h,v){return v.ignoreInternal&&(function(y){try{return y.exception.values[0].type==="SentryError"}catch{}return!1})(h)?(Ct&&Ye.warn(`Event dropped due to being internal Sentry Error.
Event: ${ds(h)}`),!0):(function(y,k){return y.type||!k||!k.length?!1:(function(E){const O=[];E.message&&O.push(E.message);let D;try{D=E.exception.values[E.exception.values.length-1]}catch{}return D&&D.value&&(O.push(D.value),D.type&&O.push(`${D.type}: ${D.value}`)),O})(y).some((E=>ou(E,k)))})(h,v.ignoreErrors)?(Ct&&Ye.warn(`Event dropped due to being matched by \`ignoreErrors\` option.
Event: ${ds(h)}`),!0):(function(y){return y.type||!y.exception||!y.exception.values||y.exception.values.length===0?!1:!y.message&&!y.exception.values.some((k=>k.stacktrace||k.type&&k.type!=="Error"||k.value))})(h)?(Ct&&Ye.warn(`Event dropped due to not having an error message, error type or stacktrace.
Event: ${ds(h)}`),!0):(function(y,k){if(y.type!=="transaction"||!k||!k.length)return!1;const E=y.transaction;return!!E&&ou(E,k)})(h,v.ignoreTransactions)?(Ct&&Ye.warn(`Event dropped due to being matched by \`ignoreTransactions\` option.
Event: ${ds(h)}`),!0):(function(y,k){if(!k||!k.length)return!1;const E=fu(y);return!!E&&ou(E,k)})(h,v.denyUrls)?(Ct&&Ye.warn(`Event dropped due to being matched by \`denyUrls\` option.
Event: ${ds(h)}.
Url: ${fu(h)}`),!0):(function(y,k){if(!k||!k.length)return!0;const E=fu(y);return!E||ou(E,k)})(h,v.allowUrls)?!1:(Ct&&Ye.warn(`Event dropped due to not being matched by \`allowUrls\` option.
Event: ${ds(h)}.
Url: ${fu(h)}`),!0)})(e,f)?null:e}});function fu(n){try{let e;try{e=n.exception.values[0].stacktrace.frames}catch{}return e?(function(r=[]){for(let a=r.length-1;a>=0;a--){const l=r[a];if(l&&l.filename!=="<anonymous>"&&l.filename!=="[native code]")return l.filename||null}return null})(e):null}catch{return Ct&&Ye.error(`Cannot extract url for event ${ds(n)}`),null}}function fb(n,e,r=250,a,l,f,h){if(!(f.exception&&f.exception.values&&h&&po(h.originalException,Error)))return;const v=f.exception.values.length>0?f.exception.values[f.exception.values.length-1]:void 0;var y,k;v&&(f.exception.values=(y=Nf(n,e,l,h.originalException,a,f.exception.values,v,0),k=r,y.map((E=>(E.value&&(E.value=pa(E.value,k)),E)))))}function Nf(n,e,r,a,l,f,h,v){if(f.length>=r+1)return f;let y=[...f];if(po(a[l],Error)){qm(h,v);const k=n(e,a[l]),E=y.length;$m(k,l,E,v),y=Nf(n,e,r,a[l],l,[k,...y],k,E)}return Array.isArray(a.errors)&&a.errors.forEach(((k,E)=>{if(po(k,Error)){qm(h,v);const O=n(e,k),D=y.length;$m(O,`errors[${E}]`,D,v),y=Nf(n,e,r,k,l,[O,...y],O,D)}})),y}function qm(n,e){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,...n.type==="AggregateError"&&{is_exception_group:!0},exception_id:e}}function $m(n,e,r,a){n.mechanism=n.mechanism||{type:"generic",handled:!0},n.mechanism={...n.mechanism,type:"chained",source:e,exception_id:r,parent_id:a}}function Df(n){if(!n)return{};const e=n.match(/^(([^:/?#]+):)?(\/\/([^/?#]*))?([^?#]*)(\?([^#]*))?(#(.*))?$/);if(!e)return{};const r=e[6]||"",a=e[8]||"";return{host:e[4],path:e[5],protocol:e[2],search:r,hash:a,relative:e[5]+r+a}}function hb(){"console"in pt&&gf.forEach((function(n){n in pt.console&&lr(pt.console,n,(function(e){return eu[n]=e,function(...r){Fr("console",{args:r,level:n});const a=eu[n];a&&a.apply(pt.console,r)}}))}))}function pb(n){return n==="warn"?"warning":["fatal","error","warning","log","info","debug"].includes(n)?n:"log"}const gb=()=>{let n;return{name:"Dedupe",processEvent(e){if(e.type)return e;try{if((function(r,a){return a?!!((function(l,f){const h=l.message,v=f.message;return!(!h&&!v||h&&!v||!h&&v||h!==v||!Gm(l,f)||!Wm(l,f))})(r,a)||(function(l,f){const h=Hm(f),v=Hm(l);return!(!h||!v||h.type!==v.type||h.value!==v.value||!Gm(l,f)||!Wm(l,f))})(r,a)):!1})(e,n))return Ct&&Ye.warn("Event dropped due to being a duplicate of previously captured event."),null}catch{}return n=e}}};function Wm(n,e){let r=Xg(n),a=Xg(e);if(!r&&!a)return!0;if(r&&!a||!r&&a||a.length!==r.length)return!1;for(let l=0;l<a.length;l++){const f=a[l],h=r[l];if(f.filename!==h.filename||f.lineno!==h.lineno||f.colno!==h.colno||f.function!==h.function)return!1}return!0}function Gm(n,e){let r=n.fingerprint,a=e.fingerprint;if(!r&&!a)return!0;if(r&&!a||!r&&a)return!1;try{return r.join("")===a.join("")}catch{return!1}}function Hm(n){return n.exception&&n.exception.values&&n.exception.values[0]}function Jm(n){return n===void 0?void 0:n>=400&&n<500?"warning":n>=500?"error":void 0}const Uf=pt;function Bf(n){return n&&/^function\s+\w+\(\)\s+\{\s+\[native code\]\s+\}$/.test(n.toString())}function mb(){if(typeof EdgeRuntime=="string")return!0;if(!(function(){if(!("fetch"in Uf))return!1;try{return new Headers,new Request("http://www.example.com"),new Response,!0}catch{return!1}})())return!1;if(Bf(Uf.fetch))return!0;let n=!1;const e=Uf.document;if(e&&typeof e.createElement=="function")try{const r=e.createElement("iframe");r.hidden=!0,e.head.appendChild(r),r.contentWindow&&r.contentWindow.fetch&&(n=Bf(r.contentWindow.fetch)),e.head.removeChild(r)}catch(r){lo&&Ye.warn("Could not create sandbox iframe for pure fetch check, bailing to window.fetch: ",r)}return n}function vb(n,e){const r="fetch";fo(r,n),ho(r,(()=>(function(a,l=!1){l&&!mb()||lr(pt,"fetch",(function(f){return function(...h){const v=new Error,{method:y,url:k}=(function(O){if(O.length===0)return{method:"GET",url:""};if(O.length===2){const[x,L]=O;return{url:Qm(x),method:Ff(L,"method")?String(L.method).toUpperCase():"GET"}}const D=O[0];return{url:Qm(D),method:Ff(D,"method")?String(D.method).toUpperCase():"GET"}})(h),E={args:h,fetchData:{method:y,url:k},startTimestamp:1e3*Di(),virtualError:v};return a||Fr("fetch",{...E}),f.apply(pt,h).then((async O=>(a?a(O):Fr("fetch",{...E,endTimestamp:1e3*Di(),response:O}),O)),(O=>{throw Fr("fetch",{...E,endTimestamp:1e3*Di(),error:O}),_f(O)&&O.stack===void 0&&(O.stack=v.stack,go(O,"framesToPop",1)),O}))}}))})(void 0,e)))}function Ff(n,e){return!!n&&typeof n=="object"&&!!n[e]}function Qm(n){return typeof n=="string"?n:n?Ff(n,"url")?n.url:n.toString?n.toString():"":""}const hu=pt,Zt=pt;let Vf=0;function Km(){return Vf>0}function ya(n,e={}){if(!(function(a){return typeof a=="function"})(n))return n;try{const a=n.__sentry_wrapped__;if(a)return typeof a=="function"?a:n;if(kf(n))return n}catch{return n}const r=function(...a){try{const l=a.map((f=>ya(f,e)));return n.apply(this,l)}catch(l){throw Vf++,setTimeout((()=>{Vf--})),(function(...f){const h=Rf(ru());if(f.length===2){const[v,y]=f;return v?h.withSetScope(v,y):h.withScope(y)}h.withScope(f[0])})((f=>{var h;f.addEventProcessor((v=>(e.mechanism&&(Ef(v,void 0),ga(v,e.mechanism)),v.extra={...v.extra,arguments:a},v))),h=l,vo().captureException(h,void 0)})),l}};try{for(const a in n)Object.prototype.hasOwnProperty.call(n,a)&&(r[a]=n[a])}catch{}om(r,n),go(n,"__sentry_wrapped__",r);try{Object.getOwnPropertyDescriptor(r,"name").configurable&&Object.defineProperty(r,"name",{get:()=>n.name})}catch{}return r}const pu=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__;function zf(n,e){const r=$f(n,e),a={type:wb(e),value:bb(e)};return r.length&&(a.stacktrace={frames:r}),a.type===void 0&&a.value===""&&(a.value="Unrecoverable error caught"),a}function yb(n,e,r,a){const l=vn(),f=l&&l.getOptions().normalizeDepth,h=(function(k){for(const E in k)if(Object.prototype.hasOwnProperty.call(k,E)){const O=k[E];if(O instanceof Error)return O}})(e),v={__serialized__:km(e,f)};if(h)return{exception:{values:[zf(n,h)]},extra:v};const y={exception:{values:[{type:iu(e)?e.constructor.name:a?"UnhandledRejection":"Error",value:Sb(e,{isUnhandledRejection:a})}]},extra:v};if(r){const k=$f(n,r);k.length&&(y.exception.values[0].stacktrace={frames:k})}return y}function qf(n,e){return{exception:{values:[zf(n,e)]}}}function $f(n,e){const r=e.stacktrace||e.stack||"",a=(function(f){return f&&_b.test(f.message)?1:0})(e),l=(function(f){return typeof f.framesToPop=="number"?f.framesToPop:0})(e);try{return n(r,a,l)}catch{}return[]}const _b=/Minified React error #\d+;/i;function Ym(n){return typeof WebAssembly<"u"&&WebAssembly.Exception!==void 0&&n instanceof WebAssembly.Exception}function wb(n){const e=n&&n.name;return!e&&Ym(n)?n.message&&Array.isArray(n.message)&&n.message.length==2?n.message[0]:"WebAssembly.Exception":e}function bb(n){const e=n&&n.message;return e?e.error&&typeof e.error.message=="string"?e.error.message:Ym(n)&&Array.isArray(n.message)&&n.message.length==2?n.message[1]:e:"No error message"}function Wf(n,e,r,a,l){let f;if(tm(e)&&e.error)return qf(n,e.error);if(nm(e)||fa(e,"DOMException")){const h=e;if("stack"in e)f=qf(n,e);else{const v=h.name||(nm(h)?"DOMError":"DOMException"),y=h.message?`${v}: ${h.message}`:v;f=Gf(n,y,r,a),Ef(f,y)}return"code"in h&&(f.tags={...f.tags,"DOMException.code":`${h.code}`}),f}return _f(e)?qf(n,e):ha(e)||iu(e)?(f=yb(n,e,r,l),ga(f,{synthetic:!0}),f):(f=Gf(n,e,r,a),Ef(f,`${e}`),ga(f,{synthetic:!0}),f)}function Gf(n,e,r,a){const l={};if(a&&r){const f=$f(n,r);f.length&&(l.exception={values:[{value:e,stacktrace:{frames:f}}]}),ga(l,{synthetic:!0})}if(wf(e)){const{__sentry_template_string__:f,__sentry_template_values__:h}=e;return l.logentry={message:f,params:h},l}return l.message=e,l}function Sb(n,{isUnhandledRejection:e}){const r=(function(l,f=40){const h=Object.keys(am(l));h.sort();const v=h[0];if(!v)return"[object has no keys]";if(v.length>=f)return pa(v,f);for(let y=h.length;y>0;y--){const k=h.slice(0,y).join(", ");if(!(k.length>f))return y===h.length?k:pa(k,f)}return""})(n),a=e?"promise rejection":"exception";return tm(n)?`Event \`ErrorEvent\` captured as ${a} with message \`${n.message}\``:iu(n)?`Event \`${(function(l){try{const f=Object.getPrototypeOf(l);return f?f.constructor.name:void 0}catch{}})(n)}\` (type=${n.type}) captured as ${a}`:`Object captured as ${a} with keys: ${r}`}let kb=class extends ib{constructor(e){const r={parentSpanIsAlwaysRootSpan:!0,...e};(function(a,l,f=[l],h="npm"){const v=a._metadata||{};v.sdk||(v.sdk={name:`sentry.javascript.${l}`,packages:f.map((y=>({name:`${h}:@sentry/${y}`,version:co}))),version:co}),a._metadata=v})(r,"browser",["browser"],Zt.SENTRY_SDK_SOURCE||"npm"),super(r),r.sendClientReports&&Zt.document&&Zt.document.addEventListener("visibilitychange",(()=>{Zt.document.visibilityState==="hidden"&&this._flushOutcomes()}))}eventFromException(e,r){return(function(a,l,f,h){const v=Wf(a,l,f&&f.syntheticException||void 0,h);return ga(v),v.level="error",f&&f.event_id&&(v.event_id=f.event_id),mo(v)})(this._options.stackParser,e,r,this._options.attachStacktrace)}eventFromMessage(e,r="info",a){return(function(l,f,h="info",v,y){const k=Gf(l,f,v&&v.syntheticException||void 0,y);return k.level=h,v&&v.event_id&&(k.event_id=v.event_id),mo(k)})(this._options.stackParser,e,r,a,this._options.attachStacktrace)}captureUserFeedback(e){if(!this._isEnabled())return void(pu&&Ye.warn("SDK not enabled, will not capture user feedback."));const r=(function(a,{metadata:l,tunnel:f,dsn:h}){const v={event_id:a.event_id,sent_at:new Date().toISOString(),...l&&l.sdk&&{sdk:{name:l.sdk.name,version:l.sdk.version}},...!!f&&!!h&&{dsn:lu(h)}};return Sc(v,[(function(k){return[{type:"user_report"},k]})(a)])})(e,{metadata:this.getSdkMetadata(),dsn:this.getDsn(),tunnel:this.getOptions().tunnel});this.sendEnvelope(r)}_prepareEvent(e,r,a){return e.platform=e.platform||"javascript",super._prepareEvent(e,r,a)}};const Cb=typeof __SENTRY_DEBUG__>"u"||__SENTRY_DEBUG__,In=pt;let Xm,Hf,Jf,gu;function Eb(){if(!In.document)return;const n=Fr.bind(null,"dom"),e=Zm(n,!0);In.document.addEventListener("click",e,!1),In.document.addEventListener("keypress",e,!1),["EventTarget","Node"].forEach((r=>{const a=In[r],l=a&&a.prototype;l&&l.hasOwnProperty&&l.hasOwnProperty("addEventListener")&&(lr(l,"addEventListener",(function(f){return function(h,v,y){if(h==="click"||h=="keypress")try{const k=this.__sentry_instrumentation_handlers__=this.__sentry_instrumentation_handlers__||{},E=k[h]=k[h]||{refCount:0};if(!E.handler){const O=Zm(n);E.handler=O,f.call(this,h,O,y)}E.refCount++}catch{}return f.call(this,h,v,y)}})),lr(l,"removeEventListener",(function(f){return function(h,v,y){if(h==="click"||h=="keypress")try{const k=this.__sentry_instrumentation_handlers__||{},E=k[h];E&&(E.refCount--,E.refCount<=0&&(f.call(this,h,E.handler,y),E.handler=void 0,delete k[h]),Object.keys(k).length===0&&delete this.__sentry_instrumentation_handlers__)}catch{}return f.call(this,h,v,y)}})))}))}function Zm(n,e=!1){return r=>{if(!r||r._sentryCaptured)return;const a=(function(f){try{return f.target}catch{return null}})(r);if((function(f,h){return f==="keypress"&&(!h||!h.tagName||h.tagName!=="INPUT"&&h.tagName!=="TEXTAREA"&&!h.isContentEditable)})(r.type,a))return;go(r,"_sentryCaptured",!0),a&&!a._sentryId&&go(a,"_sentryId",br());const l=r.type==="keypress"?"input":r.type;(function(f){if(f.type!==Hf)return!1;try{if(!f.target||f.target._sentryId!==Jf)return!1}catch{}return!0})(r)||(n({event:r,name:l,global:e}),Hf=r.type,Jf=a?a._sentryId:void 0),clearTimeout(Xm),Xm=In.setTimeout((()=>{Jf=void 0,Hf=void 0}),1e3)}}function ev(n){const e="history";fo(e,n),ho(e,Mb)}function Mb(){if(!(function(){const r=hu.chrome,a=r&&r.app&&r.app.runtime,l="history"in hu&&!!hu.history.pushState&&!!hu.history.replaceState;return!a&&l})())return;const n=In.onpopstate;function e(r){return function(...a){const l=a.length>2?a[2]:void 0;if(l){const f=gu,h=String(l);gu=h,Fr("history",{from:f,to:h})}return r.apply(this,a)}}In.onpopstate=function(...r){const a=In.location.href,l=gu;if(gu=a,Fr("history",{from:l,to:a}),n)try{return n.apply(this,r)}catch{}},lr(In.history,"pushState",e),lr(In.history,"replaceState",e)}const mu={};function tv(n){mu[n]=void 0}const kc="__sentry_xhr_v3__";function Ob(){if(!In.XMLHttpRequest)return;const n=XMLHttpRequest.prototype;n.open=new Proxy(n.open,{apply(e,r,a){const l=new Error,f=1e3*Di(),h=Ni(a[0])?a[0].toUpperCase():void 0,v=(function(k){if(Ni(k))return k;try{return k.toString()}catch{}})(a[1]);if(!h||!v)return e.apply(r,a);r[kc]={method:h,url:v,request_headers:{}},h==="POST"&&v.match(/sentry_key/)&&(r.__sentry_own_request__=!0);const y=()=>{const k=r[kc];if(k&&r.readyState===4){try{k.status_code=r.status}catch{}Fr("xhr",{endTimestamp:1e3*Di(),startTimestamp:f,xhr:r,virtualError:l})}};return"onreadystatechange"in r&&typeof r.onreadystatechange=="function"?r.onreadystatechange=new Proxy(r.onreadystatechange,{apply:(k,E,O)=>(y(),k.apply(E,O))}):r.addEventListener("readystatechange",y),r.setRequestHeader=new Proxy(r.setRequestHeader,{apply(k,E,O){const[D,x]=O,L=E[kc];return L&&Ni(D)&&Ni(x)&&(L.request_headers[D.toLowerCase()]=x),k.apply(E,O)}}),e.apply(r,a)}}),n.send=new Proxy(n.send,{apply(e,r,a){const l=r[kc];return l?(a[0]!==void 0&&(l.body=a[0]),Fr("xhr",{startTimestamp:1e3*Di(),xhr:r}),e.apply(r,a)):e.apply(r,a)}})}function Tb(n,e=(function(r){const a=mu[r];if(a)return a;let l=In[r];if(Bf(l))return mu[r]=l.bind(In);const f=In.document;if(f&&typeof f.createElement=="function")try{const h=f.createElement("iframe");h.hidden=!0,f.head.appendChild(h);const v=h.contentWindow;v&&v[r]&&(l=v[r]),f.head.removeChild(h)}catch(h){Cb&&Ye.warn(`Could not create sandbox iframe for ${r} check, bailing to window.${r}: `,h)}return l&&(mu[r]=l.bind(In))})("fetch")){let r=0,a=0;return ab(n,(function(l){const f=l.body.length;r+=f,a++;const h={body:l.body,method:"POST",referrerPolicy:"origin",headers:n.headers,keepalive:r<=6e4&&a<15,...n.fetchOptions};if(!e)return tv("fetch"),au("No fetch implementation available");try{return e(n.url,h).then((v=>(r-=f,a--,{statusCode:v.status,headers:{"x-sentry-rate-limits":v.headers.get("X-Sentry-Rate-Limits"),"retry-after":v.headers.get("Retry-After")}})))}catch(v){return tv("fetch"),r-=f,a--,au(v)}}))}function Qf(n,e,r,a){const l={filename:n,function:e==="<anonymous>"?uo:e,in_app:!0};return r!==void 0&&(l.lineno=r),a!==void 0&&(l.colno=a),l}const Rb=/^\s*at (\S+?)(?::(\d+))(?::(\d+))\s*$/i,Ab=/^\s*at (?:(.+?\)(?: \[.+\])?|.*?) ?\((?:address at )?)?(?:async )?((?:<anonymous>|[-a-z]+:|.*bundle|\/)?.*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,Pb=/\((\S*)(?::(\d+))(?::(\d+))\)/,Ib=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)?((?:[-a-z]+)?:\/.*?|\[native code\]|[^@]*(?:bundle|\d+\.js)|\/[\w\-. /=]+)(?::(\d+))?(?::(\d+))?\s*$/i,xb=/(\S+) line (\d+)(?: > eval line \d+)* > eval/i,Lb=(function(...n){const e=n.sort(((r,a)=>r[0]-a[0])).map((r=>r[1]));return(r,a=0,l=0)=>{const f=[],h=r.split(`
`);for(let v=a;v<h.length;v++){const y=h[v];if(y.length>1024)continue;const k=Qg.test(y)?y.replace(Qg,"$1"):y;if(!k.match(/\S*Error: /)){for(const E of e){const O=E(k);if(O){f.push(O);break}}if(f.length>=50+l)break}}return(function(v){if(!v.length)return[];const y=Array.from(v);return/sentryWrapped/.test(tu(y).function||"")&&y.pop(),y.reverse(),Kg.test(tu(y).function||"")&&(y.pop(),Kg.test(tu(y).function||"")&&y.pop()),y.slice(0,50).map((k=>({...k,filename:k.filename||tu(y).filename,function:k.function||uo})))})(f.slice(l))}})([30,n=>{const e=Rb.exec(n);if(e){const[,a,l,f]=e;return Qf(a,uo,+l,+f)}const r=Ab.exec(n);if(r){if(r[2]&&r[2].indexOf("eval")===0){const f=Pb.exec(r[2]);f&&(r[2]=f[1],r[3]=f[2],r[4]=f[3])}const[a,l]=nv(r[1]||uo,r[2]);return Qf(l,a,r[3]?+r[3]:void 0,r[4]?+r[4]:void 0)}}],[50,n=>{const e=Ib.exec(n);if(e){if(e[3]&&e[3].indexOf(" > eval")>-1){const l=xb.exec(e[3]);l&&(e[1]=e[1]||"eval",e[3]=l[1],e[4]=l[2],e[5]="")}let r=e[3],a=e[1]||uo;return[a,r]=nv(a,r),Qf(r,a,e[4]?+e[4]:void 0,e[5]?+e[5]:void 0)}}]),nv=(n,e)=>{const r=n.indexOf("safari-extension")!==-1,a=n.indexOf("safari-web-extension")!==-1;return r||a?[n.indexOf("@")!==-1?n.split("@")[0]:uo,r?`safari-extension:${e}`:`safari-web-extension:${e}`]:[n,e]},rv=1024,jb=(n={})=>{const e={console:!0,dom:!0,fetch:!0,history:!0,sentry:!0,xhr:!0,...n};return{name:"Breadcrumbs",setup(r){var a;e.console&&(function(l){const f="console";fo(f,l),ho(f,hb)})((function(l){return function(f){if(vn()!==l)return;const h={category:"console",data:{arguments:f.args,logger:"console"},level:pb(f.level),message:sm(f.args," ")};if(f.level==="assert"){if(f.args[0]!==!1)return;h.message=`Assertion failed: ${sm(f.args.slice(1)," ")||"console.assert"}`,h.data.arguments=f.args.slice(1)}yo(h,{input:f.args,level:f.level})}})(r)),e.dom&&(a=(function(l,f){return function(h){if(vn()!==l)return;let v,y,k=typeof f=="object"?f.serializeAttribute:void 0,E=typeof f=="object"&&typeof f.maxStringLength=="number"?f.maxStringLength:void 0;E&&E>rv&&(pu&&Ye.warn(`\`dom.maxStringLength\` cannot exceed 1024, but a value of ${E} was configured. Sentry will use 1024 instead.`),E=rv),typeof k=="string"&&(k=[k]);try{const D=h.event,x=(function(L){return!!L&&!!L.target})(D)?D.target:D;v=im(x,{keyAttrs:k,maxStringLength:E}),y=(function(L){if(!Sf.HTMLElement)return null;let R=L;for(let N=0;N<5;N++){if(!R)return null;if(R instanceof HTMLElement){if(R.dataset.sentryComponent)return R.dataset.sentryComponent;if(R.dataset.sentryElement)return R.dataset.sentryElement}R=R.parentNode}return null})(x)}catch{v="<unknown>"}if(v.length===0)return;const O={category:`ui.${h.name}`,message:v};y&&(O.data={"ui.component_name":y}),yo(O,{event:h.event,name:h.name,global:h.global})}})(r,e.dom),fo("dom",a),ho("dom",Eb)),e.xhr&&(function(l){fo("xhr",l),ho("xhr",Ob)})((function(l){return function(f){if(vn()!==l)return;const{startTimestamp:h,endTimestamp:v}=f,y=f.xhr[kc];if(!h||!v||!y)return;const{method:k,url:E,status_code:O,body:D}=y,x={method:k,url:E,status_code:O},L={xhr:f.xhr,input:D,startTimestamp:h,endTimestamp:v};yo({category:"xhr",data:x,type:"http",level:Jm(O)},L)}})(r)),e.fetch&&vb((function(l){return function(f){if(vn()!==l)return;const{startTimestamp:h,endTimestamp:v}=f;if(v&&(!f.fetchData.url.match(/sentry_key/)||f.fetchData.method!=="POST"))if(f.error)yo({category:"fetch",data:f.fetchData,level:"error",type:"http"},{data:f.error,input:f.args,startTimestamp:h,endTimestamp:v});else{const y=f.response,k={...f.fetchData,status_code:y&&y.status},E={input:f.args,response:y,startTimestamp:h,endTimestamp:v};yo({category:"fetch",data:k,type:"http",level:Jm(k.status_code)},E)}}})(r)),e.history&&ev((function(l){return function(f){if(vn()!==l)return;let h=f.from,v=f.to;const y=Df(Zt.location.href);let k=h?Df(h):void 0;const E=Df(v);k&&k.path||(k=y),y.protocol===E.protocol&&y.host===E.host&&(v=E.relative),y.protocol===k.protocol&&y.host===k.host&&(h=k.relative),yo({category:"navigation",data:{from:h,to:v}})}})(r)),e.sentry&&r.on("beforeSendEvent",(function(l){return function(f){vn()===l&&yo({category:"sentry."+(f.type==="transaction"?"transaction":"event"),event_id:f.event_id,level:f.level,message:ds(f)},{event:f})}})(r))}}},Nb=["EventTarget","Window","Node","ApplicationCache","AudioTrackList","BroadcastChannel","ChannelMergerNode","CryptoOperation","EventSource","FileReader","HTMLUnknownElement","IDBDatabase","IDBRequest","IDBTransaction","KeyOperation","MediaController","MessagePort","ModalWindow","Notification","SVGElementInstance","Screen","SharedWorker","TextTrack","TextTrackCue","TextTrackList","WebSocket","WebSocketWorker","Worker","XMLHttpRequest","XMLHttpRequestEventTarget","XMLHttpRequestUpload"],Db=(n={})=>{const e={XMLHttpRequest:!0,eventTarget:!0,requestAnimationFrame:!0,setInterval:!0,setTimeout:!0,...n};return{name:"BrowserApiErrors",setupOnce(){e.setTimeout&&lr(Zt,"setTimeout",iv),e.setInterval&&lr(Zt,"setInterval",iv),e.requestAnimationFrame&&lr(Zt,"requestAnimationFrame",Ub),e.XMLHttpRequest&&"XMLHttpRequest"in Zt&&lr(XMLHttpRequest.prototype,"send",Bb);const r=e.eventTarget;r&&(Array.isArray(r)?r:Nb).forEach(Fb)}}};function iv(n){return function(...e){const r=e[0];return e[0]=ya(r,{mechanism:{data:{function:us(n)},handled:!1,type:"instrument"}}),n.apply(this,e)}}function Ub(n){return function(e){return n.apply(this,[ya(e,{mechanism:{data:{function:"requestAnimationFrame",handler:us(n)},handled:!1,type:"instrument"}})])}}function Bb(n){return function(...e){const r=this;return["onload","onerror","onprogress","onreadystatechange"].forEach((a=>{a in r&&typeof r[a]=="function"&&lr(r,a,(function(l){const f={mechanism:{data:{function:a,handler:us(l)},handled:!1,type:"instrument"}},h=kf(l);return h&&(f.mechanism.data.handler=us(h)),ya(l,f)}))})),n.apply(this,e)}}function Fb(n){const e=Zt[n],r=e&&e.prototype;r&&r.hasOwnProperty&&r.hasOwnProperty("addEventListener")&&(lr(r,"addEventListener",(function(a){return function(l,f,h){try{typeof f.handleEvent=="function"&&(f.handleEvent=ya(f.handleEvent,{mechanism:{data:{function:"handleEvent",handler:us(f),target:n},handled:!1,type:"instrument"}}))}catch{}return a.apply(this,[l,ya(f,{mechanism:{data:{function:"addEventListener",handler:us(f),target:n},handled:!1,type:"instrument"}}),h])}})),lr(r,"removeEventListener",(function(a){return function(l,f,h){try{const v=f.__sentry_wrapped__;v&&a.call(this,l,v,h)}catch{}return a.call(this,l,f,h)}})))}const Vb=()=>({name:"BrowserSession",setupOnce(){Zt.document!==void 0?(Am({ignoreDuration:!0}),xm(),ev((({from:n,to:e})=>{n!==void 0&&n!==e&&(Am({ignoreDuration:!0}),xm())}))):pu&&Ye.warn("Using the `browserSessionIntegration` in non-browser environments is not supported.")}}),zb=(n={})=>{const e={onerror:!0,onunhandledrejection:!0,...n};return{name:"GlobalHandlers",setupOnce(){Error.stackTraceLimit=50},setup(r){e.onerror&&((function(a){(function(l){const f="error";fo(f,l),ho(f,Iw)})((l=>{const{stackParser:f,attachStacktrace:h}=ov();if(vn()!==a||Km())return;const{msg:v,url:y,line:k,column:E,error:O}=l,D=(function(x,L,R,N){const q=x.exception=x.exception||{},Q=q.values=q.values||[],ee=Q[0]=Q[0]||{},P=ee.stacktrace=ee.stacktrace||{},$=P.frames=P.frames||[],G=N,ae=R,ye=Ni(L)&&L.length>0?L:(function(){try{return Sf.document.location.href}catch{return""}})();return $.length===0&&$.push({colno:G,filename:ye,function:uo,in_app:!0,lineno:ae}),x})(Wf(f,O||v,void 0,h,!1),y,k,E);D.level="error",Rm(D,{originalException:O,mechanism:{handled:!1,type:"onerror"}})}))})(r),sv("onerror")),e.onunhandledrejection&&((function(a){(function(l){const f="unhandledrejection";fo(f,l),ho(f,xw)})((l=>{const{stackParser:f,attachStacktrace:h}=ov();if(vn()!==a||Km())return;const v=(function(k){if(bf(k))return k;try{if("reason"in k)return k.reason;if("detail"in k&&"reason"in k.detail)return k.detail.reason}catch{}return k})(l),y=bf(v)?{exception:{values:[{type:"UnhandledRejection",value:`Non-Error promise rejection captured with value: ${String(v)}`}]}}:Wf(f,v,void 0,h,!0);y.level="error",Rm(y,{originalException:v,mechanism:{handled:!1,type:"onunhandledrejection"}})}))})(r),sv("onunhandledrejection"))}}};function sv(n){pu&&Ye.log(`Global Handler attached: ${n}`)}function ov(){const n=vn();return n&&n.getOptions()||{stackParser:()=>[],attachStacktrace:!1}}const qb=()=>({name:"HttpContext",preprocessEvent(n){if(!Zt.navigator&&!Zt.location&&!Zt.document)return;const e=n.request&&n.request.url||Zt.location&&Zt.location.href,{referrer:r}=Zt.document||{},{userAgent:a}=Zt.navigator||{},l={...n.request&&n.request.headers,...r&&{Referer:r},...a&&{"User-Agent":a}},f={...n.request,...e&&{url:e},headers:l};n.request=f}}),$b=(n={})=>{const e=n.limit||5,r=n.key||"cause";return{name:"LinkedErrors",preprocessEvent(a,l,f){const h=f.getOptions();fb(zf,h.stackParser,h.maxValueLength,r,e,a,l)}}};var av="new",cv="loading",lv="loaded",Kf="joining-meeting",_o="joined-meeting",wo="left-meeting",hs="error",Wb="playable",Yf="unknown",Gb="full",Hb="base",uv="no-room",Jb="end-of-life",Qb="connection-error",Kb="iframe-ready-for-launch-config",Yb="iframe-launch-config",Xb="theme-updated",Zb="loading",eS="load-attempt-failed",dv="loaded",tS="started-camera",nS="camera-error",rS="joining-meeting",iS="joined-meeting",sS="left-meeting",oS="participant-joined",aS="participant-updated",cS="participant-left",lS="participant-counts-updated",uS="access-state-updated",dS="meeting-session-summary-updated",fS="meeting-session-state-updated",hS="waiting-participant-added",pS="waiting-participant-updated",gS="waiting-participant-removed",mS="track-started",vS="track-stopped",yS="transcription-started",_S="transcription-stopped",wS="transcription-error",fv="recording-started",hv="recording-stopped",bS="recording-stats",SS="recording-error",kS="recording-upload-completed",CS="recording-data",ES="app-message",MS="transcription-message",OS="remote-media-player-started",TS="remote-media-player-updated",RS="remote-media-player-stopped",AS="local-screen-share-started",PS="local-screen-share-stopped",IS="local-screen-share-canceled",xS="active-speaker-change",LS="active-speaker-mode-change",jS="network-quality-change",NS="network-connection",DS="cpu-load-change",US="face-counts-updated",vu="fullscreen",yu="exited-fullscreen",BS="live-streaming-started",FS="live-streaming-updated",VS="live-streaming-stopped",zS="live-streaming-error",qS="lang-updated",$S="receive-settings-updated",pv="input-settings-updated",gv="nonfatal-error",mv="error",Xf=4096,vv=102400,Zf="iframe-call-message",yv="local-screen-start",_v="daily-method-update-live-streaming-endpoints",_u="transmit-log",Fi="daily-custom-track",wu={NONE:"none",BGBLUR:"background-blur",BGIMAGE:"background-image",FACE_DETECTION:"face-detection"},wv={NONE:"none",NOISE_CANCELLATION:"noise-cancellation"},eh={PLAY:"play",PAUSE:"pause"},th=["jpg","png","jpeg"],WS="add-endpoints",GS="remove-endpoints",bv="sip-call-transfer";function kr(){return!ot()&&typeof window<"u"&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:""}function ot(){return typeof navigator<"u"&&navigator.product&&navigator.product==="ReactNative"}function Sv(){return navigator&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia}function HS(){return!!(navigator&&navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)&&((function(n,e){if(!n||!e)return!0;switch(n){case"Chrome":return e.major>=75;case"Safari":return RTCRtpTransceiver.prototype.hasOwnProperty("currentDirection")&&!(e.major===13&&e.minor===0&&e.point===0);case"Firefox":return e.major>=67}return!0})(bo(),bu())||ot())}function kv(){if(ot()||!document)return!1;var n=document.createElement("iframe");return!!n.requestFullscreen||!!n.webkitRequestFullscreen}var nh="none",JS="software",QS="hardware",KS=(function(){try{var n,e=document.createElement("canvas"),r=!1;(n=e.getContext("webgl2",{failIfMajorPerformanceCaveat:!0}))||(r=!0,n=e.getContext("webgl2"));var a=n!=null;return e.remove(),a?r?JS:QS:nh}catch{return nh}})();function Cv(){var n=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return!ot()&&KS!==nh&&(n?(function(){return Ov()?!1:["Chrome","Firefox"].includes(bo())})():(function(){if(Ov())return!1;var e=bo();if(e==="Safari"){var r=sh();if(r.major<15||r.major===15&&r.minor<4)return!1}return e==="Chrome"?ih().major>=77:e==="Firefox"?oh().major>=97:["Chrome","Firefox","Safari"].includes(e)})())}function Ev(){if(ot()||Mv()||typeof AudioWorkletNode>"u")return!1;switch(bo()){case"Chrome":case"Firefox":return!0;case"Safari":var n=bu();return n.major>17||n.major===17&&n.minor>=4}return!1}function rh(){return Sv()&&typeof MediaStreamTrack<"u"&&!(function(){var n,e=bo();if(!kr())return!0;switch(e){case"Chrome":return(n=ih()).major&&n.major>0&&n.major<75;case"Firefox":return(n=oh()).major<91;case"Safari":return(n=sh()).major<13||n.major===13&&n.minor<1;default:return!0}})()}function Mv(){return kr().match(/Linux; Android/)}function Ov(){var n,e=kr(),r=e.match(/Mac/)&&(!ot()&&typeof window<"u"&&(n=window)!==null&&n!==void 0&&(n=n.navigator)!==null&&n!==void 0&&n.maxTouchPoints?window.navigator.maxTouchPoints:0)>=5;return!!(e.match(/Mobi/)||e.match(/Android/)||r)||!!kr().match(/DailyAnd\//)||void 0}function bo(){if(typeof window<"u"){var n=kr();return Tv()?"Safari":n.indexOf("Edge")>-1?"Edge":n.match(/Chrome\//)?"Chrome":n.indexOf("Safari")>-1||Rv()?"Safari":n.indexOf("Firefox")>-1?"Firefox":n.indexOf("MSIE")>-1||n.indexOf(".NET")>-1?"IE":"Unknown Browser"}}function bu(){switch(bo()){case"Chrome":return ih();case"Safari":return sh();case"Firefox":return oh();case"Edge":return(function(){var n=0,e=0;if(typeof window<"u"){var r=kr().match(/Edge\/(\d+).(\d+)/);if(r)try{n=parseInt(r[1]),e=parseInt(r[2])}catch{}}return{major:n,minor:e}})()}}function ih(){var n=0,e=0,r=0,a=0,l=!1;if(typeof window<"u"){var f=kr(),h=f.match(/Chrome\/(\d+).(\d+).(\d+).(\d+)/);if(h)try{n=parseInt(h[1]),e=parseInt(h[2]),r=parseInt(h[3]),a=parseInt(h[4]),l=f.indexOf("OPR/")>-1}catch{}}return{major:n,minor:e,build:r,patch:a,opera:l}}function Tv(){return!!kr().match(/iPad|iPhone|iPod/i)&&Sv()}function Rv(){return kr().indexOf("AppleWebKit/605.1.15")>-1}function sh(){var n=0,e=0,r=0;if(typeof window<"u"){var a=kr().match(/Version\/(\d+).(\d+)(.(\d+))?/);if(a)try{n=parseInt(a[1]),e=parseInt(a[2]),r=parseInt(a[4])}catch{}else(Tv()||Rv())&&(n=14,e=0,r=3)}return{major:n,minor:e,point:r}}function oh(){var n=0,e=0;if(typeof window<"u"){var r=kr().match(/Firefox\/(\d+).(\d+)/);if(r)try{n=parseInt(r[1]),e=parseInt(r[2])}catch{}}return{major:n,minor:e}}var Av=(function(){return cr((function n(){ar(this,n)}),[{key:"addListenerForMessagesFromCallMachine",value:function(n,e,r){yc()}},{key:"addListenerForMessagesFromDailyJs",value:function(n,e,r){yc()}},{key:"sendMessageToCallMachine",value:function(n,e,r,a){yc()}},{key:"sendMessageToDailyJs",value:function(n,e){yc()}},{key:"removeListener",value:function(n){yc()}}])})();function Pv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),r.push.apply(r,a)}return r}function ah(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Pv(Object(r),!0).forEach((function(a){ci(n,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Pv(Object(r)).forEach((function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))}))}return n}function Iv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(Iv=function(){return!!n})()}var YS=(function(){function n(){var e,r,a,l;return ar(this,n),r=this,a=Br(a=n),(e=Gl(r,Iv()?Reflect.construct(a,[],Br(r).constructor):a.apply(r,l)))._wrappedListeners={},e._messageCallbacks={},e}return Hl(n,Av),cr(n,[{key:"addListenerForMessagesFromCallMachine",value:function(e,r,a){var l=this,f=function(h){if(h.data&&h.data.what==="iframe-call-message"&&(!h.data.callClientId||h.data.callClientId===r)&&(!h.data.from||h.data.from!=="module")){var v=ah({},h.data);if(delete v.from,v.callbackStamp&&l._messageCallbacks[v.callbackStamp]){var y=v.callbackStamp;l._messageCallbacks[y].call(a,v),delete l._messageCallbacks[y]}delete v.what,delete v.callbackStamp,e.call(a,v)}};this._wrappedListeners[e]=f,window.addEventListener("message",f)}},{key:"addListenerForMessagesFromDailyJs",value:function(e,r,a){var l=function(f){var h;if(!(!f.data||f.data.what!==Zf||!f.data.action||f.data.from&&f.data.from!=="module"||f.data.callClientId&&r&&f.data.callClientId!==r||f!=null&&(h=f.data)!==null&&h!==void 0&&h.callFrameId)){var v=f.data;e.call(a,v)}};this._wrappedListeners[e]=l,window.addEventListener("message",l)}},{key:"sendMessageToCallMachine",value:function(e,r,a,l){if(!a)throw new Error("undefined callClientId. Are you trying to use a DailyCall instance previously destroyed?");var f=ah({},e);if(f.what=Zf,f.from="module",f.callClientId=a,r){var h=Kl();this._messageCallbacks[h]=r,f.callbackStamp=h}var v=l?l.contentWindow:window,y=this._callMachineTargetOrigin(l);y&&v.postMessage(f,y)}},{key:"sendMessageToDailyJs",value:function(e,r){e.what=Zf,e.callClientId=r,e.from="embedded",window.postMessage(e,this._targetOriginFromWindowLocation())}},{key:"removeListener",value:function(e){var r=this._wrappedListeners[e];r&&(window.removeEventListener("message",r),delete this._wrappedListeners[e])}},{key:"forwardPackagedMessageToCallMachine",value:function(e,r,a){var l=ah({},e);l.callClientId=a;var f=r?r.contentWindow:window,h=this._callMachineTargetOrigin(r);h&&f.postMessage(l,h)}},{key:"addListenerForPackagedMessagesFromCallMachine",value:function(e,r){var a=function(l){if(l.data&&l.data.what==="iframe-call-message"&&(!l.data.callClientId||l.data.callClientId===r)&&(!l.data.from||l.data.from!=="module")){var f=l.data;e(f)}};return this._wrappedListeners[e]=a,window.addEventListener("message",a),e}},{key:"removeListenerForPackagedMessagesFromCallMachine",value:function(e){var r=this._wrappedListeners[e];r&&(window.removeEventListener("message",r),delete this._wrappedListeners[e])}},{key:"_callMachineTargetOrigin",value:function(e){return e?e.src?new URL(e.src).origin:void 0:this._targetOriginFromWindowLocation()}},{key:"_targetOriginFromWindowLocation",value:function(){return window.location.protocol==="file:"?"*":window.location.origin}}])})();function xv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),r.push.apply(r,a)}return r}function Lv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(Lv=function(){return!!n})()}var XS=(function(){function n(){var e,r,a,l;return ar(this,n),r=this,a=Br(a=n),e=Gl(r,Lv()?Reflect.construct(a,[],Br(r).constructor):a.apply(r,l)),global.callMachineToDailyJsEmitter=global.callMachineToDailyJsEmitter||new pf.EventEmitter,global.dailyJsToCallMachineEmitter=global.dailyJsToCallMachineEmitter||new pf.EventEmitter,e._wrappedListeners={},e._messageCallbacks={},e}return Hl(n,Av),cr(n,[{key:"addListenerForMessagesFromCallMachine",value:function(e,r,a){this._addListener(e,global.callMachineToDailyJsEmitter,r,a,"received call machine message")}},{key:"addListenerForMessagesFromDailyJs",value:function(e,r,a){this._addListener(e,global.dailyJsToCallMachineEmitter,r,a,"received daily-js message")}},{key:"sendMessageToCallMachine",value:function(e,r,a){this._sendMessage(e,global.dailyJsToCallMachineEmitter,a,r,"sending message to call machine")}},{key:"sendMessageToDailyJs",value:function(e,r){this._sendMessage(e,global.callMachineToDailyJsEmitter,r,null,"sending message to daily-js")}},{key:"removeListener",value:function(e){var r=this._wrappedListeners[e];r&&(global.callMachineToDailyJsEmitter.removeListener("message",r),global.dailyJsToCallMachineEmitter.removeListener("message",r),delete this._wrappedListeners[e])}},{key:"_addListener",value:function(e,r,a,l,f){var h=this,v=function(y){if(y.callClientId===a){if(y.callbackStamp&&h._messageCallbacks[y.callbackStamp]){var k=y.callbackStamp;h._messageCallbacks[k].call(l,y),delete h._messageCallbacks[k]}e.call(l,y)}};this._wrappedListeners[e]=v,r.addListener("message",v)}},{key:"_sendMessage",value:function(e,r,a,l,f){var h=(function(y){for(var k=1;k<arguments.length;k++){var E=arguments[k]!=null?arguments[k]:{};k%2?xv(Object(E),!0).forEach((function(O){ci(y,O,E[O])})):Object.getOwnPropertyDescriptors?Object.defineProperties(y,Object.getOwnPropertyDescriptors(E)):xv(Object(E)).forEach((function(O){Object.defineProperty(y,O,Object.getOwnPropertyDescriptor(E,O))}))}return y})({},e);if(h.callClientId=a,l){var v=Kl();this._messageCallbacks[v]=l,h.callbackStamp=v}r.emit("message",h)}}])})(),ch="replace",lh="shallow-merge",jv=[ch,lh],ZS=(function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.data,a=e.mergeStrategy,l=a===void 0?ch:a;ar(this,n),n._validateMergeStrategy(l),n._validateData(r,l),this.mergeStrategy=l,this.data=r}return cr(n,[{key:"isNoOp",value:function(){return n.isNoOpUpdate(this.data,this.mergeStrategy)}}],[{key:"isNoOpUpdate",value:function(e,r){return Object.keys(e).length===0&&r===lh}},{key:"_validateMergeStrategy",value:function(e){if(!jv.includes(e))throw Error("Unrecognized mergeStrategy provided. Options are: [".concat(jv,"]"))}},{key:"_validateData",value:function(e,r){if(!(function(v){if(v==null||ut(v)!=="object")return!1;var y=Object.getPrototypeOf(v);return y==null||y===Object.prototype})(e))throw Error("Meeting session data must be a plain (map-like) object");var a;try{if(a=JSON.stringify(e),r===ch){var l=JSON.parse(a);An(l,e)||console.warn("The meeting session data provided will be modified when serialized.",l,e)}else if(r===lh){for(var f in e)if(Object.hasOwnProperty.call(e,f)&&e[f]!==void 0){var h=JSON.parse(JSON.stringify(e[f]));An(e[f],h)||console.warn("At least one key in the meeting session data provided will be modified when serialized.",h,e[f])}}}catch(v){throw Error("Meeting session data must be serializable to JSON: ".concat(v))}if(a.length>vv)throw Error("Meeting session data is too large (".concat(a.length," characters). Maximum size suppported is ").concat(vv,"."))}}])})();function Nv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(Nv=function(){return!!n})()}function uh(n){var e=typeof Map=="function"?new Map:void 0;return uh=function(r){if(r===null||!(function(l){try{return Function.toString.call(l).indexOf("[native code]")!==-1}catch{return typeof l=="function"}})(r))return r;if(typeof r!="function")throw new TypeError("Super expression must either be null or a function");if(e!==void 0){if(e.has(r))return e.get(r);e.set(r,a)}function a(){return(function(l,f,h){if(Nv())return Reflect.construct.apply(null,arguments);var v=[null];v.push.apply(v,f);var y=new(l.bind.apply(l,v));return h&&vc(y,h.prototype),y})(r,arguments,Br(this).constructor)}return a.prototype=Object.create(r.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),vc(a,r)},uh(n)}function Dv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(Dv=function(){return!!n})()}function Uv(n){var e,r=(e=window._daily)===null||e===void 0?void 0:e.pendings;if(r){var a=r.indexOf(n);a!==-1&&r.splice(a,1)}}var ek=(function(){return cr((function n(e){ar(this,n),this._currentLoad=null,this._callClientId=e}),[{key:"load",value:function(){var n,e=this,r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},a=arguments.length>1?arguments[1]:void 0,l=arguments.length>2?arguments[2]:void 0;if(this.loaded)return window._daily.instances[this._callClientId].callMachine.reset(),void a(!0);n=this._callClientId,window._daily.pendings.push(n),this._currentLoad&&this._currentLoad.cancel(),this._currentLoad=new tk(r,(function(){a(!1)}),(function(f,h){h||Uv(e._callClientId),l(f,h)})),this._currentLoad.start()}},{key:"cancel",value:function(){this._currentLoad&&this._currentLoad.cancel(),Uv(this._callClientId)}},{key:"loaded",get:function(){return this._currentLoad&&this._currentLoad.succeeded}}])})(),tk=(function(){return cr((function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=arguments.length>1?arguments[1]:void 0,a=arguments.length>2?arguments[2]:void 0;ar(this,n),this._attemptsRemaining=3,this._currentAttempt=null,this._dailyConfig=e,this._successCallback=r,this._failureCallback=a}),[{key:"start",value:function(){var n=this;if(!this._currentAttempt){var e=function(r){n._currentAttempt.cancelled||(n._attemptsRemaining--,n._failureCallback(r,n._attemptsRemaining>0),n._attemptsRemaining<=0||setTimeout((function(){n._currentAttempt.cancelled||(n._currentAttempt=new Bv(n._dailyConfig,n._successCallback,e),n._currentAttempt.start())}),3e3))};this._currentAttempt=new Bv(this._dailyConfig,this._successCallback,e),this._currentAttempt.start()}}},{key:"cancel",value:function(){this._currentAttempt&&this._currentAttempt.cancel()}},{key:"cancelled",get:function(){return this._currentAttempt&&this._currentAttempt.cancelled}},{key:"succeeded",get:function(){return this._currentAttempt&&this._currentAttempt.succeeded}}])})(),dh=(function(){function n(){return ar(this,n),e=this,a=arguments,r=Br(r=n),Gl(e,Dv()?Reflect.construct(r,a||[],Br(e).constructor):r.apply(e,a));var e,r,a}return Hl(n,uh(Error)),cr(n)})(),Su=2e4,Bv=(function(){return cr((function e(r,a,l){ar(this,e),this._loadAttemptImpl=ot()||!r.avoidEval?new nk(r,a,l):new rk(r,a,l)}),[{key:"start",value:(n=He((function*(){return this._loadAttemptImpl.start()})),function(){return n.apply(this,arguments)})},{key:"cancel",value:function(){this._loadAttemptImpl.cancel()}},{key:"cancelled",get:function(){return this._loadAttemptImpl.cancelled}},{key:"succeeded",get:function(){return this._loadAttemptImpl.succeeded}}]);var n})(),nk=(function(){return cr((function l(f,h,v){ar(this,l),this.cancelled=!1,this.succeeded=!1,this._networkTimedOut=!1,this._networkTimeout=null,this._iosCache=typeof iOSCallObjectBundleCache<"u"&&iOSCallObjectBundleCache,this._refetchHeaders=null,this._dailyConfig=f,this._successCallback=h,this._failureCallback=v}),[{key:"start",value:(a=He((function*(){var l=Yl(this._dailyConfig);!(yield this._tryLoadFromIOSCache(l))&&this._loadFromNetwork(l)})),function(){return a.apply(this,arguments)})},{key:"cancel",value:function(){clearTimeout(this._networkTimeout),this.cancelled=!0}},{key:"_tryLoadFromIOSCache",value:(r=He((function*(l){if(!this._iosCache)return!1;try{var f=yield this._iosCache.get(l);return!!this.cancelled||!!f&&(f.code?(Function('"use strict";'+f.code)(),this.succeeded=!0,this._successCallback(),!0):(this._refetchHeaders=f.refetchHeaders,!1))}catch{return!1}})),function(l){return r.apply(this,arguments)})},{key:"_loadFromNetwork",value:(e=He((function*(l){var f=this;this._networkTimeout=setTimeout((function(){f._networkTimedOut=!0,f._failureCallback({msg:"Timed out (>".concat(Su," ms) when loading call object bundle ").concat(l),type:"timeout"})}),Su);try{var h=this._refetchHeaders?{headers:this._refetchHeaders}:{},v=yield fetch(l,h);if(clearTimeout(this._networkTimeout),this.cancelled||this._networkTimedOut)throw new dh;var y=yield this._getBundleCodeFromResponse(l,v);if(this.cancelled)throw new dh;Function('"use strict";'+y)(),this._iosCache&&this._iosCache.set(l,y,v.headers),this.succeeded=!0,this._successCallback()}catch(k){if(clearTimeout(this._networkTimeout),k instanceof dh||this.cancelled||this._networkTimedOut)return;this._failureCallback({msg:"Failed to load call object bundle ".concat(l,": ").concat(k),type:k.message})}})),function(l){return e.apply(this,arguments)})},{key:"_getBundleCodeFromResponse",value:(n=He((function*(l,f){if(f.ok)return yield f.text();if(this._iosCache&&f.status===304)return(yield this._iosCache.renew(l,f.headers)).code;throw new Error("Received ".concat(f.status," response"))})),function(l,f){return n.apply(this,arguments)})}]);var n,e,r,a})(),rk=(function(){return cr((function n(e,r,a){ar(this,n),this.cancelled=!1,this.succeeded=!1,this._dailyConfig=e,this._successCallback=r,this._failureCallback=a,this._attemptId=Kl(),this._networkTimeout=null,this._scriptElement=null}),[{key:"start",value:function(){window._dailyCallMachineLoadWaitlist||(window._dailyCallMachineLoadWaitlist=new Set);var n=Yl(this._dailyConfig);(typeof document>"u"?"undefined":ut(document))==="object"?this._startLoading(n):this._failureCallback({msg:"Call object bundle must be loaded in a DOM/web context",type:"missing context"})}},{key:"cancel",value:function(){this._stopLoading(),this.cancelled=!0}},{key:"_startLoading",value:function(n){var e=this;this._signUpForCallMachineLoadWaitlist(),this._networkTimeout=setTimeout((function(){e._stopLoading(),e._failureCallback({msg:"Timed out (>".concat(Su," ms) when loading call object bundle ").concat(n),type:"timeout"})}),Su);var r=document.getElementsByTagName("head")[0],a=document.createElement("script");this._scriptElement=a,a.onload=function(){e._stopLoading(),e.succeeded=!0,e._successCallback()},a.onerror=function(l){e._stopLoading(),e._failureCallback({msg:"Failed to load call object bundle ".concat(l.target.src),type:l.message})},a.src=n,r.appendChild(a)}},{key:"_stopLoading",value:function(){this._withdrawFromCallMachineLoadWaitlist(),clearTimeout(this._networkTimeout),this._scriptElement&&(this._scriptElement.onload=null,this._scriptElement.onerror=null)}},{key:"_signUpForCallMachineLoadWaitlist",value:function(){window._dailyCallMachineLoadWaitlist.add(this._attemptId)}},{key:"_withdrawFromCallMachineLoadWaitlist",value:function(){window._dailyCallMachineLoadWaitlist.delete(this._attemptId)}}])})(),ku=function(n,e,r){return sk(n.local,e,r)===!0},ik=function(n,e,r){return n.local.streams&&n.local.streams[e]&&n.local.streams[e].stream&&n.local.streams[e].stream["get".concat(r==="video"?"Video":"Audio","Tracks")]()[0]},_a=function(n,e,r,a){var l=ok(n,e,r,a);return l&&l.pendingTrack},sk=function(n,e,r){if(!n)return!1;var a=function(f){switch(f){case"avatar":return!0;case"staged":return f;default:return!!f}},l=n.public.subscribedTracks;return l&&l[e]?["cam-audio","cam-video","screen-video","screen-audio","rmpAudio","rmpVideo"].indexOf(r)===-1&&l[e].custom?[!0,"staged"].includes(l[e].custom)?a(l[e].custom):a(l[e].custom[r]):a(l[e][r]):!l||a(l.ALL)},ok=function(n,e,r,a){var l=Object.values(n.streams||{}).filter((function(f){return f.participantId===e&&f.type===r&&f.pendingTrack&&f.pendingTrack.kind===a})).sort((function(f,h){return new Date(h.starttime)-new Date(f.starttime)}));return l&&l[0]},ak=function(n,e){var r=n.local.public.customTracks;if(r&&r[e])return r[e].track};function Fv(n,e){for(var r=e.getState(),a=0,l=["cam","screen"];a<l.length;a++)for(var f=l[a],h=0,v=["video","audio"];h<v.length;h++){var y=v[h],k=f==="cam"?y:"screen".concat(y.charAt(0).toUpperCase()+y.slice(1)),E=n.tracks[k];if(E){var O=n.local?ik(r,f,y):_a(r,n.session_id,f,y);E.state==="playable"&&(E.track=O),E.persistentTrack=O}}}function Vv(n,e){try{var r=e.getState();for(var a in n.tracks)if(!ck(a)){var l=n.tracks[a].kind;if(l){var f=n.tracks[a];if(f){var h=n.local?ak(r,a):_a(r,n.session_id,a,l);f.state==="playable"&&(n.tracks[a].track=h),f.persistentTrack=h}}else console.error("unknown type for custom track")}}catch(v){console.error(v)}}function ck(n){return["video","audio","screenVideo","screenAudio"].includes(n)}function zv(n,e,r){var a=r.getState();if(n.local){if(n.audio)try{n.audioTrack=a.local.streams.cam.stream.getAudioTracks()[0],n.audioTrack||(n.audio=!1)}catch{}if(n.video)try{n.videoTrack=a.local.streams.cam.stream.getVideoTracks()[0],n.videoTrack||(n.video=!1)}catch{}if(n.screen)try{n.screenVideoTrack=a.local.streams.screen.stream.getVideoTracks()[0],n.screenAudioTrack=a.local.streams.screen.stream.getAudioTracks()[0],n.screenVideoTrack||n.screenAudioTrack||(n.screen=!1)}catch{}}else{var l=!0;try{var f=a.participants[n.session_id];f&&f.public&&f.public.rtcType&&f.public.rtcType.impl==="peer-to-peer"&&f.private&&!["connected","completed"].includes(f.private.peeringState)&&(l=!1)}catch(E){console.error(E)}if(!l)return n.audio=!1,n.audioTrack=!1,n.video=!1,n.videoTrack=!1,n.screen=!1,void(n.screenTrack=!1);try{if(a.streams,n.audio&&ku(a,n.session_id,"cam-audio")){var h=_a(a,n.session_id,"cam","audio");h&&(e&&e.audioTrack&&e.audioTrack.id===h.id?n.audioTrack=h:h.muted||(n.audioTrack=h)),n.audioTrack||(n.audio=!1)}if(n.video&&ku(a,n.session_id,"cam-video")){var v=_a(a,n.session_id,"cam","video");v&&(e&&e.videoTrack&&e.videoTrack.id===v.id?n.videoTrack=v:v.muted||(n.videoTrack=v)),n.videoTrack||(n.video=!1)}if(n.screen&&ku(a,n.session_id,"screen-audio")){var y=_a(a,n.session_id,"screen","audio");y&&(e&&e.screenAudioTrack&&e.screenAudioTrack.id===y.id?n.screenAudioTrack=y:y.muted||(n.screenAudioTrack=y))}if(n.screen&&ku(a,n.session_id,"screen-video")){var k=_a(a,n.session_id,"screen","video");k&&(e&&e.screenVideoTrack&&e.screenVideoTrack.id===k.id?n.screenVideoTrack=k:k.muted||(n.screenVideoTrack=k))}n.screenVideoTrack||n.screenAudioTrack||(n.screen=!1)}catch(E){console.error("unexpected error matching up tracks",E)}}}function lk(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=(function(y,k){if(y){if(typeof y=="string")return qv(y,k);var E={}.toString.call(y).slice(8,-1);return E==="Object"&&y.constructor&&(E=y.constructor.name),E==="Map"||E==="Set"?Array.from(y):E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E)?qv(y,k):void 0}})(n))||e){r&&(n=r);var a=0,l=function(){};return{s:l,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(y){throw y},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f,h=!0,v=!1;return{s:function(){r=r.call(n)},n:function(){var y=r.next();return h=y.done,y},e:function(y){v=!0,f=y},f:function(){try{h||r.return==null||r.return()}finally{if(v)throw f}}}}function qv(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,a=Array(e);r<e;r++)a[r]=n[r];return a}var li=new Map,wa=null;function uk(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=(function(y,k){if(y){if(typeof y=="string")return $v(y,k);var E={}.toString.call(y).slice(8,-1);return E==="Object"&&y.constructor&&(E=y.constructor.name),E==="Map"||E==="Set"?Array.from(y):E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E)?$v(y,k):void 0}})(n))||e){r&&(n=r);var a=0,l=function(){};return{s:l,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(y){throw y},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f,h=!0,v=!1;return{s:function(){r=r.call(n)},n:function(){var y=r.next();return h=y.done,y},e:function(y){v=!0,f=y},f:function(){try{h||r.return==null||r.return()}finally{if(v)throw f}}}}function $v(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,a=Array(e);r<e;r++)a[r]=n[r];return a}var ui=new Map,Cc=null;function dk(n){Wv()?(function(e){li.has(e)||(li.set(e,{}),navigator.mediaDevices.enumerateDevices().then((function(r){li.has(e)&&(li.get(e).lastDevicesString=JSON.stringify(r),wa||(wa=(function(){var a=He((function*(){var l,f=yield navigator.mediaDevices.enumerateDevices(),h=lk(li.keys());try{for(h.s();!(l=h.n()).done;){var v=l.value,y=JSON.stringify(f);y!==li.get(v).lastDevicesString&&(li.get(v).lastDevicesString=y,v(f))}}catch(k){h.e(k)}finally{h.f()}}));return function(){return a.apply(this,arguments)}})(),navigator.mediaDevices.addEventListener("devicechange",wa)))})).catch((function(){})))})(n):(function(e){ui.has(e)||(ui.set(e,{}),navigator.mediaDevices.enumerateDevices().then((function(r){ui.has(e)&&(ui.get(e).lastDevicesString=JSON.stringify(r),Cc||(Cc=setInterval(He((function*(){var a,l=yield navigator.mediaDevices.enumerateDevices(),f=uk(ui.keys());try{for(f.s();!(a=f.n()).done;){var h=a.value,v=JSON.stringify(l);v!==ui.get(h).lastDevicesString&&(ui.get(h).lastDevicesString=v,h(l))}}catch(y){f.e(y)}finally{f.f()}})),3e3)))})))})(n)}function fk(n){Wv()?(function(e){li.has(e)&&(li.delete(e),li.size===0&&wa&&(navigator.mediaDevices.removeEventListener("devicechange",wa),wa=null))})(n):(function(e){ui.has(e)&&(ui.delete(e),ui.size===0&&Cc&&(clearInterval(Cc),Cc=null))})(n)}function Wv(){var n;return ot()||((n=navigator.mediaDevices)===null||n===void 0?void 0:n.ondevicechange)!==void 0}var hk=new Set;function pk(n,e){return n&&n.readyState==="live"&&!(function(r,a){return r.muted&&!hk.has(r.id)})(n)}function Gv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),r.push.apply(r,a)}return r}function ps(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Gv(Object(r),!0).forEach((function(a){ci(n,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Gv(Object(r)).forEach((function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))}))}return n}var Ec=Object.freeze({VIDEO:"video",AUDIO:"audio",SCREEN_VIDEO:"screenVideo",SCREEN_AUDIO:"screenAudio",CUSTOM_VIDEO:"customVideo",CUSTOM_AUDIO:"customAudio"}),gk=Object.freeze({PARTICIPANTS:"participants",STREAMING:"streaming",TRANSCRIPTION:"transcription"}),Mc=Object.values(Ec),Hv=["v","a","sv","sa","cv","ca"];Object.freeze(Mc.reduce((function(n,e,r){return n[e]=Hv[r],n}),{})),Object.freeze(Hv.reduce((function(n,e,r){return n[e]=Mc[r],n}),{}));var mk=[Ec.VIDEO,Ec.AUDIO,Ec.SCREEN_VIDEO,Ec.SCREEN_AUDIO],Jv=Object.values(gk),Qv=["p","s","t"];Object.freeze(Jv.reduce((function(n,e,r){return n[e]=Qv[r],n}),{})),Object.freeze(Qv.reduce((function(n,e,r){return n[e]=Jv[r],n}),{}));var Kv=(function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.base,a=e.byUserId,l=e.byParticipantId;ar(this,n),this.base=r,this.byUserId=a,this.byParticipantId=l}return cr(n,[{key:"clone",value:function(){var e=new n;if(this.base instanceof an?e.base=this.base.clone():e.base=this.base,this.byUserId!==void 0)for(var r in e.byUserId={},this.byUserId){var a=this.byUserId[r];e.byUserId[r]=a instanceof an?a.clone():a}if(this.byParticipantId!==void 0)for(var l in e.byParticipantId={},this.byParticipantId){var f=this.byParticipantId[l];e.byParticipantId[l]=f instanceof an?f.clone():f}return e}},{key:"toJSONObject",value:function(){var e={};if(typeof this.base=="boolean"?e.base=this.base:this.base instanceof an&&(e.base=this.base.toJSONObject()),this.byUserId!==void 0)for(var r in e.byUserId={},this.byUserId){var a=this.byUserId[r];e.byUserId[r]=a instanceof an?a.toJSONObject():a}if(this.byParticipantId!==void 0)for(var l in e.byParticipantId={},this.byParticipantId){var f=this.byParticipantId[l];e.byParticipantId[l]=f instanceof an?f.toJSONObject():f}return e}},{key:"toMinifiedJSONObject",value:function(){var e={};if(this.base!==void 0&&(typeof this.base=="boolean"?e.b=this.base:e.b=this.base.toMinifiedJSONObject()),this.byUserId!==void 0)for(var r in e.u={},this.byUserId){var a=this.byUserId[r];e.u[r]=typeof a=="boolean"?a:a.toMinifiedJSONObject()}if(this.byParticipantId!==void 0)for(var l in e.p={},this.byParticipantId){var f=this.byParticipantId[l];e.p[l]=typeof f=="boolean"?f:f.toMinifiedJSONObject()}return e}},{key:"normalize",value:function(){return this.base instanceof an&&(this.base=this.base.normalize()),this.byUserId&&(this.byUserId=Object.fromEntries(Object.entries(this.byUserId).map((function(e){var r=mn(e,2),a=r[0],l=r[1];return[a,l instanceof an?l.normalize():l]})))),this.byParticipantId&&(this.byParticipantId=Object.fromEntries(Object.entries(this.byParticipantId).map((function(e){var r=mn(e,2),a=r[0],l=r[1];return[a,l instanceof an?l.normalize():l]})))),this}}],[{key:"fromJSONObject",value:function(e){var r,a,l;if(e.base!==void 0&&(r=typeof e.base=="boolean"?e.base:an.fromJSONObject(e.base)),e.byUserId!==void 0)for(var f in a={},e.byUserId){var h=e.byUserId[f];a[f]=typeof h=="boolean"?h:an.fromJSONObject(h)}if(e.byParticipantId!==void 0)for(var v in l={},e.byParticipantId){var y=e.byParticipantId[v];l[v]=typeof y=="boolean"?y:an.fromJSONObject(y)}return new n({base:r,byUserId:a,byParticipantId:l})}},{key:"fromMinifiedJSONObject",value:function(e){var r,a,l;if(e.b!==void 0&&(r=typeof e.b=="boolean"?e.b:an.fromMinifiedJSONObject(e.b)),e.u!==void 0)for(var f in a={},e.u){var h=e.u[f];a[f]=typeof h=="boolean"?h:an.fromMinifiedJSONObject(h)}if(e.p!==void 0)for(var v in l={},e.p){var y=e.p[v];l[v]=typeof y=="boolean"?y:an.fromMinifiedJSONObject(y)}return new n({base:r,byUserId:a,byParticipantId:l})}},{key:"validateJSONObject",value:function(e){if(ut(e)!=="object")return[!1,"canReceive must be an object"];for(var r=["base","byUserId","byParticipantId"],a=0,l=Object.keys(e);a<l.length;a++){var f=l[a];if(!r.includes(f))return[!1,"canReceive can only contain keys (".concat(r.join(", "),")")];if(f==="base"){var h=mn(an.validateJSONObject(e.base,!0),2),v=h[0],y=h[1];if(!v)return[!1,y]}else{if(ut(e[f])!=="object")return[!1,"invalid (non-object) value for field '".concat(f,"' in canReceive")];for(var k=0,E=Object.values(e[f]);k<E.length;k++){var O=E[k],D=mn(an.validateJSONObject(O),2),x=D[0],L=D[1];if(!x)return[!1,L]}}}return[!0]}}])})(),an=(function(){function n(){var e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=e.video,a=e.audio,l=e.screenVideo,f=e.screenAudio,h=e.customVideo,v=e.customAudio;ar(this,n),this.video=r,this.audio=a,this.screenVideo=l,this.screenAudio=f,this.customVideo=h,this.customAudio=v}return cr(n,[{key:"clone",value:function(){var e=new n;return this.video!==void 0&&(e.video=this.video),this.audio!==void 0&&(e.audio=this.audio),this.screenVideo!==void 0&&(e.screenVideo=this.screenVideo),this.screenAudio!==void 0&&(e.screenAudio=this.screenAudio),this.customVideo!==void 0&&(e.customVideo=ps({},this.customVideo)),this.customAudio!==void 0&&(e.customAudio=ps({},this.customAudio)),e}},{key:"toJSONObject",value:function(){var e={};return this.video!==void 0&&(e.video=this.video),this.audio!==void 0&&(e.audio=this.audio),this.screenVideo!==void 0&&(e.screenVideo=this.screenVideo),this.screenAudio!==void 0&&(e.screenAudio=this.screenAudio),this.customVideo!==void 0&&(e.customVideo=ps({},this.customVideo)),this.customAudio!==void 0&&(e.customAudio=ps({},this.customAudio)),e}},{key:"toMinifiedJSONObject",value:function(){var e={};return this.video!==void 0&&(e.v=this.video),this.audio!==void 0&&(e.a=this.audio),this.screenVideo!==void 0&&(e.sv=this.screenVideo),this.screenAudio!==void 0&&(e.sa=this.screenAudio),this.customVideo!==void 0&&(e.cv=ps({},this.customVideo)),this.customAudio!==void 0&&(e.ca=ps({},this.customAudio)),e}},{key:"normalize",value:function(){function e(r,a){return r&&Object.keys(r).length===1&&r["*"]===a}return!(this.video!==!0||this.audio!==!0||this.screenVideo!==!0||this.screenAudio!==!0||!e(this.customVideo,!0)||!e(this.customAudio,!0))||(this.video!==!1||this.audio!==!1||this.screenVideo!==!1||this.screenAudio!==!1||!e(this.customVideo,!1)||!e(this.customAudio,!1))&&this}}],[{key:"fromBoolean",value:function(e){return new n({video:e,audio:e,screenVideo:e,screenAudio:e,customVideo:{"*":e},customAudio:{"*":e}})}},{key:"fromJSONObject",value:function(e){return new n({video:e.video,audio:e.audio,screenVideo:e.screenVideo,screenAudio:e.screenAudio,customVideo:e.customVideo!==void 0?ps({},e.customVideo):void 0,customAudio:e.customAudio!==void 0?ps({},e.customAudio):void 0})}},{key:"fromMinifiedJSONObject",value:function(e){return new n({video:e.v,audio:e.a,screenVideo:e.sv,screenAudio:e.sa,customVideo:e.cv,customAudio:e.ca})}},{key:"validateJSONObject",value:function(e,r){if(typeof e=="boolean")return[!0];if(ut(e)!=="object")return[!1,"invalid (non-object, non-boolean) value in canReceive"];for(var a=Object.keys(e),l=0,f=a;l<f.length;l++){var h=f[l];if(!Mc.includes(h))return[!1,"invalid media type '".concat(h,"' in canReceive")];if(mk.includes(h)){if(typeof e[h]!="boolean")return[!1,"invalid (non-boolean) value for media type '".concat(h,"' in canReceive")]}else{if(ut(e[h])!=="object")return[!1,"invalid (non-object) value for media type '".concat(h,"' in canReceive")];for(var v=0,y=Object.values(e[h]);v<y.length;v++)if(typeof y[v]!="boolean")return[!1,"invalid (non-boolean) value for entry within '".concat(h,"' in canReceive")];if(r&&e[h]["*"]===void 0)return[!1,`canReceive "base" permission must specify "*" as an entry within '`.concat(h,"'")]}}return r&&a.length!==Mc.length?[!1,'canReceive "base" permission must specify all media types: '.concat(Mc.join(", ")," (or be set to a boolean shorthand)")]:[!0]}}])})(),vk=["result"],yk=["preserveIframe"];function Yv(n,e){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(n);e&&(a=a.filter((function(l){return Object.getOwnPropertyDescriptor(n,l).enumerable}))),r.push.apply(r,a)}return r}function je(n){for(var e=1;e<arguments.length;e++){var r=arguments[e]!=null?arguments[e]:{};e%2?Yv(Object(r),!0).forEach((function(a){ci(n,a,r[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(r)):Yv(Object(r)).forEach((function(a){Object.defineProperty(n,a,Object.getOwnPropertyDescriptor(r,a))}))}return n}function Xv(){try{var n=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){})))}catch{}return(Xv=function(){return!!n})()}function Zv(n,e){var r=typeof Symbol<"u"&&n[Symbol.iterator]||n["@@iterator"];if(!r){if(Array.isArray(n)||(r=(function(y,k){if(y){if(typeof y=="string")return ey(y,k);var E={}.toString.call(y).slice(8,-1);return E==="Object"&&y.constructor&&(E=y.constructor.name),E==="Map"||E==="Set"?Array.from(y):E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E)?ey(y,k):void 0}})(n))||e){r&&(n=r);var a=0,l=function(){};return{s:l,n:function(){return a>=n.length?{done:!0}:{done:!1,value:n[a++]}},e:function(y){throw y},f:l}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var f,h=!0,v=!1;return{s:function(){r=r.call(n)},n:function(){var y=r.next();return h=y.done,y},e:function(y){v=!0,f=y},f:function(){try{h||r.return==null||r.return()}finally{if(v)throw f}}}}function ey(n,e){(e==null||e>n.length)&&(e=n.length);for(var r=0,a=Array(e);r<e;r++)a[r]=n[r];return a}var So={},ty="video",_k="voice",ny=ot()?{data:{}}:{data:{},topology:"none"},ry={present:0,hidden:0},iy={maxBitrate:{min:1e5,max:25e5},maxFramerate:{min:1,max:30},scaleResolutionDownBy:{min:1,max:8}},fh=Object.keys(iy),sy=["state","volume","simulcastEncodings"],oy={androidInCallNotification:{title:"string",subtitle:"string",iconName:"string",disableForCustomOverride:"boolean"},disableAutoDeviceManagement:{audio:"boolean",video:"boolean"}},Cu={id:{iconPath:"string",iconPathDarkMode:"string",label:"string",tooltip:"string",visualState:"'default' | 'sidebar-open' | 'active'"}},hh={id:{allow:"string",controlledBy:"'*' | 'owners' | string[]",csp:"string",iconURL:"string",label:"string",loading:"'eager' | 'lazy'",location:"'main' | 'sidebar'",name:"string",referrerPolicy:"string",sandbox:"string",src:"string",srcdoc:"string",shared:"string[] | 'owners' | boolean"}},ko={customIntegrations:{validate:my,help:py()},customTrayButtons:{validate:gy,help:"customTrayButtons should be a dictionary of the type ".concat(JSON.stringify(Cu))},url:{validate:function(n){return typeof n=="string"},help:"url should be a string"},baseUrl:{validate:function(n){return typeof n=="string"},help:"baseUrl should be a string"},token:{validate:function(n){return typeof n=="string"},help:"token should be a string",queryString:"t"},dailyConfig:{validate:function(n,e){try{return e.validateDailyConfig(n),!0}catch(r){console.error("Failed to validate dailyConfig",r)}return!1},help:"Unsupported dailyConfig. Check error logs for detailed info."},reactNativeConfig:{validate:function(n){return vy(n,oy)},help:"reactNativeConfig should look like ".concat(JSON.stringify(oy),", all fields optional")},lang:{validate:function(n){return["da","de","en-us","en","es","fi","fr","it","jp","ka","nl","no","pl","pt","pt-BR","ru","sv","tr","user"].includes(n)},help:"language not supported. Options are: da, de, en-us, en, es, fi, fr, it, jp, ka, nl, no, pl, pt, pt-BR, ru, sv, tr, user"},userName:!0,userData:{validate:function(n){try{return cy(n),!0}catch(e){return console.error(e),!1}},help:"invalid userData type provided"},startVideoOff:!0,startAudioOff:!0,allowLocalVideo:!0,allowLocalAudio:!0,activeSpeakerMode:!0,showLeaveButton:!0,showLocalVideo:!0,showParticipantsBar:!0,showFullscreenButton:!0,showUserNameChangeUI:!0,iframeStyle:!0,customLayout:!0,cssFile:!0,cssText:!0,bodyClass:!0,videoSource:{validate:function(n,e){if(typeof n=="boolean")return e._preloadCache.allowLocalVideo=n,!0;var r;if(n instanceof MediaStreamTrack)e._sharedTracks.videoTrack=n,r={customTrack:Fi};else{if(delete e._sharedTracks.videoTrack,typeof n!="string")return console.error("videoSource must be a MediaStreamTrack, boolean, or a string"),!1;r={deviceId:n}}return e._updatePreloadCacheInputSettings({video:{settings:r}},!1),!0}},audioSource:{validate:function(n,e){if(typeof n=="boolean")return e._preloadCache.allowLocalAudio=n,!0;var r;if(n instanceof MediaStreamTrack)e._sharedTracks.audioTrack=n,r={customTrack:Fi};else{if(delete e._sharedTracks.audioTrack,typeof n!="string")return console.error("audioSource must be a MediaStreamTrack, boolean, or a string"),!1;r={deviceId:n}}return e._updatePreloadCacheInputSettings({audio:{settings:r}},!1),!0}},subscribeToTracksAutomatically:{validate:function(n,e){return e._preloadCache.subscribeToTracksAutomatically=n,!0}},theme:{validate:function(n){var e=["accent","accentText","background","backgroundAccent","baseText","border","mainAreaBg","mainAreaBgAccent","mainAreaText","supportiveText"],r=function(a){for(var l=0,f=Object.keys(a);l<f.length;l++){var h=f[l];if(!e.includes(h))return console.error('unsupported color "'.concat(h,'". Valid colors: ').concat(e.join(", "))),!1;if(!a[h].match(/^#[0-9a-f]{6}|#[0-9a-f]{3}$/i))return console.error("".concat(h,' theme color should be provided in valid hex color format. Received: "').concat(a[h],'"')),!1}return!0};return ut(n)==="object"&&("light"in n&&"dark"in n||"colors"in n)?"light"in n&&"dark"in n?"colors"in n.light?"colors"in n.dark?r(n.light.colors)&&r(n.dark.colors):(console.error('Dark theme is missing "colors" property.',n),!1):(console.error('Light theme is missing "colors" property.',n),!1):r(n.colors):(console.error('Theme must contain either both "light" and "dark" properties, or "colors".',n),!1)},help:"unsupported theme configuration. Check error logs for detailed info."},layoutConfig:{validate:function(n){if("grid"in n){var e=n.grid;if("maxTilesPerPage"in e){if(!Number.isInteger(e.maxTilesPerPage))return console.error("grid.maxTilesPerPage should be an integer. You passed ".concat(e.maxTilesPerPage,".")),!1;if(e.maxTilesPerPage>49)return console.error("grid.maxTilesPerPage can't be larger than 49 without sacrificing browser performance. Please contact us at https://www.daily.co/contact to talk about your use case."),!1}if("minTilesPerPage"in e){if(!Number.isInteger(e.minTilesPerPage))return console.error("grid.minTilesPerPage should be an integer. You passed ".concat(e.minTilesPerPage,".")),!1;if(e.minTilesPerPage<1)return console.error("grid.minTilesPerPage can't be lower than 1."),!1;if("maxTilesPerPage"in e&&e.minTilesPerPage>e.maxTilesPerPage)return console.error("grid.minTilesPerPage can't be higher than grid.maxTilesPerPage."),!1}}return!0},help:"unsupported layoutConfig. Check error logs for detailed info."},receiveSettings:{validate:function(n){return ly(n,{allowAllParticipantsKey:!1})},help:hy({allowAllParticipantsKey:!1})},sendSettings:{validate:function(n,e){return!!(function(r,a){try{return a.validateUpdateSendSettings(r),!0}catch(l){return console.error("Failed to validate send settings",l),!1}})(n,e)&&(e._preloadCache.sendSettings=n,!0)},help:"Invalid sendSettings provided. Check error logs for detailed info."},inputSettings:{validate:function(n,e){var r;return!!uy(n)&&(e._inputSettings||(e._inputSettings={}),dy(n,(r=e.properties)===null||r===void 0?void 0:r.dailyConfig,e._sharedTracks),e._updatePreloadCacheInputSettings(n,!0),!0)},help:mh()},layout:{validate:function(n){return n==="custom-v1"||n==="browser"||n==="none"},help:'layout may only be set to "custom-v1"',queryString:"layout"},emb:{queryString:"emb"},embHref:{queryString:"embHref"},dailyJsVersion:{queryString:"dailyJsVersion"},proxy:{queryString:"proxy"},strictMode:!0,allowMultipleCallInstances:!0},Eu={styles:{validate:function(n){for(var e in n)if(e!=="cam"&&e!=="screen")return!1;if(n.cam){for(var r in n.cam)if(r!=="div"&&r!=="video")return!1}if(n.screen){for(var a in n.screen)if(a!=="div"&&a!=="video")return!1}return!0},help:"styles format should be a subset of: { cam: {div: {}, video: {}}, screen: {div: {}, video: {}} }"},setSubscribedTracks:{validate:function(n,e){if(e._preloadCache.subscribeToTracksAutomatically)return!1;var r=[!0,!1,"staged"];if(r.includes(n)||!ot()&&n==="avatar")return!0;var a=["audio","video","screenAudio","screenVideo","rmpAudio","rmpVideo"],l=function(f){var h=arguments.length>1&&arguments[1]!==void 0&&arguments[1];for(var v in f)if(v==="custom"){if(!r.includes(f[v])&&!l(f[v],!0))return!1}else{var y=!h&&!a.includes(v),k=!r.includes(f[v]);if(y||k)return!1}return!0};return l(n)},help:"setSubscribedTracks cannot be used when setSubscribeToTracksAutomatically is enabled, and should be of the form: "+"true".concat(ot()?"":" | 'avatar'"," | false | 'staged' | { [audio: true|false|'staged'], [video: true|false|'staged'], [screenAudio: true|false|'staged'], [screenVideo: true|false|'staged'] }")},setAudio:!0,setVideo:!0,setScreenShare:{validate:function(n){return n===!1},help:"setScreenShare must be false, as it's only meant for stopping remote participants' screen shares"},eject:!0,updatePermissions:{validate:function(n){for(var e=0,r=Object.entries(n);e<r.length;e++){var a=mn(r[e],2),l=a[0],f=a[1];switch(l){case"hasPresence":if(typeof f!="boolean")return!1;break;case"canSend":if(f instanceof Set||f instanceof Array||Array.isArray(f)){var h,v=["video","audio","screenVideo","screenAudio","customVideo","customAudio"],y=Zv(f);try{for(y.s();!(h=y.n()).done;){var k=h.value;if(!v.includes(k))return!1}}catch(q){y.e(q)}finally{y.f()}}else if(typeof f!="boolean")return!1;(f instanceof Array||Array.isArray(f))&&(n.canSend=new Set(f));break;case"canReceive":var E=mn(Kv.validateJSONObject(f),2),O=E[0],D=E[1];if(!O)return console.error(D),!1;break;case"canAdmin":if(f instanceof Set||f instanceof Array||Array.isArray(f)){var x,L=["participants","streaming","transcription"],R=Zv(f);try{for(R.s();!(x=R.n()).done;){var N=x.value;if(!L.includes(N))return!1}}catch(q){R.e(q)}finally{R.f()}}else if(typeof f!="boolean")return!1;(f instanceof Array||Array.isArray(f))&&(n.canAdmin=new Set(f));break;default:return!1}}return!0},help:"updatePermissions can take hasPresence, canSend, canReceive, and canAdmin permissions. hasPresence must be a boolean. canSend can be a boolean or an Array or Set of media types (video, audio, screenVideo, screenAudio, customVideo, customAudio). canReceive must be an object specifying base, byUserId, and/or byParticipantId fields (see documentation for more details). canAdmin can be a boolean or an Array or Set of admin types (participants, streaming, transcription)."}};Promise.any||(Promise.any=(function(){var n=He((function*(e){return new Promise((function(r,a){var l=[];e.forEach((function(f){return Promise.resolve(f).then((function(h){r(h)})).catch((function(h){l.push(h),l.length===e.length&&a(l)}))}))}))}));return function(e){return n.apply(this,arguments)}})());var Mu=(function(){function n(g){var M,C,j,F,H,ie,fe=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(ar(this,n),j=this,F=Br(F=n),ci(C=Gl(j,Xv()?Reflect.construct(F,[],Br(j).constructor):F.apply(j,H)),"startListeningForDeviceChanges",(function(){dk(C.handleDeviceChange)})),ci(C,"stopListeningForDeviceChanges",(function(){fk(C.handleDeviceChange)})),ci(C,"handleDeviceChange",(function(qe){qe=qe.map((function(Xe){return JSON.parse(JSON.stringify(Xe))})),C.emitDailyJSEvent({action:"available-devices-updated",availableDevices:qe})})),ci(C,"handleNativeAppStateChange",(function(){var qe=He((function*(Xe){if(Xe==="destroyed")return console.warn("App has been destroyed before leaving the meeting. Cleaning up all the resources!"),void(yield C.destroy());var Vt=Xe==="active";C.disableReactNativeAutoDeviceManagement("video")||(Vt?C.camUnmutedBeforeLosingNativeActiveState&&C.setLocalVideo(!0):(C.camUnmutedBeforeLosingNativeActiveState=C.localVideo(),C.camUnmutedBeforeLosingNativeActiveState&&C.setLocalVideo(!1)))}));return function(Xe){return qe.apply(this,arguments)}})()),ci(C,"handleNativeAudioFocusChange",(function(qe){C.disableReactNativeAutoDeviceManagement("audio")||(C._hasNativeAudioFocus=qe,C.toggleParticipantAudioBasedOnNativeAudioFocus(),C._hasNativeAudioFocus?C.micUnmutedBeforeLosingNativeAudioFocus&&C.setLocalAudio(!0):(C.micUnmutedBeforeLosingNativeAudioFocus=C.localAudio(),C.setLocalAudio(!1)))})),ci(C,"handleNativeSystemScreenCaptureStop",(function(){C.stopScreenShare()})),!rh()&&!ot())throw new Error("WebRTC not supported or suppressed");if(C.strictMode=fe.strictMode===void 0||fe.strictMode,C.allowMultipleCallInstances=(M=fe.allowMultipleCallInstances)!==null&&M!==void 0&&M,Object.keys(So).length&&(C._logDuplicateInstanceAttempt(),!C.allowMultipleCallInstances)){if(C.strictMode)throw new Error("Duplicate DailyIframe instances are not allowed");console.warn("Using strictMode: false to allow multiple call instances is now deprecated. Set `allowMultipleCallInstances: true`")}if(window._daily||(window._daily={pendings:[],instances:{}}),C.callClientId=Kl(),So[(ie=C).callClientId]=ie,window._daily.instances[C.callClientId]={},C._sharedTracks={},window._daily.instances[C.callClientId].tracks=C._sharedTracks,fe.dailyJsVersion=n.version(),C._iframe=g,C._callObjectMode=fe.layout==="none"&&!C._iframe,C._preloadCache={subscribeToTracksAutomatically:!0,outputDeviceId:null,inputSettings:null,sendSettings:null,videoTrackForNetworkConnectivityTest:null,videoTrackForConnectionQualityTest:null},fe.showLocalVideo!==void 0?C._callObjectMode?console.error("showLocalVideo is not available in call object mode"):C._showLocalVideo=!!fe.showLocalVideo:C._showLocalVideo=!0,fe.showParticipantsBar!==void 0?C._callObjectMode?console.error("showParticipantsBar is not available in call object mode"):C._showParticipantsBar=!!fe.showParticipantsBar:C._showParticipantsBar=!0,fe.customIntegrations!==void 0?C._callObjectMode?console.error("customIntegrations is not available in call object mode"):C._customIntegrations=fe.customIntegrations:C._customIntegrations={},fe.customTrayButtons!==void 0?C._callObjectMode?console.error("customTrayButtons is not available in call object mode"):C._customTrayButtons=fe.customTrayButtons:C._customTrayButtons={},fe.activeSpeakerMode!==void 0?C._callObjectMode?console.error("activeSpeakerMode is not available in call object mode"):C._activeSpeakerMode=!!fe.activeSpeakerMode:C._activeSpeakerMode=!1,fe.receiveSettings?C._callObjectMode?C._receiveSettings=fe.receiveSettings:console.error("receiveSettings is only available in call object mode"):C._receiveSettings={},C.validateProperties(fe),C.properties=je({},fe),C._inputSettings||(C._inputSettings={}),C._callObjectLoader=C._callObjectMode?new ek(C.callClientId):null,C._callState=av,C._isPreparingToJoin=!1,C._accessState={access:Yf},C._meetingSessionSummary={},C._finalSummaryOfPrevSession={},C._meetingSessionState=vh(ny,C._callObjectMode),C._nativeInCallAudioMode=ty,C._participants={},C._isScreenSharing=!1,C._participantCounts=ry,C._rmpPlayerState={},C._waitingParticipants={},C._network={threshold:"good",quality:100,networkState:"unknown",stats:{}},C._activeSpeaker={},C._localAudioLevel=0,C._isLocalAudioLevelObserverRunning=!1,C._remoteParticipantsAudioLevel={},C._isRemoteParticipantsAudioLevelObserverRunning=!1,C._maxAppMessageSize=Xf,C._messageChannel=ot()?new XS:new YS,C._iframe&&(C._iframe.requestFullscreen?C._iframe.addEventListener("fullscreenchange",(function(){document.fullscreenElement===C._iframe?(C.emitDailyJSEvent({action:vu}),C.sendMessageToCallMachine({action:vu})):(C.emitDailyJSEvent({action:yu}),C.sendMessageToCallMachine({action:yu}))})):C._iframe.webkitRequestFullscreen&&C._iframe.addEventListener("webkitfullscreenchange",(function(){document.webkitFullscreenElement===C._iframe?(C.emitDailyJSEvent({action:vu}),C.sendMessageToCallMachine({action:vu})):(C.emitDailyJSEvent({action:yu}),C.sendMessageToCallMachine({action:yu}))}))),ot()){var Me=C.nativeUtils();Me.addAudioFocusChangeListener&&Me.removeAudioFocusChangeListener&&Me.addAppStateChangeListener&&Me.removeAppStateChangeListener&&Me.addSystemScreenCaptureStopListener&&Me.removeSystemScreenCaptureStopListener||console.warn("expected (add|remove)(AudioFocusChange|AppActiveStateChange|SystemScreenCaptureStop)Listener to be available in React Native"),C._hasNativeAudioFocus=!0,Me.addAudioFocusChangeListener(C.handleNativeAudioFocusChange),Me.addAppStateChangeListener(C.handleNativeAppStateChange),Me.addSystemScreenCaptureStopListener(C.handleNativeSystemScreenCaptureStop)}return C._callObjectMode&&C.startListeningForDeviceChanges(),C._messageChannel.addListenerForMessagesFromCallMachine(C.handleMessageFromCallMachine,C.callClientId,C),C}return Hl(n,Ql),cr(n,[{key:"destroy",value:(le=He((function*(){var g;try{yield this.leave()}catch{}var M=this._iframe;if(M){var C=M.parentElement;C&&C.removeChild(M)}if(this._messageChannel.removeListener(this.handleMessageFromCallMachine),ot()){var j=this.nativeUtils();j.removeAudioFocusChangeListener(this.handleNativeAudioFocusChange),j.removeAppStateChangeListener(this.handleNativeAppStateChange),j.removeSystemScreenCaptureStopListener(this.handleNativeSystemScreenCaptureStop)}this._callObjectMode&&this.stopListeningForDeviceChanges(),this.resetMeetingDependentVars(),this._destroyed=!0,this.emitDailyJSEvent({action:"call-instance-destroyed"}),delete So[this.callClientId],!((g=window)===null||g===void 0||(g=g._daily)===null||g===void 0)&&g.instances&&delete window._daily.instances[this.callClientId],this.strictMode&&(this.callClientId=void 0)})),function(){return le.apply(this,arguments)})},{key:"isDestroyed",value:function(){return!!this._destroyed}},{key:"loadCss",value:function(g){var M=g.bodyClass,C=g.cssFile,j=g.cssText;return at(),this.sendMessageToCallMachine({action:"load-css",cssFile:this.absoluteUrl(C),bodyClass:M,cssText:j}),this}},{key:"iframe",value:function(){return at(),this._iframe}},{key:"meetingState",value:function(){return this._callState}},{key:"accessState",value:function(){return zr(this._callObjectMode,"accessState()"),this._accessState}},{key:"participants",value:function(){return this._participants}},{key:"participantCounts",value:function(){return this._participantCounts}},{key:"waitingParticipants",value:function(){return zr(this._callObjectMode,"waitingParticipants()"),this._waitingParticipants}},{key:"validateParticipantProperties",value:function(g,M){for(var C in M){if(!Eu[C])throw new Error("unrecognized updateParticipant property ".concat(C));if(Eu[C].validate&&!Eu[C].validate(M[C],this,this._participants[g]))throw new Error(Eu[C].help)}}},{key:"updateParticipant",value:function(g,M){return this._participants.local&&this._participants.local.session_id===g&&(g="local"),g&&M&&(this.validateParticipantProperties(g,M),this.sendMessageToCallMachine({action:"update-participant",id:g,properties:M})),this}},{key:"updateParticipants",value:function(g){var M=this._participants.local&&this._participants.local.session_id;for(var C in g)C===M&&(C="local"),C&&g[C]&&this.validateParticipantProperties(C,g[C]);return this.sendMessageToCallMachine({action:"update-participants",participants:g}),this}},{key:"updateWaitingParticipant",value:(J=He((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"",C=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(zr(this._callObjectMode,"updateWaitingParticipant()"),_t(this._callState,"updateWaitingParticipant()"),typeof M!="string"||ut(C)!=="object")throw new Error("updateWaitingParticipant() must take an id string and a updates object");return new Promise((function(j,F){g.sendMessageToCallMachine({action:"daily-method-update-waiting-participant",id:M,updates:C},(function(H){H.error&&F(H.error),H.id||F(new Error("unknown error in updateWaitingParticipant()")),j({id:H.id})}))}))})),function(){return J.apply(this,arguments)})},{key:"updateWaitingParticipants",value:(oe=He((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(zr(this._callObjectMode,"updateWaitingParticipants()"),_t(this._callState,"updateWaitingParticipants()"),ut(M)!=="object")throw new Error("updateWaitingParticipants() must take a mapping between ids and update objects");return new Promise((function(C,j){g.sendMessageToCallMachine({action:"daily-method-update-waiting-participants",updatesById:M},(function(F){F.error&&j(F.error),F.ids||j(new Error("unknown error in updateWaitingParticipants()")),C({ids:F.ids})}))}))})),function(){return oe.apply(this,arguments)})},{key:"requestAccess",value:(ke=He((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},C=M.access,j=C===void 0?{level:Gb}:C,F=M.name,H=F===void 0?"":F;return zr(this._callObjectMode,"requestAccess()"),_t(this._callState,"requestAccess()"),new Promise((function(ie,fe){g.sendMessageToCallMachine({action:"daily-method-request-access",access:j,name:H},(function(Me){Me.error&&fe(Me.error),Me.access||fe(new Error("unknown error in requestAccess()")),ie({access:Me.access,granted:Me.granted})}))}))})),function(){return ke.apply(this,arguments)})},{key:"localAudio",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.audio.state):null}},{key:"localVideo",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.video.state):null}},{key:"setLocalAudio",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return"forceDiscardTrack"in M&&(ot()?(console.warn("forceDiscardTrack option not supported in React Native; ignoring"),M={}):g&&(console.warn("forceDiscardTrack option only supported when calling setLocalAudio(false); ignoring"),M={})),this.sendMessageToCallMachine({action:"local-audio",state:g,options:M}),this}},{key:"localScreenAudio",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.screenAudio.state):null}},{key:"localScreenVideo",value:function(){return this._participants.local?!["blocked","off"].includes(this._participants.local.tracks.screenVideo.state):null}},{key:"updateScreenShare",value:function(g){if(this._isScreenSharing)return this.sendMessageToCallMachine({action:"local-screen-update",options:g}),this;console.warn("There is no screen share in progress. Try calling startScreenShare first.")}},{key:"setLocalVideo",value:function(g){return this.sendMessageToCallMachine({action:"local-video",state:g}),this}},{key:"_setAllowLocalAudio",value:function(g){if(this._preloadCache.allowLocalAudio=g,this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-allow-local-audio",state:g}),this}},{key:"_setAllowLocalVideo",value:function(g){if(this._preloadCache.allowLocalVideo=g,this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-allow-local-video",state:g}),this}},{key:"getReceiveSettings",value:(he=He((function*(g){var M=this,C=(arguments.length>1&&arguments[1]!==void 0?arguments[1]:{}).showInheritedValues,j=C!==void 0&&C;if(zr(this._callObjectMode,"getReceiveSettings()"),!this._callMachineInitialized)return this._receiveSettings;switch(ut(g)){case"string":return new Promise((function(F){M.sendMessageToCallMachine({action:"get-single-participant-receive-settings",id:g,showInheritedValues:j},(function(H){F(H.receiveSettings)}))}));case"undefined":return this._receiveSettings;default:throw new Error('first argument to getReceiveSettings() must be a participant id (or "base"), or there should be no arguments')}})),function(g){return he.apply(this,arguments)})},{key:"updateReceiveSettings",value:(we=He((function*(g){var M=this;if(zr(this._callObjectMode,"updateReceiveSettings()"),!ly(g,{allowAllParticipantsKey:!0}))throw new Error(hy({allowAllParticipantsKey:!0}));return _t(this._callState,"updateReceiveSettings()","To specify receive settings earlier, use the receiveSettings config property."),new Promise((function(C){M.sendMessageToCallMachine({action:"update-receive-settings",receiveSettings:g},(function(j){C({receiveSettings:j.receiveSettings})}))}))})),function(g){return we.apply(this,arguments)})},{key:"_prepInputSettingsForSharing",value:function(g,M){if(g){var C={};if(g.audio){var j,F,H;g.audio.settings&&(!Object.keys(g.audio.settings).length&&M||(C.audio={settings:je({},g.audio.settings)})),M&&(j=C.audio)!==null&&j!==void 0&&(j=j.settings)!==null&&j!==void 0&&j.customTrack&&(C.audio.settings={customTrack:this._sharedTracks.audioTrack});var ie=((F=g.audio.processor)===null||F===void 0?void 0:F.type)==="none"&&((H=g.audio.processor)===null||H===void 0?void 0:H._isDefaultWhenNone);if(g.audio.processor&&!ie){var fe=je({},g.audio.processor);delete fe._isDefaultWhenNone,C.audio=je(je({},C.audio),{},{processor:fe})}}if(g.video){var Me,qe,Xe;g.video.settings&&(!Object.keys(g.video.settings).length&&M||(C.video={settings:je({},g.video.settings)})),M&&(Me=C.video)!==null&&Me!==void 0&&(Me=Me.settings)!==null&&Me!==void 0&&Me.customTrack&&(C.video.settings={customTrack:this._sharedTracks.videoTrack});var Vt=((qe=g.video.processor)===null||qe===void 0?void 0:qe.type)==="none"&&((Xe=g.video.processor)===null||Xe===void 0?void 0:Xe._isDefaultWhenNone);if(g.video.processor&&!Vt){var wn=je({},g.video.processor);delete wn._isDefaultWhenNone,C.video=je(je({},C.video),{},{processor:wn})}}return C}}},{key:"getInputSettings",value:function(){var g=this;return at(),new Promise((function(M){M(g._getInputSettings())}))}},{key:"_getInputSettings",value:function(){var g,M,C,j,F,H,ie={processor:{type:"none",_isDefaultWhenNone:!0}};this._inputSettings?(g=((C=this._inputSettings)===null||C===void 0?void 0:C.video)||ie,M=((j=this._inputSettings)===null||j===void 0?void 0:j.audio)||ie):(g=((F=this._preloadCache)===null||F===void 0||(F=F.inputSettings)===null||F===void 0?void 0:F.video)||ie,M=((H=this._preloadCache)===null||H===void 0||(H=H.inputSettings)===null||H===void 0?void 0:H.audio)||ie);var fe={audio:M,video:g};return this._prepInputSettingsForSharing(fe,!0)}},{key:"_updatePreloadCacheInputSettings",value:function(g,M){var C=this._inputSettings||{},j={};if(g.video){var F,H,ie;j.video={},g.video.settings?(j.video.settings={},M||g.video.settings.customTrack||(ie=C.video)===null||ie===void 0||!ie.settings?j.video.settings=g.video.settings:j.video.settings=je(je({},C.video.settings),g.video.settings),Object.keys(j.video.settings).length||delete j.video.settings):(F=C.video)!==null&&F!==void 0&&F.settings&&(j.video.settings=C.video.settings),g.video.processor?j.video.processor=g.video.processor:(H=C.video)!==null&&H!==void 0&&H.processor&&(j.video.processor=C.video.processor)}else C.video&&(j.video=C.video);if(g.audio){var fe,Me,qe;j.audio={},g.audio.settings?(j.audio.settings={},M||g.audio.settings.customTrack||(qe=C.audio)===null||qe===void 0||!qe.settings?j.audio.settings=g.audio.settings:j.audio.settings=je(je({},C.audio.settings),g.audio.settings),Object.keys(j.audio.settings).length||delete j.audio.settings):(fe=C.audio)!==null&&fe!==void 0&&fe.settings&&(j.audio.settings=C.audio.settings),g.audio.processor?j.audio.processor=g.audio.processor:(Me=C.audio)!==null&&Me!==void 0&&Me.processor&&(j.audio.processor=C.audio.processor)}else C.audio&&(j.audio=C.audio);this._maybeUpdateInputSettings(j)}},{key:"_devicesFromInputSettings",value:function(g){var M,C,j=(g==null||(M=g.video)===null||M===void 0||(M=M.settings)===null||M===void 0?void 0:M.deviceId)||null,F=(g==null||(C=g.audio)===null||C===void 0||(C=C.settings)===null||C===void 0?void 0:C.deviceId)||null,H=this._preloadCache.outputDeviceId||null;return{camera:j?{deviceId:j}:{},mic:F?{deviceId:F}:{},speaker:H?{deviceId:H}:{}}}},{key:"updateInputSettings",value:(it=He((function*(g){var M=this;return at(),uy(g)?g.video||g.audio?(dy(g,this.properties.dailyConfig,this._sharedTracks),this._callObjectMode&&!this._callMachineInitialized?(this._updatePreloadCacheInputSettings(g,!0),this._getInputSettings()):new Promise((function(C,j){M.sendMessageToCallMachine({action:"update-input-settings",inputSettings:g},(function(F){if(F.error)j(F.error);else{if(F.returnPreloadCache)return M._updatePreloadCacheInputSettings(g,!0),void C(M._getInputSettings());M._maybeUpdateInputSettings(F.inputSettings),C(M._prepInputSettingsForSharing(F.inputSettings,!0))}}))}))):this._getInputSettings():(console.error(mh()),Promise.reject(mh()))})),function(g){return it.apply(this,arguments)})},{key:"setBandwidth",value:function(g){var M=g.kbs,C=g.trackConstraints;if(at(),this._callMachineInitialized)return this.sendMessageToCallMachine({action:"set-bandwidth",kbs:M,trackConstraints:C}),this}},{key:"getDailyLang",value:function(){var g=this;if(at(),this._callMachineInitialized)return new Promise((function(M){g.sendMessageToCallMachine({action:"get-daily-lang"},(function(C){delete C.action,delete C.callbackStamp,M(C)}))}))}},{key:"setDailyLang",value:function(g){return at(),this.sendMessageToCallMachine({action:"set-daily-lang",lang:g}),this}},{key:"setProxyUrl",value:function(g){return this.sendMessageToCallMachine({action:"set-proxy-url",proxyUrl:g}),this}},{key:"setIceConfig",value:function(g){return this.sendMessageToCallMachine({action:"set-ice-config",iceConfig:g}),this}},{key:"meetingSessionSummary",value:function(){return[wo,hs].includes(this._callState)?this._finalSummaryOfPrevSession:this._meetingSessionSummary}},{key:"getMeetingSession",value:(De=He((function*(){var g=this;return console.warn("getMeetingSession() is deprecated: use meetingSessionSummary(), which will return immediately"),_t(this._callState,"getMeetingSession()"),new Promise((function(M){g.sendMessageToCallMachine({action:"get-meeting-session"},(function(C){delete C.action,delete C.callbackStamp,M(C)}))}))})),function(){return De.apply(this,arguments)})},{key:"meetingSessionState",value:function(){return _t(this._callState,"meetingSessionState"),this._meetingSessionState}},{key:"setMeetingSessionData",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"replace";zr(this._callObjectMode,"setMeetingSessionData()"),_t(this._callState,"setMeetingSessionData");try{(function(C,j){new ZS({data:C,mergeStrategy:j})})(g,M)}catch(C){throw console.error(C),C}try{this.sendMessageToCallMachine({action:"set-session-data",data:g,mergeStrategy:M})}catch(C){throw new Error("Error setting meeting session data: ".concat(C))}}},{key:"setUserName",value:function(g,M){var C=this;return this.properties.userName=g,new Promise((function(j){C.sendMessageToCallMachine({action:"set-user-name",name:g??"",thisMeetingOnly:ot()||!!M&&!!M.thisMeetingOnly},(function(F){delete F.action,delete F.callbackStamp,j(F)}))}))}},{key:"setUserData",value:(Y=He((function*(g){var M=this;try{cy(g)}catch(C){throw console.error(C),C}if(this.properties.userData=g,this._callMachineInitialized)return new Promise((function(C){try{M.sendMessageToCallMachine({action:"set-user-data",userData:g},(function(j){delete j.action,delete j.callbackStamp,C(j)}))}catch(j){throw new Error("Error setting user data: ".concat(j))}}))})),function(g){return Y.apply(this,arguments)})},{key:"validateAudioLevelInterval",value:function(g){if(g&&(g<100||typeof g!="number"))throw new Error("The interval must be a number greater than or equal to 100 milliseconds.")}},{key:"startLocalAudioLevelObserver",value:function(g){var M=this;if(typeof AudioWorkletNode>"u"&&!ot())throw new Error("startLocalAudioLevelObserver() is not supported on this browser");if(this.validateAudioLevelInterval(g),this._callMachineInitialized)return this._isLocalAudioLevelObserverRunning=!0,new Promise((function(C,j){M.sendMessageToCallMachine({action:"start-local-audio-level-observer",interval:g},(function(F){M._isLocalAudioLevelObserverRunning=!F.error,F.error?j({error:F.error}):C()}))}));this._preloadCache.localAudioLevelObserver={enabled:!0,interval:g}}},{key:"isLocalAudioLevelObserverRunning",value:function(){return this._isLocalAudioLevelObserverRunning}},{key:"stopLocalAudioLevelObserver",value:function(){this._preloadCache.localAudioLevelObserver=null,this._localAudioLevel=0,this._isLocalAudioLevelObserverRunning=!1,this.sendMessageToCallMachine({action:"stop-local-audio-level-observer"})}},{key:"startRemoteParticipantsAudioLevelObserver",value:function(g){var M=this;if(this.validateAudioLevelInterval(g),this._callMachineInitialized)return this._isRemoteParticipantsAudioLevelObserverRunning=!0,new Promise((function(C,j){M.sendMessageToCallMachine({action:"start-remote-participants-audio-level-observer",interval:g},(function(F){M._isRemoteParticipantsAudioLevelObserverRunning=!F.error,F.error?j({error:F.error}):C()}))}));this._preloadCache.remoteParticipantsAudioLevelObserver={enabled:!0,interval:g}}},{key:"isRemoteParticipantsAudioLevelObserverRunning",value:function(){return this._isRemoteParticipantsAudioLevelObserverRunning}},{key:"stopRemoteParticipantsAudioLevelObserver",value:function(){this._preloadCache.remoteParticipantsAudioLevelObserver=null,this._remoteParticipantsAudioLevel={},this._isRemoteParticipantsAudioLevelObserverRunning=!1,this.sendMessageToCallMachine({action:"stop-remote-participants-audio-level-observer"})}},{key:"startCamera",value:(Ee=He((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(zr(this._callObjectMode,"startCamera()"),ph(this._callState,this._isPreparingToJoin,"startCamera()","Did you mean to use setLocalAudio() and/or setLocalVideo() instead?"),this.needsLoad())try{yield this.load(M)}catch(C){return Promise.reject(C)}else{if(this._didPreAuth){if(M.url&&M.url!==this.properties.url)return console.error("url in startCamera() is different than the one used in preAuth()"),Promise.reject();if(M.token&&M.token!==this.properties.token)return console.error("token in startCamera() is different than the one used in preAuth()"),Promise.reject()}this.validateProperties(M),this.properties=je(je({},this.properties),M)}return new Promise((function(C){g._preloadCache.inputSettings=g._prepInputSettingsForSharing(g._inputSettings,!1),g.sendMessageToCallMachine({action:"start-camera",properties:ba(g.properties,g.callClientId),preloadCache:ba(g._preloadCache,g.callClientId)},(function(j){C({camera:j.camera,mic:j.mic,speaker:j.speaker})}))}))})),function(){return Ee.apply(this,arguments)})},{key:"validateCustomTrack",value:function(g,M,C){if(C&&C.length>50)throw new Error("Custom track `trackName` must not be more than 50 characters");if(M&&M!=="music"&&M!=="speech"&&!(M instanceof Object))throw new Error("Custom track `mode` must be either `music` | `speech` | `DailyMicAudioModeSettings` or `undefined`");if(C&&["cam-audio","cam-video","screen-video","screen-audio","rmpAudio","rmpVideo","customVideoDefaults"].includes(C))throw new Error("Custom track `trackName` must not match a track name already used by daily: cam-audio, cam-video, customVideoDefaults, screen-video, screen-audio, rmpAudio, rmpVideo");if(!(g instanceof MediaStreamTrack))throw new Error("Custom tracks provided must be instances of MediaStreamTrack")}},{key:"startCustomTrack",value:function(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{track,mode,trackName,ignoreAudioLevel};return at(),_t(this._callState,"startCustomTrack()"),this.validateCustomTrack(M.track,M.mode,M.trackName),new Promise((function(C,j){g._sharedTracks.customTrack=M.track,M.track=Fi,g.sendMessageToCallMachine({action:"start-custom-track",properties:M},(function(F){F.error?j({error:F.error}):C(F.mediaTag)}))}))}},{key:"stopCustomTrack",value:function(g){var M=this;return at(),_t(this._callState,"stopCustomTrack()"),new Promise((function(C){M.sendMessageToCallMachine({action:"stop-custom-track",mediaTag:g},(function(j){C(j.mediaTag)}))}))}},{key:"setCamera",value:function(g){var M=this;return Oc(),Tu(this._callMachineInitialized,"setCamera()"),new Promise((function(C){M.sendMessageToCallMachine({action:"set-camera",cameraDeviceId:g},(function(j){C({device:j.device})}))}))}},{key:"setAudioDevice",value:(ze=He((function*(g){return Oc(),this.nativeUtils().setAudioDevice(g),{deviceId:yield this.nativeUtils().getAudioDevice()}})),function(g){return ze.apply(this,arguments)})},{key:"cycleCamera",value:function(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return new Promise((function(C){g.sendMessageToCallMachine({action:"cycle-camera",properties:M},(function(j){C({device:j.device})}))}))}},{key:"cycleMic",value:function(){var g=this;return at(),new Promise((function(M){g.sendMessageToCallMachine({action:"cycle-mic"},(function(C){M({device:C.device})}))}))}},{key:"getCameraFacingMode",value:function(){var g=this;return Oc(),new Promise((function(M){g.sendMessageToCallMachine({action:"get-camera-facing-mode"},(function(C){M(C.facingMode)}))}))}},{key:"setInputDevicesAsync",value:(S=He((function*(g){var M=this,C=g.audioDeviceId,j=g.videoDeviceId,F=g.audioSource,H=g.videoSource;if(at(),F!==void 0&&(C=F),H!==void 0&&(j=H),typeof C=="boolean"&&(this._setAllowLocalAudio(C),C=void 0),typeof j=="boolean"&&(this._setAllowLocalVideo(j),j=void 0),!C&&!j)return yield this.getInputDevices();var ie={};return C&&(C instanceof MediaStreamTrack?(this._sharedTracks.audioTrack=C,C=Fi,ie.audio={settings:{customTrack:C}}):(delete this._sharedTracks.audioTrack,ie.audio={settings:{deviceId:C}})),j&&(j instanceof MediaStreamTrack?(this._sharedTracks.videoTrack=j,j=Fi,ie.video={settings:{customTrack:j}}):(delete this._sharedTracks.videoTrack,ie.video={settings:{deviceId:j}})),this._callObjectMode&&this.needsLoad()?(this._updatePreloadCacheInputSettings(ie,!1),this._devicesFromInputSettings(this._inputSettings)):new Promise((function(fe){M.sendMessageToCallMachine({action:"set-input-devices",audioDeviceId:C,videoDeviceId:j},(function(Me){if(delete Me.action,delete Me.callbackStamp,Me.returnPreloadCache)return M._updatePreloadCacheInputSettings(ie,!1),void fe(M._devicesFromInputSettings(M._inputSettings));fe(Me)}))}))})),function(g){return S.apply(this,arguments)})},{key:"setOutputDeviceAsync",value:(Ve=He((function*(g){var M=this,C=g.outputDeviceId;if(at(),!C||typeof C!="string")throw new Error("outputDeviceId must be provided and must be a valid device id");return this._preloadCache.outputDeviceId=C,this._callObjectMode&&this.needsLoad()?this._devicesFromInputSettings(this._inputSettings):new Promise((function(j,F){M.sendMessageToCallMachine({action:"set-output-device",outputDeviceId:C},(function(H){if(delete H.action,delete H.callbackStamp,H.error){var ie=new Error(H.error.message);return ie.type=H.error.type,void F(ie)}H.returnPreloadCache?j(M._devicesFromInputSettings(M._inputSettings)):j(H)}))}))})),function(g){return Ve.apply(this,arguments)})},{key:"getInputDevices",value:(Ce=He((function*(){var g=this;return this._callObjectMode&&this.needsLoad()?this._devicesFromInputSettings(this._inputSettings):new Promise((function(M){g.sendMessageToCallMachine({action:"get-input-devices"},(function(C){C.returnPreloadCache?M(g._devicesFromInputSettings(g._inputSettings)):M({camera:C.camera,mic:C.mic,speaker:C.speaker})}))}))})),function(){return Ce.apply(this,arguments)})},{key:"nativeInCallAudioMode",value:function(){return Oc(),this._nativeInCallAudioMode}},{key:"setNativeInCallAudioMode",value:function(g){if(Oc(),[ty,_k].includes(g)){if(g!==this._nativeInCallAudioMode)return this._nativeInCallAudioMode=g,!this.disableReactNativeAutoDeviceManagement("audio")&&Ou(this._callState,this._isPreparingToJoin)&&this.nativeUtils().setAudioMode(this._nativeInCallAudioMode),this}else console.error("invalid in-call audio mode specified: ",g)}},{key:"preAuth",value:(ye=He((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(zr(this._callObjectMode,"preAuth()"),ph(this._callState,this._isPreparingToJoin,"preAuth()"),this.needsLoad()&&(yield this.load(M)),!M.url)throw new Error("preAuth() requires at least a url to be provided");return this.validateProperties(M),this.properties=je(je({},this.properties),M),new Promise((function(C,j){g._preloadCache.inputSettings=g._prepInputSettingsForSharing(g._inputSettings,!1),g.sendMessageToCallMachine({action:"daily-method-preauth",properties:ba(g.properties,g.callClientId),preloadCache:ba(g._preloadCache,g.callClientId)},(function(F){return F.error?j(F.error):F.access?(g._didPreAuth=!0,void C({access:F.access})):j(new Error("unknown error in preAuth()"))}))}))})),function(){return ye.apply(this,arguments)})},{key:"load",value:(ae=He((function*(g){var M=this;if(this.needsLoad()){if(this._destroyed&&(this._logUseAfterDestroy(),this.strictMode))throw new Error("Use after destroy");if(g&&(this.validateProperties(g),this.properties=je(je({},this.properties),g)),!this._callObjectMode&&!this.properties.url)throw new Error("can't load iframe meeting because url property isn't set");return this._updateCallState(cv),this.emitDailyJSEvent({action:Zb}),this._callObjectMode?new Promise((function(C,j){M._callObjectLoader.cancel();var F=Date.now();M._callObjectLoader.load(M.properties.dailyConfig,(function(H){M._bundleLoadTime=H?"no-op":Date.now()-F,M._updateCallState(lv),H&&M.emitDailyJSEvent({action:dv}),C()}),(function(H,ie){if(M.emitDailyJSEvent({action:eS}),!ie){M._updateCallState(hs),M.resetMeetingDependentVars();var fe={action:mv,errorMsg:H.msg,error:{type:"connection-error",msg:"Failed to load call object bundle.",details:{on:"load",sourceError:H,bundleUrl:Yl(M.properties.dailyConfig)}}};M._maybeSendToSentry(fe),M.emitDailyJSEvent(fe),j(H.msg)}}))})):(this._iframe.src=Jg(this.assembleMeetingUrl(),this.properties.dailyConfig),new Promise((function(C,j){M._loadedCallback=function(F){M._callState!==hs?(M._updateCallState(lv),(M.properties.cssFile||M.properties.cssText)&&M.loadCss(M.properties),C()):j(F)}})))}})),function(g){return ae.apply(this,arguments)})},{key:"join",value:(G=He((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this._testCallInProgress&&this.stopTestCallQuality();var C=!1;if(this.needsLoad()){this.updateIsPreparingToJoin(!0);try{yield this.load(M)}catch(j){return this.updateIsPreparingToJoin(!1),Promise.reject(j)}}else{if(C=!(!this.properties.cssFile&&!this.properties.cssText),this._didPreAuth){if(M.url&&M.url!==this.properties.url)return console.error("url in join() is different than the one used in preAuth()"),this.updateIsPreparingToJoin(!1),Promise.reject();if(M.token&&M.token!==this.properties.token)return console.error("token in join() is different than the one used in preAuth()"),this.updateIsPreparingToJoin(!1),Promise.reject()}if(M.url&&!this._callObjectMode&&M.url&&M.url!==this.properties.url)return console.error("url in join() is different than the one used in load() (".concat(this.properties.url," -> ").concat(M.url,")")),this.updateIsPreparingToJoin(!1),Promise.reject();this.validateProperties(M),this.properties=je(je({},this.properties),M)}return M.showLocalVideo!==void 0&&(this._callObjectMode?console.error("showLocalVideo is not available in callObject mode"):this._showLocalVideo=!!M.showLocalVideo),M.showParticipantsBar!==void 0&&(this._callObjectMode?console.error("showParticipantsBar is not available in callObject mode"):this._showParticipantsBar=!!M.showParticipantsBar),this._callState===_o||this._callState===Kf?(console.warn("already joined meeting, call leave() before joining again"),void this.updateIsPreparingToJoin(!1)):(this._updateCallState(Kf,!1),this.emitDailyJSEvent({action:rS}),this._preloadCache.inputSettings=this._prepInputSettingsForSharing(this._inputSettings||{},!1),this.sendMessageToCallMachine({action:"join-meeting",properties:ba(this.properties,this.callClientId),preloadCache:ba(this._preloadCache,this.callClientId)}),new Promise((function(j,F){g._joinedCallback=function(H,ie){if(g._callState!==hs){if(g._updateCallState(_o),H)for(var fe in H){if(g._callObjectMode){var Me=g._callMachine().store;Fv(H[fe],Me),Vv(H[fe],Me),zv(H[fe],g._participants[fe],Me)}g._participants[fe]=je({},H[fe]),g.toggleParticipantAudioBasedOnNativeAudioFocus()}C&&g.loadCss(g.properties),j(H)}else F(ie)}})))})),function(){return G.apply(this,arguments)})},{key:"leave",value:($=He((function*(){var g=this;return this._testCallInProgress&&this.stopTestCallQuality(),new Promise((function(M){g._callState===wo||g._callState===hs?M():g._callObjectLoader&&!g._callObjectLoader.loaded?(g._callObjectLoader.cancel(),g._updateCallState(wo),g.resetMeetingDependentVars(),g.emitDailyJSEvent({action:wo}),M()):(g._resolveLeave=M,g.sendMessageToCallMachine({action:"leave-meeting"}))}))})),function(){return $.apply(this,arguments)})},{key:"startScreenShare",value:(P=He((function*(){var g=this,M=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(Tu(this._callMachineInitialized,"startScreenShare()"),M.screenVideoSendSettings&&this._validateVideoSendSettings("screenVideo",M.screenVideoSendSettings),M.mediaStream&&(this._sharedTracks.screenMediaStream=M.mediaStream,M.mediaStream=Fi),typeof DailyNativeUtils<"u"&&DailyNativeUtils.isIOS!==void 0&&DailyNativeUtils.isIOS){var C=this.nativeUtils();if(yield C.isScreenBeingCaptured())return void this.emitDailyJSEvent({action:gv,type:"screen-share-error",errorMsg:"Could not start the screen sharing. The screen is already been captured!"});C.setSystemScreenCaptureStartCallback((function(){C.setSystemScreenCaptureStartCallback(null),g.sendMessageToCallMachine({action:yv,captureOptions:M})})),C.presentSystemScreenCapturePrompt()}else this.sendMessageToCallMachine({action:yv,captureOptions:M})})),function(){return P.apply(this,arguments)})},{key:"stopScreenShare",value:function(){Tu(this._callMachineInitialized,"stopScreenShare()"),this.sendMessageToCallMachine({action:"local-screen-stop"})}},{key:"startRecording",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},M=g.type;if(M&&M!=="cloud"&&M!=="raw-tracks"&&M!=="local")throw new Error("invalid type: ".concat(M,", allowed values 'cloud', 'raw-tracks', or 'local'"));this.sendMessageToCallMachine(je({action:"local-recording-start"},g))}},{key:"updateRecording",value:function(g){var M=g.layout,C=M===void 0?{preset:"default"}:M,j=g.instanceId;this.sendMessageToCallMachine({action:"daily-method-update-recording",layout:C,instanceId:j})}},{key:"stopRecording",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(je({action:"local-recording-stop"},g))}},{key:"startLiveStreaming",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(je({action:"daily-method-start-live-streaming"},g))}},{key:"updateLiveStreaming",value:function(g){var M=g.layout,C=M===void 0?{preset:"default"}:M,j=g.instanceId;this.sendMessageToCallMachine({action:"daily-method-update-live-streaming",layout:C,instanceId:j})}},{key:"addLiveStreamingEndpoints",value:function(g){var M=g.endpoints,C=g.instanceId;this.sendMessageToCallMachine({action:_v,endpointsOp:WS,endpoints:M,instanceId:C})}},{key:"removeLiveStreamingEndpoints",value:function(g){var M=g.endpoints,C=g.instanceId;this.sendMessageToCallMachine({action:_v,endpointsOp:GS,endpoints:M,instanceId:C})}},{key:"stopLiveStreaming",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.sendMessageToCallMachine(je({action:"daily-method-stop-live-streaming"},g))}},{key:"validateDailyConfig",value:function(g){g.camSimulcastEncodings&&(console.warn("camSimulcastEncodings is deprecated. Use sendSettings, found in DailyCallOptions, to provide camera simulcast settings."),this.validateSimulcastEncodings(g.camSimulcastEncodings)),g.screenSimulcastEncodings&&console.warn("screenSimulcastEncodings is deprecated. Use sendSettings, found in DailyCallOptions, to provide screen simulcast settings."),Mv()&&g.noAutoDefaultDeviceChange&&console.warn("noAutoDefaultDeviceChange is not supported on Android, and will be ignored.")}},{key:"validateSimulcastEncodings",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:null,C=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(g){if(!(g instanceof Array||Array.isArray(g)))throw new Error("encodings must be an Array");if(!wy(g.length,1,3))throw new Error("encodings must be an Array with between 1 to ".concat(3," layers"));for(var j=0;j<g.length;j++){var F=g[j];for(var H in this._validateEncodingLayerHasValidProperties(F),F)if(fh.includes(H)){if(typeof F[H]!="number")throw new Error("".concat(H," must be a number"));if(M){var ie=M[H],fe=ie.min,Me=ie.max;if(!wy(F[H],fe,Me))throw new Error("".concat(H," value not in range. valid range: ").concat(fe," to ").concat(Me))}}else if(!["active","scalabilityMode"].includes(H))throw new Error("Invalid key ".concat(H,", valid keys are:")+Object.values(fh));if(C&&!F.hasOwnProperty("maxBitrate"))throw new Error("maxBitrate is not specified")}}}},{key:"startRemoteMediaPlayer",value:(ee=He((function*(g){var M=this,C=g.url,j=g.settings,F=j===void 0?{state:eh.PLAY}:j;try{(function(H){if(typeof H!="string")throw new Error('url parameter must be "string" type')})(C),_y(F),(function(H){for(var ie in H)if(!sy.includes(ie))throw new Error("Invalid key ".concat(ie,", valid keys are: ").concat(sy));H.simulcastEncodings&&this.validateSimulcastEncodings(H.simulcastEncodings,iy,!0)})(F)}catch(H){throw console.error("invalid argument Error: ".concat(H)),console.error(`startRemoteMediaPlayer arguments must be of the form:
  { url: "playback url",
  settings?:
  {state: "play"|"pause", simulcastEncodings?: [{}] } }`),H}return new Promise((function(H,ie){M.sendMessageToCallMachine({action:"daily-method-start-remote-media-player",url:C,settings:F},(function(fe){fe.error?ie({error:fe.error,errorMsg:fe.errorMsg}):H({session_id:fe.session_id,remoteMediaPlayerState:{state:fe.state,settings:fe.settings}})}))}))})),function(g){return ee.apply(this,arguments)})},{key:"stopRemoteMediaPlayer",value:(Q=He((function*(g){var M=this;if(typeof g!="string")throw new Error(" remotePlayerID must be of type string");return new Promise((function(C,j){M.sendMessageToCallMachine({action:"daily-method-stop-remote-media-player",session_id:g},(function(F){F.error?j({error:F.error,errorMsg:F.errorMsg}):C()}))}))})),function(g){return Q.apply(this,arguments)})},{key:"updateRemoteMediaPlayer",value:(q=He((function*(g){var M=this,C=g.session_id,j=g.settings;try{_y(j)}catch(F){throw console.error("invalid argument Error: ".concat(F)),console.error(`updateRemoteMediaPlayer arguments must be of the form:
  session_id: "participant session",
  { settings?: {state: "play"|"pause"} }`),F}return new Promise((function(F,H){M.sendMessageToCallMachine({action:"daily-method-update-remote-media-player",session_id:C,settings:j},(function(ie){ie.error?H({error:ie.error,errorMsg:ie.errorMsg}):F({session_id:ie.session_id,remoteMediaPlayerState:{state:ie.state,settings:ie.settings}})}))}))})),function(g){return q.apply(this,arguments)})},{key:"startTranscription",value:function(g){_t(this._callState,"startTranscription()"),this.sendMessageToCallMachine(je({action:"daily-method-start-transcription"},g))}},{key:"updateTranscription",value:function(g){if(_t(this._callState,"updateTranscription()"),!g)throw new Error("updateTranscription Error: options is mandatory");if(ut(g)!=="object")throw new Error("updateTranscription Error: options must be object type");if(g.participants&&!Array.isArray(g.participants))throw new Error("updateTranscription Error: participants must be an array");this.sendMessageToCallMachine(je({action:"daily-method-update-transcription"},g))}},{key:"stopTranscription",value:function(g){if(_t(this._callState,"stopTranscription()"),g&&ut(g)!=="object")throw new Error("stopTranscription Error: options must be object type");if(g&&!g.instanceId)throw new Error('"instanceId" not provided');this.sendMessageToCallMachine(je({action:"daily-method-stop-transcription"},g))}},{key:"startDialOut",value:(N=He((function*(g){var M=this;_t(this._callState,"startDialOut()");var C=function(ie){if(ie){if(!Array.isArray(ie))throw new Error("Error starting dial out: audio codec must be an array");if(ie.length<=0)throw new Error("Error starting dial out: audio codec array specified but empty");ie.forEach((function(fe){if(typeof fe!="string")throw new Error("Error starting dial out: audio codec must be a string");if(fe!=="OPUS"&&fe!=="PCMU"&&fe!=="PCMA"&&fe!=="G722")throw new Error("Error starting dial out: audio codec must be one of OPUS, PCMU, PCMA, G722")}))}};if(!g.sipUri&&!g.phoneNumber)throw new Error("Error starting dial out: either a sip uri or phone number must be provided");if(g.sipUri&&g.phoneNumber)throw new Error("Error starting dial out: only one of sip uri or phone number must be provided");if(g.sipUri){if(typeof g.sipUri!="string")throw new Error("Error starting dial out: sipUri must be a string");if(!g.sipUri.startsWith("sip:"))throw new Error("Error starting dial out: Invalid SIP URI, must start with 'sip:'");if(g.video&&typeof g.video!="boolean")throw new Error("Error starting dial out: video must be a boolean value");(function(ie){if(ie&&(C(ie.audio),ie.video)){if(!Array.isArray(ie.video))throw new Error("Error starting dial out: video codec must be an array");if(ie.video.length<=0)throw new Error("Error starting dial out: video codec array specified but empty");ie.video.forEach((function(fe){if(typeof fe!="string")throw new Error("Error starting dial out: video codec must be a string");if(fe!=="H264"&&fe!=="VP8")throw new Error("Error starting dial out: video codec must be H264 or VP8")}))}})(g.codecs)}if(g.phoneNumber){if(typeof g.phoneNumber!="string")throw new Error("Error starting dial out: phoneNumber must be a string");if(!/^\+\d{1,}$/.test(g.phoneNumber))throw new Error("Error starting dial out: Invalid phone number, must be valid phone number as per E.164");g.codecs&&C(g.codecs.audio)}if(g.callerId){if(typeof g.callerId!="string")throw new Error("Error starting dial out: callerId must be a string");if(g.sipUri)throw new Error("Error starting dial out: callerId not allowed with sipUri")}if(g.displayName){if(typeof g.displayName!="string")throw new Error("Error starting dial out: displayName must be a string");if(g.displayName.length>=200)throw new Error("Error starting dial out: displayName length must be less than 200")}if(g.userId){if(typeof g.userId!="string")throw new Error("Error starting dial out: userId must be a string");if(g.userId.length>36)throw new Error("Error starting dial out: userId length must be less than or equal to 36")}if(ay(g),g.permissions&&g.permissions.canReceive){var j=mn(Kv.validateJSONObject(g.permissions.canReceive),2),F=j[0],H=j[1];if(!F)throw new Error(H)}return new Promise((function(ie,fe){M.sendMessageToCallMachine(je({action:"dialout-start"},g),(function(Me){Me.error?fe(Me.error):ie(Me)}))}))})),function(g){return N.apply(this,arguments)})},{key:"stopDialOut",value:function(g){var M=this;return _t(this._callState,"stopDialOut()"),new Promise((function(C,j){M.sendMessageToCallMachine(je({action:"dialout-stop"},g),(function(F){F.error?j(F.error):C(F)}))}))}},{key:"sipCallTransfer",value:(R=He((function*(g){var M=this;if(_t(this._callState,"sipCallTransfer()"),!g)throw new Error("sipCallTransfer() requires a sessionId and toEndPoint");return g.useSipRefer=!1,yy(g,"sipCallTransfer"),ay(g),new Promise((function(C,j){M.sendMessageToCallMachine(je({action:bv},g),(function(F){F.error?j(F.error):C(F)}))}))})),function(g){return R.apply(this,arguments)})},{key:"sipRefer",value:(L=He((function*(g){var M=this;if(_t(this._callState,"sipRefer()"),!g)throw new Error("sessionId and toEndPoint are mandatory parameter");return g.useSipRefer=!0,yy(g,"sipRefer"),new Promise((function(C,j){M.sendMessageToCallMachine(je({action:bv},g),(function(F){F.error?j(F.error):C(F)}))}))})),function(g){return L.apply(this,arguments)})},{key:"sendDTMF",value:(x=He((function*(g){var M=this;return _t(this._callState,"sendDTMF()"),(function(C){var j=C.sessionId,F=C.tones;if(!j||!F)throw new Error("sessionId and tones are mandatory parameter");if(typeof j!="string"||typeof F!="string")throw new Error("sessionId and tones should be of string type");if(F.length>20)throw new Error("tones string must be upto 20 characters");var H=/[^0-9A-D*#]/g,ie=F.match(H);if(ie&&ie[0])throw new Error("".concat(ie[0]," is not valid DTMF tone"))})(g),new Promise((function(C,j){M.sendMessageToCallMachine(je({action:"send-dtmf"},g),(function(F){F.error?j(F.error):C(F)}))}))})),function(g){return x.apply(this,arguments)})},{key:"getNetworkStats",value:function(){var g=this;return this._callState!==_o?Promise.resolve(je({stats:{latest:{}}},this._network)):new Promise((function(M){g.sendMessageToCallMachine({action:"get-calc-stats"},(function(C){M(je(je({},g._network),{},{stats:C.stats}))}))}))}},{key:"testWebsocketConnectivity",value:(D=He((function*(){var g=this;if(gh(this._testCallInProgress,"testWebsocketConnectivity()"),this.needsLoad())try{yield this.load()}catch(M){return Promise.reject(M)}return new Promise((function(M,C){g.sendMessageToCallMachine({action:"test-websocket-connectivity"},(function(j){j.error?C(j.error):M(j.results)}))}))})),function(){return D.apply(this,arguments)})},{key:"abortTestWebsocketConnectivity",value:function(){this.sendMessageToCallMachine({action:"abort-test-websocket-connectivity"})}},{key:"_validateVideoTrackForNetworkTests",value:function(g){return g?g instanceof MediaStreamTrack?!!pk(g)||(console.error("Video track is not playable. This test needs a live video track."),!1):(console.error("Video track needs to be of type `MediaStreamTrack`."),!1):(console.error("Missing video track. You must provide a video track in order to run this test."),!1)}},{key:"testCallQuality",value:(O=He((function*(){var g=this;at(),zr(this._callObjectMode,"testCallQuality()"),Tu(this._callMachineInitialized,"testCallQuality()",null,!0),ph(this._callState,this._isPreparingToJoin,"testCallQuality()");var M=this._testCallAlreadyInProgress,C=function(F){M||(g._testCallInProgress=F)};if(C(!0),this.needsLoad())try{var j=this._callState;yield this.load(),this._callState=j}catch(F){return C(!1),Promise.reject(F)}return new Promise((function(F){g.sendMessageToCallMachine({action:"test-call-quality",dailyJsVersion:g.properties.dailyJsVersion},(function(H){var ie=H.results,fe=ie.result,Me=Ug(ie,vk);if(fe==="failed"){var qe,Xe=je({},Me);(qe=Me.error)!==null&&qe!==void 0&&qe.details?(Me.error.details=JSON.parse(Me.error.details),Xe.error=je(je({},Xe.error),{},{details:je({},Xe.error.details)}),Xe.error.details.duringTest="testCallQuality"):(Xe.error=Xe.error?je({},Xe.error):{},Xe.error.details={duringTest:"testCallQuality"}),g._maybeSendToSentry(Xe)}C(!1),F(je({result:fe},Me))}))}))})),function(){return O.apply(this,arguments)})},{key:"stopTestCallQuality",value:function(){this.sendMessageToCallMachine({action:"stop-test-call-quality"})}},{key:"testConnectionQuality",value:(E=He((function*(g){var M;ot()?(console.warn("testConnectionQuality() is deprecated: use testPeerToPeerCallQuality() instead"),M=yield this.testPeerToPeerCallQuality(g)):(console.warn("testConnectionQuality() is deprecated: use testCallQuality() instead"),M=yield this.testCallQuality());var C={result:M.result,secondsElapsed:M.secondsElapsed};return M.data&&(C.data={maxRTT:M.data.maxRoundTripTime,packetLoss:M.data.avgRecvPacketLoss}),C})),function(g){return E.apply(this,arguments)})},{key:"testPeerToPeerCallQuality",value:(k=He((function*(g){var M=this;if(gh(this._testCallInProgress,"testPeerToPeerCallQuality()"),this.needsLoad())try{yield this.load()}catch(F){return Promise.reject(F)}var C=g.videoTrack,j=g.duration;if(!this._validateVideoTrackForNetworkTests(C))throw new Error("Video track error");return this._sharedTracks.videoTrackForConnectionQualityTest=C,new Promise((function(F,H){M.sendMessageToCallMachine({action:"test-p2p-call-quality",duration:j},(function(ie){ie.error?H(ie.error):F(ie.results)}))}))})),function(g){return k.apply(this,arguments)})},{key:"stopTestConnectionQuality",value:function(){ot()?(console.warn("stopTestConnectionQuality() is deprecated: use testPeerToPeerCallQuality() and stopTestPeerToPeerCallQuality() instead"),this.stopTestPeerToPeerCallQuality()):(console.warn("stopTestConnectionQuality() is deprecated: use testCallQuality() and stopTestCallQuality() instead"),this.stopTestCallQuality())}},{key:"stopTestPeerToPeerCallQuality",value:function(){this.sendMessageToCallMachine({action:"stop-test-p2p-call-quality"})}},{key:"testNetworkConnectivity",value:(y=He((function*(g){var M=this;if(gh(this._testCallInProgress,"testNetworkConnectivity()"),this.needsLoad())try{yield this.load()}catch(C){return Promise.reject(C)}if(!this._validateVideoTrackForNetworkTests(g))throw new Error("Video track error");return this._sharedTracks.videoTrackForNetworkConnectivityTest=g,new Promise((function(C,j){M.sendMessageToCallMachine({action:"test-network-connectivity"},(function(F){F.error?j(F.error):C(F.results)}))}))})),function(g){return y.apply(this,arguments)})},{key:"abortTestNetworkConnectivity",value:function(){this.sendMessageToCallMachine({action:"abort-test-network-connectivity"})}},{key:"getCpuLoadStats",value:function(){var g=this;return new Promise((function(M){g._callState===_o?g.sendMessageToCallMachine({action:"get-cpu-load-stats"},(function(C){M(C.cpuStats)})):M({cpuLoadState:void 0,cpuLoadStateReason:void 0,stats:{}})}))}},{key:"_validateEncodingLayerHasValidProperties",value:function(g){var M;if(!(((M=Object.keys(g))===null||M===void 0?void 0:M.length)>0))throw new Error("Empty encoding is not allowed. At least one of these valid keys should be specified:"+Object.values(fh))}},{key:"_validateVideoSendSettings",value:function(g,M){var C=g==="screenVideo"?["default-screen-video","detail-optimized","motion-optimized","motion-and-detail-balanced"]:["default-video","bandwidth-optimized","bandwidth-and-quality-balanced","quality-optimized","adaptive-2-layers","adaptive-3-layers"],j="Video send settings should be either an object or one of the supported presets: ".concat(C.join());if(typeof M=="string"){if(!C.includes(M))throw new Error(j)}else{if(ut(M)!=="object")throw new Error(j);if(!M.maxQuality&&!M.encodings&&M.allowAdaptiveLayers===void 0)throw new Error("Video send settings must contain at least maxQuality, allowAdaptiveLayers or encodings attribute");if(M.maxQuality&&["low","medium","high"].indexOf(M.maxQuality)===-1)throw new Error("maxQuality must be either low, medium or high");if(M.encodings){var F=!1;switch(Object.keys(M.encodings).length){case 1:F=!M.encodings.low;break;case 2:F=!M.encodings.low||!M.encodings.medium;break;case 3:F=!M.encodings.low||!M.encodings.medium||!M.encodings.high;break;default:F=!0}if(F)throw new Error("Encodings must be defined as: low, low and medium, or low, medium and high.");M.encodings.low&&this._validateEncodingLayerHasValidProperties(M.encodings.low),M.encodings.medium&&this._validateEncodingLayerHasValidProperties(M.encodings.medium),M.encodings.high&&this._validateEncodingLayerHasValidProperties(M.encodings.high)}}}},{key:"validateUpdateSendSettings",value:function(g){var M=this;if(!g||Object.keys(g).length===0)throw new Error("Send settings must contain at least information for one track!");Object.entries(g).forEach((function(C){var j=mn(C,2),F=j[0],H=j[1];M._validateVideoSendSettings(F,H)}))}},{key:"updateSendSettings",value:function(g){var M=this;return this.validateUpdateSendSettings(g),this.needsLoad()?(this._preloadCache.sendSettings=g,{sendSettings:this._preloadCache.sendSettings}):new Promise((function(C,j){M.sendMessageToCallMachine({action:"update-send-settings",sendSettings:g},(function(F){F.error?j(F.error):C(F.sendSettings)}))}))}},{key:"getSendSettings",value:function(){return this._sendSettings||this._preloadCache.sendSettings}},{key:"getLocalAudioLevel",value:function(){return this._localAudioLevel}},{key:"getRemoteParticipantsAudioLevel",value:function(){return this._remoteParticipantsAudioLevel}},{key:"getActiveSpeaker",value:function(){return at(),this._activeSpeaker}},{key:"setActiveSpeakerMode",value:function(g){return at(),this.sendMessageToCallMachine({action:"set-active-speaker-mode",enabled:g}),this}},{key:"activeSpeakerMode",value:function(){return at(),this._activeSpeakerMode}},{key:"subscribeToTracksAutomatically",value:function(){return this._preloadCache.subscribeToTracksAutomatically}},{key:"setSubscribeToTracksAutomatically",value:function(g){return _t(this._callState,"setSubscribeToTracksAutomatically()","Use the subscribeToTracksAutomatically configuration property."),this._preloadCache.subscribeToTracksAutomatically=g,this.sendMessageToCallMachine({action:"daily-method-subscribe-to-tracks-automatically",enabled:g}),this}},{key:"enumerateDevices",value:(v=He((function*(){var g=this;if(this._callObjectMode){var M=yield navigator.mediaDevices.enumerateDevices();return bo()==="Firefox"&&bu().major>115&&bu().major<123&&(M=M.filter((function(C){return C.kind!=="audiooutput"}))),{devices:M.map((function(C){var j=JSON.parse(JSON.stringify(C));if(!ot()&&C.kind==="videoinput"&&C.getCapabilities){var F,H=C.getCapabilities();j.facing=(H==null||(F=H.facingMode)===null||F===void 0?void 0:F.length)>=1?H.facingMode[0]:void 0}return j}))}}return new Promise((function(C){g.sendMessageToCallMachine({action:"enumerate-devices"},(function(j){C({devices:j.devices})}))}))})),function(){return v.apply(this,arguments)})},{key:"sendAppMessage",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"*";if(_t(this._callState,"sendAppMessage()"),JSON.stringify(g).length>this._maxAppMessageSize)throw new Error("Message data too large. Max size is "+this._maxAppMessageSize);return this.sendMessageToCallMachine({action:"app-msg",data:g,to:M}),this}},{key:"addFakeParticipant",value:function(g){return at(),_t(this._callState,"addFakeParticipant()"),this.sendMessageToCallMachine(je({action:"add-fake-participant"},g)),this}},{key:"setShowNamesMode",value:function(g){return ur(this._callObjectMode,"setShowNamesMode()"),at(),g&&g!=="always"&&g!=="never"?(console.error('setShowNamesMode argument should be "always", "never", or false'),this):(this.sendMessageToCallMachine({action:"set-show-names",mode:g}),this)}},{key:"setShowLocalVideo",value:function(){var g=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return ur(this._callObjectMode,"setShowLocalVideo()"),at(),_t(this._callState,"setShowLocalVideo()"),typeof g!="boolean"?(console.error("setShowLocalVideo only accepts a boolean value"),this):(this.sendMessageToCallMachine({action:"set-show-local-video",show:g}),this._showLocalVideo=g,this)}},{key:"showLocalVideo",value:function(){return ur(this._callObjectMode,"showLocalVideo()"),at(),this._showLocalVideo}},{key:"setShowParticipantsBar",value:function(){var g=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];return ur(this._callObjectMode,"setShowParticipantsBar()"),at(),_t(this._callState,"setShowParticipantsBar()"),typeof g!="boolean"?(console.error("setShowParticipantsBar only accepts a boolean value"),this):(this.sendMessageToCallMachine({action:"set-show-participants-bar",show:g}),this._showParticipantsBar=g,this)}},{key:"showParticipantsBar",value:function(){return ur(this._callObjectMode,"showParticipantsBar()"),at(),this._showParticipantsBar}},{key:"customIntegrations",value:function(){return at(),ur(this._callObjectMode,"customIntegrations()"),this._customIntegrations}},{key:"setCustomIntegrations",value:function(g){return at(),ur(this._callObjectMode,"setCustomIntegrations()"),_t(this._callState,"setCustomIntegrations()"),my(g)?(this.sendMessageToCallMachine({action:"set-custom-integrations",integrations:g}),this._customIntegrations=g,this):this}},{key:"startCustomIntegrations",value:function(g){var M=this;if(at(),ur(this._callObjectMode,"startCustomIntegrations()"),_t(this._callState,"startCustomIntegrations()"),Array.isArray(g)&&g.some((function(F){return typeof F!="string"}))||!Array.isArray(g)&&typeof g!="string")return console.error("startCustomIntegrations() only accepts string | string[]"),this;var C=typeof g=="string"?[g]:g,j=C.filter((function(F){return!(F in M._customIntegrations)}));return j.length?(console.error(`Can't find custom integration(s): "`.concat(j.join(", "),'"')),this):(this.sendMessageToCallMachine({action:"start-custom-integrations",ids:C}),this)}},{key:"stopCustomIntegrations",value:function(g){var M=this;if(at(),ur(this._callObjectMode,"stopCustomIntegrations()"),_t(this._callState,"stopCustomIntegrations()"),Array.isArray(g)&&g.some((function(F){return typeof F!="string"}))||!Array.isArray(g)&&typeof g!="string")return console.error("stopCustomIntegrations() only accepts string | string[]"),this;var C=typeof g=="string"?[g]:g,j=C.filter((function(F){return!(F in M._customIntegrations)}));return j.length?(console.error(`Can't find custom integration(s): "`.concat(j.join(", "),'"')),this):(this.sendMessageToCallMachine({action:"stop-custom-integrations",ids:C}),this)}},{key:"customTrayButtons",value:function(){return ur(this._callObjectMode,"customTrayButtons()"),at(),this._customTrayButtons}},{key:"updateCustomTrayButtons",value:function(g){return ur(this._callObjectMode,"updateCustomTrayButtons()"),at(),_t(this._callState,"updateCustomTrayButtons()"),gy(g)?(this.sendMessageToCallMachine({action:"update-custom-tray-buttons",btns:g}),this._customTrayButtons=g,this):(console.error("updateCustomTrayButtons only accepts a dictionary of the type ".concat(JSON.stringify(Cu))),this)}},{key:"theme",value:function(){return ur(this._callObjectMode,"theme()"),this.properties.theme}},{key:"setTheme",value:function(g){var M=this;return ur(this._callObjectMode,"setTheme()"),new Promise((function(C,j){try{M.validateProperties({theme:g}),M.properties.theme=je({},g),M.sendMessageToCallMachine({action:"set-theme",theme:M.properties.theme});try{M.emitDailyJSEvent({action:Xb,theme:M.properties.theme})}catch(F){console.log("could not emit 'theme-updated'",F)}C(M.properties.theme)}catch(F){j(F)}}))}},{key:"requestFullscreen",value:(h=He((function*(){if(at(),this._iframe&&!document.fullscreenElement&&kv())try{(yield this._iframe.requestFullscreen)?this._iframe.requestFullscreen():this._iframe.webkitRequestFullscreen()}catch(g){console.log("could not make video call fullscreen",g)}})),function(){return h.apply(this,arguments)})},{key:"exitFullscreen",value:function(){at(),document.fullscreenElement?document.exitFullscreen():document.webkitFullscreenElement&&document.webkitExitFullscreen()}},{key:"getSidebarView",value:(f=He((function*(){var g=this;return this._callObjectMode?(console.error("getSidebarView is not available in callObject mode"),Promise.resolve(null)):new Promise((function(M){g.sendMessageToCallMachine({action:"get-sidebar-view"},(function(C){M(C.view)}))}))})),function(){return f.apply(this,arguments)})},{key:"setSidebarView",value:function(g){return this._callObjectMode?(console.error("setSidebarView is not available in callObject mode"),this):(this.sendMessageToCallMachine({action:"set-sidebar-view",view:g}),this)}},{key:"room",value:(l=He((function*(){var g=this,M=(arguments.length>0&&arguments[0]!==void 0?arguments[0]:{}).includeRoomConfigDefaults,C=M===void 0||M;return this._accessState.access===Yf||this.needsLoad()?this.properties.url?{roomUrlPendingJoin:this.properties.url}:null:new Promise((function(j){g.sendMessageToCallMachine({action:"lib-room-info",includeRoomConfigDefaults:C},(function(F){delete F.action,delete F.callbackStamp,j(F)}))}))})),function(){return l.apply(this,arguments)})},{key:"geo",value:(a=He((function*(){try{var g=yield fetch("https://gs.daily.co/_ks_/x-swsl/:");return{current:(yield g.json()).geo}}catch(M){return console.error("geo lookup failed",M),{current:""}}})),function(){return a.apply(this,arguments)})},{key:"setNetworkTopology",value:(r=He((function*(g){var M=this;return at(),_t(this._callState,"setNetworkTopology()"),new Promise((function(C,j){M.sendMessageToCallMachine({action:"set-network-topology",opts:g},(function(F){F.error?j({error:F.error}):C({workerId:F.workerId})}))}))})),function(g){return r.apply(this,arguments)})},{key:"getNetworkTopology",value:(e=He((function*(){var g=this;return new Promise((function(M,C){g.needsLoad()&&M({topology:"none"}),g.sendMessageToCallMachine({action:"get-network-topology"},(function(j){j.error?C({error:j.error}):M({topology:j.topology})}))}))})),function(){return e.apply(this,arguments)})},{key:"setPlayNewParticipantSound",value:function(g){if(at(),typeof g!="number"&&g!==!0&&g!==!1)throw new Error("argument to setShouldPlayNewParticipantSound should be true, false, or a number, but is ".concat(g));this.sendMessageToCallMachine({action:"daily-method-set-play-ding",arg:g})}},{key:"on",value:function(g,M){return Ql.prototype.on.call(this,g,M)}},{key:"once",value:function(g,M){return Ql.prototype.once.call(this,g,M)}},{key:"off",value:function(g,M){return Ql.prototype.off.call(this,g,M)}},{key:"validateProperties",value:function(g){var M,C;if(g!=null&&(M=g.dailyConfig)!==null&&M!==void 0&&M.userMediaAudioConstraints){var j,F;ot()||console.warn("userMediaAudioConstraints is deprecated. You can override constraints with inputSettings.audio.settings, found in DailyCallOptions.");var H=g.inputSettings||{};H.audio=((j=g.inputSettings)===null||j===void 0?void 0:j.audio)||{},H.audio.settings=((F=g.inputSettings)===null||F===void 0||(F=F.audio)===null||F===void 0?void 0:F.settings)||{},H.audio.settings=je(je({},H.audio.settings),g.dailyConfig.userMediaAudioConstraints),g.inputSettings=H,delete g.dailyConfig.userMediaAudioConstraints}if(g!=null&&(C=g.dailyConfig)!==null&&C!==void 0&&C.userMediaVideoConstraints){var ie,fe;ot()||console.warn("userMediaVideoConstraints is deprecated. You can override constraints with inputSettings.video.settings, found in DailyCallOptions.");var Me=g.inputSettings||{};Me.video=((ie=g.inputSettings)===null||ie===void 0?void 0:ie.video)||{},Me.video.settings=((fe=g.inputSettings)===null||fe===void 0||(fe=fe.video)===null||fe===void 0?void 0:fe.settings)||{},Me.video.settings=je(je({},Me.video.settings),g.dailyConfig.userMediaVideoConstraints),g.inputSettings=Me,delete g.dailyConfig.userMediaVideoConstraints}for(var qe in g)if(ko[qe]){if(ko[qe].validate&&!ko[qe].validate(g[qe],this))throw new Error("property '".concat(qe,"': ").concat(ko[qe].help))}else console.warn("Ignoring unrecognized property '".concat(qe,"'")),delete g[qe]}},{key:"assembleMeetingUrl",value:function(){var g,M,C=je(je({},this.properties),{},{emb:this.callClientId,embHref:encodeURIComponent(window.location.href),proxy:(g=this.properties.dailyConfig)!==null&&g!==void 0&&g.proxyUrl?encodeURIComponent((M=this.properties.dailyConfig)===null||M===void 0?void 0:M.proxyUrl):void 0}),j=C.url.match(/\?/)?"&":"?";return C.url+j+Object.keys(ko).filter((function(F){return ko[F].queryString&&C[F]!==void 0})).map((function(F){return"".concat(ko[F].queryString,"=").concat(C[F])})).join("&")}},{key:"needsLoad",value:function(){return[av,cv,wo,hs].includes(this._callState)}},{key:"sendMessageToCallMachine",value:function(g,M){if(this._destroyed&&(this._logUseAfterDestroy(),this.strictMode))throw new Error("Use after destroy");this._messageChannel.sendMessageToCallMachine(g,M,this.callClientId,this._iframe)}},{key:"forwardPackagedMessageToCallMachine",value:function(g){this._messageChannel.forwardPackagedMessageToCallMachine(g,this._iframe,this.callClientId)}},{key:"addListenerForPackagedMessagesFromCallMachine",value:function(g){return this._messageChannel.addListenerForPackagedMessagesFromCallMachine(g,this.callClientId)}},{key:"removeListenerForPackagedMessagesFromCallMachine",value:function(g){this._messageChannel.removeListenerForPackagedMessagesFromCallMachine(g)}},{key:"handleMessageFromCallMachine",value:function(g){switch(g.action){case Kb:this.sendMessageToCallMachine(je({action:Yb},this.properties));break;case"call-machine-initialized":this._callMachineInitialized=!0;var M={action:_u,level:"log",code:1011,stats:{event:"bundle load",time:this._bundleLoadTime==="no-op"?0:this._bundleLoadTime,preLoaded:this._bundleLoadTime==="no-op",url:Yl(this.properties.dailyConfig)}};this.sendMessageToCallMachine(M),this._delayDuplicateInstanceLog&&this._logDuplicateInstanceAttempt();break;case dv:this._loadedCallback&&(this._loadedCallback(),this._loadedCallback=null),this.emitDailyJSEvent(g);break;case iS:var C,j=je({},g);delete j.internal,this._maxAppMessageSize=((C=g.internal)===null||C===void 0?void 0:C._maxAppMessageSize)||Xf,this._joinedCallback&&(this._joinedCallback(g.participants),this._joinedCallback=null),this.emitDailyJSEvent(j);break;case oS:case aS:if(this._callState===wo)return;if(g.participant&&g.participant.session_id){var F=g.participant.local?"local":g.participant.session_id;if(this._callObjectMode){var H=this._callMachine().store;Fv(g.participant,H),Vv(g.participant,H),zv(g.participant,this._participants[F],H)}try{this.maybeParticipantTracksStopped(this._participants[F],g.participant),this.maybeParticipantTracksStarted(this._participants[F],g.participant),this.maybeEventRecordingStopped(this._participants[F],g.participant),this.maybeEventRecordingStarted(this._participants[F],g.participant)}catch(qi){console.error("track events error",qi)}this.compareEqualForParticipantUpdateEvent(g.participant,this._participants[F])||(this._participants[F]=je({},g.participant),this.toggleParticipantAudioBasedOnNativeAudioFocus(),this.emitDailyJSEvent(g))}break;case cS:if(g.participant&&g.participant.session_id){var ie=this._participants[g.participant.session_id];ie&&this.maybeParticipantTracksStopped(ie,null),delete this._participants[g.participant.session_id],this.emitDailyJSEvent(g)}break;case lS:An(this._participantCounts,g.participantCounts)||(this._participantCounts=g.participantCounts,this.emitDailyJSEvent(g));break;case uS:var fe={access:g.access};g.awaitingAccess&&(fe.awaitingAccess=g.awaitingAccess),An(this._accessState,fe)||(this._accessState=fe,this.emitDailyJSEvent(g));break;case dS:if(g.meetingSession){this._meetingSessionSummary=g.meetingSession,this.emitDailyJSEvent(g);var Me=je(je({},g),{},{action:"meeting-session-updated"});this.emitDailyJSEvent(Me)}break;case mv:var qe;this._iframe&&!g.preserveIframe&&(this._iframe.src=""),this._updateCallState(hs),this.resetMeetingDependentVars(),this._loadedCallback&&(this._loadedCallback(g.errorMsg),this._loadedCallback=null),g.preserveIframe;var Xe=Ug(g,yk);Xe!=null&&(qe=Xe.error)!==null&&qe!==void 0&&qe.details&&(Xe.error.details=JSON.parse(Xe.error.details)),this._maybeSendToSentry(g),this._joinedCallback&&(this._joinedCallback(null,Xe),this._joinedCallback=null),this.emitDailyJSEvent(Xe);break;case sS:this._callState!==hs&&this._updateCallState(wo),this.resetMeetingDependentVars(),this._resolveLeave&&(this._resolveLeave(),this._resolveLeave=null),this.emitDailyJSEvent(g);break;case"selected-devices-updated":g.devices&&this.emitDailyJSEvent(g);break;case jS:var Vt=g.state,wn=g.threshold,xn=g.quality,mt=Vt.state,At=Vt.reasons;mt===this._network.networkState&&An(At,this._network.networkStateReasons)&&wn===this._network.threshold&&xn===this._network.quality||(this._network.networkState=mt,this._network.networkStateReasons=At,this._network.quality=xn,this._network.threshold=wn,g.networkState=mt,At.length&&(g.networkStateReasons=At),delete g.state,this.emitDailyJSEvent(g));break;case DS:g&&g.cpuLoadState&&this.emitDailyJSEvent(g);break;case US:g&&g.faceCounts!==void 0&&this.emitDailyJSEvent(g);break;case xS:var en=g.activeSpeaker;this._activeSpeaker.peerId!==en.peerId&&(this._activeSpeaker.peerId=en.peerId,this.emitDailyJSEvent({action:g.action,activeSpeaker:this._activeSpeaker}));break;case"show-local-video-changed":if(this._callObjectMode)return;var zt=g.show;this._showLocalVideo=zt,this.emitDailyJSEvent({action:g.action,show:zt});break;case LS:var Ze=g.enabled;this._activeSpeakerMode!==Ze&&(this._activeSpeakerMode=Ze,this.emitDailyJSEvent({action:g.action,enabled:this._activeSpeakerMode}));break;case hS:case pS:case gS:this._waitingParticipants=g.allWaitingParticipants,this.emitDailyJSEvent({action:g.action,participant:g.participant});break;case $S:An(this._receiveSettings,g.receiveSettings)||(this._receiveSettings=g.receiveSettings,this.emitDailyJSEvent({action:g.action,receiveSettings:g.receiveSettings}));break;case pv:this._maybeUpdateInputSettings(g.inputSettings);break;case"send-settings-updated":An(this._sendSettings,g.sendSettings)||(this._sendSettings=g.sendSettings,this._preloadCache.sendSettings=null,this.emitDailyJSEvent({action:g.action,sendSettings:g.sendSettings}));break;case"local-audio-level":this._localAudioLevel=g.audioLevel,this._preloadCache.localAudioLevelObserver=null,this.emitDailyJSEvent(g);break;case"remote-participants-audio-level":this._remoteParticipantsAudioLevel=g.participantsAudioLevel,this._preloadCache.remoteParticipantsAudioLevelObserver=null,this.emitDailyJSEvent(g);break;case OS:var Ln=g.session_id;this._rmpPlayerState[Ln]=g.playerState,this.emitDailyJSEvent(g);break;case RS:delete this._rmpPlayerState[g.session_id],this.emitDailyJSEvent(g);break;case TS:var Jn=g.session_id,Jt=this._rmpPlayerState[Jn];Jt&&this.compareEqualForRMPUpdateEvent(Jt,g.remoteMediaPlayerState)||(this._rmpPlayerState[Jn]=g.remoteMediaPlayerState,this.emitDailyJSEvent(g));break;case"custom-button-click":case"sidebar-view-changed":case"pip-started":case"pip-stopped":this.emitDailyJSEvent(g);break;case fS:var Mr=this._meetingSessionState.topology!==(g.meetingSessionState&&g.meetingSessionState.topology);this._meetingSessionState=vh(g.meetingSessionState,this._callObjectMode),(this._callObjectMode||Mr)&&this.emitDailyJSEvent(g);break;case AS:this._isScreenSharing=!0,this.emitDailyJSEvent(g);break;case PS:case IS:this._isScreenSharing=!1,this.emitDailyJSEvent(g);break;case fv:case hv:case bS:case SS:case kS:case yS:case _S:case wS:case tS:case nS:case ES:case MS:case"test-completed":case NS:case CS:case BS:case FS:case VS:case zS:case gv:case qS:case"dialin-ready":case"dialin-connected":case"dialin-error":case"dialin-stopped":case"dialin-warning":case"dialout-connected":case"dialout-answered":case"dialout-error":case"dialout-stopped":case"dialout-warning":this.emitDailyJSEvent(g);break;case"request-fullscreen":this.requestFullscreen();break;case"request-exit-fullscreen":this.exitFullscreen()}}},{key:"maybeEventRecordingStopped",value:function(g,M){var C="record";g&&(M.local||M[C]!==!1||g[C]===M[C]||this.emitDailyJSEvent({action:hv}))}},{key:"maybeEventRecordingStarted",value:function(g,M){var C="record";g&&(M.local||M[C]!==!0||g[C]===M[C]||this.emitDailyJSEvent({action:fv}))}},{key:"_trackStatePlayable",value:function(g){return!(!g||g.state!==Wb)}},{key:"_trackChanged",value:function(g,M){return g?.id!==M?.id}},{key:"maybeEventTrackStopped",value:function(g,M,C){var j,F,H=(j=M?.tracks[g])!==null&&j!==void 0?j:null,ie=(F=C?.tracks[g])!==null&&F!==void 0?F:null,fe=H?.track;if(fe){var Me=this._trackStatePlayable(H),qe=this._trackStatePlayable(ie),Xe=this._trackChanged(fe,ie?.track);Me&&(qe&&!Xe||this.emitDailyJSEvent({action:vS,track:fe,participant:C??M,type:g}))}}},{key:"maybeEventTrackStarted",value:function(g,M,C){var j,F,H=(j=M?.tracks[g])!==null&&j!==void 0?j:null,ie=(F=C?.tracks[g])!==null&&F!==void 0?F:null,fe=ie?.track;if(fe){var Me=this._trackStatePlayable(H),qe=this._trackStatePlayable(ie),Xe=this._trackChanged(H?.track,fe);qe&&(Me&&!Xe||this.emitDailyJSEvent({action:mS,track:fe,participant:C,type:g}))}}},{key:"maybeParticipantTracksStopped",value:function(g,M){if(g)for(var C in g.tracks)this.maybeEventTrackStopped(C,g,M)}},{key:"maybeParticipantTracksStarted",value:function(g,M){if(M)for(var C in M.tracks)this.maybeEventTrackStarted(C,g,M)}},{key:"compareEqualForRMPUpdateEvent",value:function(g,M){var C,j;return g.state===M.state&&((C=g.settings)===null||C===void 0?void 0:C.volume)===((j=M.settings)===null||j===void 0?void 0:j.volume)}},{key:"emitDailyJSEvent",value:function(g){try{g.callClientId=this.callClientId,this.emit(g.action,g)}catch(M){console.log("could not emit",g,M)}}},{key:"compareEqualForParticipantUpdateEvent",value:function(g,M){return!!An(g,M)&&(!g.videoTrack||!M.videoTrack||g.videoTrack.id===M.videoTrack.id&&g.videoTrack.muted===M.videoTrack.muted&&g.videoTrack.enabled===M.videoTrack.enabled)&&(!g.audioTrack||!M.audioTrack||g.audioTrack.id===M.audioTrack.id&&g.audioTrack.muted===M.audioTrack.muted&&g.audioTrack.enabled===M.audioTrack.enabled)}},{key:"nativeUtils",value:function(){return ot()?typeof DailyNativeUtils>"u"?(console.warn("in React Native, DailyNativeUtils is expected to be available"),null):DailyNativeUtils:null}},{key:"updateIsPreparingToJoin",value:function(g){this._updateCallState(this._callState,g)}},{key:"_updateCallState",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this._isPreparingToJoin;if(g!==this._callState||M!==this._isPreparingToJoin){var C=this._callState,j=this._isPreparingToJoin;this._callState=g,this._isPreparingToJoin=M;var F=this._callState===_o;this.updateShowAndroidOngoingMeetingNotification(F);var H=Ou(C,j),ie=Ou(this._callState,this._isPreparingToJoin);H!==ie&&(this.updateKeepDeviceAwake(ie),this.updateDeviceAudioMode(ie),this.updateNoOpRecordingEnsuringBackgroundContinuity(ie))}}},{key:"resetMeetingDependentVars",value:function(){this._participants={},this._participantCounts=ry,this._waitingParticipants={},this._activeSpeaker={},this._activeSpeakerMode=!1,this._didPreAuth=!1,this._accessState={access:Yf},this._finalSummaryOfPrevSession=this._meetingSessionSummary,this._meetingSessionSummary={},this._meetingSessionState=vh(ny,this._callObjectMode),this._isScreenSharing=!1,this._receiveSettings={},this._inputSettings=void 0,this._sendSettings={},this._localAudioLevel=0,this._isLocalAudioLevelObserverRunning=!1,this._remoteParticipantsAudioLevel={},this._isRemoteParticipantsAudioLevelObserverRunning=!1,this._maxAppMessageSize=Xf,this._callMachineInitialized=!1,this._bundleLoadTime=void 0,this._preloadCache}},{key:"updateKeepDeviceAwake",value:function(g){ot()&&this.nativeUtils().setKeepDeviceAwake(g,this.callClientId)}},{key:"updateDeviceAudioMode",value:function(g){if(ot()&&!this.disableReactNativeAutoDeviceManagement("audio")){var M=g?this._nativeInCallAudioMode:"idle";this.nativeUtils().setAudioMode(M)}}},{key:"updateShowAndroidOngoingMeetingNotification",value:function(g){if(ot()&&this.nativeUtils().setShowOngoingMeetingNotification){var M,C,j,F;if(this.properties.reactNativeConfig&&this.properties.reactNativeConfig.androidInCallNotification){var H=this.properties.reactNativeConfig.androidInCallNotification;M=H.title,C=H.subtitle,j=H.iconName,F=H.disableForCustomOverride}F&&(g=!1),this.nativeUtils().setShowOngoingMeetingNotification(g,M,C,j,this.callClientId)}}},{key:"updateNoOpRecordingEnsuringBackgroundContinuity",value:function(g){ot()&&this.nativeUtils().enableNoOpRecordingEnsuringBackgroundContinuity&&this.nativeUtils().enableNoOpRecordingEnsuringBackgroundContinuity(g)}},{key:"toggleParticipantAudioBasedOnNativeAudioFocus",value:function(){var g;if(ot()){var M=(g=this._callMachine())===null||g===void 0||(g=g.store)===null||g===void 0?void 0:g.getState();for(var C in M?.streams){var j=M.streams[C];j&&j.pendingTrack&&j.pendingTrack.kind==="audio"&&(j.pendingTrack.enabled=this._hasNativeAudioFocus)}}}},{key:"disableReactNativeAutoDeviceManagement",value:function(g){return this.properties.reactNativeConfig&&this.properties.reactNativeConfig.disableAutoDeviceManagement&&this.properties.reactNativeConfig.disableAutoDeviceManagement[g]}},{key:"absoluteUrl",value:function(g){if(g!==void 0){var M=document.createElement("a");return M.href=g,M.href}}},{key:"sayHello",value:function(){var g="hello, world.";return console.log(g),g}},{key:"_logUseAfterDestroy",value:function(){var g=Object.values(So)[0];if(this.needsLoad())if(g&&!g.needsLoad()){var M={action:_u,level:"error",code:this.strictMode?9995:9997};g.sendMessageToCallMachine(M)}else this.strictMode||console.error("You are are attempting to use a call instance that was previously destroyed, which is unsupported. Please remove `strictMode: false` from your constructor properties to enable strict mode to track down and fix this unsupported usage.");else{var C={action:_u,level:"error",code:this.strictMode?9995:9997};this._messageChannel.sendMessageToCallMachine(C,null,this.callClientId,this._iframe)}}},{key:"_logDuplicateInstanceAttempt",value:function(){for(var g=0,M=Object.values(So);g<M.length;g++){var C=M[g];C._callMachineInitialized?(C.sendMessageToCallMachine({action:_u,level:"warn",code:this.allowMultipleCallInstances?9993:9992}),C._delayDuplicateInstanceLog=!1):C._delayDuplicateInstanceLog=!0}}},{key:"_maybeSendToSentry",value:function(g){var M,C,j,F;if(!((M=g.error)!==null&&M!==void 0&&M.type&&(![Qb,Jb,uv].includes(g.error.type)||g.error.type===uv&&g.error.msg.includes("deleted")))){var H=(C=this.properties)!==null&&C!==void 0&&C.url?new URL(this.properties.url):void 0,ie="production";H&&H.host.includes(".staging.daily")&&(ie="staging");var fe,Me,qe,Xe,Vt,wn=(function(Ln){const Jn=[db(),lb(),Db(),jb(),zb(),$b(),gb(),qb()];return Ln.autoSessionTracking!==!1&&Jn.push(Vb()),Jn})({}).filter((function(Ln){return!["BrowserApiErrors","Breadcrumbs","GlobalHandlers"].includes(Ln.name)})),xn=new kb({dsn:"https://f10f1c81e5d44a4098416c0867a8b740@o77906.ingest.sentry.io/168844",transport:Tb,stackParser:Lb,integrations:wn,environment:ie}),mt=new fs;if(mt.setClient(xn),xn.init(),this.session_id&&mt.setExtra("sessionId",this.session_id),this.properties){var At=je({},this.properties);At.userName=At.userName?"[Filtered]":void 0,At.userData=At.userData?"[Filtered]":void 0,At.token=At.token?"[Filtered]":void 0,mt.setExtra("properties",At)}if(H){var en=H.searchParams.get("domain");if(!en){var zt=H.host.match(/(.*?)\./);en=zt&&zt[1]||""}en&&mt.setTag("domain",en)}g.error&&(mt.setTag("fatalErrorType",g.error.type),mt.setExtra("errorDetails",g.error.details),!((fe=g.error.details)===null||fe===void 0)&&fe.uri&&mt.setTag("serverAddress",g.error.details.uri),!((Me=g.error.details)===null||Me===void 0)&&Me.workerGroup&&mt.setTag("workerGroup",g.error.details.workerGroup),!((qe=g.error.details)===null||qe===void 0)&&qe.geoGroup&&mt.setTag("geoGroup",g.error.details.geoGroup),!((Xe=g.error.details)===null||Xe===void 0)&&Xe.on&&mt.setTag("connectionAttempt",g.error.details.on),(Vt=g.error.details)!==null&&Vt!==void 0&&Vt.bundleUrl&&(mt.setTag("bundleUrl",g.error.details.bundleUrl),mt.setTag("bundleError",g.error.details.sourceError.type))),mt.setTags({callMode:this._callObjectMode?ot()?"reactNative":(j=this.properties)!==null&&j!==void 0&&(j=j.dailyConfig)!==null&&j!==void 0&&(j=j.callMode)!==null&&j!==void 0&&j.includes("prebuilt")?this.properties.dailyConfig.callMode:"custom":"prebuilt-frame",version:n.version()});var Ze=((F=g.error)===null||F===void 0?void 0:F.msg)||g.errorMsg;mt.captureException(new Error(Ze))}}},{key:"_callMachine",value:function(){var g;return(g=window._daily)===null||g===void 0||(g=g.instances)===null||g===void 0||(g=g[this.callClientId])===null||g===void 0?void 0:g.callMachine}},{key:"_maybeUpdateInputSettings",value:function(g){if(!An(this._inputSettings,g)){var M=this._getInputSettings();this._inputSettings=g;var C=this._getInputSettings();An(M,C)||this.emitDailyJSEvent({action:pv,inputSettings:C})}}}],[{key:"supportedBrowser",value:function(){if(ot())return{supported:!0,mobile:!0,name:"React Native",version:null,supportsScreenShare:!0,supportsSfu:!0,supportsVideoProcessing:!1,supportsAudioProcessing:!1};var g=Pw.getParser(kr());return{supported:!!rh(),mobile:g.getPlatformType()==="mobile",name:g.getBrowserName(),version:g.getBrowserVersion(),supportsFullscreen:!!kv(),supportsScreenShare:!!HS(),supportsSfu:!!rh(),supportsVideoProcessing:Cv(),supportsAudioProcessing:Ev()}}},{key:"version",value:function(){return"0.84.0"}},{key:"createCallObject",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return g.layout="none",new n(null,g)}},{key:"wrap",value:function(g){var M=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(at(),!g||!g.contentWindow||typeof g.src!="string")throw new Error("DailyIframe::Wrap needs an iframe-like first argument");return M.layout||(M.customLayout?M.layout="custom-v1":M.layout="browser"),new n(g,M)}},{key:"createFrame",value:function(g,M){var C,j;at(),g&&M?(C=g,j=M):g&&g.append?(C=g,j={}):(C=document.body,j=g||{});var F=j.iframeStyle;F||(F=C===document.body?{position:"fixed",border:"1px solid black",backgroundColor:"white",width:"375px",height:"450px",right:"1em",bottom:"1em"}:{border:0,width:"100%",height:"100%"});var H=document.createElement("iframe");window.navigator&&window.navigator.userAgent.match(/Chrome\/61\./)?H.allow="microphone, camera":H.allow="microphone; camera; autoplay; display-capture; screen-wake-lock",H.style.visibility="hidden",C.appendChild(H),H.style.visibility=null,Object.keys(F).forEach((function(ie){return H.style[ie]=F[ie]})),j.layout||(j.customLayout?j.layout="custom-v1":j.layout="browser");try{return new n(H,j)}catch(ie){throw C.removeChild(H),ie}}},{key:"createTransparentFrame",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};at();var M=document.createElement("iframe");return M.allow="microphone; camera; autoplay",M.style.cssText=`
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: 0;
      pointer-events: none;
    `,document.body.appendChild(M),g.layout||(g.layout="custom-v1"),n.wrap(M,g)}},{key:"getCallInstance",value:function(){var g=arguments.length>0&&arguments[0]!==void 0?arguments[0]:void 0;return g?So[g]:Object.values(So)[0]}}]);var e,r,a,l,f,h,v,y,k,E,O,D,x,L,R,N,q,Q,ee,P,$,G,ae,ye,Ce,Ve,S,ze,Ee,Y,De,it,we,he,ke,oe,J,le})();function ay(n){if(n.extension){if(typeof n.extension!="string")throw new Error("Error starting dial out: extension must be a string");if(n.extension.length>20)throw new Error("Error starting dial out: extension length must be less than or equal to 20")}if(n.waitBeforeExtensionDialSec){if(typeof n.waitBeforeExtensionDialSec!="number")throw new Error("Error starting dial out: waitBeforeExtensionDialSec must be a number");if(n.waitBeforeExtensionDialSec>60)throw new Error("Error starting dial out: waitBeforeExtensionDialSec must be less than or equal to 60");if(!n.extension)throw new Error("Error starting dial out: waitBeforeExtensionDialSec requires a phoneNumber and extension")}}function ba(n,e){var r={};for(var a in n)if(n[a]instanceof MediaStreamTrack)console.warn("MediaStreamTrack found in props or cache.",a),r[a]=Fi;else if(a==="dailyConfig"){if(n[a].modifyLocalSdpHook){var l=window._daily.instances[e].customCallbacks||{};l.modifyLocalSdpHook=n[a].modifyLocalSdpHook,window._daily.instances[e].customCallbacks=l,delete n[a].modifyLocalSdpHook}if(n[a].modifyRemoteSdpHook){var f=window._daily.instances[e].customCallbacks||{};f.modifyRemoteSdpHook=n[a].modifyRemoteSdpHook,window._daily.instances[e].customCallbacks=f,delete n[a].modifyRemoteSdpHook}r[a]=n[a]}else r[a]=n[a];return r}function _t(n){var e=arguments.length>2?arguments[2]:void 0;if(n!==_o){var r="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," only supported after join.");throw e&&(r+=" ".concat(e)),console.error(r),new Error(r)}}function Ou(n,e){return[Kf,_o].includes(n)||e}function ph(n,e){var r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:"This daily-js method",a=arguments.length>3?arguments[3]:void 0;if(Ou(n,e)){var l="".concat(r," not supported after joining a meeting.");throw a&&(l+=" ".concat(a)),console.error(l),new Error(l)}}function Tu(n){var e=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method",r=arguments.length>2?arguments[2]:void 0;if(!n){var a="".concat(e,arguments.length>3&&arguments[3]!==void 0&&arguments[3]?" requires preAuth() or startCamera() to initialize call state.":" requires preAuth(), startCamera(), or join() to initialize call state.");throw r&&(a+=" ".concat(r)),console.error(a),new Error(a)}}function gh(n){if(n){var e="A pre-call quality test is in progress. Please try ".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," again once testing has completed. Use stopTestCallQuality() to end it early.");throw console.error(e),new Error(e)}}function zr(n){if(!n){var e="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," is only supported on custom callObject instances");throw console.error(e),new Error(e)}}function ur(n){if(n){var e="".concat(arguments.length>1&&arguments[1]!==void 0?arguments[1]:"This daily-js method"," is only supported as part of Daily's Prebuilt");throw console.error(e),new Error(e)}}function at(){if(ot())throw new Error("This daily-js method is not currently supported in React Native")}function Oc(){if(!ot())throw new Error("This daily-js method is only supported in React Native")}function cy(n){if(n===void 0)return!0;var e;if(typeof n=="string")e=n;else try{e=JSON.stringify(n),An(JSON.parse(e),n)||console.warn("The userData provided will be modified when serialized.")}catch(r){throw Error("userData must be serializable to JSON: ".concat(r))}if(e.length>4096)throw Error("userData is too large (".concat(e.length," characters). Maximum size suppported is ").concat(4096,"."));return!0}function ly(n,e){for(var r=e.allowAllParticipantsKey,a=function(O){var D=["local"];return r||D.push("*"),O&&!D.includes(O)},l=function(O){return!!(O.layer===void 0||Number.isInteger(O.layer)&&O.layer>=0||O.layer==="inherit")},f=function(O){return!!O&&!(O.video&&!l(O.video))&&!(O.screenVideo&&!l(O.screenVideo))},h=0,v=Object.entries(n);h<v.length;h++){var y=mn(v[h],2),k=y[0],E=y[1];if(!a(k)||!f(E))return!1}return!0}function uy(n){if(ut(n)!=="object")return!1;for(var e=0,r=Object.entries(n);e<r.length;e++){var a=mn(r[e],2),l=a[0],f=a[1];switch(l){case"video":if(ut(f)!=="object")return!1;for(var h=0,v=Object.entries(f);h<v.length;h++){var y=mn(v[h],2),k=y[0],E=y[1];switch(k){case"processor":if(!bk(E))return!1;break;case"settings":if(!fy(E))return!1;break;default:return!1}}break;case"audio":if(ut(f)!=="object")return!1;for(var O=0,D=Object.entries(f);O<D.length;O++){var x=mn(D[O],2),L=x[0],R=x[1];switch(L){case"processor":if(!wk(R))return!1;break;case"settings":if(!fy(R))return!1;break;default:return!1}}break;default:return!1}}return!0}function dy(n,e,r){var a,l=[];n.video&&n.video.processor&&(Cv((a=e?.useLegacyVideoProcessor)!==null&&a!==void 0&&a)||(n.video.settings?delete n.video.processor:delete n.video,l.push("video"))),n.audio&&n.audio.processor&&(Ev()||(n.audio.settings?delete n.audio.processor:delete n.audio,l.push("audio"))),l.length>0&&console.error("Ignoring settings for browser- or platform-unsupported input processor(s): ".concat(l.join(", "))),n.audio&&n.audio.settings&&(n.audio.settings.customTrack?(r.audioTrack=n.audio.settings.customTrack,n.audio.settings={customTrack:Fi}):delete r.audioTrack),n.video&&n.video.settings&&(n.video.settings.customTrack?(r.videoTrack=n.video.settings.customTrack,n.video.settings={customTrack:Fi}):delete r.videoTrack)}function wk(n){if(ot())return console.warn("Video processing is not yet supported in React Native"),!1;var e=["type"];return!!n&&ut(n)==="object"&&(Object.keys(n).filter((function(r){return!e.includes(r)})).forEach((function(r){console.warn("invalid key inputSettings -> audio -> processor : ".concat(r)),delete n[r]})),!!(function(r){return typeof r!="string"?!1:Object.values(wv).includes(r)?!0:(console.error("inputSettings audio processor type invalid"),!1)})(n.type))}function bk(n){if(ot())return console.warn("Video processing is not yet supported in React Native"),!1;var e=["type","config"];return!n||ut(n)!=="object"||!(function(r){return typeof r!="string"?!1:Object.values(wu).includes(r)?!0:(console.error("inputSettings video processor type invalid"),!1)})(n.type)||n.config&&(ut(n.config)!=="object"||!(function(r,a){var l=Object.keys(a);if(l.length===0)return!0;var f="invalid object in inputSettings -> video -> processor -> config";switch(r){case wu.BGBLUR:return l.length>1||l[0]!=="strength"?(console.error(f),!1):!(typeof a.strength!="number"||a.strength<=0||a.strength>1||isNaN(a.strength))||(console.error("".concat(f,"; expected: {0 < strength <= 1}, got: ").concat(a.strength)),!1);case wu.BGIMAGE:return!(a.source!==void 0&&!(function(h){if(h.source==="default")return h.type="default",!0;if(h.source instanceof ArrayBuffer)return!0;if(Xl(h.source))return h.type="url",!!(function(k){var E=new URL(k),O=E.pathname;if(E.protocol==="data:")try{var D=O.substring(O.indexOf(":")+1,O.indexOf(";")).split("/")[1];return th.includes(D)}catch(L){return console.error("failed to deduce blob content type",L),!1}var x=O.split(".").at(-1).toLowerCase().trim();return th.includes(x)})(h.source)||(console.error("invalid image type; supported types: [".concat(th.join(", "),"]")),!1);return v=h.source,y=Number(v),isNaN(y)||!Number.isInteger(y)||y<=0||y>10?(console.error("invalid image selection; must be an int, > 0, <= ".concat(10)),!1):(h.type="daily-preselect",!0);var v,y})(a));default:return!0}})(n.type,n.config))?!1:(Object.keys(n).filter((function(r){return!e.includes(r)})).forEach((function(r){console.warn("invalid key inputSettings -> video -> processor : ".concat(r)),delete n[r]})),!0)}function fy(n){return ut(n)==="object"&&(!n.customTrack||n.customTrack instanceof MediaStreamTrack)}function mh(){var n=Object.values(wu).join(" | "),e=Object.values(wv).join(" | ");return"inputSettings must be of the form: { video?: { processor?: { type: [ ".concat(n," ], config?: {} } }, audio?: { processor: {type: [ ").concat(e," ] } } }")}function hy(n){var e=n.allowAllParticipantsKey;return"receiveSettings must be of the form { [<remote participant id> | ".concat(Hb).concat(e?' | "'.concat("*",'"'):"","]: ")+'{ [video: [{ layer: [<non-negative integer> | "inherit"] } | "inherit"]], [screenVideo: [{ layer: [<non-negative integer> | "inherit"] } | "inherit"]] }}}'}function py(){return"customIntegrations should be an object of type ".concat(JSON.stringify(hh),".")}function gy(n){if(n&&ut(n)!=="object"||Array.isArray(n))return console.error("customTrayButtons should be an Object of the type ".concat(JSON.stringify(Cu),".")),!1;if(n)for(var e=0,r=Object.entries(n);e<r.length;e++)for(var a=mn(r[e],1)[0],l=0,f=Object.entries(n[a]);l<f.length;l++){var h=mn(f[l],2),v=h[0],y=h[1],k=Cu.id[v];if(!k)return console.error("customTrayButton does not support key ".concat(v)),!1;switch(v){case"iconPath":case"iconPathDarkMode":if(!Xl(y))return console.error("customTrayButton ".concat(v," should be a url.")),!1;break;case"visualState":if(!["default","sidebar-open","active"].includes(y))return console.error("customTrayButton ".concat(v," should be ").concat(k,". Got: ").concat(y)),!1;break;default:if(ut(y)!==k)return console.error("customTrayButton ".concat(v," should be a ").concat(k,".")),!1}}return!0}function my(n){if(!n||n&&ut(n)!=="object"||Array.isArray(n))return console.error(py()),!1;for(var e=function(O){return"".concat(O," should be ").concat(hh.id[O])},r=function(O,D){return console.error("customIntegration ".concat(O,": ").concat(D))},a=0,l=Object.entries(n);a<l.length;a++){var f=mn(l[a],1)[0];if(!("label"in n[f]))return r(f,"label is required"),!1;if(!("location"in n[f]))return r(f,"location is required"),!1;if(!("src"in n[f])&&!("srcdoc"in n[f]))return r(f,"src or srcdoc is required"),!1;for(var h=0,v=Object.entries(n[f]);h<v.length;h++){var y=mn(v[h],2),k=y[0],E=y[1];switch(k){case"allow":case"csp":case"name":case"referrerPolicy":case"sandbox":if(typeof E!="string")return r(f,e(k)),!1;break;case"iconURL":if(!Xl(E))return r(f,"".concat(k," should be a url")),!1;break;case"src":if("srcdoc"in n[f])return r(f,"cannot have both src and srcdoc"),!1;if(!Xl(E))return r(f,'src "'.concat(E,'" is not a valid URL')),!1;break;case"srcdoc":if("src"in n[f])return r(f,"cannot have both src and srcdoc"),!1;if(typeof E!="string")return r(f,e(k)),!1;break;case"location":if(!["main","sidebar"].includes(E))return r(f,e(k)),!1;break;case"controlledBy":if(E!=="*"&&E!=="owners"&&(!Array.isArray(E)||E.some((function(O){return typeof O!="string"}))))return r(f,e(k)),!1;break;case"shared":if((!Array.isArray(E)||E.some((function(O){return typeof O!="string"})))&&E!=="owners"&&typeof E!="boolean")return r(f,e(k)),!1;break;default:if(!hh.id[k])return console.error("customIntegration does not support key ".concat(k)),!1}}}return!0}function vy(n,e){if(e===void 0)return!1;switch(ut(e)){case"string":return ut(n)===e;case"object":if(ut(n)!=="object")return!1;for(var r in n)if(!vy(n[r],e[r]))return!1;return!0;default:return!1}}function yy(n,e){var r=n.sessionId,a=n.toEndPoint,l=n.callerId,f=n.useSipRefer;if(!r||!a)throw new Error("".concat(e,"() requires a sessionId and toEndPoint"));if(typeof r!="string"||typeof a!="string")throw new Error("Invalid paramater: sessionId and toEndPoint must be of type string");if(f&&!a.startsWith("sip:"))throw new Error('"toEndPoint" must be a "sip" address');if(!a.startsWith("sip:")&&!a.startsWith("+"))throw new Error("toEndPoint: ".concat(a,' must starts with either "sip:" or "+"'));if(l&&typeof l!="string")throw new Error("callerId must be of type string");if(l&&!a.startsWith("+"))throw new Error("callerId is only valid when transferring to a PSTN number")}function _y(n){if(ut(n)!=="object")throw new Error('RemoteMediaPlayerSettings: must be "object" type');if(n.state&&!Object.values(eh).includes(n.state))throw new Error("Invalid value for RemoteMediaPlayerSettings.state, valid values are: "+JSON.stringify(eh));if(n.volume){if(typeof n.volume!="number")throw new Error('RemoteMediaPlayerSettings.volume: must be "number" type');if(n.volume<0||n.volume>2)throw new Error("RemoteMediaPlayerSettings.volume: must be between 0.0 - 2.0")}}function wy(n,e,r){return!(typeof n!="number"||n<e||n>r)}function vh(n,e){return n&&!e&&delete n.data,n}function dr(n){"@babel/helpers - typeof";return dr=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},dr(n)}var tt=function(){return tt=Object.assign||function(r){for(var a,l=1,f=arguments.length;l<f;l++){a=arguments[l];for(var h in a)Object.prototype.hasOwnProperty.call(a,h)&&(r[h]=a[h])}return r},tt.apply(this,arguments)};function yh(n,e){var r={};for(var a in n)Object.prototype.hasOwnProperty.call(n,a)&&e.indexOf(a)<0&&(r[a]=n[a]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var l=0,a=Object.getOwnPropertySymbols(n);l<a.length;l++)e.indexOf(a[l])<0&&Object.prototype.propertyIsEnumerable.call(n,a[l])&&(r[a[l]]=n[a[l]]);return r}function Sa(n,e,r,a){function l(f){return f instanceof r?f:new r(function(h){h(f)})}return new(r||(r=Promise))(function(f,h){function v(E){try{k(a.next(E))}catch(O){h(O)}}function y(E){try{k(a.throw(E))}catch(O){h(O)}}function k(E){E.done?f(E.value):l(E.value).then(v,y)}k((a=a.apply(n,[])).next())})}function ka(n,e){var r={label:0,sent:function(){if(f[0]&1)throw f[1];return f[1]},trys:[],ops:[]},a,l,f,h;return h={next:v(0),throw:v(1),return:v(2)},typeof Symbol=="function"&&(h[Symbol.iterator]=function(){return this}),h;function v(k){return function(E){return y([k,E])}}function y(k){if(a)throw new TypeError("Generator is already executing.");for(;h&&(h=0,k[0]&&(r=0)),r;)try{if(a=1,l&&(f=k[0]&2?l.return:k[0]?l.throw||((f=l.return)&&f.call(l),0):l.next)&&!(f=f.call(l,k[1])).done)return f;switch(l=0,f&&(k=[k[0]&2,f.value]),k[0]){case 0:case 1:f=k;break;case 4:return r.label++,{value:k[1],done:!1};case 5:r.label++,l=k[1],k=[0];continue;case 7:k=r.ops.pop(),r.trys.pop();continue;default:if(f=r.trys,!(f=f.length>0&&f[f.length-1])&&(k[0]===6||k[0]===2)){r=0;continue}if(k[0]===3&&(!f||k[1]>f[0]&&k[1]<f[3])){r.label=k[1];break}if(k[0]===6&&r.label<f[1]){r.label=f[1],f=k;break}if(f&&r.label<f[2]){r.label=f[2],r.ops.push(k);break}f[2]&&r.ops.pop(),r.trys.pop();continue}k=e.call(n,r)}catch(E){k=[6,E],l=0}finally{a=f=0}if(k[0]&5)throw k[1];return{value:k[0]?k[1]:void 0,done:!0}}}function by(n){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&n[e],a=0;if(r)return r.call(n);if(n&&typeof n.length=="number")return{next:function(){return n&&a>=n.length&&(n=void 0),{value:n&&n[a++],done:!n}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function wt(n,e){var r=typeof Symbol=="function"&&n[Symbol.iterator];if(!r)return n;var a=r.call(n),l,f=[],h;try{for(;(e===void 0||e-- >0)&&!(l=a.next()).done;)f.push(l.value)}catch(v){h={error:v}}finally{try{l&&!l.done&&(r=a.return)&&r.call(a)}finally{if(h)throw h.error}}return f}function yn(n,e,r){if(arguments.length===2)for(var a=0,l=e.length,f;a<l;a++)(f||!(a in e))&&(f||(f=Array.prototype.slice.call(e,0,a)),f[a]=e[a]);return n.concat(f||Array.prototype.slice.call(e))}typeof SuppressedError=="function"&&SuppressedError;var Sy=V.createContext(null),Vi=function(){var e=V.useContext(Sy);return V.useDebugValue(e),e},_h=V.createContext({on:function(){},off:function(){}}),Sk=-1,wh=function(){return Sk--},kk=1,bh=function(){return kk++},Qe=function(e,r,a){a===void 0&&(a=!1);var l=V.useContext(_h),f=l.off,h=l.on,v=wt(V.useState(!1),2),y=v[0],k=v[1],E=V.useRef(0),O=V.useMemo(function(){return a?wh():bh()},[a]);V.useEffect(function(){if(!(!e||y)){if(E.current>1e5){console.error(`useDailyEvent called with potentially non-memoized event callback or due to too many re-renders.
        Memoize using useCallback to avoid re-render loop or reduce the amount of state transitions the callback depends on.
        Passed callback for '`.concat(e,"' event is NOT registered."),r),k(!0);return}E.current++;var D=setTimeout(function(){E.current=0},50);return h(e,r,O),function(){clearTimeout(D),f(e,O)}}},[r,e,O,y,f,h]),V.useDebugValue({event:e,eventId:O,isBlocked:y,callback:r})};function qr(n,e){var r,a;if(n===e)return!0;if(Array.isArray(n)&&Array.isArray(e)){if(n.length!==e.length)return!1;for(var l=0;l<n.length;l++)if(!qr(n[l],e[l]))return!1;return!0}if(MediaStream&&n instanceof MediaStream&&e instanceof MediaStream)return n.id===e.id&&n.active===e.active&&n.getTracks().length===e.getTracks().length&&n.getTracks().every(function(L,R){return qr(L,e.getTracks()[R])});if(MediaStreamTrack&&n instanceof MediaStreamTrack&&e instanceof MediaStreamTrack)return n.id===e.id&&n.kind===e.kind&&n.readyState===e.readyState;if(n instanceof Date&&e instanceof Date)return n.getTime()===e.getTime();if(n instanceof RegExp&&e instanceof RegExp)return n.source===e.source&&n.flags===e.flags;if(n instanceof Set&&e instanceof Set){if(n.size!==e.size)return!1;var f=Array.from(n).sort(),h=Array.from(e).sort();return f.every(function(L,R){return qr(L,h[R])})}if(n instanceof Map&&e instanceof Map){if(n.size!==e.size)return!1;try{for(var v=by(n.entries()),y=v.next();!y.done;y=v.next()){var k=wt(y.value,2),E=k[0],O=k[1];if(!e.has(E)||!qr(O,e.get(E)))return!1}}catch(L){r={error:L}}finally{try{y&&!y.done&&(a=v.return)&&a.call(v)}finally{if(r)throw r.error}}return!0}if(dr(n)!=="object"||n===null||dr(e)!=="object"||e===null)return!1;var D=Object.keys(n),x=Object.keys(e);if(D.length!==x.length)return!1;for(var l=0;l<D.length;l++){var E=D[l];if(!Object.prototype.hasOwnProperty.call(e,E)||!qr(n[E],e[E]))return!1}return!0}function Sh(n,e){if(n===e)return!0;if(n.length!==e.length)return!1;for(var r=0;r<n.length;r++){var a=n[r],l=e[r],f=a!==null&&dr(a)==="object",h=l!==null&&dr(l)==="object";if(f||h){if(!qr(a,l))return!1}else if(a!==l)return!1}return!0}function gt(n){return"daily-react-"+n}function kh(n){var e=new Map,r=new Map;return function(a){if(!e.has(a)){var l=st(function(f){var h=n.get(a)(f),v=r.get(a);return v!=null&&n.equals(h,v)?v:(r.set(a,h),h)});e.set(a,l)}return e.get(a)}}var Ch="::",ky=";",Eh=function(e,r){return e+Ch+r},Ck=function(e,r){return e+Ch+r.join(ky)},_n=function(e,r){return Mh(Eh(e,r))},Ca=mc(function(n){var e=st([]);return e.debugLabel=gt("participant-property-paths-".concat(n)),e}),Mh=mc(function(n){var e=st(null);return e.debugLabel=gt("participant-property-".concat(n)),e}),Ek=kh({equals:Sh,get:function(e){return function(r){var a=wt(e.split(Ch),2),l=a[0],f=a[1],h=f.split(ky);return h.map(function(v){return r(_n(l,v))})}}}),Cy=function(e,r){var a,l=ao(Array.isArray(r)?Ek(Ck(e,r)):Mh(Eh(e,r)));return V.useDebugValue(Array.isArray(r)?r.reduce(function(f,h,v){return f[h]=l[v],f},{}):(a={},a[r]=l,a)),l},Ru=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Mk(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Oh,Ey;function Ok(){if(Ey)return Oh;Ey=1;var n="Expected a function",e=NaN,r="[object Symbol]",a=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,f=/^0b[01]+$/i,h=/^0o[0-7]+$/i,v=parseInt,y=dr(Ru)=="object"&&Ru&&Ru.Object===Object&&Ru,k=(typeof self>"u"?"undefined":dr(self))=="object"&&self&&self.Object===Object&&self,E=y||k||Function("return this")(),O=Object.prototype,D=O.toString,x=Math.max,L=Math.min,R=function(){return E.Date.now()};function N(G,ae,ye){var Ce,Ve,S,ze,Ee,Y,De=0,it=!1,we=!1,he=!0;if(typeof G!="function")throw new TypeError(n);ae=$(ae)||0,Q(ye)&&(it=!!ye.leading,we="maxWait"in ye,S=we?x($(ye.maxWait)||0,ae):S,he="trailing"in ye?!!ye.trailing:he);function ke(H){var ie=Ce,fe=Ve;return Ce=Ve=void 0,De=H,ze=G.apply(fe,ie),ze}function oe(H){return De=H,Ee=setTimeout(g,ae),it?ke(H):ze}function J(H){var ie=H-Y,fe=H-De,Me=ae-ie;return we?L(Me,S-fe):Me}function le(H){var ie=H-Y,fe=H-De;return Y===void 0||ie>=ae||ie<0||we&&fe>=S}function g(){var H=R();if(le(H))return M(H);Ee=setTimeout(g,J(H))}function M(H){return Ee=void 0,he&&Ce?ke(H):(Ce=Ve=void 0,ze)}function C(){Ee!==void 0&&clearTimeout(Ee),De=0,Ce=Y=Ve=Ee=void 0}function j(){return Ee===void 0?ze:M(R())}function F(){var H=R(),ie=le(H);if(Ce=arguments,Ve=this,Y=H,ie){if(Ee===void 0)return oe(Y);if(we)return Ee=setTimeout(g,ae),ke(Y)}return Ee===void 0&&(Ee=setTimeout(g,ae)),ze}return F.cancel=C,F.flush=j,F}function q(G,ae,ye){var Ce=!0,Ve=!0;if(typeof G!="function")throw new TypeError(n);return Q(ye)&&(Ce="leading"in ye?!!ye.leading:Ce,Ve="trailing"in ye?!!ye.trailing:Ve),N(G,ae,{leading:Ce,maxWait:ae,trailing:Ve})}function Q(G){var ae=dr(G);return!!G&&(ae=="object"||ae=="function")}function ee(G){return!!G&&dr(G)=="object"}function P(G){return dr(G)=="symbol"||ee(G)&&D.call(G)==r}function $(G){if(typeof G=="number")return G;if(P(G))return e;if(Q(G)){var ae=typeof G.valueOf=="function"?G.valueOf():G;G=Q(ae)?ae+"":ae}if(typeof G!="string")return G===0?G:+G;G=G.replace(a,"");var ye=f.test(G);return ye||h.test(G)?v(G.slice(2),ye?2:8):l.test(G)?e:+G}return Oh=q,Oh}var Tk=Ok(),Rk=Mk(Tk),Au=function(e,r,a,l){a===void 0&&(a=500),l===void 0&&(l=!1);var f=V.useContext(_h),h=f.off,v=f.on,y=V.useMemo(function(){var O;return Array.isArray(e)?e.reduce(function(D,x){return D[x]=l?wh():bh(),D},{}):(O={},O[e]=l?wh():bh(),O)},[e,l]),k=V.useRef([]);Qe("call-instance-destroyed",V.useCallback(function(){k.current.length=0},[]));var E=V.useMemo(function(){return Rk(function(){k.current.length!==0&&(r(k.current),k.current.length=0)},a,{trailing:!0})},[r,a]);V.useEffect(function(){if(e){var O=function(x){k.current.push(x),E()};return Array.isArray(e)?e.forEach(function(D){return v(D,O,y[D])}):v(e,O,y[e]),function(){Array.isArray(e)?e.forEach(function(D){return h(D,y[D])}):h(e,y[e])}}},[E,e,y,h,v]),V.useDebugValue({event:e,eventId:y})},My=function(e,r,a){if(r===void 0&&(r=""),a===void 0&&(a=new Set),dr(e)!=="object"||e===null||a.has(e))return[r];a.add(e);var l=[];for(var f in e)if(Object.prototype.hasOwnProperty.call(e,f)){var h=r?"".concat(r,".").concat(f):f;l.push.apply(l,yn([h],wt(My(e[f],h,a)),!1))}return a.delete(e),l},Th=function(e){return My(e)},Ak=function(e,r){return String(r).split(".").filter(function(a){return a.length}).reduce(function(a,l){return a&&a[l]},e)},Rh=function(e,r){return r.map(function(a){return Ak(e,a)})},Pu=st(null);Pu.debugLabel=gt("active-id");var Tc=st("");Tc.debugLabel=gt("local-id");var Oy=st(null);Oy.debugLabel=gt("local-join-date");var Co=st([]);Co.debugLabel=gt("participant-ids");var Eo=mc(function(n){var e=st(null);return e.debugLabel=gt("participant-".concat(n)),e}),Ah=st([]);Ah.debugLabel=gt("waiting-participants");var Ph=mc(function(n){var e=st({awaitingAccess:{level:"full"},id:n,name:""});return e.debugLabel=gt("waiting-participant-".concat(n)),e}),Pk=function(e){var r=e.children,a=Vi(),l=wt(V.useState(!1),2),f=l[0],h=l[1],v=rt(V.useCallback(function(E,O,D){O(Tc,D.local.session_id);var x=Object.values(D),L=x.map(function(R){return R.session_id});O(Co,L),x.forEach(function(R){O(Eo(R.session_id),R);var N=Th(R);O(Ca(R.session_id),N),N.forEach(function(q){var Q=wt(Rh(R,[q]),1),ee=Q[0];O(_n(R.session_id,q),ee)})}),h(!0)},[]));V.useEffect(function(){if(!(!a||f)){var E=setInterval(function(){var O=a.participants();"local"in O&&(v(O),clearInterval(E))},100);return function(){clearInterval(E)}}},[a,f,v]);var y=V.useCallback(function(){if(a){var E=a?.participants();E.local&&v(E)}},[a,v]);Qe("started-camera",y,!0),Qe("access-state-updated",y,!0),Qe("joining-meeting",rt(V.useCallback(function(E,O){O(Oy,new Date),y()},[y])),!0),Qe("joined-meeting",V.useCallback(function(E){v(E.participants)},[v]),!0);var k=rt(V.useCallback(function(E,O){O(Tc,""),O(Pu,null);var D=E(Co);D.forEach(function(x){return Eo.remove(x)}),O(Co,[])},[]));return Qe("call-instance-destroyed",k,!0),Qe("left-meeting",k,!0),Au(["active-speaker-change","participant-joined","participant-updated","participant-left"],rt(V.useCallback(function(E,O,D){D.length&&D.forEach(function(x){switch(x.action){case"active-speaker-change":{O(Pu,x.activeSpeaker.peerId),O(Eo(x.activeSpeaker.peerId),function(P){return P?tt(tt({},P),{last_active:new Date}):null});break}case"participant-joined":{O(Co,function(P){return P.includes(x.participant.session_id)?P:yn(yn([],wt(P),!1),[x.participant.session_id],!1)}),O(Eo(x.participant.session_id),x.participant);var L=Th(x.participant);O(Ca(x.participant.session_id),L),L.forEach(function(P){var $=wt(Rh(x.participant,[P]),1),G=$[0];O(_n(x.participant.session_id,P),G)});break}case"participant-updated":{O(Eo(x.participant.session_id),x.participant),x.participant.local&&O(Tc,x.participant.session_id);var L=Th(x.participant),R=E(Ca(x.participant.session_id)),N=L.length!==R.length||L.some(function($){return!R.includes($)});N&&O(Ca(x.participant.session_id),L);var q=new Set(R),Q=Rh(x.participant,L);L.forEach(function($,G){var ae=Q[G];q.delete($),O(_n(x.participant.session_id,$),function(ye){return qr(ye,ae)?ye:ae})}),q.forEach(function($){O(_n(x.participant.session_id,$),null)});break}case"participant-left":{O(Co,function(P){return P.includes(x.participant.session_id)?P.filter(function($){return $!==x.participant.session_id}):P}),Eo.remove(x.participant.session_id);var ee=E(Ca(x.participant.session_id));ee.forEach(function(P){Mh.remove(Eh(x.participant.session_id,P))}),Ca.remove(x.participant.session_id);break}}})},[])),100,!0),Au(["waiting-participant-added","waiting-participant-updated","waiting-participant-removed"],rt(V.useCallback(function(E,O,D){D.forEach(function(x){switch(x.action){case"waiting-participant-added":O(Ah,function(L){return L.includes(x.participant.id)?L:yn(yn([],wt(L),!1),[x.participant.id],!1)}),O(Ph(x.participant.id),x.participant);break;case"waiting-participant-updated":O(Ph(x.participant.id),x.participant);break;case"waiting-participant-removed":O(Ah,function(L){return L.filter(function(R){return R!==x.participant.id})}),Ph.remove(x.participant.id);break}})},[])),100,!0),et.createElement(et.Fragment,null,r)},Iu=function(){var e=ao(Tc);return V.useDebugValue(e),e},Ik=function(){return!0},xk=function(e){var r=e===void 0?{}:e,a=r.filter,l=a===void 0?Ik:a,f=r.ignoreLocal,h=f===void 0?!1:f,v=Iu(),y=ao(Pu),k=h&&y===v,E=!l?.(y),O=!k&&!E,D=wt(V.useState(O?y:null),2),x=D[0],L=D[1];return V.useEffect(function(){k||E||L(y)},[E,k,y]),V.useDebugValue(x),x},xu=function(e){return["blocked","off"].includes(e)},Ty=";",Ry=function(e,r){return"".concat(e).concat(Ty).concat(r)},Ay=kh({equals:qr,get:function(e){return function(r){var a=wt(e.split(Ty),2),l=a[0],f=a[1],h=r(Co);return h.filter(function(v){switch(l){case"local":case"owner":case"record":return r(_n(v,l));case"remote":return!r(_n(v,"local"));case"screen":{var y=r(_n(v,"tracks.screenAudio.state")),k=r(_n(v,"tracks.screenVideo.state"));return!xu(y)||!xu(k)}default:return!0}}).sort(function(v,y){switch(f){case"joined_at":case"session_id":case"user_id":case"user_name":{var k=r(_n(v,f)),E=r(_n(y,f));if(k!==void 0||E!==void 0){if(k===void 0)return-1;if(E===void 0||k>E)return 1;if(k<E)return-1}return 0}default:return 0}})}}}),Py=function(e){var r=e===void 0?{}:e,a=r.filter,l=r.onActiveSpeakerChange,f=r.onParticipantJoined,h=r.onParticipantLeft,v=r.onParticipantUpdated,y=r.sort,k=ao(Ay(Ry(typeof a=="string"?a:null,typeof y=="string"?y:null))),E=typeof a=="function"||typeof y=="function",O=V.useCallback(function(q){if(typeof a!="function"&&typeof y!="function")return[];var Q=k.map(function(ee){return q(Eo(ee))});return Q.filter(function(ee){return!!ee}).filter(typeof a=="function"?a:function(){return!0}).sort(typeof y=="function"?y:function(){return 0}).map(function(ee){return ee.session_id}).filter(Boolean)},[a,k,y]),D=wt(V.useState([]),2),x=D[0],L=D[1],R=rt(V.useCallback(function(q){if(E){var Q=O(q);qr(Q,x)||L(Q)}},[x,O,E]));V.useEffect(function(){R()},[R]),Au(["participant-joined","participant-updated","active-speaker-change","participant-left"],V.useCallback(function(q){q.length&&(q.forEach(function(Q){switch(Q.action){case"participant-joined":f?.(Q);break;case"participant-updated":v?.(Q);break;case"active-speaker-change":l?.(Q);break;case"participant-left":h?.(Q);break}}),R())},[R,l,f,h,v]));var N=typeof a=="function"||typeof y=="function"?x:k;return V.useDebugValue(N),N},Lk=kh({equals:Sh,get:function(){return function(e){var r=e(Ay(Ry("screen",null)));return r.map(function(a){return{local:e(_n(a,"local")),screenAudio:e(_n(a,"tracks.screenAudio")),screenVideo:e(_n(a,"tracks.screenVideo")),screenId:"".concat(a,"-screen"),session_id:a}})}}}),jk=function(e){var r={},a=r.onError,l=r.onLocalScreenShareStarted,f=r.onLocalScreenShareStopped,h=Vi(),v=V.useCallback(function(){for(var O=[],D=0;D<arguments.length;D++)O[D]=arguments[D];h?.startScreenShare.apply(h,yn([],wt(O),!1))},[h]),y=V.useCallback(function(){for(var O=[],D=0;D<arguments.length;D++)O[D]=arguments[D];h?.stopScreenShare.apply(h,yn([],wt(O),!1))},[h]);Qe("local-screen-share-started",V.useCallback(function(){return l?.()},[l])),Qe("local-screen-share-stopped",V.useCallback(function(){return f?.()},[f])),Qe("nonfatal-error",V.useCallback(function(O){O.type==="screen-share-error"&&a?.(O)},[a]));var k=ao(Lk(void 0)),E={isSharingScreen:k.some(function(O){return O.local}),screens:k,startScreenShare:v,stopScreenShare:y};return V.useDebugValue(E),E},Iy=function(e,r){r===void 0&&(r="video");var a=Cy(e,"tracks.".concat(r)),l=a?tt(tt({},a),{isOff:xu(a.state)}):{isOff:!0,persistentTrack:void 0,state:"off",subscribed:!1};return V.useDebugValue(l),l};function xy(){for(var n=[],e=0;e<arguments.length;e++)n[e]=arguments[e];return V.useCallback(function(r){for(var a=0;a<n.length;a++){var l=n[a];typeof l=="function"?l(r):l&&dr(l)==="object"&&(l.current=r)}},n)}var Lu=V.memo(V.forwardRef(function(n,e){var r=n.onPlayFailed,a=n.sessionId,l=n.type,f=l===void 0?"audio":l,h=yh(n,["onPlayFailed","sessionId","type"]),v=V.useRef(null),y=Iy(a,f),k=xy(v,e),E=y?.subscribed;return V.useEffect(function(){var O=v.current;if(!(!O||!y?.persistentTrack)){var D=function(){O.play().catch(function(L){r?.({sessionId:a,target:O,type:f,message:L.message,name:L.name})})};if(!MediaStream){console.warn("MediaStream API not available. Can't setup ".concat(f," for ").concat(a)),r?.({sessionId:a,target:O,type:f,message:"MediaStream API not available",name:"MediaStream API not available"});return}return O.addEventListener("canplay",D),O.srcObject=new MediaStream([y?.persistentTrack]),function(){O?.removeEventListener("canplay",D)}}},[y?.persistentTrack,r,a,f]),Qe("participant-left",V.useCallback(function(O){var D=v.current;O.participant.session_id!==a||!D||(D.srcObject=null)},[a])),et.createElement("audio",tt({autoPlay:!0,ref:k},h,{"data-session-id":a,"data-audio-type":f,"data-subscribed":E}))}));Lu.displayName="DailyAudioTrack";var Nk=V.memo(V.forwardRef(function(n,e){var r=n.autoSubscribeActiveSpeaker,a=r===void 0?!1:r,l=n.maxSpeakers,f=l===void 0?5:l,h=n.onPlayFailed,v=n.playLocalScreenAudio,y=v===void 0?!1:v,k=Vi(),E=wt(V.useState(new Array(f).fill("")),2),O=E[0],D=E[1],x=jk().screens,L=Iu(),R=xk({ignoreLocal:!0}),N=V.useRef(null);V.useImperativeHandle(e,function(){return{getActiveSpeakerAudio:function(){var $,G;return(G=($=N.current)===null||$===void 0?void 0:$.querySelector('audio[data-session-id="'.concat(R,'"][data-audio-type="audio"]')))!==null&&G!==void 0?G:null},getAllAudio:function(){var $,G;return Array.from((G=($=N.current)===null||$===void 0?void 0:$.querySelectorAll("audio"))!==null&&G!==void 0?G:[])},getAudioBySessionId:function($){var G,ae;return(ae=(G=N.current)===null||G===void 0?void 0:G.querySelector('audio[data-session-id="'.concat($,'"][data-audio-type="audio"]')))!==null&&ae!==void 0?ae:null},getRmpAudio:function(){var $,G;return Array.from((G=($=N.current)===null||$===void 0?void 0:$.querySelectorAll('audio[data-audio-type="rmpAudio"]'))!==null&&G!==void 0?G:[])},getScreenAudio:function(){var $,G;return Array.from((G=($=N.current)===null||$===void 0?void 0:$.querySelectorAll('audio[data-audio-type="screenAudio"]'))!==null&&G!==void 0?G:[])},getRmpAudioBySessionId:function($){var G,ae;return(ae=(G=N.current)===null||G===void 0?void 0:G.querySelector('audio[data-session-id="'.concat($,'"][data-audio-type="rmpAudio"]')))!==null&&ae!==void 0?ae:null},getScreenAudioBySessionId:function($){var G,ae;return(ae=(G=N.current)===null||G===void 0?void 0:G.querySelector('audio[data-session-id="'.concat($,'"][data-audio-type="screenAudio"]')))!==null&&ae!==void 0?ae:null}}},[R]);var q=rt(V.useCallback(function(P,$,G){return Sa(void 0,void 0,void 0,function(){var ae,ye,Ce;return ka(this,function(Ve){if(ae=Object.values((Ce=k?.participants())!==null&&Ce!==void 0?Ce:{}).filter(function(S){return!S.local&&!!S.tracks.audio.subscribed}),ye=function(ze){return ae.some(function(Ee){return Ee.session_id===ze})},!ye(G))if(k&&!k.isDestroyed()&&a&&!k.subscribeToTracksAutomatically())k.updateParticipant(G,{setSubscribedTracks:{audio:!0}});else return[2];return D(function(S){var ze;if(S.includes(G))return S;var Ee=function(oe){return!oe||!ye(oe)};if(S.some(Ee)){var Y=S.findIndex(Ee);return S[Y]=G,yn([],wt(S),!1)}var De=S.findIndex(function(ke){return ae.some(function(oe){return oe.session_id===ke&&xu(oe.tracks.audio.state)})});if(De>=0)return S[De]=G,yn([],wt(S),!1);var it=ae.filter(function(ke){return S.includes(ke.session_id)&&ke.session_id!==R}).sort(function(ke,oe){var J,le,g=(J=P(_n(ke.session_id,"last_active")))!==null&&J!==void 0?J:new Date("1970-01-01"),M=(le=P(_n(oe.session_id,"last_active")))!==null&&le!==void 0?le:new Date("1970-01-01");return g>M?1:g<M?-1:0});if(!it.length){var we=S.findIndex(function(ke){return ke!==R});return S[we]=G,yn([],wt(S),!1)}var he=S.indexOf((ze=it[0])===null||ze===void 0?void 0:ze.session_id);return S[he]=G,yn([],wt(S),!1)}),[2]})})},[R,a,k])),Q=V.useCallback(function(P){D(function($){if(!$.includes(P))return $;var G=yn([],wt($),!1),ae=G.indexOf(P);return G[ae]="",G})},[]);Au(["active-speaker-change","track-started","participant-left"],V.useCallback(function(P){P.forEach(function($){switch($.action){case"active-speaker-change":if($.activeSpeaker.peerId===L)return;q($.activeSpeaker.peerId);break;case"track-started":$.track.kind==="audio"&&$.participant&&!$.participant.local&&q($.participant.session_id);break;case"participant-left":Q($.participant.session_id);break}})},[q,L,Q]),200);var ee=Py({filter:V.useCallback(function(P){var $;return!!(!(($=P?.tracks)===null||$===void 0)&&$.rmpAudio)},[])});return et.createElement("div",{ref:N},O.map(function(P,$){return et.createElement(Lu,{key:"speaker-slot-".concat($),onPlayFailed:h,sessionId:P,type:"audio"})}),x.filter(function(P){return y?!0:!P.local}).map(function(P){return et.createElement(Lu,{key:P.screenId,onPlayFailed:h,sessionId:P.session_id,type:"screenAudio"})}),ee.map(function(P){return et.createElement(Lu,{key:"".concat(P,"-rmp"),onPlayFailed:h,sessionId:P,type:"rmpAudio"})}))}));Nk.displayName="DailyAudio";var Dk=V.forwardRef(function(e,r){var a=e.automirror,l=e.fit,f=l===void 0?"contain":l,h=e.mirror,v=e.onResize,y=e.playableStyle,k=y===void 0?{}:y,E=e.sessionId,O=e.style,D=O===void 0?{}:O,x=e.type,L=x===void 0?"video":x,R=yh(e,["automirror","fit","mirror","onResize","playableStyle","sessionId","style","type"]),N=Iu(),q=N===E,Q=L==="screenVideo",ee=q&&!Q,P=V.useRef(null),$=xy(P,r),G=Iy(E,L),ae=G.persistentTrack,ye=ee||Q||!G.isOff,Ce=Cy(E,"tracks.".concat(L)),Ve=Ce?.subscribed,S=V.useMemo(function(){if(typeof h=="boolean")return h;if(!a)return!1;if(!ae)return ee;var ze=ae.getSettings(),Ee="facingMode"in ze?ee&&ze.facingMode==="user":ee;return Ee},[a,ee,h,ae]);return V.useEffect(function(){var Ee=P.current;if(Ee){var Y=function(){var oe=Ee.play();oe!==void 0&&oe.then(function(){Ee.controls=!1}).catch(function(J){Ee.controls=!0,console.warn("Failed to play video",J)})},De=function(){Ee.paused&&Y()},it=function(){Ee.style.transform="scale(1)"},we=function(){Ee.style.transform="",setTimeout(function(){Ee.paused&&Y()},100)},he=function(){document.visibilityState!=="hidden"&&Ee.paused&&Y()};return Ee.addEventListener("canplay",De),Ee.addEventListener("enterpictureinpicture",it),Ee.addEventListener("leavepictureinpicture",we),document.addEventListener("visibilitychange",he),function(){Ee.removeEventListener("canplay",De),Ee.removeEventListener("enterpictureinpicture",it),Ee.removeEventListener("leavepictureinpicture",we),document.removeEventListener("visibilitychange",he)}}},[]),V.useEffect(function(){var Ee=P.current;if(!(!Ee||!ae)){if(!MediaStream){console.warn("MediaStream API not available. Can't setup ".concat(L," for ").concat(E));return}return Ee.srcObject=new MediaStream([ae]),Ee.load(),function(){Ee.srcObject=null,Ee.load()}}},[E,L,ae,ae?.id]),V.useEffect(function(){var Ee=P.current;if(!v||!Ee)return;var Y;function De(){Y&&cancelAnimationFrame(Y),Y=requestAnimationFrame(function(){var it=P.current;if(!(!it||document.hidden)){var we=it.videoWidth,he=it.videoHeight;we&&he&&v?.({aspectRatio:we/he,height:he,width:we})}})}return De(),Ee.addEventListener("loadedmetadata",De),Ee.addEventListener("resize",De),function(){Y&&cancelAnimationFrame(Y),Ee.removeEventListener("loadedmetadata",De),Ee.removeEventListener("resize",De)}},[v]),et.createElement("video",tt({autoPlay:!0,muted:!0,playsInline:!0,ref:$,"data-local":q,"data-mirrored":S||void 0,"data-playable":ye||void 0,"data-session-id":E,"data-subscribed":Ve,"data-video-type":L,style:tt(tt({objectFit:f,transform:S?"scale(-1, 1)":""},D),ye?k:{})},R))});Dk.displayName="DailyVideo";var Uk=V.createContext({refreshDevices:function(){return Promise.resolve()}}),Gt=st("idle");Gt.debugLabel=gt("camera-state");var Ht=st("idle");Ht.debugLabel=gt("microphone-state");var ju=st([]);ju.debugLabel=gt("camera-devices");var Nu=st([]);Nu.debugLabel=gt("microphone-devices");var Ly=st([]);Ly.debugLabel=gt("speaker-devices");var jy=st(null);jy.debugLabel=gt("last-camera-error");var Bk=function(e){var r=e.children,a=Vi(),l=rt(V.useCallback(function(h,v){return Sa(void 0,void 0,void 0,function(){var y,k,E,O,D,x,L,R,N,q,Q,ee;return ka(this,function(P){switch(P.label){case 0:if(typeof((Q=navigator?.mediaDevices)===null||Q===void 0?void 0:Q.getUserMedia)>"u"||typeof((ee=navigator?.mediaDevices)===null||ee===void 0?void 0:ee.enumerateDevices)>"u")return v(Gt,"not-supported"),v(Ht,"not-supported"),[2];if(!a)return[2];P.label=1;case 1:return P.trys.push([1,4,,5]),[4,a.enumerateDevices()];case 2:return y=P.sent().devices,k=y.filter(function($){return $.kind==="videoinput"&&$.deviceId!==""}),E=y.filter(function($){return $.kind==="audioinput"&&$.deviceId!==""}),O=y.filter(function($){return $.kind==="audiooutput"&&$.deviceId!==""}),[4,a.getInputDevices()];case 3:return D=P.sent(),x=D.camera,L=D.mic,R=D.speaker,N=function(G,ae,ye){var Ce,Ve;return{device:ae,selected:"deviceId"in G&&ae.deviceId===G.deviceId,state:(Ve=(Ce=ye.find(function(S){return S.device.deviceId===ae.deviceId}))===null||Ce===void 0?void 0:Ce.state)!==null&&Ve!==void 0?Ve:"granted"}},q=function(G,ae){return G.device.deviceId==="default"?-1:ae.device.deviceId==="default"?1:G.device.label<ae.device.label?-1:G.device.label>ae.device.label?1:0},v(ju,function($){return k.filter(Boolean).map(function(G){return N(x,G,$)}).sort(q)}),v(Nu,function($){return E.filter(Boolean).map(function(G){return N(L,G,$)}).sort(q)}),v(Ly,function($){return O.filter(Boolean).map(function(G){return N(R,G,$)}).sort(q)}),[3,5];case 4:return P.sent(),v(Gt,"not-supported"),v(Ht,"not-supported"),[3,5];case 5:return[2]}})})},[a])),f=rt(V.useCallback(function(h,v){return Sa(void 0,void 0,void 0,function(){var y,k,E,O,D,x,L,R,N,q,Q,ee,P,$,G,ae,ye,Ce,Ve,S,ze,Ee,Y,De,it,we;return ka(this,function(he){switch(he.label){case 0:if(!a)return[2];if(y=h(Gt),k=h(Ht),E=a.participants(),!E.local)return[2];if(O=E.local.tracks,D="prompt",x="prompt",!navigator.permissions)return[3,5];he.label=1;case 1:return he.trys.push([1,4,,5]),[4,navigator.permissions.query({name:"camera"})];case 2:return L=he.sent(),D=L.state,[4,navigator.permissions.query({name:"microphone"})];case 3:return R=he.sent(),x=R.state,[3,5];case 4:return he.sent(),[3,5];case 5:return N=D==="prompt"&&["idle","pending"].includes(y)&&O.video.state==="interrupted"&&!O.video.persistentTrack,q=["idle","pending"].includes(y)&&!O.video.persistentTrack&&!!(!((P=O.video.off)===null||P===void 0)&&P.byUser),Q=x==="prompt"&&["idle","pending"].includes(k)&&O.audio.state==="interrupted"&&!O.audio.persistentTrack,ee=["idle","pending"].includes(k)&&!O.audio.persistentTrack&&!!(!(($=O.audio.off)===null||$===void 0)&&$.byUser),!((ae=(G=O.audio)===null||G===void 0?void 0:G.blocked)===null||ae===void 0)&&ae.byDeviceInUse?(v(Ht,"in-use"),v(Nu,function(ke){return ke.map(function(oe){return oe.selected?tt(tt({},oe),{state:"in-use"}):oe})})):!((Ce=(ye=O.audio)===null||ye===void 0?void 0:ye.blocked)===null||Ce===void 0)&&Ce.byDeviceMissing?v(Ht,"not-found"):!((S=(Ve=O.audio)===null||Ve===void 0?void 0:Ve.blocked)===null||S===void 0)&&S.byPermissions||x==="denied"?v(Ht,"blocked"):Q?v(Ht,"pending"):ee?v(Ht,"idle"):(v(Ht,"granted"),v(Nu,function(ke){return ke.map(function(oe){return oe.selected?tt(tt({},oe),{state:"granted"}):oe})})),!((Ee=(ze=O.video)===null||ze===void 0?void 0:ze.blocked)===null||Ee===void 0)&&Ee.byDeviceInUse?(v(Gt,"in-use"),v(ju,function(ke){return ke.map(function(oe){return oe.selected?tt(tt({},oe),{state:"in-use"}):oe})})):!((De=(Y=O.video)===null||Y===void 0?void 0:Y.blocked)===null||De===void 0)&&De.byDeviceMissing?v(Gt,"not-found"):!((we=(it=O.video)===null||it===void 0?void 0:it.blocked)===null||we===void 0)&&we.byPermissions||D==="denied"?v(Gt,"blocked"):N?v(Gt,"pending"):q?v(Gt,"idle"):(v(Gt,"granted"),v(ju,function(ke){return ke.map(function(oe){return oe.selected?tt(tt({},oe),{state:"granted"}):oe})})),l(),[2]}})})},[a,l]));return Qe("participant-updated",V.useCallback(function(h){h.participant.local&&f()},[f])),Qe("available-devices-updated",l),Qe("selected-devices-updated",l),Qe("camera-error",rt(V.useCallback(function(h,v,y){var k,E,O,D,x,L,R;switch(v(jy,y.error),(k=y.error)===null||k===void 0?void 0:k.type){case"cam-in-use":v(Gt,"in-use");break;case"mic-in-use":v(Ht,"in-use");break;case"cam-mic-in-use":v(Gt,"in-use"),v(Ht,"in-use");break;case"not-found":!((E=y.error)===null||E===void 0)&&E.missingMedia.includes("video")&&v(Gt,"not-found"),!((O=y.error)===null||O===void 0)&&O.missingMedia.includes("audio")&&v(Ht,"not-found");break;case"permissions":!((D=y.error)===null||D===void 0)&&D.blockedMedia.includes("video")&&v(Gt,"blocked"),!((x=y.error)===null||x===void 0)&&x.blockedMedia.includes("audio")&&v(Ht,"blocked");break;case"constraints":((L=y.error)===null||L===void 0?void 0:L.reason)==="invalid"?(v(Gt,"constraints-invalid"),v(Ht,"constraints-invalid")):((R=y.error)===null||R===void 0?void 0:R.reason)==="none-specified"&&(v(Gt,"constraints-none-specified"),v(Ht,"constraints-none-specified"));break;case"undefined-mediadevices":v(Gt,"undefined-mediadevices"),v(Ht,"undefined-mediadevices");break;case"unknown":default:v(Gt,"unknown"),v(Ht,"unknown");break}},[]))),Qe("started-camera",rt(V.useCallback(function(h,v){v(Gt,"granted"),v(Ht,"granted"),f()},[f]))),et.createElement(Uk.Provider,{value:{refreshDevices:l}},r)},Rc=st({errorMsg:void 0,isLiveStreaming:!1,layout:void 0});Rc.debugLabel=gt("live-streaming");var Fk=function(e){var r=e.children;return Qe("live-streaming-started",rt(V.useCallback(function(a,l,f){l(Rc,{isLiveStreaming:!0,layout:f?.layout})},[]))),Qe("live-streaming-stopped",rt(V.useCallback(function(a,l){l(Rc,function(f){return tt(tt({},f),{isLiveStreaming:!1,layout:void 0})})},[]))),Qe("live-streaming-error",rt(V.useCallback(function(a,l,f){l(Rc,function(h){return tt(tt({},h),{errorMsg:f.errorMsg})})},[]))),Qe("left-meeting",rt(V.useCallback(function(a,l){l(Rc,{errorMsg:void 0,isLiveStreaming:!1,layout:void 0})},[]))),et.createElement(et.Fragment,null,r)},Du=st("new");Du.debugLabel=gt("meeting-state");var Ih=st(null);Ih.debugLabel=gt("meeting-error");var xh=st(null);xh.debugLabel=gt("non-fatal-error");var Ac=st({data:void 0,topology:"none"});Ac.debugLabel=gt("meeting-session-data");var Vk=function(e){var r=e.children,a=Vi(),l=rt(V.useCallback(function(h,v){if(a){var y=a.meetingState();return v(Du,y),y}},[a]));Qe("loading",l),Qe("loaded",l),Qe("joining-meeting",l),Qe("joined-meeting",l),Qe("left-meeting",l),Qe("error",rt(V.useCallback(function(h,v,y){v(Ih,y),l()},[l]))),Qe("nonfatal-error",rt(V.useCallback(function(h,v,y){v(xh,y)},[])));var f=rt(V.useCallback(function(h,v){a&&v(Ac,a.meetingSessionState())},[a]));return Qe("joined-meeting",f),Qe("meeting-session-state-updated",rt(V.useCallback(function(h,v,y){v(Ac,y.meetingSessionState)},[]))),Qe("left-meeting",rt(V.useCallback(function(h,v){v(Ac,{data:void 0,topology:"none"})},[]))),Qe("call-instance-destroyed",rt(V.useCallback(function(h,v){v(Du,"new"),v(Ih,null),v(xh,null),v(Ac,{data:void 0,topology:"none"})},[]))),et.createElement(et.Fragment,null,r)},Ea=st("none");Ea.debugLabel=gt("topology");var Ny=st("unknown"),Dy=st([]),Lh=st(100);Lh.debugLabel=gt("network-quality");var jh=st("good");jh.debugLabel=gt("network-threshold");var zk=function(e){var r=e.children,a=Vi(),l=ao(Ea),f=rt(V.useCallback(function(h,v){return Sa(void 0,void 0,void 0,function(){var y;return ka(this,function(k){switch(k.label){case 0:return a?[4,a.getNetworkTopology()]:[2];case 1:return y=k.sent(),!y||y?.topology==="none"?[2]:(v(Ea,y.topology),[2])}})})},[a]));return Qe("joined-meeting",f),Qe("network-connection",rt(V.useCallback(function(h,v,y){switch(y.event){case"connected":y.type==="peer-to-peer"&&v(Ea,"peer"),y.type==="sfu"&&v(Ea,"sfu");break}},[]))),Qe("network-quality-change",rt(V.useCallback(function(h,v,y){v(Ny,function(k){return k!==y.networkState?y.networkState:k}),v(Dy,function(k){var E,O=(E=y.networkStateReasons)!==null&&E!==void 0?E:[];return Sh(k,O)?k:O}),v(Lh,function(k){return k!==y.quality?y.quality:k}),v(jh,function(k){return k!==y.threshold?y.threshold:k})},[]))),Qe("left-meeting",rt(V.useCallback(function(h,v){v(Ea,"none"),v(Ny,"unknown"),v(Dy,[]),v(Lh,100),v(jh,"good")},[]))),V.useEffect(function(){!a||l!=="none"||f()},[a,f,l]),et.createElement(et.Fragment,null,r)},Mo=st({isLocalParticipantRecorded:!1,isRecording:!1});Mo.debugLabel=gt("recording-state");var qk=function(e){var r=e.children,a=Iu(),l=Py({filter:"record"}),f=rt(V.useCallback(function(h,v,y,k){var E=h(Mo),O={isLocalParticipantRecorded:E.isLocalParticipantRecorded,isRecording:E.isRecording,local:E.local,type:E.type},D={isLocalParticipantRecorded:O?.type==="local"||!O?.type?y:O.isLocalParticipantRecorded,isRecording:O?.type==="local"||!O?.type?y:O.isRecording,local:(O?.type==="local"||!O?.type)&&y?k:O?.local,type:y?"local":E?.type};qr(O,D)||v(Mo,tt(tt({},O),D))},[]));return V.useEffect(function(){var h=l.length>0,v=l.includes(a||"local");f(h,v)},[a,f,l]),Qe("recording-started",rt(V.useCallback(function(h,v,y){var k,E=!0;switch(y.type){case"cloud-beta":case"cloud":{a&&((k=y.layout)===null||k===void 0?void 0:k.preset)==="single-participant"&&y.layout.session_id!==a&&(E=!1);break}}v(Mo,{error:!1,isLocalParticipantRecorded:E,isRecording:!0,layout:y?.layout,local:y?.local,recordingId:y?.recordingId,recordingStartedDate:new Date,startedBy:y?.startedBy,type:y?.type})},[a]))),Qe("recording-stopped",rt(V.useCallback(function(h,v){v(Mo,function(y){return tt(tt({},y),{isLocalParticipantRecorded:!1,isRecording:!1})})},[]))),Qe("recording-error",rt(V.useCallback(function(h,v){v(Mo,function(y){return tt(tt({},y),{error:!0,isLocalParticipantRecorded:!1,isRecording:!1})})},[]))),Qe("left-meeting",rt(V.useCallback(function(h,v){v(Mo,{isLocalParticipantRecorded:!1,isRecording:!1})},[]))),et.createElement(et.Fragment,null,r)},$k=function(){var e=ao(Du);return V.useDebugValue(e),e},Nh=st(null);Nh.debugLabel=gt("room-state");var Wk=function(e){var r=e.children,a=Vi(),l=$k(),f=rt(V.useCallback(function(h,v){return Sa(void 0,void 0,void 0,function(){var y;return ka(this,function(k){switch(k.label){case 0:return!a||l==="left-meeting"?[2]:[4,a.room()];case 1:return y=k.sent(),y&&"id"in y&&v(Nh,y),[2,y]}})})},[a,l]));return Qe("access-state-updated",f),Qe("left-meeting",rt(V.useCallback(function(h,v){return function(){v(Nh,null)}},[]))),et.createElement(et.Fragment,null,r)},Ma=st({isTranscribing:!1,model:"general",language:"en",transcriptions:[]});Ma.debugLabel=gt("transcription-state");var Gk=function(e){var r=e.children;return Qe("transcription-started",rt(V.useCallback(function(a,l,f){l(Ma,{error:!1,transcriptionStartDate:new Date,isTranscribing:!0,transcriptions:[],endpointing:f.endpointing,extra:f.extra,includeRawResponse:f.includeRawResponse,instanceId:f.instanceId,language:f.language,model:f.model,profanity_filter:f.profanity_filter,punctuate:f.punctuate,redact:f.redact,startedBy:f.startedBy,tier:f.tier})},[]))),Qe("transcription-stopped",rt(V.useCallback(function(a,l,f){l(Ma,function(h){return tt(tt({},h),{updatedBy:f.updatedBy,isTranscribing:!1})})},[]))),Qe("transcription-error",rt(V.useCallback(function(a,l){l(Ma,function(f){return tt(tt({},f),{error:!0,isTranscribing:!1})})},[]))),Qe("left-meeting",rt(V.useCallback(function(a,l){l(Ma,function(f){return tt(tt({},f),{isTranscribing:!1})})},[]))),Qe("app-message",rt(V.useCallback(function(a,l,f){f?.fromId==="transcription"&&l(Ma,function(h){return tt(tt({},h),{isTranscribing:!0,transcriptions:yn(yn([],wt(h.transcriptions),!1),[f.data],!1)})})},[]))),et.createElement(et.Fragment,null,r)},Uy={},By=function(){return!0},Hk={options:Uy,shouldCreateInstance:By},Jk=function(e,r){var a=r===void 0?Hk:r,l=a.parentElRef,f=a.options,h=f===void 0?Uy:f,v=a.shouldCreateInstance,y=v===void 0?By:v,k=wt(V.useState(null),2),E=k[0],O=k[1],D=V.useRef();return V.useEffect(function(){if(!y())return;function x(N){return Sa(this,void 0,void 0,function(){return ka(this,function(q){switch(q.label){case 0:return[4,N.destroy()];case 1:return q.sent(),[2]}})})}var L=function(){setTimeout(function(){return O(null)},0)},R=Mu.getCallInstance();if(!E&&R&&!R.isDestroyed()){R.once("call-instance-destroyed",L),O(R);return}if(E){qr(D.current,h)||x(E);return}if(!R||R.isDestroyed()){switch(e){case"callFrame":R=l?.current?Mu.createFrame(l.current,tt({},h)):Mu.createFrame(tt({},h));break;case"callObject":R=Mu.createCallObject(tt({},h));break}D.current=h}O(R),R.once("call-instance-destroyed",L)},[E,h,l,y,e]),E},Qk=function(e){return Jk("callObject",e)},Kk=function(e){var r=e.children,a=e.jotaiStore,l=yh(e,["children","jotaiStore"]),f=V.useRef({}),h=V.useCallback(function(L){var R,N,q,Q;if("action"in L){var ee=L.action,P=Array.from((Q=(q=f.current)===null||q===void 0?void 0:q[ee])!==null&&Q!==void 0?Q:[]),$=P.filter(function(ze){var Ee=wt(ze,1),Y=Ee[0];return Y<0}),G=P.filter(function(ze){var Ee=wt(ze,1),Y=Ee[0];return Y>0}),ae=yn(yn([],wt($),!1),wt(G),!1);try{for(var ye=by(ae),Ce=ye.next();!Ce.done;Ce=ye.next()){var Ve=wt(Ce.value,2),S=Ve[1];S(L)}}catch(ze){R={error:ze}}finally{try{Ce&&!Ce.done&&(N=ye.return)&&N.call(ye)}finally{if(R)throw R.error}}}},[]),v=V.useCallback(function(L){L&&Object.keys(f.current).forEach(function(R){L.off(R,h),L.isDestroyed()||L.on(R,h)})},[h]),y="callObject"in l?l.callObject:null,k=V.useMemo(function(){return"callObject"in l?{}:l},[l]),E=Qk({options:k,shouldCreateInstance:V.useCallback(function(){return!("callObject"in l)},[l])}),O=y??E;V.useEffect(function(){O&&v(O)},[O,v]);var D=V.useCallback(function(L,R,N){var q,Q;f.current[L]||(f.current[L]=new Map,O&&(O.off(L,h),O.isDestroyed()||O.on(L,h))),!((q=f.current[L])===null||q===void 0)&&q.has(N)||(Q=f.current[L])===null||Q===void 0||Q.set(N,R)},[O,h]),x=V.useCallback(function(L,R){var N,q;(N=f.current[L])===null||N===void 0||N.delete(R),((q=f.current[L])===null||q===void 0?void 0:q.size)===0&&(O?.off(L,h),delete f.current[L])},[O,h]);return et.createElement(Sw,{store:a},et.createElement(Sy.Provider,{value:O},et.createElement(_h.Provider,{value:{on:D,off:x}},et.createElement(Wk,null,et.createElement(Vk,null,et.createElement(zk,null,et.createElement(Pk,null,et.createElement(qk,null,et.createElement(Fk,null,et.createElement(Gk,null,et.createElement(Bk,null,r)))))))))))},Yk=st({state:"low",reason:"none"});Yk.debugLabel=gt("cpu-load");var Xk=st(null);Xk.debugLabel=gt("input-settings");var Zk=st({hidden:0,present:0});Zk.debugLabel=gt("participant-counts");var eC=mc(function(n){var e=st({},function(r,a,l){a(eC(n),l)});return e.debugLabel=gt("participant-receive-settings-".concat(n)),e}),tC=st(null);tC.debugLabel=gt("send-settings");/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nC=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),rC=n=>n.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,r,a)=>a?a.toUpperCase():r.toLowerCase()),Fy=n=>{const e=rC(n);return e.charAt(0).toUpperCase()+e.slice(1)},Vy=(...n)=>n.filter((e,r,a)=>!!e&&e.trim()!==""&&a.indexOf(e)===r).join(" ").trim(),iC=n=>{for(const e in n)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var sC={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oC=V.forwardRef(({color:n="currentColor",size:e=24,strokeWidth:r=2,absoluteStrokeWidth:a,className:l="",children:f,iconNode:h,...v},y)=>V.createElement("svg",{ref:y,...sC,width:e,height:e,stroke:n,strokeWidth:a?Number(r)*24/Number(e):r,className:Vy("lucide",l),...!f&&!iC(v)&&{"aria-hidden":"true"},...v},[...h.map(([k,E])=>V.createElement(k,E)),...Array.isArray(f)?f:[f]]));/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uu=(n,e)=>{const r=V.forwardRef(({className:a,...l},f)=>V.createElement(oC,{ref:f,iconNode:e,className:Vy(`lucide-${nC(Fy(n))}`,`lucide-${n}`,a),...l}));return r.displayName=Fy(n),r};/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aC=Uu("mic-off",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M15 9.34V5a3 3 0 0 0-5.68-1.33",key:"1gzdoj"}],["path",{d:"M16.95 16.95A7 7 0 0 1 5 12v-2",key:"cqa7eg"}],["path",{d:"M18.89 13.23A7 7 0 0 0 19 12v-2",key:"16hl24"}],["path",{d:"m2 2 20 20",key:"1ooewy"}],["path",{d:"M9 9v3a3 3 0 0 0 5.12 2.12",key:"r2i35w"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cC=Uu("mic",[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lC=Uu("video-off",[["path",{d:"M10.66 6H14a2 2 0 0 1 2 2v2.5l5.248-3.062A.5.5 0 0 1 22 7.87v8.196",key:"w8jjjt"}],["path",{d:"M16 16a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h2",key:"1xawa7"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.545.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uC=Uu("video",[["path",{d:"m16 13 5.223 3.482a.5.5 0 0 0 .777-.416V7.87a.5.5 0 0 0-.752-.432L16 10.5",key:"ftymec"}],["rect",{x:"2",y:"6",width:"14",height:"12",rx:"2",key:"158x01"}]]);function dC({currentFields:n,onJoined:e}){const[r,a]=V.useState(!1),[l,f]=V.useState(n.joined||!1),h=Vi(),v=!!n.dailyRoomId&&!n.sessionEndedAt;V.useEffect(()=>{if(v&&n.dailyRoomId&&h){const E=`https://n2o.daily.co/${n.dailyRoomId}`;console.log("Visitor: Joining room:",E),h.join({url:E,startVideoOff:!0,startAudioOff:!0})}else!v&&h&&h.leave()},[v,n.dailyRoomId,h]),V.useEffect(()=>{f(n.joined||!1)},[n.joined]);const y=async()=>{if(h)try{l?(h.setLocalAudio(!1),f(!1)):((await navigator.mediaDevices.getUserMedia({audio:!0})).getTracks().forEach(O=>O.stop()),h.setLocalAudio(!0),f(!0),e())}catch(E){console.error("Microphone permission denied:",E)}},k=async()=>{if(h)try{const E=!r;E&&(await navigator.mediaDevices.getUserMedia({video:!0})).getTracks().forEach(D=>D.stop()),h.setLocalVideo(E),a(E)}catch(E){console.error("Camera permission denied:",E)}};return v?Ue.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"12px"},children:Ue.jsx(fC,{isVideoEnabled:r,isMicEnabled:l,onToggleMic:y,onToggleVideo:k})}):null}function fC({isVideoEnabled:n,isMicEnabled:e,onToggleMic:r,onToggleVideo:a}){const l=V.useRef(null),f=V.useRef(null),h=V.useRef(null),v=Vi();return V.useEffect(()=>{if(!v)return;const y=O=>{O.participant.local?O.participant.videoTrack&&f.current&&(f.current.srcObject=new MediaStream([O.participant.videoTrack]),f.current.muted=!0,f.current.playsInline=!0,f.current.play().catch(()=>{})):(O.participant.videoTrack&&l.current&&(l.current.srcObject=new MediaStream([O.participant.videoTrack]),l.current.muted=!0,l.current.playsInline=!0,l.current.play().catch(()=>{})),O.participant.audioTrack&&h.current&&(h.current.srcObject=new MediaStream([O.participant.audioTrack]),h.current.play().catch(()=>{})))},k=O=>{O.participant.local&&O.track.kind==="video"&&f.current&&(f.current.srcObject=new MediaStream([O.track]),f.current.muted=!0,f.current.playsInline=!0,f.current.play().catch(()=>{})),!O.participant.local&&O.track.kind==="video"&&l.current&&(l.current.srcObject=new MediaStream([O.track]),l.current.muted=!0,l.current.playsInline=!0,l.current.play().catch(()=>{})),!O.participant.local&&O.track.kind==="audio"&&h.current&&(h.current.srcObject=new MediaStream([O.track]),h.current.play().catch(()=>{}))},E=O=>{O.participant.local&&O.track.kind==="video"&&f.current&&(f.current.srcObject=null),!O.participant.local&&O.track.kind==="video"&&l.current&&(l.current.srcObject=null),!O.participant.local&&O.track.kind==="audio"&&h.current&&(h.current.srcObject=null)};return v.on("participant-joined",y),v.on("track-started",k),v.on("track-stopped",E),()=>{v.off("participant-joined",y),v.off("track-started",k),v.off("track-stopped",E)}},[v]),Ue.jsxs("div",{style:{width:"300px",height:"200px",background:"hsl(var(--background))",borderRadius:"8px",border:"1px solid hsl(var(--border) / 0.3)",overflow:"hidden",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08)",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)",position:"relative"},children:[Ue.jsx("video",{ref:l,autoPlay:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}),Ue.jsx("audio",{ref:h,autoPlay:!0,controls:!1,style:{display:"none"}}),n&&Ue.jsx("video",{ref:f,autoPlay:!0,muted:!0,style:{position:"absolute",top:"10px",right:"10px",width:"80px",height:"60px",objectFit:"cover",borderRadius:"8px",border:"1px solid hsl(var(--border) / 0.3)",zIndex:10001}}),Ue.jsx(hC,{isVideoEnabled:n,isMicEnabled:e,onToggleMic:r,onToggleVideo:a})]})}function hC({isVideoEnabled:n,isMicEnabled:e,onToggleMic:r,onToggleVideo:a}){return Ue.jsxs("div",{style:{position:"absolute",bottom:"10px",left:"50%",transform:"translateX(-50%)",display:"flex",gap:"8px",zIndex:10},children:[Ue.jsx("button",{onClick:r,style:{width:"40px",height:"40px",borderRadius:"50%",border:"1px solid hsl(var(--border) / 0.3)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",backgroundColor:"hsl(var(--background))",color:e?"hsl(var(--foreground))":"hsl(var(--muted-foreground))",opacity:e?1:.6},onMouseEnter:l=>{l.currentTarget.style.transform="scale(1.1)"},onMouseLeave:l=>{l.currentTarget.style.transform="scale(1)"},children:e?Ue.jsx(cC,{size:16}):Ue.jsx(aC,{size:16})}),Ue.jsx("button",{onClick:a,style:{width:"40px",height:"40px",borderRadius:"50%",border:"1px solid hsl(var(--border) / 0.3)",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center",transition:"all 0.2s ease",backgroundColor:"hsl(var(--background))",color:n?"hsl(var(--foreground))":"hsl(var(--muted-foreground))",opacity:n?1:.6},onMouseEnter:l=>{l.currentTarget.style.transform="scale(1.1)"},onMouseLeave:l=>{l.currentTarget.style.transform="scale(1)"},children:n?Ue.jsx(uC,{size:16}):Ue.jsx(lC,{size:16})})]})}var Bu={exports:{}};/*@license Copyright 2015-2022 Ably Real-time Ltd (ably.com)

	Ably JavaScript Library v2.14.0
	https://github.com/ably/ably-js

	Released under the Apache Licence v2.0*/var pC=Bu.exports,zy;function gC(){return zy||(zy=1,(function(n,e){(function(r,a){n.exports=a()})(pC,()=>{var r={},a={exports:r},l=Object.defineProperty,f=Object.defineProperties,h=Object.getOwnPropertyDescriptor,v=Object.getOwnPropertyDescriptors,y=Object.getOwnPropertyNames,k=Object.getOwnPropertySymbols,E=Object.prototype.hasOwnProperty,O=Object.prototype.propertyIsEnumerable,D=(s,o,u)=>o in s?l(s,o,{enumerable:!0,configurable:!0,writable:!0,value:u}):s[o]=u,x=(s,o)=>{for(var u in o||(o={}))E.call(o,u)&&D(s,u,o[u]);if(k)for(var u of k(o))O.call(o,u)&&D(s,u,o[u]);return s},L=(s,o)=>f(s,v(o)),R=(s,o)=>{var u={};for(var p in s)E.call(s,p)&&o.indexOf(p)<0&&(u[p]=s[p]);if(s!=null&&k)for(var p of k(s))o.indexOf(p)<0&&O.call(s,p)&&(u[p]=s[p]);return u},N=(s,o)=>{for(var u in o)l(s,u,{get:o[u],enumerable:!0})},q=(s,o,u,p)=>{if(o&&typeof o=="object"||typeof o=="function")for(let _ of y(o))!E.call(s,_)&&_!==u&&l(s,_,{get:()=>o[_],enumerable:!(p=h(o,_))||p.enumerable});return s},Q=s=>q(l({},"__esModule",{value:!0}),s),ee={};N(ee,{ErrorInfo:()=>Y,Realtime:()=>ml,Rest:()=>al,default:()=>Ml,makeProtocolMessageFromDeserialized:()=>nl,msgpack:()=>sa}),a.exports=Q(ee);var P=class{},$=typeof cs<"u"?cs:typeof window<"u"?window:self;function G(s,o){return`${s}`.padStart(o?3:2,"0")}function ae(s){return P.Config.logTimestamps?function(o){const u=new Date;s(G(u.getHours())+":"+G(u.getMinutes())+":"+G(u.getSeconds())+"."+G(u.getMilliseconds(),1)+" "+o)}:function(o){s(o)}}var ye=()=>{var s;let o,u;return typeof((s=$?.console)==null?void 0:s.log)=="function"?(o=function(...p){console.log.apply(console,p)},u=console.warn?function(...p){console.warn.apply(console,p)}:o):o=u=function(){},[o,u].map(ae)},Ce=class Dl{constructor(){this.deprecated=(o,u)=>{this.deprecationWarning(`${o} is deprecated and will be removed in a future version. ${u}`)},this.shouldLog=o=>o<=this.logLevel,this.setLog=(o,u)=>{o!==void 0&&(this.logLevel=o),u!==void 0&&(this.logHandler=this.logErrorHandler=u)},this.logLevel=Dl.defaultLogLevel,this.logHandler=Dl.defaultLogHandler,this.logErrorHandler=Dl.defaultLogErrorHandler}static initLogHandlers(){const[o,u]=ye();this.defaultLogHandler=o,this.defaultLogErrorHandler=u,this.defaultLogger=new Dl}static logActionNoStrip(o,u,p,_){o.logAction(u,p,_)}logAction(o,u,p){this.shouldLog(o)&&(o===1?this.logErrorHandler:this.logHandler)("Ably: "+u+": "+p,o)}renamedClientOption(o,u){this.deprecationWarning(`The \`${o}\` client option has been renamed to \`${u}\`. Please update your code to use \`${u}\` instead. \`${o}\` will be removed in a future version.`)}renamedMethod(o,u,p){this.deprecationWarning(`\`${o}\`s \`${u}\` method has been renamed to \`${p}\`. Please update your code to use \`${p}\` instead. \`${u}\` will be removed in a future version.`)}deprecationWarning(o){this.shouldLog(1)&&this.logErrorHandler(`Ably: Deprecation warning - ${o}`,1)}};Ce.defaultLogLevel=1,Ce.LOG_NONE=0,Ce.LOG_ERROR=1,Ce.LOG_MAJOR=2,Ce.LOG_MINOR=3,Ce.LOG_MICRO=4,Ce.logAction=(s,o,u,p)=>{Ce.logActionNoStrip(s,o,u,p)};var Ve=Ce,S=Ve,ze={};N(ze,{Format:()=>xn,allSame:()=>wn,allToLowerCase:()=>Wr,allToUpperCase:()=>hi,arrChooseN:()=>qi,arrDeleteValue:()=>fe,arrEquals:()=>gi,arrIntersect:()=>H,arrIntersectOb:()=>ie,arrPopRandomElement:()=>mt,arrWithoutValue:()=>Me,cheapRandStr:()=>Jt,containsValue:()=>j,copy:()=>he,createMissingPluginError:()=>Or,dataSizeBytes:()=>Jn,decodeBody:()=>Dt,encodeBody:()=>cn,ensureArray:()=>ke,forInOwnNonNullProperties:()=>Vt,getBackoffCoefficient:()=>Ta,getGlobalObject:()=>xo,getJitterCoefficient:()=>Io,getRetryTime:()=>$i,inherits:()=>C,inspectBody:()=>Ln,inspectError:()=>Ze,intersect:()=>F,isEmpty:()=>J,isErrorInfoOrPartialErrorInfo:()=>zt,isNil:()=>le,isObject:()=>oe,keysArray:()=>qe,matchDerivedChannel:()=>pi,mixin:()=>we,parseQueryString:()=>en,prototypicalClone:()=>M,randomString:()=>Mr,shallowClone:()=>g,shallowEquals:()=>ws,throwMissingPluginError:()=>bt,toBase64:()=>Qn,toQueryString:()=>At,valuesArray:()=>Xe,whenPromiseSettles:()=>Nt,withTimeoutAsync:()=>jn});function Ee(s){let o="["+s.constructor.name;return s.message&&(o+=": "+s.message),s.statusCode&&(o+="; statusCode="+s.statusCode),s.code&&(o+="; code="+s.code),s.cause&&(o+="; cause="+Ze(s.cause)),s.href&&!(s.message&&s.message.indexOf("help.ably.io")>-1)&&(o+="; see "+s.href+" "),o+="]",o}var Y=class og extends Error{constructor(o,u,p,_){super(o),typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(this,og.prototype),this.code=u,this.statusCode=p,this.cause=_}toString(){return Ee(this)}static fromValues(o){const{message:u,code:p,statusCode:_}=o;if(typeof u!="string"||typeof p!="number"||typeof _!="number")throw new Error("ErrorInfo.fromValues(): invalid values: "+P.Config.inspect(o));const b=Object.assign(new og(u,p,_),o);return b.code&&!b.href&&(b.href="https://help.ably.io/error/"+b.code),b}},De=class ag extends Error{constructor(o,u,p,_){super(o),typeof Object.setPrototypeOf<"u"&&Object.setPrototypeOf(this,ag.prototype),this.code=u,this.statusCode=p,this.cause=_}toString(){return Ee(this)}static fromValues(o){const{message:u,code:p,statusCode:_}=o;if(typeof u!="string"||!le(p)&&typeof p!="number"||!le(_)&&typeof _!="number")throw new Error("PartialErrorInfo.fromValues(): invalid values: "+P.Config.inspect(o));const b=Object.assign(new ag(u,p,_),o);return b.code&&!b.href&&(b.href="https://help.ably.io/error/"+b.code),b}};function it(s){return Math.floor(Math.random()*s.length)}function we(s,...o){for(let u=0;u<o.length;u++){const p=o[u];if(!p)break;for(const _ in p)Object.prototype.hasOwnProperty.call(p,_)&&(s[_]=p[_])}return s}function he(s){return we({},s)}function ke(s){return le(s)?[]:Array.isArray(s)?s:[s]}function oe(s){return Object.prototype.toString.call(s)=="[object Object]"}function J(s){for(const o in s)return!1;return!0}function le(s){return s==null}function g(s){const o=new Object;for(const u in s)o[u]=s[u];return o}function M(s,o){class u{}u.prototype=s;const p=new u;return o&&we(p,o),p}var C=function(s,o){if(P.Config.inherits){P.Config.inherits(s,o);return}s.super_=o,s.prototype=M(o.prototype,{constructor:s})};function j(s,o){for(const u in s)if(s[u]==o)return!0;return!1}function F(s,o){return Array.isArray(o)?H(s,o):ie(s,o)}function H(s,o){const u=[];for(let p=0;p<s.length;p++){const _=s[p];o.indexOf(_)!=-1&&u.push(_)}return u}function ie(s,o){const u=[];for(let p=0;p<s.length;p++){const _=s[p];_ in o&&u.push(_)}return u}function fe(s,o){const u=s.indexOf(o),p=u!=-1;return p&&s.splice(u,1),p}function Me(s,o){const u=s.slice();return fe(u,o),u}function qe(s,o){const u=[];for(const p in s)o&&!Object.prototype.hasOwnProperty.call(s,p)||u.push(p);return u}function Xe(s,o){const u=[];for(const p in s)o&&!Object.prototype.hasOwnProperty.call(s,p)||u.push(s[p]);return u}function Vt(s,o){for(const u in s)Object.prototype.hasOwnProperty.call(s,u)&&s[u]&&o(u)}function wn(s,o){if(s.length===0)return!0;const u=s[0][o];return s.every(function(p){return p[o]===u})}var xn=(s=>(s.msgpack="msgpack",s.json="json",s))(xn||{});function mt(s){return s.splice(it(s),1)[0]}function At(s){const o=[];if(s)for(const u in s)o.push(encodeURIComponent(u)+"="+encodeURIComponent(s[u]));return o.length?"?"+o.join("&"):""}function en(s){let o;const u=/([^?&=]+)=?([^&]*)/g,p={};for(;o=u.exec(s);)p[decodeURIComponent(o[1])]=decodeURIComponent(o[2]);return p}function zt(s){return typeof s=="object"&&s!==null&&(s instanceof Y||s instanceof De)}function Ze(s){var o,u;return s instanceof Error||((o=s?.constructor)==null?void 0:o.name)==="ErrorInfo"||((u=s?.constructor)==null?void 0:u.name)==="PartialErrorInfo"?s.toString():P.Config.inspect(s)}function Ln(s){return P.BufferUtils.isBuffer(s)?s.toString():typeof s=="string"?s:P.Config.inspect(s)}function Jn(s){if(P.BufferUtils.isBuffer(s))return P.BufferUtils.byteLength(s);if(typeof s=="string")return P.Config.stringByteSize(s);if(typeof s=="number")return 8;if(typeof s=="boolean")return 1;throw new Error(`Expected input of Utils.dataSizeBytes to be a string, a number, a boolean or a buffer, but was: ${typeof s}`)}function Jt(){return String(Math.random()).substr(2)}var Mr=async s=>{const o=await P.Config.getRandomArrayBuffer(s);return P.BufferUtils.base64Encode(o)};function qi(s,o){const u=Math.min(o,s.length),p=s.slice(),_=[];for(let b=0;b<u;b++)_.push(mt(p));return _}function Nt(s,o){s.then(u=>{o?.(null,u)}).catch(u=>{o?.(u)})}function Dt(s,o,u){return u=="msgpack"?(o||bt("MsgPack"),o.decode(s)):JSON.parse(String(s))}function cn(s,o,u){return u=="msgpack"?(o||bt("MsgPack"),o.encode(s,!0)):JSON.stringify(s)}function Wr(s){return s.map(function(o){return o&&o.toLowerCase()})}function hi(s){return s.map(function(o){return o&&o.toUpperCase()})}function Ta(s){return Math.min((s+2)/3,2)}function Io(){return 1-Math.random()*.2}function $i(s,o){return s*Ta(o)*Io()}function xo(){return typeof cs<"u"?cs:typeof window<"u"?window:self}function ws(s,o){return Object.keys(s).every(u=>s[u]===o[u])&&Object.keys(o).every(u=>o[u]===s[u])}function pi(s){const o=/^(\[([^?]*)(?:(.*))\])?(.+)$/,u=s.match(o);if(!u||!u.length||u.length<5)throw new Y("regex match failed",400,40010);if(u[2])throw new Y(`cannot use a derived option with a ${u[2]} channel`,400,40010);return{qualifierParam:u[3]||"",channelName:u[4]}}function Qn(s){const o=P.BufferUtils,u=o.utf8Encode(s);return o.base64Encode(u)}function gi(s,o){return s.length===o.length&&s.every(function(u,p){return u===o[p]})}function Or(s){return new Y(`${s} plugin not provided`,40019,400)}function bt(s){throw Or(s)}async function jn(s,o=5e3,u="Timeout expired"){const p=new Y(u,5e4,500);return Promise.race([s,new Promise((_,b)=>setTimeout(()=>b(p),o))])}var Lo="2.14.0",Ra="ably-js/"+Lo,bn={ENDPOINT:"main",ENVIRONMENT:"",REST_HOST:"rest.ably.io",REALTIME_HOST:"realtime.ably.io",FALLBACK_HOSTS:["main.a.fallback.ably-realtime.com","main.b.fallback.ably-realtime.com","main.c.fallback.ably-realtime.com","main.d.fallback.ably-realtime.com","main.e.fallback.ably-realtime.com"],PORT:80,TLS_PORT:443,TIMEOUTS:{disconnectedRetryTimeout:15e3,suspendedRetryTimeout:3e4,httpRequestTimeout:1e4,httpMaxRetryDuration:15e3,channelRetryTimeout:15e3,fallbackRetryTimeout:6e5,connectionStateTtl:12e4,realtimeRequestTimeout:1e4,recvTimeout:9e4,webSocketConnectTimeout:1e4,webSocketSlowTimeout:4e3},httpMaxRetryCount:3,maxMessageSize:65536,version:Lo,protocolVersion:4,agent:Ra,getPort:Aa,getHttpScheme:Pa,getPrimaryDomainFromEndpoint:bs,getEndpointFallbackHosts:Sn,getFallbackHosts:mi,getHosts:Nc,checkHost:vi,objectifyOptions:jo,normaliseOptions:Uc,defaultGetHeaders:Ia,defaultPostHeaders:Bc};function Aa(s,o){return o||s.tls?s.tlsPort:s.port}function Pa(s){return s.tls?"https://":"http://"}function Wi(s){return s.includes(".")||s.includes("::")||s==="localhost"}function bs(s){return Wi(s)?s:s.startsWith("nonprod:")?`${s.replace("nonprod:","")}.realtime.ably-nonprod.net`:`${s}.realtime.ably.net`}function Sn(s){if(Wi(s))return[];if(s.startsWith("nonprod:")){const o=s.replace("nonprod:","");return Ss(o,"ably-realtime-nonprod.com")}return Ss(s,"ably-realtime.com")}function Ss(s,o){return["a","b","c","d","e"].map(u=>`${s}.${u}.fallback.${o}`)}function mi(s){const o=s.fallbackHosts,u=typeof s.httpMaxRetryCount<"u"?s.httpMaxRetryCount:bn.httpMaxRetryCount;return o?qi(o,u):[]}function Nc(s){return[s.primaryDomain].concat(mi(s))}function vi(s){if(typeof s!="string")throw new Y("host must be a string; was a "+typeof s,4e4,400);if(!s.length)throw new Y("host must not be zero-length",4e4,400)}function ks(s){const o={};for(const u in bn.TIMEOUTS)o[u]=s[u]||bn.TIMEOUTS[u];return o}function tn(s){let o=bn.agent;if(s.agents)for(var u in s.agents)o+=" "+u+"/"+s.agents[u];return o}function jo(s,o,u,p,_){if(s===void 0){const A=o?`${u} must be initialized with either a client options object, an Ably API key, or an Ably Token`:`${u} must be initialized with a client options object`;throw S.logAction(p,S.LOG_ERROR,`${u}()`,A),new Error(A)}let b;if(typeof s=="string")if(s.indexOf(":")==-1){if(!o){const A=`${u} cannot be initialized with just an Ably Token; you must provide a client options object with a \`plugins\` property. (Set this Ably Token as the objects \`token\` property.)`;throw S.logAction(p,S.LOG_ERROR,`${u}()`,A),new Error(A)}b={token:s}}else{if(!o){const A=`${u} cannot be initialized with just an Ably API key; you must provide a client options object with a \`plugins\` property. (Set this Ably API key as the objects \`key\` property.)`;throw S.logAction(p,S.LOG_ERROR,`${u}()`,A),new Error(A)}b={key:s}}else b=s;return _&&(b=L(x({},b),{plugins:x(x({},_),b.plugins)})),b}function Dc(s){if(s.endpoint&&(s.environment||s.restHost||s.realtimeHost))throw new Y("The `endpoint` option cannot be used in conjunction with the `environment`, `restHost`, or `realtimeHost` options.",40106,400);if(s.environment&&(s.restHost||s.realtimeHost))throw new Y("The `environment` option cannot be used in conjunction with the `restHost`, or `realtimeHost` options.",40106,400)}function Uc(s,o,u){const p=u??S.defaultLogger;s.environment&&p.deprecated("The `environment` client option","Use the `endpoint` client option instead."),s.restHost&&p.deprecated("The `restHost` client option","Use the `endpoint` client option instead."),s.realtimeHost&&p.deprecated("The `realtimeHost` client option","Use the `endpoint` client option instead."),Dc(s),typeof s.recover=="function"&&s.closeOnUnload===!0&&(S.logAction(p,S.LOG_ERROR,"Defaults.normaliseOptions","closeOnUnload was true and a session recovery function was set - these are mutually exclusive, so unsetting the latter"),s.recover=void 0),"closeOnUnload"in s||(s.closeOnUnload=!s.recover),"queueMessages"in s||(s.queueMessages=!0);const _=s.endpoint||bn.ENDPOINT;!s.fallbackHosts&&!s.restHost&&!s.realtimeHost&&!s.port&&!s.tlsPort&&(s.fallbackHosts=Sn(s.environment||_));const b=s.environment&&`${s.environment}.realtime.ably.net`,U=s.restHost||s.realtimeHost||b||bs(_);(s.fallbackHosts||[]).concat(U).forEach(vi),s.port=s.port||bn.PORT,s.tlsPort=s.tlsPort||bn.TLS_PORT,"tls"in s||(s.tls=!0);const X=ks(s);o?"useBinaryProtocol"in s?s.useBinaryProtocol=P.Config.supportsBinary&&s.useBinaryProtocol:s.useBinaryProtocol=P.Config.preferBinary:s.useBinaryProtocol=!1;const K={};s.clientId&&(K["X-Ably-ClientId"]=P.BufferUtils.base64Encode(P.BufferUtils.utf8Encode(s.clientId))),"idempotentRestPublishing"in s||(s.idempotentRestPublishing=!0);let de=null,ce=s.connectivityCheckUrl;if(s.connectivityCheckUrl){let[ue,Oe]=s.connectivityCheckUrl.split("?");de=Oe?en(Oe):{},ue.indexOf("://")===-1&&(ue="https://"+ue),ce=ue}let be=s.wsConnectivityCheckUrl;return be&&be.indexOf("://")===-1&&(be="wss://"+be),L(x({},s),{primaryDomain:U,maxMessageSize:s.maxMessageSize||bn.maxMessageSize,timeouts:X,connectivityCheckParams:de,connectivityCheckUrl:ce,wsConnectivityCheckUrl:be,headers:K})}function Cs(s,o,u){const p=u||{};if(p.cipher){s||bt("Crypto");const _=s.getCipher(p.cipher,o);p.cipher=_.cipherParams,p.channelCipher=_.cipher}else"cipher"in p&&(p.cipher=void 0,p.channelCipher=null);return p}var Tr={json:"application/json",xml:"application/xml",html:"text/html",msgpack:"application/x-msgpack",text:"text/plain"},Kn={format:"json",protocolVersion:bn.protocolVersion};function Ia(s,{format:o=Kn.format,protocolVersion:u=Kn.protocolVersion}={}){return{accept:Tr[o],"X-Ably-Version":u.toString(),"Ably-Agent":tn(s)}}function Bc(s,{format:o=Kn.format,protocolVersion:u=Kn.protocolVersion}={}){let p;return{accept:p=Tr[o],"content-type":p,"X-Ably-Version":u.toString(),"Ably-Agent":tn(s)}}var $e=bn;function xa(s){return Object.assign(bn,s)}var La=class N0{constructor(o,u){this.logger=o,this.members=u||[]}call(o,u){for(const p of this.members)if(p)try{p(o,u)}catch(_){S.logAction(this.logger,S.LOG_ERROR,"Multicaster multiple callback handler","Unexpected exception: "+_+"; stack = "+_.stack)}}push(...o){this.members.push(...o)}createPromise(){return new Promise((o,u)=>{this.push((p,_)=>{p?u(p):o(_)})})}resolveAll(o){this.call(null,o)}rejectAll(o){this.call(o)}static create(o,u){const p=new N0(o,u);return Object.assign((_,b)=>p.call(_,b),{push:_=>p.push(_),createPromise:()=>p.createPromise(),resolveAll:_=>p.resolveAll(_),rejectAll:_=>p.rejectAll(_)})}},hr=La,ja=(s=>(s.Get="get",s.Delete="delete",s.Post="post",s.Put="put",s.Patch="patch",s))(ja||{}),Ot=ja,Et=(s=>(s[s.Success=200]="Success",s[s.NoContent=204]="NoContent",s[s.BadRequest=400]="BadRequest",s[s.Unauthorized=401]="Unauthorized",s[s.Forbidden=403]="Forbidden",s[s.RequestTimeout=408]="RequestTimeout",s[s.InternalServerError=500]="InternalServerError",s))(Et||{});function Fc(s){return s>=200&&s<400}var yi=Et,Es=Math.pow(2,17);function Gi(){return("000000"+Math.floor(Math.random()*1e16)).slice(-16)}function Ms(s){return!!s.connection}function No(s){return zt(s)?(s.code||(s.statusCode===403?s.code=40300:(s.code=40170,s.statusCode=401)),s):new Y(Ze(s),s.code||40170,s.statusCode||401)}var _i=(s,o)=>{const u=P.BufferUtils,p=u.utf8Encode(s),_=u.utf8Encode(o),b=u.hmacSha256(p,_);return u.base64Encode(b)};function Nn(s){if(!s)return"";typeof s=="string"&&(s=JSON.parse(s));const o=Object.create(null),u=qe(s,!0);if(!u)return"";u.sort();for(let p=0;p<u.length;p++)o[u[p]]=s[u[p]].sort();return JSON.stringify(o)}function Na(s,o){if(s.authCallback)S.logAction(o,S.LOG_MINOR,"Auth()","using token auth with authCallback");else if(s.authUrl)S.logAction(o,S.LOG_MINOR,"Auth()","using token auth with authUrl");else if(s.key)S.logAction(o,S.LOG_MINOR,"Auth()","using token auth with client-side signing");else if(s.tokenDetails)S.logAction(o,S.LOG_MINOR,"Auth()","using token auth with supplied token only");else{const u="authOptions must include valid authentication parameters";throw S.logAction(o,S.LOG_ERROR,"Auth()",u),new Error(u)}}function Dn(s){return"useTokenAuth"in s&&!s.useTokenAuth}function Da(s){return s.useTokenAuth||!Dn(s)&&(s.authCallback||s.authUrl||s.token||s.tokenDetails)}function Vc(s){return!s.key&&!s.authCallback&&!s.authUrl}var zc=0;function wi(){return zc++}var Os=class{constructor(s,o){if(this.authOptions={},this.client=s,this.tokenParams=o.defaultTokenParams||{},this.currentTokenRequestId=null,this.waitingForTokenRequest=null,Da(o))Vc(o)&&S.logAction(this.logger,S.LOG_ERROR,"Auth()","Warning: library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),this._saveTokenOptions(o.defaultTokenParams,o),Na(this.authOptions,this.logger);else{if(!o.key){const u="No authentication options provided; need one of: key, authUrl, or authCallback (or for testing only, token or tokenDetails)";throw S.logAction(this.logger,S.LOG_ERROR,"Auth()",u),new Y(u,40160,401)}S.logAction(this.logger,S.LOG_MINOR,"Auth()","anonymous, using basic auth"),this._saveBasicOptions(o)}}get logger(){return this.client.logger}async authorize(s,o){if(o&&o.key&&this.authOptions.key!==o.key)throw new Y("Unable to update auth options with incompatible key",40102,401);try{let u=await this._forceNewToken(s??null,o??null);return Ms(this.client)?new Promise((p,_)=>{this.client.connection.connectionManager.onAuthUpdated(u,(b,A)=>b?_(b):p(A))}):u}catch(u){throw this.client.connection&&u.statusCode===yi.Forbidden&&this.client.connection.connectionManager.actOnErrorFromAuthorize(u),u}}async _forceNewToken(s,o){this.tokenDetails=null,this._saveTokenOptions(s,o),Na(this.authOptions,this.logger);try{return this._ensureValidAuthCredentials(!0)}finally{delete this.tokenParams.timestamp,delete this.authOptions.queryTime}}async requestToken(s,o){const u=o||this.authOptions,p=s||he(this.tokenParams);let _,b=this.client;if(u.authCallback)S.logAction(this.logger,S.LOG_MINOR,"Auth.requestToken()","using token auth with authCallback"),_=u.authCallback;else if(u.authUrl)S.logAction(this.logger,S.LOG_MINOR,"Auth.requestToken()","using token auth with authUrl"),_=(U,X)=>{const K=we({accept:"application/json, text/plain"},u.authHeaders),de=u.authMethod&&u.authMethod.toLowerCase()==="post";let ce;const be=u.authUrl.indexOf("?");be>-1&&(ce=en(u.authUrl.slice(be)),u.authUrl=u.authUrl.slice(0,be),de||(u.authParams=we(ce,u.authParams)));const ue=we({},u.authParams||{},U),Oe=Te=>{var Ne,lt;let ft=(Ne=Te.body)!=null?Ne:null,We=null;if(Te.error)S.logAction(this.logger,S.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received Error: "+Ze(Te.error));else{const $t=(lt=Te.headers["content-type"])!=null?lt:null;Array.isArray($t)?We=$t.join(", "):We=$t,S.logAction(this.logger,S.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Received; content-type: "+We+"; body: "+Ln(ft))}if(Te.error){X(Te.error,null);return}if(Te.unpacked){X(null,ft);return}if(P.BufferUtils.isBuffer(ft)&&(ft=ft.toString()),!We){X(new Y("authUrl response is missing a content-type header",40170,401),null);return}const Ge=We.indexOf("application/json")>-1,fn=We.indexOf("text/plain")>-1||We.indexOf("application/jwt")>-1;if(!Ge&&!fn){X(new Y("authUrl responded with unacceptable content-type "+We+", should be either text/plain, application/jwt or application/json",40170,401),null);return}if(Ge){if(ft.length>Es){X(new Y("authUrl response exceeded max permitted length",40170,401),null);return}try{ft=JSON.parse(ft)}catch($t){X(new Y("Unexpected error processing authURL response; err = "+$t.message,40170,401),null);return}}X(null,ft,We)};if(S.logAction(this.logger,S.LOG_MICRO,"Auth.requestToken().tokenRequestCallback","Requesting token from "+u.authUrl+"; Params: "+JSON.stringify(ue)+"; method: "+(de?"POST":"GET")),de){const Te=K||{};Te["content-type"]="application/x-www-form-urlencoded";const Ne=At(ue).slice(1);Nt(this.client.http.doUri(Ot.Post,u.authUrl,Te,Ne,ce),(lt,ft)=>Oe(lt||ft))}else Nt(this.client.http.doUri(Ot.Get,u.authUrl,K||{},null,ue),(Te,Ne)=>Oe(Te||Ne))};else if(u.key)S.logAction(this.logger,S.LOG_MINOR,"Auth.requestToken()","using token auth with client-side signing"),_=(U,X)=>{Nt(this.createTokenRequest(U,u),(K,de)=>X(K,de??null))};else{const U="Need a new token, but authOptions does not include any way to request one (no authUrl, authCallback, or key)";throw S.logAction(this.logger,S.LOG_ERROR,"Auth()","library initialized with a token literal without any way to renew the token when it expires (no authUrl, authCallback, or key). See https://help.ably.io/error/40171 for help"),new Y(U,40171,403)}"capability"in p&&(p.capability=Nn(p.capability));const A=(U,X)=>{const K=U.keyName,de="/keys/"+K+"/requestToken",ce=function(ue){return b.baseUri(ue)+de},be=$e.defaultPostHeaders(this.client.options);u.requestHeaders&&we(be,u.requestHeaders),S.logAction(this.logger,S.LOG_MICRO,"Auth.requestToken().requestToken","Sending POST to "+de+"; Token params: "+JSON.stringify(U)),Nt(this.client.http.do(Ot.Post,ce,be,JSON.stringify(U),null),(ue,Oe)=>ue?X(ue):X(Oe.error,Oe.body,Oe.unpacked))};return new Promise((U,X)=>{let K=!1,de=this.client.options.timeouts.realtimeRequestTimeout,ce=setTimeout(()=>{K=!0;const be="Token request callback timed out after "+de/1e3+" seconds";S.logAction(this.logger,S.LOG_ERROR,"Auth.requestToken()",be),X(new Y(be,40170,401))},de);_(p,(be,ue,Oe)=>{if(K)return;if(clearTimeout(ce),be){S.logAction(this.logger,S.LOG_ERROR,"Auth.requestToken()","token request signing call returned error; err = "+Ze(be)),X(No(be));return}if(typeof ue=="string"){ue.length===0?X(new Y("Token string is empty",40170,401)):ue.length>Es?X(new Y("Token string exceeded max permitted length (was "+ue.length+" bytes)",40170,401)):ue==="undefined"||ue==="null"?X(new Y("Token string was literal null/undefined",40170,401)):ue[0]==="{"&&!(Oe&&Oe.indexOf("application/jwt")>-1)?X(new Y("Token was double-encoded; make sure you're not JSON-encoding an already encoded token request or details",40170,401)):U({token:ue});return}if(typeof ue!="object"||ue===null){const Ne="Expected token request callback to call back with a token string or token request/details object, but got a "+typeof ue;S.logAction(this.logger,S.LOG_ERROR,"Auth.requestToken()",Ne),X(new Y(Ne,40170,401));return}const Te=JSON.stringify(ue).length;if(Te>Es&&!u.suppressMaxLengthCheck){X(new Y("Token request/details object exceeded max permitted stringified size (was "+Te+" bytes)",40170,401));return}if("issued"in ue){U(ue);return}if(!("keyName"in ue)){const Ne="Expected token request callback to call back with a token string, token request object, or token details object";S.logAction(this.logger,S.LOG_ERROR,"Auth.requestToken()",Ne),X(new Y(Ne,40170,401));return}A(ue,(Ne,lt,ft)=>{if(Ne){S.logAction(this.logger,S.LOG_ERROR,"Auth.requestToken()","token request API call returned error; err = "+Ze(Ne)),X(No(Ne));return}ft||(lt=JSON.parse(lt)),S.logAction(this.logger,S.LOG_MINOR,"Auth.getToken()","token received"),U(lt)})})})}async createTokenRequest(s,o){o=o||this.authOptions,s=s||he(this.tokenParams);const u=o.key;if(!u)throw new Y("No key specified",40101,403);const p=u.split(":"),_=p[0],b=p[1];if(!b)throw new Y("Invalid key specified",40101,403);if(s.clientId==="")throw new Y("clientId cant be an empty string",40012,400);"capability"in s&&(s.capability=Nn(s.capability));const A=we({keyName:_},s),U=s.clientId||"",X=s.ttl||"",K=s.capability||"";A.timestamp||(A.timestamp=await this._getTimestamp(o&&o.queryTime));const de=A.nonce||(A.nonce=Gi()),ce=A.timestamp,be=A.keyName+`
`+X+`
`+K+`
`+U+`
`+ce+`
`+de+`
`;return A.mac=A.mac||_i(be,b),S.logAction(this.logger,S.LOG_MINOR,"Auth.getTokenRequest()","generated signed request"),A}async getAuthParams(){if(this.method=="basic")return{key:this.key};{let s=await this._ensureValidAuthCredentials(!1);if(!s)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");return{access_token:s.token}}}async getAuthHeaders(){if(this.method=="basic")return{authorization:"Basic "+this.basicKey};{const s=await this._ensureValidAuthCredentials(!1);if(!s)throw new Error("Auth.getAuthParams(): _ensureValidAuthCredentials returned no error or tokenDetails");return{authorization:"Bearer "+Qn(s.token)}}}_saveBasicOptions(s){this.method="basic",this.key=s.key,this.basicKey=Qn(s.key),this.authOptions=s||{},"clientId"in s&&this._userSetClientId(s.clientId)}_saveTokenOptions(s,o){this.method="token",s&&(this.tokenParams=s),o&&(o.token&&(o.tokenDetails=typeof o.token=="string"?{token:o.token}:o.token),o.tokenDetails&&(this.tokenDetails=o.tokenDetails),"clientId"in o&&this._userSetClientId(o.clientId),this.authOptions=o)}async _ensureValidAuthCredentials(s){const o=this.tokenDetails;if(o){if(this._tokenClientIdMismatch(o.clientId))throw new Y("Mismatch between clientId in token ("+o.clientId+") and current clientId ("+this.clientId+")",40102,403);if(!this.client.isTimeOffsetSet()||!o.expires||o.expires>=this.client.getTimestampUsingOffset())return S.logAction(this.logger,S.LOG_MINOR,"Auth.getToken()","using cached token; expires = "+o.expires),o;S.logAction(this.logger,S.LOG_MINOR,"Auth.getToken()","deleting expired token"),this.tokenDetails=null}const u=(this.waitingForTokenRequest||(this.waitingForTokenRequest=hr.create(this.logger))).createPromise();if(this.currentTokenRequestId!==null&&!s)return u;const p=this.currentTokenRequestId=wi();let _,b=null;try{_=await this.requestToken(this.tokenParams,this.authOptions)}catch(U){b=U}if(this.currentTokenRequestId>p)return S.logAction(this.logger,S.LOG_MINOR,"Auth._ensureValidAuthCredentials()","Discarding token request response; overtaken by newer one"),u;this.currentTokenRequestId=null;const A=this.waitingForTokenRequest;return this.waitingForTokenRequest=null,b?(A?.rejectAll(b),u):(A?.resolveAll(this.tokenDetails=_),u)}_userSetClientId(s){if(typeof s=="string"||s===null){if(s==="*")throw new Y('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, instantiate the library with {defaultTokenParams: {clientId: "*"}}), or if calling authorize(), pass it in as a tokenParam: authorize({clientId: "*"}, authOptions)',40012,400);{const o=this._uncheckedSetClientId(s);if(o)throw o}}else throw new Y("clientId must be either a string or null",40012,400)}_uncheckedSetClientId(s){if(this._tokenClientIdMismatch(s)){const o="Unexpected clientId mismatch: client has "+this.clientId+", requested "+s,u=new Y(o,40102,401);return S.logAction(this.logger,S.LOG_ERROR,"Auth._uncheckedSetClientId()",o),u}else return this.clientId=this.tokenParams.clientId=s,null}_tokenClientIdMismatch(s){return!!(this.clientId&&this.clientId!=="*"&&s&&s!=="*"&&this.clientId!==s)}static isTokenErr(s){return s.code&&s.code>=40140&&s.code<40150}revokeTokens(s,o){return this.client.rest.revokeTokens(s,o)}async _getTimestamp(s){return this.client.getTimestamp(s||!!this.authOptions.queryTime)}},ln=Os;function bi(s){const o=[];if(s)for(const u in s)o.push(u+"="+s[u]);return o.join("&")}function Si(s,o){return s+(o?"?":"")+bi(o)}function qc(s,o,u,p,_){s.error?S.logActionNoStrip(_,S.LOG_MICRO,"Http."+o+"()","Received Error; "+Si(u,p)+"; Error: "+Ze(s.error)):S.logActionNoStrip(_,S.LOG_MICRO,"Http."+o+"()","Received; "+Si(u,p)+"; Headers: "+bi(s.headers)+"; StatusCode: "+s.statusCode+"; Body"+(P.BufferUtils.isBuffer(s.body)?" (Base64): "+P.BufferUtils.base64Encode(s.body):": "+s.body))}function Do(s,o,u,p,_){_.shouldLog(S.LOG_MICRO)&&S.logActionNoStrip(_,S.LOG_MICRO,"Http."+s+"()","Sending; "+Si(o,p)+"; Body"+(P.BufferUtils.isBuffer(u)?" (Base64): "+P.BufferUtils.base64Encode(u):": "+u))}var Ts=class{constructor(s){this.client=s,this.platformHttp=new P.Http(s),this.checkConnectivity=this.platformHttp.checkConnectivity?()=>this.platformHttp.checkConnectivity():void 0}get logger(){var s,o;return(o=(s=this.client)==null?void 0:s.logger)!=null?o:S.defaultLogger}get supportsAuthHeaders(){return this.platformHttp.supportsAuthHeaders}get supportsLinkHeaders(){return this.platformHttp.supportsLinkHeaders}_getHosts(s){const o=s.connection,u=o&&o.connectionManager.host;return u?[u].concat($e.getFallbackHosts(s.options)):$e.getHosts(s.options)}async do(s,o,u,p,_){try{const b=this.client;if(!b)return{error:new Y("http.do called without client",5e4,500)};const A=typeof o=="function"?o:function(ce){return b.baseUri(ce)+o},U=b._currentFallback;if(U)if(U.validUntil>Date.now()){const ce=await this.doUri(s,A(U.host),u,p,_);return ce.error&&this.platformHttp.shouldFallback(ce.error)?(b._currentFallback=null,this.do(s,o,u,p,_)):ce}else b._currentFallback=null;const X=this._getHosts(b);if(X.length===1)return this.doUri(s,A(X[0]),u,p,_);let K=null;const de=async(ce,be)=>{const ue=ce.shift();K=K??new Date;const Oe=await this.doUri(s,A(ue),u,p,_);return Oe.error&&this.platformHttp.shouldFallback(Oe.error)&&ce.length?Date.now()-K.getTime()>b.options.timeouts.httpMaxRetryDuration?{error:new Y(`Timeout for trying fallback hosts retries. Total elapsed time exceeded the ${b.options.timeouts.httpMaxRetryDuration}ms limit`,50003,500)}:de(ce,!0):(be&&(b._currentFallback={host:ue,validUntil:Date.now()+b.options.timeouts.fallbackRetryTimeout}),Oe)};return de(X)}catch(b){return{error:new Y(`Unexpected error in Http.do: ${Ze(b)}`,500,5e4)}}}async doUri(s,o,u,p,_){try{Do(s,o,p,_,this.logger);const b=await this.platformHttp.doUri(s,o,u,p,_);return this.logger.shouldLog(S.LOG_MICRO)&&qc(b,s,o,_,this.logger),b}catch(b){return{error:new Y(`Unexpected error in Http.doUri: ${Ze(b)}`,500,5e4)}}}};function Rs(s,o,u,p){try{u.apply(o,p)}catch(_){S.logAction(s,S.LOG_ERROR,"EventEmitter.emit()","Unexpected listener exception: "+_+"; stack = "+(_&&_.stack))}}function Gr(s,o,u){let p,_,b;for(let A=0;A<s.length;A++)if(p=s[A],u&&(p=p[u]),Array.isArray(p)){for(;(_=p.indexOf(o))!==-1;)p.splice(_,1);u&&p.length===0&&delete s[A][u]}else if(oe(p))for(b in p)Object.prototype.hasOwnProperty.call(p,b)&&Array.isArray(p[b])&&Gr([p],o,b)}var $c=class{constructor(s){this.logger=s,this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null)}on(...s){if(s.length===1){const o=s[0];if(typeof o=="function")this.any.push(o);else throw new Error("EventListener.on(): Invalid arguments: "+P.Config.inspect(s))}if(s.length===2){const[o,u]=s;if(typeof u!="function")throw new Error("EventListener.on(): Invalid arguments: "+P.Config.inspect(s));if(le(o))this.any.push(u);else if(Array.isArray(o))o.forEach(p=>{this.on(p,u)});else{if(typeof o!="string")throw new Error("EventListener.on(): Invalid arguments: "+P.Config.inspect(s));(this.events[o]||(this.events[o]=[])).push(u)}}}off(...s){if(s.length==0||le(s[0])&&le(s[1])){this.any=[],this.events=Object.create(null),this.anyOnce=[],this.eventsOnce=Object.create(null);return}const[o,u]=s;let p=null,_=null;if(s.length===1||!u)typeof o=="function"?p=o:_=o;else{if(typeof u!="function")throw new Error("EventEmitter.off(): invalid arguments:"+P.Config.inspect(s));[_,p]=[o,u]}if(p&&le(_)){Gr([this.any,this.events,this.anyOnce,this.eventsOnce],p);return}if(Array.isArray(_)){_.forEach(b=>{this.off(b,p)});return}if(typeof _!="string")throw new Error("EventEmitter.off(): invalid arguments:"+P.Config.inspect(s));p?Gr([this.events,this.eventsOnce],p,_):(delete this.events[_],delete this.eventsOnce[_])}listeners(s){if(s){const o=this.events[s]||[];return this.eventsOnce[s]&&Array.prototype.push.apply(o,this.eventsOnce[s]),o.length?o:null}return this.any.length?this.any:null}emit(s,...o){const u={event:s},p=[];this.anyOnce.length&&(Array.prototype.push.apply(p,this.anyOnce),this.anyOnce=[]),this.any.length&&Array.prototype.push.apply(p,this.any);const _=this.eventsOnce[s];_&&(Array.prototype.push.apply(p,_),delete this.eventsOnce[s]);const b=this.events[s];b&&Array.prototype.push.apply(p,b),p.forEach(A=>{Rs(this.logger,u,A,o)})}once(...s){const o=s.length;if(o===0||o===1&&typeof s[0]!="function"){const _=s[0];return new Promise(b=>{this.once(_,b)})}const[u,p]=s;if(s.length===1&&typeof u=="function")this.anyOnce.push(u);else if(le(u)){if(typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+P.Config.inspect(s));this.anyOnce.push(p)}else if(Array.isArray(u)){const _=this,b=function(){const A=Array.prototype.slice.call(arguments);if(u.forEach(function(U){_.off(U,b)}),typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+P.Config.inspect(s));p.apply(this,A)};u.forEach(function(A){_.on(A,b)})}else{if(typeof u!="string")throw new Error("EventEmitter.once(): Invalid arguments:"+P.Config.inspect(s));const _=this.eventsOnce[u]||(this.eventsOnce[u]=[]);if(p){if(typeof p!="function")throw new Error("EventEmitter.once(): Invalid arguments:"+P.Config.inspect(s));_.push(p)}}}async whenState(s,o){if(typeof s!="string"||typeof o!="string")throw new Error("whenState requires a valid state String argument");return s===o?null:this.once(s)}},St=$c,_e={HEARTBEAT:0,ACK:1,NACK:2,CONNECT:3,CONNECTED:4,DISCONNECT:5,DISCONNECTED:6,CLOSE:7,CLOSED:8,ERROR:9,ATTACH:10,ATTACHED:11,DETACH:12,DETACHED:13,PRESENCE:14,MESSAGE:15,SYNC:16,AUTH:17,ACTIVATE:18,OBJECT:19,OBJECT_SYNC:20,ANNOTATION:21},As=[];Object.keys(_e).forEach(function(s){As[_e[s]]=s});var Tt={HAS_PRESENCE:1,HAS_BACKLOG:2,RESUMED:4,TRANSIENT:16,ATTACH_RESUME:32,HAS_OBJECTS:128,PRESENCE:65536,PUBLISH:1<<17,SUBSCRIBE:1<<18,PRESENCE_SUBSCRIBE:1<<19,ANNOTATION_PUBLISH:1<<21,ANNOTATION_SUBSCRIBE:1<<22,OBJECT_SUBSCRIBE:1<<24,OBJECT_PUBLISH:1<<25},Uo=Object.keys(Tt);Tt.MODE_ALL=Tt.PRESENCE|Tt.PUBLISH|Tt.SUBSCRIBE|Tt.PRESENCE_SUBSCRIBE|Tt.ANNOTATION_PUBLISH|Tt.ANNOTATION_SUBSCRIBE|Tt.OBJECT_SUBSCRIBE|Tt.OBJECT_PUBLISH;var Bo=["PRESENCE","PUBLISH","SUBSCRIBE","PRESENCE_SUBSCRIBE","ANNOTATION_PUBLISH","ANNOTATION_SUBSCRIBE","OBJECT_SUBSCRIBE","OBJECT_PUBLISH"];function Ua(s){return!s||!s.channelOptions?{channelOptions:s,plugins:{},baseEncodedPreviousPayload:void 0}:s}function Fo(s,o,u){if(u&&u.cipher){s||bt("Crypto");const p=s.getCipher(u.cipher,o);return{cipher:p.cipherParams,channelCipher:p.cipher}}return u??{}}async function Vo(s,o){const{data:u,encoding:p}=await Hi(s.data,s.encoding,o);return s.data=u,s.encoding=p,s}async function Hi(s,o,u){let p=u.channelCipher,_=s,b=o?o+"/":"";P.BufferUtils.isBuffer(_)||(_=P.BufferUtils.utf8Encode(String(_)),b=b+"utf-8/");const A=await p.encrypt(_);return b=b+"cipher+"+p.algorithm,{data:A,encoding:b}}async function Un(s,o){const{data:u,encoding:p}=Qt(s.data,s.encoding);return s.data=u,s.encoding=p,o!=null&&o.cipher?Vo(s,o):s}function Qt(s,o){if(typeof s=="string"||P.BufferUtils.isBuffer(s)||s===null||s===void 0)return{data:s,encoding:o};if(oe(s)||Array.isArray(s))return{data:JSON.stringify(s),encoding:o?o+"/json":"json"};throw new Y("Data type is unsupported",40013,400)}async function Yn(s,o){const{data:u,encoding:p,error:_}=await Hr(s.data,s.encoding,o);if(s.data=u,s.encoding=p,_)throw _}async function Hr(s,o,u){const p=Ua(u);let _=s,b=s,A=o,U;if(o){const X=o.split("/");let K,de=X.length,ce="";try{for(;(K=de)>0;){const be=X[--de].match(/([-\w]+)(\+([\w-]+))?/);if(!be)break;switch(ce=be[1],ce){case"base64":b=P.BufferUtils.base64Decode(String(b)),K==X.length&&(_=b);continue;case"utf-8":b=P.BufferUtils.utf8Decode(b);continue;case"json":b=JSON.parse(b);continue;case"cipher":if(p.channelOptions!=null&&p.channelOptions.cipher&&p.channelOptions.channelCipher){const ue=be[3],Oe=p.channelOptions.channelCipher;if(ue!=Oe.algorithm)throw new Error("Unable to decrypt message with given cipher; incompatible cipher params");b=await Oe.decrypt(b);continue}else throw new Error("Unable to decrypt message; not an encrypted channel");case"vcdiff":if(!p.plugins||!p.plugins.vcdiff)throw new Y("Missing Vcdiff decoder (https://github.com/ably-forks/vcdiff-decoder)",40019,400);if(typeof Uint8Array>"u")throw new Y("Delta decoding not supported on this browser (need ArrayBuffer & Uint8Array)",40020,400);try{let ue=p.baseEncodedPreviousPayload;typeof ue=="string"&&(ue=P.BufferUtils.utf8Encode(ue));const Oe=P.BufferUtils.toBuffer(ue);b=P.BufferUtils.toBuffer(b),b=P.BufferUtils.arrayBufferViewToBuffer(p.plugins.vcdiff.decode(b,Oe)),_=b}catch(ue){throw new Y("Vcdiff delta decode failed with "+ue,40018,400)}continue;default:throw new Error("Unknown encoding")}}}catch(be){const ue=be;U=new Y(`Error processing the ${ce} encoding, decoder returned ${ue.message}`,ue.code||40013,400)}finally{A=K<=0?null:X.slice(0,K).join("/")}}return U?{error:U,data:b,encoding:A}:(p.baseEncodedPreviousPayload=_,{data:b,encoding:A})}function Jr(...s){const o=s.length>0?"json":"msgpack",{data:u,encoding:p}=Bn(this.data,this.encoding,o);return Object.assign({},this,{encoding:p,data:u})}function Bn(s,o,u){return!s||!P.BufferUtils.isBuffer(s)?{data:s,encoding:o}:u==="msgpack"?{data:P.BufferUtils.toBuffer(s),encoding:o}:{data:P.BufferUtils.base64Encode(s),encoding:o?o+"/base64":"base64"}}var Ji={encryptData:Hi,encodeData:Qt,encodeDataForWire:Bn,decodeData:Hr};function Qi(s){const{id:o,connectionId:u,timestamp:p}=s;let _;switch(s.action){case _e.MESSAGE:{_=s.messages;break}case _e.PRESENCE:case _e.SYNC:_=s.presence;break;case _e.ANNOTATION:_=s.annotations;break;case _e.OBJECT:case _e.OBJECT_SYNC:_=s.state;break;default:throw new Y("Unexpected action "+s.action,4e4,400)}for(let b=0;b<_.length;b++){const A=_[b];A.connectionId||(A.connectionId=u),A.timestamp||(A.timestamp=p),o&&!A.id&&(A.id=o+":"+b)}}function Xn(s,o){let u="["+o;for(const p in s)p==="data"?typeof s.data=="string"?u+="; data="+s.data:P.BufferUtils.isBuffer(s.data)?u+="; data (buffer)="+P.BufferUtils.base64Encode(s.data):typeof s.data<"u"&&(u+="; data (json)="+JSON.stringify(s.data)):p&&(p==="extras"||p==="operation")?u+="; "+p+"="+JSON.stringify(s[p]):p==="version"?u+="; version="+JSON.stringify(s[p]):p==="annotations"?u+="; annotations="+JSON.stringify(s[p]):s[p]!==void 0&&(u+="; "+p+"="+s[p]);return u+="]",u}var Qr=class{},zo=class{constructor(s){this.Platform=P,this.ErrorInfo=Y,this.Logger=S,this.Defaults=$e,this.Utils=ze,this.EventEmitter=St,this.MessageEncoding=Ji;var o,u,p,_,b,A,U,X,K,de;this._additionalHTTPRequestImplementations=(o=s.plugins)!=null?o:null,this.logger=new S,this.logger.setLog(s.logLevel,s.logHandler),S.logAction(this.logger,S.LOG_MICRO,"BaseClient()","initialized with clientOptions "+P.Config.inspect(s)),this._MsgPack=(p=(u=s.plugins)==null?void 0:u.MsgPack)!=null?p:null;const ce=this.options=$e.normaliseOptions(s,this._MsgPack,this.logger);if(ce.key){const be=ce.key.match(/^([^:\s]+):([^:.\s]+)$/);if(!be){const ue="invalid key parameter";throw S.logAction(this.logger,S.LOG_ERROR,"BaseClient()",ue),new Y(ue,40400,404)}ce.keyName=be[1],ce.keySecret=be[2]}if("clientId"in ce)if(typeof ce.clientId=="string"||ce.clientId===null){if(ce.clientId==="*")throw new Y('Cant use "*" as a clientId as that string is reserved. (To change the default token request behaviour to use a wildcard clientId, use {defaultTokenParams: {clientId: "*"}})',40012,400)}else throw new Y("clientId must be either a string or null",40012,400);S.logAction(this.logger,S.LOG_MINOR,"BaseClient()","started; version = "+$e.version),this._currentFallback=null,this.serverTimeOffset=null,this.http=new Ts(this),this.auth=new ln(this,ce),this._rest=(_=s.plugins)!=null&&_.Rest?new s.plugins.Rest(this):null,this._Crypto=(A=(b=s.plugins)==null?void 0:b.Crypto)!=null?A:null,this.__FilteredSubscriptions=(X=(U=s.plugins)==null?void 0:U.MessageInteractions)!=null?X:null,this._Annotations=(de=(K=s.plugins)==null?void 0:K.Annotations)!=null?de:null}get rest(){return this._rest||bt("Rest"),this._rest}get _FilteredSubscriptions(){return this.__FilteredSubscriptions||bt("MessageInteractions"),this.__FilteredSubscriptions}get channels(){return this.rest.channels}get push(){return this.rest.push}device(){var s;return(!((s=this.options.plugins)!=null&&s.Push)||!this.push.LocalDevice)&&bt("Push"),this._device||(this._device=this.push.LocalDevice.load(this)),this._device}baseUri(s){return $e.getHttpScheme(this.options)+s+":"+$e.getPort(this.options,!1)}async stats(s){return this.rest.stats(s)}async time(s){return this.rest.time(s)}async request(s,o,u,p,_,b){return this.rest.request(s,o,u,p,_,b)}batchPublish(s){return this.rest.batchPublish(s)}batchPresence(s){return this.rest.batchPresence(s)}setLog(s){this.logger.setLog(s.level,s.handler)}async getTimestamp(s){return!this.isTimeOffsetSet()&&s?this.time():this.getTimestampUsingOffset()}getTimestampUsingOffset(){return Date.now()+(this.serverTimeOffset||0)}isTimeOffsetSet(){return this.serverTimeOffset!==null}};zo.Platform=P;var Rr=zo,Ba=class fc{toJSON(){var o,u,p;return{id:this.id,deviceSecret:this.deviceSecret,platform:this.platform,formFactor:this.formFactor,clientId:this.clientId,metadata:this.metadata,deviceIdentityToken:this.deviceIdentityToken,push:{recipient:(o=this.push)==null?void 0:o.recipient,state:(u=this.push)==null?void 0:u.state,error:(p=this.push)==null?void 0:p.error}}}toString(){var o,u,p,_;let b="[DeviceDetails";return this.id&&(b+="; id="+this.id),this.platform&&(b+="; platform="+this.platform),this.formFactor&&(b+="; formFactor="+this.formFactor),this.clientId&&(b+="; clientId="+this.clientId),this.metadata&&(b+="; metadata="+this.metadata),this.deviceIdentityToken&&(b+="; deviceIdentityToken="+JSON.stringify(this.deviceIdentityToken)),(o=this.push)!=null&&o.recipient&&(b+="; push.recipient="+JSON.stringify(this.push.recipient)),(u=this.push)!=null&&u.state&&(b+="; push.state="+this.push.state),(p=this.push)!=null&&p.error&&(b+="; push.error="+JSON.stringify(this.push.error)),(_=this.push)!=null&&_.metadata&&(b+="; push.metadata="+this.push.metadata),b+="]",b}static toRequestBody(o,u,p){return cn(o,u,p)}static fromResponseBody(o,u,p){return p&&(o=Dt(o,u,p)),Array.isArray(o)?fc.fromValuesArray(o):fc.fromValues(o)}static fromValues(o){return o.error=o.error&&Y.fromValues(o.error),Object.assign(new fc,o)}static fromLocalDevice(o){return Object.assign(new fc,o)}static fromValuesArray(o){const u=o.length,p=new Array(u);for(let _=0;_<u;_++)p[_]=fc.fromValues(o[_]);return p}},Ar=Ba;async function ki(s,o,u,p){if(s.http.supportsAuthHeaders){const _=await s.auth.getAuthHeaders();return p(we(_,o),u)}else{const _=await s.auth.getAuthParams();return p(o,we(_,u))}}function Ki(s,o,u){if(s.err&&!s.body)return{err:s.err};if(s.statusCode===yi.NoContent)return L(x({},s),{body:[],unpacked:!0});let p=s.body;if(!s.unpacked)try{p=Dt(p,o,u)}catch(U){return zt(U)?{err:U}:{err:new De(Ze(U),null)}}if(!p)return{err:new De("unenvelope(): Response body is missing",null)};const{statusCode:_,response:b,headers:A}=p;if(_===void 0)return L(x({},s),{body:p,unpacked:!0});if(_<200||_>=300){let U=b&&b.error||s.err;return U||(U=new Error("Error in unenveloping "+p),U.statusCode=_),{err:U,body:b,headers:A,unpacked:!0,statusCode:_}}return{err:s.err,body:b,headers:A,unpacked:!0,statusCode:_}}function I(s,o,u,p,_){s.err?S.logAction(_,S.LOG_MICRO,"Resource."+o+"()","Received Error; "+Si(u,p)+"; Error: "+Ze(s.err)):S.logAction(_,S.LOG_MICRO,"Resource."+o+"()","Received; "+Si(u,p)+"; Headers: "+bi(s.headers)+"; StatusCode: "+s.statusCode+"; Body: "+(P.BufferUtils.isBuffer(s.body)?" (Base64): "+P.BufferUtils.base64Encode(s.body):": "+P.Config.inspect(s.body)))}var ne=class hc{static async get(o,u,p,_,b,A){return hc.do(Ot.Get,o,u,null,p,_,b,A??!1)}static async delete(o,u,p,_,b,A){return hc.do(Ot.Delete,o,u,null,p,_,b,A)}static async post(o,u,p,_,b,A,U){return hc.do(Ot.Post,o,u,p,_,b,A,U)}static async patch(o,u,p,_,b,A,U){return hc.do(Ot.Patch,o,u,p,_,b,A,U)}static async put(o,u,p,_,b,A,U){return hc.do(Ot.Put,o,u,p,_,b,A,U)}static async do(o,u,p,_,b,A,U,X){U&&((A=A||{}).envelope=U);const K=u.logger;async function de(be,ue){var Oe;if(K.shouldLog(S.LOG_MICRO)){let Ne=_;if(((Oe=be["content-type"])==null?void 0:Oe.indexOf("msgpack"))>0)try{u._MsgPack||bt("MsgPack"),Ne=u._MsgPack.decode(_)}catch(lt){S.logAction(K,S.LOG_MICRO,"Resource."+o+"()","Sending MsgPack Decoding Error: "+Ze(lt))}S.logAction(K,S.LOG_MICRO,"Resource."+o+"()","Sending; "+Si(p,ue)+"; Body: "+Ne)}const Te=await u.http.do(o,p,be,_,ue);return Te.error&&ln.isTokenErr(Te.error)?(await u.auth.authorize(null,null),ki(u,be,ue,de)):{err:Te.error,body:Te.body,headers:Te.headers,unpacked:Te.unpacked,statusCode:Te.statusCode}}let ce=await ki(u,b,A,de);if(U&&(ce=Ki(ce,u._MsgPack,U)),K.shouldLog(S.LOG_MICRO)&&I(ce,o,p,A,K),X){if(ce.err)throw ce.err;{const be=x({},ce);return delete be.err,be}}return ce}},se=ne;function Ie(s){const o=s.match(/^\.\/(\w+)\?(.*)$/);return o&&o[2]&&en(o[2])}function Pt(s){typeof s=="string"&&(s=s.split(","));const o={};for(let u=0;u<s.length;u++){const p=s[u].match(/^\s*<(.+)>;\s*rel="(\w+)"$/);if(p){const _=Ie(p[1]);_&&(o[p[2]]=_)}}return o}function Ut(s,o,u){return!(u&&(o||typeof s.code=="number"))}var Fn=class{constructor(s,o,u,p,_,b){this.client=s,this.path=o,this.headers=u,this.envelope=p??null,this.bodyHandler=_,this.useHttpPaginatedResponse=b||!1}get logger(){return this.client.logger}async get(s){const o=await se.get(this.client,this.path,this.headers,s,this.envelope,!1);return this.handlePage(o)}async delete(s){const o=await se.delete(this.client,this.path,this.headers,s,this.envelope,!1);return this.handlePage(o)}async post(s,o){const u=await se.post(this.client,this.path,o,this.headers,s,this.envelope,!1);return this.handlePage(u)}async put(s,o){const u=await se.put(this.client,this.path,o,this.headers,s,this.envelope,!1);return this.handlePage(u)}async patch(s,o){const u=await se.patch(this.client,this.path,o,this.headers,s,this.envelope,!1);return this.handlePage(u)}async handlePage(s){if(s.err&&Ut(s.err,s.body,this.useHttpPaginatedResponse))throw S.logAction(this.logger,S.LOG_ERROR,"PaginatedResource.handlePage()","Unexpected error getting resource: err = "+Ze(s.err)),s.err;let o,u,p;try{o=s.statusCode==yi.NoContent?[]:await this.bodyHandler(s.body,s.headers||{},s.unpacked)}catch(_){throw s.err||_}return s.headers&&(u=s.headers.Link||s.headers.link)&&(p=Pt(u)),this.useHttpPaginatedResponse?new pr(this,o,s.headers||{},s.statusCode,p,s.err):new qt(this,o,p)}},qt=class{constructor(s,o,u){this.resource=s,this.items=o,this._relParams=u}async first(){if(this.hasFirst())return this.get(this._relParams.first);throw new Y("No link to the first page of results",40400,404)}async current(){if(this.hasCurrent())return this.get(this._relParams.current);throw new Y("No link to the current page of results",40400,404)}async next(){return this.hasNext()?this.get(this._relParams.next):null}hasFirst(){return this._relParams!=null&&"first"in this._relParams}hasCurrent(){return this._relParams!=null&&"current"in this._relParams}hasNext(){return this._relParams!=null&&"next"in this._relParams}isLast(){return!this.hasNext()}async get(s){const o=this.resource,u=await se.get(o.client,o.path,o.headers,s,o.envelope,!1);return o.handlePage(u)}},pr=class extends qt{constructor(s,o,u,p,_,b){super(s,o,_),this.statusCode=p,this.success=p<300&&p>=200,this.headers=u,this.errorCode=b&&b.code,this.errorMessage=b&&b.message}toJSON(){return{items:this.items,statusCode:this.statusCode,success:this.success,headers:this.headers,errorCode:this.errorCode,errorMessage:this.errorMessage}}},Bt=Fn,Ci=class Ul{toJSON(){return{channel:this.channel,deviceId:this.deviceId,clientId:this.clientId}}toString(){let o="[PushChannelSubscription";return this.channel&&(o+="; channel="+this.channel),this.deviceId&&(o+="; deviceId="+this.deviceId),this.clientId&&(o+="; clientId="+this.clientId),o+="]",o}static fromResponseBody(o,u,p){return p&&(o=Dt(o,u,p)),Array.isArray(o)?Ul.fromValuesArray(o):Ul.fromValues(o)}static fromValues(o){return Object.assign(new Ul,o)}static fromValuesArray(o){const u=o.length,p=new Array(u);for(let _=0;_<u;_++)p[_]=Ul.fromValues(o[_]);return p}};Ci.toRequestBody=cn;var qo=Ci,Pr=qo,Ei=class{constructor(s){var o;this.client=s,this.admin=new Yi(s),P.Config.push&&((o=s.options.plugins)!=null&&o.Push)&&(this.stateMachine=new s.options.plugins.Push.ActivationStateMachine(s),this.LocalDevice=s.options.plugins.Push.localDeviceFactory(Ar))}async activate(s,o){await new Promise((u,p)=>{var _;if(!((_=this.client.options.plugins)!=null&&_.Push)){p(Or("Push"));return}if(!this.stateMachine){p(new Y("This platform is not supported as a target of push notifications",4e4,400));return}if(this.stateMachine.activatedCallback){p(new Y("Activation already in progress",4e4,400));return}this.stateMachine.activatedCallback=b=>{if(b){p(b);return}u()},this.stateMachine.updateFailedCallback=o,this.stateMachine.handleEvent(new this.client.options.plugins.Push.CalledActivate(this.stateMachine,s))})}async deactivate(s){await new Promise((o,u)=>{var p;if(!((p=this.client.options.plugins)!=null&&p.Push)){u(Or("Push"));return}if(!this.stateMachine){u(new Y("This platform is not supported as a target of push notifications",4e4,400));return}if(this.stateMachine.deactivatedCallback){u(new Y("Deactivation already in progress",4e4,400));return}this.stateMachine.deactivatedCallback=_=>{if(_){u(_);return}o()},this.stateMachine.handleEvent(new this.client.options.plugins.Push.CalledDeactivate(this.stateMachine,s))})}},Yi=class{constructor(s){this.client=s,this.deviceRegistrations=new Vn(s),this.channelSubscriptions=new Ps(s)}async publish(s,o){const u=this.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=$e.defaultPostHeaders(u.options,{format:p}),b={},A=we({recipient:s},o);we(_,u.options.headers),u.options.pushFullWait&&we(b,{fullWait:"true"});const U=cn(A,u._MsgPack,p);await se.post(u,"/push/publish",U,_,b,null,!0)}},Vn=class{constructor(s){this.client=s}async save(s){const o=this.client,u=Ar.fromValues(s),p=o.options.useBinaryProtocol?"msgpack":"json",_=$e.defaultPostHeaders(o.options,{format:p}),b={};we(_,o.options.headers),o.options.pushFullWait&&we(b,{fullWait:"true"});const A=cn(u,o._MsgPack,p),U=await se.put(o,"/push/deviceRegistrations/"+encodeURIComponent(s.id),A,_,b,null,!0);return Ar.fromResponseBody(U.body,o._MsgPack,U.unpacked?void 0:p)}async get(s){const o=this.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=$e.defaultGetHeaders(o.options,{format:u}),_=s.id||s;if(typeof _!="string"||!_.length)throw new Y("First argument to DeviceRegistrations#get must be a deviceId string or DeviceDetails",4e4,400);we(p,o.options.headers);const b=await se.get(o,"/push/deviceRegistrations/"+encodeURIComponent(_),p,{},null,!0);return Ar.fromResponseBody(b.body,o._MsgPack,b.unpacked?void 0:u)}async list(s){const o=this.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=this.client.http.supportsLinkHeaders?void 0:u,_=$e.defaultGetHeaders(o.options,{format:u});return we(_,o.options.headers),new Bt(o,"/push/deviceRegistrations",_,p,async function(b,A,U){return Ar.fromResponseBody(b,o._MsgPack,U?void 0:u)}).get(s)}async remove(s){const o=this.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=$e.defaultGetHeaders(o.options,{format:u}),_={},b=s.id||s;if(typeof b!="string"||!b.length)throw new Y("First argument to DeviceRegistrations#remove must be a deviceId string or DeviceDetails",4e4,400);we(p,o.options.headers),o.options.pushFullWait&&we(_,{fullWait:"true"}),await se.delete(o,"/push/deviceRegistrations/"+encodeURIComponent(b),p,_,null,!0)}async removeWhere(s){const o=this.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=$e.defaultGetHeaders(o.options,{format:u});we(p,o.options.headers),o.options.pushFullWait&&we(s,{fullWait:"true"}),await se.delete(o,"/push/deviceRegistrations",p,s,null,!0)}},Ps=class D0{constructor(o){this.remove=D0.prototype.removeWhere,this.client=o}async save(o){const u=this.client,p=Pr.fromValues(o),_=u.options.useBinaryProtocol?"msgpack":"json",b=$e.defaultPostHeaders(u.options,{format:_}),A={};we(b,u.options.headers),u.options.pushFullWait&&we(A,{fullWait:"true"});const U=cn(p,u._MsgPack,_),X=await se.post(u,"/push/channelSubscriptions",U,b,A,null,!0);return Pr.fromResponseBody(X.body,u._MsgPack,X.unpacked?void 0:_)}async list(o){const u=this.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=this.client.http.supportsLinkHeaders?void 0:p,b=$e.defaultGetHeaders(u.options,{format:p});return we(b,u.options.headers),new Bt(u,"/push/channelSubscriptions",b,_,async function(A,U,X){return Pr.fromResponseBody(A,u._MsgPack,X?void 0:p)}).get(o)}async removeWhere(o){const u=this.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=$e.defaultGetHeaders(u.options,{format:p});we(_,u.options.headers),u.options.pushFullWait&&we(o,{fullWait:"true"}),await se.delete(u,"/push/channelSubscriptions",_,o,null,!0)}async listChannels(o){const u=this.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=this.client.http.supportsLinkHeaders?void 0:p,b=$e.defaultGetHeaders(u.options,{format:p});return we(b,u.options.headers),u.options.pushFullWait&&we(o,{fullWait:"true"}),new Bt(u,"/push/channels",b,_,async function(A,U,X){const K=!X&&p?Dt(A,u._MsgPack,p):A;for(let de=0;de<K.length;de++)K[de]=String(K[de]);return K}).get(o)}},Wc=Ei,Is=["absent","present","enter","leave","update"];async function Yu(s,o,u,p){const _=Fo(o,s,p??null);return Ls.fromValues(u).decode(_,s)}async function Gc(s,o,u,p){return Promise.all(u.map(function(_){return Yu(s,o,_,p)}))}async function Hc(s,o){return Ls.fromValues(s).decode(o.channelOptions,o.logger)}async function xs(s,o){return Promise.all(s.map(function(u){return Hc(u,o)}))}var $o=class Bl extends Qr{isSynthesized(){return!this.id||!this.connectionId?!0:this.id.substring(this.connectionId.length,0)!==this.connectionId}parseId(){if(!this.id)throw new Error("parseId(): Presence message does not contain an id");const o=this.id.split(":");return{connectionId:o[0],msgSerial:parseInt(o[1],10),index:parseInt(o[2],10)}}async encode(o){const u=Object.assign(new Ls,this,{action:Is.indexOf(this.action||"present")});return Un(u,o)}static fromValues(o){return Object.assign(new Bl,o)}static fromValuesArray(o){return o.map(u=>Bl.fromValues(u))}static fromData(o){return o instanceof Bl?o:Bl.fromValues({data:o})}toString(){return Xn(this,"PresenceMessage")}},Ls=class cg extends Qr{toJSON(...o){return Jr.call(this,...o)}static fromValues(o){return Object.assign(new cg,o)}static fromValuesArray(o){return o.map(u=>cg.fromValues(u))}async decode(o,u){const p=Object.assign(new $o,L(x({},this),{action:Is[this.action]}));try{await Yn(p,o)}catch(_){S.logAction(u,S.LOG_ERROR,"WirePresenceMessage.decode()",Ze(_))}return p}toString(){return Xn(this,"WirePresenceMessage")}},Mi=$o,Kh=class{constructor(s){this.channel=s}get logger(){return this.channel.logger}async get(s){S.logAction(this.logger,S.LOG_MICRO,"RestPresence.get()","channel = "+this.channel.name);const o=this.channel.client,u=o.options.useBinaryProtocol?"msgpack":"json",p=this.channel.client.http.supportsLinkHeaders?void 0:u,_=$e.defaultGetHeaders(o.options,{format:u});return we(_,o.options.headers),new Bt(o,this.channel.client.rest.presenceMixin.basePath(this),_,p,async(b,A,U)=>{const X=U?b:Dt(b,o._MsgPack,u);return xs(X,this.channel)}).get(s)}async history(s){return S.logAction(this.logger,S.LOG_MICRO,"RestPresence.history()","channel = "+this.channel.name),this.channel.client.rest.presenceMixin.history(this,s)}},Yh=Kh,Fa=["message.create","message.update","message.delete","meta","message.summary"];function Xh(s){return Fa[s||0]||"unknown"}function Zh(s){let o=0;return s.name&&(o+=s.name.length),s.clientId&&(o+=s.clientId.length),s.extras&&(o+=JSON.stringify(s.extras).length),s.data&&(o+=Jn(s.data)),o}async function Xu(s,o,u,p){const _=Fo(o,s,p??null);return Xi.fromValues(u).decode(_,s)}async function ep(s,o,u,p){return Promise.all(u.map(function(_){return Xu(s,o,_,p)}))}async function tp(s,o){return Xi.fromValues(s).decode(o.channelOptions,o.logger)}async function Zu(s,o){return Promise.all(s.map(function(u){return tp(u,o)}))}async function ed(s,o){return Promise.all(s.map(u=>u.encode(o)))}var np=cn;function Jc(s){let o,u=0;for(let p=0;p<s.length;p++)o=s[p],u+=o.size||(o.size=Zh(o));return u}var td=class lg extends Qr{expandFields(){if(this.version||(this.version={}),!this.version.serial&&this.serial&&(this.version.serial=this.serial),!this.version.timestamp&&this.timestamp&&(this.version.timestamp=this.timestamp),this.annotations?this.annotations.summary||(this.annotations.summary={}):this.annotations={summary:{}},this.annotations&&this.annotations.summary)for(const[o,u]of Object.entries(this.annotations.summary))if(o.endsWith(":distinct.v1")||o.endsWith(":unique.v1")||o.endsWith(":multiple.v1"))for(const[,p]of Object.entries(u))p.clipped||(p.clipped=!1);else o.endsWith(":flag.v1")&&(u.clipped||(u.clipped=!1))}async encode(o){const u=Object.assign(new Xi,this,{action:Fa.indexOf(this.action||"message.create")});return Un(u,o)}static fromValues(o){return Object.assign(new lg,o)}static fromValuesArray(o){return o.map(u=>lg.fromValues(u))}toString(){return Xn(this,"Message")}},Xi=class ug extends Qr{toJSON(...o){return Jr.call(this,...o)}static fromValues(o){return Object.assign(new ug,o)}static fromValuesArray(o){return o.map(u=>ug.fromValues(u))}async decodeWithErr(o,u){const p=Object.assign(new td,L(x({},this),{action:Xh(this.action)}));let _;try{await Yn(p,o)}catch(b){S.logAction(u,S.LOG_ERROR,"WireMessage.decode()",Ze(b)),_=b}return p.expandFields(),{decoded:p,err:_}}async decode(o,u){const{decoded:p}=await this.decodeWithErr(o,u);return p}toString(){return Xn(this,"WireMessage")}},Oi=td,rp=9;function ip(s){return s.every(function(o){return!o.id})}var nd=class{constructor(s,o,u){this._annotations=null;var p,_;S.logAction(s.logger,S.LOG_MINOR,"RestChannel()","started; name = "+o),this.name=o,this.client=s,this.presence=new Yh(this),this.channelOptions=Cs((p=s._Crypto)!=null?p:null,this.logger,u),(_=s.options.plugins)!=null&&_.Push&&(this._push=new s.options.plugins.Push.PushChannel(this)),s._Annotations&&(this._annotations=new s._Annotations.RestAnnotations(this))}get annotations(){return this._annotations||bt("Annotations"),this._annotations}get push(){return this._push||bt("Push"),this._push}get logger(){return this.client.logger}setOptions(s){var o;this.channelOptions=Cs((o=this.client._Crypto)!=null?o:null,this.logger,s)}async history(s){return S.logAction(this.logger,S.LOG_MICRO,"RestChannel.history()","channel = "+this.name),this.client.rest.channelMixin.history(this,s)}async publish(...s){const o=s[0],u=s[1];let p,_;if(typeof o=="string"||o===null)p=[Oi.fromValues({name:o,data:u})],_=s[2];else if(oe(o))p=[Oi.fromValues(o)],_=s[1];else if(Array.isArray(o))p=Oi.fromValuesArray(o),_=s[1];else throw new Y("The single-argument form of publish() expects a message object or an array of message objects",40013,400);_||(_={});const b=this.client,A=b.options,U=A.useBinaryProtocol?"msgpack":"json",X=b.options.idempotentRestPublishing,K=$e.defaultPostHeaders(b.options,{format:U});if(we(K,A.headers),X&&ip(p)){const ue=await Mr(rp);p.forEach(function(Oe,Te){Oe.id=ue+":"+Te.toString()})}const de=await ed(p,this.channelOptions),ce=Jc(de),be=A.maxMessageSize;if(ce>be)throw new Y(`Maximum size of messages that can be published at once exceeded (was ${ce} bytes; limit is ${be} bytes)`,40009,400);await this._publish(np(de,b._MsgPack,U),K,_)}async _publish(s,o,u){await se.post(this.client,this.client.rest.channelMixin.basePath(this)+"/messages",s,o,u,null,!0)}async status(){return this.client.rest.channelMixin.status(this)}},sp=nd,op=class U0{constructor(o){this.entries=o&&o.entries||void 0,this.schema=o&&o.schema||void 0,this.appId=o&&o.appId||void 0,this.inProgress=o&&o.inProgress||void 0,this.unit=o&&o.unit||void 0,this.intervalId=o&&o.intervalId||void 0}static fromValues(o){return new U0(o)}},ap=op,rd=class{static basePath(s){return"/channels/"+encodeURIComponent(s.name)}static history(s,o){const u=s.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=s.client.http.supportsLinkHeaders?void 0:p,b=$e.defaultGetHeaders(u.options,{format:p});return we(b,u.options.headers),new Bt(u,this.basePath(s)+"/messages",b,_,async function(A,U,X){const K=X?A:Dt(A,u._MsgPack,p);return Zu(K,s)}).get(o)}static async status(s){const o=s.client.options.useBinaryProtocol?"msgpack":"json",u=$e.defaultPostHeaders(s.client.options,{format:o});return(await se.get(s.client,this.basePath(s),u,{},o,!0)).body}},cp=class{static basePath(s){return rd.basePath(s.channel)+"/presence"}static async history(s,o){const u=s.channel.client,p=u.options.useBinaryProtocol?"msgpack":"json",_=s.channel.client.http.supportsLinkHeaders?void 0:p,b=$e.defaultGetHeaders(u.options,{format:p});return we(b,u.options.headers),new Bt(u,this.basePath(s)+"/history",b,_,async(A,U,X)=>{const K=X?A:Dt(A,u._MsgPack,p);return xs(K,s.channel)}).get(o)}},id=class{constructor(s){this.channelMixin=rd,this.presenceMixin=cp,this.Resource=se,this.PaginatedResource=Bt,this.DeviceDetails=Ar,this.PushChannelSubscription=Pr,this.client=s,this.channels=new lp(this.client),this.push=new Wc(this.client)}async stats(s){const o=$e.defaultGetHeaders(this.client.options),u=this.client.options.useBinaryProtocol?"msgpack":"json",p=this.client.http.supportsLinkHeaders?void 0:u;return we(o,this.client.options.headers),new Bt(this.client,"/stats",o,p,function(_,b,A){const U=A?_:JSON.parse(_);for(let X=0;X<U.length;X++)U[X]=ap.fromValues(U[X]);return U}).get(s)}async time(s){const o=$e.defaultGetHeaders(this.client.options);this.client.options.headers&&we(o,this.client.options.headers);const u=U=>this.client.baseUri(U)+"/time";let{error:p,body:_,unpacked:b}=await this.client.http.do(Ot.Get,u,o,null,s);if(p)throw p;b||(_=JSON.parse(_));const A=_[0];if(!A)throw new Y("Internal error (unexpected result type from GET /time)",5e4,500);return this.client.serverTimeOffset=A-Date.now(),A}async request(s,o,u,p,_,b){var A;const[U,X,K]=this.client.options.useBinaryProtocol?(this.client._MsgPack||bt("MsgPack"),[this.client._MsgPack.encode,this.client._MsgPack.decode,"msgpack"]):[JSON.stringify,JSON.parse,"json"],de=this.client.http.supportsLinkHeaders?void 0:K;p=p||{};const ce=s.toLowerCase(),be=ce=="get"?$e.defaultGetHeaders(this.client.options,{format:K,protocolVersion:u}):$e.defaultPostHeaders(this.client.options,{format:K,protocolVersion:u});typeof _!="string"&&(_=(A=U(_))!=null?A:null),we(be,this.client.options.headers),b&&we(be,b);const ue=new Bt(this.client,o,be,de,async function(Oe,Te,Ne){return ke(Ne?Oe:X(Oe))},!0);if(!P.Http.methods.includes(ce))throw new Y("Unsupported method "+ce,40500,405);return P.Http.methodsWithBody.includes(ce)?ue[ce](p,_):ue[ce](p)}async batchPublish(s){let o,u;Array.isArray(s)?(o=s,u=!1):(o=[s],u=!0);const p=this.client.options.useBinaryProtocol?"msgpack":"json",_=$e.defaultPostHeaders(this.client.options,{format:p});this.client.options.headers&&we(_,this.client.options.headers);const b=cn(o,this.client._MsgPack,p),A=await se.post(this.client,"/messages",b,_,{},null,!0),U=A.unpacked?A.body:Dt(A.body,this.client._MsgPack,p);return u?U[0]:U}async batchPresence(s){const o=this.client.options.useBinaryProtocol?"msgpack":"json",u=$e.defaultPostHeaders(this.client.options,{format:o});this.client.options.headers&&we(u,this.client.options.headers);const p=s.join(","),_=await se.get(this.client,"/presence",u,{channels:p},null,!0);return _.unpacked?_.body:Dt(_.body,this.client._MsgPack,o)}async revokeTokens(s,o){if(Da(this.client.options))throw new Y("Cannot revoke tokens when using token auth",40162,401);const u=this.client.options.keyName;let p=o??{};const _=x({targets:s.map(K=>`${K.type}:${K.value}`)},p),b=this.client.options.useBinaryProtocol?"msgpack":"json",A=$e.defaultPostHeaders(this.client.options,{format:b});this.client.options.headers&&we(A,this.client.options.headers);const U=cn(_,this.client._MsgPack,b),X=await se.post(this.client,`/keys/${u}/revokeTokens`,U,A,{},null,!0);return X.unpacked?X.body:Dt(X.body,this.client._MsgPack,b)}},lp=class{constructor(s){this.client=s,this.all=Object.create(null)}get(s,o){s=String(s);let u=this.all[s];return u?o&&u.setOptions(o):this.all[s]=u=new sp(this.client,s,o),u}release(s){delete this.all[String(s)]}},Qc=class extends Rr{constructor(s){super($e.objectifyOptions(s,!1,"BaseRest",S.defaultLogger,{Rest:id}))}},js={Rest:id},sd=class extends Oi{static async fromEncoded(s,o){return Xu(S.defaultLogger,P.Crypto,s,o)}static async fromEncodedArray(s,o){return ep(S.defaultLogger,P.Crypto,s,o)}static fromValues(s){return Oi.fromValues(s)}},Kc=class extends Mi{static async fromEncoded(s,o){return Yu(S.defaultLogger,P.Crypto,s,o)}static async fromEncodedArray(s,o){return Gc(S.defaultLogger,P.Crypto,s,o)}static fromValues(s){return Mi.fromValues(s)}},Yc=["annotation.create","annotation.delete"];async function Xc(s,o,u){return Ds.fromValues(o).decode(u||{},s)}async function od(s,o,u){return Promise.all(o.map(function(p){return Xc(s,p,u)}))}async function ad(s,o){return Ds.fromValues(s).decode(o.channelOptions,o.logger)}async function Ns(s,o){return Promise.all(s.map(function(u){return ad(u,o)}))}var cd=class dg extends Qr{async encode(){const o=Object.assign(new Ds,this,{action:Yc.indexOf(this.action||"annotation.create")});return Un(o,{})}static fromValues(o){return Object.assign(new dg,o)}static fromValuesArray(o){return o.map(u=>dg.fromValues(u))}toString(){return Xn(this,"Annotation")}},Ds=class fg extends Qr{toJSON(...o){return Jr.call(this,...o)}static fromValues(o){return Object.assign(new fg,o)}static fromValuesArray(o){return o.map(u=>fg.fromValues(u))}async decode(o,u){const p=Object.assign(new cd,L(x({},this),{action:Yc[this.action]}));try{await Yn(p,o)}catch(_){S.logAction(u,S.LOG_ERROR,"WireAnnotation.decode()",Ze(_))}return p}toString(){return Xn(this,"WireAnnotation")}},Wo=cd,Zc=class extends Wo{static async fromEncoded(s,o){return Xc(S.defaultLogger,s,o)}static async fromEncodedArray(s,o){return od(S.defaultLogger,s,o)}static fromValues(s){return Wo.fromValues(s)}};function el(s){let o;switch(typeof s){case"string":o=s;break;case"object":o=s.serial;break}if(!o||typeof o!="string")throw new Y("First argument of annotations.publish() must be either a Message (or at least an object with a string `serial` property) or a message serial (string)",40003,400);return o}function Us(s,o){const u=el(s);if(!o||typeof o!="object")throw new Y("Second argument of annotations.publish() must be an object (the intended annotation to publish)",40003,400);const p=Wo.fromValues(o);return p.messageSerial=u,p.action||(p.action="annotation.create"),p}function Bs(s,o){return s.client.rest.channelMixin.basePath(s)+"/messages/"+encodeURIComponent(o)+"/annotations"}var up=class{constructor(s){this.channel=s}async publish(s,o){const u=Us(s,o),p=await u.encode(),_=this.channel.client,b=_.options,A=b.useBinaryProtocol?"msgpack":"json",U=$e.defaultPostHeaders(_.options,{format:A}),X={};we(U,_.options.headers);const K=cn([p],_._MsgPack,A);await se.post(_,Bs(this.channel,u.messageSerial),K,U,X,null,!0)}async delete(s,o){return o.action="annotation.delete",this.publish(s,o)}async get(s,o){const u=this.channel.client,p=el(s),_=u.options.useBinaryProtocol?"msgpack":"json",b=u.http.supportsLinkHeaders?void 0:_,A=$e.defaultGetHeaders(u.options,{format:_});return we(A,u.options.headers),new Bt(u,Bs(this.channel,p),A,b,async(U,X,K)=>{const de=K?U:Dt(U,u._MsgPack,_);return Ns(de,this.channel)}).get(o)}},Fs=up,dp=cn;function Go(s){const o=[];if(s)for(let u=0;u<s.length;u++)o.push(s[u].toString());return"[ "+o.join(", ")+" ]"}function tl(s,o,u,p,_,b){const A=Dt(s,o,b);return Ho(A,u,p,_)}function Ho(s,o,u,p){let _;s.error&&(_=Y.fromValues(s.error));let b;s.messages&&(b=Xi.fromValuesArray(s.messages));let A;o&&s.presence&&(A=o.WirePresenceMessage.fromValuesArray(s.presence));let U;u&&s.annotations&&(U=u.WireAnnotation.fromValuesArray(s.annotations));let X;return p&&s.state&&(X=p.WireObjectMessage.fromValuesArray(s.state,ze,Ji)),Object.assign(new rl,L(x({},s),{presence:A,messages:b,annotations:U,state:X,error:_}))}function nl(s){return o=>{var u;return Ho(o,{WirePresenceMessage:Ls},{WireAnnotation:Ds},(u=s?.ObjectsPlugin)!=null?u:null)}}function kn(s){return Object.assign(new rl,s)}function Va(s,o,u,p){let _="[ProtocolMessage";s.action!==void 0&&(_+="; action="+As[s.action]||s.action);const b=["id","channel","channelSerial","connectionId","count","msgSerial","timestamp"];let A;for(let U=0;U<b.length;U++)A=b[U],s[A]!==void 0&&(_+="; "+A+"="+s[A]);if(s.messages&&(_+="; messages="+Go(Xi.fromValuesArray(s.messages))),s.presence&&o&&(_+="; presence="+Go(o.WirePresenceMessage.fromValuesArray(s.presence))),s.annotations&&u&&(_+="; annotations="+Go(u.WireAnnotation.fromValuesArray(s.annotations))),s.state&&p&&(_+="; state="+Go(p.WireObjectMessage.fromValuesArray(s.state,ze,Ji))),s.error&&(_+="; error="+Y.fromValues(s.error).toString()),s.auth&&s.auth.accessToken&&(_+="; token="+s.auth.accessToken),s.flags&&(_+="; flags="+Uo.filter(s.hasFlag).join(",")),s.params){let U="";Vt(s.params,function(X){U.length>0&&(U+="; "),U+=X+"="+s.params[X]}),U.length>0&&(_+="; params=["+U+"]")}return _+="]",_}var rl=class{constructor(){this.hasFlag=s=>(this.flags&Tt[s])>0}setFlag(s){return this.flags=this.flags|Tt[s]}getMode(){return(this.flags||0)&Tt.MODE_ALL}encodeModesToFlags(s){s.forEach(o=>this.setFlag(o))}decodeModesFromFlags(){const s=[];return Bo.forEach(o=>{this.hasFlag(o)&&s.push(o)}),s.length>0?s:void 0}},fp=rl,hp=class{constructor(s,o,u,p,_){this.previous=s,this.current=o,o==="attached"&&(this.resumed=u,this.hasBacklog=p),_&&(this.reason=_)}},il=hp,ld=function(){};function gr(s){if(s&&"params"in s&&!oe(s.params))return new Y("options.params must be an object",4e4,400);if(s&&"modes"in s){if(!Array.isArray(s.modes))return new Y("options.modes must be an array",4e4,400);for(let o=0;o<s.modes.length;o++){const u=s.modes[o];if(!u||typeof u!="string"||!Bo.includes(String.prototype.toUpperCase.call(u)))return new Y("Invalid channel mode: "+u,4e4,400)}}}var Jo=class hg extends St{constructor(o,u,p){var _,b,A;super(o.logger),this._annotations=null,this._mode=0,this.retryCount=0,this.history=async function(U){S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.history()","channel = "+this.name);const X=this.client.rest.channelMixin;if(U&&U.untilAttach){if(this.state!=="attached")throw new Y("option untilAttach requires the channel to be attached",4e4,400);if(!this.properties.attachSerial)throw new Y("untilAttach was specified and channel is attached, but attachSerial is not defined",4e4,400);delete U.untilAttach,U.from_serial=this.properties.attachSerial}return X.history(this,U)},this.whenState=U=>St.prototype.whenState.call(this,U,this.state),S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel()","started; name = "+u),this.name=u,this.channelOptions=Cs((_=o._Crypto)!=null?_:null,this.logger,p),this.client=o,this._presence=o._RealtimePresence?new o._RealtimePresence.RealtimePresence(this):null,o._Annotations&&(this._annotations=new o._Annotations.RealtimeAnnotations(this)),this.connectionManager=o.connection.connectionManager,this.state="initialized",this.subscriptions=new St(this.logger),this.syncChannelSerial=void 0,this.properties={attachSerial:void 0,channelSerial:void 0},this.setOptions(p),this.errorReason=null,this._attachResume=!1,this._decodingContext={channelOptions:this.channelOptions,plugins:o.options.plugins||{},baseEncodedPreviousPayload:void 0},this._lastPayload={messageId:null,protocolMessageChannelSerial:null,decodeFailureRecoveryInProgress:null},this._allChannelChanges=new St(this.logger),(b=o.options.plugins)!=null&&b.Push&&(this._push=new o.options.plugins.Push.PushChannel(this)),(A=o.options.plugins)!=null&&A.Objects&&(this._objects=new o.options.plugins.Objects.Objects(this))}get presence(){return this._presence||bt("RealtimePresence"),this._presence}get annotations(){return this._annotations||bt("Annotations"),this._annotations}get push(){return this._push||bt("Push"),this._push}get objects(){return this._objects||bt("Objects"),this._objects}invalidStateError(){return new Y("Channel operation failed as channel state is "+this.state,90001,400,this.errorReason||void 0)}static processListenerArgs(o){return o=Array.prototype.slice.call(o),typeof o[0]=="function"&&o.unshift(null),o}async setOptions(o){var u;const p=this.channelOptions,_=gr(o);if(_)throw _;if(this.channelOptions=Cs((u=this.client._Crypto)!=null?u:null,this.logger,o),this._decodingContext&&(this._decodingContext.channelOptions=this.channelOptions),this._shouldReattachToSetOptions(o,p))return this.attachImpl(),new Promise((b,A)=>{this._allChannelChanges.once(["attached","update","detached","failed"],function(U){switch(this.event){case"update":case"attached":b();break;default:A(U.reason)}})})}_shouldReattachToSetOptions(o,u){if(!(this.state==="attached"||this.state==="attaching"))return!1;if(o?.params){const p=sl(o.params),_=sl(u.params);if(Object.keys(p).length!==Object.keys(_).length||!ws(_,p))return!0}return!!(o?.modes&&(!u.modes||!gi(o.modes,u.modes)))}async publish(...o){let u;if(o.length==1)if(oe(o[0]))u=[Oi.fromValues(o[0])];else if(Array.isArray(o[0]))u=Oi.fromValuesArray(o[0]);else throw new Y("The single-argument form of publish() expects a message object or an array of message objects",40013,400);else u=[Oi.fromValues({name:o[0],data:o[1]})];const _=this.client.options.maxMessageSize,b=await ed(u,this.channelOptions),A=Jc(b);if(A>_)throw new Y(`Maximum size of messages that can be published at once exceeded (was ${A} bytes; limit is ${_} bytes)`,40009,400);this.throwIfUnpublishableState(),S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.publish()","sending message; channel state is "+this.state+", message count = "+b.length);const U=kn({action:_e.MESSAGE,channel:this.name,messages:b});return this.sendMessage(U)}throwIfUnpublishableState(){if(!this.connectionManager.activeState())throw this.connectionManager.getError();if(this.state==="failed"||this.state==="suspended")throw this.invalidStateError()}onEvent(o){S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.onEvent()","received message");const u=this.subscriptions;for(let p=0;p<o.length;p++){const _=o[p];u.emit(_.name,_)}}async attach(){return this.state==="attached"?null:new Promise((o,u)=>{this._attach(!1,null,(p,_)=>p?u(p):o(_))})}_attach(o,u,p){p||(p=b=>{b&&S.logAction(this.logger,S.LOG_ERROR,"RealtimeChannel._attach()","Channel attach failed: "+b.toString())});const _=this.connectionManager;if(!_.activeState()){p(_.getError());return}(this.state!=="attaching"||o)&&this.requestState("attaching",u),this.once(function(b){switch(this.event){case"attached":p?.(null,b);break;case"detached":case"suspended":case"failed":p?.(b.reason||_.getError()||new Y("Unable to attach; reason unknown; state = "+this.event,9e4,500));break;case"detaching":p?.(new Y("Attach request superseded by a subsequent detach request",9e4,409));break}})}attachImpl(){S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.attachImpl()","sending ATTACH message");const o=kn({action:_e.ATTACH,channel:this.name,params:this.channelOptions.params,channelSerial:this.properties.channelSerial});this.channelOptions.modes&&o.encodeModesToFlags(hi(this.channelOptions.modes)),this._attachResume&&o.setFlag("ATTACH_RESUME"),this._lastPayload.decodeFailureRecoveryInProgress&&(o.channelSerial=this._lastPayload.protocolMessageChannelSerial),this.sendMessage(o).catch(ld)}async detach(){const o=this.connectionManager;if(!o.activeState())throw o.getError();switch(this.state){case"suspended":this.notifyState("detached");return;case"detached":return;case"failed":throw new Y("Unable to detach; channel state = failed",90001,400);default:this.requestState("detaching");case"detaching":return new Promise((u,p)=>{this.once(function(_){switch(this.event){case"detached":u();break;case"attached":case"suspended":case"failed":p(_.reason||o.getError()||new Y("Unable to detach; reason unknown; state = "+this.event,9e4,500));break;case"attaching":p(new Y("Detach request superseded by a subsequent attach request",9e4,409));break}})})}}detachImpl(){S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.detach()","sending DETACH message");const o=kn({action:_e.DETACH,channel:this.name});this.sendMessage(o).catch(ld)}async subscribe(...o){const[u,p]=hg.processListenerArgs(o);if(this.state==="failed")throw Y.fromValues(this.invalidStateError());return u&&typeof u=="object"&&!Array.isArray(u)?this.client._FilteredSubscriptions.subscribeFilter(this,u,p):this.subscriptions.on(u,p),this.channelOptions.attachOnSubscribe!==!1?this.attach():null}unsubscribe(...o){var u;const[p,_]=hg.processListenerArgs(o);if(typeof p=="object"&&!_||(u=this.filteredSubscriptions)!=null&&u.has(_)){this.client._FilteredSubscriptions.getAndDeleteFilteredSubscriptions(this,p,_).forEach(b=>this.subscriptions.off(b));return}this.subscriptions.off(p,_)}sync(){switch(this.state){case"initialized":case"detaching":case"detached":throw new De("Unable to sync to channel; not attached",4e4)}const o=this.connectionManager;if(!o.activeState())throw o.getError();const u=kn({action:_e.SYNC,channel:this.name});this.syncChannelSerial&&(u.channelSerial=this.syncChannelSerial),o.send(u)}async sendMessage(o){return new Promise((u,p)=>{this.connectionManager.send(o,this.client.options.queueMessages,_=>{_?p(_):u()})})}async sendPresence(o){const u=kn({action:_e.PRESENCE,channel:this.name,presence:o});return this.sendMessage(u)}sendState(o){const u=kn({action:_e.OBJECT,channel:this.name,state:o});return this.sendMessage(u)}async processMessage(o){(o.action===_e.ATTACHED||o.action===_e.MESSAGE||o.action===_e.PRESENCE||o.action===_e.OBJECT||o.action===_e.ANNOTATION)&&this.setChannelSerial(o.channelSerial);let u,p=!1;switch(o.action){case _e.ATTACHED:{this.properties.attachSerial=o.channelSerial,this._mode=o.getMode(),this.params=o.params||{};const _=o.decodeModesFromFlags();this.modes=_&&Wr(_)||void 0;const b=o.hasFlag("RESUMED"),A=o.hasFlag("HAS_PRESENCE"),U=o.hasFlag("HAS_BACKLOG"),X=o.hasFlag("HAS_OBJECTS");if(this.state==="attached"){b||(this._presence&&this._presence.onAttached(A),this._objects&&this._objects.onAttached(X));const K=new il(this.state,this.state,b,U,o.error);this._allChannelChanges.emit("update",K),(!b||this.channelOptions.updateOnAttached)&&this.emit("update",K)}else this.state==="detaching"?this.checkPendingState():this.notifyState("attached",o.error,b,A,U,X);break}case _e.DETACHED:{const _=o.error?Y.fromValues(o.error):new Y("Channel detached",90001,404);this.state==="detaching"?this.notifyState("detached",_):this.state==="attaching"?this.notifyState("suspended",_):(this.state==="attached"||this.state==="suspended")&&this.requestState("attaching",_);break}case _e.SYNC:if(p=!0,u=this.syncChannelSerial=o.channelSerial,!o.presence)break;case _e.PRESENCE:{if(!o.presence)break;Qi(o);const _=this.channelOptions;if(this._presence){const b=await Promise.all(o.presence.map(A=>A.decode(_,this.logger)));this._presence.setPresence(b,p,u)}break}case _e.OBJECT:case _e.OBJECT_SYNC:{if(!this._objects||!o.state)return;Qi(o);const _=this.client.connection.connectionManager.getActiveTransportFormat(),b=o.state.map(A=>A.decode(this.client,_));o.action===_e.OBJECT?this._objects.handleObjectMessages(b):this._objects.handleObjectSyncMessages(b,o.channelSerial);break}case _e.MESSAGE:{if(this.state!=="attached"){S.logAction(this.logger,S.LOG_MAJOR,"RealtimeChannel.processMessage()",'Message "'+o.id+'" skipped as this channel "'+this.name+'" state is not "attached" (state is "'+this.state+'").');return}Qi(o);const _=o.messages,b=_[0],A=_[_.length-1];if(b.extras&&b.extras.delta&&b.extras.delta.from!==this._lastPayload.messageId){const X='Delta message decode failure - previous message not available for message "'+o.id+'" on this channel "'+this.name+'".';S.logAction(this.logger,S.LOG_ERROR,"RealtimeChannel.processMessage()",X),this._startDecodeFailureRecovery(new Y(X,40018,400));break}let U=[];for(let X=0;X<_.length;X++){const{decoded:K,err:de}=await _[X].decodeWithErr(this._decodingContext,this.logger);if(U[X]=K,de)switch(de.code){case 40018:this._startDecodeFailureRecovery(de);return;case 40019:case 40021:this.notifyState("failed",de);return}}this._lastPayload.messageId=A.id,this._lastPayload.protocolMessageChannelSerial=o.channelSerial,this.onEvent(U);break}case _e.ANNOTATION:{Qi(o);const _=this.channelOptions;if(this._annotations){const b=await Promise.all((o.annotations||[]).map(A=>A.decode(_,this.logger)));this._annotations._processIncoming(b)}break}case _e.ERROR:{const _=o.error;_&&_.code==80016?this.checkPendingState():this.notifyState("failed",Y.fromValues(_));break}default:S.logAction(this.logger,S.LOG_MAJOR,"RealtimeChannel.processMessage()","Protocol error: unrecognised message action ("+o.action+")")}}_startDecodeFailureRecovery(o){this._lastPayload.decodeFailureRecoveryInProgress||(S.logAction(this.logger,S.LOG_MAJOR,"RealtimeChannel.processMessage()","Starting decode failure recovery process."),this._lastPayload.decodeFailureRecoveryInProgress=!0,this._attach(!0,o,()=>{this._lastPayload.decodeFailureRecoveryInProgress=!1}))}onAttached(){S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel.onAttached","activating channel; name = "+this.name)}notifyState(o,u,p,_,b,A){if(S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.notifyState","name = "+this.name+", current state = "+this.state+", notifying state "+o),this.clearStateTimer(),["detached","suspended","failed"].includes(o)&&(this.properties.channelSerial=null),o===this.state)return;this._presence&&this._presence.actOnChannelState(o,_,u),this._objects&&this._objects.actOnChannelState(o,A),o==="suspended"&&this.connectionManager.state.sendEvents?this.startRetryTimer():this.cancelRetryTimer(),u&&(this.errorReason=u);const U=new il(this.state,o,p,b,u),X='Channel state for channel "'+this.name+'"',K=o+(u?"; reason: "+u:"");o==="failed"?S.logAction(this.logger,S.LOG_ERROR,X,K):S.logAction(this.logger,S.LOG_MAJOR,X,K),o!=="attaching"&&o!=="suspended"&&(this.retryCount=0),o==="attached"&&this.onAttached(),o==="attached"?this._attachResume=!0:(o==="detaching"||o==="failed")&&(this._attachResume=!1),this.state=o,this._allChannelChanges.emit(o,U),this.emit(o,U)}requestState(o,u){S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel.requestState","name = "+this.name+", state = "+o),this.notifyState(o,u),this.checkPendingState()}checkPendingState(){if(!this.connectionManager.state.sendEvents){S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel.checkPendingState","sendEvents is false; state is "+this.connectionManager.state.state);return}switch(S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel.checkPendingState","name = "+this.name+", state = "+this.state),this.state){case"attaching":this.startStateTimerIfNotRunning(),this.attachImpl();break;case"detaching":this.startStateTimerIfNotRunning(),this.detachImpl();break;case"attached":this.sync();break}}timeoutPendingState(){switch(this.state){case"attaching":{const o=new Y("Channel attach timed out",90007,408);this.notifyState("suspended",o);break}case"detaching":{const o=new Y("Channel detach timed out",90007,408);this.notifyState("attached",o);break}default:this.checkPendingState();break}}startStateTimerIfNotRunning(){this.stateTimer||(this.stateTimer=setTimeout(()=>{S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel.startStateTimerIfNotRunning","timer expired"),this.stateTimer=null,this.timeoutPendingState()},this.client.options.timeouts.realtimeRequestTimeout))}clearStateTimer(){const o=this.stateTimer;o&&(clearTimeout(o),this.stateTimer=null)}startRetryTimer(){if(this.retryTimer)return;this.retryCount++;const o=$i(this.client.options.timeouts.channelRetryTimeout,this.retryCount);this.retryTimer=setTimeout(()=>{this.state==="suspended"&&this.connectionManager.state.sendEvents&&(this.retryTimer=null,S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel retry timer expired","attempting a new attach"),this.requestState("attaching"))},o)}cancelRetryTimer(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}getReleaseErr(){const o=this.state;return o==="initialized"||o==="detached"||o==="failed"?null:new Y("Can only release a channel in a state where there is no possibility of further updates from the server being received (initialized, detached, or failed); was "+o,90001,400)}setChannelSerial(o){S.logAction(this.logger,S.LOG_MICRO,"RealtimeChannel.setChannelSerial()","Updating channel serial; serial = "+o+"; previous = "+this.properties.channelSerial),o&&(this.properties.channelSerial=o)}async status(){return this.client.rest.channelMixin.status(this)}};function sl(s){const o=s||{},{agent:u}=o;return R(o,["agent"])}var Vs=Jo,ud=class{constructor(s){this.channel=s,this.logger=s.logger,this.subscriptions=new St(this.logger)}async publish(s,o){const u=this.channel.name,p=Us(s,o),_=await p.encode();this.channel.throwIfUnpublishableState(),S.logAction(this.logger,S.LOG_MICRO,"RealtimeAnnotations.publish()","channelName = "+u+", sending annotation with messageSerial = "+p.messageSerial+", type = "+p.type);const b=kn({action:_e.ANNOTATION,channel:u,annotations:[_]});return this.channel.sendMessage(b)}async delete(s,o){return o.action="annotation.delete",this.publish(s,o)}async subscribe(...s){const o=Vs.processListenerArgs(s),u=o[0],p=o[1],_=this.channel;if(_.state==="failed")throw Y.fromValues(_.invalidStateError());if(this.subscriptions.on(u,p),this.channel.channelOptions.attachOnSubscribe!==!1&&await _.attach(),(this.channel.state==="attached"&&this.channel._mode&Tt.ANNOTATION_SUBSCRIBE)===0)throw new Y("You are trying to add an annotation listener, but you haven't requested the annotation_subscribe channel mode in ChannelOptions, so this won't do anything (we only deliver annotations to clients who have explicitly requested them)",93001,400)}unsubscribe(...s){const o=Vs.processListenerArgs(s),u=o[0],p=o[1];this.subscriptions.off(u,p)}_processIncoming(s){for(const o of s)this.subscriptions.emit(o.type||"",o)}async get(s,o){return Fs.prototype.get.call(this,s,o)}},ol=ud,Kr=class tf extends Qc{constructor(o){var u,p;if(!tf._MsgPack)throw new Error("Expected DefaultRest._MsgPack to have been set");super($e.objectifyOptions(o,!0,"Rest",S.defaultLogger,L(x({},js),{Crypto:(u=tf.Crypto)!=null?u:void 0,MsgPack:(p=tf._MsgPack)!=null?p:void 0,Annotations:{Annotation:Wo,WireAnnotation:Ds,RealtimeAnnotations:ol,RestAnnotations:Fs}})))}static get Crypto(){if(this._Crypto===null)throw new Error("Encryption not enabled; use ably.encryption.js instead");return this._Crypto}static set Crypto(o){this._Crypto=o}};Kr._Crypto=null,Kr.Message=sd,Kr.PresenceMessage=Kc,Kr.Annotation=Zc,Kr._MsgPack=null,Kr._Http=Ts;var al=Kr,pp=class extends St{constructor(s){super(s),this.messages=[]}count(){return this.messages.length}push(s){this.messages.push(s)}shift(){return this.messages.shift()}last(){return this.messages[this.messages.length-1]}copyAll(){return this.messages.slice()}append(s){this.messages.push.apply(this.messages,s)}prepend(s){this.messages.unshift.apply(this.messages,s)}completeMessages(s,o,u){S.logAction(this.logger,S.LOG_MICRO,"MessageQueue.completeMessages()","serial = "+s+"; count = "+o),u=u||null;const p=this.messages;if(p.length===0)throw new Error("MessageQueue.completeMessages(): completeMessages called on any empty MessageQueue");const _=p[0];if(_){const b=_.message.msgSerial,A=s+o;if(A>b){const U=p.splice(0,A-b);for(const X of U)X.callback(u)}p.length==0&&this.emit("idle")}}completeAllMessages(s){this.completeMessages(0,Number.MAX_SAFE_INTEGER||Number.MAX_VALUE,s)}resetSendAttempted(){for(let s of this.messages)s.sendAttempted=!1}clear(){S.logAction(this.logger,S.LOG_MICRO,"MessageQueue.clear()","clearing "+this.messages.length+" messages"),this.messages=[],this.emit("idle")}},Zi=pp,za=class{constructor(s,o){this.message=s,this.callback=o,this.merged=!1;const u=s.action;this.sendAttempted=!1,this.ackRequired=typeof u=="number"&&[_e.MESSAGE,_e.PRESENCE,_e.ANNOTATION,_e.OBJECT].includes(u)}},Qo=class extends St{constructor(s){super(s.logger),this.transport=s,this.messageQueue=new Zi(this.logger),s.on("ack",(o,u)=>{this.onAck(o,u)}),s.on("nack",(o,u,p)=>{this.onNack(o,u,p)})}onAck(s,o){S.logAction(this.logger,S.LOG_MICRO,"Protocol.onAck()","serial = "+s+"; count = "+o),this.messageQueue.completeMessages(s,o)}onNack(s,o,u){S.logAction(this.logger,S.LOG_ERROR,"Protocol.onNack()","serial = "+s+"; count = "+o+"; err = "+Ze(u)),u||(u=new Y("Unable to send message; channel not responding",50001,500)),this.messageQueue.completeMessages(s,o,u)}onceIdle(s){const o=this.messageQueue;if(o.count()===0){s();return}o.once("idle",s)}send(s){s.ackRequired&&this.messageQueue.push(s),this.logger.shouldLog(S.LOG_MICRO)&&S.logActionNoStrip(this.logger,S.LOG_MICRO,"Protocol.send()","sending msg; "+Va(s.message,this.transport.connectionManager.realtime._RealtimePresence,this.transport.connectionManager.realtime._Annotations,this.transport.connectionManager.realtime._objectsPlugin)),s.sendAttempted=!0,this.transport.send(s.message)}getTransport(){return this.transport}getPendingMessages(){return this.messageQueue.copyAll()}clearPendingMessages(){return this.messageQueue.clear()}finish(){const s=this.transport;this.onceIdle(function(){s.disconnect()})}},cl=Qo,dd=class{constructor(s,o,u,p){this.previous=s,this.current=o,u&&(this.retryIn=u),p&&(this.reason=p)}},es=dd,zn={DISCONNECTED:80003,SUSPENDED:80002,FAILED:8e4,CLOSING:80017,CLOSED:80017,UNKNOWN_CONNECTION_ERR:50002,UNKNOWN_CHANNEL_ERR:50001},ll={disconnected:()=>Y.fromValues({statusCode:400,code:zn.DISCONNECTED,message:"Connection to server temporarily unavailable"}),suspended:()=>Y.fromValues({statusCode:400,code:zn.SUSPENDED,message:"Connection to server unavailable"}),failed:()=>Y.fromValues({statusCode:400,code:zn.FAILED,message:"Connection failed or disconnected by server"}),closing:()=>Y.fromValues({statusCode:400,code:zn.CLOSING,message:"Connection closing"}),closed:()=>Y.fromValues({statusCode:400,code:zn.CLOSED,message:"Connection closed"}),unknownConnectionErr:()=>Y.fromValues({statusCode:500,code:zn.UNKNOWN_CONNECTION_ERR,message:"Internal connection error"}),unknownChannelErr:()=>Y.fromValues({statusCode:500,code:zn.UNKNOWN_CONNECTION_ERR,message:"Internal channel error"})};function fd(s){return!s.statusCode||!s.code||s.statusCode>=500?!0:Object.values(zn).includes(s.code)}var Ir=ll,hd=kn({action:_e.CLOSE}),pd=kn({action:_e.DISCONNECT}),gd=class extends St{constructor(s,o,u,p){super(s.logger),p&&(u.format=void 0,u.heartbeats=!0),this.connectionManager=s,this.auth=o,this.params=u,this.timeouts=u.options.timeouts,this.format=u.format,this.isConnected=!1,this.isFinished=!1,this.isDisposed=!1,this.maxIdleInterval=null,this.idleTimer=null,this.lastActivity=null}connect(){}close(){this.isConnected&&this.requestClose(),this.finish("closed",Ir.closed())}disconnect(s){this.isConnected&&this.requestDisconnect(),this.finish("disconnected",s||Ir.disconnected())}fail(s){this.isConnected&&this.requestDisconnect(),this.finish("failed",s||Ir.failed())}finish(s,o){var u;this.isFinished||(this.isFinished=!0,this.isConnected=!1,this.maxIdleInterval=null,clearTimeout((u=this.idleTimer)!=null?u:void 0),this.idleTimer=null,this.emit(s,o),this.dispose())}onProtocolMessage(s){switch(this.logger.shouldLog(S.LOG_MICRO)&&S.logActionNoStrip(this.logger,S.LOG_MICRO,"Transport.onProtocolMessage()","received on "+this.shortName+": "+Va(s,this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin)+"; connectionId = "+this.connectionManager.connectionId),this.onActivity(),s.action){case _e.HEARTBEAT:S.logActionNoStrip(this.logger,S.LOG_MICRO,"Transport.onProtocolMessage()",this.shortName+" heartbeat; connectionId = "+this.connectionManager.connectionId),this.emit("heartbeat",s.id);break;case _e.CONNECTED:this.onConnect(s),this.emit("connected",s.error,s.connectionId,s.connectionDetails,s);break;case _e.CLOSED:this.onClose(s);break;case _e.DISCONNECTED:this.onDisconnect(s);break;case _e.ACK:this.emit("ack",s.msgSerial,s.count);break;case _e.NACK:this.emit("nack",s.msgSerial,s.count,s.error);break;case _e.SYNC:this.connectionManager.onChannelMessage(s,this);break;case _e.ACTIVATE:break;case _e.AUTH:Nt(this.auth.authorize(),o=>{o&&S.logAction(this.logger,S.LOG_ERROR,"Transport.onProtocolMessage()","Ably requested re-authentication, but unable to obtain a new token: "+Ze(o))});break;case _e.ERROR:if(S.logAction(this.logger,S.LOG_MINOR,"Transport.onProtocolMessage()","received error action; connectionId = "+this.connectionManager.connectionId+"; err = "+P.Config.inspect(s.error)+(s.channel?", channel: "+s.channel:"")),s.channel===void 0){this.onFatalError(s);break}this.connectionManager.onChannelMessage(s,this);break;default:this.connectionManager.onChannelMessage(s,this)}}onConnect(s){if(this.isConnected=!0,!s.connectionDetails)throw new Error("Transport.onConnect(): Connect message recieved without connectionDetails");const o=s.connectionDetails.maxIdleInterval;o&&(this.maxIdleInterval=o+this.timeouts.realtimeRequestTimeout,this.onActivity())}onDisconnect(s){const o=s&&s.error;S.logAction(this.logger,S.LOG_MINOR,"Transport.onDisconnect()","err = "+Ze(o)),this.finish("disconnected",o)}onFatalError(s){const o=s&&s.error;S.logAction(this.logger,S.LOG_MINOR,"Transport.onFatalError()","err = "+Ze(o)),this.finish("failed",o)}onClose(s){const o=s&&s.error;S.logAction(this.logger,S.LOG_MINOR,"Transport.onClose()","err = "+Ze(o)),this.finish("closed",o)}requestClose(){S.logAction(this.logger,S.LOG_MINOR,"Transport.requestClose()",""),this.send(hd)}requestDisconnect(){S.logAction(this.logger,S.LOG_MINOR,"Transport.requestDisconnect()",""),this.send(pd)}ping(s){const o={action:_e.HEARTBEAT};s&&(o.id=s),this.send(kn(o))}dispose(){S.logAction(this.logger,S.LOG_MINOR,"Transport.dispose()",""),this.isDisposed=!0,this.off()}onActivity(){this.maxIdleInterval&&(this.lastActivity=this.connectionManager.lastActivity=Date.now(),this.setIdleTimer(this.maxIdleInterval+100))}setIdleTimer(s){this.idleTimer||(this.idleTimer=setTimeout(()=>{this.onIdleTimerExpire()},s))}onIdleTimerExpire(){if(!this.lastActivity||!this.maxIdleInterval)throw new Error("Transport.onIdleTimerExpire(): lastActivity/maxIdleInterval not set");this.idleTimer=null;const s=Date.now()-this.lastActivity,o=this.maxIdleInterval-s;if(o<=0){const u="No activity seen from realtime in "+s+"ms; assuming connection has dropped";S.logAction(this.logger,S.LOG_ERROR,"Transport.onIdleTimerExpire()",u),this.disconnect(new Y(u,80003,408))}else this.setIdleTimer(o+100)}static tryConnect(s,o,u,p,_){const b=new s(o,u,p);let A;const U=function(K){clearTimeout(A),_({event:this.event,error:K})},X=o.options.timeouts.realtimeRequestTimeout;return A=setTimeout(()=>{b.off(["preconnect","disconnected","failed"]),b.dispose(),U.call({event:"disconnected"},new Y("Timeout waiting for transport to indicate itself viable",5e4,500))},X),b.on(["failed","disconnected"],U),b.on("preconnect",function(){S.logAction(o.logger,S.LOG_MINOR,"Transport.tryConnect()","viable transport "+b),clearTimeout(A),b.off(["failed","disconnected"],U),_(null,b)}),b.connect(),b}static isAvailable(){throw new Y("isAvailable not implemented for transport",5e4,500)}},ts=gd,un;(s=>{s.WebSocket="web_socket",s.Comet="comet",s.XhrPolling="xhr_polling"})(un||(un={}));var md=typeof cs<"u"?cs:typeof window<"u"?window:self,xr=()=>{var s;return typeof P.WebStorage<"u"&&((s=P.WebStorage)==null?void 0:s.localSupported)},ns=()=>{var s;return typeof P.WebStorage<"u"&&((s=P.WebStorage)==null?void 0:s.sessionSupported)},qa=function(){},ul="ably-transport-preference";function gp(s,o,u){let p;if(s.channel!==o.channel||(p=s.action)!==_e.PRESENCE&&p!==_e.MESSAGE||p!==o.action)return!1;const _=p===_e.PRESENCE?"presence":"messages",b=s[_].concat(o[_]);return Jc(b)>u||!wn(b,"clientId")||!b.every(function(U){return!U.id})?!1:(s[_]=b,!0)}function rs(s){try{return JSON.parse(s)}catch{return null}}var mp=class{constructor(s,o,u,p){this.options=s,this.host=o,this.mode=u,this.connectionKey=p,this.format=s.useBinaryProtocol?"msgpack":"json"}getConnectParams(s){const o=s?he(s):{},u=this.options;switch(this.mode){case"resume":o.resume=this.connectionKey;break;case"recover":{const p=rs(u.recover);p&&(o.recover=p.connectionKey);break}}return u.clientId!==void 0&&(o.clientId=u.clientId),u.echoMessages===!1&&(o.echo="false"),this.format!==void 0&&(o.format=this.format),this.stream!==void 0&&(o.stream=this.stream),this.heartbeats!==void 0&&(o.heartbeats=this.heartbeats),o.v=$e.protocolVersion,o.agent=tn(this.options),u.transportParams!==void 0&&we(o,u.transportParams),o}toString(){let s="[mode="+this.mode;return this.host&&(s+=",host="+this.host),this.connectionKey&&(s+=",connectionKey="+this.connectionKey),this.format&&(s+=",format="+this.format),s+="]",s}},vd=class B0 extends St{constructor(o,u){super(o.logger),this.supportedTransports={},this.disconnectedRetryCount=0,this.pendingChannelMessagesState={isProcessing:!1,queue:[]},this.realtime=o,this.initTransports(),this.options=u;const p=u.timeouts,_=p.webSocketConnectTimeout+p.realtimeRequestTimeout;if(this.states={initialized:{state:"initialized",terminal:!1,queueEvents:!0,sendEvents:!1,failState:"disconnected"},connecting:{state:"connecting",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:_,failState:"disconnected"},connected:{state:"connected",terminal:!1,queueEvents:!1,sendEvents:!0,failState:"disconnected"},disconnected:{state:"disconnected",terminal:!1,queueEvents:!0,sendEvents:!1,retryDelay:p.disconnectedRetryTimeout,failState:"disconnected"},suspended:{state:"suspended",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:p.suspendedRetryTimeout,failState:"suspended"},closing:{state:"closing",terminal:!1,queueEvents:!1,sendEvents:!1,retryDelay:p.realtimeRequestTimeout,failState:"closed"},closed:{state:"closed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"closed"},failed:{state:"failed",terminal:!0,queueEvents:!1,sendEvents:!1,failState:"failed"}},this.state=this.states.initialized,this.errorReason=null,this.queuedMessages=new Zi(this.logger),this.msgSerial=0,this.connectionDetails=void 0,this.connectionId=void 0,this.connectionKey=void 0,this.connectionStateTtl=p.connectionStateTtl,this.maxIdleInterval=null,this.transports=F(u.transports||$e.defaultTransports,this.supportedTransports),this.transportPreference=null,this.transports.includes(un.WebSocket)&&(this.webSocketTransportAvailable=!0),this.transports.includes(un.XhrPolling)?this.baseTransport=un.XhrPolling:this.transports.includes(un.Comet)&&(this.baseTransport=un.Comet),this.domains=$e.getHosts(u),this.activeProtocol=null,this.host=null,this.lastAutoReconnectAttempt=null,this.lastActivity=null,this.forceFallbackHost=!1,this.connectCounter=0,this.wsCheckResult=null,this.webSocketSlowTimer=null,this.webSocketGiveUpTimer=null,this.abandonedWebSocket=!1,S.logAction(this.logger,S.LOG_MINOR,"Realtime.ConnectionManager()","started"),S.logAction(this.logger,S.LOG_MICRO,"Realtime.ConnectionManager()","requested transports = ["+(u.transports||$e.defaultTransports)+"]"),S.logAction(this.logger,S.LOG_MICRO,"Realtime.ConnectionManager()","available transports = ["+this.transports+"]"),S.logAction(this.logger,S.LOG_MICRO,"Realtime.ConnectionManager()","http domains = ["+this.domains+"]"),!this.transports.length){const A="no requested transports available";throw S.logAction(this.logger,S.LOG_ERROR,"realtime.ConnectionManager()",A),new Error(A)}const b=P.Config.addEventListener;b&&(ns()&&typeof u.recover=="function"&&b("beforeunload",this.persistConnection.bind(this)),u.closeOnUnload===!0&&b("beforeunload",()=>{S.logAction(this.logger,S.LOG_MAJOR,"Realtime.ConnectionManager()","beforeunload event has triggered the connection to close as closeOnUnload is true"),this.requestState({state:"closing"})}),b("online",()=>{var A;this.state==this.states.disconnected||this.state==this.states.suspended?(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager caught browser online event","reattempting connection"),this.requestState({state:"connecting"})):this.state==this.states.connecting&&((A=this.pendingTransport)==null||A.off(),this.disconnectAllTransports(),this.startConnect())}),b("offline",()=>{this.state==this.states.connected&&(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager caught browser offline event","disconnecting active transport"),this.disconnectAllTransports())}))}static supportedTransports(o){const u={supportedTransports:{}};return this.initTransports(o,u),u.supportedTransports}static initTransports(o,u){const p=x(x({},P.Transports.bundledImplementations),o);[un.WebSocket,...P.Transports.order].forEach(_=>{const b=p[_];b&&b.isAvailable()&&(u.supportedTransports[_]=b)})}initTransports(){B0.initTransports(this.realtime._additionalTransportImplementations,this)}createTransportParams(o,u){return new mp(this.options,o,u,this.connectionKey)}getTransportParams(o){(p=>{if(this.connectionKey){p("resume");return}if(typeof this.options.recover=="string"){p("recover");return}const _=this.options.recover,b=this.getSessionRecoverData(),A=this.sessionRecoveryName();if(b&&typeof _=="function"){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.getTransportParams()","Calling clientOptions-provided recover function with last session data (recovery scope: "+A+")"),_(b,U=>{U?(this.options.recover=b.recoveryKey,p("recover")):p("clean")});return}p("clean")})(p=>{const _=this.createTransportParams(null,p);if(p==="recover"){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport recovery mode = recover; recoveryKey = "+this.options.recover);const b=rs(this.options.recover);b&&(this.msgSerial=b.msgSerial)}else S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.getTransportParams()","Transport params = "+_.toString());o(_)})}tryATransport(o,u,p){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.tryATransport()","trying "+u),this.proposedTransport=ts.tryConnect(this.supportedTransports[u],this,this.realtime.auth,o,(_,b)=>{const A=this.state;if(A==this.states.closing||A==this.states.closed||A==this.states.failed){b&&(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.tryATransport()","connection "+A.state+" while we were attempting the transport; closing "+b),b.close()),p(!0);return}if(_){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.tryATransport()","transport "+u+" "+_.event+", err: "+_.error.toString()),ln.isTokenErr(_.error)&&!(this.errorReason&&ln.isTokenErr(this.errorReason))?(this.errorReason=_.error,Nt(this.realtime.auth._forceNewToken(null,null),U=>{if(U){this.actOnErrorFromAuthorize(U);return}this.tryATransport(o,u,p)})):_.event==="failed"?(this.notifyState({state:"failed",error:_.error}),p(!0)):_.event==="disconnected"&&(fd(_.error)?p(!1):(this.notifyState({state:this.states.connecting.failState,error:_.error}),p(!0)));return}S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.tryATransport()","viable transport "+u+"; setting pending"),this.setTransportPending(b,o),p(null,b)})}setTransportPending(o,u){const p=u.mode;S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.setTransportPending()","transport = "+o+"; mode = "+p),this.pendingTransport=o,this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),o.once("connected",(b,A,U)=>{this.activateTransport(b,o,A,U),p==="recover"&&this.options.recover&&(delete this.options.recover,this.unpersistConnection())});const _=this;o.on(["disconnected","closed","failed"],function(b){_.deactivateTransport(o,this.event,b)}),this.emit("transport.pending",o)}activateTransport(o,u,p,_){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.activateTransport()","transport = "+u),o&&S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.activateTransport()","error = "+o),p&&S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.activateTransport()","connectionId =  "+p),_&&S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.activateTransport()","connectionDetails =  "+JSON.stringify(_)),this.persistTransportPreference(u);const b=this.state,A=this.states.connected.state;if(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.activateTransport()","current state = "+b.state),b.state==this.states.closing.state||b.state==this.states.closed.state||b.state==this.states.failed.state)return S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.activateTransport()","Disconnecting transport and abandoning"),u.disconnect(),!1;if(delete this.pendingTransport,!u.isConnected)return S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.activateTransport()","Declining to activate transport "+u+" since it appears to no longer be connected"),!1;const U=this.activeProtocol;this.activeProtocol=new cl(u),this.host=u.params.host;const X=_.connectionKey;if(X&&this.connectionKey!=X&&this.setConnection(p,_,!!o),this.onConnectionDetailsUpdate(_,u),P.Config.nextTick(()=>{u.on("connected",(K,de,ce)=>{this.onConnectionDetailsUpdate(ce,u),this.emit("update",new es(A,A,null,K))})}),b.state===this.states.connected.state?o&&(this.errorReason=this.realtime.connection.errorReason=o,this.emit("update",new es(A,A,null,o))):(this.notifyState({state:"connected",error:o}),this.errorReason=this.realtime.connection.errorReason=o||null),this.emit("transport.active",u),U)if(U.messageQueue.count()>0&&S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.activateTransport()","Previous active protocol (for transport "+U.transport.shortName+", new one is "+u.shortName+") finishing with "+U.messageQueue.count()+" messages still pending"),U.transport===u){const K="Assumption violated: activating a transport that was also the transport for the previous active protocol; transport = "+u.shortName+"; stack = "+new Error().stack;S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.activateTransport()",K)}else U.finish();return!0}deactivateTransport(o,u,p){const _=this.activeProtocol,b=_&&_.getTransport()===o,A=o===this.pendingTransport,U=this.noTransportsScheduledForActivation();if(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.deactivateTransport()","transport = "+o),S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.deactivateTransport()","state = "+u+(b?"; was active":A?"; was pending":"")+(U?"":"; another transport is scheduled for activation")),p&&p.message&&S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.deactivateTransport()","reason =  "+p.message),b&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.deactivateTransport()","Getting, clearing, and requeuing "+this.activeProtocol.messageQueue.count()+" pending messages"),this.queuePendingMessages(_.getPendingMessages()),_.clearPendingMessages(),this.activeProtocol=this.host=null),this.emit("transport.inactive",o),b&&U||b&&u==="failed"||u==="closed"||_===null&&A){if(u==="disconnected"&&p&&p.statusCode>500&&this.domains.length>1){this.unpersistTransportPreference(),this.forceFallbackHost=!0,this.notifyState({state:u,error:p,retryImmediately:!0});return}const X=u==="failed"&&ln.isTokenErr(p)?"disconnected":u;this.notifyState({state:X,error:p});return}}noTransportsScheduledForActivation(){return!this.pendingTransport||!this.pendingTransport.isConnected}setConnection(o,u,p){const _=this.connectionId;(_&&_!==o||!_&&p)&&(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.setConnection()","Resetting msgSerial"),this.msgSerial=0,this.queuedMessages.resetSendAttempted()),this.connectionId!==o&&S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.setConnection()","New connectionId; reattaching any attached channels"),this.realtime.connection.id=this.connectionId=o,this.realtime.connection.key=this.connectionKey=u.connectionKey}clearConnection(){this.realtime.connection.id=this.connectionId=void 0,this.realtime.connection.key=this.connectionKey=void 0,this.msgSerial=0,this.unpersistConnection()}createRecoveryKey(){return this.connectionKey?JSON.stringify({connectionKey:this.connectionKey,msgSerial:this.msgSerial,channelSerials:this.realtime.channels.channelSerials()}):null}checkConnectionStateFreshness(){if(!this.lastActivity||!this.connectionId)return;const o=Date.now()-this.lastActivity;o>this.connectionStateTtl+this.maxIdleInterval&&(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.checkConnectionStateFreshness()","Last known activity from realtime was "+o+"ms ago; discarding connection state"),this.clearConnection(),this.states.connecting.failState="suspended")}persistConnection(){if(ns()){const o=this.createRecoveryKey();o&&this.setSessionRecoverData({recoveryKey:o,disconnectedAt:Date.now(),location:md.location,clientId:this.realtime.auth.clientId})}}unpersistConnection(){this.clearSessionRecoverData()}getActiveTransportFormat(){var o;return(o=this.activeProtocol)==null?void 0:o.getTransport().format}getError(){if(this.errorReason){const o=De.fromValues(this.errorReason);return o.cause=this.errorReason,o}return this.getStateError()}getStateError(){var o,u;return(u=(o=Ir)[this.state.state])==null?void 0:u.call(o)}activeState(){return this.state.queueEvents||this.state.sendEvents}enactStateChange(o){const u="Connection state",p=o.current+(o.reason?"; reason: "+o.reason:"");o.current==="failed"?S.logAction(this.logger,S.LOG_ERROR,u,p):S.logAction(this.logger,S.LOG_MAJOR,u,p),S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.enactStateChange","setting new state: "+o.current+"; reason = "+(o.reason&&o.reason.message));const _=this.state=this.states[o.current];o.reason&&(this.errorReason=o.reason,this.realtime.connection.errorReason=o.reason),(_.terminal||_.state==="suspended")&&this.clearConnection(),this.emit("connectionstate",o)}startTransitionTimer(o){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.startTransitionTimer()","transitionState: "+o.state),this.transitionTimer&&(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.startTransitionTimer()","clearing already-running timer"),clearTimeout(this.transitionTimer)),this.transitionTimer=setTimeout(()=>{this.transitionTimer&&(this.transitionTimer=null,S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager "+o.state+" timer expired","requesting new state: "+o.failState),this.notifyState({state:o.failState}))},o.retryDelay)}cancelTransitionTimer(){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.cancelTransitionTimer()",""),this.transitionTimer&&(clearTimeout(this.transitionTimer),this.transitionTimer=null)}startSuspendTimer(){this.suspendTimer||(this.suspendTimer=setTimeout(()=>{this.suspendTimer&&(this.suspendTimer=null,S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager suspend timer expired","requesting new state: suspended"),this.states.connecting.failState="suspended",this.notifyState({state:"suspended"}))},this.connectionStateTtl))}checkSuspendTimer(o){o!=="disconnected"&&o!=="suspended"&&o!=="connecting"&&this.cancelSuspendTimer()}cancelSuspendTimer(){this.states.connecting.failState="disconnected",this.suspendTimer&&(clearTimeout(this.suspendTimer),this.suspendTimer=null)}startRetryTimer(o){this.retryTimer=setTimeout(()=>{S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager retry timer expired","retrying"),this.retryTimer=null,this.requestState({state:"connecting"})},o)}cancelRetryTimer(){this.retryTimer&&(clearTimeout(this.retryTimer),this.retryTimer=null)}startWebSocketSlowTimer(){this.webSocketSlowTimer=setTimeout(()=>{S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager WebSocket slow timer","checking connectivity"),this.checkWsConnectivity().then(()=>{S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager WebSocket slow timer","ws connectivity check succeeded"),this.wsCheckResult=!0}).catch(()=>{S.logAction(this.logger,S.LOG_MAJOR,"ConnectionManager WebSocket slow timer","ws connectivity check failed"),this.wsCheckResult=!1}),this.realtime.http.checkConnectivity&&Nt(this.realtime.http.checkConnectivity(),(o,u)=>{o||!u?(S.logAction(this.logger,S.LOG_MAJOR,"ConnectionManager WebSocket slow timer","http connectivity check failed"),this.cancelWebSocketGiveUpTimer(),this.notifyState({state:"disconnected",error:new Y("Unable to connect (network unreachable)",80003,404)})):S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager WebSocket slow timer","http connectivity check succeeded")})},this.options.timeouts.webSocketSlowTimeout)}cancelWebSocketSlowTimer(){this.webSocketSlowTimer&&(clearTimeout(this.webSocketSlowTimer),this.webSocketSlowTimer=null)}startWebSocketGiveUpTimer(o){this.webSocketGiveUpTimer=setTimeout(()=>{var u,p;this.wsCheckResult||(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager WebSocket give up timer","websocket connection took more than 10s; "+(this.baseTransport?"trying base transport":"")),this.baseTransport?(this.abandonedWebSocket=!0,(u=this.proposedTransport)==null||u.dispose(),(p=this.pendingTransport)==null||p.dispose(),this.connectBase(o,++this.connectCounter)):S.logAction(this.logger,S.LOG_MAJOR,"ConnectionManager WebSocket give up timer","websocket connectivity appears to be unavailable but no other transports to try"))},this.options.timeouts.webSocketConnectTimeout)}cancelWebSocketGiveUpTimer(){this.webSocketGiveUpTimer&&(clearTimeout(this.webSocketGiveUpTimer),this.webSocketGiveUpTimer=null)}notifyState(o){var u,p;const _=o.state,b=_==="disconnected"&&(this.state===this.states.connected||o.retryImmediately||this.state===this.states.connecting&&o.error&&ln.isTokenErr(o.error)&&!(this.errorReason&&ln.isTokenErr(this.errorReason)));if(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.notifyState()","new state: "+_+(b?"; will retry connection immediately":"")),_==this.state.state||(this.cancelTransitionTimer(),this.cancelRetryTimer(),this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),this.checkSuspendTimer(o.state),(_==="suspended"||_==="connected")&&(this.disconnectedRetryCount=0),this.state.terminal))return;const A=this.states[o.state];let U=A.retryDelay;A.state==="disconnected"&&(this.disconnectedRetryCount++,U=$i(A.retryDelay,this.disconnectedRetryCount));const X=new es(this.state.state,A.state,U,o.error||((p=(u=Ir)[A.state])==null?void 0:p.call(u)));if(b){const K=()=>{this.state===this.states.disconnected&&(this.lastAutoReconnectAttempt=Date.now(),this.requestState({state:"connecting"}))},de=this.lastAutoReconnectAttempt&&Date.now()-this.lastAutoReconnectAttempt+1;de&&de<1e3?(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.notifyState()","Last reconnect attempt was only "+de+"ms ago, waiting another "+(1e3-de)+"ms before trying again"),setTimeout(K,1e3-de)):P.Config.nextTick(K)}else(_==="disconnected"||_==="suspended")&&this.startRetryTimer(U);(_==="disconnected"&&!b||_==="suspended"||A.terminal)&&P.Config.nextTick(()=>{this.disconnectAllTransports()}),_=="connected"&&!this.activeProtocol&&S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.notifyState()","Broken invariant: attempted to go into connected state, but there is no active protocol"),this.enactStateChange(X),this.state.sendEvents?this.sendQueuedMessages():this.state.queueEvents||(this.realtime.channels.propogateConnectionInterruption(_,X.reason),this.failQueuedMessages(X.reason))}requestState(o){var u,p;const _=o.state;if(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.requestState()","requested state: "+_+"; current state: "+this.state.state),_==this.state.state||(this.cancelWebSocketSlowTimer(),this.cancelWebSocketGiveUpTimer(),this.cancelTransitionTimer(),this.cancelRetryTimer(),this.checkSuspendTimer(_),_=="connecting"&&this.state.state=="connected")||_=="closing"&&this.state.state=="closed")return;const b=this.states[_],A=new es(this.state.state,b.state,null,o.error||((p=(u=Ir)[b.state])==null?void 0:p.call(u)));this.enactStateChange(A),_=="connecting"&&P.Config.nextTick(()=>{this.startConnect()}),_=="closing"&&this.closeImpl()}startConnect(){if(this.state!==this.states.connecting){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.startConnect()","Must be in connecting state to connect, but was "+this.state.state);return}const o=this.realtime.auth,u=++this.connectCounter,p=()=>{this.checkConnectionStateFreshness(),this.getTransportParams(_=>{if(_.mode==="recover"&&_.options.recover){const b=rs(_.options.recover);b&&this.realtime.channels.recoverChannels(b.channelSerials)}u===this.connectCounter&&this.connectImpl(_,u)})};if(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.startConnect()","starting connection"),this.startSuspendTimer(),this.startTransitionTimer(this.states.connecting),o.method==="basic")p();else{const _=b=>{u===this.connectCounter&&(b?this.actOnErrorFromAuthorize(b):p())};this.errorReason&&ln.isTokenErr(this.errorReason)?Nt(o._forceNewToken(null,null),_):Nt(o._ensureValidAuthCredentials(!1),_)}}connectImpl(o,u){const p=this.state.state;if(p!==this.states.connecting.state){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.connectImpl()","Must be in connecting state to connect, but was "+p);return}const _=this.getTransportPreference();_&&_===this.baseTransport&&this.webSocketTransportAvailable&&this.checkWsConnectivity().then(()=>{this.unpersistTransportPreference(),this.state===this.states.connecting&&(S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.connectImpl():","web socket connectivity available, cancelling connection attempt with "+this.baseTransport),this.disconnectAllTransports(),this.connectWs(o,++this.connectCounter))}).catch(qa),_&&_===this.baseTransport||this.baseTransport&&!this.webSocketTransportAvailable?this.connectBase(o,u):this.connectWs(o,u)}connectWs(o,u){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.connectWs()"),this.wsCheckResult=null,this.abandonedWebSocket=!1,this.startWebSocketSlowTimer(),this.startWebSocketGiveUpTimer(o),this.tryTransportWithFallbacks("web_socket",o,!0,u,()=>this.wsCheckResult!==!1&&!this.abandonedWebSocket)}connectBase(o,u){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.connectBase()"),this.baseTransport?this.tryTransportWithFallbacks(this.baseTransport,o,!1,u,()=>!0):this.notifyState({state:"disconnected",error:new Y("No transports left to try",8e4,404)})}tryTransportWithFallbacks(o,u,p,_,b){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.tryTransportWithFallbacks()",o);const A=ce=>{this.notifyState({state:this.states.connecting.failState,error:ce})},U=this.domains.slice(),X=(ce,be)=>{if(_===this.connectCounter){if(!b()){be&&be.dispose();return}!be&&!ce&&de()}},K=U.shift();if(!K){A(new Y("Unable to connect (no available host)",80003,404));return}u.host=K;const de=()=>{if(!U.length){A(new Y("Unable to connect (and no more fallback hosts to try)",80003,404));return}if(!this.realtime.http.checkConnectivity){A(new De("Internal error: Http.checkConnectivity not set",null,500));return}Nt(this.realtime.http.checkConnectivity(),(ce,be)=>{if(_===this.connectCounter&&b()){if(ce){A(ce);return}if(!be){A(new Y("Unable to connect (network unreachable)",80003,404));return}u.host=mt(U),this.tryATransport(u,o,X)}})};if(this.forceFallbackHost&&U.length){this.forceFallbackHost=!1,de();return}this.tryATransport(u,o,X)}closeImpl(){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.closeImpl()","closing connection"),this.cancelSuspendTimer(),this.startTransitionTimer(this.states.closing),this.pendingTransport&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.closeImpl()","Closing pending transport: "+this.pendingTransport),this.pendingTransport.close()),this.activeProtocol&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.closeImpl()","Closing active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().close()),this.notifyState({state:"closed"})}onAuthUpdated(o,u){var p;switch(this.state.state){case"connected":{S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Sending AUTH message on active transport");const _=(p=this.activeProtocol)==null?void 0:p.getTransport();_&&_.onAuthUpdated&&_.onAuthUpdated(o);const b=kn({action:_e.AUTH,auth:{accessToken:o.token}});this.send(b);const A=()=>{this.off(U),u(null,o)},U=X=>{X.current==="failed"&&(this.off(A),this.off(U),u(X.reason||this.getStateError()))};this.once("connectiondetails",A),this.on("connectionstate",U);break}case"connecting":S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Aborting current connection attempts in order to start again with the new auth details"),this.disconnectAllTransports();default:{S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.onAuthUpdated()","Connection state is "+this.state.state+"; waiting until either connected or failed");const _=b=>{switch(b.current){case"connected":this.off(_),u(null,o);break;case"failed":case"closed":case"suspended":this.off(_),u(b.reason||this.getStateError());break}};this.on("connectionstate",_),this.state.state==="connecting"?this.startConnect():this.requestState({state:"connecting"})}}}disconnectAllTransports(){S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.disconnectAllTransports()","Disconnecting all transports"),this.connectCounter++,this.pendingTransport&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting pending transport: "+this.pendingTransport),this.pendingTransport.disconnect()),delete this.pendingTransport,this.proposedTransport&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting proposed transport: "+this.pendingTransport),this.proposedTransport.disconnect()),delete this.pendingTransport,this.activeProtocol&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.disconnectAllTransports()","Disconnecting active transport: "+this.activeProtocol.getTransport()),this.activeProtocol.getTransport().disconnect())}send(o,u,p){p=p||qa;const _=this.state;if(_.sendEvents){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.send()","sending event"),this.sendImpl(new za(o,p));return}if(!(u&&_.queueEvents)){const A="rejecting event, queueEvent was "+u+", state was "+_.state;S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.send()",A),p(this.errorReason||new Y(A,9e4,400));return}this.logger.shouldLog(S.LOG_MICRO)&&S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.send()","queueing msg; "+Va(o,this.realtime._RealtimePresence,this.realtime._Annotations,this.realtime._objectsPlugin)),this.queue(o,p)}sendImpl(o){const u=o.message;o.ackRequired&&!o.sendAttempted&&(u.msgSerial=this.msgSerial++);try{this.activeProtocol.send(o)}catch(p){S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.sendImpl()","Unexpected exception in transport.send(): "+p.stack)}}queue(o,u){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.queue()","queueing event");const p=this.queuedMessages.last(),_=this.options.maxMessageSize;p&&!p.sendAttempted&&gp(p.message,o,_)?(p.merged||(p.callback=hr.create(this.logger,[p.callback]),p.merged=!0),p.callback.push(u)):this.queuedMessages.push(new za(o,u))}sendQueuedMessages(){S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.sendQueuedMessages()","sending "+this.queuedMessages.count()+" queued messages");let o;for(;o=this.queuedMessages.shift();)this.sendImpl(o)}queuePendingMessages(o){o&&o.length&&(S.logAction(this.logger,S.LOG_MICRO,"ConnectionManager.queuePendingMessages()","queueing "+o.length+" pending messages"),this.queuedMessages.prepend(o))}failQueuedMessages(o){const u=this.queuedMessages.count();u>0&&(S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.failQueuedMessages()","failing "+u+" queued messages, err = "+Ze(o)),this.queuedMessages.completeAllMessages(o))}onChannelMessage(o,u){this.pendingChannelMessagesState.queue.push({message:o,transport:u}),this.pendingChannelMessagesState.isProcessing||this.processNextPendingChannelMessage()}processNextPendingChannelMessage(){if(this.pendingChannelMessagesState.queue.length>0){this.pendingChannelMessagesState.isProcessing=!0;const o=this.pendingChannelMessagesState.queue.shift();this.processChannelMessage(o.message).catch(u=>{S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.processNextPendingChannelMessage() received error ",u)}).finally(()=>{this.pendingChannelMessagesState.isProcessing=!1,this.processNextPendingChannelMessage()})}}async processChannelMessage(o){await this.realtime.channels.processChannelMessage(o)}async ping(){var o;if(this.state.state!=="connected")throw new Y("Unable to ping service; not connected",4e4,400);const u=(o=this.activeProtocol)==null?void 0:o.getTransport();if(!u)throw this.getStateError();S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.ping()","transport = "+u);const p=Date.now(),_=Jt();return jn(new Promise(b=>{const A=U=>{U===_&&(u.off("heartbeat",A),b(Date.now()-p))};u.on("heartbeat",A),u.ping(_)}),this.options.timeouts.realtimeRequestTimeout,"Timeout waiting for heartbeat response")}abort(o){this.activeProtocol.getTransport().fail(o)}getTransportPreference(){var o,u;return this.transportPreference||xr()&&((u=(o=P.WebStorage)==null?void 0:o.get)==null?void 0:u.call(o,ul))}persistTransportPreference(o){var u,p;this.transportPreference=o.shortName,xr()&&((p=(u=P.WebStorage)==null?void 0:u.set)==null||p.call(u,ul,o.shortName))}unpersistTransportPreference(){var o,u;this.transportPreference=null,xr()&&((u=(o=P.WebStorage)==null?void 0:o.remove)==null||u.call(o,ul))}actOnErrorFromAuthorize(o){if(o.code===40171)this.notifyState({state:"failed",error:o});else if(o.code===40102)this.notifyState({state:"failed",error:o});else if(o.statusCode===yi.Forbidden){const u="Client configured authentication provider returned 403; failing the connection";S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.actOnErrorFromAuthorize()",u),this.notifyState({state:"failed",error:new Y(u,80019,403,o)})}else{const u="Client configured authentication provider request failed";S.logAction(this.logger,S.LOG_MINOR,"ConnectionManager.actOnErrorFromAuthorize",u),this.notifyState({state:this.state.failState,error:new Y(u,80019,401,o)})}}onConnectionDetailsUpdate(o,u){if(!o)return;this.connectionDetails=o,o.maxMessageSize&&(this.options.maxMessageSize=o.maxMessageSize);const p=o.clientId;if(p){const b=this.realtime.auth._uncheckedSetClientId(p);if(b){S.logAction(this.logger,S.LOG_ERROR,"ConnectionManager.onConnectionDetailsUpdate()",b.message),u.fail(b);return}}const _=o.connectionStateTtl;_&&(this.connectionStateTtl=_),this.maxIdleInterval=o.maxIdleInterval,this.emit("connectiondetails",o)}checkWsConnectivity(){const o=this.options.wsConnectivityCheckUrl||$e.wsConnectivityCheckUrl,u=new P.Config.WebSocket(o);return new Promise((p,_)=>{let b=!1;u.onopen=()=>{b||(b=!0,p(),u.close())},u.onclose=u.onerror=()=>{b||(b=!0,_())}})}sessionRecoveryName(){return this.options.recoveryKeyStorageName||"ably-connection-recovery"}getSessionRecoverData(){var o,u;return ns()&&((u=(o=P.WebStorage)==null?void 0:o.getSession)==null?void 0:u.call(o,this.sessionRecoveryName()))}setSessionRecoverData(o){var u,p;return ns()&&((p=(u=P.WebStorage)==null?void 0:u.setSession)==null?void 0:p.call(u,this.sessionRecoveryName(),o))}clearSessionRecoverData(){var o,u;return ns()&&((u=(o=P.WebStorage)==null?void 0:o.removeSession)==null?void 0:u.call(o,this.sessionRecoveryName()))}},dl=vd,kt=class extends St{constructor(s,o){super(s.logger),this.whenState=u=>St.prototype.whenState.call(this,u,this.state),this.ably=s,this.connectionManager=new dl(s,o),this.state=this.connectionManager.state.state,this.key=void 0,this.id=void 0,this.errorReason=null,this.connectionManager.on("connectionstate",u=>{const p=this.state=u.current;P.Config.nextTick(()=>{this.emit(p,u)})}),this.connectionManager.on("update",u=>{P.Config.nextTick(()=>{this.emit("update",u)})})}connect(){S.logAction(this.logger,S.LOG_MINOR,"Connection.connect()",""),this.connectionManager.requestState({state:"connecting"})}async ping(){return S.logAction(this.logger,S.LOG_MINOR,"Connection.ping()",""),this.connectionManager.ping()}close(){S.logAction(this.logger,S.LOG_MINOR,"Connection.close()","connectionKey = "+this.key),this.connectionManager.requestState({state:"closing"})}get recoveryKey(){return this.logger.deprecationWarning("The `Connection.recoveryKey` attribute has been replaced by the `Connection.createRecoveryKey()` method. Replace your usage of `recoveryKey` with the return value of `createRecoveryKey()`. `recoveryKey` will be removed in a future version."),this.createRecoveryKey()}createRecoveryKey(){return this.connectionManager.createRecoveryKey()}},fl=kt,Ko=class F0 extends Rr{constructor(o){var u,p,_,b;if(super($e.objectifyOptions(o,!1,"BaseRealtime",S.defaultLogger)),S.logAction(this.logger,S.LOG_MINOR,"Realtime()",""),typeof EdgeRuntime=="string")throw new Y(`Ably.Realtime instance cannot be used in Vercel Edge runtime. If you are running Vercel Edge functions, please replace your "new Ably.Realtime()" with "new Ably.Rest()" and use Ably Rest API instead of the Realtime API. If you are server-rendering your application in the Vercel Edge runtime, please use the condition "if (typeof EdgeRuntime === 'string')" to prevent instantiating Ably.Realtime instance during SSR in the Vercel Edge runtime.`,4e4,400);this._additionalTransportImplementations=F0.transportImplementationsFromPlugins(this.options.plugins),this._RealtimePresence=(p=(u=this.options.plugins)==null?void 0:u.RealtimePresence)!=null?p:null,this._objectsPlugin=(b=(_=this.options.plugins)==null?void 0:_.Objects)!=null?b:null,this.connection=new fl(this,this.options),this._channels=new yd(this),this.options.autoConnect!==!1&&this.connect()}static transportImplementationsFromPlugins(o){const u={};return o?.WebSocketTransport&&(u[un.WebSocket]=o.WebSocketTransport),o?.XHRPolling&&(u[un.XhrPolling]=o.XHRPolling),u}get channels(){return this._channels}connect(){S.logAction(this.logger,S.LOG_MINOR,"Realtime.connect()",""),this.connection.connect()}close(){S.logAction(this.logger,S.LOG_MINOR,"Realtime.close()",""),this.connection.close()}};Ko.EventEmitter=St;var Yo=Ko,yd=class extends St{constructor(s){super(s.logger),this.realtime=s,this.all=Object.create(null),s.connection.connectionManager.on("transport.active",()=>{this.onTransportActive()})}channelSerials(){let s={};for(const o of qe(this.all,!0)){const u=this.all[o];u.properties.channelSerial&&(s[o]=u.properties.channelSerial)}return s}recoverChannels(s){for(const o of qe(s,!0)){const u=this.get(o);u.properties.channelSerial=s[o]}}async processChannelMessage(s){const o=s.channel;if(o===void 0){S.logAction(this.logger,S.LOG_ERROR,"Channels.processChannelMessage()","received event unspecified channel, action = "+s.action);return}const u=this.all[o];if(!u){S.logAction(this.logger,S.LOG_ERROR,"Channels.processChannelMessage()","received event for non-existent channel: "+o);return}await u.processMessage(s)}onTransportActive(){for(const s in this.all){const o=this.all[s];o.state==="attaching"||o.state==="detaching"?o.checkPendingState():o.state==="suspended"?o._attach(!1,null):o.state==="attached"&&o.requestState("attaching")}}propogateConnectionInterruption(s,o){const u={closing:"detached",closed:"detached",failed:"failed",suspended:"suspended"},p=["attaching","attached","detaching","suspended"],_=u[s];for(const b in this.all){const A=this.all[b];p.includes(A.state)&&A.notifyState(_,o)}}get(s,o){s=String(s);let u=this.all[s];if(!u)u=this.all[s]=new Vs(this.realtime,s,o);else if(o){if(u._shouldReattachToSetOptions(o,u.channelOptions))throw new Y("Channels.get() cannot be used to set channel options that would cause the channel to reattach. Please, use RealtimeChannel.setOptions() instead.",4e4,400);u.setOptions(o)}return u}getDerived(s,o,u){if(o.filter){const p=Qn(o.filter),_=pi(s);s=`[filter=${p}${_.qualifierParam}]${_.channelName}`}return this.get(s,u)}release(s){s=String(s);const o=this.all[s];if(!o)return;const u=o.getReleaseErr();if(u)throw u;delete this.all[s]}},hl=Yo;function Xo(s,o){if(s.isSynthesized()||o.isSynthesized())return s.timestamp>=o.timestamp;const u=s.parseId(),p=o.parseId();return u.msgSerial===p.msgSerial?u.index>p.index:u.msgSerial>p.msgSerial}var zs=class extends St{constructor(s,o,u=Xo){super(s.logger),this.presence=s,this.map=Object.create(null),this.syncInProgress=!1,this.residualMembers=null,this.memberKey=o,this.newerThan=u}get(s){return this.map[s]}getClient(s){const o=this.map,u=[];for(const p in o){const _=o[p];_.clientId==s&&_.action!="absent"&&u.push(_)}return u}list(s){const o=this.map,u=s&&s.clientId,p=s&&s.connectionId,_=[];for(const b in o){const A=o[b];A.action!=="absent"&&(u&&u!=A.clientId||p&&p!=A.connectionId||_.push(A))}return _}put(s){(s.action==="enter"||s.action==="update")&&(s=Mi.fromValues(s),s.action="present");const o=this.map,u=this.memberKey(s);this.residualMembers&&delete this.residualMembers[u];const p=o[u];return p&&!this.newerThan(s,p)?!1:(o[u]=s,!0)}values(){const s=this.map,o=[];for(const u in s){const p=s[u];p.action!="absent"&&o.push(p)}return o}remove(s){const o=this.map,u=this.memberKey(s),p=o[u];return p&&!this.newerThan(s,p)?!1:(this.syncInProgress?(s=Mi.fromValues(s),s.action="absent",o[u]=s):delete o[u],!!p)}startSync(){const s=this.map,o=this.syncInProgress;S.logAction(this.logger,S.LOG_MINOR,"PresenceMap.startSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+o),this.syncInProgress||(this.residualMembers=he(s),this.setInProgress(!0))}endSync(){const s=this.map,o=this.syncInProgress;if(S.logAction(this.logger,S.LOG_MINOR,"PresenceMap.endSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+o),o){for(const u in s)s[u].action==="absent"&&delete s[u];this.presence._synthesizeLeaves(Xe(this.residualMembers));for(const u in this.residualMembers)delete s[u];this.residualMembers=null,this.setInProgress(!1)}this.emit("sync")}waitSync(s){const o=this.syncInProgress;if(S.logAction(this.logger,S.LOG_MINOR,"PresenceMap.waitSync()","channel = "+this.presence.channel.name+"; syncInProgress = "+o),!o){s();return}this.once("sync",s)}clear(){this.map={},this.setInProgress(!1),this.residualMembers=null}setInProgress(s){S.logAction(this.logger,S.LOG_MICRO,"PresenceMap.setInProgress()","inProgress = "+s),this.syncInProgress=s,this.presence.syncComplete=!s}};function qs(s){return s.channel.client.auth.clientId}function $a(s){const o=s.channel.client,u=o.auth.clientId;return(!u||u==="*")&&o.connection.state==="connected"}function vp(s,o,u){switch(s.state){case"attached":case"suspended":u();break;case"initialized":case"detached":case"detaching":case"attaching":Nt(s.attach(),function(p){p?o(p):u()});break;default:o(Y.fromValues(s.invalidStateError()))}}var yp=class extends St{constructor(s){super(s.logger),this.channel=s,this.syncComplete=!1,this.members=new zs(this,o=>o.clientId+":"+o.connectionId),this._myMembers=new zs(this,o=>o.clientId),this.subscriptions=new St(this.logger),this.pendingPresence=[]}async enter(s){if($a(this))throw new Y("clientId must be specified to enter a presence channel",40012,400);return this._enterOrUpdateClient(void 0,void 0,s,"enter")}async update(s){if($a(this))throw new Y("clientId must be specified to update presence data",40012,400);return this._enterOrUpdateClient(void 0,void 0,s,"update")}async enterClient(s,o){return this._enterOrUpdateClient(void 0,s,o,"enter")}async updateClient(s,o){return this._enterOrUpdateClient(void 0,s,o,"update")}async _enterOrUpdateClient(s,o,u,p){const _=this.channel;if(!_.connectionManager.activeState())throw _.connectionManager.getError();S.logAction(this.logger,S.LOG_MICRO,"RealtimePresence."+p+"Client()","channel = "+_.name+", id = "+s+", client = "+(o||"(implicit) "+qs(this)));const b=Mi.fromData(u);b.action=p,s&&(b.id=s),o&&(b.clientId=o);const A=await b.encode(_.channelOptions);switch(_.state){case"attached":return _.sendPresence([A]);case"initialized":case"detached":_.attach();case"attaching":return new Promise((U,X)=>{this.pendingPresence.push({presence:A,callback:K=>K?X(K):U()})});default:{const U=new De("Unable to "+p+" presence channel while in "+_.state+" state",90001);throw U.code=90001,U}}}async leave(s){if($a(this))throw new Y("clientId must have been specified to enter or leave a presence channel",40012,400);return this.leaveClient(void 0,s)}async leaveClient(s,o){const u=this.channel;if(!u.connectionManager.activeState())throw u.connectionManager.getError();S.logAction(this.logger,S.LOG_MICRO,"RealtimePresence.leaveClient()","leaving; channel = "+this.channel.name+", client = "+s);const p=Mi.fromData(o);p.action="leave",s&&(p.clientId=s);const _=await p.encode(u.channelOptions);switch(u.state){case"attached":return u.sendPresence([_]);case"attaching":return new Promise((b,A)=>{this.pendingPresence.push({presence:_,callback:U=>U?A(U):b()})});case"initialized":case"failed":throw new De("Unable to leave presence channel (incompatible state)",90001);default:throw u.invalidStateError()}}async get(s){const o=!s||("waitForSync"in s?s.waitForSync:!0);return new Promise((u,p)=>{function _(b){u(s?b.list(s):b.values())}if(this.channel.state==="suspended"){o?p(Y.fromValues({statusCode:400,code:91005,message:"Presence state is out of sync due to channel being in the SUSPENDED state"})):_(this.members);return}vp(this.channel,b=>p(b),()=>{const b=this.members;o?b.waitSync(function(){_(b)}):_(b)})})}async history(s){S.logAction(this.logger,S.LOG_MICRO,"RealtimePresence.history()","channel = "+this.name);const o=this.channel.client.rest.presenceMixin;if(s&&s.untilAttach)if(this.channel.state==="attached")delete s.untilAttach,s.from_serial=this.channel.properties.attachSerial;else throw new Y("option untilAttach requires the channel to be attached, was: "+this.channel.state,4e4,400);return o.history(this,s)}setPresence(s,o,u){S.logAction(this.logger,S.LOG_MICRO,"RealtimePresence.setPresence()","received presence for "+s.length+" participants; syncChannelSerial = "+u);let p,_;const b=this.members,A=this._myMembers,U=[],X=this.channel.connectionManager.connectionId;o&&(this.members.startSync(),u&&(_=u.match(/^[\w-]+:(.*)$/))&&(p=_[1]));for(let K of s)switch(K.action){case"leave":b.remove(K)&&U.push(K),K.connectionId===X&&!K.isSynthesized()&&A.remove(K);break;case"enter":case"present":case"update":b.put(K)&&U.push(K),K.connectionId===X&&A.put(K);break}o&&!p&&(b.endSync(),this.channel.syncChannelSerial=null);for(let K=0;K<U.length;K++){const de=U[K];this.subscriptions.emit(de.action,de)}}onAttached(s){S.logAction(this.logger,S.LOG_MINOR,"RealtimePresence.onAttached()","channel = "+this.channel.name+", hasPresence = "+s),s?this.members.startSync():(this._synthesizeLeaves(this.members.values()),this.members.clear()),this._ensureMyMembersPresent();const o=this.pendingPresence,u=o.length;if(u){this.pendingPresence=[];const p=[],_=hr.create(this.logger);S.logAction(this.logger,S.LOG_MICRO,"RealtimePresence.onAttached","sending "+u+" queued presence messages");for(let b=0;b<u;b++){const A=o[b];p.push(A.presence),_.push(A.callback)}this.channel.sendPresence(p).then(()=>_()).catch(b=>_(b))}}actOnChannelState(s,o,u){switch(s){case"attached":this.onAttached(o);break;case"detached":case"failed":this._clearMyMembers(),this.members.clear();case"suspended":this.failPendingPresence(u);break}}failPendingPresence(s){if(this.pendingPresence.length){S.logAction(this.logger,S.LOG_MINOR,"RealtimeChannel.failPendingPresence","channel; name = "+this.channel.name+", err = "+Ze(s));for(let o=0;o<this.pendingPresence.length;o++)try{this.pendingPresence[o].callback(s)}catch{}this.pendingPresence=[]}}_clearMyMembers(){this._myMembers.clear()}_ensureMyMembersPresent(){const s=this._myMembers,o=this.channel.connectionManager.connectionId;for(const u in s.map){const p=s.map[u];S.logAction(this.logger,S.LOG_MICRO,"RealtimePresence._ensureMyMembersPresent()",'Auto-reentering clientId "'+p.clientId+'" into the presence set');const _=p.connectionId===o?p.id:void 0;this._enterOrUpdateClient(_,p.clientId,p.data,"enter").catch(b=>{const A=new Y("Presence auto re-enter failed",91004,400,b);S.logAction(this.logger,S.LOG_ERROR,"RealtimePresence._ensureMyMembersPresent()","Presence auto re-enter failed; reason = "+Ze(b));const U=new il(this.channel.state,this.channel.state,!0,!1,A);this.channel.emit("update",U)})}}_synthesizeLeaves(s){const o=this.subscriptions;s.forEach(function(u){const p=Mi.fromValues({action:"leave",connectionId:u.connectionId,clientId:u.clientId,data:u.data,encoding:u.encoding,timestamp:Date.now()});o.emit("leave",p)})}async subscribe(...s){const o=Vs.processListenerArgs(s),u=o[0],p=o[1],_=this.channel;if(_.state==="failed")throw Y.fromValues(_.invalidStateError());this.subscriptions.on(u,p),_.channelOptions.attachOnSubscribe!==!1&&await _.attach()}unsubscribe(...s){const o=Vs.processListenerArgs(s),u=o[0],p=o[1];this.subscriptions.off(u,p)}},_d=yp,Wa=un.WebSocket;function Ga(s){return!!s.on}var pl=class extends ts{constructor(s,o,u){super(s,o,u),this.shortName=Wa,u.heartbeats=P.Config.useProtocolHeartbeats,this.wsHost=u.host}static isAvailable(){return!!P.Config.WebSocket}createWebSocket(s,o){return this.uri=s+At(o),new P.Config.WebSocket(this.uri)}toString(){return"WebSocketTransport; uri="+this.uri}connect(){S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.connect()","starting"),ts.prototype.connect.call(this);const s=this,o=this.params,u=o.options,_=(u.tls?"wss://":"ws://")+this.wsHost+":"+$e.getPort(u)+"/";S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.connect()","uri: "+_),Nt(this.auth.getAuthParams(),function(b,A){if(s.isDisposed)return;let U="";for(const K in A)U+=" "+K+": "+A[K]+";";if(S.logAction(s.logger,S.LOG_MINOR,"WebSocketTransport.connect()","authParams:"+U+" err: "+b),b){s.disconnect(b);return}const X=o.getConnectParams(A);try{const K=s.wsConnection=s.createWebSocket(_,X);K.binaryType=P.Config.binaryType,K.onopen=function(){s.onWsOpen()},K.onclose=function(de){s.onWsClose(de)},K.onmessage=function(de){s.onWsData(de.data)},K.onerror=function(de){s.onWsError(de)},Ga(K)&&K.on("ping",function(){s.onActivity()})}catch(K){S.logAction(s.logger,S.LOG_ERROR,"WebSocketTransport.connect()","Unexpected exception creating websocket: err = "+(K.stack||K.message)),s.disconnect(K)}})}send(s){const o=this.wsConnection;if(!o){S.logAction(this.logger,S.LOG_ERROR,"WebSocketTransport.send()","No socket connection");return}try{o.send(dp(s,this.connectionManager.realtime._MsgPack,this.params.format))}catch(u){const p="Exception from ws connection when trying to send: "+Ze(u);S.logAction(this.logger,S.LOG_ERROR,"WebSocketTransport.send()",p),this.finish("disconnected",new Y(p,5e4,500))}}onWsData(s){S.logAction(this.logger,S.LOG_MICRO,"WebSocketTransport.onWsData()","data received; length = "+s.length+"; type = "+typeof s);try{this.onProtocolMessage(tl(s,this.connectionManager.realtime._MsgPack,this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin,this.format))}catch(o){S.logAction(this.logger,S.LOG_ERROR,"WebSocketTransport.onWsData()","Unexpected exception handing channel message: "+o.stack)}}onWsOpen(){S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.onWsOpen()","opened WebSocket"),this.emit("preconnect")}onWsClose(s){let o,u;if(typeof s=="object"?(u=s.code,o=s.wasClean||u===1e3):(u=s,o=u==1e3),delete this.wsConnection,o){S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.onWsClose()","Cleanly closed WebSocket");const p=new Y("Websocket closed",80003,400);this.finish("disconnected",p)}else{const p="Unclean disconnection of WebSocket ; code = "+u,_=new Y(p,80003,400);S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.onWsClose()",p),this.finish("disconnected",_)}this.emit("disposed")}onWsError(s){S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.onError()","Error from WebSocket: "+s.message),P.Config.nextTick(()=>{this.disconnect(Error(s.message))})}dispose(){S.logAction(this.logger,S.LOG_MINOR,"WebSocketTransport.dispose()",""),this.isDisposed=!0;const s=this.wsConnection;s&&(s.onmessage=function(){},delete this.wsConnection,P.Config.nextTick(()=>{if(S.logAction(this.logger,S.LOG_MICRO,"WebSocketTransport.dispose()","closing websocket"),!s)throw new Error("WebSocketTransport.dispose(): wsConnection is not defined");s.close()}))}},Ha=pl,gl=class{static subscribeFilter(s,o,u){const p=_=>{var b,A,U,X,K,de;const ce={name:_.name,refTimeserial:(A=(b=_.extras)==null?void 0:b.ref)==null?void 0:A.timeserial,refType:(X=(U=_.extras)==null?void 0:U.ref)==null?void 0:X.type,isRef:!!((de=(K=_.extras)==null?void 0:K.ref)!=null&&de.timeserial),clientId:_.clientId};Object.entries(o).find(([be,ue])=>ue!==void 0?ce[be]!==ue:!1)||u(_)};this.addFilteredSubscription(s,o,u,p),s.subscriptions.on(p)}static addFilteredSubscription(s,o,u,p){var _;if(s.filteredSubscriptions||(s.filteredSubscriptions=new Map),s.filteredSubscriptions.has(u)){const b=s.filteredSubscriptions.get(u);b.set(o,((_=b?.get(o))==null?void 0:_.concat(p))||[p])}else s.filteredSubscriptions.set(u,new Map([[o,[p]]]))}static getAndDeleteFilteredSubscriptions(s,o,u){if(!s.filteredSubscriptions)return[];if(!u&&o)return Array.from(s.filteredSubscriptions.entries()).map(([b,A])=>{var U;let X=A.get(o);return A.delete(o),A.size===0&&((U=s.filteredSubscriptions)==null||U.delete(b)),X}).reduce((b,A)=>A?b.concat(...A):b,[]);if(!u||!s.filteredSubscriptions.has(u))return[];const p=s.filteredSubscriptions.get(u);if(!o){const b=Array.from(p.values()).reduce((A,U)=>A.concat(...U),[]);return s.filteredSubscriptions.delete(u),b}let _=p.get(o);return p.delete(o),_||[]}},Cn=class pg extends hl{constructor(o){var u;const p=pg._MsgPack;if(!p)throw new Error("Expected DefaultRealtime._MsgPack to have been set");super($e.objectifyOptions(o,!0,"Realtime",S.defaultLogger,L(x({},js),{Crypto:(u=pg.Crypto)!=null?u:void 0,MsgPack:p,RealtimePresence:{RealtimePresence:_d,PresenceMessage:Mi,WirePresenceMessage:Ls},Annotations:{Annotation:Wo,WireAnnotation:Ds,RealtimeAnnotations:ol,RestAnnotations:Fs},WebSocketTransport:Ha,MessageInteractions:gl})))}static get Crypto(){if(this._Crypto===null)throw new Error("Encryption not enabled; use ably.encryption.js instead");return this._Crypto}static set Crypto(o){this._Crypto=o}};Cn.Utils=ze,Cn.ConnectionManager=dl,Cn.ProtocolMessage=fp,Cn._Crypto=null,Cn.Message=sd,Cn.PresenceMessage=Kc,Cn.Annotation=Zc,Cn._MsgPack=null,Cn._Http=Ts,Cn._PresenceMap=zs,Cn._MessageEncoding=Ji;var ml=Cn,Ja=Uint8Array,Zo=Uint32Array,vl=Math.pow,Qa=new Zo(8),Yr=[],$s=new Zo(64);function is(s){return(s-(s|0))*vl(2,32)|0}for(var En=2,Xr=0;Xr<64;){for(mr=!0,Ws=2;Ws<=En/2;Ws++)En%Ws===0&&(mr=!1);mr&&(Xr<8&&(Qa[Xr]=is(vl(En,1/2))),Yr[Xr]=is(vl(En,1/3)),Xr++),En++}var mr,Ws,_p=!!new Ja(new Zo([1]).buffer)[0];function yl(s){return _p?s>>>24|(s>>>16&255)<<8|(s&65280)<<8|s<<24:s}function nn(s,o){return s>>>o|s<<32-o}function Ti(s){var o=Qa.slice(),u=s.length,p=u*8,_=512-(p+64)%512-1+p+65,b=new Ja(_/8),A=new Zo(b.buffer);b.set(s,0),b[u]=128,A[A.length-1]=yl(p);for(var U,X=0;X<_/32;X+=16){var K=o.slice();for(U=0;U<64;U++){var de;if(U<16)de=yl(A[X+U]);else{var ce=$s[U-15],be=$s[U-2];de=$s[U-7]+$s[U-16]+(nn(ce,7)^nn(ce,18)^ce>>>3)+(nn(be,17)^nn(be,19)^be>>>10)}$s[U]=de|=0;for(var ue=(nn(K[4],6)^nn(K[4],11)^nn(K[4],25))+(K[4]&K[5]^~K[4]&K[6])+K[7]+de+Yr[U],Oe=(nn(K[0],2)^nn(K[0],13)^nn(K[0],22))+(K[0]&K[1]^K[2]&(K[0]^K[1])),Te=7;Te>0;Te--)K[Te]=K[Te-1];K[0]=ue+Oe|0,K[4]=K[4]+ue|0}for(U=0;U<8;U++)o[U]=o[U]+K[U]|0}return new Ja(new Zo(o.map(function(Ne){return yl(Ne)})).buffer)}function Gs(s,o){if(s.length>64&&(s=Ti(s)),s.length<64){const U=new Uint8Array(64);U.set(s,0),s=U}for(var u=new Uint8Array(64),p=new Uint8Array(64),_=0;_<64;_++)u[_]=54^s[_],p[_]=92^s[_];var b=new Uint8Array(o.length+64);b.set(u,0),b.set(o,64);var A=new Uint8Array(96);return A.set(p,0),A.set(Ti(b),64),Ti(A)}var Ka=class{constructor(){this.base64CharSet="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",this.hexCharSet="0123456789abcdef"}uint8ViewToBase64(s){let o="";const u=this.base64CharSet,p=s.byteLength,_=p%3,b=p-_;let A,U,X,K,de;for(let ce=0;ce<b;ce=ce+3)de=s[ce]<<16|s[ce+1]<<8|s[ce+2],A=(de&16515072)>>18,U=(de&258048)>>12,X=(de&4032)>>6,K=de&63,o+=u[A]+u[U]+u[X]+u[K];return _==1?(de=s[b],A=(de&252)>>2,U=(de&3)<<4,o+=u[A]+u[U]+"=="):_==2&&(de=s[b]<<8|s[b+1],A=(de&64512)>>10,U=(de&1008)>>4,X=(de&15)<<2,o+=u[A]+u[U]+u[X]+"="),o}base64ToArrayBuffer(s){const o=atob?.(s),u=o.length,p=new Uint8Array(u);for(let _=0;_<u;_++){const b=o.charCodeAt(_);p[_]=b}return this.toArrayBuffer(p)}isBuffer(s){return s instanceof ArrayBuffer||ArrayBuffer.isView(s)}toBuffer(s){if(!ArrayBuffer)throw new Error("Can't convert to Buffer: browser does not support the necessary types");if(s instanceof ArrayBuffer)return new Uint8Array(s);if(ArrayBuffer.isView(s))return new Uint8Array(this.toArrayBuffer(s));throw new Error("BufferUtils.toBuffer expected an ArrayBuffer or a view onto one")}toArrayBuffer(s){if(!ArrayBuffer)throw new Error("Can't convert to ArrayBuffer: browser does not support the necessary types");if(s instanceof ArrayBuffer)return s;if(ArrayBuffer.isView(s))return s.buffer.slice(s.byteOffset,s.byteOffset+s.byteLength);throw new Error("BufferUtils.toArrayBuffer expected an ArrayBuffer or a view onto one")}base64Encode(s){return this.uint8ViewToBase64(this.toBuffer(s))}base64UrlEncode(s){return this.base64Encode(s).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}base64Decode(s){if(ArrayBuffer&&P.Config.atob)return this.base64ToArrayBuffer(s);throw new Error("Expected ArrayBuffer to exist and Platform.Config.atob to be configured")}hexEncode(s){return this.toBuffer(s).reduce((u,p)=>u+p.toString(16).padStart(2,"0"),"")}hexDecode(s){if(s.length%2!==0)throw new Error("Can't create a byte array from a hex string of odd length");const o=new Uint8Array(s.length/2);for(let u=0;u<o.length;u++)o[u]=parseInt(s.slice(2*u,2*(u+1)),16);return this.toArrayBuffer(o)}utf8Encode(s){if(P.Config.TextEncoder){const o=new P.Config.TextEncoder().encode(s);return this.toArrayBuffer(o)}else throw new Error("Expected TextEncoder to be configured")}utf8Decode(s){if(!this.isBuffer(s))throw new Error("Expected input of utf8decode to be an arraybuffer or typed array");if(TextDecoder)return new TextDecoder().decode(s);throw new Error("Expected TextDecoder to be configured")}areBuffersEqual(s,o){if(!s||!o)return!1;const u=this.toArrayBuffer(s),p=this.toArrayBuffer(o);if(u.byteLength!=p.byteLength)return!1;const _=new Uint8Array(u),b=new Uint8Array(p);for(var A=0;A<_.length;A++)if(_[A]!=b[A])return!1;return!0}byteLength(s){return s instanceof ArrayBuffer||ArrayBuffer.isView(s)?s.byteLength:-1}arrayBufferViewToBuffer(s){return this.toArrayBuffer(s)}concat(s){const o=s.reduce((_,b)=>_+b.byteLength,0),u=new Uint8Array(o);let p=0;for(const _ of s){const b=this.toBuffer(_);u.set(b,p),p+=b.byteLength}return u.buffer}sha256(s){const o=Ti(this.toBuffer(s));return this.toArrayBuffer(o)}hmacSha256(s,o){const u=Gs(this.toBuffer(o),this.toBuffer(s));return this.toArrayBuffer(u)}},Ya=new Ka,Hs=function(s,o){var u="aes",p=256,_="cbc",b=16;function A(be){if(be.algorithm==="aes"&&be.mode==="cbc"){if(be.keyLength===128||be.keyLength===256)return;throw new Error("Unsupported key length "+be.keyLength+" for aes-cbc encryption. Encryption key must be 128 or 256 bits (16 or 32 ASCII characters)")}}function U(be){return be.replace("_","/").replace("-","+")}function X(be){return be instanceof K}class K{constructor(ue,Oe,Te,Ne){this.algorithm=ue,this.keyLength=Oe,this.mode=Te,this.key=Ne}}class de{static getDefaultParams(ue){var Oe;if(!ue.key)throw new Error("Crypto.getDefaultParams: a key is required");typeof ue.key=="string"?Oe=o.toArrayBuffer(o.base64Decode(U(ue.key))):ue.key instanceof ArrayBuffer?Oe=ue.key:Oe=o.toArrayBuffer(ue.key);var Te=ue.algorithm||u,Ne=Oe.byteLength*8,lt=ue.mode||_,ft=new K(Te,Ne,lt,Oe);if(ue.keyLength&&ue.keyLength!==ft.keyLength)throw new Error("Crypto.getDefaultParams: a keyLength of "+ue.keyLength+" was specified, but the key actually has length "+ft.keyLength);return A(ft),ft}static async generateRandomKey(ue){try{return s.getRandomArrayBuffer((ue||p)/8)}catch(Oe){throw new Y("Failed to generate random key: "+Oe.message,400,5e4,Oe)}}static getCipher(ue,Oe){var Te,Ne=X(ue)?ue:this.getDefaultParams(ue);return{cipherParams:Ne,cipher:new ce(Ne,(Te=ue.iv)!=null?Te:null,Oe)}}}de.CipherParams=K;class ce{constructor(ue,Oe,Te){if(this.logger=Te,!crypto.subtle)throw isSecureContext?new Error("Crypto operations are not possible since the browsers SubtleCrypto class is unavailable (reason unknown)."):new Error("Crypto operations are is not possible since the current environment is a non-secure context and hence the browsers SubtleCrypto class is not available.");this.algorithm=ue.algorithm+"-"+String(ue.keyLength)+"-"+ue.mode,this.webCryptoAlgorithm=ue.algorithm+"-"+ue.mode,this.key=o.toArrayBuffer(ue.key),this.iv=Oe?o.toArrayBuffer(Oe):null}concat(ue,Oe){const Te=new ArrayBuffer(ue.byteLength+Oe.byteLength),Ne=new DataView(Te),lt=new DataView(o.toArrayBuffer(ue));for(let We=0;We<lt.byteLength;We++)Ne.setInt8(We,lt.getInt8(We));const ft=new DataView(o.toArrayBuffer(Oe));for(let We=0;We<ft.byteLength;We++)Ne.setInt8(lt.byteLength+We,ft.getInt8(We));return Te}async encrypt(ue){S.logAction(this.logger,S.LOG_MICRO,"CBCCipher.encrypt()","");const Oe=await this.getIv(),Te=await crypto.subtle.importKey("raw",this.key,this.webCryptoAlgorithm,!1,["encrypt"]),Ne=await crypto.subtle.encrypt({name:this.webCryptoAlgorithm,iv:Oe},Te,ue);return this.concat(Oe,Ne)}async decrypt(ue){S.logAction(this.logger,S.LOG_MICRO,"CBCCipher.decrypt()","");const Oe=o.toArrayBuffer(ue),Te=Oe.slice(0,b),Ne=Oe.slice(b),lt=await crypto.subtle.importKey("raw",this.key,this.webCryptoAlgorithm,!1,["decrypt"]);return crypto.subtle.decrypt({name:this.webCryptoAlgorithm,iv:Te},lt,Ne)}async getIv(){if(this.iv){var ue=this.iv;return this.iv=null,ue}const Oe=await s.getRandomArrayBuffer(b);return o.toArrayBuffer(Oe)}}return de},Zr=(s=>(s[s.REQ_SEND=0]="REQ_SEND",s[s.REQ_RECV=1]="REQ_RECV",s[s.REQ_RECV_POLL=2]="REQ_RECV_POLL",s[s.REQ_RECV_STREAM=3]="REQ_RECV_STREAM",s))(Zr||{}),ct=Zr;function vt(){return new Y("No HTTP request plugin provided. Provide at least one of the FetchRequest or XHRRequest plugins.",400,4e4)}var Zn,Kt=(Zn=class{constructor(s){this.checksInProgress=null,this.checkConnectivity=void 0,this.supportsAuthHeaders=!1,this.supportsLinkHeaders=!1;var o;this.client=s??null;const u=s?.options.connectivityCheckUrl||$e.connectivityCheckUrl,p=(o=s?.options.connectivityCheckParams)!=null?o:null,_=!s?.options.connectivityCheckUrl,b=x(x({},Kt.bundledRequestImplementations),s?._additionalHTTPRequestImplementations),A=b.XHRRequest,U=b.FetchRequest,X=!!(A||U);if(!X)throw vt();P.Config.xhrSupported&&A?(this.supportsAuthHeaders=!0,this.Request=async function(K,de,ce,be,ue){return new Promise(Oe=>{var Te;const Ne=A.createRequest(de,ce,be,ue,ct.REQ_SEND,(Te=s&&s.options.timeouts)!=null?Te:null,this.logger,K);Ne.once("complete",(lt,ft,We,Ge,fn)=>Oe({error:lt,body:ft,headers:We,unpacked:Ge,statusCode:fn})),Ne.exec()})},s?.options.disableConnectivityCheck?this.checkConnectivity=async function(){return!0}:this.checkConnectivity=async function(){var K;S.logAction(this.logger,S.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Sending; "+u);const de=await this.doUri(Ot.Get,u,null,null,p);let ce=!1;return _?ce=!de.error&&((K=de.body)==null?void 0:K.replace(/\n/,""))=="yes":ce=!de.error&&Fc(de.statusCode),S.logAction(this.logger,S.LOG_MICRO,"(XHRRequest)Http.checkConnectivity()","Result: "+ce),ce}):P.Config.fetchSupported&&U?(this.supportsAuthHeaders=!0,this.Request=async(K,de,ce,be,ue)=>U(K,s??null,de,ce,be,ue),s?.options.disableConnectivityCheck?this.checkConnectivity=async function(){return!0}:this.checkConnectivity=async function(){var K;S.logAction(this.logger,S.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Sending; "+u);const de=await this.doUri(Ot.Get,u,null,null,null),ce=!de.error&&((K=de.body)==null?void 0:K.replace(/\n/,""))=="yes";return S.logAction(this.logger,S.LOG_MICRO,"(Fetch)Http.checkConnectivity()","Result: "+ce),ce}):this.Request=async()=>({error:X?new De("no supported HTTP transports available",null,400):vt()})}get logger(){var s,o;return(o=(s=this.client)==null?void 0:s.logger)!=null?o:S.defaultLogger}async doUri(s,o,u,p,_){return this.Request?this.Request(s,o,u,_,p):{error:new De("Request invoked before assigned to",null,500)}}shouldFallback(s){const o=s.statusCode;return o===408&&!s.code||o===400&&!s.code||o>=500&&o<=504}},Zn.methods=[Ot.Get,Ot.Delete,Ot.Post,Ot.Put,Ot.Patch],Zn.methodsWithoutBody=[Ot.Get,Ot.Delete],Zn.methodsWithBody=[Ot.Post,Ot.Put,Ot.Patch],Zn),dn=Kt,er="ablyjs-storage-test",vr=typeof cs<"u"?cs:typeof window<"u"?window:self,Mn=class{constructor(){try{vr.sessionStorage.setItem(er,er),vr.sessionStorage.removeItem(er),this.sessionSupported=!0}catch{this.sessionSupported=!1}try{vr.localStorage.setItem(er,er),vr.localStorage.removeItem(er),this.localSupported=!0}catch{this.localSupported=!1}}get(s){return this._get(s,!1)}getSession(s){return this._get(s,!0)}remove(s){return this._remove(s,!1)}removeSession(s){return this._remove(s,!0)}set(s,o,u){return this._set(s,o,u,!1)}setSession(s,o,u){return this._set(s,o,u,!0)}_set(s,o,u,p){const _={value:o};return u&&(_.expires=Date.now()+u),this.storageInterface(p).setItem(s,JSON.stringify(_))}_get(s,o){if(o&&!this.sessionSupported)throw new Error("Session Storage not supported");if(!o&&!this.localSupported)throw new Error("Local Storage not supported");const u=this.storageInterface(o).getItem(s);if(!u)return null;const p=JSON.parse(u);return p.expires&&p.expires<Date.now()?(this.storageInterface(o).removeItem(s),null):p.value}_remove(s,o){return this.storageInterface(o).removeItem(s)}storageInterface(s){return s?vr.sessionStorage:vr.localStorage}},ea=new Mn,It=xo(),wd=typeof EdgeRuntime=="string";typeof Window>"u"&&typeof WorkerGlobalScope>"u"&&!wd&&console.log("Warning: this distribution of Ably is intended for browsers. On nodejs, please use the 'ably' package on npm");function Xa(){const s=It.location;return!It.WebSocket||!s||!s.origin||s.origin.indexOf("http")>-1}function bd(){return typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope}var ei=It.navigator&&It.navigator.userAgent.toString(),Za=It.location&&It.location.href,_l={agent:"browser",logTimestamps:!0,userAgent:ei,currentUrl:Za,binaryType:"arraybuffer",WebSocket:It.WebSocket,fetchSupported:!!It.fetch,xhrSupported:It.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest,allowComet:Xa(),useProtocolHeartbeats:!0,supportsBinary:!!It.TextDecoder,preferBinary:!1,ArrayBuffer:It.ArrayBuffer,atob:It.atob,nextTick:typeof It.queueMicrotask=="function"?s=>It.queueMicrotask(s):s=>Promise.resolve().then(s),addEventListener:It.addEventListener,inspect:JSON.stringify,stringByteSize:function(s){return It.TextDecoder&&new It.TextEncoder().encode(s).length||s.length},TextEncoder:It.TextEncoder,TextDecoder:It.TextDecoder,getRandomArrayBuffer:async function(s){const o=new Uint8Array(s);return It.crypto.getRandomValues(o),o.buffer},isWebworker:bd(),push:{platform:"browser",formFactor:"desktop",storage:ea}},wl=_l;function wp(s){const o=[80015,80017,80030];return s.code?ln.isTokenErr(s)?!1:o.includes(s.code)?!0:s.code>=4e4&&s.code<5e4:!1}function Lr(s){return wp(s)?[kn({action:_e.ERROR,error:s})]:[kn({action:_e.DISCONNECTED,error:s})]}var Js=class extends ts{constructor(s,o,u){super(s,o,u,!0),this.onAuthUpdated=p=>{this.authParams={access_token:p.token}},this.stream="stream"in u?u.stream:!0,this.sendRequest=null,this.recvRequest=null,this.pendingCallback=null,this.pendingItems=null}connect(){S.logAction(this.logger,S.LOG_MINOR,"CometTransport.connect()","starting"),ts.prototype.connect.call(this);const s=this.params,o=s.options,u=s.host||o.primaryDomain,p=$e.getPort(o),_=o.tls?"https://":"http://";this.baseUri=_+u+":"+p+"/comet/";const b=this.baseUri+"connect";S.logAction(this.logger,S.LOG_MINOR,"CometTransport.connect()","uri: "+b),Nt(this.auth.getAuthParams(),(A,U)=>{if(A){this.disconnect(A);return}if(this.isDisposed)return;this.authParams=U;const X=this.params.getConnectParams(U);"stream"in X&&(this.stream=X.stream),S.logAction(this.logger,S.LOG_MINOR,"CometTransport.connect()","connectParams:"+At(X));let K=!1;const de=this.recvRequest=this.createRequest(b,null,X,null,this.stream?ct.REQ_RECV_STREAM:ct.REQ_RECV);de.on("data",ce=>{this.recvRequest&&(K||(K=!0,this.emit("preconnect")),this.onData(ce))}),de.on("complete",ce=>{if(this.recvRequest||(ce=ce||new Y("Request cancelled",80003,400)),this.recvRequest=null,!K&&!ce&&(K=!0,this.emit("preconnect")),this.onActivity(),ce){ce.code?this.onData(Lr(ce)):this.disconnect(ce);return}P.Config.nextTick(()=>{this.recv()})}),de.exec()})}requestClose(){S.logAction(this.logger,S.LOG_MINOR,"CometTransport.requestClose()"),this._requestCloseOrDisconnect(!0)}requestDisconnect(){S.logAction(this.logger,S.LOG_MINOR,"CometTransport.requestDisconnect()"),this._requestCloseOrDisconnect(!1)}_requestCloseOrDisconnect(s){const o=s?this.closeUri:this.disconnectUri;if(o){const u=this.createRequest(o,null,this.authParams,null,ct.REQ_SEND);u.on("complete",p=>{p&&(S.logAction(this.logger,S.LOG_ERROR,"CometTransport.request"+(s?"Close()":"Disconnect()"),"request returned err = "+Ze(p)),this.finish("disconnected",p))}),u.exec()}}dispose(){S.logAction(this.logger,S.LOG_MINOR,"CometTransport.dispose()",""),this.isDisposed||(this.isDisposed=!0,this.recvRequest&&(S.logAction(this.logger,S.LOG_MINOR,"CometTransport.dispose()","aborting recv request"),this.recvRequest.abort(),this.recvRequest=null),this.finish("disconnected",Ir.disconnected()),P.Config.nextTick(()=>{this.emit("disposed")}))}onConnect(s){var o;if(this.isDisposed)return;const u=(o=s.connectionDetails)==null?void 0:o.connectionKey;ts.prototype.onConnect.call(this,s);const p=this.baseUri+u;S.logAction(this.logger,S.LOG_MICRO,"CometTransport.onConnect()","baseUri = "+p),this.sendUri=p+"/send",this.recvUri=p+"/recv",this.closeUri=p+"/close",this.disconnectUri=p+"/disconnect"}send(s){if(this.sendRequest){this.pendingItems=this.pendingItems||[],this.pendingItems.push(s);return}const o=this.pendingItems||[];o.push(s),this.pendingItems=null,this.sendItems(o)}sendAnyPending(){const s=this.pendingItems;s&&(this.pendingItems=null,this.sendItems(s))}sendItems(s){const o=this.sendRequest=this.createRequest(this.sendUri,null,this.authParams,this.encodeRequest(s),ct.REQ_SEND);o.on("complete",(u,p)=>{if(u&&S.logAction(this.logger,S.LOG_ERROR,"CometTransport.sendItems()","on complete: err = "+Ze(u)),this.sendRequest=null,u){u.code?this.onData(Lr(u)):this.disconnect(u);return}p&&this.onData(p),this.pendingItems&&P.Config.nextTick(()=>{this.sendRequest||this.sendAnyPending()})}),o.exec()}recv(){if(this.recvRequest||!this.isConnected)return;const s=this.recvRequest=this.createRequest(this.recvUri,null,this.authParams,null,this.stream?ct.REQ_RECV_STREAM:ct.REQ_RECV_POLL);s.on("data",o=>{this.onData(o)}),s.on("complete",o=>{if(this.recvRequest=null,this.onActivity(),o){o.code?this.onData(Lr(o)):this.disconnect(o);return}P.Config.nextTick(()=>{this.recv()})}),s.exec()}onData(s){try{const o=this.decodeResponse(s);if(o&&o.length)for(let u=0;u<o.length;u++)this.onProtocolMessage(Ho(o[u],this.connectionManager.realtime._RealtimePresence,this.connectionManager.realtime._Annotations,this.connectionManager.realtime._objectsPlugin))}catch(o){S.logAction(this.logger,S.LOG_ERROR,"CometTransport.onData()","Unexpected exception handing channel event: "+o.stack)}}encodeRequest(s){return JSON.stringify(s)}decodeResponse(s){return typeof s=="string"?JSON.parse(s):s}},Qs=Js;function ec(s,o){return Wr(qe(o)).includes("x-ably-errorcode")}function tc(s,o){if(ec(s,o))return s.error&&Y.fromValues(s.error)}var tr=function(){},nr=0,Ri={};function ti(s,o){return s.getResponseHeader&&s.getResponseHeader(o)}function ni(s){return s.getResponseHeader&&(s.getResponseHeader("transfer-encoding")||!s.getResponseHeader("content-length"))}function ss(s){const o=s.getAllResponseHeaders().trim().split(`\r
`),u={};for(let p=0;p<o.length;p++){const _=o[p].split(":").map(b=>b.trim());u[_[0].toLowerCase()]=_[1]}return u}var Sd=class V0 extends St{constructor(o,u,p,_,b,A,U,X){super(U),p=p||{},p.rnd=Jt(),this.uri=o+At(p),this.headers=u||{},this.body=_,this.method=X?X.toUpperCase():le(_)?"GET":"POST",this.requestMode=b,this.timeouts=A,this.timedOut=!1,this.requestComplete=!1,this.id=String(++nr),Ri[this.id]=this}static createRequest(o,u,p,_,b,A,U,X){const K=A||$e.TIMEOUTS;return new V0(o,u,he(p),_,b,K,U,X)}complete(o,u,p,_,b){this.requestComplete||(this.requestComplete=!0,!o&&u&&this.emit("data",u),this.emit("complete",o,u,p,_,b),this.dispose())}abort(){this.dispose()}exec(){let o=this.headers;const u=this.requestMode==ct.REQ_SEND?this.timeouts.httpRequestTimeout:this.timeouts.recvTimeout,p=this.timer=setTimeout(()=>{this.timedOut=!0,b.abort()},u),_=this.method,b=this.xhr=new XMLHttpRequest,A=o.accept;let U=this.body,X="text";A?A.indexOf("application/x-msgpack")===0&&(X="arraybuffer"):o.accept="application/json",U&&(o["content-type"]||(o["content-type"]="application/json")).indexOf("application/json")>-1&&typeof U!="string"&&(U=JSON.stringify(U)),b.open(_,this.uri,!0),b.responseType=X,"authorization"in o&&(b.withCredentials=!0);for(const Ge in o)b.setRequestHeader(Ge,o[Ge]);const K=(Ge,fn,$t,Ii)=>{var xi;let ri=fn+" (event type: "+Ge.type+")";(xi=this==null?void 0:this.xhr)!=null&&xi.statusText&&(ri+=", current statusText is "+this.xhr.statusText),S.logAction(this.logger,S.LOG_ERROR,"Request.on"+Ge.type+"()",ri),this.complete(new De(ri,$t,Ii))};b.onerror=Ge=>{K(Ge,"XHR error occurred",null,400)},b.onabort=Ge=>{this.timedOut?K(Ge,"Request aborted due to request timeout expiring",null,408):K(Ge,"Request cancelled",null,400)},b.ontimeout=Ge=>{K(Ge,"Request timed out",null,408)};let de,ce,be,ue=0,Oe=!1;const Te=()=>{if(clearTimeout(p),be=ce<400,ce==204){this.complete(null,null,null,null,ce);return}de=this.requestMode==ct.REQ_RECV_STREAM&&be&&ni(b)},Ne=()=>{let Ge;try{const $t=ti(b,"content-type");if($t?$t.indexOf("application/json")>=0:b.responseType=="text"){const xi=b.responseType==="arraybuffer"?P.BufferUtils.utf8Decode(b.response):String(b.responseText);xi.length?Ge=JSON.parse(xi):Ge=xi,Oe=!0}else Ge=b.response;Ge.response!==void 0?(ce=Ge.statusCode,be=ce<400,o=Ge.headers,Ge=Ge.response):o=ss(b)}catch($t){this.complete(new De("Malformed response body from server: "+$t.message,null,400));return}if(be||Array.isArray(Ge)){this.complete(null,Ge,o,Oe,ce);return}let fn=tc(Ge,o);fn||(fn=new De("Error response received from server: "+ce+" body was: "+P.Config.inspect(Ge),null,ce)),this.complete(fn,Ge,o,Oe,ce)};function lt(){const Ge=b.responseText,fn=Ge.length-1;let $t,Ii;for(;ue<fn&&($t=Ge.indexOf(`
`,ue))>-1;)Ii=Ge.slice(ue,$t),ue=$t+1,ft(Ii)}const ft=Ge=>{try{Ge=JSON.parse(Ge)}catch(fn){this.complete(new De("Malformed response body from server: "+fn.message,null,400));return}this.emit("data",Ge)},We=()=>{lt(),this.streamComplete=!0,P.Config.nextTick(()=>{this.complete()})};b.onreadystatechange=()=>{const Ge=b.readyState;Ge<3||b.status!==0&&(ce===void 0&&(ce=b.status,Te()),Ge==3&&de?lt():Ge==4&&(de?We():Ne()))},b.send(U)}dispose(){const o=this.xhr;if(o){o.onreadystatechange=o.onerror=o.onabort=o.ontimeout=tr,this.xhr=null;const u=this.timer;u&&(clearTimeout(u),this.timer=null),this.requestComplete||o.abort()}delete Ri[this.id]}},nc=Sd,rc=un.XhrPolling,qn=class extends Qs{constructor(s,o,u){super(s,o,u),this.shortName=rc,u.stream=!1,this.shortName=rc}static isAvailable(){return!!(P.Config.xhrSupported&&P.Config.allowComet)}toString(){return"XHRPollingTransport; uri="+this.baseUri+"; isConnected="+this.isConnected}createRequest(s,o,u,p,_){return nc.createRequest(s,o,u,p,_,this.timeouts,this.logger)}},$n=qn,Mt=["xhr_polling"],yr={order:Mt,bundledImplementations:{web_socket:Ha,xhr_polling:$n}},kd=yr,Cd={connectivityCheckUrl:"https://internet-up.ably-realtime.com/is-the-internet-up.txt",wsConnectivityCheckUrl:"wss://ws-up.ably-realtime.com",defaultTransports:[un.XhrPolling,un.WebSocket]},bl=Cd;function Sl(s){if(s===void 0)return"undefined";let o,u;if(s instanceof ArrayBuffer?(u="ArrayBuffer",o=new DataView(s)):s instanceof DataView&&(u="DataView",o=s),!o)return JSON.stringify(s);const p=[];for(let _=0;_<s.byteLength;_++){if(_>20){p.push("...");break}let b=o.getUint8(_).toString(16);b.length===1&&(b="0"+b),p.push(b)}return"<"+u+" "+p.join(" ")+">"}function Ks(s,o,u){for(let p=0,_=u.length;p<_;p++){const b=u.charCodeAt(p);if(b<128){s.setUint8(o++,b>>>0&127|0);continue}if(b<2048){s.setUint8(o++,b>>>6&31|192),s.setUint8(o++,b>>>0&63|128);continue}if(b<65536){s.setUint8(o++,b>>>12&15|224),s.setUint8(o++,b>>>6&63|128),s.setUint8(o++,b>>>0&63|128);continue}if(b<1114112){s.setUint8(o++,b>>>18&7|240),s.setUint8(o++,b>>>12&63|128),s.setUint8(o++,b>>>6&63|128),s.setUint8(o++,b>>>0&63|128);continue}throw new Error("bad codepoint "+b)}}function ta(s,o,u){let p="";for(let _=o,b=o+u;_<b;_++){const A=s.getUint8(_);if((A&128)===0){p+=String.fromCharCode(A);continue}if((A&224)===192){p+=String.fromCharCode((A&15)<<6|s.getUint8(++_)&63);continue}if((A&240)===224){p+=String.fromCharCode((A&15)<<12|(s.getUint8(++_)&63)<<6|(s.getUint8(++_)&63)<<0);continue}if((A&248)===240){p+=String.fromCharCode((A&7)<<18|(s.getUint8(++_)&63)<<12|(s.getUint8(++_)&63)<<6|(s.getUint8(++_)&63)<<0);continue}throw new Error("Invalid byte "+A.toString(16))}return p}function ic(s){let o=0;for(let u=0,p=s.length;u<p;u++){const _=s.charCodeAt(u);if(_<128){o+=1;continue}if(_<2048){o+=2;continue}if(_<65536){o+=3;continue}if(_<1114112){o+=4;continue}throw new Error("bad codepoint "+_)}return o}function Ys(s,o){const u=jr(s,o);if(u===0)return;const p=new ArrayBuffer(u),_=new DataView(p);return Ai(s,_,0,o),p}var na=65536*65536,Ed=1/na;function ra(s,o){return o=o||0,s.getInt32(o)*na+s.getUint32(o+4)}function sc(s,o){return o=o||0,s.getUint32(o)*na+s.getUint32(o+4)}function Md(s,o,u){u<9223372036854776e3?(s.setInt32(o,Math.floor(u*Ed)),s.setInt32(o+4,u&-1)):(s.setUint32(o,2147483647),s.setUint32(o+4,2147483647))}function Od(s,o,u){u<18446744073709552e3?(s.setUint32(o,Math.floor(u*Ed)),s.setInt32(o+4,u&-1)):(s.setUint32(o,4294967295),s.setUint32(o+4,4294967295))}var Xs=class{constructor(s,o){this.map=u=>{const p={};for(let _=0;_<u;_++){const b=this.parse();p[b]=this.parse()}return p},this.bin=u=>{const p=new ArrayBuffer(u);return new Uint8Array(p).set(new Uint8Array(this.view.buffer,this.offset,u),0),this.offset+=u,p},this.buf=this.bin,this.str=u=>{const p=ta(this.view,this.offset,u);return this.offset+=u,p},this.array=u=>{const p=new Array(u);for(let _=0;_<u;_++)p[_]=this.parse();return p},this.ext=u=>(this.offset+=u,{type:this.view.getInt8(this.offset),data:this.buf(u)}),this.parse=()=>{const u=this.view.getUint8(this.offset);let p,_;if((u&128)===0)return this.offset++,u;if((u&240)===128)return _=u&15,this.offset++,this.map(_);if((u&240)===144)return _=u&15,this.offset++,this.array(_);if((u&224)===160)return _=u&31,this.offset++,this.str(_);if((u&224)===224)return p=this.view.getInt8(this.offset),this.offset++,p;switch(u){case 192:return this.offset++,null;case 193:this.offset++;return;case 194:return this.offset++,!1;case 195:return this.offset++,!0;case 196:return _=this.view.getUint8(this.offset+1),this.offset+=2,this.bin(_);case 197:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.bin(_);case 198:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.bin(_);case 199:return _=this.view.getUint8(this.offset+1),this.offset+=2,this.ext(_);case 200:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.ext(_);case 201:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.ext(_);case 202:return p=this.view.getFloat32(this.offset+1),this.offset+=5,p;case 203:return p=this.view.getFloat64(this.offset+1),this.offset+=9,p;case 204:return p=this.view.getUint8(this.offset+1),this.offset+=2,p;case 205:return p=this.view.getUint16(this.offset+1),this.offset+=3,p;case 206:return p=this.view.getUint32(this.offset+1),this.offset+=5,p;case 207:return p=sc(this.view,this.offset+1),this.offset+=9,p;case 208:return p=this.view.getInt8(this.offset+1),this.offset+=2,p;case 209:return p=this.view.getInt16(this.offset+1),this.offset+=3,p;case 210:return p=this.view.getInt32(this.offset+1),this.offset+=5,p;case 211:return p=ra(this.view,this.offset+1),this.offset+=9,p;case 212:return _=1,this.offset++,this.ext(_);case 213:return _=2,this.offset++,this.ext(_);case 214:return _=4,this.offset++,this.ext(_);case 215:return _=8,this.offset++,this.ext(_);case 216:return _=16,this.offset++,this.ext(_);case 217:return _=this.view.getUint8(this.offset+1),this.offset+=2,this.str(_);case 218:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.str(_);case 219:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.str(_);case 220:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.array(_);case 221:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.array(_);case 222:return _=this.view.getUint16(this.offset+1),this.offset+=3,this.map(_);case 223:return _=this.view.getUint32(this.offset+1),this.offset+=5,this.map(_)}throw new Error("Unknown type 0x"+u.toString(16))},this.offset=o||0,this.view=s}};function Td(s){const o=new DataView(s),u=new Xs(o),p=u.parse();if(u.offset!==s.byteLength)throw new Error(s.byteLength-u.offset+" trailing bytes");return p}function ia(s,o){return Object.keys(s).filter(function(u){const p=s[u],_=typeof p;return(!o||p!=null)&&(_!=="function"||!!p.toJSON)})}function Ai(s,o,u,p){const _=typeof s;if(typeof s=="string"){const b=ic(s);if(b<32)return o.setUint8(u,b|160),Ks(o,u+1,s),1+b;if(b<256)return o.setUint8(u,217),o.setUint8(u+1,b),Ks(o,u+2,s),2+b;if(b<65536)return o.setUint8(u,218),o.setUint16(u+1,b),Ks(o,u+3,s),3+b;if(b<4294967296)return o.setUint8(u,219),o.setUint32(u+1,b),Ks(o,u+5,s),5+b}if(ArrayBuffer.isView&&ArrayBuffer.isView(s)&&(s=s.buffer),s instanceof ArrayBuffer){const b=s.byteLength;if(b<256)return o.setUint8(u,196),o.setUint8(u+1,b),new Uint8Array(o.buffer).set(new Uint8Array(s),u+2),2+b;if(b<65536)return o.setUint8(u,197),o.setUint16(u+1,b),new Uint8Array(o.buffer).set(new Uint8Array(s),u+3),3+b;if(b<4294967296)return o.setUint8(u,198),o.setUint32(u+1,b),new Uint8Array(o.buffer).set(new Uint8Array(s),u+5),5+b}if(typeof s=="number"){if(Math.floor(s)!==s)return o.setUint8(u,203),o.setFloat64(u+1,s),9;if(s>=0){if(s<128)return o.setUint8(u,s),1;if(s<256)return o.setUint8(u,204),o.setUint8(u+1,s),2;if(s<65536)return o.setUint8(u,205),o.setUint16(u+1,s),3;if(s<4294967296)return o.setUint8(u,206),o.setUint32(u+1,s),5;if(s<18446744073709552e3)return o.setUint8(u,207),Od(o,u+1,s),9;throw new Error("Number too big 0x"+s.toString(16))}if(s>=-32)return o.setInt8(u,s),1;if(s>=-128)return o.setUint8(u,208),o.setInt8(u+1,s),2;if(s>=-32768)return o.setUint8(u,209),o.setInt16(u+1,s),3;if(s>=-2147483648)return o.setUint8(u,210),o.setInt32(u+1,s),5;if(s>=-9223372036854776e3)return o.setUint8(u,211),Md(o,u+1,s),9;throw new Error("Number too small -0x"+(-s).toString(16).substr(1))}if(_==="undefined")return p?0:(o.setUint8(u,212),o.setUint8(u+1,0),o.setUint8(u+2,0),3);if(s===null)return p?0:(o.setUint8(u,192),1);if(_==="boolean")return o.setUint8(u,s?195:194),1;if(typeof s.toJSON=="function")return Ai(s.toJSON(),o,u,p);if(_==="object"){let b,A=0,U;const X=Array.isArray(s);if(X?b=s.length:(U=ia(s,p),b=U.length),b<16?(o.setUint8(u,b|(X?144:128)),A=1):b<65536?(o.setUint8(u,X?220:222),o.setUint16(u+1,b),A=3):b<4294967296&&(o.setUint8(u,X?221:223),o.setUint32(u+1,b),A=5),X)for(let K=0;K<b;K++)A+=Ai(s[K],o,u+A,p);else if(U)for(let K=0;K<b;K++){const de=U[K];A+=Ai(de,o,u+A),A+=Ai(s[de],o,u+A,p)}return A}if(_==="function")return 0;throw new Error("Unknown type "+_)}function jr(s,o){const u=typeof s;if(u==="string"){const p=ic(s);if(p<32)return 1+p;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(ArrayBuffer.isView&&ArrayBuffer.isView(s)&&(s=s.buffer),s instanceof ArrayBuffer){const p=s.byteLength;if(p<256)return 2+p;if(p<65536)return 3+p;if(p<4294967296)return 5+p}if(typeof s=="number"){if(Math.floor(s)!==s)return 9;if(s>=0){if(s<128)return 1;if(s<256)return 2;if(s<65536)return 3;if(s<4294967296)return 5;if(s<18446744073709552e3)return 9;throw new Error("Number too big 0x"+s.toString(16))}if(s>=-32)return 1;if(s>=-128)return 2;if(s>=-32768)return 3;if(s>=-2147483648)return 5;if(s>=-9223372036854776e3)return 9;throw new Error("Number too small -0x"+s.toString(16).substr(1))}if(u==="boolean")return 1;if(s===null)return o?0:1;if(s===void 0)return o?0:3;if(typeof s.toJSON=="function")return jr(s.toJSON(),o);if(u==="object"){let p,_=0;if(Array.isArray(s)){p=s.length;for(let b=0;b<p;b++)_+=jr(s[b],o)}else{const b=ia(s,o);p=b.length;for(let A=0;A<p;A++){const U=b[A];_+=jr(U)+jr(s[U],o)}}if(p<16)return 1+_;if(p<65536)return 3+_;if(p<4294967296)return 5+_;throw new Error("Array or object too long 0x"+p.toString(16))}if(u==="function")return 0;throw new Error("Unknown type "+u)}var sa={encode:Ys,decode:Td,inspect:Sl,utf8Write:Ks,utf8Read:ta,utf8ByteCount:ic};function kl(s,o){return!!o.get("x-ably-errorcode")}function Cl(s,o){if(kl(s,o))return s.error&&Y.fromValues(s.error)}function El(s){const o={};return s.forEach((u,p)=>{o[p]=u}),o}async function Zs(s,o,u,p,_,b){const A=new Headers(p||{}),U=s?s.toUpperCase():le(b)?"GET":"POST",X=new AbortController;let K;const de=new Promise(ue=>{K=setTimeout(()=>{X.abort(),ue({error:new De("Request timed out",null,408)})},o?o.options.timeouts.httpRequestTimeout:$e.TIMEOUTS.httpRequestTimeout)}),ce={method:U,headers:A,body:b,signal:X.signal};P.Config.isWebworker||(ce.credentials=A.has("authorization")?"include":"same-origin");const be=(async()=>{try{const ue=new URLSearchParams(_||{});ue.set("rnd",Jt());const Oe=u+"?"+ue,Te=await xo().fetch(Oe,ce);if(clearTimeout(K),Te.status==204)return{error:null,statusCode:Te.status};const Ne=Te.headers.get("Content-Type");let lt;Ne&&Ne.indexOf("application/x-msgpack")>-1?lt=await Te.arrayBuffer():Ne&&Ne.indexOf("application/json")>-1?lt=await Te.json():lt=await Te.text();const ft=!!Ne&&Ne.indexOf("application/x-msgpack")===-1,We=El(Te.headers);return Te.ok?{error:null,body:lt,headers:We,unpacked:ft,statusCode:Te.status}:{error:Cl(lt,Te.headers)||new De("Error response received from server: "+Te.status+" body was: "+P.Config.inspect(lt),null,Te.status),body:lt,headers:We,unpacked:ft,statusCode:Te.status}}catch(ue){return clearTimeout(K),{error:ue}}})();return Promise.race([de,be])}var rr={XHRRequest:nc,FetchRequest:Zs},Pi=Hs(wl,Ya);P.Crypto=Pi,P.BufferUtils=Ya,P.Http=dn,P.Config=wl,P.Transports=kd,P.WebStorage=ea;for(const s of[al,ml])s.Crypto=Pi,s._MsgPack=sa;dn.bundledRequestImplementations=rr,S.initLogHandlers(),P.Defaults=xa(bl),P.Config.agent&&(P.Defaults.agent+=" "+P.Config.agent);var Ml={ErrorInfo:Y,Rest:al,Realtime:ml,msgpack:sa,makeProtocolMessageFromDeserialized:nl};if(typeof a.exports=="object"&&typeof r=="object"){var Rd=(s,o,u,p)=>{if(o&&typeof o=="object"||typeof o=="function")for(let _ of Object.getOwnPropertyNames(o))!Object.prototype.hasOwnProperty.call(s,_)&&_!==u&&Object.defineProperty(s,_,{get:()=>o[_],enumerable:!(p=Object.getOwnPropertyDescriptor(o,_))||p.enumerable});return s};a.exports=Rd(a.exports,r)}return a.exports})})(Bu)),Bu.exports}var Ke=gC(),Dh=(n=>(n.Trace="trace",n.Debug="debug",n.Info="info",n.Warn="warn",n.Error="error",n.Silent="silent",n))(Dh||{});const mC=(n,e,r)=>{const a=r?`, context: ${JSON.stringify(r)}`:"",l=`[${new Date().toISOString()}] ${e.valueOf().toUpperCase()} ably-chat: ${n}${a}`;switch(e){case"trace":case"debug":{console.log(l);break}case"info":{console.info(l);break}case"warn":{console.warn(l);break}case"error":{console.error(l);break}}},vC=n=>{const e=n.logHandler??mC;return new Uh(e,n.logLevel)},qy=new Map([["trace",0],["debug",1],["info",2],["warn",3],["error",4],["silent",5]]);class Uh{constructor(e,r,a){this._handler=e,this._context=a;const l=qy.get(r);if(l===void 0)throw new Ke.ErrorInfo(`Invalid log level: ${r}`,5e4,500);this._levelNumber=l}trace(e,r){this._write(e,"trace",0,r)}debug(e,r){this._write(e,"debug",1,r)}info(e,r){this._write(e,"info",2,r)}warn(e,r){this._write(e,"warn",3,r)}error(e,r){this._write(e,"error",4,r)}withContext(e){const r=[...qy.entries()].find(([,a])=>a===this._levelNumber)?.[0]??"error";return new Uh(this._handler,r,this._mergeContext(e))}_write(e,r,a,l){a>=this._levelNumber&&this._handler(e,r,this._mergeContext(l))}_mergeContext(e){return this._context?e?{...this._context,...e}:this._context:e??void 0}}const yC={logLevel:Dh.Error},_C=n=>(n=n??{},{...n,logLevel:n.logLevel??yC.logLevel});function gs(n,e,r){if((Array.isArray(e)||typeof e=="string")&&r)return n.on(e,r),()=>{n.off(r)};if(typeof e=="function")return n.on(e),()=>{n.off(e)};throw new TypeError("Invalid arguments passed to on()")}function wC(n,e,r){if(r)return n.once(e,r),()=>{n.off(r)};throw new TypeError("Invalid arguments passed to once()")}function Oo(n,e,r){if((Array.isArray(e)||typeof e=="string")&&r){const a=n.subscribe(e,r);return()=>{a.then(()=>{n.unsubscribe(r)}).catch(l=>{console.error("Error subscribing to events:",l)})}}else if(typeof e=="function"){const a=n.subscribe(e);return()=>{a.then(()=>{n.unsubscribe(e)}).catch(l=>{console.error("Error subscribing to events:",l)})}}else throw new TypeError("Invalid arguments passed to subscribe()")}const bC=Ke.Realtime.EventEmitter;class di extends bC{}const Cr=n=>(...e)=>n(...e),ms=n=>{const e=n,r=Object.values(e.events).flat().length+e.any.length+Object.values(e.eventsOnce).flat().length+e.anyOnce.length;return r?r>0:!1};class SC{constructor(e,r){this._status="initialized",this._emitter=new di,this._logger=r,this._status=this._mapAblyStatusToChat(e.connection.state),this._error=e.connection.errorReason;const a=l=>{const f=this._mapAblyStatusToChat(l.current);if(f===this._status)return;const h={current:f,previous:this._status,error:l.reason,retryIn:l.retryIn};this._applyStatusChange(h)};this._clearAblyConnectionListener=gs(e.connection,a)}get status(){return this._status}get error(){return this._error}onStatusChange(e){const r=Cr(e);return this._emitter.on(r),{off:()=>{this._emitter.off(r)}}}dispose(){this._logger.trace("DefaultConnection.dispose();"),this._clearAblyConnectionListener(),this._emitter.off()}hasListeners(){return ms(this._emitter)}_applyStatusChange(e){this._status=e.current,this._error=e.error,this._logger.info("Connection state changed",e),this._emitter.emit(e.current,e)}_mapAblyStatusToChat(e){switch(e){case"closing":case"closed":return"failed";default:return e}}}const $y=()=>Math.random().toString(36).slice(2);var Wy=Object.prototype.hasOwnProperty;function Gy(n,e,r){for(r of n.keys())if(Pc(r,e))return r}function Pc(n,e){var r,a,l;if(n===e)return!0;if(n&&e&&(r=n.constructor)===e.constructor){if(r===Date)return n.getTime()===e.getTime();if(r===RegExp)return n.toString()===e.toString();if(r===Array){if((a=n.length)===e.length)for(;a--&&Pc(n[a],e[a]););return a===-1}if(r===Set){if(n.size!==e.size)return!1;for(a of n)if(l=a,l&&typeof l=="object"&&(l=Gy(e,l),!l)||!e.has(l))return!1;return!0}if(r===Map){if(n.size!==e.size)return!1;for(a of n)if(l=a[0],l&&typeof l=="object"&&(l=Gy(e,l),!l)||!Pc(a[1],e.get(l)))return!1;return!0}if(r===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(r===DataView){if((a=n.byteLength)===e.byteLength)for(;a--&&n.getInt8(a)===e.getInt8(a););return a===-1}if(ArrayBuffer.isView(n)){if((a=n.byteLength)===e.byteLength)for(;a--&&n[a]===e[a];);return a===-1}if(!r||typeof n=="object"){a=0;for(r in n)if(Wy.call(n,r)&&++a&&!Wy.call(e,r)||!(r in e)||!Pc(n[r],e[r]))return!1;return Object.keys(e).length===a}}return n!==n&&e!==e}var vs=(n=>(n.Created="message.created",n.Updated="message.updated",n.Deleted="message.deleted",n))(vs||{}),Hy=(n=>(n.ChatMessage="chat.message",n))(Hy||{}),Jy=(n=>(n.Occupancy="[meta]occupancy",n))(Jy||{}),Er=(n=>(n.MessageCreate="message.create",n.MessageUpdate="message.update",n.MessageDelete="message.delete",n.MessageAnnotationSummary="message.summary",n.MessageMetaOccupancy="meta.occupancy",n))(Er||{}),$r=(n=>(n.Started="typing.started",n.Stopped="typing.stopped",n))($r||{}),To=(n=>(n.SetChanged="typing.set.changed",n))(To||{}),Bh=(n=>(n.Reaction="roomReaction",n))(Bh||{}),Fh=(n=>(n.Reaction="reaction",n))(Fh||{}),Ro=(n=>(n.Unique="unique",n.Distinct="distinct",n.Multiple="multiple",n))(Ro||{}),Fu=(n=>(n.Unique="reaction:unique.v1",n.Distinct="reaction:distinct.v1",n.Multiple="reaction:multiple.v1",n))(Fu||{});const kC={"reaction:unique.v1":"unique","reaction:distinct.v1":"distinct","reaction:multiple.v1":"multiple"};var fi=(n=>(n.Create="reaction.create",n.Delete="reaction.delete",n.Summary="reaction.summary",n))(fi||{}),Vh=(n=>(n.Updated="occupancy.updated",n))(Vh||{}),Ic=(n=>(n.Discontinuity="room.discontinuity",n))(Ic||{}),Vu=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function CC(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var zu={exports:{}};zu.exports;var Qy;function EC(){return Qy||(Qy=1,(function(n,e){var r=200,a="__lodash_hash_undefined__",l=9007199254740991,f="[object Arguments]",h="[object Array]",v="[object Boolean]",y="[object Date]",k="[object Error]",E="[object Function]",O="[object GeneratorFunction]",D="[object Map]",x="[object Number]",L="[object Object]",R="[object Promise]",N="[object RegExp]",q="[object Set]",Q="[object String]",ee="[object Symbol]",P="[object WeakMap]",$="[object ArrayBuffer]",G="[object DataView]",ae="[object Float32Array]",ye="[object Float64Array]",Ce="[object Int8Array]",Ve="[object Int16Array]",S="[object Int32Array]",ze="[object Uint8Array]",Ee="[object Uint8ClampedArray]",Y="[object Uint16Array]",De="[object Uint32Array]",it=/[\\^$.*+?()[\]{}|]/g,we=/\w*$/,he=/^\[object .+?Constructor\]$/,ke=/^(?:0|[1-9]\d*)$/,oe={};oe[f]=oe[h]=oe[$]=oe[G]=oe[v]=oe[y]=oe[ae]=oe[ye]=oe[Ce]=oe[Ve]=oe[S]=oe[D]=oe[x]=oe[L]=oe[N]=oe[q]=oe[Q]=oe[ee]=oe[ze]=oe[Ee]=oe[Y]=oe[De]=!0,oe[k]=oe[E]=oe[P]=!1;var J=typeof Vu=="object"&&Vu&&Vu.Object===Object&&Vu,le=typeof self=="object"&&self&&self.Object===Object&&self,g=J||le||Function("return this")(),M=e&&!e.nodeType&&e,C=M&&!0&&n&&!n.nodeType&&n,j=C&&C.exports===M;function F(I,ne){return I.set(ne[0],ne[1]),I}function H(I,ne){return I.add(ne),I}function ie(I,ne){for(var se=-1,Ie=I?I.length:0;++se<Ie&&ne(I[se],se,I)!==!1;);return I}function fe(I,ne){for(var se=-1,Ie=ne.length,Pt=I.length;++se<Ie;)I[Pt+se]=ne[se];return I}function Me(I,ne,se,Ie){for(var Pt=-1,Ut=I?I.length:0;++Pt<Ut;)se=ne(se,I[Pt],Pt,I);return se}function qe(I,ne){for(var se=-1,Ie=Array(I);++se<I;)Ie[se]=ne(se);return Ie}function Xe(I,ne){return I?.[ne]}function Vt(I){var ne=!1;if(I!=null&&typeof I.toString!="function")try{ne=!!(I+"")}catch{}return ne}function wn(I){var ne=-1,se=Array(I.size);return I.forEach(function(Ie,Pt){se[++ne]=[Pt,Ie]}),se}function xn(I,ne){return function(se){return I(ne(se))}}function mt(I){var ne=-1,se=Array(I.size);return I.forEach(function(Ie){se[++ne]=Ie}),se}var At=Array.prototype,en=Function.prototype,zt=Object.prototype,Ze=g["__core-js_shared__"],Ln=(function(){var I=/[^.]+$/.exec(Ze&&Ze.keys&&Ze.keys.IE_PROTO||"");return I?"Symbol(src)_1."+I:""})(),Jn=en.toString,Jt=zt.hasOwnProperty,Mr=zt.toString,qi=RegExp("^"+Jn.call(Jt).replace(it,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Nt=j?g.Buffer:void 0,Dt=g.Symbol,cn=g.Uint8Array,Wr=xn(Object.getPrototypeOf,Object),hi=Object.create,Ta=zt.propertyIsEnumerable,Io=At.splice,$i=Object.getOwnPropertySymbols,xo=Nt?Nt.isBuffer:void 0,ws=xn(Object.keys,Object),pi=_e(g,"DataView"),Qn=_e(g,"Map"),gi=_e(g,"Promise"),Or=_e(g,"Set"),bt=_e(g,"WeakMap"),jn=_e(Object,"create"),Lo=Qt(pi),Ra=Qt(Qn),bn=Qt(gi),Aa=Qt(Or),Pa=Qt(bt),Wi=Dt?Dt.prototype:void 0,bs=Wi?Wi.valueOf:void 0;function Sn(I){var ne=-1,se=I?I.length:0;for(this.clear();++ne<se;){var Ie=I[ne];this.set(Ie[0],Ie[1])}}function Ss(){this.__data__=jn?jn(null):{}}function mi(I){return this.has(I)&&delete this.__data__[I]}function Nc(I){var ne=this.__data__;if(jn){var se=ne[I];return se===a?void 0:se}return Jt.call(ne,I)?ne[I]:void 0}function vi(I){var ne=this.__data__;return jn?ne[I]!==void 0:Jt.call(ne,I)}function ks(I,ne){var se=this.__data__;return se[I]=jn&&ne===void 0?a:ne,this}Sn.prototype.clear=Ss,Sn.prototype.delete=mi,Sn.prototype.get=Nc,Sn.prototype.has=vi,Sn.prototype.set=ks;function tn(I){var ne=-1,se=I?I.length:0;for(this.clear();++ne<se;){var Ie=I[ne];this.set(Ie[0],Ie[1])}}function jo(){this.__data__=[]}function Dc(I){var ne=this.__data__,se=Ms(ne,I);if(se<0)return!1;var Ie=ne.length-1;return se==Ie?ne.pop():Io.call(ne,se,1),!0}function Uc(I){var ne=this.__data__,se=Ms(ne,I);return se<0?void 0:ne[se][1]}function Cs(I){return Ms(this.__data__,I)>-1}function Tr(I,ne){var se=this.__data__,Ie=Ms(se,I);return Ie<0?se.push([I,ne]):se[Ie][1]=ne,this}tn.prototype.clear=jo,tn.prototype.delete=Dc,tn.prototype.get=Uc,tn.prototype.has=Cs,tn.prototype.set=Tr;function Kn(I){var ne=-1,se=I?I.length:0;for(this.clear();++ne<se;){var Ie=I[ne];this.set(Ie[0],Ie[1])}}function Ia(){this.__data__={hash:new Sn,map:new(Qn||tn),string:new Sn}}function Bc(I){return St(this,I).delete(I)}function $e(I){return St(this,I).get(I)}function xa(I){return St(this,I).has(I)}function La(I,ne){return St(this,I).set(I,ne),this}Kn.prototype.clear=Ia,Kn.prototype.delete=Bc,Kn.prototype.get=$e,Kn.prototype.has=xa,Kn.prototype.set=La;function hr(I){this.__data__=new tn(I)}function ja(){this.__data__=new tn}function Ot(I){return this.__data__.delete(I)}function Et(I){return this.__data__.get(I)}function Fc(I){return this.__data__.has(I)}function yi(I,ne){var se=this.__data__;if(se instanceof tn){var Ie=se.__data__;if(!Qn||Ie.length<r-1)return Ie.push([I,ne]),this;se=this.__data__=new Kn(Ie)}return se.set(I,ne),this}hr.prototype.clear=ja,hr.prototype.delete=Ot,hr.prototype.get=Et,hr.prototype.has=Fc,hr.prototype.set=yi;function Es(I,ne){var se=Bn(I)||Jr(I)?qe(I.length,String):[],Ie=se.length,Pt=!!Ie;for(var Ut in I)Jt.call(I,Ut)&&!(Pt&&(Ut=="length"||Fo(Ut,Ie)))&&se.push(Ut);return se}function Gi(I,ne,se){var Ie=I[ne];(!(Jt.call(I,ne)&&Hr(Ie,se))||se===void 0&&!(ne in I))&&(I[ne]=se)}function Ms(I,ne){for(var se=I.length;se--;)if(Hr(I[se][0],ne))return se;return-1}function No(I,ne){return I&&Rs(ne,Ar(ne),I)}function _i(I,ne,se,Ie,Pt,Ut,Fn){var qt;if(Ie&&(qt=Ut?Ie(I,Pt,Ut,Fn):Ie(I)),qt!==void 0)return qt;if(!Rr(I))return I;var pr=Bn(I);if(pr){if(qt=Uo(I),!ne)return Ts(I,qt)}else{var Bt=Tt(I),Ci=Bt==E||Bt==O;if(Xn(I))return zc(I,ne);if(Bt==L||Bt==f||Ci&&!Ut){if(Vt(I))return Ut?I:{};if(qt=Bo(Ci?{}:I),!ne)return Gr(I,No(qt,I))}else{if(!oe[Bt])return Ut?I:{};qt=Ua(I,Bt,_i,ne)}}Fn||(Fn=new hr);var qo=Fn.get(I);if(qo)return qo;if(Fn.set(I,qt),!pr)var Pr=se?$c(I):Ar(I);return ie(Pr||I,function(Ei,Yi){Pr&&(Yi=Ei,Ei=I[Yi]),Gi(qt,Yi,_i(Ei,ne,se,Ie,Yi,I,Fn))}),qt}function Nn(I){return Rr(I)?hi(I):{}}function Na(I,ne,se){var Ie=ne(I);return Bn(I)?Ie:fe(Ie,se(I))}function Dn(I){return Mr.call(I)}function Da(I){if(!Rr(I)||Hi(I))return!1;var ne=Qr(I)||Vt(I)?qi:he;return ne.test(Qt(I))}function Vc(I){if(!Un(I))return ws(I);var ne=[];for(var se in Object(I))Jt.call(I,se)&&se!="constructor"&&ne.push(se);return ne}function zc(I,ne){if(ne)return I.slice();var se=new I.constructor(I.length);return I.copy(se),se}function wi(I){var ne=new I.constructor(I.byteLength);return new cn(ne).set(new cn(I)),ne}function Os(I,ne){var se=ne?wi(I.buffer):I.buffer;return new I.constructor(se,I.byteOffset,I.byteLength)}function ln(I,ne,se){var Ie=ne?se(wn(I),!0):wn(I);return Me(Ie,F,new I.constructor)}function bi(I){var ne=new I.constructor(I.source,we.exec(I));return ne.lastIndex=I.lastIndex,ne}function Si(I,ne,se){var Ie=ne?se(mt(I),!0):mt(I);return Me(Ie,H,new I.constructor)}function qc(I){return bs?Object(bs.call(I)):{}}function Do(I,ne){var se=ne?wi(I.buffer):I.buffer;return new I.constructor(se,I.byteOffset,I.length)}function Ts(I,ne){var se=-1,Ie=I.length;for(ne||(ne=Array(Ie));++se<Ie;)ne[se]=I[se];return ne}function Rs(I,ne,se,Ie){se||(se={});for(var Pt=-1,Ut=ne.length;++Pt<Ut;){var Fn=ne[Pt],qt=void 0;Gi(se,Fn,qt===void 0?I[Fn]:qt)}return se}function Gr(I,ne){return Rs(I,As(I),ne)}function $c(I){return Na(I,Ar,As)}function St(I,ne){var se=I.__data__;return Vo(ne)?se[typeof ne=="string"?"string":"hash"]:se.map}function _e(I,ne){var se=Xe(I,ne);return Da(se)?se:void 0}var As=$i?xn($i,Object):ki,Tt=Dn;(pi&&Tt(new pi(new ArrayBuffer(1)))!=G||Qn&&Tt(new Qn)!=D||gi&&Tt(gi.resolve())!=R||Or&&Tt(new Or)!=q||bt&&Tt(new bt)!=P)&&(Tt=function(I){var ne=Mr.call(I),se=ne==L?I.constructor:void 0,Ie=se?Qt(se):void 0;if(Ie)switch(Ie){case Lo:return G;case Ra:return D;case bn:return R;case Aa:return q;case Pa:return P}return ne});function Uo(I){var ne=I.length,se=I.constructor(ne);return ne&&typeof I[0]=="string"&&Jt.call(I,"index")&&(se.index=I.index,se.input=I.input),se}function Bo(I){return typeof I.constructor=="function"&&!Un(I)?Nn(Wr(I)):{}}function Ua(I,ne,se,Ie){var Pt=I.constructor;switch(ne){case $:return wi(I);case v:case y:return new Pt(+I);case G:return Os(I,Ie);case ae:case ye:case Ce:case Ve:case S:case ze:case Ee:case Y:case De:return Do(I,Ie);case D:return ln(I,Ie,se);case x:case Q:return new Pt(I);case N:return bi(I);case q:return Si(I,Ie,se);case ee:return qc(I)}}function Fo(I,ne){return ne=ne??l,!!ne&&(typeof I=="number"||ke.test(I))&&I>-1&&I%1==0&&I<ne}function Vo(I){var ne=typeof I;return ne=="string"||ne=="number"||ne=="symbol"||ne=="boolean"?I!=="__proto__":I===null}function Hi(I){return!!Ln&&Ln in I}function Un(I){var ne=I&&I.constructor,se=typeof ne=="function"&&ne.prototype||zt;return I===se}function Qt(I){if(I!=null){try{return Jn.call(I)}catch{}try{return I+""}catch{}}return""}function Yn(I){return _i(I,!0,!0)}function Hr(I,ne){return I===ne||I!==I&&ne!==ne}function Jr(I){return Qi(I)&&Jt.call(I,"callee")&&(!Ta.call(I,"callee")||Mr.call(I)==f)}var Bn=Array.isArray;function Ji(I){return I!=null&&zo(I.length)&&!Qr(I)}function Qi(I){return Ba(I)&&Ji(I)}var Xn=xo||Ki;function Qr(I){var ne=Rr(I)?Mr.call(I):"";return ne==E||ne==O}function zo(I){return typeof I=="number"&&I>-1&&I%1==0&&I<=l}function Rr(I){var ne=typeof I;return!!I&&(ne=="object"||ne=="function")}function Ba(I){return!!I&&typeof I=="object"}function Ar(I){return Ji(I)?Es(I):Vc(I)}function ki(){return[]}function Ki(){return!1}n.exports=Yn})(zu,zu.exports)),zu.exports}var MC=EC();const ys=CC(MC);let zh=class Fl{constructor({serial:e,clientId:r,text:a,metadata:l,headers:f,action:h,version:v,timestamp:y,reactions:k}){this.serial=e,this.clientId=r,this.text=a,this.metadata=l,this.headers=f,this.action=h,this.version=v,this.timestamp=y,this.reactions=k,Object.freeze(this.version),Object.freeze(this.reactions),Object.freeze(this.reactions.multiple),Object.freeze(this.reactions.distinct),Object.freeze(this.reactions.unique),Object.freeze(this)}get isUpdated(){return this.action===Er.MessageUpdate}get isDeleted(){return this.action===Er.MessageDelete}get updatedBy(){return this.isUpdated?this.version.clientId:void 0}get deletedBy(){return this.isDeleted?this.version.clientId:void 0}get updatedAt(){return this.isUpdated?this.version.timestamp:void 0}get deletedAt(){return this.isDeleted?this.version.timestamp:void 0}isOlderVersionOf(e){return this._compareVersions(this,e,(r,a)=>r.serial<a.serial)}isNewerVersionOf(e){return this._compareVersions(this,e,(r,a)=>r.serial>a.serial)}isSameVersionAs(e){return this._compareVersions(this,e,(r,a)=>r.serial===a.serial)}_isNewerOrSameVersionOf(e){return this._compareVersions(this,e,(r,a)=>r.serial>=a.serial)}before(e){return this.serial<e.serial}after(e){return this.serial>e.serial}equal(e){return this.serial===e.serial}isSameAs(e){return this.equal(e)}with(e){if("serial"in e)return this._getLatestMessageVersion(e);if(e.type===vs.Created)throw new Ke.ErrorInfo("cannot apply a created event to a message",4e4,400);if(e.type===fi.Summary){if(e.summary.messageSerial!==this.serial)throw new Ke.ErrorInfo("cannot apply event for a different message",4e4,400);const r={unique:ys(e.summary.unique),distinct:ys(e.summary.distinct),multiple:ys(e.summary.multiple)};return Fl._clone(this,{reactions:r})}return this._getLatestMessageVersion(e.message)}_compareVersions(e,r,a){return e.equal(r)?e.equal(r)&&a(e.version,r.version):!1}_getLatestMessageVersion(e){if(e.serial!==this.serial)throw new Ke.ErrorInfo("cannot apply event for a different message",4e4,400);return this._isNewerOrSameVersionOf(e)?this:Fl._clone(e,{reactions:this.reactions})}static _clone(e,r){return new Fl({serial:r?.serial??e.serial,clientId:r?.clientId??e.clientId,text:r?.text??e.text,metadata:r?.metadata??ys(e.metadata),headers:r?.headers??ys(e.headers),action:r?.action??e.action,version:r?.version??ys(e.version),timestamp:r?.timestamp??e.timestamp,reactions:r?.reactions??ys(e.reactions)})}copy(e={}){return Fl._clone(this,e)}};const qh=()=>({unique:{},distinct:{},multiple:{}}),OC=n=>{const e=n,r=e.data&&typeof e.data=="object"?e.data:{},a=e.extras&&typeof e.extras=="object"?e.extras:{},l=e.clientId||"",f=r.text||"",h=new Date(e.timestamp||0),v=e.serial||"",y=r.metadata&&typeof r.metadata=="object"?r.metadata:{},k=a.headers||{},E={...e.version,serial:e.version.serial||v,timestamp:new Date(e.version.timestamp||h)},O=Object.values(Er).includes(e.action)?e.action:Er.MessageCreate;return new zh({serial:v,clientId:l,text:f,metadata:y,headers:k,action:O,version:E,timestamp:h,reactions:qh()})},Oa=n=>{let e="";if(typeof n=="string")e=n;else try{"serial"in n&&(e=n.serial)}catch{}if(e==="")throw new Ke.ErrorInfo("invalid serial; must be string or object with serial property",4e4,400);return e},TC={"annotation.create":fi.Create,"annotation.delete":fi.Delete};class Ky{constructor(e,r,a,l,f){this._logger=e,this._options=r,this._api=a,this._roomName=l,this._channel=f,this._emitter=new di,this._unsubscribeMessageEvents=Oo(f,this._processMessageEvent.bind(this)),this._options?.rawMessageReactions&&(this._unsubscribeAnnotationEvents=Oo(f.annotations,this._processAnnotationEvent.bind(this))),this._defaultType=this._options?.defaultMessageReactionType??Ro.Distinct}_processAnnotationEvent(e){this._logger.trace("MessagesReactions._processAnnotationEvent();",{event:e});const r=kC[e.type];if(!r){this._logger.info("MessagesReactions._processAnnotationEvent(); ignoring unknown reaction type",{event:e});return}const a=TC[e.action];if(!a){this._logger.info("MessagesReactions._processAnnotationEvent(); ignoring unknown reaction event type",{event:e});return}const l=e.name??"",f={type:a,timestamp:new Date(e.timestamp),reaction:{messageSerial:e.messageSerial,type:r,name:l,clientId:e.clientId??""}};e.count?f.reaction.count=e.count:a===fi.Create&&r===Ro.Multiple&&(f.reaction.count=1),this._emitter.emit(a,f)}_processMessageEvent(e){if(this._logger.trace("MessagesReactions._processMessageEvent();",{event:e}),e.action!==Er.MessageAnnotationSummary.valueOf())return;const r=e.serial,a=e.annotations.summary,l=a[Fu.Unique]??{},f=a[Fu.Distinct]??{},h=a[Fu.Multiple]??{};this._emitter.emit(fi.Summary,{type:fi.Summary,summary:{messageSerial:r,unique:l,distinct:f,multiple:h}})}send(e,r){this._logger.trace("MessagesReactions.send();",{messageSerial:e,params:r});const a=Oa(e);let{type:l,count:f}=r;l||(l=this._defaultType),l===Ro.Multiple&&!f&&(f=1);const h={type:l,name:r.name};return f&&(h.count=f),this._api.sendMessageReaction(this._roomName,a,h)}delete(e,r){this._logger.trace("MessagesReactions.delete();",{messageSerial:e,params:r});const a=Oa(e);let l=r?.type;if(l||(l=this._defaultType),l!==Ro.Unique&&!r?.name)throw new Ke.ErrorInfo(`cannot delete reaction of type ${l} without a name`,40001,400);const f={type:l};return l!==Ro.Unique&&(f.name=r?.name),this._api.deleteMessageReaction(this._roomName,a,f)}subscribe(e){this._logger.trace("MessagesReactions.subscribe();");const r=Cr(e);return this._emitter.on(fi.Summary,r),{unsubscribe:()=>{this._emitter.off(r)}}}subscribeRaw(e){if(this._logger.trace("MessagesReactions.subscribeRaw();"),!this._options?.rawMessageReactions)throw new Ke.ErrorInfo("Raw message reactions are not enabled",40001,400);const r=Cr(e);return this._emitter.on([fi.Create,fi.Delete],r),{unsubscribe:()=>{this._emitter.off(r)}}}static channelOptionMerger(e){return r=>(r.modes.includes("ANNOTATION_PUBLISH")||r.modes.push("ANNOTATION_PUBLISH"),e.messages.rawMessageReactions&&!r.modes.includes("ANNOTATION_SUBSCRIBE")&&r.modes.push("ANNOTATION_SUBSCRIBE"),r)}clientReactions(e,r){this._logger.trace("MessagesReactions.clientReactions();",{messageSerial:e,clientId:r});const a=Oa(e);return this._api.getClientReactions(this._roomName,a,r)}dispose(){this._logger.trace("DefaultMessageReactions.dispose();"),this._emitter.off(),this._unsubscribeMessageEvents(),this._unsubscribeAnnotationEvents?.(),this._logger.debug("DefaultMessageReactions.dispose(); disposed successfully")}hasListeners(){return ms(this._emitter)}}const qu=n=>{const e={...qh(),...n.reactions},r=Object.values(Er).includes(n.action)?n.action:Er.MessageCreate,a={serial:n.version.serial,timestamp:new Date(n.version.timestamp),clientId:n.version.clientId,description:n.version.description,metadata:n.version.metadata};return new zh({serial:n.serial,clientId:n.clientId,text:n.text,metadata:n.metadata,headers:n.headers,action:r,version:a,timestamp:new Date(n.timestamp),reactions:e})},RC=new Map([[Er.MessageCreate,vs.Created],[Er.MessageUpdate,vs.Updated],[Er.MessageDelete,vs.Deleted]]);var $h=(n=>(n.OldestFirst="oldestFirst",n.NewestFirst="newestFirst",n))($h||{});class AC{constructor(e,r,a,l,f,h){this._pendingPromiseRejecters=new Set,this._pendingAttachListeners=new Set,this._emitter=new di,this._roomName=e,this._options=r,this._channel=a,this._chatApi=l,this._clientId=f,this._logger=h,this._listenerSubscriptionPoints=new Map,this._reactions=new Ky(this._logger,r,this._chatApi,this._roomName,this._channel);const v=this._processEvent.bind(this),y=E=>{this._handleAttach(E.resumed)},k=E=>{E.current==="attached"&&E.previous==="attached"&&this._handleAttach(E.resumed)};this._unsubscribeMessageEvents=Oo(this._channel,[Hy.ChatMessage],v),this._offChannelAttached=gs(this._channel,"attached",y),this._offChannelUpdate=gs(this._channel,"update",k)}get reactions(){return this._reactions}async _getBeforeSubscriptionStart(e,r){this._logger.trace("DefaultSubscriptionManager.getBeforeSubscriptionStart();");const a=this._listenerSubscriptionPoints.get(e);if(a===void 0)throw this._logger.error("DefaultSubscriptionManager.getBeforeSubscriptionStart(); listener has not been subscribed yet"),new Ke.ErrorInfo("cannot query history; listener has not been subscribed yet",4e4,400);const l=await a;return this._chatApi.history(this._roomName,{...r,orderBy:"newestFirst",...l})}_handleAttach(e){if(this._logger.trace("DefaultSubscriptionManager.handleAttach();"),e)return;const r=this._subscribeAtChannelAttach();for(const[a]of this._listenerSubscriptionPoints.entries())this._listenerSubscriptionPoints.set(a,r)}async _resolveSubscriptionStart(){const e=this._getChannelProperties();if(e.state==="attached"){if(e.properties.channelSerial)return{fromSerial:e.properties.channelSerial};throw this._logger.error("DefaultSubscriptionManager.handleAttach(); channelSerial is undefined"),new Ke.ErrorInfo("channel is attached, but channelSerial is not defined",4e4,400)}return this._subscribeAtChannelAttach()}_getChannelProperties(){return this._channel}async _subscribeAtChannelAttach(){const e=this._getChannelProperties();return new Promise((r,a)=>{this._pendingPromiseRejecters.add(a);const l=()=>{this._pendingPromiseRejecters.delete(a)};if(e.state==="attached"){this._logger.debug("Messages._subscribeAtChannelAttach(); channel is attached already, using attachSerial",{attachSerial:e.properties.attachSerial}),l(),e.properties.attachSerial?r({fromSerial:e.properties.attachSerial}):(this._logger.error("DefaultSubscriptionManager.handleAttach(); attachSerial is undefined"),l(),a(new Ke.ErrorInfo("channel is attached, but attachSerial is not defined",4e4,400)));return}const f=wC(e,"attached",()=>{this._logger.debug("Messages._subscribeAtChannelAttach(); channel is now attached, using attachSerial",{attachSerial:e.properties.attachSerial}),l(),this._pendingAttachListeners.delete(f),e.properties.attachSerial?r({fromSerial:e.properties.attachSerial}):(this._logger.error("DefaultSubscriptionManager.handleAttach(); attachSerial is undefined"),a(new Ke.ErrorInfo("channel is attached, but attachSerial is not defined",4e4,400)))});this._pendingAttachListeners.add(f)})}async history(e){return this._logger.trace("Messages.query();"),this._chatApi.history(this._roomName,e)}get(e){return this._logger.trace("Messages.get();",{serial:e}),this._chatApi.getMessage(this._roomName,Oa(e))}async send(e){this._logger.trace("Messages.send();",{params:e});const{text:r,metadata:a,headers:l}=e,f=await this._chatApi.sendMessage(this._roomName,{text:r,headers:l,metadata:a}),h=new Date(f.timestamp);return new zh({serial:f.serial,clientId:this._clientId,text:r,metadata:a??{},headers:l??{},action:Er.MessageCreate,version:{serial:f.serial,timestamp:h},timestamp:h,reactions:qh()})}async delete(e,r){this._logger.trace("Messages.delete();",{params:r}),e=Oa(e),this._logger.debug("Messages.delete(); serial",{serial:e});const a=await this._chatApi.deleteMessage(this._roomName,e,r);return qu(a)}async update(e,r,a){this._logger.trace("Messages.update();",{updateParams:r,details:a}),e=Oa(e),this._logger.debug("Messages.update(); serial",{serial:e});const l=await this._chatApi.updateMessage(this._roomName,e,{message:{text:r.text,metadata:r.metadata,headers:r.headers},...a});return this._logger.debug("Messages.update(); message update successfully",{updateParams:r}),qu(l)}subscribe(e){this._logger.trace("Messages.subscribe();");const r=Cr(e);this._emitter.on([vs.Created,vs.Updated,vs.Deleted],r);const a=this._resolveSubscriptionStart();return a.catch(()=>{this._logger.debug("Messages.subscribe(); subscription point was not resolved before the room was released")}),this._listenerSubscriptionPoints.set(r,a),{unsubscribe:()=>{this._listenerSubscriptionPoints.delete(r),this._logger.trace("Messages.unsubscribe();"),this._emitter.off(r)},historyBeforeSubscribe:l=>this._getBeforeSubscriptionStart(r,l)}}_processEvent(e){this._logger.trace("Messages._processEvent();",{channelEventMessage:e});const{action:r}=e,a=RC.get(r);if(!a){this._logger.debug("Messages._processEvent(); received unknown message action",{action:r});return}const l=OC(e);this._emitter.emit(a,{type:a,message:l})}dispose(){this._logger.trace("DefaultMessages.dispose();"),this._emitter.off();const e=new Ke.ErrorInfo("room has been disposed",4e4,400);for(const r of this._pendingPromiseRejecters)try{r(e)}catch{}this._pendingPromiseRejecters.clear(),this._listenerSubscriptionPoints.clear();for(const r of this._pendingAttachListeners)r();this._pendingAttachListeners.clear(),this._unsubscribeMessageEvents(),this._offChannelAttached(),this._offChannelUpdate(),this._reactions.dispose(),this._logger.debug("DefaultMessages.dispose(); disposed successfully")}hasListeners(){return ms(this._emitter)}}class PC{constructor(e,r){this._apiProtocolVersion=4,this._realtime=e,this._logger=r}async history(e,r){const a={...r};if(r.orderBy)switch(r.orderBy){case $h.NewestFirst:{a.direction="backwards";break}case $h.OldestFirst:{a.direction="forwards";break}default:throw new Ke.ErrorInfo(`invalid orderBy value: ${r.orderBy}`,4e4,400)}const l=await this._makeAuthorizedPaginatedRequest(this._roomUrl(e,"/messages"),a);return this._recursivePaginateMessages(l)}_recursivePaginateMessages(e){const r={};return r.items=e.items.map(a=>qu(a)),r.next=()=>e.next().then(a=>a?this._recursivePaginateMessages(a):null),r.first=()=>e.first().then(a=>this._recursivePaginateMessages(a)),r.current=()=>e.current().then(a=>this._recursivePaginateMessages(a)),r.hasNext=()=>e.hasNext(),r.isLast=()=>e.isLast(),{...e,...r}}async getMessage(e,r){const a=await this._makeAuthorizedRequest(this._messageUrl(e,r),"GET");return qu(a)}deleteMessage(e,r,a){const l={...a?.description&&{description:a.description},...a?.metadata&&{metadata:a.metadata}};return this._makeAuthorizedRequest(this._messageUrl(e,r,"/delete"),"POST",l,{})}sendMessage(e,r){const a={text:r.text,...r.metadata&&{metadata:r.metadata},...r.headers&&{headers:r.headers}};return this._makeAuthorizedRequest(this._roomUrl(e,"/messages"),"POST",a)}updateMessage(e,r,a){return this._makeAuthorizedRequest(this._messageUrl(e,r),"PUT",a)}sendMessageReaction(e,r,a){return this._makeAuthorizedRequest(this._messageUrl(e,r,"/reactions"),"POST",a)}deleteMessageReaction(e,r,a){return this._makeAuthorizedRequest(this._messageUrl(e,r,"/reactions"),"DELETE",void 0,a)}getClientReactions(e,r,a){const l=a?{forClientId:a}:{};return this._makeAuthorizedRequest(this._messageUrl(e,r,"/client-reactions"),"GET",void 0,l)}getOccupancy(e){return this._makeAuthorizedRequest(this._roomUrl(e,"/occupancy"),"GET")}async _makeAuthorizedRequest(e,r,a,l){return(await this._doRequest(e,r,l,a)).items[0]}async _makeAuthorizedPaginatedRequest(e,r,a){return this._doRequest(e,"GET",r,a)}async _doRequest(e,r,a,l){const f=await this._realtime.request(r,e,this._apiProtocolVersion,a,l);if(!f.success)throw this._logger.error("ChatApi._doRequest(); failed to make request",{url:e,method:r,statusCode:f.statusCode,errorCode:f.errorCode,errorMessage:f.errorMessage}),new Ke.ErrorInfo(f.errorMessage,f.errorCode,f.statusCode);return f}_roomUrl(e,r=""){return`/chat/v4/rooms/${encodeURIComponent(e)}${r}`}_messageUrl(e,r,a=""){return`${this._roomUrl(e,"/messages")}/${encodeURIComponent(r)}${a}`}}var Ao=(n=>(n[n.BadRequest=4e4]="BadRequest",n[n.MessageRejectedByBeforePublishRule=42211]="MessageRejectedByBeforePublishRule",n[n.MessageRejectedByModeration=42213]="MessageRejectedByModeration",n[n.PresenceAutoReentryFailed=91004]="PresenceAutoReentryFailed",n[n.RoomDiscontinuity=102100]="RoomDiscontinuity",n[n.RoomInFailedState=102101]="RoomInFailedState",n[n.RoomIsReleasing=102102]="RoomIsReleasing",n[n.RoomIsReleased=102103]="RoomIsReleased",n[n.RoomReleasedBeforeOperationCompleted=102106]="RoomReleasedBeforeOperationCompleted",n))(Ao||{});const IC=n=>`${n}::$chat`,$u="0.14.1",Yy=`chat-js/${$u}`,xC=`chat-react/${$u}`,Xy=["PUBLISH","SUBSCRIBE"],LC={params:{agent:Yy},attachOnSubscribe:!1,modes:Xy},jC={params:{agent:`${Yy} ${xC}`},attachOnSubscribe:!1,modes:Xy};class NC{constructor(e,r,a,l){a.trace("ChannelManager();",{isReact:l}),this._realtime=r,this._logger=a,this._isReact=l,this._registeredOptions=this._defaultChannelOptions(),this._channelId=IC(e)}mergeOptions(e){if(this._logger.trace("ChannelManager.mergeOptions();"),this._resolvedChannel)throw this._logger.error("channel options cannot be modified after the channel has been requested"),new Ke.ErrorInfo("channel options cannot be modified after the channel has been requested",4e4,400);this._registeredOptions=e(this._registeredOptions)}get(){return this._logger.trace("ChannelManager.get();"),this._resolvedChannel??=this._realtime.channels.get(this._channelId,this._registeredOptions),this._resolvedChannel}release(){this._logger.trace("ChannelManager.release();",{channelId:this._channelId}),this._resolvedChannel&&this._realtime.channels.release(this._channelId)}_defaultChannelOptions(){this._logger.trace("ChannelManager._defaultChannelOptions();");const e=this._isReact?jC:LC;return this._logger.trace(this._isReact?"using react channel options":"using default channel options"),{...e,modes:[...e.modes??[]]}}}const DC=n=>{const e=n;let r=0,a=0;if(!e.data||typeof e.data!="object")return{connections:r,presenceMembers:a};const{metrics:l}=e.data;return!l||typeof l!="object"?{connections:r,presenceMembers:a}:(typeof l.connections=="number"&&Number.isInteger(l.connections)&&(r=l.connections),typeof l.presenceMembers=="number"&&Number.isInteger(l.presenceMembers)&&(a=l.presenceMembers),{connections:r,presenceMembers:a})};class Zy{constructor(e,r,a,l,f){this._emitter=new di,this._roomName=e,this._channel=r,this._chatApi=a,this._logger=l,this._roomOptions=f;const h=this._internalOccupancyListener.bind(this);this._roomOptions.occupancy.enableEvents?(this._logger.debug("DefaultOccupancy(); subscribing to occupancy events"),this._unsubscribeOccupancyEvents=Oo(this._channel,[Jy.Occupancy],h)):this._unsubscribeOccupancyEvents=()=>{}}subscribe(e){if(this._logger.trace("Occupancy.subscribe();"),!this._roomOptions.occupancy.enableEvents)throw new Ke.ErrorInfo("cannot subscribe to occupancy; occupancy events are not enabled in room options",4e4,400);const r=Cr(e);return this._emitter.on(r),{unsubscribe:()=>{this._logger.trace("Occupancy.unsubscribe();"),this._emitter.off(r)}}}async get(){return this._logger.trace("Occupancy.get();"),this._chatApi.getOccupancy(this._roomName)}current(){if(this._logger.trace("Occupancy.current();"),!this._roomOptions.occupancy.enableEvents)throw new Ke.ErrorInfo("cannot get current occupancy; occupancy events are not enabled in room options",4e4,400);return this._latestOccupancyData}_internalOccupancyListener(e){this._logger.trace("Occupancy._internalOccupancyListener();",e),this._latestOccupancyData=DC(e),this._emitter.emit(Vh.Updated,{type:Vh.Updated,occupancy:this._latestOccupancyData})}static channelOptionMerger(e){return r=>e.occupancy.enableEvents?{...r,params:{...r.params,occupancy:"metrics"}}:r}dispose(){this._logger.trace("DefaultOccupancy.dispose();"),this._unsubscribeOccupancyEvents(),this._emitter.off(),this._logger.debug("DefaultOccupancy.dispose(); disposed successfully")}hasListeners(){return ms(this._emitter)}}class e_{constructor(e,r,a,l){this._emitter=new di,this._stateEmitter=new di,this._presenceState={present:!1},this.subscribeToEvents=y=>{this._emitter.emit(y.action,{type:y.action,member:this._realtimeMemberToPresenceMember(y)})},this._channel=e,this._clientId=r,this._logger=a,this._options=l;const f=this.subscribeToEvents.bind(this),h=y=>{if(y.reason?.code===91004){this._logger.debug("Presence auto-reentry failed",{reason:y.reason}),this._emitPresenceStateChange(!1,y.reason);return}if(y.current==="detached"){this._emitPresenceStateChange(!1);return}},v=y=>{this._emitPresenceStateChange(!1,y.reason)};this._offChannelUpdate=gs(this._channel,"update",h),this._offChannelDetach=gs(this._channel,["detached","failed"],v),this._unsubscribePresenceEvents=Oo(this._channel.presence,f)}async get(e){return this._logger.trace("Presence.get()",{params:e}),this._assertChannelState(),(await this._channel.presence.get(e)).map(r=>this._realtimeMemberToPresenceMember(r))}async isUserPresent(e){return this._logger.trace("Presence.isUserPresent()",{clientId:e}),this._assertChannelState(),(await this._channel.presence.get({clientId:e})).length>0}async enter(e){this._logger.trace("Presence.enter()",{data:e}),this._assertChannelState();try{await this._channel.presence.enterClient(this._clientId,e),this._emitPresenceStateChange(!0)}catch(r){throw this._emitPresenceStateChange(!1,r),r}}async update(e){this._logger.trace("Presence.update()",{data:e}),this._assertChannelState();try{await this._channel.presence.updateClient(this._clientId,e),this._emitPresenceStateChange(!0)}catch(r){throw this._emitPresenceStateChange(!1,r),r}}async leave(e){this._logger.trace("Presence.leave()",{data:e}),this._assertChannelState();try{await this._channel.presence.leaveClient(this._clientId,e),this._emitPresenceStateChange(!1)}catch(r){throw this._emitPresenceStateChange(!1,r),r}}subscribe(e,r){if(this._logger.trace("Presence.subscribe(); listenerOrEvents",{listenerOrEvents:e}),!this._options.presence.enableEvents)throw this._logger.error("could not subscribe to presence; presence events are not enabled"),new Ke.ErrorInfo("could not subscribe to presence; presence events are not enabled",4e4,400);if(!e&&!r)throw this._logger.error("could not subscribe to presence; invalid arguments"),new Ke.ErrorInfo("could not subscribe listener: invalid arguments",4e4,400);if(r){const a=Cr(r);return this._emitter.on(e,a),{unsubscribe:()=>{this._logger.trace("Presence.unsubscribe();",{events:e}),this._emitter.off(a)}}}else{const a=Cr(e);return this._emitter.on(a),{unsubscribe:()=>{this._logger.trace("Presence.unsubscribe();"),this._emitter.off(a)}}}}static channelOptionMerger(e){return r=>(r.modes.includes("PRESENCE")||r.modes.push("PRESENCE"),e.presence.enableEvents&&!r.modes.includes("PRESENCE_SUBSCRIBE")&&r.modes.push("PRESENCE_SUBSCRIBE"),r)}dispose(){this._logger.trace("DefaultPresence.dispose();"),this._emitter.off(),this._unsubscribePresenceEvents(),this._offChannelUpdate(),this._offChannelDetach(),this._logger.debug("DefaultPresence.dispose(); disposed successfully")}hasListeners(){return ms(this._emitter)}_realtimeMemberToPresenceMember(e){return{...e,data:e.data,updatedAt:new Date(e.timestamp)}}_assertChannelState(){if(this._channel.state!=="attaching"&&this._channel.state!=="attached")throw this._logger.error("could not perform presence operation; room is not attached"),new Ke.ErrorInfo("could not perform presence operation; room is not attached",4e4,400)}_emitPresenceStateChange(e,r){this._logger.trace("Presence._emitPresenceStateChange()",{present:e,error:r});const a={...this._presenceState};this._presenceState={present:e};const l={previous:a,current:this._presenceState,error:r};this._stateEmitter.emit("presence.state.change",l)}onPresenceStateChange(e){this._logger.trace("Presence.onPresenceStateChange()");const r=Cr(e);return this._stateEmitter.on("presence.state.change",r),{unsubscribe:()=>{this._logger.trace("Presence.unsubscribeFromPresenceStateChanges()"),this._stateEmitter.off(r)}}}}const Wu=new Error("request for lock canceled");var UC=function(n,e,r,a){function l(f){return f instanceof r?f:new r(function(h){h(f)})}return new(r||(r=Promise))(function(f,h){function v(E){try{k(a.next(E))}catch(O){h(O)}}function y(E){try{k(a.throw(E))}catch(O){h(O)}}function k(E){E.done?f(E.value):l(E.value).then(v,y)}k((a=a.apply(n,e||[])).next())})};class BC{constructor(e,r=Wu){this._value=e,this._cancelError=r,this._queue=[],this._weightedWaiters=[]}acquire(e=1,r=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return new Promise((a,l)=>{const f={resolve:a,reject:l,weight:e,priority:r},h=t_(this._queue,v=>r<=v.priority);h===-1&&e<=this._value?this._dispatchItem(f):this._queue.splice(h+1,0,f)})}runExclusive(e){return UC(this,arguments,void 0,function*(r,a=1,l=0){const[f,h]=yield this.acquire(a,l);try{return yield r(f)}finally{h()}})}waitForUnlock(e=1,r=0){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);return this._couldLockImmediately(e,r)?Promise.resolve():new Promise(a=>{this._weightedWaiters[e-1]||(this._weightedWaiters[e-1]=[]),FC(this._weightedWaiters[e-1],{resolve:a,priority:r})})}isLocked(){return this._value<=0}getValue(){return this._value}setValue(e){this._value=e,this._dispatchQueue()}release(e=1){if(e<=0)throw new Error(`invalid weight ${e}: must be positive`);this._value+=e,this._dispatchQueue()}cancel(){this._queue.forEach(e=>e.reject(this._cancelError)),this._queue=[]}_dispatchQueue(){for(this._drainUnlockWaiters();this._queue.length>0&&this._queue[0].weight<=this._value;)this._dispatchItem(this._queue.shift()),this._drainUnlockWaiters()}_dispatchItem(e){const r=this._value;this._value-=e.weight,e.resolve([r,this._newReleaser(e.weight)])}_newReleaser(e){let r=!1;return()=>{r||(r=!0,this.release(e))}}_drainUnlockWaiters(){if(this._queue.length===0)for(let e=this._value;e>0;e--){const r=this._weightedWaiters[e-1];r&&(r.forEach(a=>a.resolve()),this._weightedWaiters[e-1]=[])}else{const e=this._queue[0].priority;for(let r=this._value;r>0;r--){const a=this._weightedWaiters[r-1];if(!a)continue;const l=a.findIndex(f=>f.priority<=e);(l===-1?a:a.splice(0,l)).forEach(f=>f.resolve())}}}_couldLockImmediately(e,r){return(this._queue.length===0||this._queue[0].priority<r)&&e<=this._value}}function FC(n,e){const r=t_(n,a=>e.priority<=a.priority);n.splice(r+1,0,e)}function t_(n,e){for(let r=n.length-1;r>=0;r--)if(e(n[r]))return r;return-1}var VC=function(n,e,r,a){function l(f){return f instanceof r?f:new r(function(h){h(f)})}return new(r||(r=Promise))(function(f,h){function v(E){try{k(a.next(E))}catch(O){h(O)}}function y(E){try{k(a.throw(E))}catch(O){h(O)}}function k(E){E.done?f(E.value):l(E.value).then(v,y)}k((a=a.apply(n,e||[])).next())})};class n_{constructor(e){this._semaphore=new BC(1,e)}acquire(){return VC(this,arguments,void 0,function*(e=0){const[,r]=yield this._semaphore.acquire(1,e);return r})}runExclusive(e,r=0){return this._semaphore.runExclusive(()=>e(),1,r)}isLocked(){return this._semaphore.isLocked()}waitForUnlock(e=0){return this._semaphore.waitForUnlock(1,e)}release(){this._semaphore.isLocked()&&this._semaphore.release()}cancel(){return this._semaphore.cancel()}}var Rt=(n=>(n.Initializing="initializing",n.Initialized="initialized",n.Attaching="attaching",n.Attached="attached",n.Detaching="detaching",n.Detached="detached",n.Suspended="suspended",n.Failed="failed",n.Releasing="releasing",n.Released="released",n))(Rt||{});class zC{constructor(e){this._status="initialized",this._emitter=new di,this._logger=e}get status(){return this._status}get error(){return this._error}onChange(e){const r=Cr(e);return this._emitter.on(r),{off:()=>{this._emitter.off(r)}}}setStatus(e){const r={current:e.status,error:e.error,previous:this._status};this._status=r.current,this._error=r.error,this._logger.info("room status changed",{...r}),this._emitter.emit(r.current,r)}dispose(){this._logger.trace("DefaultRoomLifecycle.dispose();"),this._emitter.off(),this._logger.debug("DefaultRoomLifecycle.dispose(); disposed successfully")}hasListeners(){return ms(this._emitter)}}class qC{constructor(e,r,a){this._channelManager=e,this._roomLifecycle=r,this._logger=a,this._eventEmitter=new di,this._hasAttachedOnce=!1,this._isExplicitlyDetached=!1,this._mutex=new n_;const l=this._channelStateListener.bind(this),f=this._discontinuityOnAttachedListener.bind(this),h=this._discontinuityOnUpdateListener.bind(this),v=this._channelManager.get();this._unsubscribeChannelStateListener=gs(v,l),this._offDiscontinuityAttached=gs(v,"attached",f),this._offDiscontinuityUpdate=gs(v,"update",h)}onDiscontinuity(e){this._logger.trace("RoomLifecycleManager.onDiscontinuity()");const r=Cr(e);return this._eventEmitter.on(Ic.Discontinuity,r),{off:()=>{this._eventEmitter.off(Ic.Discontinuity,r)}}}async attach(){await this._mutex.runExclusive(async()=>{if(this._logger.trace("RoomLifecycleManager.attach();"),this._checkRoomNotReleasing("attach"),this._roomStatusIs(Rt.Attached)){this._logger.debug("RoomLifecycleManager.attach(); room already attached, no-op");return}const e=this._channelManager.get();this._logger.debug("RoomLifecycleManager.attach(); attaching room",{channelState:e.state});try{this._setStatus(Rt.Attaching),await e.attach(),this._setStatus(Rt.Attached),this._isExplicitlyDetached=!1,this._hasAttachedOnce=!0,this._logger.debug("RoomLifecycleManager.attach(); room attached successfully")}catch(r){const a=r,l=new Ke.ErrorInfo(`failed to attach room: ${a.message}`,a.code,a.statusCode,a),f=this._mapChannelStateToRoomStatus(e.state);throw this._setStatus(f,l),l}},1)}async detach(){await this._mutex.runExclusive(async()=>{if(this._logger.trace("RoomLifecycleManager.detach();"),this._roomStatusIs(Rt.Failed))throw new Ke.ErrorInfo("cannot detach room, room is in failed state",Ao.RoomInFailedState,400);if(this._checkRoomNotReleasing("detach"),this._roomStatusIs(Rt.Detached)){this._logger.debug("RoomLifecycleManager.detach(); room already detached, no-op");return}const e=this._channelManager.get();this._logger.debug("RoomLifecycleManager.detach(); detaching room",{channelState:e.state});try{this._setStatus(Rt.Detaching),await e.detach(),this._isExplicitlyDetached=!0,this._setStatus(Rt.Detached),this._logger.debug("RoomLifecycleManager.detach(); room detached successfully")}catch(r){const a=r,l=new Ke.ErrorInfo(`failed to detach room: ${a.message}`,a.code,a.statusCode,a),f=this._mapChannelStateToRoomStatus(e.state);throw this._setStatus(f,l),l}},1)}async release(){await this._mutex.runExclusive(async()=>{if(this._logger.trace("RoomLifecycleManager.release();"),this._roomStatusIs(Rt.Released)){this._logger.debug("RoomLifecycleManager.release(); room already released, no-op");return}if(this._roomStatusIs(Rt.Initialized)||this._roomStatusIs(Rt.Detached)){this._logger.debug("RoomLifecycleManager.release(); room is initialized or detached, releasing immediately",{status:this._roomLifecycle.status}),this._releaseChannel();return}this._setStatus(Rt.Releasing);const e=this._channelManager.get();this._logger.debug("RoomLifecycleManager.release(); attempting channel detach before release",{channelState:e.state}),await this._channelDetachLoop(e),this._releaseChannel()},0)}_mapChannelStateToRoomStatus(e){switch(e){case"initialized":return Rt.Initialized;case"attaching":return Rt.Attaching;case"attached":return Rt.Attached;case"detaching":return Rt.Detaching;case"detached":return Rt.Detached;case"suspended":return Rt.Suspended;case"failed":return Rt.Failed;default:return this._logger.error("RoomLifecycleManager._mapChannelStateToRoomStatus(); unknown channel state",{channelState:e}),Rt.Failed}}_checkRoomNotReleasing(e){switch(this._roomLifecycle.status){case Rt.Released:throw new Ke.ErrorInfo(`cannot ${e} room, room is released`,Ao.RoomIsReleased,400);case Rt.Releasing:throw new Ke.ErrorInfo(`cannot ${e} room, room is currently releasing`,Ao.RoomIsReleasing,400)}}_roomStatusIs(e){return this._roomLifecycle.status===e}dispose(){this._unsubscribeChannelStateListener(),this._offDiscontinuityAttached(),this._offDiscontinuityUpdate(),this._eventEmitter.off()}hasListeners(){return ms(this._eventEmitter)}_channelStateListener(e){if(this._logger.debug("RoomLifecycleManager.channel state changed",{oldState:e.previous,newState:e.current,reason:e.reason,resumed:e.resumed}),this._operationInProgress()){this._logger.debug("RoomLifecycleManager._startMonitoringChannelState(); ignoring channel state change - operation in progress",{status:this._roomLifecycle.status});return}const r=this._mapChannelStateToRoomStatus(e.current);this._setStatus(r,e.reason)}_discontinuityOnAttachedListener(e){if(!e.resumed&&this._hasAttachedOnce&&!this._isExplicitlyDetached){const r=new Ke.ErrorInfo("discontinuity detected",Ao.RoomDiscontinuity,e.reason?.statusCode??0,e.reason);this._logger.warn("RoomLifecycleManager._startMonitoringDiscontinuity(); discontinuity detected",{error:r}),this._eventEmitter.emit(Ic.Discontinuity,r)}}_discontinuityOnUpdateListener(e){if(!e.resumed&&this._hasAttachedOnce&&!this._isExplicitlyDetached&&e.current==="attached"&&e.previous==="attached"){const r=new Ke.ErrorInfo("discontinuity detected",Ao.RoomDiscontinuity,e.reason?.statusCode??0,e.reason);this._logger.warn("RoomLifecycleManager._startMonitoringDiscontinuity(); discontinuity detected",{error:r}),this._eventEmitter.emit(Ic.Discontinuity,r)}}async _channelDetachLoop(e){for(;;){if(e.state==="failed"){this._logger.debug("RoomLifecycleManager._channelDetachLoop(); channel is failed, skipping detach");break}try{await e.detach();break}catch(r){this._logger.error("RoomLifecycleManager._channelDetachLoop(); failed to detach channel during release",{error:r}),await new Promise(a=>setTimeout(a,250))}}}_setStatus(e,r){this._logger.debug("RoomLifecycleManager._setStatus(); updating room status",{oldStatus:this._roomLifecycle.status,newStatus:e,hasError:!!r}),this._roomLifecycle.setStatus({status:e,error:r})}_releaseChannel(){this._channelManager.release(),this._setStatus(Rt.Released),this._logger.debug("RoomLifecycleManager._releaseChannel(); room released successfully")}_operationInProgress(){return this._mutex.isLocked()}testForceHasAttachedOnce(e){this._logger.trace("RoomLifecycleManager.testForceHasAttachedOnce();",{firstAttach:e}),this._hasAttachedOnce=e}}const Gu={typing:{heartbeatThrottleMs:1e4},occupancy:{enableEvents:!1},presence:{enableEvents:!0},messages:{rawMessageReactions:!1,defaultMessageReactionType:Ro.Distinct}},$C=n=>new Ke.ErrorInfo(`invalid room configuration: ${n}`,40001,400),WC=n=>{GC(n.typing)},GC=n=>{if(n.heartbeatThrottleMs<=0)throw $C("typing heartbeat interval must be greater than 0")},HC=n=>({...Gu.typing,...n?.typing}),JC=n=>({...Gu.occupancy,...n?.occupancy}),QC=n=>({...Gu.presence,...n?.presence}),KC=n=>({...Gu.messages,...n?.messages}),YC=(n,e)=>({typing:HC(n),occupancy:JC(n),presence:QC(n),messages:KC(n),isReactClient:e}),r_=(n,e)=>({name:n,data:e,extras:{ephemeral:!0}}),XC=n=>{const e=n.extras?n.extras:{};return{...n,extras:{...e,ephemeral:!0}}};class ZC{constructor(e,r,a,l,f,h){this.name=e,this.clientId=r,this.createdAt=a,this.isSelf=l,this.metadata=f,this.headers=h,Object.freeze(this)}}const eE=(n,e)=>{const r=n,a=r.data?.name&&typeof r.data.name=="string"?r.data.name:"",l=r.clientId??"",f=r.timestamp?new Date(r.timestamp):new Date;return new ZC(a,l,f,e?e===l:!1,r.data?.metadata??{},r.extras?.headers??{})};class tE{constructor(e,r,a,l){this._emitter=new di,this._forwarder=h=>{const v=eE(h,this._clientId);this._emitter.emit(Fh.Reaction,{type:Fh.Reaction,reaction:v})},this._channel=e,this._connection=r,this._clientId=a,this._logger=l;const f=this._forwarder.bind(this);this._unsubscribeRoomReactionEvents=Oo(this._channel,[Bh.Reaction],f)}send(e){this._logger.trace("RoomReactions.send();",e);const{name:r,metadata:a,headers:l}=e;if(!r)return Promise.reject(new Ke.ErrorInfo("unable to send reaction; name not set and it is required",40001,400));if(this._connection.state!=="connected")return Promise.reject(new Ke.ErrorInfo("unable to send reaction; not connected to Ably",4e4,400));const f={name:r,metadata:a??{}},h={name:Bh.Reaction,data:f,extras:{headers:l??{}}};return this._channel.publish(XC(h))}subscribe(e){this._logger.trace("RoomReactions.subscribe();");const r=Cr(e);return this._emitter.on(r),{unsubscribe:()=>{this._logger.trace("RoomReactions.unsubscribe();"),this._emitter.off(r)}}}dispose(){this._unsubscribeRoomReactionEvents(),this._emitter.off()}hasListeners(){return ms(this._emitter)}}class nE extends di{constructor(e,r,a,l,f){super(),this._timeoutMs=2e3,this._mutex=new n_,this._internalSubscribeToEvents=h=>{const{name:v,clientId:y}=h;if(this._logger.trace("DefaultTyping._internalSubscribeToEvents(); received event",{name:v,clientId:y}),!y){this._logger.error("DefaultTyping._internalSubscribeToEvents(); invalid clientId in received event",{inbound:h});return}v===$r.Started||v===$r.Stopped?this._updateCurrentlyTyping(y,v):this._logger.warn("DefaultTyping._internalSubscribeToEvents(); unrecognized event",{name:v})},this._clientId=l,this._channel=a,this._connection=r,this._heartbeatThrottleMs=e.heartbeatThrottleMs,this._currentlyTyping=new Map,this._logger=f,this._unsubscribeTypingEvents=Oo(this._channel,[$r.Started,$r.Stopped],this._internalSubscribeToEvents.bind(this))}_clearAllTypingStates(){this._logger.debug("DefaultTyping._clearAllTypingStates(); clearing all typing states"),this._clearHeartbeatTimer(),this._clearCurrentlyTyping()}_clearHeartbeatTimer(){this._logger.trace("DefaultTyping._clearHeartbeatTimer(); clearing heartbeat timer"),this._heartbeatTimerId&&(clearTimeout(this._heartbeatTimerId),this._heartbeatTimerId=void 0)}_clearCurrentlyTyping(){this._logger.trace("DefaultTyping._clearCurrentlyTyping(); clearing current store and timeouts");for(const[,e]of this._currentlyTyping.entries())clearTimeout(e);this._currentlyTyping.clear()}current(){return this._logger.trace("DefaultTyping.current();"),new Set(this._currentlyTyping.keys())}get channel(){return this._channel}_startHeartbeatTimer(){if(!this._heartbeatTimerId){this._logger.trace("DefaultTyping.startHeartbeatTimer();");const e=this._heartbeatTimerId=setTimeout(()=>{this._logger.debug("DefaultTyping.startHeartbeatTimer(); heartbeat timer expired"),e===this._heartbeatTimerId&&(this._heartbeatTimerId=void 0)},this._heartbeatThrottleMs)}}async keystroke(){this._logger.trace("DefaultTyping.keystroke();"),this._mutex.cancel();try{await this._mutex.acquire()}catch(e){if(e===Wu){this._logger.debug("DefaultTyping.keystroke(); mutex was canceled by a later operation");return}throw new Ke.ErrorInfo("mutex acquisition failed",5e4,500)}try{if(this._connection.state!=="connected")throw this._logger.error("DefaultTyping.keystroke(); connection is not connected",{status:this._connection.state}),new Ke.ErrorInfo("cannot type, connection is not connected",4e4,400);if(this._heartbeatTimerId){this._logger.debug("DefaultTyping.keystroke(); no-op, already typing and heartbeat timer has not expired");return}await this._channel.publish(r_($r.Started)),this._startHeartbeatTimer(),this._logger.trace("DefaultTyping.keystroke(); starting timers")}finally{this._logger.trace("DefaultTyping.keystroke(); releasing mutex"),this._mutex.release()}}async stop(){this._logger.trace("DefaultTyping.stop();"),this._mutex.cancel();try{await this._mutex.acquire()}catch(e){if(e===Wu){this._logger.debug("DefaultTyping.stop(); mutex was canceled by a later operation");return}throw new Ke.ErrorInfo("mutex acquisition failed",5e4,500)}try{if(this._connection.state!=="connected")throw this._logger.error("DefaultTyping.stop(); connection is not connected",{status:this._connection.state}),new Ke.ErrorInfo("cannot stop typing, connection is not connected",4e4,400);if(!this._heartbeatTimerId){this._logger.debug("DefaultTyping.stop(); no-op, not currently typing");return}await this._channel.publish(r_($r.Stopped)),this._logger.trace("DefaultTyping.stop(); clearing timers"),clearTimeout(this._heartbeatTimerId),this._heartbeatTimerId=void 0}finally{this._logger.trace("DefaultTyping.stop(); releasing mutex"),this._mutex.release()}}subscribe(e){this._logger.trace("DefaultTyping.subscribe();");const r=Cr(e);return this.on(r),{unsubscribe:()=>{this._logger.trace("DefaultTyping.unsubscribe();"),this.off(r)}}}async dispose(){for(this._logger.trace("DefaultTyping.dispose();");;)try{this._mutex.cancel(),await this._mutex.acquire();break}catch(e){if(e===Wu)this._logger.debug("DefaultTyping.dispose(); mutex was canceled"),await new Promise(r=>setTimeout(r,200)),this._logger.debug("DefaultTyping.dispose(); retrying mutex acquisition");else{this._logger.error("DefaultTyping.dispose(); failed to acquire mutex; could not complete resource disposal",{error:e});return}}this._clearAllTypingStates(),this._unsubscribeTypingEvents(),this.off(),this._mutex.release()}_updateCurrentlyTyping(e,r){this._logger.trace("DefaultTyping._updateCurrentlyTyping();",{clientId:e,event:r}),r===$r.Started?this._handleTypingStart(e):this._handleTypingStop(e)}_startNewClientInactivityTimer(e){this._logger.trace("DefaultTyping._startNewClientInactivityTimer(); starting new inactivity timer",{clientId:e});const r=setTimeout(()=>{if(this._logger.trace("DefaultTyping._startNewClientInactivityTimer(); client typing timeout expired",{clientId:e}),this._currentlyTyping.get(e)!==r){this._logger.debug("DefaultTyping._startNewClientInactivityTimer(); timeout already cleared; ignoring",{clientId:e});return}this._currentlyTyping.delete(e),this.emit(To.SetChanged,{type:To.SetChanged,currentlyTyping:new Set(this._currentlyTyping.keys()),change:{clientId:e,type:$r.Stopped}})},this._heartbeatThrottleMs+this._timeoutMs);return r}_handleTypingStart(e){this._logger.debug("DefaultTyping._handleTypingStart();",{clientId:e});const r=this._startNewClientInactivityTimer(e),a=this._currentlyTyping.get(e);this._currentlyTyping.set(e,r),a?(this._logger.debug("DefaultTyping._handleTypingStart(); received heartbeat for currently typing client",{clientId:e}),clearTimeout(a)):(this._logger.debug("DefaultTyping._handleTypingStart(); new client started typing",{clientId:e}),this.emit(To.SetChanged,{type:To.SetChanged,currentlyTyping:new Set(this._currentlyTyping.keys()),change:{clientId:e,type:$r.Started}}))}_handleTypingStop(e){const r=this._currentlyTyping.get(e);if(!r){this._logger.trace('DefaultTyping._handleTypingStop(); received "Stop" event for client not in currentlyTyping list',{clientId:e});return}this._logger.debug("DefaultTyping._handleTypingStop(); client stopped typing",{clientId:e}),clearTimeout(r),this._currentlyTyping.delete(e),this.emit(To.SetChanged,{type:To.SetChanged,currentlyTyping:new Set(this._currentlyTyping.keys()),change:{clientId:e,type:$r.Stopped}})}get heartbeatThrottleMs(){return this._heartbeatThrottleMs}get hasHeartbeatTimer(){return!!this._heartbeatTimerId}}class rE{constructor(e,r,a,l,f,h){WC(a),this._nonce=r,this._logger=h.withContext({roomName:e,roomNonce:r}),this._logger.debug("Room();",{options:a}),this._name=e,this._options=a,this._chatApi=f,this._lifecycle=new zC(this._logger);const v=this._channelManager=this._getChannelManager(a,l,this._logger),y=v.get();this._messages=new AC(e,a.messages,y,this._chatApi,l.auth.clientId,this._logger),this._presence=new e_(y,l.auth.clientId,this._logger,a),this._typing=new nE(a.typing,l.connection,y,l.auth.clientId,this._logger),this._reactions=new tE(y,l.connection,l.auth.clientId,this._logger),this._occupancy=new Zy(e,y,this._chatApi,this._logger,a),this._lifecycleManager=new qC(v,this._lifecycle,this._logger);let k=!1;this._finalizer=async()=>{if(k){this._logger.debug("Room.finalizer(); already finalized");return}await this._lifecycleManager.release(),this._lifecycleManager.dispose(),this._messages.dispose(),this._presence.dispose(),this._reactions.dispose(),this._occupancy.dispose(),await this._typing.dispose(),this._lifecycle.dispose(),k=!0}}_getChannelManager(e,r,a){const l=new NC(this._name,r,a,e.isReactClient);return l.mergeOptions(Zy.channelOptionMerger(e)),l.mergeOptions(e_.channelOptionMerger(e)),l.mergeOptions(Ky.channelOptionMerger(e)),l}get name(){return this._name}options(){return ys(this._options)}get messages(){return this._messages}get presence(){return this._presence}get reactions(){return this._reactions}get typing(){return this._typing}get occupancy(){return this._occupancy}get status(){return this._lifecycle.status}get error(){return this._lifecycle.error}onStatusChange(e){return this._lifecycle.onChange(e)}async attach(){return this._logger.trace("Room.attach();"),this._lifecycleManager.attach()}async detach(){return this._logger.trace("Room.detach();"),this._lifecycleManager.detach()}release(){return this._logger.trace("Room.release();"),this._finalizer()}get nonce(){return this._nonce}get lifecycle(){return this._lifecycle}get lifecycleManager(){return this._lifecycleManager}onDiscontinuity(e){return this._logger.trace("Room.onDiscontinuity();"),this._lifecycleManager.onDiscontinuity(e)}get channel(){return this._channelManager.get()}}class iE{constructor(e,r,a){this._rooms=new Map,this._releasing=new Map,this._isReact=!1,this._disposed=!1,this._realtime=e,this._chatApi=new PC(e,a),this._clientOptions=r,this._logger=a}async get(e,r){this._logger.trace("Rooms.get();",{roomName:e}),this._ensureNotDisposed();const a=this._rooms.get(e);if(a)return this._handleExistingRoom(a,e,r);const l=this._releasing.get(e),f=$y();return l?this._waitForReleaseAndCreateRoom(e,f,r,l):this._createNewRoom(e,f,r)}async release(e){this._logger.trace("Rooms.release();",{roomName:e});const r=this._rooms.get(e),a=this._releasing.get(e);return r?a?this._handleConcurrentRelease(e,r,a):this._performRoomRelease(e,r):this._handleNonExistentRoomRelease(e,a)}async dispose(){this._logger.trace("Rooms.dispose();"),this._disposed=!0;const e=[...this._rooms.keys()];if(e.length===0){this._logger.debug("Rooms.dispose(); no rooms to release");return}const r=e.map(f=>this.release(f)),a=[...this._releasing.values()],l=[...r,...a];this._logger.debug("Rooms.dispose(); releasing rooms",{roomCount:e.length,roomNames:e}),await Promise.all(l),this._logger.debug("Rooms.dispose(); all rooms released successfully")}get clientOptions(){return this._clientOptions}get count(){return this._rooms.size}_ensureNotDisposed(){if(this._disposed)throw new Ke.ErrorInfo("cannot get room, rooms instance has been disposed",4e4,400)}async _handleExistingRoom(e,r,a){if(!Pc(e.options,a))throw new Ke.ErrorInfo("room already exists with different options",4e4,400);return this._logger.debug("Rooms.get(); returning existing room",{roomName:r,nonce:e.nonce,options:a}),await e.promise}_createNewRoom(e,r,a){const l=this._makeRoom(e,r,a),f={promise:Promise.resolve(l),nonce:r,options:a};return this._rooms.set(e,f),this._logger.debug("Rooms.get(); returning new room",{roomName:e,nonce:l.nonce}),l}async _waitForReleaseAndCreateRoom(e,r,a,l){const f=new AbortController,h=this._createAbortableRoomPromise(e,r,a,l,f);return this._rooms.set(e,{promise:h,options:a,nonce:r,abort:f}),this._logger.debug("Rooms.get(); creating new promise dependent on previous release",{roomName:e}),await h}_createAbortableRoomPromise(e,r,a,l,f){return new Promise((h,v)=>{const y=()=>{this._logger.debug("Rooms.get(); aborted before init",{roomName:e}),v(new Ke.ErrorInfo("room released before get operation could complete",Ao.RoomReleasedBeforeOperationCompleted,400))};f.signal.addEventListener("abort",y),l.then(()=>{if(f.signal.aborted){this._logger.debug("Rooms.get(); aborted before releasing promise resolved",{roomName:e});return}this._logger.debug("Rooms.get(); releasing finished",{roomName:e});const k=this._makeRoom(e,r,a);f.signal.removeEventListener("abort",y),h(k)}).catch(k=>{f.signal.removeEventListener("abort",y),v(k)})})}async _handleNonExistentRoomRelease(e,r){if(r){this._logger.debug("Rooms.release(); waiting for previous release call",{roomName:e}),await r;return}this._logger.debug("Rooms.release(); room does not exist",{roomName:e})}async _handleConcurrentRelease(e,r,a){r.abort&&(this._logger.debug("Rooms.release(); aborting get call",{roomName:e,existingNonce:r.nonce}),r.abort.abort(),this._rooms.delete(e)),await a}async _performRoomRelease(e,r){this._rooms.delete(e);const a=this._executeRoomRelease(e,r);this._releasing.set(e,a),this._logger.debug("Rooms.release(); creating new release promise",{roomName:e,nonce:r.nonce}),await a}async _executeRoomRelease(e,r){const a=await r.promise;this._logger.debug("Rooms.release(); releasing room",{roomName:e,nonce:r.nonce}),await a.release(),this._logger.debug("Rooms.release(); room released",{roomName:e,nonce:r.nonce}),this._releasing.delete(e)}_makeRoom(e,r,a){return new rE(e,r,YC(a,this._isReact),this._realtime,this._chatApi,this._logger)}useReact(){this._logger.trace("Rooms.useReact();"),this._isReact=!0}}class sE{constructor(e,r){this._realtime=e,this._clientOptions=_C(r),this._nonce=$y(),this._logger=vC(this._clientOptions).withContext({chatClientNonce:this._nonce}),this._connection=new SC(e,this._logger),this._rooms=new iE(e,this._clientOptions,this._logger),this._addAgent("chat-js"),this._logger.trace(`ably chat client version ${$u}; initialized`)}get rooms(){return this._rooms}get connection(){return this._connection}get clientId(){return this._realtime.auth.clientId}get realtime(){return this._realtime}get clientOptions(){return this._clientOptions}get logger(){return this._logger}addReactAgent(){this._addAgent("chat-react"),this._rooms.useReact()}addAgentWithVersion(e,r){this._addAgent(e,r),this._logger.trace(`Added agent ${e} with version ${r}`)}async dispose(){this._logger.trace("ChatClient.dispose();"),await this._rooms.dispose(),this._connection.dispose(),this._logger.debug("ChatClient.dispose(); client disposed successfully")}_addAgent(e,r){const a=this._realtime;a.options.agents={...a.options.agents??a.options.agents,[e]:r??$u}}}const i_=Symbol.for("__ABLY_CONTEXT__"),s_=typeof globalThis<"u"?globalThis:{};function oE(){let n=s_[i_];return n||(n=s_[i_]=et.createContext({})),n}const o_=oE(),aE=({client:n,children:e,ablyId:r="default"})=>{if(!n)throw new Error("AblyProvider: the `client` prop is required");const a=et.useContext(o_),l=V.useMemo(()=>Object.assign(Object.assign({},a),{[r]:{client:n,_channelNameToChannelContext:{}}}),[a,n,r]);return Ue.jsx(o_.Provider,Object.assign({value:l},{children:e}))},a_=V.createContext(void 0);Ke.Realtime.EventEmitter;var Wh=(n=>(n.Initialized="initialized",n.Connecting="connecting",n.Connected="connected",n.Disconnected="disconnected",n.Suspended="suspended",n.Failed="failed",n))(Wh||{});const c_=Symbol.for("__ABLY_CHAT_CLIENT_CONTEXT__"),l_=typeof globalThis>"u"?{}:globalThis,cE=()=>{let n=l_[c_];return n??=l_[c_]=et.createContext({}),n},Hu=cE();var u_=Object.prototype.hasOwnProperty;function d_(n,e,r){for(r of n.keys())if(xc(r,e))return r}function xc(n,e){var r,a,l;if(n===e)return!0;if(n&&e&&(r=n.constructor)===e.constructor){if(r===Date)return n.getTime()===e.getTime();if(r===RegExp)return n.toString()===e.toString();if(r===Array){if((a=n.length)===e.length)for(;a--&&xc(n[a],e[a]););return a===-1}if(r===Set){if(n.size!==e.size)return!1;for(a of n)if(l=a,l&&typeof l=="object"&&(l=d_(e,l),!l)||!e.has(l))return!1;return!0}if(r===Map){if(n.size!==e.size)return!1;for(a of n)if(l=a[0],l&&typeof l=="object"&&(l=d_(e,l),!l)||!xc(a[1],e.get(l)))return!1;return!0}if(r===ArrayBuffer)n=new Uint8Array(n),e=new Uint8Array(e);else if(r===DataView){if((a=n.byteLength)===e.byteLength)for(;a--&&n.getInt8(a)===e.getInt8(a););return a===-1}if(ArrayBuffer.isView(n)){if((a=n.byteLength)===e.byteLength)for(;a--&&n[a]===e[a];);return a===-1}if(!r||typeof n=="object"){a=0;for(r in n)if(u_.call(n,r)&&++a&&!u_.call(e,r)||!(r in e)||!xc(n[r],e[r]))return!1;return Object.keys(e).length===a}}return n!==n&&e!==e}var Gh=(n=>(n[n.BadRequest=4e4]="BadRequest",n[n.MessageRejectedByBeforePublishRule=42211]="MessageRejectedByBeforePublishRule",n[n.MessageRejectedByModeration=42213]="MessageRejectedByModeration",n[n.PresenceAutoReentryFailed=91004]="PresenceAutoReentryFailed",n[n.RoomDiscontinuity=102100]="RoomDiscontinuity",n[n.RoomInFailedState=102101]="RoomInFailedState",n[n.RoomIsReleasing=102102]="RoomIsReleasing",n[n.RoomIsReleased=102103]="RoomIsReleased",n[n.RoomReleasedBeforeOperationCompleted=102106]="RoomReleasedBeforeOperationCompleted",n))(Gh||{});const lE=(n,e)=>n.code===e,Hh=n=>{if(n===null||typeof n!="object")return n;if(Array.isArray(n))return n.sort().map(a=>Hh(a));const e={},r=Object.keys(n).sort();for(const a of r)e[a]=Hh(n[a]);return e},uE=(n,e)=>{if(e===void 0)return;if(e===null||typeof e!="object")return e;if(Array.isArray(e))return e.sort().map(l=>Hh(l));const r={},a=Object.keys(e).sort();for(const l of a)r[l]=e[l];return r},Ju=(n,e)=>JSON.stringify({roomName:n,options:e},uE);class dE{constructor(e,r){this._refCounts=new Map,this._releaseDelayMs=100,this._pendingReleases=new Map,this._client=e,this._logger=r}get client(){return this._client}async addReference(e,r){this._logger.trace("RoomReferenceManager.addReference();");const a=Ju(e,r),l=this._refCounts.get(a);if(l)return l.pendingRelease&&(clearTimeout(l.pendingRelease),l.pendingRelease=void 0,this._logger.debug("RoomReferenceManager.addReference(); aborted pending release",{roomName:e,options:r})),l.count++,this._logger.debug("RoomReferenceManager.addReference(); incremented ref count",{roomName:e,options:r,count:l.count}),l.resolvedRoom?l.resolvedRoom:new Promise((y,k)=>{const E=setInterval(()=>{l.resolvedRoom?(clearInterval(E),y(l.resolvedRoom)):l.resolutionError&&(clearInterval(E),k(l.resolutionError))},100)});const f=this._pendingReleases.get(e);if(f){this._logger.debug("RoomReferenceManager.addReference(); waiting for pending release to complete",{roomName:e,options:r});try{await f}catch(y){this._logger.debug("RoomReferenceManager.addReference(); pending release failed, continuing",{roomName:e,options:r,error:y})}}const h=[...this._refCounts.values()].find(y=>y.roomName===e&&!xc(y.options,r));if(h){const y=h.pendingRelease!==void 0,k=h.count<=0;if(!y&&!k)throw new Ke.ErrorInfo(`cannot get room with different options; room "${e}" is already in use with different options`,Gh.BadRequest,400);this._logger.debug("RoomReferenceManager.addReference(); found existing room with different options, releasing it first",{roomName:e,newOptions:r,existingOptions:h.options,hasPendingRelease:y,hasZeroRefCount:k}),h.pendingRelease&&(clearTimeout(h.pendingRelease),h.pendingRelease=void 0);const E=Ju(e,h.options);this._refCounts.delete(E);const O=this._client.rooms.release(e).catch(D=>{this._logger.debug("RoomReferenceManager.addReference(); release of existing room failed",{roomName:e,error:D})}).finally(()=>{this._pendingReleases.delete(e)});this._pendingReleases.set(e,O);try{await O}catch(D){this._logger.debug("RoomReferenceManager.addReference(); release of existing room failed, continuing",{roomName:e,error:D})}}const v={count:1,roomName:e,options:r};this._refCounts.set(a,v),this._logger.debug("RoomReferenceManager.addReference(); first reference, attaching room",{roomName:e,options:r});try{const y=await this._client.rooms.get(e,r);return v.resolvedRoom=y,y.attach().catch(k=>{this._logger.error("RoomReferenceManager.addReference(); error attaching room",{roomName:e,options:r,error:k})}),y}catch(y){throw v.resolutionError=y,this._refCounts.delete(a),this._logger.error("RoomReferenceManager.addReference(); error creating room",{roomName:e,options:r,error:y}),y}}removeReference(e,r){this._logger.trace("RoomReferenceManager.removeReference();");const a=Ju(e,r),l=this._refCounts.get(a);if(!l){this._logger.debug("RoomReferenceManager.removeReference(); no existing reference found",{roomName:e,options:r});return}l.count--,this._logger.debug("RoomReferenceManager.removeReference(); decremented ref count",{roomName:e,options:r,count:l.count}),l.count<=0&&(this._logger.debug("RoomReferenceManager.removeReference(); scheduling delayed release",{roomName:e,options:r,delayMs:this._releaseDelayMs}),l.pendingRelease=setTimeout(()=>{const f=this._refCounts.get(a);if(f&&f.count<=0){this._refCounts.delete(a),this._logger.debug("RoomReferenceManager.removeReference(); executing delayed release",{roomName:e,options:r});const h=this._client.rooms.release(e).catch(v=>{this._logger.debug("RoomReferenceManager.removeReference(); release failed",{roomName:e,options:r,error:v})}).finally(()=>{this._pendingReleases.delete(e)});this._pendingReleases.set(e,h)}},this._releaseDelayMs))}getReferenceCount(e,r){this._logger.trace("RoomReferenceManager.getReferenceCount();");const a=Ju(e,r);return this._refCounts.get(a)?.count??0}}const f_=Symbol("roomReferenceManager"),fE=()=>{const n=V.useContext(Hu)[f_];if(!n)throw new Ke.ErrorInfo("useRoomReferenceManager must be used within a ChatClientProvider",4e4,400);return n},h_="default",hE=({children:n,client:e})=>{const r=V.useContext(Hu),a=V.useRef(void 0),l=V.useMemo(()=>{if(e.addReactAgent(),!a.current||a.current.client!==e){const h=e.logger;a.current=new dE(e,h)}const f=globalThis.__ABLY_CHAT_REACT_UI_COMPONENTS_VERSION__;return typeof f=="string"&&e.addAgentWithVersion("chat-react-ui-components",f),{...r,[h_]:{client:e},[f_]:a.current}},[e,r]);return Ue.jsx(Hu.Provider,{value:l,children:n})},Qu=()=>{const n=et.useContext(Hu)[h_];if(!n)throw new Ke.ErrorInfo("useChatClient hook must be used within a chat client provider",4e4,400);return n.client},Lc=n=>{const e=V.useContext(a_);if(!e)throw new Ke.ErrorInfo(`${n} hook must be used within a <ChatRoomProvider>`,4e4,400);return e},p_=()=>{const n=Qu();return V.useMemo(()=>n.logger,[n])},Ku=()=>{const n=Lc("useRoomLogger"),e=Qu();return V.useMemo(()=>e.logger.withContext({roomName:n.roomName}),[e,n])},zi=n=>{const e=V.useRef(n);V.useEffect(()=>{e.current=n});const r=V.useCallback((...a)=>{e.current&&e.current(...a)},[]);return n?r:void 0},Jh=n=>{const e=Qu(),r=p_();r.trace("useChatConnection();",n);const[a,l]=V.useState(e.connection.status),[f,h]=V.useState(e.connection.error);V.useEffect(()=>{h(e.connection.error),l(e.connection.status)},[e]);const v=zi(n?.onStatusChange);return V.useEffect(()=>{r.debug("useChatConnection(); applying internal listener");const{off:y}=e.connection.onStatusChange(k=>{l(k.current),h(k.error)});return()=>{r.debug("useChatConnection(); cleaning up listener"),y()}},[e.connection,r]),V.useEffect(()=>{if(!v)return;r.debug("useChatConnection(); applying client listener");const{off:y}=e.connection.onStatusChange(v);return()=>{r.debug("useChatConnection(); cleaning up client listener"),y()}},[e.connection,r,v]),{currentStatus:a,error:f}};class pE{constructor(e,r,a){this._unmounted=!1,this._onResolve=r,this._logger=a,this.mount(e).catch(l=>{this._logger.trace("DefaultRoomPromise(); mount error",{error:l})})}async mount(e){this._logger.debug("DefaultRoomPromise(); mount");try{const r=await e;if(this._unmounted)return;this._logger.debug("DefaultRoomPromise(); mount resolved"),this._onUnmount=this._onResolve(r)}catch(r){this._logger.error("DefaultRoomPromise(); mount error",{error:r})}}unmount(){return this._unmounted?()=>{}:()=>{this._logger.debug("DefaultRoomPromise(); unmount"),this._unmounted=!0,this._onUnmount?.()}}}const fr=(n,e,r)=>new pE(n,e,r);var Po=(n=>(n.Initializing="initializing",n.Initialized="initialized",n.Attaching="attaching",n.Attached="attached",n.Detaching="detaching",n.Detached="detached",n.Suspended="suspended",n.Failed="failed",n.Releasing="releasing",n.Released="released",n))(Po||{});const Qh=n=>{const e=Lc("useRoomStatus"),[r,a]=V.useState(Po.Initializing),[l,f]=V.useState(),h=Ku(),v=zi(n?.onRoomStatusChange);return V.useEffect(()=>fr(e.room,y=>{h.debug("useRoomStatus(); subscribing internal listener"),a(y.status),f(y.error);const{off:k}=y.onStatusChange(E=>{h.debug("useRoomStatus(); status change",E),a(E.current),f(E.error)});return()=>{h.debug("useRoomStatus(); unsubscribing internal listener"),k()}},h).unmount(),[e,h]),V.useEffect(()=>fr(e.room,y=>{let k;return v&&(h.debug("useRoomStatus(); subscribing to status changes"),k=y.onStatusChange(v).off),h.debug("useRoomStatus(); setting initial status",{status:y.status}),v&&(h.debug("useRoomStatus(); sending initial status event"),v({current:y.status,previous:Po.Initializing,error:y.error})),()=>{h.debug("useRoomStatus(); unmounting"),k&&(h.debug("useRoomStatus(); unsubscribing from status changes"),k())}},h).unmount(),[e,h,v]),{status:r,error:l}},g_=n=>{const{currentStatus:e,error:r}=Jh({onStatusChange:n?.onConnectionStatusChange}),a=Lc("useMessages"),{status:l,error:f}=Qh(n),h=Ku();h.trace("useMessages();",{params:n});const v=zi(n?.listener),y=zi(n?.reactionsListener),k=zi(n?.rawReactionsListener),E=zi(n?.onDiscontinuity),O=V.useCallback(P=>a.room.then($=>$.messages.send(P)),[a]),D=V.useCallback(P=>a.room.then($=>$.messages.get(P)),[a]),x=V.useCallback((P,$)=>a.room.then(G=>G.messages.delete(P,$)),[a]),L=V.useCallback(P=>a.room.then($=>$.messages.history(P)),[a]),R=V.useCallback((P,$,G)=>a.room.then(ae=>ae.messages.update(P,$,G)),[a]),N=V.useCallback((P,$)=>a.room.then(G=>G.messages.reactions.send(P,$)),[a]),q=V.useCallback((P,$)=>a.room.then(G=>G.messages.reactions.delete(P,$)),[a]),[Q,ee]=V.useState();return V.useEffect(()=>{if(v)return fr(a.room,P=>{let $=!1;h.debug("useMessages(); applying listener");const G=P.messages.subscribe(v);return ee(()=>{if(h.debug("useMessages(); setting historyBeforeSubscribe state",{status:P.status,unmounted:$}),!$)return ae=>(h.debug("useMessages(); historyBeforeSubscribe called"),$?Promise.reject(new Ke.ErrorInfo("component unmounted",4e4,400)):G.historyBeforeSubscribe(ae))}),()=>{h.debug("useMessages(); removing listener and historyBeforeSubscribe state"),$=!0,G.unsubscribe(),ee(void 0)}},h).unmount()},[a,h,v]),V.useEffect(()=>{if(E)return fr(a.room,P=>{h.debug("useMessages(); applying onDiscontinuity listener");const{off:$}=P.onDiscontinuity(E);return()=>{h.debug("useMessages(); removing onDiscontinuity listener"),$()}},h).unmount()},[a,h,E]),V.useEffect(()=>{if(y)return fr(a.room,P=>{h.debug("useMessages(); applying reactions listener");const{unsubscribe:$}=P.messages.reactions.subscribe(y);return()=>{h.debug("useMessages(); removing reactions listener"),$()}},h).unmount()},[a,h,y]),V.useEffect(()=>{if(k)return fr(a.room,P=>{h.debug("useMessages(); applying raw reactions listener");const{unsubscribe:$}=P.messages.reactions.subscribeRaw(k);return()=>{h.debug("useMessages(); removing raw reactions listener"),$()}},h).unmount()},[a,h,k]),{connectionStatus:e,connectionError:r,roomStatus:l,roomError:f,sendMessage:O,getMessage:D,updateMessage:R,history:L,deleteMessage:x,sendReaction:N,deleteReaction:q,historyBeforeSubscribe:Q}},m_=new Set([Wh.Suspended,Wh.Failed]),gE=n=>{const{currentStatus:e,error:r}=Jh({onStatusChange:n?.onConnectionStatusChange}),a=Lc("usePresence"),{status:l,error:f}=Qh(n),h=Ku();h.trace("usePresence();",{params:n});const v=V.useMemo(()=>n?.autoEnterLeave!==!1,[n?.autoEnterLeave]),[y,k]=V.useState({present:!1,error:void 0}),E=V.useRef({roomStatus:l,connectionStatus:e}),O=zi(n?.onDiscontinuity),D=V.useRef(n?.initialData),x=V.useRef(!1),L=V.useRef(!1),R=V.useRef(!1);V.useEffect(()=>{L.current=!1,R.current=!1},[a]),V.useEffect(()=>{E.current={roomStatus:l,connectionStatus:e},l===Po.Detached&&(R.current=!0)},[l,e]),V.useEffect(()=>(h.debug("usePresence(); subscribing to presence state changes"),fr(a.room,ee=>{const P=ee.presence.onPresenceStateChange($=>{h.debug("usePresence(); presence state changed",{stateChange:$}),k({...$.current,error:$.error})});return()=>{h.debug("usePresence(); unsubscribing from presence state changes"),P.unsubscribe()}},h).unmount()),[a,h]),V.useEffect(()=>(h.debug("usePresence(); running auto-enter hook"),v?fr(a.room,ee=>{const P=ee.status===Po.Attached&&!m_.has(e),$=!L.current||R.current;return!P||x.current||!$?(h.debug("usePresence(); skipping enter room",{roomStatus:l,connectionStatus:e,hasExplicitlyLeft:x.current,shouldAutoEnter:$,hasAutoEntered:L.current,roomWasDetached:R.current}),()=>{}):(h.debug("usePresence(); entering room"),ee.presence.enter(D.current).then(()=>{h.debug("usePresence(); entered room"),L.current=!0,R.current=!1}).catch(G=>{h.error("usePresence(); error entering room",{error:G})}),()=>{const G=ee.status===Po.Attached&&!m_.has(E.current.connectionStatus);h.debug("usePresence(); unmounting",{canLeavePresence:G,roomStatus:l,connectionStatus:e}),G&&!x.current&&ee.presence.leave().then(()=>{h.debug("usePresence(); left room")}).catch(ae=>{h.error("usePresence(); error leaving room",{error:ae})})})},h).unmount():(h.debug("usePresence(); auto enter/leave disabled"),()=>{})),[a,e,l,h,v]),V.useEffect(()=>{if(O)return fr(a.room,ee=>{const{off:P}=ee.onDiscontinuity(O);return()=>{h.debug("usePresence(); removing onDiscontinuity listener"),P()}},h).unmount()},[a,O,h]);const N=V.useCallback(async ee=>{D.current=ee,x.current=!1,await(await a.room).presence.update(ee)},[a]),q=V.useCallback(async ee=>{D.current=ee,x.current=!1,await(await a.room).presence.enter(ee)},[a]),Q=V.useCallback(async ee=>{x.current=!0,await(await a.room).presence.leave(ee)},[a]);return{connectionStatus:e,connectionError:r,roomStatus:l,roomError:f,update:N,enter:q,leave:Q,myPresenceState:y}},mE=1500,vE=3e4,yE=5,_E=n=>{const{currentStatus:e,error:r}=Jh({onStatusChange:n?.onConnectionStatusChange}),a=Lc("usePresenceListener"),{status:l,error:f}=Qh(n),h=Ku();h.trace("usePresenceListener();");const v=V.useRef(0),y=V.useRef(0),k=V.useRef(void 0),E=V.useRef(0),O=V.useRef([]),[D,x]=V.useState([]),L=V.useRef(void 0),[R,N]=V.useState(),q=zi(n?.listener),Q=zi(n?.onDiscontinuity),ee=V.useCallback($=>{h.debug("usePresenceListener(); setting error state",{error:$}),L.current=$,N($)},[h]),P=V.useCallback(()=>{h.debug("usePresenceListener(); clearing error state"),L.current=void 0,N(void 0)},[h]);return V.useEffect(()=>{const $=()=>{v.current+=1,k.current&&(clearTimeout(k.current),k.current=void 0,E.current=0),G(v.current)},G=ae=>{fr(a.room,ye=>(ye.presence.get({waitForSync:!0}).then(Ce=>{h.debug("usePresenceListener(); fetched presence data",{presenceMembers:Ce}),k.current&&(clearTimeout(k.current),k.current=void 0,E.current=0),!(y.current>=ae)&&(y.current=ae,O.current=Ce,x(Ce),L.current&&P())}).catch(()=>{if(!(E.current<yE)){h.error("usePresenceListener(); failed to fetch presence data after max retries"),ee(new Ke.ErrorInfo("failed to fetch presence data after max retries",5e4,500));return}if(k.current){h.debug("usePresenceListener(); waiting for retry but new event received");return}const Ce=Math.min(vE,mE*Math.pow(2,E.current));E.current+=1,h.debug("usePresenceListener(); retrying to fetch presence data",{numRetries:E.current}),k.current=setTimeout(()=>{k.current=void 0,v.current+=1,G(v.current)},Ce)}),()=>{}),h)};return fr(a.room,ae=>{let ye;return ae.status===Po.Attached?ae.presence.get({waitForSync:!0}).then(Ce=>{h.debug("usePresenceListener(); fetched initial presence data",{presenceMembers:Ce}),O.current=Ce,x(Ce),P()}).catch(Ce=>{const Ve=Ce;lE(Ve,Gh.RoomIsReleased)||(h.error("usePresenceListener(); error fetching initial presence data",{error:Ce}),ee(Ve))}).finally(()=>{h.debug("usePresenceListener(); subscribing internal listener to presence events"),ye=ae.presence.subscribe(()=>{$()}).unsubscribe}):(h.debug("usePresenceListener(); not yet attached, subscribing internal listener to presence events"),ye=ae.presence.subscribe(()=>{$()}).unsubscribe),()=>{ye&&(h.debug("usePresenceListener(); cleaning up internal listener"),ye())}},h).unmount()},[a,ee,P,h]),V.useEffect(()=>{if(q)return fr(a.room,$=>{h.debug("usePresenceListener(); applying external listener");const{unsubscribe:G}=$.presence.subscribe(q);return()=>{h.debug("usePresenceListener(); cleaning up external listener"),G()}},h).unmount()},[a,q,h]),V.useEffect(()=>{if(Q)return fr(a.room,$=>{h.debug("usePresenceListener(); applying onDiscontinuity listener");const{off:G}=$.onDiscontinuity(Q);return()=>{h.debug("usePresenceListener(); removing onDiscontinuity listener"),G()}},h).unmount()},[a,Q,h]),{connectionStatus:e,connectionError:r,roomStatus:l,roomError:f,error:R,presenceData:D}},wE=({name:n,options:e,children:r})=>{const a=Qu(),l=p_(),f=V.useMemo(()=>l.withContext({roomName:n}),[l,n]),h=fE();f.debug("ChatRoomProvider();",{options:e});const[v,y]=V.useState(()=>{f.debug("ChatRoomProvider(); initializing value",{options:e});const k=a.rooms.get(n,e);return k.catch(()=>{}),{room:k,roomName:n,options:e,client:a}});return V.useEffect(()=>{f.debug("ChatRoomProvider(); running lifecycle useEffect");let k=!1;const E=h.addReference(n,e);return y(O=>O.client===a&&O.roomName===n&&O.options===e?(f.debug("ChatRoomProvider(); no change in room id or options",{options:e}),O):(f.debug("ChatRoomProvider(); updating value",{options:e}),{room:E,roomName:n,options:e,client:a})),E.then(()=>{if(k){f.debug("ChatRoomProvider(); unmounted before room resolved");return}f.debug("ChatRoomProvider(); room resolved")}).catch(()=>{}),()=>{k=!0,f.debug("ChatRoomProvider(); cleaning up lifecycle useEffect"),h.removeReference(n,e)}},[n,e,f,a,h]),Ue.jsx(a_.Provider,{value:v,children:r})},_s={DOMAIN:"demoservice.app",get API_BASE(){return`https://${this.DOMAIN}`}};function bE(){gE();const n=_E();return V.useEffect(()=>{if(n&&typeof n.enterPresence=="function")return n.enterPresence(),()=>{n&&typeof n.leavePresence=="function"&&n.leavePresence()}},[n]),null}function SE({currentFields:n}){const[e,r]=V.useState([]),a=V.useRef(null),l=g_({listener:h=>{console.log("New message received:",h),r(v=>[...v,h.message])}});console.log("MessagesList render - messagesHook object:",l);const f=()=>{a.current?.scrollIntoView({behavior:"smooth"})};return V.useEffect(()=>{l.roomStatus==="attached"&&(console.log("Setting up message listener..."),l.history({direction:"backwards",limit:50}).then(h=>{console.log("Initial message history:",h),h&&h.items&&r(h.items.reverse())}).catch(h=>{console.error("Error getting message history:",h)}))},[l.roomStatus]),V.useEffect(()=>{f()},[e]),Ue.jsxs("div",{style:{flex:1,overflowY:"auto",padding:"12px",display:"flex",flexDirection:"column",gap:"8px",minHeight:0},children:[Ue.jsxs("div",{style:{textAlign:"center",color:"hsl(var(--foreground))",fontSize:"13px",padding:"8px 0",fontWeight:"500"},children:["Talk to a ",Ue.jsx("span",{style:{textDecoration:"underline"},children:"real person"})," in seconds"]}),e&&e.length>0&&e.map(h=>Ue.jsx("div",{style:{display:"flex",flexDirection:"column",alignItems:h.clientId?.startsWith("embed-")?"flex-end":"flex-start"},children:Ue.jsx("div",{style:{backgroundColor:"hsl(var(--background))",color:"hsl(var(--foreground))",padding:"6px 12px",borderRadius:"16px",maxWidth:"80%",wordWrap:"break-word",border:"1px solid hsl(var(--border) / 0.3)",fontSize:"13px"},children:h.text||h.data})},h.id)),Ue.jsx("div",{ref:a})]})}function kE(){const[n,e]=V.useState(""),r=g_(),a=V.useCallback(async()=>{if(n.trim())try{console.log("Sending message:",n.trim()),console.log("Messages object before send:",r);const f=await r.sendMessage({text:n.trim()});console.log("Message send result:",f),e("")}catch(f){console.error("Error sending message:",f)}},[n,r]),l=f=>{f.key==="Enter"&&!f.shiftKey&&(f.preventDefault(),a())};return Ue.jsxs("div",{style:{padding:"12px",display:"flex",gap:"8px",backgroundColor:"transparent",flexShrink:0},children:[Ue.jsx("textarea",{value:n,onChange:f=>e(f.target.value),onKeyPress:l,placeholder:"Message...",style:{flex:1,padding:"6px 12px",border:"1px solid hsl(var(--border) / 0.3)",borderRadius:"16px",resize:"none",fontSize:"13px",fontFamily:"inherit",outline:"none",backgroundColor:"hsl(var(--background))",color:"hsl(var(--foreground))"},rows:1}),Ue.jsx("button",{onClick:a,style:{padding:"6px 12px",backgroundColor:"hsl(var(--background))",color:"hsl(var(--foreground))",border:"1px solid hsl(var(--border) / 0.3)",borderRadius:"16px",cursor:"pointer",fontSize:"13px",fontWeight:"500"},children:""})]})}function CE({currentFields:n,onCallClick:e,onCancelClick:r}){const a=!!n.sessionEndedAt,l=!!n.dailyRoomId&&!a,f=!!n.joined;return a||l?null:Ue.jsxs("div",{style:{padding:"2px 8px",backgroundColor:"transparent",display:"flex",justifyContent:"flex-end",alignItems:"center",gap:"8px",flexShrink:0},children:[!l&&f&&Ue.jsx("button",{onClick:r,style:{padding:"6px 8px",borderRadius:"16px",background:"hsl(var(--background))",color:"hsl(var(--foreground))",border:"1px solid hsl(var(--border) / 0.3)",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.2s ease",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',width:"24px",height:"24px",display:"flex",alignItems:"center",justifyContent:"center"},onMouseEnter:h=>{h.currentTarget.style.transform="scale(1.05)"},onMouseLeave:h=>{h.currentTarget.style.transform="scale(1)"},children:""}),Ue.jsx("button",{onClick:e,style:{padding:"6px 12px",borderRadius:"16px",background:"linear-gradient(135deg, hsl(var(--foreground) / 0.9), hsl(var(--foreground) / 0.7))",color:"hsl(var(--background))",border:"1px solid hsl(var(--border) / 0.3)",cursor:"pointer",fontSize:"13px",fontWeight:"500",transition:"all 0.2s ease",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',textAlign:"center",minWidth:"80px"},onMouseEnter:h=>{h.currentTarget.style.transform="scale(1.05)"},onMouseLeave:h=>{h.currentTarget.style.transform="scale(1)"},children:f&&!l?Ue.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"4px"},children:[Ue.jsx("div",{style:{width:"12px",height:"12px",border:"2px solid hsl(var(--background) / 0.3)",borderTop:"2px solid hsl(var(--background))",borderRadius:"50%",animation:"spin 1s linear infinite"}}),Ue.jsx("span",{children:"Calling"})]}):"Call now"})]})}function EE({chatRoomId:n,currentFields:e,onCallClick:r,onCancelClick:a}){return Ue.jsxs("div",{style:{width:"100%",height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[Ue.jsx(bE,{}),Ue.jsx(SE,{currentFields:e}),Ue.jsx(CE,{currentFields:e,onCallClick:r,onCancelClick:a}),Ue.jsx(kE,{}),Ue.jsx("style",{children:`
          @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
          }
        `})]})}function ME({chatRoomId:n,visitorData:e,currentFields:r,onCallClick:a,onCancelClick:l}){const[f,h]=V.useState(null);return V.useEffect(()=>{if(!n||!e)return;const v=new Ke.Realtime({authCallback:async(k,E)=>{try{console.log("Requesting Ably token for visitor:",e.visitorId);const O=await fetch(`${_s.API_BASE}/api/ably-token-embed`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitorId:e.visitorId,sessionId:e.sessionId,companyId:e.companyId})});if(!O.ok)throw new Error("Failed to get token");const D=await O.json();console.log("Received Ably token request:",!!D),E(null,D)}catch(O){console.error("Token auth error:",O),E(String(O),null)}},clientId:`embed-${e.visitorId}`}),y=new sE(v,{logLevel:Dh.Info});return h({realtimeClient:v,chatClient:y}),()=>{v.connection.close()}},[n,e]),!n||!e||!f?Ue.jsx("div",{style:{width:"100%",height:"250px",backgroundColor:"hsl(var(--background) / 0.85)",border:"1px solid hsl(var(--border))",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08)",display:"flex",flexDirection:"column",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:Ue.jsx("div",{style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",textAlign:"center",color:"hsl(var(--muted-foreground))"},children:Ue.jsx("div",{children:Ue.jsx("p",{style:{margin:0,fontSize:"14px"},children:!n||!e?"Initializing...":"Connecting to chat..."})})})}):Ue.jsx("div",{style:{width:"100%",height:"250px",backgroundColor:"hsl(var(--background) / 0.85)",border:"1px solid hsl(var(--border) / 0.3)",borderRadius:"12px",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.12), 0 2px 8px rgba(0, 0, 0, 0.08)",display:"flex",flexDirection:"column",fontFamily:'-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif',overflow:"hidden",backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)"},children:Ue.jsx(aE,{client:f.realtimeClient,children:Ue.jsx(hE,{client:f.chatClient,children:Ue.jsx(wE,{name:n,children:Ue.jsx(EE,{chatRoomId:n,currentFields:r,onCallClick:a,onCancelClick:l})})})})})}const OE="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict";let v_=(n=21)=>{let e="",r=crypto.getRandomValues(new Uint8Array(n|=0));for(;n--;)e+=OE[r[n]&63];return e};function TE(){const[n,e]=V.useState(null),[r,a]=V.useState({active:!1,joined:!1,dailyRoomId:null,chatRoomId:null,sessionEndedAt:null}),[l,f]=V.useState(!1),[h,v]=V.useState(null),y=V.useCallback(()=>{const x=document.getElementsByTagName("script");for(let L=0;L<x.length;L++){const R=x[L];if(R.src&&R.src.includes("embed.js")){const q=new URL(R.src).searchParams.get("token");if(q)return q}if(R.dataset.token)return R.dataset.token}return null},[]),k=V.useCallback(async x=>{const L=window.location.hostname;try{return await(await fetch(`${_s.API_BASE}/api/visitor/validate?token=${encodeURIComponent(x)}&domain=${encodeURIComponent(L)}`)).json()}catch(R){return console.error("Error validating token:",R),{valid:!1}}},[]),E=V.useCallback(async x=>{let L=localStorage.getItem("service_visitor_id");L||(L=v_(),localStorage.setItem("service_visitor_id",L));let R=localStorage.getItem("current_session_id");R||(R=v_(),localStorage.setItem("current_session_id",R));const N=`chat-${L}-${R}`;console.log(" Initializing visitor with:",{serviceVisitorId:L,sessionId:R,companyId:x,chatRoomId:N});try{const Q=await(await fetch(`${_s.API_BASE}/api/visitor/initialize`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({visitorId:L,companyId:x,sessionId:R,chatRoomId:N})})).json();if(Q.success){const ee=y();if(ee)return e({visitorId:L,sessionId:R,companyId:x,token:ee}),f(!0),{visitorId:L,sessionId:R,companyId:x,token:ee,visitData:Q}}}catch(q){console.error("Error initializing visitor:",q)}return null},[y]),O=V.useCallback(async x=>{if(!n)return;const L=JSON.stringify({visitorId:n.visitorId,sessionId:n.sessionId,companyId:n.companyId,...x});try{const R=await fetch(`${_s.API_BASE}/api/visitor/update-status`,{method:"POST",headers:{"Content-Type":"application/json"},body:L});if(!R.ok)throw new Error(`HTTP error! status: ${R.status}`);const N=await R.json();console.log("Status updated successfully:",N)}catch(R){console.error("Error updating visit status:",R)}},[n]),D=V.useCallback(x=>{const L=x||n;if(console.log("subscribeToEvents called - visitorData:",!!L,"eventSource:",!!h),!L||h){console.log("EventSource creation blocked - visitorData:",!!L,"eventSource exists:",!!h);return}const R=`${_s.API_BASE}/api/visitor/events?visitorId=${encodeURIComponent(L.visitorId)}`;console.log("Creating EventSource with URL:",R);const N=new EventSource(R);N.onopen=function(){console.log("EventSource connection opened")},N.onmessage=function(q){try{const Q=JSON.parse(q.data);console.log("EventSource message received:",Q),Q.type==="visit_update"&&a(ee=>{const P={active:"active"in Q?!!Q.active:ee.active,joined:"joined"in Q?!!Q.joined:ee.joined,dailyRoomId:"dailyRoomId"in Q?Q.dailyRoomId||null:ee.dailyRoomId,chatRoomId:"chatRoomId"in Q?Q.chatRoomId||null:ee.chatRoomId,sessionEndedAt:"sessionEndedAt"in Q?Q.sessionEndedAt||null:ee.sessionEndedAt};if(console.log("Current fields before update:",ee),console.log("New fields:",P),P.sessionEndedAt)return P;const $=JSON.stringify(P)!==JSON.stringify(ee);return console.log("Fields changed:",$),P})}catch(Q){console.error("EventSource message error:",Q)}},N.onerror=function(q){console.log("EventSource error:",q),console.log("EventSource readyState:",N.readyState),setTimeout(()=>{N.readyState===EventSource.CLOSED&&(console.log("EventSource closed, will reconnect"),v(null),D())},3e3)},v(N)},[n,h]);return V.useEffect(()=>{const x=y();if(!x||l)return;(async()=>{const R=await k(x);if(R.valid){const N=await E(R.companyId);if(N){const q=N.visitData;if(q){const Q=q.chatRoomId||`chat-${N.visitorId}-${N.sessionId}`;console.log("Setting currentFields from initialization:",q),a({active:!!q.active,joined:!!q.joined,dailyRoomId:q.dailyRoomId||null,chatRoomId:Q,sessionEndedAt:q.sessionEndedAt||null})}else{console.log("No visitData received from initialization, setting default fields");const Q=`chat-${N.visitorId}-${N.sessionId}`;a({active:!0,joined:!1,dailyRoomId:null,chatRoomId:Q,sessionEndedAt:null})}D(N)}}})()},[y,k,E,D,l]),V.useEffect(()=>()=>{h&&h.close()},[h]),{visitorData:n,currentFields:r,isInitialized:l,updateVisitFields:O}}function RE({visitorData:n,currentFields:e,updateVisitFields:r}){V.useEffect(()=>{const a=()=>{const h=!!e.dailyRoomId;if(h)return;const v=!h&&e.joined;document.hidden&&e.active&&!v?r({active:!1}):!document.hidden&&!e.active&&!e.joined&&r({active:!0})},l=()=>{if(!e.dailyRoomId&&!e.joined&&n){const h=JSON.stringify({visitorId:n.visitorId,sessionId:n.sessionId,active:!1,endedAt:new Date().toISOString()});if(navigator.sendBeacon){const v=new Blob([h],{type:"application/json"});navigator.sendBeacon(`${_s.API_BASE}/api/visitor/update-status`,v)}}},f=()=>{if(console.log("Page unloading, cleaning up..."),!e.dailyRoomId&&!e.joined&&n){const h=JSON.stringify({visitorId:n.visitorId,sessionId:n.sessionId,active:!1,endedAt:new Date().toISOString()});if(navigator.sendBeacon){const v=new Blob([h],{type:"application/json"});navigator.sendBeacon(`${_s.API_BASE}/api/visitor/update-status`,v)}else{const v=new XMLHttpRequest;v.open("POST",`${_s.API_BASE}/api/visitor/update-status`,!1),v.setRequestHeader("Content-Type","application/json"),v.send(h)}}};return document.addEventListener("visibilitychange",a),window.addEventListener("pagehide",l),window.addEventListener("beforeunload",f),()=>{document.removeEventListener("visibilitychange",a),window.removeEventListener("pagehide",l),window.removeEventListener("beforeunload",f)}},[n,e,r])}function y_(){const{visitorData:n,currentFields:e,isInitialized:r,updateVisitFields:a}=TE();RE({visitorData:n,currentFields:e,updateVisitFields:a});const l=()=>{const v=!!e.dailyRoomId;console.log("Call button clicked - inCall:",v,"joined:",e.joined),!v&&!e.joined&&(console.log("Setting joined to true"),a({joined:!0,dailyRoomId:null}))},f=()=>{!!!e.dailyRoomId&&e.joined&&a({joined:!1})},h=()=>{e.dailyRoomId&&!e.joined&&a({joined:!0})};return!r||!n?null:Ue.jsx(Kk,{children:Ue.jsxs("div",{style:{position:"fixed",bottom:"20px",right:"20px",width:"300px",display:"flex",flexDirection:"column",gap:"8px",zIndex:1e4},children:[Ue.jsx(dC,{currentFields:e,visitorData:n,onJoined:h}),Ue.jsx(ME,{chatRoomId:e.chatRoomId,visitorData:n,currentFields:e,onCallClick:l,onCancelClick:f})]})})}const __=document.currentScript?.getAttribute("data-theme")||"light",w_=document.createElement("style");w_.textContent=`
  /* Embed widget CSS variables - theme: ${__} */
  :root {
    ${__==="dark"?`
    /* Dark theme colors for embed */
    --background: 202 7% 3%;
    --foreground: 202 7% 93%;
    --muted: 202 7% 12%;
    --muted-foreground: 202 7% 83%;
    --primary: 202 7% 17%;
    --primary-foreground: 202 7% 93%;
    --destructive: 4 75% 25%;
    --destructive-foreground: 202 7% 93%;
    --border: 202 7% 50%;
    --ring: 202 7% 93%;
    `:`
    /* Light theme colors for embed */
    --background: 202 7% 93%;
    --foreground: 202 7% 7%;
    --muted: 202 7% 88%;
    --muted-foreground: 202 7% 17%;
    --primary: 202 7% 83%;
    --primary-foreground: 202 7% 7%;
    --destructive: 4 75% 25%;
    --destructive-foreground: 202 7% 7%;
    --border: 202 7% 50%;
    --ring: 202 7% 7%;
    `}
    --radius: 0.5rem;
  }

  /* Spinner animation */
  @keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
  }
`,document.head.appendChild(w_);let jc=document.getElementById("embed-widget-root");jc||(jc=document.createElement("div"),jc.id="embed-widget-root",document.body.appendChild(jc)),Y0.createRoot(jc).render(Ue.jsx(et.StrictMode,{children:Ue.jsx(y_,{})})),window.EmbedWidget=y_})();
